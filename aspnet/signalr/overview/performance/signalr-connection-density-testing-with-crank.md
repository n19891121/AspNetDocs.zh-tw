---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: SignalR 連線密度測試與區軸 |Microsoft Docs
author: bradygaster
description: 使用曲軸的 SignalR 連線密度測試
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: bb8a7da1080dc325c0479b337d114b8dcdf6e102
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/09/2019
ms.locfileid: "59390060"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="58bb7-103">使用曲軸的 SignalR 連線密度測試</span><span class="sxs-lookup"><span data-stu-id="58bb7-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="58bb7-104">藉由[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="58bb7-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="58bb7-105">本文說明如何使用曲柄工具來測試多個模擬用戶端應用程式。</span><span class="sxs-lookup"><span data-stu-id="58bb7-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>


<span data-ttu-id="58bb7-106">一旦您的應用程式執行 （可能是 Azure web 角色，IIS，或自我裝載使用 Owin） 及其裝載環境中，您可以測試使用曲柄工具連線密度高程度的應用程式的回應。</span><span class="sxs-lookup"><span data-stu-id="58bb7-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="58bb7-107">Internet Information Services (IIS) 伺服器、 Owin 主機或 Azure web 角色，可以是裝載環境。</span><span class="sxs-lookup"><span data-stu-id="58bb7-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="58bb7-108">(注意：效能計數器並不適用於 Azure App Service Web Apps，因此您無法從連線密度測試取得效能資料。）</span><span class="sxs-lookup"><span data-stu-id="58bb7-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="58bb7-109">連線密度是指可以在伺服器建立的同時 TCP 連線數目。</span><span class="sxs-lookup"><span data-stu-id="58bb7-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="58bb7-110">每個 TCP 連線時，會產生其本身的額外負荷，並開啟大量的閒置的連線將最終會建立記憶體瓶頸。</span><span class="sxs-lookup"><span data-stu-id="58bb7-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="58bb7-111">[SignalR 程式碼基底](https://github.com/signalr/signalr)包含負載測試的工具，稱為**Crank**。</span><span class="sxs-lookup"><span data-stu-id="58bb7-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="58bb7-112">即使最新版本可在[Dev 分支](https://github.com/SignalR/signalr/tree/dev)GitHub 上。</span><span class="sxs-lookup"><span data-stu-id="58bb7-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="58bb7-113">您可以下載的 Zip 封存 SignalR 的 Dev 分支的程式碼基底[此處](https://github.com/SignalR/SignalR/archive/dev.zip)。</span><span class="sxs-lookup"><span data-stu-id="58bb7-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="58bb7-114">曲柄可能用來完全 saturate 伺服器的記憶體，以便能夠計算可能伺服器硬體上的閒置連線的總數。</span><span class="sxs-lookup"><span data-stu-id="58bb7-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="58bb7-115">或者，您也可以使用曲柄對負載測試一定數量的記憶體不足的壓力，伺服器的緩慢增加連線，直到到達特定的計數或特定的記憶體臨界值。</span><span class="sxs-lookup"><span data-stu-id="58bb7-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="58bb7-116">測試時，請務必使用遠端用戶端，以避免任何競爭資源 （亦即，TCP 連線和記憶體）。</span><span class="sxs-lookup"><span data-stu-id="58bb7-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="58bb7-117">監視用戶端，以確保它們未達到任何可能防止伺服器到達其完整的容量 （記憶體或 CPU） 的瓶頸。</span><span class="sxs-lookup"><span data-stu-id="58bb7-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="58bb7-118">您可能需要增加用戶端數目，以便可以完全載入伺服器。</span><span class="sxs-lookup"><span data-stu-id="58bb7-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="58bb7-119">執行連線密度測試</span><span class="sxs-lookup"><span data-stu-id="58bb7-119">Running a Connection Density Test</span></span>

<span data-ttu-id="58bb7-120">本章節描述的 SignalR 應用程式上執行連線密度測試所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="58bb7-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="58bb7-121">下載並建置[SignalR 的 Dev 分支程式碼基底](https://github.com/SignalR/SignalR/archive/dev.zip)。</span><span class="sxs-lookup"><span data-stu-id="58bb7-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="58bb7-122">在命令提示字元中，瀏覽至&lt;專案目錄&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug。</span><span class="sxs-lookup"><span data-stu-id="58bb7-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="58bb7-123">應用程式部署至其預定的裝載環境。</span><span class="sxs-lookup"><span data-stu-id="58bb7-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="58bb7-124">請記下您的應用程式使用; 端點例如，在建立的應用程式[快速入門教學課程](../getting-started/tutorial-getting-started-with-signalr.md)，則端點`http://<yourhost>:8080/signalr`。</span><span class="sxs-lookup"><span data-stu-id="58bb7-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="58bb7-125">安裝[SignalR 效能計數器](signalr-performance.md#perfcounters)伺服器上。</span><span class="sxs-lookup"><span data-stu-id="58bb7-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="58bb7-126">如果您的應用程式在 Azure 上執行，請參閱[Azure Web 角色中使用 SignalR 效能計數器](using-signalr-performance-counters-in-an-azure-web-role.md)。</span><span class="sxs-lookup"><span data-stu-id="58bb7-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="58bb7-127">一旦您已下載和建置程式碼基底，並安裝在主機上的效能計數器，即使命令列工具位於`src\Microsoft.AspNet.SignalR.Crank\bin\Debug`資料夾。</span><span class="sxs-lookup"><span data-stu-id="58bb7-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="58bb7-128">可用的選項，即使工具包括：</span><span class="sxs-lookup"><span data-stu-id="58bb7-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="58bb7-129">**/?**:顯示說明畫面。</span><span class="sxs-lookup"><span data-stu-id="58bb7-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="58bb7-130">可用的選項也會顯示如果**Url**省略參數。</span><span class="sxs-lookup"><span data-stu-id="58bb7-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="58bb7-131">**/ Url**:SignalR 連線的 URL。</span><span class="sxs-lookup"><span data-stu-id="58bb7-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="58bb7-132">這是必要參數。</span><span class="sxs-lookup"><span data-stu-id="58bb7-132">This parameter is required.</span></span> <span data-ttu-id="58bb7-133">SignalR 應用程式中使用預設的對應，路徑的結尾是"/ signalr"。</span><span class="sxs-lookup"><span data-stu-id="58bb7-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="58bb7-134">**/ 傳輸**:使用的傳輸名稱。</span><span class="sxs-lookup"><span data-stu-id="58bb7-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="58bb7-135">預設值是`auto`，這將會選取最適合可用的通訊協定。</span><span class="sxs-lookup"><span data-stu-id="58bb7-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="58bb7-136">選項包括`WebSockets`， `ServerSentEvents`，並`LongPolling`(`ForeverFrame`不可行的曲柄，因為.NET 用戶端而不是使用 Internet Explorer)。</span><span class="sxs-lookup"><span data-stu-id="58bb7-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="58bb7-137">如需有關如何 SignalR 選取傳輸的詳細資訊，請參閱[傳輸和後援](../getting-started/introduction-to-signalr.md#transports)。</span><span class="sxs-lookup"><span data-stu-id="58bb7-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="58bb7-138">**/ BatchSize**:在每個批次中加入的用戶端數目。</span><span class="sxs-lookup"><span data-stu-id="58bb7-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="58bb7-139">預設值為 50。</span><span class="sxs-lookup"><span data-stu-id="58bb7-139">The default is 50.</span></span>
- <span data-ttu-id="58bb7-140">**/ ConnectInterval**:間隔 （毫秒） 之間加入連接。</span><span class="sxs-lookup"><span data-stu-id="58bb7-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="58bb7-141">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="58bb7-141">The default is 500.</span></span>
- <span data-ttu-id="58bb7-142">**/ 連線**:用於負載測試應用程式的連線數目。</span><span class="sxs-lookup"><span data-stu-id="58bb7-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="58bb7-143">預設值是 100,000。</span><span class="sxs-lookup"><span data-stu-id="58bb7-143">The default is 100,000.</span></span>
- <span data-ttu-id="58bb7-144">**/ ConnectTimeout**:逾時中止測試之前的秒數。</span><span class="sxs-lookup"><span data-stu-id="58bb7-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="58bb7-145">預設值為 300。</span><span class="sxs-lookup"><span data-stu-id="58bb7-145">The default is 300.</span></span>
- <span data-ttu-id="58bb7-146">**MinServerMBytes**:若要觸達的最小伺服器 mb 為單位。</span><span class="sxs-lookup"><span data-stu-id="58bb7-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="58bb7-147">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="58bb7-147">The default is 500.</span></span>
- <span data-ttu-id="58bb7-148">**SendBytes**:裝載傳送至伺服器，以位元組為單位的大小。</span><span class="sxs-lookup"><span data-stu-id="58bb7-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="58bb7-149">預設值為 0。</span><span class="sxs-lookup"><span data-stu-id="58bb7-149">The default is 0.</span></span>
- <span data-ttu-id="58bb7-150">**SendInterval**:以毫秒為單位，到伺服器的訊息之間的延遲。</span><span class="sxs-lookup"><span data-stu-id="58bb7-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="58bb7-151">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="58bb7-151">The default is 500.</span></span>
- <span data-ttu-id="58bb7-152">**SendTimeout**:以毫秒為單位的訊息至伺服器逾時。</span><span class="sxs-lookup"><span data-stu-id="58bb7-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="58bb7-153">預設值為 300。</span><span class="sxs-lookup"><span data-stu-id="58bb7-153">The default is 300.</span></span>
- <span data-ttu-id="58bb7-154">**ControllerUrl**:其中一部用戶端將裝載控制站中樞 Url。</span><span class="sxs-lookup"><span data-stu-id="58bb7-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="58bb7-155">預設值是 null （無中樞控制站）。</span><span class="sxs-lookup"><span data-stu-id="58bb7-155">The default is null (no controller hub).</span></span> <span data-ttu-id="58bb7-156">即使工作階段啟動; 時，控制器中樞已啟動沒有進一步中樞控制站與區軸之間的連絡方式為。</span><span class="sxs-lookup"><span data-stu-id="58bb7-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="58bb7-157">**NumClients**:模擬用戶端連線到應用程式數目。</span><span class="sxs-lookup"><span data-stu-id="58bb7-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="58bb7-158">的預設值是 1。</span><span class="sxs-lookup"><span data-stu-id="58bb7-158">The default is one.</span></span>
- <span data-ttu-id="58bb7-159">**Logfile**:測試回合記錄檔的檔名。</span><span class="sxs-lookup"><span data-stu-id="58bb7-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="58bb7-160">預設為 `crank.csv`。</span><span class="sxs-lookup"><span data-stu-id="58bb7-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="58bb7-161">**SampleInterval**:時間 （毫秒） 效能計數器樣本之間。</span><span class="sxs-lookup"><span data-stu-id="58bb7-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="58bb7-162">預設值為 1000。</span><span class="sxs-lookup"><span data-stu-id="58bb7-162">The default is 1000.</span></span>
- <span data-ttu-id="58bb7-163">**SignalRInstance**:在伺服器上的效能計數器執行個體名稱。</span><span class="sxs-lookup"><span data-stu-id="58bb7-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="58bb7-164">預設值是使用用戶端連線狀態。</span><span class="sxs-lookup"><span data-stu-id="58bb7-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="58bb7-165">範例</span><span class="sxs-lookup"><span data-stu-id="58bb7-165">Example</span></span>

<span data-ttu-id="58bb7-166">下列命令會測試網站，稱為`pfsignalr`在 Azure 上裝載使用名為"ControllerHub 」 中樞的連接埠 8080 上的應用程式，使用 100 個連接。</span><span class="sxs-lookup"><span data-stu-id="58bb7-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
