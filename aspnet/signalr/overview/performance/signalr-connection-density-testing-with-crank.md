---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: 使用迅速地建立 SignalR 連接密度測試 |Microsoft Docs
author: bradygaster
description: 使用曲軸的 SignalR 連線密度測試
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: 901e039fbb81651ed18d560c99745b7e7f716e01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78558335"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="4e8d2-103">使用曲軸的 SignalR 連線密度測試</span><span class="sxs-lookup"><span data-stu-id="4e8d2-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="4e8d2-104">由[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="4e8d2-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="4e8d2-105">本文說明如何使用迅速地建立工具來測試具有多個模擬用戶端的應用程式。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>

<span data-ttu-id="4e8d2-106">當您的應用程式在其主控環境（Azure web 角色、IIS 或使用 Owin 的自我裝載）中執行之後，您就可以使用迅速地建立工具來測試應用程式對高階連接密度的回應。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="4e8d2-107">裝載環境可以是 Internet Information Services （IIS）伺服器、Owin 主機或 Azure web 角色。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="4e8d2-108">（注意：效能計數器無法在 Azure App Service Web Apps 上使用，因此您將無法從連接密度測試取得效能資料）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="4e8d2-109">連接密度是指可以在伺服器上建立的同時 TCP 連線數目。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="4e8d2-110">每個 TCP 連線都會產生自己的額外負荷，而開啟大量的閒置連線最後會造成記憶體瓶頸。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="4e8d2-111">[SignalR 程式碼基](https://github.com/signalr/signalr)底包含一個稱為**迅速地建立**的負載測試工具。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="4e8d2-112">您可以在 GitHub 上[的 Dev 分支](https://github.com/SignalR/signalr/tree/dev)中找到最新版本的迅速地建立。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="4e8d2-113">您可以在[這裡](https://github.com/SignalR/SignalR/archive/dev.zip)下載 SignalR 程式碼基底之 Dev 分支的 Zip 封存。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="4e8d2-114">迅速地建立可以用來完全使伺服器的記憶體飽和，以便計算伺服器硬體上可能的閒置連接總數。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="4e8d2-115">或者，您也可以使用迅速地建立，在特定的記憶體不足壓力之下，將伺服器負載測試，方法是在達到特定的計數或特定的記憶體閾值之前，先加速連接。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="4e8d2-116">測試時，請務必使用遠端用戶端，以避免任何資源競爭（例如 TCP 連線和記憶體）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="4e8d2-117">監視用戶端，以確保它們不會遇到任何可能導致伺服器無法達到其完整容量（記憶體或 CPU）的瓶頸。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="4e8d2-118">您可能需要增加用戶端數目，才能完全載入伺服器。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="4e8d2-119">執行連接密度測試</span><span class="sxs-lookup"><span data-stu-id="4e8d2-119">Running a Connection Density Test</span></span>

<span data-ttu-id="4e8d2-120">本節說明在 SignalR 應用程式上執行連接密度測試所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="4e8d2-121">下載並建立[SignalR 程式碼基底的開發分支](https://github.com/SignalR/SignalR/archive/dev.zip)。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="4e8d2-122">在命令提示字元中，流覽至 &lt;專案目錄&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="4e8d2-123">將您的應用程式部署到其預定的裝載環境。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="4e8d2-124">記下您的應用程式所使用的端點;例如，在[消費者入門教學](../getting-started/tutorial-getting-started-with-signalr.md)課程中建立的應用程式中，端點會 `http://<yourhost>:8080/signalr`。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="4e8d2-125">在伺服器上安裝[SignalR 效能計數器](signalr-performance.md#perfcounters)。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="4e8d2-126">如果您的應用程式正在 Azure 上執行，請參閱[在 Azure Web 角色中使用 SignalR 效能計數器](using-signalr-performance-counters-in-an-azure-web-role.md)。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="4e8d2-127">在您下載並建立程式碼基底，並在您的主機上安裝效能計數器之後，您可以在 [`src\Microsoft.AspNet.SignalR.Crank\bin\Debug`] 資料夾中找到迅速地建立命令列工具。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="4e8d2-128">迅速地建立工具的可用選項包括：</span><span class="sxs-lookup"><span data-stu-id="4e8d2-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="4e8d2-129">**/？** ：顯示說明畫面。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="4e8d2-130">如果省略**Url**參數，也會顯示可用的選項。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="4e8d2-131">**/Url**： SignalR 連接的 Url。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="4e8d2-132">這是必要參數。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-132">This parameter is required.</span></span> <span data-ttu-id="4e8d2-133">若為使用預設對應的 SignalR 應用程式，路徑的結尾會是 "/signalr"。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="4e8d2-134">**/傳輸**：所使用的傳輸名稱。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="4e8d2-135">預設值為 [`auto`]，這會選取最佳的可用通訊協定。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="4e8d2-136">選項包括 `WebSockets`、`ServerSentEvents`和 `LongPolling` （`ForeverFrame` 不是迅速地建立的選項，因為會使用 .NET 用戶端，而不是 Internet Explorer）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="4e8d2-137">如需 SignalR 如何選取傳輸的詳細資訊，請參閱[傳輸和回退](../getting-started/introduction-to-signalr.md#transports)。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="4e8d2-138">**/BatchSize**：每個批次中新增的用戶端數目。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="4e8d2-139">預設值為 50。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-139">The default is 50.</span></span>
- <span data-ttu-id="4e8d2-140">**/ConnectInterval**：新增連接之間的間隔（以毫秒為單位）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="4e8d2-141">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-141">The default is 500.</span></span>
- <span data-ttu-id="4e8d2-142">**/Connections**：用來對應用程式進行負載測試的連接數目。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="4e8d2-143">預設值為100000。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-143">The default is 100,000.</span></span>
- <span data-ttu-id="4e8d2-144">**/ConnectTimeout**：中止測試之前的超時（以秒為單位）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="4e8d2-145">預設值為300。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-145">The default is 300.</span></span>
- <span data-ttu-id="4e8d2-146">**MinServerMBytes**：到達的最小伺服器 mb。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="4e8d2-147">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-147">The default is 500.</span></span>
- <span data-ttu-id="4e8d2-148">**SendBytes**：傳送至伺服器的承載大小（以位元組為單位）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="4e8d2-149">預設值為 0。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-149">The default is 0.</span></span>
- <span data-ttu-id="4e8d2-150">**SendInterval**：訊息到伺服器之間的延遲（以毫秒為單位）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="4e8d2-151">預設值為 500。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-151">The default is 500.</span></span>
- <span data-ttu-id="4e8d2-152">**SendTimeout**：訊息到伺服器的超時時間（以毫秒為單位）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="4e8d2-153">預設值為300。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-153">The default is 300.</span></span>
- <span data-ttu-id="4e8d2-154">**ControllerUrl**：一個用戶端將裝載控制器中樞的 Url。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="4e8d2-155">預設值為 null （不控制器中樞）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-155">The default is null (no controller hub).</span></span> <span data-ttu-id="4e8d2-156">當迅速地建立會話啟動時，就會啟動控制器中樞;控制器中樞與迅速地建立之間沒有進一步的連絡人。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="4e8d2-157">**NumClients**：要連接到應用程式的模擬用戶端數目。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="4e8d2-158">預設值為一個。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-158">The default is one.</span></span>
- <span data-ttu-id="4e8d2-159">**Logfile**：用於測試回合之記錄檔的檔案名。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="4e8d2-160">預設為 `crank.csv`。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="4e8d2-161">**SampleInterval**：效能計數器樣本之間的時間（以毫秒為單位）。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="4e8d2-162">預設值為 1000。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-162">The default is 1000.</span></span>
- <span data-ttu-id="4e8d2-163">**SignalRInstance**：伺服器上效能計數器的實例名稱。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="4e8d2-164">預設值是使用用戶端線上狀態。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="4e8d2-165">範例</span><span class="sxs-lookup"><span data-stu-id="4e8d2-165">Example</span></span>

<span data-ttu-id="4e8d2-166">下列命令會在 Azure 上測試名為 `pfsignalr` 的網站，其裝載在埠8080上的應用程式，並使用名為 "ControllerHub" 的中樞，並使用100連接。</span><span class="sxs-lookup"><span data-stu-id="4e8d2-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
