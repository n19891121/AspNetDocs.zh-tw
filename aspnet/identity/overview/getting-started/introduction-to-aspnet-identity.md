---
uid: identity/overview/getting-started/introduction-to-aspnet-identity
title: ASP.NET Identity 的簡介-ASP.NET 4。x
author: jongalloway
description: ASP.NET 成員資格系統是以2005中的 ASP.NET 2.0 引進，因為 web 應用程式通常的方式已有許多變更 。
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 38717fc1-5989-43cf-952d-4007cc1dd923
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/introduction-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 0268dfc16cd2cfb1e79ee14997a4c5eb247af950
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78583843"
---
# <a name="introduction-to-aspnet-identity"></a><span data-ttu-id="6f64c-103">ASP.NET Identity 簡介</span><span class="sxs-lookup"><span data-stu-id="6f64c-103">Introduction to ASP.NET Identity</span></span>

> <span data-ttu-id="6f64c-104">ASP.NET 成員資格系統是以2005中的 ASP.NET 2.0 引進，既然 web 應用程式通常處理驗證和授權的方式有許多變更。</span><span class="sxs-lookup"><span data-stu-id="6f64c-104">The ASP.NET membership system was introduced with ASP.NET 2.0 back in 2005, and since then there have been many changes in the ways web applications typically handle authentication and authorization.</span></span> <span data-ttu-id="6f64c-105">ASP.NET Identity 是建立 web、手機或平板電腦的現代化應用程式時，成員資格系統的新外觀。</span><span class="sxs-lookup"><span data-stu-id="6f64c-105">ASP.NET Identity is a fresh look at what the membership system should be when you are building modern applications for the web, phone, or tablet.</span></span>

## <a name="background-membership-in-aspnet"></a><span data-ttu-id="6f64c-106">背景： ASP.NET 中的成員資格</span><span class="sxs-lookup"><span data-stu-id="6f64c-106">Background: Membership in ASP.NET</span></span>

### <a name="aspnet-membership"></a><span data-ttu-id="6f64c-107">ASP.NET 成員資格</span><span class="sxs-lookup"><span data-stu-id="6f64c-107">ASP.NET Membership</span></span>

<span data-ttu-id="6f64c-108">[ASP.NET 成員資格](https://msdn.microsoft.com/library/yh26yfzy(v=VS.100).aspx)的設計目的是要解決2005中常見的網站成員資格需求，包括表單驗證，以及使用者名稱、密碼和設定檔資料的 SQL Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="6f64c-108">[ASP.NET Membership](https://msdn.microsoft.com/library/yh26yfzy(v=VS.100).aspx) was designed to solve site membership requirements that were common in 2005, which involved Forms Authentication, and a SQL Server database for user names, passwords, and profile data.</span></span> <span data-ttu-id="6f64c-109">現今 web 應用程式有更廣泛的資料儲存選項，而且大部分的開發人員都想要讓其網站使用社交識別提供者來進行驗證和授權功能。</span><span class="sxs-lookup"><span data-stu-id="6f64c-109">Today there is a much broader array of data storage options for web applications, and most developers want to enable their sites to use social identity providers for authentication and authorization functionality.</span></span> <span data-ttu-id="6f64c-110">ASP.NET 成員資格設計的限制使得這項轉換變得很棘手：</span><span class="sxs-lookup"><span data-stu-id="6f64c-110">The limitations of ASP.NET Membership's design make this transition difficult:</span></span>

- <span data-ttu-id="6f64c-111">資料庫架構是針對 SQL Server 所設計，而且您無法變更它。</span><span class="sxs-lookup"><span data-stu-id="6f64c-111">The database schema was designed for SQL Server and you can't change it.</span></span> <span data-ttu-id="6f64c-112">您可以新增設定檔資訊，但額外的資料會封裝到不同的資料表中，讓您難以透過設定檔提供者 API 以外的任何方式存取。</span><span class="sxs-lookup"><span data-stu-id="6f64c-112">You can add profile information, but the additional data is packed into a different table, which makes it difficult to access by any means except through the Profile Provider API.</span></span>
- <span data-ttu-id="6f64c-113">提供者系統可讓您變更支援資料存放區，但系統是設計成適用于關係資料庫的假設。</span><span class="sxs-lookup"><span data-stu-id="6f64c-113">The provider system enables you to change the backing data store, but the system is designed around assumptions appropriate for a relational database.</span></span> <span data-ttu-id="6f64c-114">您可以撰寫提供者以在非關聯式儲存機制（例如 Azure 儲存體資料表）中儲存成員資格資訊，但是您必須針對不適用於 NoSQL 資料庫的方法撰寫大量程式碼和許多 `System.NotImplementedException` 例外狀況，以解決關聯式設計。</span><span class="sxs-lookup"><span data-stu-id="6f64c-114">You can write a provider to store membership information in a non-relational storage mechanism, such as Azure Storage Tables, but then you have to work around the relational design by writing much code and a lot of `System.NotImplementedException` exceptions for methods that don't apply to NoSQL databases.</span></span>
- <span data-ttu-id="6f64c-115">由於登入/登出功能是以表單驗證為基礎，因此成員資格系統無法使用[OWIN](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md)。</span><span class="sxs-lookup"><span data-stu-id="6f64c-115">Since the log-in/log-out functionality is based on Forms Authentication, the membership system can't use [OWIN](../../../aspnet/overview/owin-and-katana/an-overview-of-project-katana.md).</span></span> <span data-ttu-id="6f64c-116">OWIN 包含用於驗證的中介軟體元件，包括使用外部身分識別提供者（例如 Microsoft 帳戶、Facebook、Google、Twitter）的登入支援，以及使用內部部署 Active Directory 或的組織帳戶登入。Azure Active Directory。</span><span class="sxs-lookup"><span data-stu-id="6f64c-116">OWIN includes middleware components for authentication, including support for log-ins using external identity providers (like Microsoft Accounts, Facebook, Google, Twitter), and log-ins using organizational accounts from on-premises Active Directory or Azure Active Directory.</span></span> <span data-ttu-id="6f64c-117">OWIN 也包含 OAuth 2.0、JWT 和 CORS 的支援。</span><span class="sxs-lookup"><span data-stu-id="6f64c-117">OWIN also includes support for OAuth 2.0, JWT and CORS.</span></span>

### <a name="aspnet-simple-membership"></a><span data-ttu-id="6f64c-118">ASP.NET 簡單成員資格</span><span class="sxs-lookup"><span data-stu-id="6f64c-118">ASP.NET Simple Membership</span></span>

<span data-ttu-id="6f64c-119">[ASP.NET 簡單成員資格](../../../web-pages/overview/security/16-adding-security-and-membership.md)的開發是做為 ASP.NET Web Pages 的成員資格系統。</span><span class="sxs-lookup"><span data-stu-id="6f64c-119">[ASP.NET simple membership](../../../web-pages/overview/security/16-adding-security-and-membership.md) was developed as a membership system for ASP.NET Web Pages.</span></span> <span data-ttu-id="6f64c-120">其發行于 WebMatrix 和 Visual Studio 2010 SP1。</span><span class="sxs-lookup"><span data-stu-id="6f64c-120">It was released with WebMatrix and Visual Studio 2010 SP1.</span></span> <span data-ttu-id="6f64c-121">簡單成員資格的目標是要讓您輕鬆地將成員資格功能加入網頁應用程式中。</span><span class="sxs-lookup"><span data-stu-id="6f64c-121">The goal of Simple Membership was to make it easy to add membership functionality to a Web Pages application.</span></span>

<span data-ttu-id="6f64c-122">簡單成員資格可讓您更輕鬆地自訂使用者設定檔資訊，但它仍會與 ASP.NET 成員資格分享其他問題，而且有一些限制：</span><span class="sxs-lookup"><span data-stu-id="6f64c-122">Simple Membership did make it easier to customize user profile information, but it still shares the other problems with ASP.NET Membership, and it has some limitations:</span></span>

- <span data-ttu-id="6f64c-123">很難將成員資格系統資料保存在非關聯式存放區中。</span><span class="sxs-lookup"><span data-stu-id="6f64c-123">It was hard to persist membership system data in a non-relational store.</span></span>
- <span data-ttu-id="6f64c-124">您無法搭配 OWIN 使用它。</span><span class="sxs-lookup"><span data-stu-id="6f64c-124">You can't use it with OWIN.</span></span>
- <span data-ttu-id="6f64c-125">它無法與現有的 ASP.NET 成員資格提供者搭配運作，而且無法擴充。</span><span class="sxs-lookup"><span data-stu-id="6f64c-125">It doesn't work well with existing ASP.NET Membership providers, and it's not extensible.</span></span>

### <a name="aspnet-universal-providers"></a><span data-ttu-id="6f64c-126">ASP.NET Universal Providers</span><span class="sxs-lookup"><span data-stu-id="6f64c-126">ASP.NET Universal Providers</span></span>

<span data-ttu-id="6f64c-127">[ASP.NET Universal Providers](http://www.hanselman.com/blog/IntroducingSystemWebProvidersASPNETUniversalProvidersForSessionMembershipRolesAndUserProfileOnSQLCompactAndSQLAzure.aspx)的開發目的是要讓您能夠在 Microsoft Azure SQL Database 中保存成員資格資訊，而且也可以與 SQL Server Compact 搭配使用。</span><span class="sxs-lookup"><span data-stu-id="6f64c-127">[ASP.NET Universal Providers](http://www.hanselman.com/blog/IntroducingSystemWebProvidersASPNETUniversalProvidersForSessionMembershipRolesAndUserProfileOnSQLCompactAndSQLAzure.aspx) were developed to make it possible to persist membership information in Microsoft Azure SQL Database, and they also work with SQL Server Compact.</span></span> <span data-ttu-id="6f64c-128">Universal Providers 是以 Entity Framework Code First 為基礎，這表示 Universal Providers 可用來保存 EF 支援的任何存放區中的資料。</span><span class="sxs-lookup"><span data-stu-id="6f64c-128">The Universal Providers were built on Entity Framework Code First, which means that the Universal Providers can be used to persist data in any store supported by EF.</span></span> <span data-ttu-id="6f64c-129">在 Universal Providers 中，資料庫架構也會一併清除。</span><span class="sxs-lookup"><span data-stu-id="6f64c-129">With the Universal Providers, the database schema was cleaned up quite a lot as well.</span></span>

<span data-ttu-id="6f64c-130">Universal Providers 是建置於 ASP.NET 成員資格基礎結構上，因此它們仍然具有與 SqlMembership 提供者相同的限制。</span><span class="sxs-lookup"><span data-stu-id="6f64c-130">The Universal Providers are built on the ASP.NET Membership infrastructure, so they still carry the same limitations as the SqlMembership Provider.</span></span> <span data-ttu-id="6f64c-131">也就是說，它們是針對關係資料庫所設計，而且很難自訂設定檔和使用者資訊。</span><span class="sxs-lookup"><span data-stu-id="6f64c-131">That is, they were designed for relational databases and it's hard to customize profile and user information.</span></span> <span data-ttu-id="6f64c-132">這些提供者也仍然會使用表單驗證來登入和登出功能。</span><span class="sxs-lookup"><span data-stu-id="6f64c-132">These providers also still use Forms Authentication for sign-in and sign-out functionality.</span></span>

## <a name="aspnet-identity"></a><span data-ttu-id="6f64c-133">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="6f64c-133">ASP.NET Identity</span></span>

<span data-ttu-id="6f64c-134">隨著 ASP.NET 的成員故事演變多年，ASP.NET 團隊也從客戶的意見反應中學到了許多。</span><span class="sxs-lookup"><span data-stu-id="6f64c-134">As the membership story in ASP.NET has evolved over the years, the ASP.NET team has learned a lot from feedback from customers.</span></span>

<span data-ttu-id="6f64c-135">假設使用者會藉由輸入使用者名稱和密碼來登入，其已在您自己的應用程式中註冊，將不再有效。</span><span class="sxs-lookup"><span data-stu-id="6f64c-135">The assumption that users will sign in by entering a user name and password that they have registered in your own application is no longer valid.</span></span> <span data-ttu-id="6f64c-136">Web 已經變得越來越社交。</span><span class="sxs-lookup"><span data-stu-id="6f64c-136">The web has become more social.</span></span> <span data-ttu-id="6f64c-137">使用者透過社交管道（例如 Facebook、Twitter 和其他社交網站）即時與他人互動。</span><span class="sxs-lookup"><span data-stu-id="6f64c-137">Users are interacting with each other in real time through social channels such as Facebook, Twitter, and other social web sites.</span></span> <span data-ttu-id="6f64c-138">開發人員想要讓使用者能夠使用他們的社交身分識別登入，讓他們能夠在他們的網站上擁有豐富的體驗。</span><span class="sxs-lookup"><span data-stu-id="6f64c-138">Developers want users to be able to sign in with their social identities so that they can have a rich experience on their web sites.</span></span> <span data-ttu-id="6f64c-139">現代化的成員資格系統必須啟用以重新導向為基礎的登入，以驗證提供者（例如 Facebook、Twitter 等等）。</span><span class="sxs-lookup"><span data-stu-id="6f64c-139">A modern membership system must enable redirection-based log-ins to authentication providers such as Facebook, Twitter, and others.</span></span>

<span data-ttu-id="6f64c-140">隨著 網頁程式開發的發展，網頁程式開發的模式也是如此。</span><span class="sxs-lookup"><span data-stu-id="6f64c-140">As web development evolved, so did the patterns of web development.</span></span> <span data-ttu-id="6f64c-141">應用程式程式碼的單元測試已成為應用程式開發人員的核心考慮。</span><span class="sxs-lookup"><span data-stu-id="6f64c-141">Unit testing of application code became a core concern for application developers.</span></span> <span data-ttu-id="6f64c-142">在2008中，ASP.NET 新增了以模型視圖控制器（MVC）模式為基礎的新架構，部分是為了協助開發人員建立可測試單元的 ASP.NET 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6f64c-142">In 2008 ASP.NET added a new framework based on the Model-View-Controller (MVC) pattern, in part to help developers build unit testable ASP.NET applications.</span></span> <span data-ttu-id="6f64c-143">想要對其應用程式邏輯進行單元測試的開發人員，也想要能夠使用成員資格系統來執行此動作。</span><span class="sxs-lookup"><span data-stu-id="6f64c-143">Developers who wanted to unit test their application logic also wanted to be able to do that with the membership system.</span></span>

<span data-ttu-id="6f64c-144">在 web 應用程式開發中考慮這些變更，ASP.NET Identity 是以下列目標進行開發：</span><span class="sxs-lookup"><span data-stu-id="6f64c-144">Considering these changes in web application development, ASP.NET Identity was developed with the following goals:</span></span>

- <span data-ttu-id="6f64c-145">**一個 ASP.NET Identity 系統**</span><span class="sxs-lookup"><span data-stu-id="6f64c-145">**One ASP.NET Identity system**</span></span>

    - <span data-ttu-id="6f64c-146">ASP.NET Identity 可以與所有 ASP.NET 架構搭配使用，例如 ASP.NET MVC、Web Forms、Web Pages、Web API 和 SignalR。</span><span class="sxs-lookup"><span data-stu-id="6f64c-146">ASP.NET Identity can be used with all of the ASP.NET frameworks, such as ASP.NET MVC, Web Forms, Web Pages, Web API, and SignalR.</span></span>
    - <span data-ttu-id="6f64c-147">當您建立 web、手機、商店或混合式應用程式時，可以使用 ASP.NET Identity。</span><span class="sxs-lookup"><span data-stu-id="6f64c-147">ASP.NET Identity can be used when you are building web, phone, store, or hybrid applications.</span></span>
- <span data-ttu-id="6f64c-148">**輕鬆插入使用者的設定檔資料**</span><span class="sxs-lookup"><span data-stu-id="6f64c-148">**Ease of plugging in profile data about the user**</span></span>

    - <span data-ttu-id="6f64c-149">您可以控制使用者和設定檔資訊的架構。</span><span class="sxs-lookup"><span data-stu-id="6f64c-149">You have control over the schema of user and profile information.</span></span> <span data-ttu-id="6f64c-150">例如，您可以輕鬆地讓系統儲存使用者在您的應用程式中註冊帳戶時所輸入的出生日期。</span><span class="sxs-lookup"><span data-stu-id="6f64c-150">For example, you can easily enable the system to store birth dates entered by users when they register an account in your application.</span></span>

- <span data-ttu-id="6f64c-151">**持續性控制**</span><span class="sxs-lookup"><span data-stu-id="6f64c-151">**Persistence control**</span></span>

    - <span data-ttu-id="6f64c-152">根據預設，ASP.NET Identity 系統會將所有使用者資訊儲存在資料庫中。</span><span class="sxs-lookup"><span data-stu-id="6f64c-152">By default, the ASP.NET Identity system stores all the user information in a database.</span></span> <span data-ttu-id="6f64c-153">ASP.NET Identity 使用 Entity Framework Code First 來執行其所有持續性機制。</span><span class="sxs-lookup"><span data-stu-id="6f64c-153">ASP.NET Identity uses Entity Framework Code First to implement all of its persistence mechanism.</span></span>
    - <span data-ttu-id="6f64c-154">由於您控制了資料庫架構，因此變更資料表名稱或變更主鍵資料類型的一般工作很簡單。</span><span class="sxs-lookup"><span data-stu-id="6f64c-154">Since you control the database schema, common tasks such as changing table names or changing the data type of primary keys is simple to do.</span></span>
    - <span data-ttu-id="6f64c-155">您可以輕鬆地插入不同的儲存機制，例如 SharePoint、Azure 儲存體資料表服務、NoSQL 資料庫等，而不需要擲回 `System.NotImplementedExceptions` 例外狀況。</span><span class="sxs-lookup"><span data-stu-id="6f64c-155">It's easy to plug in different storage mechanisms such as SharePoint, Azure Storage Table Service, NoSQL databases, etc., without having to throw `System.NotImplementedExceptions` exceptions.</span></span>
- <span data-ttu-id="6f64c-156">**單元可測試性**</span><span class="sxs-lookup"><span data-stu-id="6f64c-156">**Unit testability**</span></span>

    - <span data-ttu-id="6f64c-157">ASP.NET Identity 讓 web 應用程式更能進行單元測試。</span><span class="sxs-lookup"><span data-stu-id="6f64c-157">ASP.NET Identity makes the web application more unit testable.</span></span> <span data-ttu-id="6f64c-158">您可以為使用 ASP.NET Identity 之應用程式的元件撰寫單元測試。</span><span class="sxs-lookup"><span data-stu-id="6f64c-158">You can write unit tests for the parts of your application that use ASP.NET Identity.</span></span>
- <span data-ttu-id="6f64c-159">**角色提供者**</span><span class="sxs-lookup"><span data-stu-id="6f64c-159">**Role provider**</span></span>

    - <span data-ttu-id="6f64c-160">有一個角色提供者，可讓您依角色限制存取應用程式的某些部分。</span><span class="sxs-lookup"><span data-stu-id="6f64c-160">There is a role provider which lets you restrict access to parts of your application by roles.</span></span> <span data-ttu-id="6f64c-161">您可以輕鬆地建立角色，例如 "Admin"，並將使用者新增至角色。</span><span class="sxs-lookup"><span data-stu-id="6f64c-161">You can easily create roles such as "Admin" and add users to roles.</span></span>
- <span data-ttu-id="6f64c-162">**以宣告為基礎**</span><span class="sxs-lookup"><span data-stu-id="6f64c-162">**Claims Based**</span></span>

    - <span data-ttu-id="6f64c-163">ASP.NET Identity 支援以宣告為基礎的驗證，其中使用者的身分識別會表示為一組宣告。</span><span class="sxs-lookup"><span data-stu-id="6f64c-163">ASP.NET Identity supports claims-based authentication, where the user's identity is represented as a set of claims.</span></span> <span data-ttu-id="6f64c-164">宣告可讓開發人員在描述使用者的身分識別時，比角色允許的更具表達性。</span><span class="sxs-lookup"><span data-stu-id="6f64c-164">Claims allow developers to be a lot more expressive in describing a user's identity than roles allow.</span></span> <span data-ttu-id="6f64c-165">角色成員資格只是布林值（成員或非成員），而宣告可以包含有關使用者身分識別和成員資格的豐富資訊。</span><span class="sxs-lookup"><span data-stu-id="6f64c-165">Whereas role membership is just a boolean (member or non-member), a claim can include rich information about the user's identity and membership.</span></span>
- <span data-ttu-id="6f64c-166">**社交登入提供者**</span><span class="sxs-lookup"><span data-stu-id="6f64c-166">**Social Login Providers**</span></span>

    - <span data-ttu-id="6f64c-167">您可以輕鬆地將社交記錄檔（例如 Microsoft 帳戶、Facebook、Twitter、Google 和其他人）新增至您的應用程式，並將使用者專屬的資料儲存在您的應用程式中。</span><span class="sxs-lookup"><span data-stu-id="6f64c-167">You can easily add social log-ins such as Microsoft Account, Facebook, Twitter, Google, and others to your application, and store the user-specific data in your application.</span></span>

- <span data-ttu-id="6f64c-168">**OWIN 整合**</span><span class="sxs-lookup"><span data-stu-id="6f64c-168">**OWIN Integration**</span></span>

    - <span data-ttu-id="6f64c-169">ASP.NET authentication 現在是以 OWIN 中介軟體為基礎，可用於任何以 OWIN 為基礎的主機。</span><span class="sxs-lookup"><span data-stu-id="6f64c-169">ASP.NET authentication is now based on OWIN middleware that can be used on any OWIN-based host.</span></span> <span data-ttu-id="6f64c-170">ASP.NET Identity 在 System.web 上沒有任何相依性。</span><span class="sxs-lookup"><span data-stu-id="6f64c-170">ASP.NET Identity does not have any dependency on System.Web.</span></span> <span data-ttu-id="6f64c-171">它是完全相容的 OWIN 架構，可以在任何 OWIN 裝載的應用程式中使用。</span><span class="sxs-lookup"><span data-stu-id="6f64c-171">It is a fully compliant OWIN framework and can be used in any OWIN hosted application.</span></span>
    - <span data-ttu-id="6f64c-172">ASP.NET Identity 會針對網站中的使用者登入/登出，使用 OWIN Authentication。</span><span class="sxs-lookup"><span data-stu-id="6f64c-172">ASP.NET Identity uses OWIN Authentication for log-in/log-out of users in the web site.</span></span> <span data-ttu-id="6f64c-173">這表示，應用程式會使用 OWIN CookieAuthentication 來執行此動作，而不是使用 FormsAuthentication 來產生 cookie。</span><span class="sxs-lookup"><span data-stu-id="6f64c-173">This means that instead of using FormsAuthentication to generate the cookie, the application uses OWIN CookieAuthentication to do that.</span></span>
- <span data-ttu-id="6f64c-174">**NuGet 套件**</span><span class="sxs-lookup"><span data-stu-id="6f64c-174">**NuGet package**</span></span>

    - <span data-ttu-id="6f64c-175">ASP.NET Identity 會轉散發為 NuGet 套件，並安裝在隨附于 Visual Studio 2017 的 ASP.NET MVC、Web Forms 和 Web API 範本中。</span><span class="sxs-lookup"><span data-stu-id="6f64c-175">ASP.NET Identity is redistributed as a NuGet package which is installed in the ASP.NET MVC, Web Forms and Web API templates that ship with Visual Studio 2017.</span></span> <span data-ttu-id="6f64c-176">您可以從 NuGet 資源庫下載此 NuGet 套件。</span><span class="sxs-lookup"><span data-stu-id="6f64c-176">You can download this NuGet package from the NuGet gallery.</span></span>
    - <span data-ttu-id="6f64c-177">將 ASP.NET Identity 發行為 NuGet 套件，可讓 ASP.NET 小組更輕鬆地反復執行新功能和 bug 修正，並以敏捷的方式將這些專案提供給開發人員。</span><span class="sxs-lookup"><span data-stu-id="6f64c-177">Releasing ASP.NET Identity as a NuGet package makes it easier for the ASP.NET team to iterate on new features and bug fixes, and deliver these to developers in an agile manner.</span></span>

## <a name="get-started-with-aspnet-identity"></a><span data-ttu-id="6f64c-178">開始使用 ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="6f64c-178">Get started with ASP.NET Identity</span></span>

<span data-ttu-id="6f64c-179">ASP.NET Identity 適用于 Visual Studio 2017 專案範本，用於 ASP.NET MVC、Web Forms、Web API 和 SPA。</span><span class="sxs-lookup"><span data-stu-id="6f64c-179">ASP.NET Identity is used in the Visual Studio 2017 project templates for ASP.NET MVC, Web Forms, Web API and SPA.</span></span> <span data-ttu-id="6f64c-180">在本逐步解說中，我們將說明專案範本如何使用 ASP.NET Identity 新增功能來註冊、登入和登出使用者。</span><span class="sxs-lookup"><span data-stu-id="6f64c-180">In this walkthrough, we'll illustrate how the project templates use ASP.NET Identity to add functionality to register, sign in and sign out a user.</span></span>

<span data-ttu-id="6f64c-181">使用下列程式來執行 ASP.NET Identity。</span><span class="sxs-lookup"><span data-stu-id="6f64c-181">ASP.NET Identity is implemented using the following procedure.</span></span> <span data-ttu-id="6f64c-182">本文的目的是要提供您 ASP.NET Identity 的高階總覽;您可以逐步執行，或直接閱讀詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6f64c-182">The purpose of this article is to give you a high level overview of ASP.NET Identity; you can follow it step by step or just read the details.</span></span> <span data-ttu-id="6f64c-183">如需使用 ASP.NET Identity 建立應用程式的詳細指示，包括使用新的 API 來新增使用者、角色和設定檔資訊，請參閱本文結尾處的後續步驟一節。</span><span class="sxs-lookup"><span data-stu-id="6f64c-183">For more detailed instructions on creating apps using ASP.NET Identity, including using the new API to add users, roles and profile information, see the Next Steps section at the end of this article.</span></span>

1. <span data-ttu-id="6f64c-184">建立具有個別帳戶的 ASP.NET MVC 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6f64c-184">Create an ASP.NET MVC application with Individual Accounts.</span></span> <span data-ttu-id="6f64c-185">您可以使用 ASP.NET MVC、Web Forms、Web API、SignalR 等中的 ASP.NET Identity。在本文中，我們將從 ASP.NET MVC 應用程式開始。</span><span class="sxs-lookup"><span data-stu-id="6f64c-185">You can use ASP.NET Identity in ASP.NET MVC, Web Forms, Web API, SignalR etc. In this article we will start with an ASP.NET MVC application.</span></span>  
  
    ![](introduction-to-aspnet-identity/_static/image1.png)
2. <span data-ttu-id="6f64c-186">建立的專案包含下列三個用於 ASP.NET Identity 的封裝。</span><span class="sxs-lookup"><span data-stu-id="6f64c-186">The created project contains the following three packages for ASP.NET Identity.</span></span>

    - [`Microsoft.AspNet.Identity.EntityFramework`](http://www.nuget.org/packages/Microsoft.AspNet.Identity.EntityFramework/)  
   <span data-ttu-id="6f64c-187">此封裝具有 ASP.NET Identity 的 Entity Framework 執行，將 ASP.NET Identity 資料和架構保存到 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="6f64c-187">This package has the Entity Framework implementation of ASP.NET Identity which will persist the ASP.NET Identity data and schema to SQL Server.</span></span>
    - [`Microsoft.AspNet.Identity.Core`](http://www.nuget.org/packages/Microsoft.AspNet.Identity.Core/)  
   <span data-ttu-id="6f64c-188">此套件具有 ASP.NET Identity 的核心介面。</span><span class="sxs-lookup"><span data-stu-id="6f64c-188">This package has the core interfaces for ASP.NET Identity.</span></span> <span data-ttu-id="6f64c-189">此套件可用於針對以不同持續性存放區（例如 Azure 表格儲存體、NoSQL 資料庫等）為目標的 ASP.NET Identity 撰寫執行。</span><span class="sxs-lookup"><span data-stu-id="6f64c-189">This package can be used to write an implementation for ASP.NET Identity that targets different persistence stores such as Azure Table Storage, NoSQL databases etc.</span></span>
    - [`Microsoft.AspNet.Identity.OWIN`](http://www.nuget.org/packages/Microsoft.AspNet.Identity.Owin/)  
   <span data-ttu-id="6f64c-190">此套件包含的功能，可用來在 ASP.NET 應用程式中使用 ASP.NET Identity 插入 OWIN authentication。</span><span class="sxs-lookup"><span data-stu-id="6f64c-190">This package contains functionality that is used to plug in OWIN authentication with ASP.NET Identity in ASP.NET applications.</span></span> <span data-ttu-id="6f64c-191">這是在您將登入功能新增至應用程式並呼叫 OWIN Cookie 驗證中介軟體來產生 Cookie 時使用。</span><span class="sxs-lookup"><span data-stu-id="6f64c-191">This is used when you add sign in functionality to your application and call into OWIN Cookie Authentication middleware to generate a cookie.</span></span>
3. <span data-ttu-id="6f64c-192">建立使用者。</span><span class="sxs-lookup"><span data-stu-id="6f64c-192">Creating a user.</span></span>  
   <span data-ttu-id="6f64c-193">啟動應用程式，然後按一下 [**註冊**] 連結來建立使用者。</span><span class="sxs-lookup"><span data-stu-id="6f64c-193">Launch the application and then click on the **Register** link to create a user.</span></span> <span data-ttu-id="6f64c-194">下圖顯示收集使用者名稱和密碼的 [註冊] 頁面。</span><span class="sxs-lookup"><span data-stu-id="6f64c-194">The following image shows the Register page that collects the user name and password.</span></span>  
  
    ![](introduction-to-aspnet-identity/_static/image2.png)  
  
   <span data-ttu-id="6f64c-195">當使用者選取 [**註冊**] 按鈕時，帳戶控制器的 [`Register`] 動作會藉由呼叫 ASP.NET Identity API 來建立使用者，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6f64c-195">When the user selects the **Register** button, the `Register` action of the Account controller creates the user by calling the ASP.NET Identity API, as highlighted below:</span></span>

    [!code-csharp[Main](introduction-to-aspnet-identity/samples/sample1.cs?highlight=8-9)]
4. <span data-ttu-id="6f64c-196">登入。</span><span class="sxs-lookup"><span data-stu-id="6f64c-196">Sign in.</span></span>  
   <span data-ttu-id="6f64c-197">如果成功建立使用者，她就會使用 `SignInAsync` 方法來登入。</span><span class="sxs-lookup"><span data-stu-id="6f64c-197">If the user was successfully created, she is signed in by the `SignInAsync` method.</span></span>  

    [!code-csharp[Main](introduction-to-aspnet-identity/samples/sample6.cs?highlight=12)]

   <span data-ttu-id="6f64c-198">`SignInManager.SignInAsync` 方法會產生[ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6f64c-198">The `SignInManager.SignInAsync` method generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="6f64c-199">由於 ASP.NET Identity 和 OWIN Cookie 驗證是以宣告為基礎的系統，因此架構會要求應用程式為使用者產生 ClaimsIdentity。</span><span class="sxs-lookup"><span data-stu-id="6f64c-199">Since ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a ClaimsIdentity for the user.</span></span> <span data-ttu-id="6f64c-200">ClaimsIdentity 包含使用者所有宣告的相關資訊，例如使用者所屬的角色。</span><span class="sxs-lookup"><span data-stu-id="6f64c-200">ClaimsIdentity has information about all the claims for the user, such as what roles the user belongs to.</span></span>   
 
5. <span data-ttu-id="6f64c-201">登出。</span><span class="sxs-lookup"><span data-stu-id="6f64c-201">Log off.</span></span>  
   <span data-ttu-id="6f64c-202">選取 [**登出**] 連結以呼叫帳戶控制器中的 [登出] 動作。</span><span class="sxs-lookup"><span data-stu-id="6f64c-202">Select the **Log off** link to call the LogOff action in the account controller.</span></span> 

    [!code-csharp[Main](introduction-to-aspnet-identity/samples/sample5.cs?highlight=6)]

   <span data-ttu-id="6f64c-203">上述反白顯示的程式碼顯示 OWIN `AuthenticationManager.SignOut` 方法。</span><span class="sxs-lookup"><span data-stu-id="6f64c-203">The highlighted code above shows the OWIN `AuthenticationManager.SignOut` method.</span></span> <span data-ttu-id="6f64c-204">這類似于 Web Forms 中[FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)模組所使用的[FormsAuthentication. SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="6f64c-204">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module in Web Forms.</span></span>

## <a name="components-of-aspnet-identity"></a><span data-ttu-id="6f64c-205">ASP.NET Identity 的元件</span><span class="sxs-lookup"><span data-stu-id="6f64c-205">Components of ASP.NET Identity</span></span>

<span data-ttu-id="6f64c-206">下圖顯示 ASP.NET Identity 系統的元件（請在[此](introduction-to-aspnet-identity/_static/image3.png)或圖表上選取以放大）。</span><span class="sxs-lookup"><span data-stu-id="6f64c-206">The diagram below shows the components of the ASP.NET Identity system (select on [this](introduction-to-aspnet-identity/_static/image3.png) or on the diagram to enlarge it).</span></span> <span data-ttu-id="6f64c-207">綠色的套件組成 ASP.NET Identity 系統。</span><span class="sxs-lookup"><span data-stu-id="6f64c-207">The packages in green make up the ASP.NET Identity system.</span></span> <span data-ttu-id="6f64c-208">所有其他的封裝都是在 ASP.NET 應用程式中使用 ASP.NET Identity 系統所需的相依性。</span><span class="sxs-lookup"><span data-stu-id="6f64c-208">All the other packages are dependencies which are needed to use the ASP.NET Identity system in ASP.NET applications.</span></span>

[![](introduction-to-aspnet-identity/_static/image5.png)](introduction-to-aspnet-identity/_static/image4.png)

<span data-ttu-id="6f64c-209">以下是先前未提及之 NuGet 套件的簡短說明：</span><span class="sxs-lookup"><span data-stu-id="6f64c-209">The following is a brief description of the NuGet packages not mentioned previously:</span></span>

- [<span data-ttu-id="6f64c-210">Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="6f64c-210">Microsoft.Owin.Security.Cookies</span></span>](http://www.nuget.org/packages/Microsoft.Owin.Security.Cookies/)  
 <span data-ttu-id="6f64c-211">可讓應用程式使用 cookie 型驗證的中介軟體，類似于 ASP。NET 的表單驗證。</span><span class="sxs-lookup"><span data-stu-id="6f64c-211">Middleware that enables an application to use cookie based authentication, similar to ASP.NET's Forms Authentication.</span></span>
- [<span data-ttu-id="6f64c-212">EntityFramework</span><span class="sxs-lookup"><span data-stu-id="6f64c-212">EntityFramework</span></span>](http://www.nuget.org/packages/EntityFramework/)  
 <span data-ttu-id="6f64c-213">Entity Framework 是 Microsoft 建議的關係資料庫資料存取技術。</span><span class="sxs-lookup"><span data-stu-id="6f64c-213">Entity Framework is Microsoft's recommended data access technology for relational databases.</span></span>

## <a name="migrating-from-membership-to-aspnet-identity"></a><span data-ttu-id="6f64c-214">從成員資格遷移至 ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="6f64c-214">Migrating from Membership to ASP.NET Identity</span></span>

<span data-ttu-id="6f64c-215">我們希望很快就能提供有關將使用 ASP.NET 成員資格或簡單成員資格的現有應用程式遷移至新 ASP.NET Identity 系統的指引。</span><span class="sxs-lookup"><span data-stu-id="6f64c-215">We hope to soon provide guidance on migrating your existing apps that use ASP.NET Membership or Simple Membership to the new ASP.NET Identity system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6f64c-216">後續步驟</span><span class="sxs-lookup"><span data-stu-id="6f64c-216">Next Steps</span></span>

- [<span data-ttu-id="6f64c-217">使用 Facebook 和 Google OAuth2 和 OpenID 登入建立 ASP.NET MVC 5 應用程式</span><span class="sxs-lookup"><span data-stu-id="6f64c-217">Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on</span></span>](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md)  
 <span data-ttu-id="6f64c-218">本教學課程使用 ASP.NET Identity API 將設定檔資訊新增至使用者資料庫，以及如何使用 Google 和 Facebook 進行驗證。</span><span class="sxs-lookup"><span data-stu-id="6f64c-218">The tutorial uses the ASP.NET Identity API to add profile information to the user database, and how to authenticate with Google and Facebook.</span></span>
- [<span data-ttu-id="6f64c-219">使用驗證和 SQL DB 建立 ASP.NET MVC 應用程式並部署至 Azure App Service</span><span class="sxs-lookup"><span data-stu-id="6f64c-219">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)  
 <span data-ttu-id="6f64c-220">本教學課程說明如何使用身分識別 API 來新增使用者和角色。</span><span class="sxs-lookup"><span data-stu-id="6f64c-220">This tutorial shows how to use the Identity API to add users and roles.</span></span>
- [https://github.com/rustd/AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample)  
 <span data-ttu-id="6f64c-221">範例應用程式，說明如何新增基本角色和使用者支援，以及如何執行角色和使用者管理。</span><span class="sxs-lookup"><span data-stu-id="6f64c-221">Sample application that shows how to add basic roles and user support and how to do roles and user management.</span></span>
