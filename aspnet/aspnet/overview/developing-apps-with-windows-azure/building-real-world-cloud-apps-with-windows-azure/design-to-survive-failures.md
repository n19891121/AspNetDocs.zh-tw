---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: 設計到存活的失敗（使用 Azure 建立真實世界的雲端應用程式） |Microsoft Docs
author: MikeWasson
description: 使用 Azure 電子書建立真實世界的雲端應用程式，是以 Scott Guthrie 所開發的簡報為基礎。 它會說明13個模式和實務，
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: 348232af531b5d53dc3cb46d6d2c7931d95a572d
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457124"
---
# <a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="b559c-104">設計到存活的失敗（使用 Azure 建立真實世界的雲端應用程式）</span><span class="sxs-lookup"><span data-stu-id="b559c-104">Design to Survive Failures (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="b559c-105">由[Mike Wasson](https://github.com/MikeWasson)， [Rick Anderson](https://twitter.com/RickAndMSFT)， [Tom 作者: dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b559c-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="b559c-106">[下載 Fix It 專案](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)或[下載電子書](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span><span class="sxs-lookup"><span data-stu-id="b559c-106">[Download Fix It Project](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) or [Download E-book](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span></span>

> <span data-ttu-id="b559c-107">**使用 Azure 電子書建立真實世界的雲端應用程式**，是以 Scott Guthrie 所開發的簡報為基礎。</span><span class="sxs-lookup"><span data-stu-id="b559c-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="b559c-108">其中說明13種模式和作法，可協助您成功開發雲端 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="b559c-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="b559c-109">如需電子書的相關資訊，請參閱[第一章](introduction.md)。</span><span class="sxs-lookup"><span data-stu-id="b559c-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="b559c-110">當您建立任何類型的應用程式時，必須考慮的其中一件事，特別是在雲端中執行時，有很多人將會用到它，這是如何設計應用程式，讓它能夠正常地處理失敗，並繼續傳遞最多的價值的話.</span><span class="sxs-lookup"><span data-stu-id="b559c-110">One of the things you have to think about when you build any type of application, but especially one that will run in the cloud where lots of people will be using it, is how to design the app so that it can gracefully handle failures and continue to deliver value as much as possible.</span></span> <span data-ttu-id="b559c-111">有足夠的時間，任何環境或任何軟體系統中的事情都會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="b559c-111">Given enough time, things are going to go wrong in any environment or any software system.</span></span> <span data-ttu-id="b559c-112">您的應用程式如何處理這些情況，會決定您的客戶將會如何取得，以及花多少時間來分析和修正問題。</span><span class="sxs-lookup"><span data-stu-id="b559c-112">How your app handles those situations determines how upset your customers will get and how much time you have to spend analyzing and fixing problems.</span></span>

## <a name="types-of-failures"></a><span data-ttu-id="b559c-113">失敗的類型</span><span class="sxs-lookup"><span data-stu-id="b559c-113">Types of failures</span></span>

<span data-ttu-id="b559c-114">您會想要以不同的方式處理失敗的兩個基本類別：</span><span class="sxs-lookup"><span data-stu-id="b559c-114">There are two basic categories of failures that you'll want to handle differently:</span></span>

- <span data-ttu-id="b559c-115">暫時性、自我修復的失敗，例如間歇性的網路連線問題。</span><span class="sxs-lookup"><span data-stu-id="b559c-115">Transient, self-healing failures such as intermittent network connectivity issues.</span></span>
- <span data-ttu-id="b559c-116">持續需要介入的失敗。</span><span class="sxs-lookup"><span data-stu-id="b559c-116">Enduring failures that require intervention.</span></span>

<span data-ttu-id="b559c-117">針對暫時性失敗，您可以執行重試原則，以確保應用程式在大部分的時間都能快速且自動復原。</span><span class="sxs-lookup"><span data-stu-id="b559c-117">For transient failures, you can implement a retry policy to ensure that most of the time the app recovers quickly and automatically.</span></span> <span data-ttu-id="b559c-118">您的客戶可能會注意到稍長的回應時間，否則不會受到影響。</span><span class="sxs-lookup"><span data-stu-id="b559c-118">Your customers might notice slightly longer response time, but otherwise they won't be affected.</span></span> <span data-ttu-id="b559c-119">在[暫時性錯誤處理一章](transient-fault-handling.md)中，我們將示範一些方法來處理這些錯誤。</span><span class="sxs-lookup"><span data-stu-id="b559c-119">We'll show some ways to handle these errors in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

<span data-ttu-id="b559c-120">針對持續失敗，您可以執行監視和記錄功能，以便在發生問題時立即通知您，並協助進行根本原因分析。</span><span class="sxs-lookup"><span data-stu-id="b559c-120">For enduring failures, you can implement monitoring and logging functionality that notifies you promptly when issues arise and that facilitates root cause analysis.</span></span> <span data-ttu-id="b559c-121">我們將示範一些方法，協助您在[監視和遙測一章](monitoring-and-telemetry.md)中隨時掌握這類錯誤。</span><span class="sxs-lookup"><span data-stu-id="b559c-121">We'll show some ways to help you stay on top of these kinds of errors in the [Monitoring and Telemetry chapter](monitoring-and-telemetry.md).</span></span>

## <a name="failure-scope"></a><span data-ttu-id="b559c-122">失敗範圍</span><span class="sxs-lookup"><span data-stu-id="b559c-122">Failure scope</span></span>

<span data-ttu-id="b559c-123">您也必須考慮失敗範圍–單一電腦是否受到影響、整個服務（例如 SQL Database 或儲存體）或整個區域。</span><span class="sxs-lookup"><span data-stu-id="b559c-123">You also have to think about failure scope – whether a single machine is affected, a whole service such as SQL Database or Storage, or an entire region.</span></span>

![失敗範圍](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a><span data-ttu-id="b559c-125">電腦失敗</span><span class="sxs-lookup"><span data-stu-id="b559c-125">Machine failures</span></span>

<span data-ttu-id="b559c-126">在 Azure 中，失敗的伺服器會自動取代為新的，而設計良好的雲端應用程式會自動且快速地從這類失敗中復原。</span><span class="sxs-lookup"><span data-stu-id="b559c-126">In Azure, a failed server is automatically replaced by a new one, and a well-designed cloud app recovers from this kind of failure automatically and quickly.</span></span> <span data-ttu-id="b559c-127">稍早，我們將無狀態 web 層的擴充性優勢提高，而從故障伺服器復原的便利性則是 statelessness 的另一個優點。</span><span class="sxs-lookup"><span data-stu-id="b559c-127">Earlier we stressed the scalability benefits of a stateless web tier, and ease of recovery from a failed server is another benefit of statelessness.</span></span> <span data-ttu-id="b559c-128">輕鬆復原也是平臺即服務（PaaS）功能的優點之一，例如 SQL Database 和 Azure App Service Web Apps。</span><span class="sxs-lookup"><span data-stu-id="b559c-128">Ease of recovery is also one of the benefits of platform-as-a-service (PaaS) features such as SQL Database and Azure App Service Web Apps.</span></span> <span data-ttu-id="b559c-129">硬體失敗很罕見，但當它們發生時，這些服務會自動處理它們;當您使用其中一項服務時，甚至不需要撰寫程式碼來處理電腦失敗。</span><span class="sxs-lookup"><span data-stu-id="b559c-129">Hardware failures are rare, but when they occur these services handle them automatically; you don't even have to write code to handle machine failures when you're using one of these services.</span></span>

### <a name="service-failures"></a><span data-ttu-id="b559c-130">服務失敗</span><span class="sxs-lookup"><span data-stu-id="b559c-130">Service failures</span></span>

<span data-ttu-id="b559c-131">雲端應用程式通常會使用多個服務。</span><span class="sxs-lookup"><span data-stu-id="b559c-131">Cloud apps typically use multiple services.</span></span> <span data-ttu-id="b559c-132">例如，Fix It 應用程式會使用 SQL Database 服務、儲存體服務，以及 web 應用程式部署至 Azure App Service。</span><span class="sxs-lookup"><span data-stu-id="b559c-132">For example, the Fix It app uses the SQL Database service, the Storage service, and the web app is deployed to Azure App Service.</span></span> <span data-ttu-id="b559c-133">如果您依賴的其中一個服務失敗，您的應用程式會執行什麼動作？</span><span class="sxs-lookup"><span data-stu-id="b559c-133">What will your app do if one of the services you depend on fails?</span></span> <span data-ttu-id="b559c-134">對於某些服務失敗而言，「抱歉，稍後再試一次」訊息可能是您的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="b559c-134">For some service failures a friendly "sorry, try again later" message might be the best you can do.</span></span> <span data-ttu-id="b559c-135">但是在許多情況下，您可以做得更好。</span><span class="sxs-lookup"><span data-stu-id="b559c-135">But in many scenarios you can do better.</span></span> <span data-ttu-id="b559c-136">例如，當您的後端資料存放區關閉時，您可以接受使用者輸入、顯示「已收到您的要求」，並暫時將輸入儲存在其他地方;然後，當您需要的服務再次運作時，您可以取出輸入並加以處理。</span><span class="sxs-lookup"><span data-stu-id="b559c-136">For example, when your back-end data store is down, you can accept user input, display "your request has been received," and store the input someplace else temporarily; then when the service you need is operational again, you can retrieve the input and process it.</span></span>

<span data-ttu-id="b559c-137">以[佇列為中心的工作模式](queue-centric-work-pattern.md)一章會顯示處理這種情況的一種方式。</span><span class="sxs-lookup"><span data-stu-id="b559c-137">The [Queue-centric Work Pattern](queue-centric-work-pattern.md) chapter shows one way to handle this scenario.</span></span> <span data-ttu-id="b559c-138">Fix It 應用程式會將工作儲存在 SQL Database 中，但 SQL Database 關閉時則不需要結束。</span><span class="sxs-lookup"><span data-stu-id="b559c-138">The Fix It app stores tasks in SQL Database, but it doesn't have to quit working when SQL Database is down.</span></span> <span data-ttu-id="b559c-139">在該章節中，我們將瞭解如何在佇列中儲存工作的使用者輸入，並使用背景工作進程來讀取佇列和更新工作。</span><span class="sxs-lookup"><span data-stu-id="b559c-139">In that chapter we'll see how to store user input for a task in a queue, and use a worker process to read the queue and update the task.</span></span> <span data-ttu-id="b559c-140">如果 SQL 已關閉，建立 Fix It 工作的能力不會受到影響;當有 SQL Database 可用時，工作者進程可以等候並處理新的工作。</span><span class="sxs-lookup"><span data-stu-id="b559c-140">If SQL is down, the ability to create Fix It tasks is unaffected; the worker process can wait and process new tasks when SQL Database is available.</span></span>

### <a name="region-failures"></a><span data-ttu-id="b559c-141">區域失敗</span><span class="sxs-lookup"><span data-stu-id="b559c-141">Region failures</span></span>

<span data-ttu-id="b559c-142">整個區域可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="b559c-142">Entire regions may fail.</span></span> <span data-ttu-id="b559c-143">自然的嚴重損壞可能會損毀資料中心，它可能會由 meteor 壓平合併，而 farmer burying 可以剪下骨幹等。如果您的應用程式裝載在 stricken 資料中心，您該怎麼做？</span><span class="sxs-lookup"><span data-stu-id="b559c-143">A natural disaster might destroy a data center, it might get flattened by a meteor, the trunk line into the datacenter could be cut by a farmer burying a cow with a backhoe, etc. If your app is hosted in the stricken datacenter what do you do?</span></span> <span data-ttu-id="b559c-144">您可以在 Azure 中將應用程式設定為同時在多個區域中執行，如此一來，如果其中一項發生嚴重損壞，您就可以繼續在另一個區域中執行。</span><span class="sxs-lookup"><span data-stu-id="b559c-144">It's possible to set up your app in Azure to run in multiple regions simultaneously so that if there's a disaster in one, you continue running in another region.</span></span> <span data-ttu-id="b559c-145">這類失敗非常罕見，而且大部分的應用程式都不會跳過輕鬆所需的動作，以確保不會因為這種排序而中斷服務。</span><span class="sxs-lookup"><span data-stu-id="b559c-145">Such failures are extremely rare occurrences, and most apps don't jump through the hoops necessary to ensure uninterrupted service through failures of this sort.</span></span> <span data-ttu-id="b559c-146">請參閱章節結尾的 Resources 一節，以瞭解如何讓您的應用程式即使在區域失敗時仍可供使用的資訊。</span><span class="sxs-lookup"><span data-stu-id="b559c-146">See the Resources section at the end of the chapter for information about how to keep your app available even through a region failure.</span></span>

<span data-ttu-id="b559c-147">Azure 的目標是要讓您更輕鬆地處理所有這些失敗類型，而您會看到一些範例，說明如何在下列章節中執行此作業。</span><span class="sxs-lookup"><span data-stu-id="b559c-147">A goal of Azure is to make handling all of these kinds of failures a lot easier, and you'll see some examples of how we're doing that in the following chapters.</span></span>

## <a name="slas"></a><span data-ttu-id="b559c-148">SLA</span><span class="sxs-lookup"><span data-stu-id="b559c-148">SLAs</span></span>

<span data-ttu-id="b559c-149">人們經常聽說雲端環境中的服務等級協定（Sla）。</span><span class="sxs-lookup"><span data-stu-id="b559c-149">People often hear about service-level agreements (SLAs) in the cloud environment.</span></span> <span data-ttu-id="b559c-150">基本上，這些都是公司對其服務的可靠程度所做出的承諾。</span><span class="sxs-lookup"><span data-stu-id="b559c-150">Basically these are promises that companies make about how reliable their service is.</span></span> <span data-ttu-id="b559c-151">99.9% SLA 表示您應該預期服務會正常運作99.9% 的時間。</span><span class="sxs-lookup"><span data-stu-id="b559c-151">A 99.9% SLA means you should expect the service to be working correctly 99.9% of the time.</span></span> <span data-ttu-id="b559c-152">這是 SLA 的一般價值，而且聽起來像是非常高的值，但您可能不會發現0.1% 實際的金額是多少。</span><span class="sxs-lookup"><span data-stu-id="b559c-152">That's a fairly typical value for an SLA and it sounds like a very high number, but you might not realize how much down time .1% actually amounts to.</span></span> <span data-ttu-id="b559c-153">以下表格顯示在一年、一個月和一周內，各種 SLA 百分比的停機時間量。</span><span class="sxs-lookup"><span data-stu-id="b559c-153">Here's a table that shows how much downtime various SLA percentages amount to over a year, a month, and a week.</span></span>

![SLA 資料表](design-to-survive-failures/_static/image2.png)

<span data-ttu-id="b559c-155">因此99.9% 的 SLA 表示您的服務可能會在一年中關閉8.76 小時或每月43.2 分鐘。</span><span class="sxs-lookup"><span data-stu-id="b559c-155">So a 99.9% SLA means your service could be down 8.76 hours a year or 43.2 minutes a month.</span></span> <span data-ttu-id="b559c-156">這會比大部分人都知道的時間更低。</span><span class="sxs-lookup"><span data-stu-id="b559c-156">That's more down time than most people realize.</span></span> <span data-ttu-id="b559c-157">因此，身為開發人員，您想要注意一定的停機時間，並以正常方式處理它。</span><span class="sxs-lookup"><span data-stu-id="b559c-157">So as a developer you want to be aware that a certain amount of down time is possible and handle it in a graceful way.</span></span> <span data-ttu-id="b559c-158">有時候，有人會使用您的應用程式，而服務將會關閉，而您想要將對客戶的負面影響降到最低。</span><span class="sxs-lookup"><span data-stu-id="b559c-158">At some point someone is going to be using your app, and a service is going to be down, and you want to minimize the negative impact of that on the customer.</span></span>

<span data-ttu-id="b559c-159">有關 SLA 的一件事，就是它所指的是哪一個時間範圍：每週、每個月或每年都會重設時鐘？</span><span class="sxs-lookup"><span data-stu-id="b559c-159">One thing you should know about an SLA is what time-frame it refers to: does the clock get reset every week, every month, or every year?</span></span> <span data-ttu-id="b559c-160">在 Azure 中，我們會每個月重設時鐘，這對您比每年 SLA 更好，因為每年 SLA 可能會以一系列良好的月份來抵銷，而隱藏了不好的月份。</span><span class="sxs-lookup"><span data-stu-id="b559c-160">In Azure we reset the clock every month, which is better for you than a yearly SLA, since a yearly SLA could hide bad months by offsetting them with a series of good months.</span></span>

<span data-ttu-id="b559c-161">當然，我們一定會渴望比 SLA 更好。通常您會減少很多的時間。</span><span class="sxs-lookup"><span data-stu-id="b559c-161">Of course we always aspire to do better than the SLA; usually you'll be down much less than that.</span></span> <span data-ttu-id="b559c-162">這是因為如果我們停機時間超過最長的停機時間，您可以向後要求金錢。</span><span class="sxs-lookup"><span data-stu-id="b559c-162">The promise is that if we're ever down for longer than the maximum down time you can ask for money back.</span></span> <span data-ttu-id="b559c-163">您所得到的金錢可能無法完全補償您的業務衝擊，但 SLA 的這個層面會作為強制原則，讓您知道我們確實會將它視為非常重要的事。</span><span class="sxs-lookup"><span data-stu-id="b559c-163">The amount of money you get back probably wouldn't fully compensate you for the business impact of the excess down time, but that aspect of the SLA acts as an enforcement policy and lets you know that we do take it very seriously.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="b559c-164">複合 SLA</span><span class="sxs-lookup"><span data-stu-id="b559c-164">Composite SLAs</span></span>

<span data-ttu-id="b559c-165">當您查看 Sla 時，需要考慮的重要事項是在應用程式中使用多個服務的影響，每個服務都有個別的 SLA。</span><span class="sxs-lookup"><span data-stu-id="b559c-165">An important thing to think about when you're looking at SLAs is the impact of using multiple services in an app, with each service having a separate SLA.</span></span> <span data-ttu-id="b559c-166">例如，Fix It 應用程式會使用 Azure App Service Web Apps、Azure 儲存體和 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="b559c-166">For example, the Fix It app uses Azure App Service Web Apps, Azure Storage, and SQL Database.</span></span> <span data-ttu-id="b559c-167">以下是在2013年12月撰寫此電子書的日期時的 SLA 號碼：</span><span class="sxs-lookup"><span data-stu-id="b559c-167">Here are their SLA numbers as of the date this e-book is being written in December, 2013:</span></span>

![SLA 網站、儲存體、SQL Database](design-to-survive-failures/_static/image3.png)

<span data-ttu-id="b559c-169">根據這些服務 Sla，您預期應用程式的最大停機時間為何？</span><span class="sxs-lookup"><span data-stu-id="b559c-169">What is the maximum down time you would expect for the app based on these service SLAs?</span></span> <span data-ttu-id="b559c-170">您可能會認為您的停機時間等於最差的 SLA 百分比，或在此案例中為99.9%。</span><span class="sxs-lookup"><span data-stu-id="b559c-170">You might think that your down time would be equal to the worst SLA percentage, or 99.9% in this case.</span></span> <span data-ttu-id="b559c-171">如果這三個服務總是同時失敗，但這不一定是實際發生的情況，這會是 true。</span><span class="sxs-lookup"><span data-stu-id="b559c-171">That would be true if all three services always failed at the same time, but that isn't necessarily what actually happens.</span></span> <span data-ttu-id="b559c-172">每個服務可能會在不同時間獨立失敗，因此您必須將個別 SLA 編號相乘來計算複合 SLA。</span><span class="sxs-lookup"><span data-stu-id="b559c-172">Each service may fail independently at different times, so you have to calculate the composite SLA by multiplying the individual SLA numbers.</span></span>

![複合 SLA](design-to-survive-failures/_static/image4.png)

<span data-ttu-id="b559c-174">因此，您的應用程式可能不只是每個月43.2 分鐘，而是每個月的3倍（108分鐘），而且仍在 Azure SLA 限制內。</span><span class="sxs-lookup"><span data-stu-id="b559c-174">So your app could be down not just 43.2 minutes a month but 3 times that amount, 108 minutes a month – and still be within the Azure SLA limits.</span></span>

<span data-ttu-id="b559c-175">此問題對 Azure 而言並不獨特。</span><span class="sxs-lookup"><span data-stu-id="b559c-175">This issue is not unique to Azure.</span></span> <span data-ttu-id="b559c-176">我們實際上提供了任何可用雲端服務的最佳雲端 Sla，如果您使用任何廠商的雲端服務，就會有類似的問題需要處理。</span><span class="sxs-lookup"><span data-stu-id="b559c-176">We actually provide the best cloud SLAs of any cloud service available, and you'll have similar issues to deal with if you use any vendor's cloud services.</span></span> <span data-ttu-id="b559c-177">重點在於思考如何設計應用程式以妥善處理不可避免的服務失敗的重要性，因為它們可能經常會對客戶或使用者造成影響。</span><span class="sxs-lookup"><span data-stu-id="b559c-177">What this highlights is the importance of thinking about how you can design your app to handle the inevitable service failures gracefully, because they might happen often enough to impact your customers or users.</span></span>

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a><span data-ttu-id="b559c-178">與企業停機時間相較之下的雲端 Sla</span><span class="sxs-lookup"><span data-stu-id="b559c-178">Cloud SLAs compared to enterprise down-time experience</span></span>

<span data-ttu-id="b559c-179">大家有時候會說：「我的企業應用程式中沒有這些問題。」</span><span class="sxs-lookup"><span data-stu-id="b559c-179">People sometimes say, "In my enterprise app I never have these problems."</span></span> <span data-ttu-id="b559c-180">如果您問到幾個月實際有多少時間，他們通常會說：「嗯，偶爾會發生這種情況。」</span><span class="sxs-lookup"><span data-stu-id="b559c-180">If you ask how much down time a month they actually have, they usually say, "Well, it happens occasionally."</span></span> <span data-ttu-id="b559c-181">如果您詢問多久，他們承認「有時候我們需要備份或安裝新的伺服器或更新軟體。」</span><span class="sxs-lookup"><span data-stu-id="b559c-181">And if you ask how often, they admit that "Sometimes we do need to back up or install a new server or update software."</span></span> <span data-ttu-id="b559c-182">當然，這會計算為停機時間。</span><span class="sxs-lookup"><span data-stu-id="b559c-182">Of course, that counts as down time.</span></span> <span data-ttu-id="b559c-183">大部分的企業應用程式（除非它們特別是要徑任務）實際上會停機超過我們的服務 Sla 所允許的時間長度。</span><span class="sxs-lookup"><span data-stu-id="b559c-183">Most enterprise apps unless they are especially mission-critical are actually down for more than the amount of time allowed by our service SLAs.</span></span> <span data-ttu-id="b559c-184">但是當您的伺服器和您的基礎結構，以及您對它的控制，您通常會覺得不大停機時間。</span><span class="sxs-lookup"><span data-stu-id="b559c-184">But when it's your server and your infrastructure and you're responsible for it and in control of it, you tend to feel less angst about down times.</span></span> <span data-ttu-id="b559c-185">在雲端環境中，您會相依于其他人，而且您不知道發生什麼事，因此您可能會想要更擔心。</span><span class="sxs-lookup"><span data-stu-id="b559c-185">In a cloud environment you're dependent on someone else and you don't know what's going on, so you might tend to get more worried about it.</span></span>

<span data-ttu-id="b559c-186">當企業達到比從雲端 SLA 取得更高的時間百分比時，就會藉由在硬體上花費更多錢來達成此目的。</span><span class="sxs-lookup"><span data-stu-id="b559c-186">When an enterprise achieves a greater up-time percentage than you get from a cloud SLA, they do it by spending a lot more money on hardware.</span></span> <span data-ttu-id="b559c-187">雲端服務可以執行這項操作，但必須為其服務額外收取更多費用。</span><span class="sxs-lookup"><span data-stu-id="b559c-187">A cloud service could do that but would have to charge much more for its services.</span></span> <span data-ttu-id="b559c-188">相反地，您會利用符合成本效益的服務，並設計您的軟體，讓不可避免的失敗造成客戶最少的中斷。</span><span class="sxs-lookup"><span data-stu-id="b559c-188">Instead, you take advantage of a cost-effective service and design your software so that the inevitable failures cause minimum disruption to your customers.</span></span> <span data-ttu-id="b559c-189">身為雲端應用程式設計人員的工作並不是為了避免失敗，而是為了避免發生災難，而是把焦點放在軟體上，而不是硬體上。</span><span class="sxs-lookup"><span data-stu-id="b559c-189">Your job as a cloud app designer is not so much to avoid failure as to avoid catastrophe, and you do that by focusing on software, not on hardware.</span></span> <span data-ttu-id="b559c-190">雖然企業應用程式致力於在失敗之間達到最大的平均時間，但雲端應用程式致力於將復原的平均時間降到最低。</span><span class="sxs-lookup"><span data-stu-id="b559c-190">Whereas enterprise apps strive to maximize mean time between failures, cloud apps strive to minimize mean time to recover.</span></span>

### <a name="not-all-cloud-services-have-slas"></a><span data-ttu-id="b559c-191">並非所有雲端服務都有 Sla</span><span class="sxs-lookup"><span data-stu-id="b559c-191">Not all cloud services have SLAs</span></span>

<span data-ttu-id="b559c-192">也請注意，並非每個雲端服務甚至都有 SLA。</span><span class="sxs-lookup"><span data-stu-id="b559c-192">Be aware also that not every cloud service even has an SLA.</span></span> <span data-ttu-id="b559c-193">如果您的應用程式相依于不具時間保證的服務，您可能會比想像更長的時間。</span><span class="sxs-lookup"><span data-stu-id="b559c-193">If your app is dependent on a service with no up-time guarantee, you could be down far longer than you might imagine.</span></span> <span data-ttu-id="b559c-194">例如，如果您使用社交提供者（例如 Facebook 或 Twitter）來登入您的網站，請洽詢服務提供者以瞭解是否有 SLA，而且您可能會發現沒有任何一項。</span><span class="sxs-lookup"><span data-stu-id="b559c-194">For example, if you enable log-in to your site using a social provider such as Facebook or Twitter, check with the service provider to find out if there is an SLA, and you might find out there isn't one.</span></span> <span data-ttu-id="b559c-195">但是，如果驗證服務停止運作，或無法支援您在它擲回的要求數量，您的客戶就會被鎖定您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="b559c-195">But if the authentication service goes down or is unable to support the volume of requests you throw at it, your customers are locked out of your app.</span></span> <span data-ttu-id="b559c-196">您可以關閉數天或更久的時間。</span><span class="sxs-lookup"><span data-stu-id="b559c-196">You could be down for days or longer.</span></span> <span data-ttu-id="b559c-197">一個新應用程式的建立者預期會有數百個數百萬次的下載，並相依于 Facebook 驗證，但是在上線之前不會與 Facebook 交談，而且該服務沒有 SLA。</span><span class="sxs-lookup"><span data-stu-id="b559c-197">The creators of one new app expected hundreds of millions of downloads and took a dependency on Facebook authentication – but didn't talk to Facebook before going live and discovered too late that there was no SLA for that service.</span></span>

### <a name="not-all-downtime-counts-toward-slas"></a><span data-ttu-id="b559c-198">並非所有停機時間都計入 Sla</span><span class="sxs-lookup"><span data-stu-id="b559c-198">Not all downtime counts toward SLAs</span></span>

<span data-ttu-id="b559c-199">如果您的應用程式過度使用，某些雲端服務可能會刻意拒絕服務。</span><span class="sxs-lookup"><span data-stu-id="b559c-199">Some cloud services may deliberately deny service if your app over-uses them.</span></span> <span data-ttu-id="b559c-200">這稱為*節流*。</span><span class="sxs-lookup"><span data-stu-id="b559c-200">This is called *throttling*.</span></span> <span data-ttu-id="b559c-201">如果服務有 SLA，它應該會陳述您可能節流的條件，而您的應用程式設計應該避免這些狀況，並在發生時適當地回應節流。</span><span class="sxs-lookup"><span data-stu-id="b559c-201">If a service has an SLA, it should state the conditions under which you might be throttled, and your app design should avoid those conditions and react appropriately to the throttling if it happens.</span></span> <span data-ttu-id="b559c-202">例如，如果當您每秒超過某個數位時，服務的要求開始失敗，您會想要確保自動重試不會快速進行，因為它們會造成節流的繼續。</span><span class="sxs-lookup"><span data-stu-id="b559c-202">For example, if requests to a service start to fail when you exceed a certain number per second, you want to make sure automatic retries don't happen so fast that they cause the throttling to continue.</span></span> <span data-ttu-id="b559c-203">在[暫時性錯誤處理一章](transient-fault-handling.md)中，我們將會有更多關於節流的資訊。</span><span class="sxs-lookup"><span data-stu-id="b559c-203">We'll have more to say about throttling in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

## <a name="summary"></a><span data-ttu-id="b559c-204">摘要</span><span class="sxs-lookup"><span data-stu-id="b559c-204">Summary</span></span>

<span data-ttu-id="b559c-205">本章已嘗試協助您瞭解如何將真實世界的雲端應用程式設計成可正常地存活失敗。</span><span class="sxs-lookup"><span data-stu-id="b559c-205">This chapter has tried to help you realize why a real world cloud app has to be designed to survive failures gracefully.</span></span> <span data-ttu-id="b559c-206">從[下一章](monitoring-and-telemetry.md)開始，此系列中的其餘模式會詳細說明一些您可以用來執行此動作的策略：</span><span class="sxs-lookup"><span data-stu-id="b559c-206">Starting with the [next chapter](monitoring-and-telemetry.md), the remaining patterns in this series go into more detail about some strategies you can use to do that:</span></span>

- <span data-ttu-id="b559c-207">有良好的[監視和遙測](monitoring-and-telemetry.md)，讓您快速瞭解需要介入的失敗，而且您有足夠的資訊可以解決這些問題。</span><span class="sxs-lookup"><span data-stu-id="b559c-207">Have good [monitoring and telemetry](monitoring-and-telemetry.md), so that you find out quickly about failures that require intervention, and you have sufficient information to resolve them.</span></span>
- <span data-ttu-id="b559c-208">藉由執行智慧型重試邏輯來[處理暫時性錯誤](transient-fault-handling.md)，讓您的應用程式在可以時自動復原，並在無法時切換回[斷路](transient-fault-handling.md#circuitbreakers)器邏輯。</span><span class="sxs-lookup"><span data-stu-id="b559c-208">[Handle transient faults](transient-fault-handling.md) by implementing intelligent retry logic, so that your app recovers automatically when it can and falls back to [circuit breaker](transient-fault-handling.md#circuitbreakers) logic when it can't.</span></span>
- <span data-ttu-id="b559c-209">使用[分散式](distributed-caching.md)快取，以將資料庫存取的輸送量、延遲和連接問題降到最低。</span><span class="sxs-lookup"><span data-stu-id="b559c-209">Use [distributed caching](distributed-caching.md) in order to minimize throughput, latency, and connection problems with database access.</span></span>
- <span data-ttu-id="b559c-210">透過以[佇列為中心的工作模式](queue-centric-work-pattern.md)來執行鬆散耦合，讓您的應用程式前端在後端關閉時仍可繼續運作。</span><span class="sxs-lookup"><span data-stu-id="b559c-210">Implement loose coupling via the [queue-centric work pattern](queue-centric-work-pattern.md), so that your app front end can continue to work when the back end is down.</span></span>

## <a name="resources"></a><span data-ttu-id="b559c-211">資源</span><span class="sxs-lookup"><span data-stu-id="b559c-211">Resources</span></span>

<span data-ttu-id="b559c-212">如需詳細資訊，請參閱本電子書中的後續章節和下列資源。</span><span class="sxs-lookup"><span data-stu-id="b559c-212">For more information, see later chapters in this e-book and the following resources.</span></span>

<span data-ttu-id="b559c-213">文件：</span><span class="sxs-lookup"><span data-stu-id="b559c-213">Documentation:</span></span>

- <span data-ttu-id="b559c-214">[損毀修復：具有恢復功能的雲端架構指引](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b559c-214">[Failsafe: Guidance for Resilient Cloud Architectures](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx).</span></span> <span data-ttu-id="b559c-215">白皮書： Marc Mercuri、Ulrich Homann 和 Andrew Townhill。</span><span class="sxs-lookup"><span data-stu-id="b559c-215">White paper by Marc Mercuri, Ulrich Homann, and Andrew Townhill.</span></span> <span data-ttu-id="b559c-216">網頁版的防安全影片系列。</span><span class="sxs-lookup"><span data-stu-id="b559c-216">Web page version of the FailSafe video series.</span></span>
- <span data-ttu-id="b559c-217">[Azure 上大規模服務設計的最佳作法雲端服務](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b559c-217">[Best Practices for the Design of Large-Scale Services on Azure Cloud Services](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx).</span></span> <span data-ttu-id="b559c-218">以標記 Simm 和 Michael Thomassy 的技術白皮書。</span><span class="sxs-lookup"><span data-stu-id="b559c-218">White paper by Mark Simms and Michael Thomassy.</span></span>
- <span data-ttu-id="b559c-219">[Azure 業務持續性技術指引](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b559c-219">[Azure Business Continuity Technical Guidance](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx).</span></span> <span data-ttu-id="b559c-220">Wickline 和 Jason Roth 的技術白皮書。</span><span class="sxs-lookup"><span data-stu-id="b559c-220">White paper by Patrick Wickline and Jason Roth.</span></span>
- <span data-ttu-id="b559c-221">[Azure 應用程式的嚴重損壞修復和高可用性](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b559c-221">[Disaster Recovery and High Availability for Azure Applications](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx).</span></span> <span data-ttu-id="b559c-222">由 Michael McKeown、Hanu Kommalapati 和 Jason Roth 所白皮書。</span><span class="sxs-lookup"><span data-stu-id="b559c-222">White paper by Michael McKeown, Hanu Kommalapati, and Jason Roth.</span></span>
- <span data-ttu-id="b559c-223">[Microsoft 模式和實務-Azure 指引](https://msdn.microsoft.com/library/dn568099.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b559c-223">[Microsoft Patterns and Practices - Azure Guidance](https://msdn.microsoft.com/library/dn568099.aspx).</span></span> <span data-ttu-id="b559c-224">請參閱多個資料中心部署指導方針、斷路器模式。</span><span class="sxs-lookup"><span data-stu-id="b559c-224">See Multi Data Center Deployment guidance, Circuit breaker pattern.</span></span>
- <span data-ttu-id="b559c-225">[Azure 支援-服務等級協定](https://azure.microsoft.com/support/legal/sla/)。</span><span class="sxs-lookup"><span data-stu-id="b559c-225">[Azure Support - Service Level Agreements](https://azure.microsoft.com/support/legal/sla/).</span></span>
- <span data-ttu-id="b559c-226">[Azure SQL Database 中的業務持續性](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b559c-226">[Business Continuity in Azure SQL Database](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx).</span></span> <span data-ttu-id="b559c-227">SQL Database 高可用性和嚴重損壞修復功能的相關檔。</span><span class="sxs-lookup"><span data-stu-id="b559c-227">Documentation about SQL Database high availability and disaster recovery features.</span></span>
- <span data-ttu-id="b559c-228">[Azure 虛擬機器中 SQL Server 的高可用性和嚴重損壞修復](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b559c-228">[High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).</span></span>

<span data-ttu-id="b559c-229">影片：</span><span class="sxs-lookup"><span data-stu-id="b559c-229">Videos:</span></span>

- <span data-ttu-id="b559c-230">[防安全功能：建立可擴充、可復原的雲端服務](https://channel9.msdn.com/Series/FailSafe)。</span><span class="sxs-lookup"><span data-stu-id="b559c-230">[FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe).</span></span> <span data-ttu-id="b559c-231">Ulrich Homann、Marc Mercuri 和 Mark Simm 的九部分系列。</span><span class="sxs-lookup"><span data-stu-id="b559c-231">Nine-part series by Ulrich Homann, Marc Mercuri, and Mark Simms.</span></span> <span data-ttu-id="b559c-232">以非常容易存取且有趣的方式呈現高階概念和架構原則，並提供 Microsoft 客戶諮詢小組（CAT）體驗與實際客戶的故事。</span><span class="sxs-lookup"><span data-stu-id="b559c-232">Presents high-level concepts and architectural principles in a very accessible and interesting way, with stories drawn from Microsoft Customer Advisory Team (CAT) experience with actual customers.</span></span> <span data-ttu-id="b559c-233">集1和8將深入探討設計雲端應用程式以存活失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="b559c-233">Episodes 1 and 8 go in depth into the reasons for designing cloud apps to survive failures.</span></span> <span data-ttu-id="b559c-234">另請參閱從49:57 開始的集區2中的節流追蹤討論。從56:05 開始，第2集的失敗點和失敗模式討論，以及從40:55 開始的第3集斷路器討論。</span><span class="sxs-lookup"><span data-stu-id="b559c-234">See also the follow-up discussion of throttling in episode 2 starting at 49:57, the discussion of failure points and failure modes in episode 2 starting at 56:05, and the discussion of circuit breakers in episode 3 starting at 40:55.</span></span>
- <span data-ttu-id="b559c-235">[打造 Big：從 Azure 客戶學到的經驗-第二部](https://channel9.msdn.com/Events/Build/2012/3-030)。</span><span class="sxs-lookup"><span data-stu-id="b559c-235">[Building Big: Lessons learned from Azure customers - Part II](https://channel9.msdn.com/Events/Build/2012/3-030).</span></span> <span data-ttu-id="b559c-236">Mark Simm 討論如何設計失敗和檢測所有專案。</span><span class="sxs-lookup"><span data-stu-id="b559c-236">Mark Simms talks about designing for failure and instrumenting everything.</span></span> <span data-ttu-id="b559c-237">類似于防故障的系列，並深入探討如何詳細說明。</span><span class="sxs-lookup"><span data-stu-id="b559c-237">Similar to the Failsafe series but goes into more how-to details.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b559c-238">[上一頁](unstructured-blob-storage.md)
> [下一頁](monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="b559c-238">[Previous](unstructured-blob-storage.md)
[Next](monitoring-and-telemetry.md)</span></span>
