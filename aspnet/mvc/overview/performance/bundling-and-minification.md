---
uid: mvc/overview/performance/bundling-and-minification
title: 捆綁與縮制 |Microsoft Docs
author: Rick-Anderson
description: 配套和縮制是您可以在 ASP.NET 4.5 中用來改善要求載入時間的兩個技術。 捆綁與縮制可改善載入時間，reducin 。
ms.author: riande
ms.date: 08/23/2012
ms.assetid: 5894dc13-5d45-4dad-8096-136499120f1d
msc.legacyurl: /mvc/overview/performance/bundling-and-minification
msc.type: authoredcontent
ms.openlocfilehash: 239980d747c6e0d6be1e9b4fe0371e276e37cf21
ms.sourcegitcommit: 88fc80e3f65aebdf61ec9414810ddbc31c543f04
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/22/2020
ms.locfileid: "76519280"
---
# <a name="bundling-and-minification"></a><span data-ttu-id="04b1e-104">統合及縮製</span><span class="sxs-lookup"><span data-stu-id="04b1e-104">Bundling and Minification</span></span>

<span data-ttu-id="04b1e-105">依[Rick Anderson]((https://twitter.com/RickAndMSFT))</span><span class="sxs-lookup"><span data-stu-id="04b1e-105">by [Rick Anderson]((https://twitter.com/RickAndMSFT))</span></span>

> <span data-ttu-id="04b1e-106">配套和縮制是您可以在 ASP.NET 4.5 中用來改善要求載入時間的兩個技術。</span><span class="sxs-lookup"><span data-stu-id="04b1e-106">Bundling and minification are two techniques you can use in ASP.NET 4.5 to improve request load time.</span></span> <span data-ttu-id="04b1e-107">組合和縮制藉由減少對伺服器的要求數並減少要求的資產（例如 CSS 和 JavaScript），來改善載入時間。</span><span class="sxs-lookup"><span data-stu-id="04b1e-107">Bundling and minification improves load time by reducing the number of requests to the server and reducing the size of requested assets (such as CSS and JavaScript.)</span></span>

<span data-ttu-id="04b1e-108">目前大部分的主要瀏覽器會將每個主機名稱的[同時](http://www.browserscope.org/?category=network)連線數目限制為六個。</span><span class="sxs-lookup"><span data-stu-id="04b1e-108">Most of the current major browsers limit the number of [simultaneous connections](http://www.browserscope.org/?category=network) per each hostname to six.</span></span> <span data-ttu-id="04b1e-109">這表示在處理六個要求時，瀏覽器會將其他對主機資產的要求排入佇列。</span><span class="sxs-lookup"><span data-stu-id="04b1e-109">That means that while six requests are being processed, additional requests for assets on a host will be queued by the browser.</span></span> <span data-ttu-id="04b1e-110">在下圖中，[IE F12 開發人員工具網路] 索引標籤會顯示範例應用程式的 [關於] 視圖所需的資產時間。</span><span class="sxs-lookup"><span data-stu-id="04b1e-110">In the image below, the IE F12 developer tools network tabs shows the timing for assets required by the About view of a sample application.</span></span>

![B/M](bundling-and-minification/_static/image1.png)

<span data-ttu-id="04b1e-112">灰色列會顯示瀏覽器在等候六個連線限制時，將要求排入佇列的時間。</span><span class="sxs-lookup"><span data-stu-id="04b1e-112">The gray bars show the time the request is queued by the browser waiting on the six connection limit.</span></span> <span data-ttu-id="04b1e-113">黃色的長條是要求第一個位元組的時間，也就是傳送要求和接收伺服器的第一個回應所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="04b1e-113">The yellow bar is the request time to first byte, that is, the time taken to send the request and receive the first response from the server.</span></span> <span data-ttu-id="04b1e-114">藍色橫條會顯示從伺服器接收回應資料所花費的時間。</span><span class="sxs-lookup"><span data-stu-id="04b1e-114">The blue bars show the time taken to receive the response data from the server.</span></span> <span data-ttu-id="04b1e-115">您可以按兩下資產以取得詳細的計時資訊。</span><span class="sxs-lookup"><span data-stu-id="04b1e-115">You can double-click on an asset to get detailed timing information.</span></span> <span data-ttu-id="04b1e-116">例如，下圖顯示載入 */Scripts/MyScripts/JavaScript6.js*檔案的計時詳細資料。</span><span class="sxs-lookup"><span data-stu-id="04b1e-116">For example, the following image shows the timing details for loading the */Scripts/MyScripts/JavaScript6.js* file.</span></span>

![](bundling-and-minification/_static/image2.png)

<span data-ttu-id="04b1e-117">上圖顯示 [**啟動**] 事件，這會提供要求排入佇列的時間，因為瀏覽器會限制同時連接的數目。</span><span class="sxs-lookup"><span data-stu-id="04b1e-117">The preceding image shows the **Start** event, which gives the time the request was queued because of the browser limit the number of simultaneous connections.</span></span> <span data-ttu-id="04b1e-118">在此情況下，要求會排入佇列中等候等待另一個要求完成的46毫秒。</span><span class="sxs-lookup"><span data-stu-id="04b1e-118">In this case, the request was queued for 46 milliseconds waiting for another request to complete.</span></span>

## <a name="bundling"></a><span data-ttu-id="04b1e-119">統合</span><span class="sxs-lookup"><span data-stu-id="04b1e-119">Bundling</span></span>

<span data-ttu-id="04b1e-120">配套是 ASP.NET 4.5 中的新功能，可讓您輕鬆地將多個檔案結合或組合成單一檔案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-120">Bundling is a new feature in ASP.NET 4.5 that makes it easy to combine or bundle multiple files into a single file.</span></span> <span data-ttu-id="04b1e-121">您可以建立 CSS、JavaScript 和其他套件組合。</span><span class="sxs-lookup"><span data-stu-id="04b1e-121">You can create CSS, JavaScript and other bundles.</span></span> <span data-ttu-id="04b1e-122">較少的檔案表示 HTTP 要求較少，而且可以改善第一頁載入效能。</span><span class="sxs-lookup"><span data-stu-id="04b1e-122">Fewer files means fewer HTTP requests and that can improve first page load performance.</span></span>

<span data-ttu-id="04b1e-123">下圖顯示先前所示之 [關於] 視圖的相同時間觀點，但這次已啟用 [組合] 和 [縮制]。</span><span class="sxs-lookup"><span data-stu-id="04b1e-123">The following image shows the same timing view of the About view shown previously, but this time with bundling and minification enabled.</span></span>

![](bundling-and-minification/_static/image3.png)

## <a name="minification"></a><span data-ttu-id="04b1e-124">縮製</span><span class="sxs-lookup"><span data-stu-id="04b1e-124">Minification</span></span>

<span data-ttu-id="04b1e-125">縮制會對腳本或 css 執行各種不同的程式碼優化，例如移除不必要的空白字元和批註，以及將變數名稱縮短成一個字元。</span><span class="sxs-lookup"><span data-stu-id="04b1e-125">Minification performs a variety of different code optimizations to scripts or css, such as removing unnecessary white space and comments and shortening variable names to one character.</span></span> <span data-ttu-id="04b1e-126">請考慮下列 JavaScript 函數。</span><span class="sxs-lookup"><span data-stu-id="04b1e-126">Consider the following JavaScript function.</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample1.js)]

<span data-ttu-id="04b1e-127">縮制之後，函式會縮減為下列內容：</span><span class="sxs-lookup"><span data-stu-id="04b1e-127">After minification, the function is reduced to the following:</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample2.js)]

<span data-ttu-id="04b1e-128">除了移除批註和不必要的空白字元以外，下列參數和變數名稱已重新命名（縮短），如下所示：</span><span class="sxs-lookup"><span data-stu-id="04b1e-128">In addition to removing the comments and unnecessary whitespace, the following parameters and variable names were renamed (shortened) as follows:</span></span>

| <span data-ttu-id="04b1e-129">**Original**</span><span class="sxs-lookup"><span data-stu-id="04b1e-129">**Original**</span></span> | <span data-ttu-id="04b1e-130">**經過**</span><span class="sxs-lookup"><span data-stu-id="04b1e-130">**Renamed**</span></span> |
| --- | --- |
| <span data-ttu-id="04b1e-131">imageTagAndImageID</span><span class="sxs-lookup"><span data-stu-id="04b1e-131">imageTagAndImageID</span></span> | <span data-ttu-id="04b1e-132">n</span><span class="sxs-lookup"><span data-stu-id="04b1e-132">n</span></span> |
| <span data-ttu-id="04b1e-133">imageCoNtext</span><span class="sxs-lookup"><span data-stu-id="04b1e-133">imageContext</span></span> | <span data-ttu-id="04b1e-134">t</span><span class="sxs-lookup"><span data-stu-id="04b1e-134">t</span></span> |
| <span data-ttu-id="04b1e-135">imageElement</span><span class="sxs-lookup"><span data-stu-id="04b1e-135">imageElement</span></span> | <span data-ttu-id="04b1e-136">i</span><span class="sxs-lookup"><span data-stu-id="04b1e-136">i</span></span> |

## <a name="impact-of-bundling-and-minification"></a><span data-ttu-id="04b1e-137">捆綁與縮制的影響</span><span class="sxs-lookup"><span data-stu-id="04b1e-137">Impact of Bundling and Minification</span></span>

<span data-ttu-id="04b1e-138">下表顯示個別列出所有資產，以及在範例程式中使用配套和縮制（B/M）的幾個重要差異。</span><span class="sxs-lookup"><span data-stu-id="04b1e-138">The following table shows several important differences between listing all the assets individually and using bundling and minification (B/M) in the sample program.</span></span>

|  | <span data-ttu-id="04b1e-139">**使用 B/M**</span><span class="sxs-lookup"><span data-stu-id="04b1e-139">**Using B/M**</span></span> | <span data-ttu-id="04b1e-140">**不含 B/M 的**</span><span class="sxs-lookup"><span data-stu-id="04b1e-140">**Without B/M**</span></span> | <span data-ttu-id="04b1e-141">**變更**</span><span class="sxs-lookup"><span data-stu-id="04b1e-141">**Change**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="04b1e-142">**檔案要求**</span><span class="sxs-lookup"><span data-stu-id="04b1e-142">**File Requests**</span></span> | <span data-ttu-id="04b1e-143">9</span><span class="sxs-lookup"><span data-stu-id="04b1e-143">9</span></span> | <span data-ttu-id="04b1e-144">34</span><span class="sxs-lookup"><span data-stu-id="04b1e-144">34</span></span> | <span data-ttu-id="04b1e-145">256%</span><span class="sxs-lookup"><span data-stu-id="04b1e-145">256%</span></span> |
| <span data-ttu-id="04b1e-146">**已傳送 KB**</span><span class="sxs-lookup"><span data-stu-id="04b1e-146">**KB Sent**</span></span> | <span data-ttu-id="04b1e-147">3.26</span><span class="sxs-lookup"><span data-stu-id="04b1e-147">3.26</span></span> | <span data-ttu-id="04b1e-148">11.92</span><span class="sxs-lookup"><span data-stu-id="04b1e-148">11.92</span></span> | <span data-ttu-id="04b1e-149">266%</span><span class="sxs-lookup"><span data-stu-id="04b1e-149">266%</span></span> |
| <span data-ttu-id="04b1e-150">**已收到 KB**</span><span class="sxs-lookup"><span data-stu-id="04b1e-150">**KB Received**</span></span> | <span data-ttu-id="04b1e-151">388.51</span><span class="sxs-lookup"><span data-stu-id="04b1e-151">388.51</span></span> | <span data-ttu-id="04b1e-152">530</span><span class="sxs-lookup"><span data-stu-id="04b1e-152">530</span></span> | <span data-ttu-id="04b1e-153">36%</span><span class="sxs-lookup"><span data-stu-id="04b1e-153">36%</span></span> |
| <span data-ttu-id="04b1e-154">**載入時間**</span><span class="sxs-lookup"><span data-stu-id="04b1e-154">**Load Time**</span></span> | <span data-ttu-id="04b1e-155">510毫秒</span><span class="sxs-lookup"><span data-stu-id="04b1e-155">510 MS</span></span> | <span data-ttu-id="04b1e-156">780毫秒</span><span class="sxs-lookup"><span data-stu-id="04b1e-156">780 MS</span></span> | <span data-ttu-id="04b1e-157">53%</span><span class="sxs-lookup"><span data-stu-id="04b1e-157">53%</span></span> |

<span data-ttu-id="04b1e-158">因為瀏覽器在要求上套用的 HTTP 標頭相當冗長，所以傳送的位元組會大幅降低。</span><span class="sxs-lookup"><span data-stu-id="04b1e-158">The bytes sent had a significant reduction with bundling as browsers are fairly verbose with the HTTP headers they apply on requests.</span></span> <span data-ttu-id="04b1e-159">已接收的位元組數不大，因為最大的檔案（*腳本\\jquery-ui-1.8.11*和*腳本\\jquery-1.7.2.min.js 1.7.1. min .js*）已經縮減。</span><span class="sxs-lookup"><span data-stu-id="04b1e-159">The received bytes reduction is not as large because the largest files (*Scripts\\jquery-ui-1.8.11.min.js* and *Scripts\\jquery-1.7.1.min.js*) are already minified.</span></span> <span data-ttu-id="04b1e-160">注意：範例程式上的時間會使用[Fiddler](http://www.fiddler2.com/fiddler2/)工具來模擬慢速網路。</span><span class="sxs-lookup"><span data-stu-id="04b1e-160">Note: The timings on the sample program used the [Fiddler](http://www.fiddler2.com/fiddler2/) tool to simulate a slow network.</span></span> <span data-ttu-id="04b1e-161">（從 [Fiddler**規則**] 功能表中，選取 [**效能**]，然後**模擬數據機速度**）。</span><span class="sxs-lookup"><span data-stu-id="04b1e-161">(From the Fiddler **Rules** menu, select **Performance** then **Simulate Modem Speeds**.)</span></span>

## <a name="debugging-bundled-and-minified-javascript"></a><span data-ttu-id="04b1e-162">已配套和縮減 JavaScript 的調試</span><span class="sxs-lookup"><span data-stu-id="04b1e-162">Debugging Bundled and Minified JavaScript</span></span>

<span data-ttu-id="04b1e-163">在開發環境中，您可以輕鬆地對 JavaScript 進行偵錯工具 *（web.config 檔案*中的[編譯元素](https://msdn.microsoft.com/library/s10awwz0.aspx)會設定為 `debug="true"`），因為 javascript 檔案並未配套或縮減。</span><span class="sxs-lookup"><span data-stu-id="04b1e-163">It's easy to debug your JavaScript in a development environment (where the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx) in the *Web.config* file is set to `debug="true"` ) because the JavaScript files are not bundled or minified.</span></span> <span data-ttu-id="04b1e-164">您也可以在您的 JavaScript 檔案已配套並縮減的發行組建中進行偵錯工具。</span><span class="sxs-lookup"><span data-stu-id="04b1e-164">You can also debug a release build where your JavaScript files are bundled and minified.</span></span> <span data-ttu-id="04b1e-165">使用 IE F12 開發人員工具，您可以使用下列方法，來偵測縮減配套中包含的 JavaScript 函式：</span><span class="sxs-lookup"><span data-stu-id="04b1e-165">Using the IE F12 developer tools, you debug a JavaScript function included in a minified bundle using the following approach:</span></span>

1. <span data-ttu-id="04b1e-166">選取 [**腳本**] 索引標籤，然後選取 [**開始調試**] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="04b1e-166">Select the **Script** tab and then select the **Start debugging** button.</span></span>
2. <span data-ttu-id="04b1e-167">使用 [資產] 按鈕，選取包含您想要進行 debug 的 JavaScript 函式的配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-167">Select the bundle containing the JavaScript function you want to debug using the assets button.</span></span>  
    ![](bundling-and-minification/_static/image4.png)
3. <span data-ttu-id="04b1e-168">![](bundling-and-minification/_static/image5.png)選取 [設定]**按鈕**，然後選取 [**格式化 javascript**]，以格式化縮減 javascript。</span><span class="sxs-lookup"><span data-stu-id="04b1e-168">Format the minified JavaScript by selecting the **Configuration button** ![](bundling-and-minification/_static/image5.png), and then selecting **Format JavaScript**.</span></span>
4. <span data-ttu-id="04b1e-169">在 [**搜尋腳本**] 輸入方塊中，選取您想要進行 debug 的函式名稱。</span><span class="sxs-lookup"><span data-stu-id="04b1e-169">In the **Search Script** input box, select the name of the function you want to debug.</span></span> <span data-ttu-id="04b1e-170">在下圖中，已在 [**搜尋腳本**] 輸入方塊中輸入**AddAltToImg** 。</span><span class="sxs-lookup"><span data-stu-id="04b1e-170">In the following image, **AddAltToImg** was entered in the **Search Script** input box.</span></span>  
    ![](bundling-and-minification/_static/image6.png)

<span data-ttu-id="04b1e-171">如需使用 F12 開發人員工具進行偵錯工具的詳細資訊，請參閱 MSDN 文章[使用 F12 開發人員工具來調試 JavaScript 錯誤](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx)。</span><span class="sxs-lookup"><span data-stu-id="04b1e-171">For more information on debugging with the F12 developer tools, see the MSDN article [Using the F12 Developer Tools to Debug JavaScript Errors](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx).</span></span>

## <a name="controlling-bundling-and-minification"></a><span data-ttu-id="04b1e-172">控制捆綁和縮制</span><span class="sxs-lookup"><span data-stu-id="04b1e-172">Controlling Bundling and Minification</span></span>

<span data-ttu-id="04b1e-173">在*web.config*檔案的[編譯元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中設定 debug 屬性的值，即可啟用或停用組合和縮制。</span><span class="sxs-lookup"><span data-stu-id="04b1e-173">Bundling and minification is enabled or disabled by setting the value of the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file.</span></span> <span data-ttu-id="04b1e-174">在下列 XML 中，`debug` 設定為 true，因此會停用組合和縮制。</span><span class="sxs-lookup"><span data-stu-id="04b1e-174">In the following XML, `debug` is set to true so bundling and minification is disabled.</span></span>

[!code-xml[Main](bundling-and-minification/samples/sample3.xml?highlight=2)]

<span data-ttu-id="04b1e-175">若要啟用捆綁和縮制，請將 `debug` 值設定為 "false"。</span><span class="sxs-lookup"><span data-stu-id="04b1e-175">To enable bundling and minification, set the `debug` value to "false".</span></span> <span data-ttu-id="04b1e-176">您可以使用 `BundleTable` 類別上的 `EnableOptimizations` 屬性來覆寫*web.config*設定。</span><span class="sxs-lookup"><span data-stu-id="04b1e-176">You can override the *Web.config* setting with the `EnableOptimizations` property on the `BundleTable` class.</span></span> <span data-ttu-id="04b1e-177">下列程式碼會啟用捆綁和縮制，並覆寫*web.config*檔案中的任何設定。</span><span class="sxs-lookup"><span data-stu-id="04b1e-177">The following code enables bundling and minification and overrides any setting in the *Web.config* file.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample4.cs?highlight=7)]

> [!NOTE]
> <span data-ttu-id="04b1e-178">除非 `true` `EnableOptimizations`，或*web.config*檔案中[編譯](https://msdn.microsoft.com/library/s10awwz0.aspx)專案的 debug 屬性設定為 `false`，否則檔案將不會配套或縮減。</span><span class="sxs-lookup"><span data-stu-id="04b1e-178">Unless `EnableOptimizations` is `true` or the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file is set to `false`, files will not be bundled or minified.</span></span> <span data-ttu-id="04b1e-179">此外，將不會使用檔案的最小版本，將會選取完整的調試版本。</span><span class="sxs-lookup"><span data-stu-id="04b1e-179">Additionally, the .min version of files will not be used, the full debug versions will be selected.</span></span> <span data-ttu-id="04b1e-180">`EnableOptimizations` 覆寫*web.config*檔案中[編譯元素](https://msdn.microsoft.com/library/s10awwz0.aspx)的 debug 屬性</span><span class="sxs-lookup"><span data-stu-id="04b1e-180">`EnableOptimizations` overrides the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file</span></span>

## <a name="using-bundling-and-minification-with-aspnet-web-forms-and-web-pages"></a><span data-ttu-id="04b1e-181">搭配 ASP.NET Web Forms 和網頁使用配套和縮制</span><span class="sxs-lookup"><span data-stu-id="04b1e-181">Using Bundling and Minification with ASP.NET Web Forms and Web Pages</span></span>

- <span data-ttu-id="04b1e-182">若為網頁，請參閱[將 Web 優化新增至 Web 網頁網站](https://docs.microsoft.com/archive/blogs/rickandy/adding-web-optimization-to-a-web-pages-site)的 blog 專案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-182">For Web Pages, see the blog entry [Adding Web Optimization to a Web Pages Site](https://docs.microsoft.com/archive/blogs/rickandy/adding-web-optimization-to-a-web-pages-site).</span></span>
- <span data-ttu-id="04b1e-183">若為 Web form，請參閱[將配套和縮制新增至 web](https://docs.microsoft.com/archive/blogs/rickandy/adding-bundling-and-minification-to-web-forms)form 的 blog 專案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-183">For Web Forms, see the blog entry [Adding Bundling and Minification to Web Forms](https://docs.microsoft.com/archive/blogs/rickandy/adding-bundling-and-minification-to-web-forms).</span></span>

## <a name="using-bundling-and-minification-with-aspnet-mvc"></a><span data-ttu-id="04b1e-184">搭配 ASP.NET MVC 使用配套和縮制</span><span class="sxs-lookup"><span data-stu-id="04b1e-184">Using Bundling and Minification with ASP.NET MVC</span></span>

<span data-ttu-id="04b1e-185">在本節中，我們將建立 ASP.NET MVC 專案，以檢查捆綁和縮制。</span><span class="sxs-lookup"><span data-stu-id="04b1e-185">In this section we will create an ASP.NET MVC project to examine bundling and minification.</span></span> <span data-ttu-id="04b1e-186">首先，建立名為**MvcBM**的新 ASP.NET MVC 網際網路專案，而不變更任何預設值。</span><span class="sxs-lookup"><span data-stu-id="04b1e-186">First, create a new ASP.NET MVC internet project named **MvcBM** without changing any of the defaults.</span></span>

<span data-ttu-id="04b1e-187">開啟*應用程式\\\_開始\\BundleConfig.cs*檔案，並檢查用來建立、註冊及設定配套的 `RegisterBundles` 方法。</span><span class="sxs-lookup"><span data-stu-id="04b1e-187">Open the *App\\\_Start\\BundleConfig.cs* file and examine the `RegisterBundles` method which is used to create, register and configure bundles.</span></span> <span data-ttu-id="04b1e-188">下列程式碼顯示 `RegisterBundles` 方法的一部分。</span><span class="sxs-lookup"><span data-stu-id="04b1e-188">The following code shows a portion of the `RegisterBundles` method.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample5.cs)]

<span data-ttu-id="04b1e-189">上述程式碼會建立名為 *~/bundles/jquery*的新 JavaScript 組合，其中包含所有適當的（也就是 debug 或縮減，但不含）。*vsdoc*）*腳本*資料夾中符合萬用字元字串 "~/Scripts/jquery-{version}.js" 的檔案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-189">The  preceding code creates a new JavaScript bundle named *~/bundles/jquery* that includes all the appropriate (that is debug or minified but not .*vsdoc*) files in the *Scripts* folder that match the wild card string "~/Scripts/jquery-{version}.js".</span></span> <span data-ttu-id="04b1e-190">針對 ASP.NET MVC 4，這表示使用 debug 設定，檔案*jquery-1.7.2.min.js 1.7.1*會新增至套件組合。</span><span class="sxs-lookup"><span data-stu-id="04b1e-190">For ASP.NET MVC 4, this means with a debug configuration, the file *jquery-1.7.1.js* will be added to the bundle.</span></span> <span data-ttu-id="04b1e-191">在發行設定中，將會新增*jquery-1.7.2.min.js 1.7.1。*</span><span class="sxs-lookup"><span data-stu-id="04b1e-191">In a release configuration, *jquery-1.7.1.min.js* will be added.</span></span> <span data-ttu-id="04b1e-192">配套架構會遵循數個常見的慣例，例如：</span><span class="sxs-lookup"><span data-stu-id="04b1e-192">The bundling framework follows several common conventions such as:</span></span>

- <span data-ttu-id="04b1e-193">當*FileX* *檔案存在時*，選取 ". min" 檔案以供發行。</span><span class="sxs-lookup"><span data-stu-id="04b1e-193">Selecting ".min" file for release when *FileX.min.js* and *FileX.js* exist.</span></span>
- <span data-ttu-id="04b1e-194">選取非「最小」版本來進行 debug。</span><span class="sxs-lookup"><span data-stu-id="04b1e-194">Selecting the non ".min" version for debug.</span></span>
- <span data-ttu-id="04b1e-195">忽略只有 IntelliSense 才會使用的 "-vsdoc" 檔案（例如*jquery-1.7.2.min.js 1.7.1-vsdoc. .js*）。</span><span class="sxs-lookup"><span data-stu-id="04b1e-195">Ignoring "-vsdoc" files (such as *jquery-1.7.1-vsdoc.js*), which are used only by IntelliSense.</span></span>

<span data-ttu-id="04b1e-196">上述的 `{version}` 萬用字元比對是用來在*腳本*資料夾中，自動建立具有適當版本 jQuery 的 jquery 套件組合。</span><span class="sxs-lookup"><span data-stu-id="04b1e-196">The `{version}` wild card matching shown above is used to automatically create a jQuery bundle with the appropriate version of jQuery in your *Scripts* folder.</span></span> <span data-ttu-id="04b1e-197">在此範例中，使用萬用字元可提供下列優點：</span><span class="sxs-lookup"><span data-stu-id="04b1e-197">In this example, using a wild card provides the following benefits:</span></span>

- <span data-ttu-id="04b1e-198">可讓您使用 NuGet 更新為較新的 jQuery 版本，而不需變更您的 view 頁面中的先前組合程式碼或 jQuery 參考。</span><span class="sxs-lookup"><span data-stu-id="04b1e-198">Allows you to use NuGet to update to a newer jQuery version without changing the preceding bundling code or jQuery references in your view pages.</span></span>
- <span data-ttu-id="04b1e-199">會自動選取完整版的 debug 設定和發行組建的「最小」版本。</span><span class="sxs-lookup"><span data-stu-id="04b1e-199">Automatically selects the full version for debug configurations and the ".min" version for release builds.</span></span>

## <a name="using-a-cdn"></a><span data-ttu-id="04b1e-200">使用 CDN</span><span class="sxs-lookup"><span data-stu-id="04b1e-200">Using a CDN</span></span>

 <span data-ttu-id="04b1e-201">下列程式碼會以 CDN jQuery 套件組合取代本機 jQuery 套件組合。</span><span class="sxs-lookup"><span data-stu-id="04b1e-201">The follow code replaces the local jQuery bundle with a CDN jQuery bundle.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample6.cs)]

<span data-ttu-id="04b1e-202">在上述程式碼中，會從 CDN 要求 jQuery，而在發行模式中，jQuery 的 debug 版本將會在本機以 debug 模式提取。</span><span class="sxs-lookup"><span data-stu-id="04b1e-202">In the code above, jQuery will be requested from the CDN while in release mode and the debug version of jQuery will be fetched locally in debug mode.</span></span> <span data-ttu-id="04b1e-203">使用 CDN 時，您應該擁有回退機制，以防 CDN 要求失敗。</span><span class="sxs-lookup"><span data-stu-id="04b1e-203">When using a CDN, you should have a fallback mechanism in case the CDN request fails.</span></span> <span data-ttu-id="04b1e-204">下列來自版面配置檔案結尾的標記片段，會顯示在 CDN 失敗時，新增至要求 jQuery 的腳本。</span><span class="sxs-lookup"><span data-stu-id="04b1e-204">The following markup fragment from the end of the layout file shows script added to request jQuery should the CDN fail.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample7.cshtml?highlight=5-13)]

## <a name="creating-a-bundle"></a><span data-ttu-id="04b1e-205">建立配套</span><span class="sxs-lookup"><span data-stu-id="04b1e-205">Creating a Bundle</span></span>

<span data-ttu-id="04b1e-206">配套[類別 `Include`](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)方法會接受字串陣列，其中每個字串都是資源的虛擬路徑。</span><span class="sxs-lookup"><span data-stu-id="04b1e-206">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `Include` method takes an array of strings, where each string is a virtual path to resource.</span></span> <span data-ttu-id="04b1e-207">應用程式\\中 `RegisterBundles` 方法的下列*程式碼 \_啟動\\BundleConfig.cs*檔案會顯示如何將多個檔案新增至組合：</span><span class="sxs-lookup"><span data-stu-id="04b1e-207">The following code from the `RegisterBundles` method in the *App\\\_Start\\BundleConfig.cs* file shows how multiple files are added to a bundle:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample8.cs)]

<span data-ttu-id="04b1e-208">提供的配套類別 `IncludeDirectory` 方法，[可在目錄](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)（及所有子目錄）中新增符合搜尋模式的所有檔案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-208">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` method is provided to add all the files in a directory (and optionally all subdirectories) which match a search pattern.</span></span> <span data-ttu-id="04b1e-209">套件[組合類別 `IncludeDirectory`](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) API 如下所示：</span><span class="sxs-lookup"><span data-stu-id="04b1e-209">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` API is shown below:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample9.cs)]

<span data-ttu-id="04b1e-210">使用 Render 方法（適用于 CSS 的`Styles.Render` 和 JavaScript 的 `Scripts.Render`）在 views 中參考配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-210">Bundles are referenced in views using the Render method, (`Styles.Render` for CSS and `Scripts.Render` for JavaScript).</span></span> <span data-ttu-id="04b1e-211">下列來自*Views\\共用\\\_Layout*檔案的標記會顯示預設 ASP.NET internet project VIEW 參考 CSS 和 JavaScript 組合的方式。</span><span class="sxs-lookup"><span data-stu-id="04b1e-211">The following markup from the *Views\\Shared\\\_Layout.cshtml* file shows how the default ASP.NET internet project views reference CSS and JavaScript bundles.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample10.cshtml?highlight=5-6,11)]

<span data-ttu-id="04b1e-212">請注意，Render 方法會接受字串陣列，因此您可以在一行程式碼中加入多個組合。</span><span class="sxs-lookup"><span data-stu-id="04b1e-212">Notice the Render methods takes an array of strings, so you can add multiple bundles in one line of code.</span></span> <span data-ttu-id="04b1e-213">您通常會想要使用呈現方法，以建立必要的 HTML 來參考資產。</span><span class="sxs-lookup"><span data-stu-id="04b1e-213">You will generally want to use the Render methods which create the necessary HTML to reference the asset.</span></span> <span data-ttu-id="04b1e-214">您可以使用 `Url` 方法來產生資產的 URL，而不需要參考資產所需的標記。</span><span class="sxs-lookup"><span data-stu-id="04b1e-214">You can use the `Url` method to generate the URL to the asset without the markup needed to reference the asset.</span></span> <span data-ttu-id="04b1e-215">假設您想要使用新的 HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async)屬性。</span><span class="sxs-lookup"><span data-stu-id="04b1e-215">Suppose you wanted to use the new HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async) attribute.</span></span> <span data-ttu-id="04b1e-216">下列程式碼顯示如何使用 `Url` 方法來參考 modernizr。</span><span class="sxs-lookup"><span data-stu-id="04b1e-216">The following code shows how to reference modernizr using the `Url` method.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample11.cshtml?highlight=11)]

## <a name="using-the--wildcard-character-to-select-files"></a><span data-ttu-id="04b1e-217">使用 "\*" 萬用字元來選取檔案</span><span class="sxs-lookup"><span data-stu-id="04b1e-217">Using the "\*" Wildcard Character to Select Files</span></span>

<span data-ttu-id="04b1e-218">在 `Include` 方法中指定的虛擬路徑和 `IncludeDirectory` 方法中的搜尋模式，可以接受一個 "\*" 萬用字元做為最後一個路徑區段中的前置詞或後置字元。</span><span class="sxs-lookup"><span data-stu-id="04b1e-218">The virtual path specified in the `Include` method and the search pattern in the `IncludeDirectory` method can accept one "\*" wildcard character as a prefix or suffix to in the last path segment.</span></span> <span data-ttu-id="04b1e-219">搜尋字串不區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="04b1e-219">The search string is case insensitive.</span></span> <span data-ttu-id="04b1e-220">`IncludeDirectory` 方法可選擇搜尋子目錄。</span><span class="sxs-lookup"><span data-stu-id="04b1e-220">The `IncludeDirectory` method has the option of searching subdirectories.</span></span>

<span data-ttu-id="04b1e-221">請考慮具有下列 JavaScript 檔案的專案：</span><span class="sxs-lookup"><span data-stu-id="04b1e-221">Consider a project with the following JavaScript files:</span></span>

- <span data-ttu-id="04b1e-222">*\\Common\\AddAltToImg 的腳本*</span><span class="sxs-lookup"><span data-stu-id="04b1e-222">*Scripts\\Common\\AddAltToImg.js*</span></span>
- <span data-ttu-id="04b1e-223">*\\Common\\ToggleDiv 的腳本*</span><span class="sxs-lookup"><span data-stu-id="04b1e-223">*Scripts\\Common\\ToggleDiv.js*</span></span>
- <span data-ttu-id="04b1e-224">*\\Common\\ToggleImg 的腳本*</span><span class="sxs-lookup"><span data-stu-id="04b1e-224">*Scripts\\Common\\ToggleImg.js*</span></span>
- <span data-ttu-id="04b1e-225">*\\Common\\Sub1\\ToggleLinks 的腳本*</span><span class="sxs-lookup"><span data-stu-id="04b1e-225">*Scripts\\Common\\Sub1\\ToggleLinks.js*</span></span>

![dir imag](bundling-and-minification/_static/image7.png)

<span data-ttu-id="04b1e-227">下表顯示使用萬用字元新增至組合的檔案，如下所示：</span><span class="sxs-lookup"><span data-stu-id="04b1e-227">The following table shows the files added to a bundle using the wildcard as shown:</span></span>

| <span data-ttu-id="04b1e-228">**Call**</span><span class="sxs-lookup"><span data-stu-id="04b1e-228">**Call**</span></span> | <span data-ttu-id="04b1e-229">**已新增檔案或引發例外狀況**</span><span class="sxs-lookup"><span data-stu-id="04b1e-229">**Files Added or Exception Raised**</span></span> |
| --- | --- |
| <span data-ttu-id="04b1e-230">Include （"~/Scripts/Common/\*.js"）</span><span class="sxs-lookup"><span data-stu-id="04b1e-230">Include("~/Scripts/Common/\*.js")</span></span> | <span data-ttu-id="04b1e-231">*AddAltToImg .js*、 *ToggleDiv*、 *ToggleImg .js*</span><span class="sxs-lookup"><span data-stu-id="04b1e-231">*AddAltToImg.js*, *ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="04b1e-232">Include （"~/Scripts/Common/T\*.js"）</span><span class="sxs-lookup"><span data-stu-id="04b1e-232">Include("~/Scripts/Common/T\*.js")</span></span> | <span data-ttu-id="04b1e-233">不正確模式例外狀況。</span><span class="sxs-lookup"><span data-stu-id="04b1e-233">Invalid pattern exception.</span></span> <span data-ttu-id="04b1e-234">萬用字元只允許用於前置詞或後置字元。</span><span class="sxs-lookup"><span data-stu-id="04b1e-234">The wildcard character is only allowed on the prefix or suffix.</span></span> |
| <span data-ttu-id="04b1e-235">包含（"~/Scripts/Common/\*og。\*"）</span><span class="sxs-lookup"><span data-stu-id="04b1e-235">Include("~/Scripts/Common/\*og.\*")</span></span> | <span data-ttu-id="04b1e-236">不正確模式例外狀況。</span><span class="sxs-lookup"><span data-stu-id="04b1e-236">Invalid pattern exception.</span></span> <span data-ttu-id="04b1e-237">只允許一個萬用字元。</span><span class="sxs-lookup"><span data-stu-id="04b1e-237">Only one wildcard character is allowed.</span></span> |
| <span data-ttu-id="04b1e-238">Include （"~/Scripts/Common/T\*"）</span><span class="sxs-lookup"><span data-stu-id="04b1e-238">Include("~/Scripts/Common/T\*")</span></span> | <span data-ttu-id="04b1e-239">*ToggleDiv .js*、 *ToggleImg*</span><span class="sxs-lookup"><span data-stu-id="04b1e-239">*ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="04b1e-240">Include （"~/Scripts/Common/\*"）</span><span class="sxs-lookup"><span data-stu-id="04b1e-240">Include("~/Scripts/Common/\*")</span></span> | <span data-ttu-id="04b1e-241">不正確模式例外狀況。</span><span class="sxs-lookup"><span data-stu-id="04b1e-241">Invalid pattern exception.</span></span> <span data-ttu-id="04b1e-242">純萬用字元區段無效。</span><span class="sxs-lookup"><span data-stu-id="04b1e-242">A pure wildcard segment is not valid.</span></span> |
| <span data-ttu-id="04b1e-243">IncludeDirectory （"~/Scripts/Common"，"T\*"）</span><span class="sxs-lookup"><span data-stu-id="04b1e-243">IncludeDirectory("~/Scripts/Common", "T\*")</span></span> | <span data-ttu-id="04b1e-244">*ToggleDiv .js*、 *ToggleImg*</span><span class="sxs-lookup"><span data-stu-id="04b1e-244">*ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="04b1e-245">IncludeDirectory （"~/Scripts/Common"，"T\*"，true）</span><span class="sxs-lookup"><span data-stu-id="04b1e-245">IncludeDirectory("~/Scripts/Common", "T\*", true)</span></span> | <span data-ttu-id="04b1e-246">*ToggleDiv .js*、 *ToggleImg*、 *ToggleLinks .js*</span><span class="sxs-lookup"><span data-stu-id="04b1e-246">*ToggleDiv.js*, *ToggleImg.js*, *ToggleLinks.js*</span></span> |

<span data-ttu-id="04b1e-247">將每個檔案明確新增至套件組合通常是檔案的萬用字元載入的慣用選項，原因如下：</span><span class="sxs-lookup"><span data-stu-id="04b1e-247">Explicitly adding each file to a bundle is generally the preferred over wildcard loading of files for the following reasons:</span></span>

- <span data-ttu-id="04b1e-248">依萬用字元新增腳本預設為依字母順序載入，這通常不是您想要的。</span><span class="sxs-lookup"><span data-stu-id="04b1e-248">Adding scripts by wildcard defaults to loading them in alphabetical order, which is typically not what you want.</span></span> <span data-ttu-id="04b1e-249">CSS 和 JavaScript 檔案經常需要以特定（非英文字母）順序加入。</span><span class="sxs-lookup"><span data-stu-id="04b1e-249">CSS and JavaScript files frequently need to be added in a specific (non-alphabetic) order.</span></span> <span data-ttu-id="04b1e-250">您可以藉由新增自訂[IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx)執行來降低這項風險，但明確新增每個檔案較不容易出錯。</span><span class="sxs-lookup"><span data-stu-id="04b1e-250">You can mitigate this risk by adding a custom [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation, but explicitly adding each file is less error prone.</span></span> <span data-ttu-id="04b1e-251">例如，您可能會在未來將新資產新增至資料夾，這可能會要求您修改[IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx)的執行。</span><span class="sxs-lookup"><span data-stu-id="04b1e-251">For example, you might add new assets to a folder in the future which might require you to modify your [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation.</span></span>
- <span data-ttu-id="04b1e-252">使用萬用字元載入來查看新增至目錄的特定檔案，可以包含在所有參考該組合的視圖中。</span><span class="sxs-lookup"><span data-stu-id="04b1e-252">View specific files added to a directory using wild card loading can be included in all views referencing that bundle.</span></span> <span data-ttu-id="04b1e-253">如果將 view 特定的腳本新增至組合，您可能會在參考該組合的其他視圖上收到 JavaScript 錯誤。</span><span class="sxs-lookup"><span data-stu-id="04b1e-253">If the view specific script is added to a bundle, you may get a JavaScript error on other views that reference the bundle.</span></span>
- <span data-ttu-id="04b1e-254">匯入其他檔案的 CSS 檔案會導致匯入的檔案載入兩次。</span><span class="sxs-lookup"><span data-stu-id="04b1e-254">CSS files that import other files result in the imported files loaded twice.</span></span> <span data-ttu-id="04b1e-255">例如，下列程式碼會建立套件組合，其中大部分的 jQuery UI 主題 CSS 檔案都會載入兩次。</span><span class="sxs-lookup"><span data-stu-id="04b1e-255">For example, the following code creates a bundle with most of the jQuery UI theme CSS files loaded twice.</span></span> 

    [!code-csharp[Main](bundling-and-minification/samples/sample12.cs)]

  <span data-ttu-id="04b1e-256">萬用字元選取器 "\*.css 會帶入資料夾中的每個 CSS 檔案，包括*內容\\主題\\基底\\jquery. ui. 所有 .css*檔案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-256">The wild card selector "\*.css" brings in each CSS file in the folder, including the *Content\\themes\\base\\jquery.ui.all.css* file.</span></span> <span data-ttu-id="04b1e-257">*Jquery. 所有 .css 檔案都會*匯入其他 css 檔案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-257">The *jquery.ui.all.css* file imports other CSS files.</span></span>

## <a name="bundle-caching"></a><span data-ttu-id="04b1e-258">套件組合快取</span><span class="sxs-lookup"><span data-stu-id="04b1e-258">Bundle Caching</span></span>

<span data-ttu-id="04b1e-259">配套會從建立組合後的一年設定 HTTP Expires 標頭。</span><span class="sxs-lookup"><span data-stu-id="04b1e-259">Bundles set the HTTP Expires Header one year from when the bundle is created.</span></span> <span data-ttu-id="04b1e-260">如果您流覽至先前查看的頁面，Fiddler 會顯示 IE 不會對配套進行條件式要求，亦即，來自 IE 的 HTTP GET 要求無法用於組合，而且沒有來自伺服器的 HTTP 304 回應。</span><span class="sxs-lookup"><span data-stu-id="04b1e-260">If you navigate to a previously viewed page, Fiddler shows IE does not make a conditional request for the bundle, that is, there are no HTTP GET requests from IE for the bundles and no HTTP 304 responses from the server.</span></span> <span data-ttu-id="04b1e-261">您可以強制 IE 使用 F5 鍵對每個組合提出條件式要求（針對每個組合產生 HTTP 304 回應）。</span><span class="sxs-lookup"><span data-stu-id="04b1e-261">You can force IE to make a conditional request for each bundle with the F5 key (resulting in a HTTP 304 response for each bundle).</span></span> <span data-ttu-id="04b1e-262">您可以使用 ^ F5 強制執行完整重新整理（針對每個組合產生 HTTP 200 回應）。</span><span class="sxs-lookup"><span data-stu-id="04b1e-262">You can force a full refresh by using ^F5 (resulting in a HTTP 200 response for each bundle.)</span></span>

<span data-ttu-id="04b1e-263">下圖顯示 [Fiddler 回應]**窗格的 [快取] 索引**標籤：</span><span class="sxs-lookup"><span data-stu-id="04b1e-263">The following image shows the **Caching** tab of the Fiddler response pane:</span></span>

![fiddler 快取影像](bundling-and-minification/_static/image8.png)

<span data-ttu-id="04b1e-265">要求</span><span class="sxs-lookup"><span data-stu-id="04b1e-265">The request</span></span>   
`http://localhost/MvcBM_time/bundles/AllMyScripts?v=r0sLDicvP58AIXN_mc3QdyVvVj5euZNzdsa2N1PKvb81`  
 <span data-ttu-id="04b1e-266">適用于配套**AllMyScripts** ，而且包含查詢字串組**v = R0sLDicvP58AIXN\\\_mc3QdyVvVj5euZNzdsa2N1PKvb81**。</span><span class="sxs-lookup"><span data-stu-id="04b1e-266">is for the bundle **AllMyScripts** and contains a query string pair **v=r0sLDicvP58AIXN\\\_mc3QdyVvVj5euZNzdsa2N1PKvb81**.</span></span> <span data-ttu-id="04b1e-267">查詢字串**v**具有值 token，這是用於快取的唯一識別碼。</span><span class="sxs-lookup"><span data-stu-id="04b1e-267">The query string **v** has a value token that is a unique identifier used for caching.</span></span> <span data-ttu-id="04b1e-268">只要配套不會變更，ASP.NET 應用程式就會使用此權杖來要求**AllMyScripts**配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-268">As long as the bundle doesn't change, the ASP.NET application will request the **AllMyScripts** bundle using this token.</span></span> <span data-ttu-id="04b1e-269">如果組合中的任何檔案有所變更，ASP.NET 優化架構將會產生新的權杖，以確保配套的瀏覽器要求會取得最新的配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-269">If any file in the bundle changes, the ASP.NET optimization framework will generate a new token, guaranteeing that browser requests for the bundle will get the latest bundle.</span></span>

<span data-ttu-id="04b1e-270">如果您執行 IE9 F12 開發人員工具，並流覽至先前載入的頁面，IE 會錯誤地顯示對每個組合和傳回 HTTP 304 的伺服器提出的條件式 GET 要求。</span><span class="sxs-lookup"><span data-stu-id="04b1e-270">If you run the IE9 F12 developer tools and navigate to a previously loaded page, IE incorrectly shows conditional GET requests made to each bundle and the server returning HTTP 304.</span></span> <span data-ttu-id="04b1e-271">您可以閱讀為什麼 IE9 在使用 Cdn 和 Expires 的 blog 專案中決定條件式要求[，以提升網站效能](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)的原因。</span><span class="sxs-lookup"><span data-stu-id="04b1e-271">You can read why IE9 has problems determining if a conditional request was made in the blog entry [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

## <a name="less-coffeescript-scss-sass-bundling"></a><span data-ttu-id="04b1e-272">LESS、CoffeeScript、SCSS、Sass 配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-272">LESS, CoffeeScript, SCSS, Sass Bundling.</span></span>

<span data-ttu-id="04b1e-273">配套和縮制架構提供處理中繼語言（例如[SCSS](http://sass-lang.com/)、 [Sass](http://sass-lang.com/)、 [LESS](http://www.dotlesscss.org/)或[Coffeescript](http://coffeescript.org/)）的機制，並將縮制之類的轉換套用至產生的配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-273">The bundling and minification framework provides a mechanism to process intermediate languages such as [SCSS](http://sass-lang.com/), [Sass](http://sass-lang.com/), [LESS](http://www.dotlesscss.org/) or [Coffeescript](http://coffeescript.org/), and apply transforms such as minification to the resulting bundle.</span></span> <span data-ttu-id="04b1e-274">例如，若要將[較少的](http://www.dotlesscss.org/)檔案新增至 MVC 4 專案：</span><span class="sxs-lookup"><span data-stu-id="04b1e-274">For example, to add [.less](http://www.dotlesscss.org/) files to your MVC 4 project:</span></span>

1. <span data-ttu-id="04b1e-275">建立較少內容的資料夾。</span><span class="sxs-lookup"><span data-stu-id="04b1e-275">Create a folder for your LESS content.</span></span> <span data-ttu-id="04b1e-276">下列範例會使用*Content\\MyLess*資料夾。</span><span class="sxs-lookup"><span data-stu-id="04b1e-276">The following example uses the *Content\\MyLess* folder.</span></span>
2. <span data-ttu-id="04b1e-277">將[較少](http://www.dotlesscss.org/)的**NuGet 套件新增至您的專案**。</span><span class="sxs-lookup"><span data-stu-id="04b1e-277">Add the [.less](http://www.dotlesscss.org/) NuGet package **dotless** to your project.</span></span>  
    <span data-ttu-id="04b1e-278">![NuGet 無點安裝](bundling-and-minification/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="04b1e-278">![NuGet dotless install](bundling-and-minification/_static/image9.png)</span></span>
3. <span data-ttu-id="04b1e-279">新增可實[IBundleTransform](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx)介面的類別。</span><span class="sxs-lookup"><span data-stu-id="04b1e-279">Add a class that implements the [IBundleTransform](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx) interface.</span></span> <span data-ttu-id="04b1e-280">對於較少的轉換，請將下列程式碼新增至您的專案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-280">For the .less transform, add the following code to your project.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample13.cs)]
4. <span data-ttu-id="04b1e-281">使用 `LessTransform` 和[CssMinify](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx)轉換建立較少檔案的組合。</span><span class="sxs-lookup"><span data-stu-id="04b1e-281">Create a bundle of LESS files with the `LessTransform` and the [CssMinify](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx) transform.</span></span> <span data-ttu-id="04b1e-282">將下列程式碼新增至*應用程式\\_Start\\BundleConfig.cs*檔案中的 `RegisterBundles` 方法。</span><span class="sxs-lookup"><span data-stu-id="04b1e-282">Add the following code to the `RegisterBundles` method in the *App\\_Start\\BundleConfig.cs* file.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample14.cs)]
5. <span data-ttu-id="04b1e-283">將下列程式碼新增至任何參考較少組合的視圖。</span><span class="sxs-lookup"><span data-stu-id="04b1e-283">Add the following code to any views which references the LESS bundle.</span></span>

    [!code-cshtml[Main](bundling-and-minification/samples/sample15.cshtml)]

## <a name="bundle-considerations"></a><span data-ttu-id="04b1e-284">配套考慮</span><span class="sxs-lookup"><span data-stu-id="04b1e-284">Bundle Considerations</span></span>

<span data-ttu-id="04b1e-285">建立配套時應遵循的良好慣例是將「配套」納入套件組合名稱中的前置詞。</span><span class="sxs-lookup"><span data-stu-id="04b1e-285">A good convention to follow when creating bundles is to include "bundle" as a prefix in the bundle name.</span></span> <span data-ttu-id="04b1e-286">這會防止可能的[路由衝突](https://forums.asp.net/post/5012037.aspx)。</span><span class="sxs-lookup"><span data-stu-id="04b1e-286">This will prevent a possible [routing conflict](https://forums.asp.net/post/5012037.aspx).</span></span>

<span data-ttu-id="04b1e-287">一旦您更新配套中的一個檔案，就會為配套查詢字串參數產生新的權杖，而且必須在下次用戶端要求包含配套的頁面時，下載完整的配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-287">Once you update one file in a bundle, a new token is generated for the bundle query string parameter and the full bundle must be downloaded the next time a client requests a page containing the bundle.</span></span> <span data-ttu-id="04b1e-288">在個別列出每個資產的傳統標記中，只會下載已變更的檔案。</span><span class="sxs-lookup"><span data-stu-id="04b1e-288">In traditional markup where each asset is listed individually, only the changed file would be downloaded.</span></span> <span data-ttu-id="04b1e-289">經常變更的資產可能不適合用來進行捆綁。</span><span class="sxs-lookup"><span data-stu-id="04b1e-289">Assets that change frequently may not be good candidates for bundling.</span></span>

<span data-ttu-id="04b1e-290">組合和縮制主要會改善第一頁的要求載入時間。</span><span class="sxs-lookup"><span data-stu-id="04b1e-290">Bundling and minification primarily improve the first page request load time.</span></span> <span data-ttu-id="04b1e-291">一旦要求網頁之後，瀏覽器就會快取資產（JavaScript、CSS 和影像），因此當要求相同的頁面或相同網站上要求相同資產的頁面時，配套和縮制不會提供任何效能提升。</span><span class="sxs-lookup"><span data-stu-id="04b1e-291">Once a webpage has been requested, the browser caches the assets (JavaScript, CSS and images) so bundling and minification won't provide any performance boost when requesting the same page, or pages on the same site requesting the same assets.</span></span> <span data-ttu-id="04b1e-292">如果您未在資產上正確設定 expires 標頭，且未使用配套和縮制，則瀏覽器的「有效啟發學習法」會在幾天後將資產標示為過時，而且瀏覽器將需要每個資產的驗證要求。</span><span class="sxs-lookup"><span data-stu-id="04b1e-292">If you don't set the expires header correctly on your assets, and you don't use bundling and minification, the browsers freshness heuristics will mark the assets stale after a few days and the browser will require a validation request for each asset.</span></span> <span data-ttu-id="04b1e-293">在此情況下，在第一頁要求之後，組合和縮制會提供效能增加。</span><span class="sxs-lookup"><span data-stu-id="04b1e-293">In this case, bundling and minification provide a performance increase after the first page request.</span></span> <span data-ttu-id="04b1e-294">如需詳細資訊，請參閱[使用 cdn 和 Expires 的 blog，以改善網站效能](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="04b1e-294">For details, see the blog [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

<span data-ttu-id="04b1e-295">藉由使用[CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)，可以降低每個主機名稱的六個同步連線的瀏覽器限制。</span><span class="sxs-lookup"><span data-stu-id="04b1e-295">The browser limitation of six simultaneous connections per each hostname can be mitigated by using a [CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span> <span data-ttu-id="04b1e-296">由於 CDN 的主機名稱會與您的主控網站不同，因此來自 CDN 的資產要求不會計算到裝載環境的六個同時連線限制。</span><span class="sxs-lookup"><span data-stu-id="04b1e-296">Because the CDN will have a different hostname than your hosting site, asset requests from the CDN will not count against the six simultaneous connections limit to your hosting environment.</span></span> <span data-ttu-id="04b1e-297">CDN 也可以提供常見的套件快取和邊緣快取優勢。</span><span class="sxs-lookup"><span data-stu-id="04b1e-297">A CDN can also provide common package caching and edge caching advantages.</span></span>

<span data-ttu-id="04b1e-298">組合應該依需要的頁面進行分割。</span><span class="sxs-lookup"><span data-stu-id="04b1e-298">Bundles should be partitioned by pages that need them.</span></span> <span data-ttu-id="04b1e-299">例如，網際網路應用程式的預設 ASP.NET MVC 範本會建立與 jQuery 分開的 jQuery 驗證配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-299">For example, the default ASP.NET MVC template for an internet application creates a jQuery Validation bundle separate from jQuery.</span></span> <span data-ttu-id="04b1e-300">因為所建立的預設 views 沒有輸入，而且不會張貼值，所以它們不會包含驗證配套。</span><span class="sxs-lookup"><span data-stu-id="04b1e-300">Because the default views created have no input and do not post values, they don't include the validation bundle.</span></span>

<span data-ttu-id="04b1e-301">`System.Web.Optimization` 命名空間會實作為*system.web.*</span><span class="sxs-lookup"><span data-stu-id="04b1e-301">The `System.Web.Optimization` namespace is implemented in *System.Web.Optimization.dll*.</span></span> <span data-ttu-id="04b1e-302">它會利用 WebGrease 程式庫（*WebGrease*）來取得縮制功能，而這又會使用*Antlr3*。</span><span class="sxs-lookup"><span data-stu-id="04b1e-302">It leverages the WebGrease library (*WebGrease.dll*) for minification capabilities, which in turn uses *Antlr3.Runtime.dll*.</span></span>

<span data-ttu-id="04b1e-303">*我使用 Twitter 來進行快速貼文及分享連結。我的 Twitter 控制碼為*： [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="04b1e-303">*I use Twitter to make quick posts and share links. My Twitter handle is*: [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="04b1e-304">其他資源</span><span class="sxs-lookup"><span data-stu-id="04b1e-304">Additional resources</span></span>

- <span data-ttu-id="04b1e-305">影片： [Howard Dierking](https://twitter.com/#!/howard_dierking)的組合[和優化](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing)</span><span class="sxs-lookup"><span data-stu-id="04b1e-305">Video:[Bundling and Optimizing](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing) by [Howard Dierking](https://twitter.com/#!/howard_dierking)</span></span>
- <span data-ttu-id="04b1e-306">[將 Web 優化新增至 Web Pages 網站](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx)。</span><span class="sxs-lookup"><span data-stu-id="04b1e-306">[Adding Web Optimization to a Web Pages Site](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span></span>
- <span data-ttu-id="04b1e-307">[將配套和縮制新增至 Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx)。</span><span class="sxs-lookup"><span data-stu-id="04b1e-307">[Adding Bundling and Minification to Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span></span>
- <span data-ttu-id="04b1e-308">[Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk) [的網頁流覽上的組合和縮制效能影響](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx)</span><span class="sxs-lookup"><span data-stu-id="04b1e-308">[Performance Implications of Bundling and Minification on Web Browsing](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx) by [Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk)</span></span>
- <span data-ttu-id="04b1e-309">[使用 cdn 和 Expires](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) ，透過 Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)改善網站效能</span><span class="sxs-lookup"><span data-stu-id="04b1e-309">[Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) by Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span></span>
- [<span data-ttu-id="04b1e-310">最小化 RTT （來回時間）</span><span class="sxs-lookup"><span data-stu-id="04b1e-310">Minimize RTT (round-trip times)</span></span>](https://developers.google.com/speed/docs/best-practices/rtt)

## <a name="contributors"></a><span data-ttu-id="04b1e-311">參與者</span><span class="sxs-lookup"><span data-stu-id="04b1e-311">Contributors</span></span>

- <span data-ttu-id="04b1e-312">Hao Kung</span><span class="sxs-lookup"><span data-stu-id="04b1e-312">Hao Kung</span></span>
- [<span data-ttu-id="04b1e-313">Howard Dierking</span><span class="sxs-lookup"><span data-stu-id="04b1e-313">Howard Dierking</span></span>](https://twitter.com/#!/howard_dierking)
- <span data-ttu-id="04b1e-314">Diana LaRose</span><span class="sxs-lookup"><span data-stu-id="04b1e-314">Diana LaRose</span></span>
