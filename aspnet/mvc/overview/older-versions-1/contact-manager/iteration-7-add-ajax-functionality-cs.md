---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
title: 反覆運算#7 = 添加 Ajax 功能 (C#) |微軟文件
author: rick-anderson
description: 在第七次反覆運算中,我們通過增加對Ajax的支援來提高應用程式的回應性和性能。
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f1b0809e-8909-444e-b6bb-a5cd1dea3f72
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
msc.type: authoredcontent
ms.openlocfilehash: 12d7348382bc55af049567922bd6963970a9421b
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542309"
---
# <a name="iteration-7--add-ajax-functionality-c"></a><span data-ttu-id="26411-103">反覆項目 #7 – 新增 Ajax 功能 (C#)</span><span class="sxs-lookup"><span data-stu-id="26411-103">Iteration #7 – Add Ajax functionality (C#)</span></span>

<span data-ttu-id="26411-104">由[微軟](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="26411-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="26411-105">下載代碼</span><span class="sxs-lookup"><span data-stu-id="26411-105">Download Code</span></span>](iteration-7-add-ajax-functionality-cs/_static/contactmanager_7_cs1.zip)

> <span data-ttu-id="26411-106">在第七次反覆運算中,我們通過增加對Ajax的支援來提高應用程式的回應性和性能。</span><span class="sxs-lookup"><span data-stu-id="26411-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="26411-107">編譯聯絡人管理ASP.NET MVC 應用程式 (C#)</span><span class="sxs-lookup"><span data-stu-id="26411-107">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="26411-108">在本系列教程中,我們從頭到尾構建整個聯繫人管理應用程式。</span><span class="sxs-lookup"><span data-stu-id="26411-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="26411-109">透過聯絡人管理員應用程式,您可以儲存連絡人資訊 (姓名、電話號碼和電子郵件位址) 人員清單。</span><span class="sxs-lookup"><span data-stu-id="26411-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="26411-110">我們通過多次反覆運算構建應用程式。</span><span class="sxs-lookup"><span data-stu-id="26411-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="26411-111">每次反覆運算時,我們都會逐步改進應用程式。</span><span class="sxs-lookup"><span data-stu-id="26411-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="26411-112">此多反覆運算方法的目標是使您能夠瞭解每次更改的原因。</span><span class="sxs-lookup"><span data-stu-id="26411-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="26411-113">反覆運算#1 - 創建應用程式。</span><span class="sxs-lookup"><span data-stu-id="26411-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="26411-114">在第一次反覆運算中,我們以最簡單的方式創建聯繫人管理器。</span><span class="sxs-lookup"><span data-stu-id="26411-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="26411-115">我們添加對基本資料庫操作的支援:創建、讀取、更新和刪除 (CRUD)。</span><span class="sxs-lookup"><span data-stu-id="26411-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="26411-116">反覆運算#2 - 使應用程式看起來不錯。</span><span class="sxs-lookup"><span data-stu-id="26411-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="26411-117">在此反覆運算中,我們通過修改預設ASP.NET MVC 檢視母版頁和級聯樣式表來改進應用程式的外觀。</span><span class="sxs-lookup"><span data-stu-id="26411-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="26411-118">反覆運算#3 - 添加表單驗證。</span><span class="sxs-lookup"><span data-stu-id="26411-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="26411-119">在第三個反覆運算中,我們添加基本表單驗證。</span><span class="sxs-lookup"><span data-stu-id="26411-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="26411-120">我們防止人們在未填寫所需表單欄位的情況下提交表單。</span><span class="sxs-lookup"><span data-stu-id="26411-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="26411-121">我們還驗證電子郵件地址和電話號碼。</span><span class="sxs-lookup"><span data-stu-id="26411-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="26411-122">反覆運算#4 - 使應用程式鬆散耦合。</span><span class="sxs-lookup"><span data-stu-id="26411-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="26411-123">在第四次反覆運算中,我們利用多種軟體設計模式,使維護和修改聯繫人管理器應用程式變得更加容易。</span><span class="sxs-lookup"><span data-stu-id="26411-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="26411-124">例如,我們重構應用程式以使用存儲庫模式和依賴項注入模式。</span><span class="sxs-lookup"><span data-stu-id="26411-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="26411-125">反覆運算#5 - 創建單元測試。</span><span class="sxs-lookup"><span data-stu-id="26411-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="26411-126">在第五次反覆運算中,我們通過添加單元測試使應用程式更易於維護和修改。</span><span class="sxs-lookup"><span data-stu-id="26411-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="26411-127">我們類比數據模型類,並為控制器和驗證邏輯構建單元測試。</span><span class="sxs-lookup"><span data-stu-id="26411-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="26411-128">反覆運算#6 - 使用測試驅動開發。</span><span class="sxs-lookup"><span data-stu-id="26411-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="26411-129">在第六次反覆運算中,我們首先編寫單元測試並針對單元測試編寫代碼,從而向應用程式添加新功能。</span><span class="sxs-lookup"><span data-stu-id="26411-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="26411-130">在此反覆運算中,我們添加聯繫人組。</span><span class="sxs-lookup"><span data-stu-id="26411-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="26411-131">反覆運算#7 - 添加Ajax功能。</span><span class="sxs-lookup"><span data-stu-id="26411-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="26411-132">在第七次反覆運算中,我們通過增加對Ajax的支援來提高應用程式的回應性和性能。</span><span class="sxs-lookup"><span data-stu-id="26411-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="26411-133">此反覆運算</span><span class="sxs-lookup"><span data-stu-id="26411-133">This Iteration</span></span>

<span data-ttu-id="26411-134">在此反覆運算的聯繫人管理器應用程式中,我們將重構應用程式以使用 Ajax。</span><span class="sxs-lookup"><span data-stu-id="26411-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="26411-135">通過使用Ajax,我們使我們的應用程式回應更快。</span><span class="sxs-lookup"><span data-stu-id="26411-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="26411-136">當只需要更新頁面中的某個區域時,我們可以避免呈現整個頁面。</span><span class="sxs-lookup"><span data-stu-id="26411-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="26411-137">我們將重構索引視圖,以便每當有人選擇新的聯繫人組時,我們就不需要重新顯示整個頁面。</span><span class="sxs-lookup"><span data-stu-id="26411-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="26411-138">相反,當有人單擊聯繫人組時,我們只會更新聯繫人清單,並單獨保留頁面的其餘部分。</span><span class="sxs-lookup"><span data-stu-id="26411-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="26411-139">我們還將更改刪除連結的工作方式。</span><span class="sxs-lookup"><span data-stu-id="26411-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="26411-140">我們將顯示 JAVAScript 確認對話框,而不是顯示單獨的確認頁。</span><span class="sxs-lookup"><span data-stu-id="26411-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="26411-141">如果確認要刪除連絡人,則對伺服器執行 HTTP DELETE 操作以從資料庫中刪除連絡人記錄。</span><span class="sxs-lookup"><span data-stu-id="26411-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="26411-142">此外,我們將利用 jQuery 將動畫效果添加到索引檢視中。</span><span class="sxs-lookup"><span data-stu-id="26411-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="26411-143">當從伺服器提取新的聯繫人清單時,我們將顯示一個動畫。</span><span class="sxs-lookup"><span data-stu-id="26411-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="26411-144">最後,我們將利用ASP.NETAJAX框架支援來管理瀏覽器歷史記錄。</span><span class="sxs-lookup"><span data-stu-id="26411-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="26411-145">每當執行 Ajax 調用以更新聯繫人清單時,我們都會創建歷史記錄點。</span><span class="sxs-lookup"><span data-stu-id="26411-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="26411-146">這樣,瀏覽器的後退和向前按鈕將工作。</span><span class="sxs-lookup"><span data-stu-id="26411-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="26411-147">為什麼要使用Ajax?</span><span class="sxs-lookup"><span data-stu-id="26411-147">Why use Ajax?</span></span>

<span data-ttu-id="26411-148">使用Ajax有很多好處。</span><span class="sxs-lookup"><span data-stu-id="26411-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="26411-149">首先,將Ajax功能添加到應用程式中可以提供更好的用戶體驗。</span><span class="sxs-lookup"><span data-stu-id="26411-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="26411-150">在正常 Web 應用程式中,每次使用者執行操作時,都必須將整個頁面發回伺服器。</span><span class="sxs-lookup"><span data-stu-id="26411-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="26411-151">每當執行操作時,瀏覽器都會鎖定,用戶必須等待,直到提取並重新顯示整個頁面。</span><span class="sxs-lookup"><span data-stu-id="26411-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="26411-152">在桌面應用程序的情況下,這是不可接受的體驗。</span><span class="sxs-lookup"><span data-stu-id="26411-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="26411-153">但是,傳統上,我們生活在一個Web應用程序的情況下,這種糟糕的用戶體驗,因為我們不知道我們可以做得更好。</span><span class="sxs-lookup"><span data-stu-id="26411-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="26411-154">我們認為這是Web應用程式的一個限制,而實際上,這隻是我們想像力的一個限制。</span><span class="sxs-lookup"><span data-stu-id="26411-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="26411-155">在 Ajax 應用程式中,無需僅更新頁面就停止用戶體驗。</span><span class="sxs-lookup"><span data-stu-id="26411-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="26411-156">相反,您可以在後台執行非同步請求以更新頁面。</span><span class="sxs-lookup"><span data-stu-id="26411-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="26411-157">在頁面部分更新時,不會強制使用者等待。</span><span class="sxs-lookup"><span data-stu-id="26411-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="26411-158">通過使用Ajax,您還可以提高應用程式的性能。</span><span class="sxs-lookup"><span data-stu-id="26411-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="26411-159">請考慮聯繫人管理器應用程式現在如何工作,而無需 Ajax 功能。</span><span class="sxs-lookup"><span data-stu-id="26411-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="26411-160">按一下聯絡人組時,必須重新顯示整個索引檢視。</span><span class="sxs-lookup"><span data-stu-id="26411-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="26411-161">必須從資料庫伺服器檢索聯繫人列表和連絡人組清單。</span><span class="sxs-lookup"><span data-stu-id="26411-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="26411-162">所有這些資料都必須通過從 Web 伺服器到 Web 瀏覽器的線傳遞。</span><span class="sxs-lookup"><span data-stu-id="26411-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="26411-163">但是,在將 Ajax 功能添加到應用程式後,我們可以避免在使用者單擊聯繫人組時重新播放整個頁面。</span><span class="sxs-lookup"><span data-stu-id="26411-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="26411-164">我們不再需要從資料庫獲取聯繫人組。</span><span class="sxs-lookup"><span data-stu-id="26411-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="26411-165">我們也不需要將整個索引視圖推送到導線上。</span><span class="sxs-lookup"><span data-stu-id="26411-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="26411-166">通過使用 Ajax,我們減少了資料庫伺服器必須執行的工作量,並減少了應用程式所需的網路流量。</span><span class="sxs-lookup"><span data-stu-id="26411-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="26411-167">不要害怕阿賈克斯</span><span class="sxs-lookup"><span data-stu-id="26411-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="26411-168">一些開發人員避免使用Ajax,因為他們擔心低級瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="26411-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="26411-169">他們希望確保他們的 Web 應用程式在不受支援 JAvaScript 的瀏覽器訪問時仍然有效。</span><span class="sxs-lookup"><span data-stu-id="26411-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="26411-170">由於Ajax依賴於JAVAScript,一些開發人員避免使用Ajax。</span><span class="sxs-lookup"><span data-stu-id="26411-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="26411-171">但是,如果您對如何實現Ajax很小心,則可以構建同時使用高級瀏覽器和低級瀏覽器的應用程式。</span><span class="sxs-lookup"><span data-stu-id="26411-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="26411-172">我們的連絡人管理員應用程式將適用於支援 JAVAScript 的瀏覽器和不支援的瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="26411-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="26411-173">如果將連絡人管理員應用程式與支援 JAvaScript 的瀏覽器一起使用,那麼您將有更好的用戶體驗。</span><span class="sxs-lookup"><span data-stu-id="26411-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="26411-174">例如,當您按一下連絡人組時,將僅更新顯示聯絡人的頁面區域。</span><span class="sxs-lookup"><span data-stu-id="26411-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="26411-175">另一方面,如果將聯繫人管理器應用程式用於不支援 JAVAScript(或禁用了 JAVAScript)的瀏覽器,則您的使用者體驗將稍遜一籌。</span><span class="sxs-lookup"><span data-stu-id="26411-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="26411-176">例如,當您按一下連絡人組時,必須將整個 Index 檢視發回瀏覽器才能顯示聯絡人的匹配清單。</span><span class="sxs-lookup"><span data-stu-id="26411-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="26411-177">新增需要的 JavaScript 檔案</span><span class="sxs-lookup"><span data-stu-id="26411-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="26411-178">我們需要使用三個 JavaScript 檔將 Ajax 功能添加到我們的應用程式中。</span><span class="sxs-lookup"><span data-stu-id="26411-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="26411-179">所有這些檔都包含在新的ASP.NET MVC 應用程式的文本資料夾中。</span><span class="sxs-lookup"><span data-stu-id="26411-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="26411-180">如果您計劃在應用程式中的多個頁面中使用Ajax,那麼在應用程式的檢視母版頁中包含所需的 JAVAScript 檔是有意義的。</span><span class="sxs-lookup"><span data-stu-id="26411-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="26411-181">這樣,JavaScript 檔將自動包含在應用程式中的所有頁面中。</span><span class="sxs-lookup"><span data-stu-id="26411-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="26411-182">在檢視母版頁&lt;的頭部&gt;標記中加入以下 JAVAScript:</span><span class="sxs-lookup"><span data-stu-id="26411-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-cs/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="26411-183">重構索引檢視以使用 Ajax</span><span class="sxs-lookup"><span data-stu-id="26411-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="26411-184">讓我們首先修改我們的 Index 檢視,以便單擊連絡人組僅更新顯示聯絡人的檢視區域。</span><span class="sxs-lookup"><span data-stu-id="26411-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="26411-185">圖 1 中的紅色框包含我們要更新的區域。</span><span class="sxs-lookup"><span data-stu-id="26411-185">The red box in Figure 1 contains the region that we want to update.</span></span>

<span data-ttu-id="26411-186">[![只更新聯絡人](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="26411-186">[![Updating only contacts](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span></span>

<span data-ttu-id="26411-187">**圖 01**:僅更新聯絡人([按下以檢視全尺寸影像](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="26411-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span></span>

<span data-ttu-id="26411-188">第一步是將要異步更新的視圖部分分離為單獨的部分(視圖使用者控件)。</span><span class="sxs-lookup"><span data-stu-id="26411-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="26411-189">顯示聯絡人表的 Index 檢視部分已移動到清單 1 中的部分。</span><span class="sxs-lookup"><span data-stu-id="26411-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="26411-190">**清單 1 - 檢視\連絡人\連絡人清單.ascx**</span><span class="sxs-lookup"><span data-stu-id="26411-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample2.aspx)]

<span data-ttu-id="26411-191">請注意,清單 1 中的部分具有與索引視圖不同的模型。</span><span class="sxs-lookup"><span data-stu-id="26411-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="26411-192">%@ Page&lt;&gt;%&lt;指令中的*繼承*屬性指定從 ViewUserControl 組&gt;類別的部分繼承。</span><span class="sxs-lookup"><span data-stu-id="26411-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="26411-193">更新的索引檢視包含在清單 2 中。</span><span class="sxs-lookup"><span data-stu-id="26411-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="26411-194">**清單2 - 檢視\連絡人\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="26411-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample3.aspx)]

<span data-ttu-id="26411-195">關於清單2中更新的視圖,您應該注意兩件事。</span><span class="sxs-lookup"><span data-stu-id="26411-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="26411-196">首先,請注意,移動到部分的所有內容都將替換為對 Html.Render 部分()的調用。</span><span class="sxs-lookup"><span data-stu-id="26411-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="26411-197">首次請求索引檢視以顯示初始連絡人集時調用 Html.Render 部分() 方法。</span><span class="sxs-lookup"><span data-stu-id="26411-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="26411-198">其次,請注意,用於顯示連絡人組的 Html.ActionLink() 已替換為 Ajax.ActionLink()。</span><span class="sxs-lookup"><span data-stu-id="26411-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="26411-199">Ajax.ActionLink()使用以下參數呼叫:</span><span class="sxs-lookup"><span data-stu-id="26411-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample4.aspx)]

<span data-ttu-id="26411-200">第一個參數表示要顯示的連結的文本,第二個參數表示路由值,第三個參數表示 Ajax 選項。</span><span class="sxs-lookup"><span data-stu-id="26411-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="26411-201">在這種情況下,我們使用 UpdateTargetId Ajax 選項來指向要在&lt;&gt;Ajax 請求完成後更新的 HTML div 標記。</span><span class="sxs-lookup"><span data-stu-id="26411-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="26411-202">我們希望使用新的聯繫人清單&lt;&gt;更新 div 標記。</span><span class="sxs-lookup"><span data-stu-id="26411-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="26411-203">聯繫人控制器的更新索引() 方法包含在清單 3 中。</span><span class="sxs-lookup"><span data-stu-id="26411-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="26411-204">**清單3 - 控制器\聯絡控制器.cs(索引方法)**</span><span class="sxs-lookup"><span data-stu-id="26411-204">**Listing 3 - Controllers\ContactController.cs (Index method)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample5.cs)]

<span data-ttu-id="26411-205">更新的 Index() 操作有條件地返回兩件事情之一。</span><span class="sxs-lookup"><span data-stu-id="26411-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="26411-206">如果 Ajax 請求調用了 Index() 操作,則控制器返回部分。</span><span class="sxs-lookup"><span data-stu-id="26411-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="26411-207">否則,Index() 操作將返回整個檢視。</span><span class="sxs-lookup"><span data-stu-id="26411-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="26411-208">請注意,當 Ajax 請求調用時,Index() 操作不需要返回盡可能多的數據。</span><span class="sxs-lookup"><span data-stu-id="26411-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="26411-209">在正常請求的上下文中,Index 操作返回所有連絡人組和所選連絡人組的清單。</span><span class="sxs-lookup"><span data-stu-id="26411-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="26411-210">在 Ajax 請求的上下文中,Index() 操作僅返回選定的組。</span><span class="sxs-lookup"><span data-stu-id="26411-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="26411-211">Ajax 意味著資料庫伺服器上的工作更少。</span><span class="sxs-lookup"><span data-stu-id="26411-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="26411-212">我們修改的 Index 檢視適用於上層瀏覽器和低級瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="26411-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="26411-213">如果按一下連絡人組,並且您的瀏覽器支援 JAVAScript,則僅更新包含連絡人清單的檢視區域。</span><span class="sxs-lookup"><span data-stu-id="26411-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="26411-214">另一方面,如果您的瀏覽器不支援 JAvaScript,則整個檢視將更新。</span><span class="sxs-lookup"><span data-stu-id="26411-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>

<span data-ttu-id="26411-215">我們更新的索引視圖有一個問題。</span><span class="sxs-lookup"><span data-stu-id="26411-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="26411-216">按一下連絡人組時,所選組不會突出顯示。</span><span class="sxs-lookup"><span data-stu-id="26411-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="26411-217">由於組清單顯示在 Ajax 請求期間更新的區域之外,因此不會突出顯示正確的組。</span><span class="sxs-lookup"><span data-stu-id="26411-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="26411-218">我們將在下一節中解決此問題。</span><span class="sxs-lookup"><span data-stu-id="26411-218">We'll fix this issue in the next section.</span></span>

## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="26411-219">新增 jQuery 動畫效果</span><span class="sxs-lookup"><span data-stu-id="26411-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="26411-220">通常,當您單擊網頁中的連結時,可以使用瀏覽器進度欄來檢測瀏覽器是否主動獲取更新的內容。</span><span class="sxs-lookup"><span data-stu-id="26411-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="26411-221">另一方面,當執行 Ajax 請求時,瀏覽器進度列不顯示任何進度。</span><span class="sxs-lookup"><span data-stu-id="26411-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="26411-222">這會使用戶感到緊張。</span><span class="sxs-lookup"><span data-stu-id="26411-222">This can make users nervous.</span></span> <span data-ttu-id="26411-223">您如何知道瀏覽器是否已凍結?</span><span class="sxs-lookup"><span data-stu-id="26411-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="26411-224">有幾種方法可以向使用者指示在執行 Ajax 請求時正在執行工作。</span><span class="sxs-lookup"><span data-stu-id="26411-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="26411-225">一種方法是顯示一個簡單的動畫。</span><span class="sxs-lookup"><span data-stu-id="26411-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="26411-226">例如,當 Ajax 請求開始並淡入該區域時,可以淡出該區域。"</span><span class="sxs-lookup"><span data-stu-id="26411-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="26411-227">我們將使用 Microsoft ASP.NET MVC 框架中包含的 jQuery 庫來創建動畫效果。</span><span class="sxs-lookup"><span data-stu-id="26411-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="26411-228">更新的索引檢視包含在清單 4 中。</span><span class="sxs-lookup"><span data-stu-id="26411-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="26411-229">**清單4 - 檢視_連絡人_Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="26411-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample6.aspx)]

<span data-ttu-id="26411-230">請注意,更新的索引檢視包含三個新的 JAVAScript 函數。</span><span class="sxs-lookup"><span data-stu-id="26411-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="26411-231">按一下新連絡人組時,前兩個函數使用 jQuery 淡入淡出並淡入聯繫人清單中。</span><span class="sxs-lookup"><span data-stu-id="26411-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="26411-232">當 Ajax 請求導致錯誤(例如,網路超時)時,第三個函數將顯示一條錯誤消息。</span><span class="sxs-lookup"><span data-stu-id="26411-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="26411-233">第一個函數還負責突出顯示所選組。</span><span class="sxs-lookup"><span data-stu-id="26411-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="26411-234">類\* 選取的屬性將添加到單擊的元素的父元素(LI 元素)。</span><span class="sxs-lookup"><span data-stu-id="26411-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="26411-235">同樣,jQuery 便於選擇正確的元素並添加 CSS 類。</span><span class="sxs-lookup"><span data-stu-id="26411-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="26411-236">這些文本在Ajax.ActionLink())AjaxOptions參數的説明下與組連結相關聯。</span><span class="sxs-lookup"><span data-stu-id="26411-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="26411-237">更新的Ajax.ActionLink()方法呼叫以下所示:</span><span class="sxs-lookup"><span data-stu-id="26411-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="26411-238">新增瀏覽器歷史記錄支援</span><span class="sxs-lookup"><span data-stu-id="26411-238">Adding Browser History Support</span></span>

<span data-ttu-id="26411-239">通常,當您按下連結以更新頁面時,您的瀏覽器歷史記錄將更新。</span><span class="sxs-lookup"><span data-stu-id="26411-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="26411-240">這樣,您可以按一下瀏覽器"後退"按鈕以及時移回頁面的上一個狀態。</span><span class="sxs-lookup"><span data-stu-id="26411-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="26411-241">例如,如果您按兩下「好友聯繫人組」然後單擊「業務聯繫人組」,則可以按一下瀏覽器「後退」按鈕,在選擇「好友聯繫人組」時導航回頁面狀態。</span><span class="sxs-lookup"><span data-stu-id="26411-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="26411-242">遺憾的是,執行 Ajax 請求不會自動更新瀏覽器歷史記錄。</span><span class="sxs-lookup"><span data-stu-id="26411-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="26411-243">如果按一下聯絡人組,並且使用 Ajax 請求檢索匹配聯絡人的清單,則瀏覽器歷史記錄不會更新。</span><span class="sxs-lookup"><span data-stu-id="26411-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="26411-244">選擇新的連絡人組後,不能使用瀏覽器"後退"按鈕導航回連絡人組。</span><span class="sxs-lookup"><span data-stu-id="26411-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="26411-245">如果您希望使用者在執行 Ajax 請求後能夠使用瀏覽器" 後退「 按鈕,則需要執行更多工作」。</span><span class="sxs-lookup"><span data-stu-id="26411-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="26411-246">您需要利用ASP.NET AJAX 框架中建構的瀏覽器歷史記錄管理功能。</span><span class="sxs-lookup"><span data-stu-id="26411-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="26411-247">ASP.NET AJAX 瀏覽器歷史記錄,您需要執行以下三項操作:</span><span class="sxs-lookup"><span data-stu-id="26411-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="26411-248">通過將啟用瀏覽器歷史記錄屬性設置為 true,啟用瀏覽器歷史記錄。</span><span class="sxs-lookup"><span data-stu-id="26411-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="26411-249">通過調用 addHistoryPoint() 方法,在檢視狀態發生變化時保存歷史記錄點。</span><span class="sxs-lookup"><span data-stu-id="26411-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="26411-250">引發導航事件時重建視圖的狀態。</span><span class="sxs-lookup"><span data-stu-id="26411-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="26411-251">更新的索引檢視包含在清單 5 中。</span><span class="sxs-lookup"><span data-stu-id="26411-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="26411-252">**清單5 - 檢視_連絡人_Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="26411-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample8.aspx)]

<span data-ttu-id="26411-253">在清單5中,瀏覽器歷史記錄在頁面 Init() 函數中啟用。</span><span class="sxs-lookup"><span data-stu-id="26411-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="26411-254">pageInit() 函數還用於設置導航事件的事件處理程式。</span><span class="sxs-lookup"><span data-stu-id="26411-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="26411-255">每當瀏覽器「前進」或「後退」按鈕導致頁面狀態更改時,將引發導航事件。</span><span class="sxs-lookup"><span data-stu-id="26411-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="26411-256">按一下連絡人組時將調用開始連絡人清單() 方法。</span><span class="sxs-lookup"><span data-stu-id="26411-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="26411-257">此方法通過調用 add 歷史點() 方法創建新的歷史記錄點。</span><span class="sxs-lookup"><span data-stu-id="26411-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="26411-258">按一下的連絡人組的 ID 將添加到歷史記錄中。</span><span class="sxs-lookup"><span data-stu-id="26411-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="26411-259">從連絡人組連結上的擴展屬性檢索組 ID。</span><span class="sxs-lookup"><span data-stu-id="26411-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="26411-260">鏈接呈現與以下調用Ajax.ActionLink()。</span><span class="sxs-lookup"><span data-stu-id="26411-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample9.aspx)]

<span data-ttu-id="26411-261">傳遞給Ajax.ActionLink()的最後一個參數將名為 groupid 的 expando 屬性添加到連結(XHTML 相容性小寫)。</span><span class="sxs-lookup"><span data-stu-id="26411-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="26411-262">當用戶點擊瀏覽器"後退"或"前進"按鈕時,將引發導航事件並調用 navigate() 方法。</span><span class="sxs-lookup"><span data-stu-id="26411-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="26411-263">此方法更新頁面中顯示的聯繫人,以匹配與傳遞給導航方法的瀏覽器歷史記錄點對應的頁面狀態。</span><span class="sxs-lookup"><span data-stu-id="26411-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="26411-264">執行 Ajax 移除</span><span class="sxs-lookup"><span data-stu-id="26411-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="26411-265">目前,要刪除連絡人,您需要按一下"刪除"鏈接,然後單擊刪除確認頁中顯示的"刪除"按鈕(參見圖 2)。</span><span class="sxs-lookup"><span data-stu-id="26411-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="26411-266">這似乎是很多頁面請求,以做一些簡單的事情,如刪除資料庫記錄。</span><span class="sxs-lookup"><span data-stu-id="26411-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>

<span data-ttu-id="26411-267">[![刪除確認頁](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="26411-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span></span>

<span data-ttu-id="26411-268">**圖 02**: 刪除確認頁([按下以檢視全尺寸影像](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="26411-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span></span>

<span data-ttu-id="26411-269">最好跳過刪除確認頁,直接從索引視圖中刪除連絡人。</span><span class="sxs-lookup"><span data-stu-id="26411-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="26411-270">您應該避免這種誘惑,因為採用這種方法會將應用程式打開到安全漏洞中。</span><span class="sxs-lookup"><span data-stu-id="26411-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="26411-271">通常,在調用修改 Web 應用程式狀態的操作時,不希望執行 HTTP GET 操作。</span><span class="sxs-lookup"><span data-stu-id="26411-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="26411-272">執行刪除時,要執行 HTTP POST,或者更好的是執行 HTTP DELETE 操作。</span><span class="sxs-lookup"><span data-stu-id="26411-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="26411-273">"刪除"链接包含在"連絡人列表"部分中。</span><span class="sxs-lookup"><span data-stu-id="26411-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="26411-274">清單 6 中包含連絡人清單部分的更新版本。</span><span class="sxs-lookup"><span data-stu-id="26411-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="26411-275">**清單 6 - 檢視\聯絡人清單.ascx**</span><span class="sxs-lookup"><span data-stu-id="26411-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample10.aspx)]

<span data-ttu-id="26411-276">刪除連結呈現與以下調用 Ajax.ImageActionLink() 方法:</span><span class="sxs-lookup"><span data-stu-id="26411-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="26411-277">Ajax.ImageActionLink()不是mVCASP.NET標準部分。</span><span class="sxs-lookup"><span data-stu-id="26411-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="26411-278">Ajax.ImageActionLink()是聯絡人管理員專案中包括的自定義幫助器方法。</span><span class="sxs-lookup"><span data-stu-id="26411-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>

<span data-ttu-id="26411-279">AjaxOptions 參數有兩個屬性。</span><span class="sxs-lookup"><span data-stu-id="26411-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="26411-280">首先,"確認"屬性用於顯示彈出的 JavaScript 確認對話方塊。</span><span class="sxs-lookup"><span data-stu-id="26411-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="26411-281">其次,HttpMethod 屬性用於執行 HTTP DELETE 操作。</span><span class="sxs-lookup"><span data-stu-id="26411-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="26411-282">清單7包含已添加到聯繫人控制器的新 AjaxDelete() 操作。</span><span class="sxs-lookup"><span data-stu-id="26411-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="26411-283">**清單7 - 控制器\聯絡控制器.cs(Ajax刪除)**</span><span class="sxs-lookup"><span data-stu-id="26411-283">**Listing 7 - Controllers\ContactController.cs (AjaxDelete)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample12.cs)]

<span data-ttu-id="26411-284">AjaxDelete() 操作使用 AcceptVerbs 屬性進行修飾。</span><span class="sxs-lookup"><span data-stu-id="26411-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="26411-285">此屬性可防止調用操作,但 HTTP DELETE 操作以外的任何 HTTP 操作除外。</span><span class="sxs-lookup"><span data-stu-id="26411-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="26411-286">特別是,您不能使用 HTTP GET 呼叫此操作。</span><span class="sxs-lookup"><span data-stu-id="26411-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="26411-287">刪除資料庫記錄後,需要顯示不包含已刪除記錄的聯繫人的更新清單。</span><span class="sxs-lookup"><span data-stu-id="26411-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="26411-288">AjaxDelete() 方法傳回聯絡人清單部分和更新的連絡人清單。</span><span class="sxs-lookup"><span data-stu-id="26411-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="26411-289">總結</span><span class="sxs-lookup"><span data-stu-id="26411-289">Summary</span></span>

<span data-ttu-id="26411-290">在此反覆運算中,我們將 Ajax 功能添加到我們的聯繫人管理器應用程式中。</span><span class="sxs-lookup"><span data-stu-id="26411-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="26411-291">我們使用Ajax來提高應用程式的回應性和性能。</span><span class="sxs-lookup"><span data-stu-id="26411-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="26411-292">首先,我們重構了 Index 視圖,以便單擊聯繫人組不會更新整個檢視。</span><span class="sxs-lookup"><span data-stu-id="26411-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="26411-293">相反,按一下聯繫人組只會更新聯繫人清單。</span><span class="sxs-lookup"><span data-stu-id="26411-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="26411-294">接下來,我們使用 jQuery 動畫效果淡入淡出並淡入聯繫人清單中。</span><span class="sxs-lookup"><span data-stu-id="26411-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="26411-295">向 Ajax 應用程式添加動畫可用於向應用程式的使用者提供等效的瀏覽器進度列。</span><span class="sxs-lookup"><span data-stu-id="26411-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="26411-296">我們還向 Ajax 應用程式添加了瀏覽器歷史記錄支援。</span><span class="sxs-lookup"><span data-stu-id="26411-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="26411-297">我們允許使用者單擊瀏覽器"後退"和"前進"按鈕以更改"索引"視圖的狀態。</span><span class="sxs-lookup"><span data-stu-id="26411-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="26411-298">最後,我們創建了一個支援 HTTP DELETE 操作的刪除連結。</span><span class="sxs-lookup"><span data-stu-id="26411-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="26411-299">通過執行 Ajax 刪除,我們允許使用者刪除資料庫記錄,而無需使用者請求額外的刪除確認頁。</span><span class="sxs-lookup"><span data-stu-id="26411-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="26411-300">[前一個](iteration-6-use-test-driven-development-cs.md)
> [下一個](iteration-1-create-the-application-vb.md)</span><span class="sxs-lookup"><span data-stu-id="26411-300">[Previous](iteration-6-use-test-driven-development-cs.md)
[Next](iteration-1-create-the-application-vb.md)</span></span>
