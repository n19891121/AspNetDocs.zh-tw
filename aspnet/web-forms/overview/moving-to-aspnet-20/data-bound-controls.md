---
uid: web-forms/overview/moving-to-aspnet-20/data-bound-controls
title: 資料繫結件 :微軟文件
author: rick-anderson
description: 大多數ASP.NET應用程式依賴於後端數據源的某種程度的數據表示。 數據綁定控件是交互的關鍵部分。
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 0e23ff32-646d-43f3-8bec-6b2313d3abd6
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-bound-controls
msc.type: authoredcontent
ms.openlocfilehash: 941e2ed15b3da28991e7b06cbab570eb1b5b8899
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543076"
---
# <a name="data-bound-controls"></a>資料繫結控制項

由[微軟](https://github.com/microsoft)

> 大多數ASP.NET應用程式依賴於後端數據源的某種程度的數據表示。 數據繫結件一直是動態 Web 應用程式中與資料互動的關鍵部分。 ASP.NET 2.0 引入了對數據綁定控件的一些實質性改進,包括新的 BaseDataBoundControl 類和聲明性語法。

大多數ASP.NET應用程式依賴於後端數據源的某種程度的數據表示。 數據繫結件一直是動態 Web 應用程式中與資料互動的關鍵部分。 ASP.NET 2.0 引入了對數據綁定控件的一些實質性改進,包括新的 BaseDataBoundControl 類和聲明性語法。

BaseDataBoundControl 充當 DataBoundControl 類和分層數據綁定控制類的基類。 在本模組中,我們將討論以下從 DataBoundControl 派生的類:

- AdRotator
- 清單控制項
- GridView
- 表單檢視
- 詳細資訊檢視

我們還將討論以下派生自分層數據綁定控制類的類:

- TreeView
- 功能表
- 網站地圖路徑

## <a name="databoundcontrol-class"></a>資料繫結控制類

DataBoundControl 類是一個抽象類(在 VB 中標記為 MustInherit),用於與表格或列表樣式數據進行交互。 以下控件是從 DataBoundControl 派生的一些控制項。

## <a name="adrotator"></a>AdRotator

AdRotator 控制項允許您在連結到特定 URL 的網頁上顯示圖形橫幅。 顯示的圖形使用控制項的屬性旋轉。 可以使用**展示次數**配置網頁上特定廣告的頻率,並且可以使用關鍵字篩選對廣告進行篩選。

AdRotator 控制項使用 XML 檔案或資料庫中的表來收集資料。 XML 檔案中使用以下屬性來設定 AdRotator 控制項。

### <a name="imageurl"></a>ImageUrl
要為廣告顯示的圖像的 URL。

### <a name="navigateurl"></a>導覽網址
點擊廣告時應帶用戶輸入的網址。 這應該是 URL 編碼的。

### <a name="alternatetext"></a>AlternateText
在工具提示中顯示的由螢幕閱讀器讀取的備用文本。 還顯示 ImageUrl 指定的圖像不可用時。

### <a name="keyword"></a>關鍵字
定義在使用關鍵字篩選時可以使用的關鍵字。 如果指定,則僅顯示關鍵字與關鍵字篩選器匹配的廣告。

### <a name="impressions"></a>曝光數
確定特定廣告的展示頻率的加權數位。 它相對於同一檔中其他廣告的展示次數。 XML 檔中所有廣告的集體展示的最大價值為2,048,000,000 1。

### <a name="height"></a>高度
廣告的高度(以像素為單位)。

### <a name="width"></a>寬度
廣告的寬度(以像素為單位)。

> [!NOTE]
> "高度和寬度"屬性將覆蓋 AdRotator 控制項本身的高度和寬度。

典型的 XML 檔案可能如下所示:

[!code-xml[Main](data-bound-controls/samples/sample1.xml)]

在上面的示例中,Contoso 的廣告出現的可能性是ASP.NET網站廣告的兩倍,因為"展示次數"屬性的值。

要顯示來自上述 XML 檔中的廣告,向頁面添加 AdRotator 控制項,並將 **「廣告檔」** 屬性設定為 XML 檔,如下所示:

[!code-aspx[Main](data-bound-controls/samples/sample2.aspx)]

如果選擇使用資料庫表作為 AdRotator 控制項的資料來源,則必須使用以下架構設定資料庫:

| **欄名稱** | **資料類型** | **說明** |
| --- | --- | --- |
| ID | int | 主索引鍵。 此列可以具有任何名稱。 |
| ImageUrl | 恩瓦爾恰爾(*長度*) | 要為廣告顯示的圖像的相對或絕對 URL。 |
| 導覽網址 | 恩瓦爾恰爾(*長度*) | 廣告的目標網址。 如果您未提供值,則廣告不是超連結。 |
| AlternateText | 恩瓦爾恰爾(*長度*) | 如果找不到影像,則顯示的文本。 在某些瀏覽器中,文本顯示為工具提示。 備用文本還用於輔助功能,以便看不到圖形的用戶可以聽到其描述大聲讀出。 |
| 關鍵字 | 恩瓦爾恰爾(*長度*) | 網頁可以過濾的廣告的類別。 |
| 曝光數 | int(4) | 指示廣告展示頻率的可能性的數位。 數位越大,廣告的展示頻率就越大。 XML 檔中的所有展示次數值總數不得超過 2,048,000,000 - 1。 |
| 寬度 | int(4) | 圖像的寬度(以像素為單位)。 |
| 高度 | int(4) | 圖像的高度(以像素為單位)。 |

如果您已經擁有了具有不同架構的資料庫,則可以使用**AlternateTextField、ImageUrlField**和**Navigate UrlField****NavigateUrlField**屬性將 AdRotator 屬性映射到現有資料庫。 要在 AdRotator 控制項中顯示資料庫中的數據,請向頁面新增資料來源控制項,設定資料來源控制項的連接字串以指向資料庫,並將 AdRotator 控制項的**DataSourceID**屬性設定為資料源控制件的 ID。 如果您需要以程式設計方式配置 AdRotator 廣告,請使用 Ad"創建"活動。 AdCreated 事件需要兩個參數;一個物件,另一個為 AdCreatedEventArgs 的實例。 AdCreatedEventArgs 是對正在創建的廣告的引用。

以下代碼段以程式設計方式設定廣告的 ImageUrl、NavigateUrl 和備用文字:

[!code-csharp[Main](data-bound-controls/samples/sample3.cs)]

## <a name="list-controls"></a>清單控制項

清單控制項包括清單框、下拉清單、複選框清單、廣播按鈕清單和專案符號清單。 這些控制項中的每一個都可以綁定到數據源的數據。 它們使用數據源中的一個字段作為顯示文本,可以選擇使用第二個字段作為項的值。 還可以在設計時靜態添加項,還可以混合從數據源添加的靜態項和動態項。

要綁定清單控制項,向頁面添加資料來源控制項。 為資料來源控制項指定 SELECT 命令,然後將清單控制項的 DataSourceID 屬性設定為資料來源控制項的 ID。 使用**DataTextField**和**DataValueField**屬性定義顯示文本和控制項的值。 此外,您可以使用**DataTextFormatString**屬性控制顯示文字的外觀,如下所示:

| **表達** | **說明** |
| --- | --- |
| 價格:{0:C} | 對於數位/十進位數據。 顯示字面「價格:「後跟貨幣格式的數位。 貨幣格式取決於**在 Page**指令或 Web.config 檔中的區域性屬性中指定的區域性設置。 |
| {0:D4} | 對於整數數據。 不能與十進位數位一起使用。 整數顯示在四個字元寬的零填充欄位中。 |
| {0:N2}% | 對於數字數據。 顯示具有 2 位精度的數位,後跟字"%」。。 |
| {0:000.0} | 對於數位/十進位數據。 數位四捨五入為小數位數。 小於三位數的數字會填補零。 |
| {0:D} | 對於日期/時間數據。 顯示長日期格式("1996年8月6日,星期四")。 日期格式取決於頁面或 Web.config 檔案的文化設定。 |
| {0:d} | 對於日期/時間數據。 顯示短日期格式("12/31/99")。 |
| {0:yy-MM-dd} | 對於日期/時間數據。 以數位年月格式顯示日期 (96-08-06) |

## <a name="gridview"></a>GridView

GridView 控制件允許使用聲明性方法進行表格式數據顯示和編輯,是DataGrid控制件的繼承者。 網格視圖控件中提供了以下功能。

- 綁定到資料源控件,如 SqlDataSource。
- 內置排序功能。
- 內置更新和刪除功能。
- 內置尋呼功能。
- 內置行選擇功能。
- 對 GridView 物件模型的程式設計訪問,以動態設置屬性、處理事件等。
- 多個鍵欄位。
- 超連結列的多個數據欄位。
- 通過主題和樣式自定義外觀。

**欄欄位**

GridView 控件中的每個列都由數據控制欄位物件表示。 預設情況下,自動產生列柱屬性設置為 true ,該**屬性**為資料源中的每個欄位創建一個自動生成欄位物件。 然後,每個欄位都以網格檢視控制件中的列呈現為一列,順序顯示每個欄位在數據源中。 還可以透過**將 「自動產生列」** 屬性設定為**false,** 然後定義自己的欄位集合,手動控制**GridView**控件中顯示的欄位。 不同的列欄位類型確定控制項中列的行為。

下表列出了可以使用的不同列欄位類型。

| **欄位型別** | **說明** |
| --- | --- |
| BoundField | 顯示資料源中欄位的值。 這是 GridView 控件的預設列類型。 |
| ButtonField | 顯示 GridView 控件中每個專案的命令按鈕。 這允許您創建自訂按鈕控制件的欄,例如「新增」或「刪除」按鈕。 |
| CheckBoxField | 在 GridView 控件中顯示每個項目的複選框。 此欄位類型通常用於顯示具有布林值的欄位。 |
| CommandField | 顯示預先定義的指令按鈕,以執行選擇、編輯或刪除操作。 |
| HyperLinkField | 將數據源中的欄位值顯示為超連結。 此列欄位類型允許您將第二個字段綁定到超連結的 URL。 |
| ImageField | 在 GridView 控件中顯示每個項目的圖像。 |
| 樣本欄位 | 根據指定的範本顯示 GridView 控制件中每個專案的使用者定義內容。 此欄位類型允許您建立自訂欄位。 |

要聲明性地定義列欄位集合,請首先在 GridView 控件的打開和關閉標記之間添加開篇**&lt;和&gt;** 關閉 列標記。 接下來,列出要在"開始"和"關閉**&lt;列"&gt;** 標記之間包含的欄位。 指定的列按列出的順序添加到列集合中。 **列**集合儲存控制項中的所有欄位,並允許您以程式設計方式管理 GridView 控制件中的欄位。

顯式聲明的列欄位可以與自動生成的欄位結合顯示。 當兩者同時使用時,首先呈現顯式聲明的列欄位,後跟自動生成的列欄位。

## <a name="binding-to-data"></a>繫結到資料

GridView 控制項可以綁定到資料來源控制項(如**SqlDataSource、ObjectDataSource**等)以及實現系統的任何**ObjectDataSource**資料來源。 使用以下方法之一將 GridView 控制元件的結合資料來源類型:

- 要綁定到資料源控制項,將 GridView 控制項的 DataSourceID 屬性設置為資料來源控制項的 ID 值。 GridView 控件會自動綁定到指定的數據源控制項,並可以利用資料來源控制項的功能執行排序、更新、刪除和分頁功能。 這是綁定到數據的首選方法。
- 要綁定到實現 System.集合.IE50ble 介面的數據源,請以程式設計方式將 GridView 控件的 DataSource 屬性設置為數據源,然後調用 DataBind 方法。 使用此方法時,GridView 控制件不提供內置排序、更新、刪除和分頁功能。 您需要自己提供此功能。

## <a name="data-operations"></a>資料作業

GridView 控制件提供了許多內建功能,允許使用者對控制項中的項進行排序、更新、刪除、選擇和分頁。 當 GridView 控件綁定到數據來源控制項時,GridView 控件可以利用資料來源控制件的功能並提供自動排序、更新和刪除功能。

> [!NOTE]
> GridView 控件可以為與其他類型的數據源進行排序、更新和刪除提供支援;但是,您需要提供適當的事件處理程式,並實現這些操作。

排序允許用戶通過單擊列的標題對 GridView 控件中相對於特定列的專案進行排序。 要開啟排序,請將 Allow 排序屬性設定為**true**。

按下**ButtonField**或**樣本欄位**欄位中的按鈕(分別具有"編輯"、"刪除"和"選擇")時,將啟用自動更新、刪除和選擇功能。 如果「自動產生編輯按鈕」、「自動產生刪除按鈕」或「自動產生選擇按鈕」屬性分別設定為**true,** 則 GridView 控制件可以自動新增帶有「編輯」、「刪除」或「選擇」按鈕的 **「命令欄位**」列欄位。

> [!NOTE]
> GridView 控件不支援將記錄插入數據源。 但是,可以使用 GridView 控件與"詳細資訊視圖"或"窗體視圖"控件結合使用來插入記錄。

GridView 控制項可自動將記錄分解為頁面,而不是同時顯示資料來源中的所有記錄。 要開啟分頁,請將 Allow 分頁屬性設定為**true**。

## <a name="customizing-the-user-interface"></a>自訂使用者介面

您可以通過為控制項的不同部分設定樣式屬性來自定義 GridView 控制件的外觀。 下表列出了不同的樣式屬性。

| **樣式屬性** | **說明** |
| --- | --- |
| 替代行樣式 | GridView 控件中交替數據行的樣式設置。 設置此屬性時,數據行在 RowStyle 設置和**交替行設置**之間交替顯示。 |
| 編輯行樣式 | 格格檢視控制項中正在編輯的行的樣式設置。 |
| 空白資料行樣式 | 當數據源不包含任何記錄時,GridView 控件中顯示的空數據行的樣式設置。 |
| 腳法 | GridView 控件的腳行的樣式設置。 |
| 標題樣式 | GridView 控件的標頭行的樣式設置。 |
| 呼叫樣式 | GridView 控件的尋呼機行的樣式設置。 |
| 行樣式 | GridView 控件中數據行的樣式設置。 當還設置**交替羅文樣式**屬性時,數據行將顯示在 **「行樣式」** 設置和**交替行設置**之間交替顯示。 |
| 選取行樣式 | GridView 控件中所選行的樣式設置。 |

您還可以顯示或隱藏控制項的不同部分。 下表列出了控制顯示或隱藏哪些零件的屬性。

| **屬性** | **說明** |
| --- | --- |
| 顯示足 | 顯示或隱藏 GridView 控件的腳部。 |
| 顯示標題 | 顯示或隱藏 GridView 控件的標題部分。 |

### <a name="events"></a>事件

GridView 控件提供了多個可以針對的事件。 這允許您在發生事件時運行自定義例程。 下表列出了 GridView 控件支援的事件。

| **事件** | **說明** |
| --- | --- |
| 頁面索引已變更 | 按一下其中一個尋呼機按鈕,但在 GridView 控件處理分頁操作後發生。 當用戶導航到控制項中的不同頁面後需要執行任務時,通常使用此事件。 |
| 頁面索引變更 | 按一下其中一個尋呼機按鈕,但在 GridView 控件處理分頁操作之前發生。 此事件通常用於取消分頁操作。 |
| 列取消編輯 | 按下行的「取消」按鈕,但在 GridView 控件退出編輯模式之前發生。 此事件通常用於停止取消操作。 |
| 列命令 | 在 GridView 控件中按一下按鈕時發生。 當在控制項中按一下按鈕時,此事件通常用於執行任務。 |
| 行建立 | 在 GridView 控件中創建新行時發生。 此事件通常用於在創建行時修改行的內容。 |
| 行資料繫結 | 當數據行綁定到 GridView 控件中的數據時發生。 此事件通常用於在行綁定到數據時修改行的內容。 |
| 已移除列 | 按下行的"刪除"按鈕,但在 GridView 控件從數據源中刪除記錄後,將發生。 此事件通常用於檢查刪除操作的結果。 |
| 列刪除 | 按下行的"刪除"按鈕,但在 GridView 控件從數據源中刪除記錄之前發生。 此事件通常用於取消刪除操作。 |
| 行編輯 | 按下行的「編輯」按鈕,但在 GridView 控件進入編輯模式之前發生。 此事件通常用於取消編輯操作。 |
| 列更新 | 按下行的"更新"按鈕,但在 GridView 控件更新行後發生。 此事件通常用於檢查更新操作的結果。 |
| 列更新 | 按下行的"更新"按鈕,但在 GridView 控件更新行之前發生。 此事件通常用於取消更新操作。 |
| SelectedIndexChanged | 按下行的「選擇」按鈕,但在 GridView 控件處理選擇操作後發生。 此事件通常用於在控制項中選擇行後執行任務。 |
| 選取的索引變更 | 按下行的「選擇」按鈕,但在 GridView 控件處理選擇操作之前發生。 此事件通常用於取消選擇操作。 |
| 排序 | 按下對列進行排序的超連結,但在 GridView 控件處理排序操作後,將發生。 此事件通常用於在使用者單擊超連結對列進行排序后執行任務。 |
| 排序 | 按下對列進行排序的超連結,但在 GridView 控件處理排序操作之前發生。 此事件通常用於取消排序操作或執行自訂排序例程。 |

## <a name="formview"></a>表單檢視

FormView 控制件用於顯示數據源中的單個記錄。 它與「詳細資訊檢視」控制件類似,只顯示使用者定義的範本而不是行欄位。 通過創建自己的範本,您可以更靈活地控制數據的顯示方式。 FormView 控制項支援以下功能:

- 綁定到資料來源控制項,如 SqlDataSource 和 ObjectDataSource。
- 內置插入功能。
- 內置更新和刪除功能。
- 內置尋呼功能。
- 對 FormView 物件模型的程式設計訪問,以動態設置屬性、處理事件等。
- 通過使用者定義的範本、主題和樣式自定義外觀。

## <a name="templates"></a>範本

要顯示內容,需要為控制項的不同部分創建範本。 大多數範本是可選的;但是,您必須為配置控制項的模式創建範本。 例如,支援插入記錄的 FormView 控制項必須定義插入項範本。 下表列出了您可以創建的不同範本。

| **範本類型** | **說明** |
| --- | --- |
| 編輯項目範本 | 在 FormView 控制件處於編輯模式時定義數據行的內容。 此範本通常包含輸入控制項和命令按鈕,使用者可以使用這些按鈕編輯現有記錄。 |
| 空資料範本 | 定義 FormView 控制件綁定到不包含任何記錄的資料來源時顯示的空資料行的內容。 此範本通常包含內容,以提醒使用者數據來源不包含任何記錄。 |
| 腳部範本 | 定義頁腳行的內容。 此範本通常包含您希望在頁腳行中顯示的任何其他內容。 作為替代方法,只需設置"英尺文本"屬性,即可指定要在頁腳行中顯示的文本。 |
| 標題樣本 | 定義標題行的內容。 此範本通常包含要在標題行中顯示的任何其他內容。 作為替代方法,只需設置"標題文本"屬性,即可指定要在標題行中顯示的文本。 |
| ItemTemplate | 當 FormView 控件處於唯讀模式時,定義數據行的內容。 此範本通常包含用於顯示現有記錄的值的內容。 |
| 插入項目樣本 | 在 FormView 控制檔處處於插入模式時定義數據行的內容。 此範本通常包含輸入控制項和命令按鈕,使用者可以使用這些按鈕添加新記錄。 |
| 呼叫樣本 | 定義啟用分頁功能時顯示的尋呼機行的內容(當 Allow 分頁屬性設置為**true**時)。 此範本通常包含用戶可以導航到其他記錄的控制項。 |

編輯項範本和插入項範本中的輸入控制項可以使用雙向綁定表示式綁定到數據源的欄位。 這允許 FormView 控制件自動提取用於更新或插入操作的輸入控制項的值。 雙向繫式還允許編輯項範本中的輸入控制項自動顯示原始欄位值。

### <a name="binding-to-data"></a>繫結到資料

FormView 控制項可以綁定到資料來源控制項(如 SqlDataSource、AccessDataSource、ObjectDataSource**ObjectDataSource**等)或實現系統的任何**SqlDataSource**資料來源。 使用以下方法之一會 FormView 控制元件的結合資料來源類型:

- 要綁定到資料源控制項,將 FormView 控制項的 DataSourceID 屬性設置為資料來源控制項的 ID 值。 FormView 控制件會自動綁定到指定的數據源控制項,並可以利用資料來源控制項的功能執行插入、更新、刪除和分頁功能。 這是綁定到數據的首選方法。
- 要綁定到實現**System.集合.IE50ble 介面**的資料來源,請以程式設計方式將 FormView 控制項的 DataSource 屬性設定為資料源,然後調用 DataBind 方法。 使用此方法時,FormView 控制項不提供內置的插入、更新、刪除和分頁功能。 您需要使用相應的事件來提供此功能。

## <a name="data-operations"></a>資料作業

FormView 控制項提供許多內建功能,允許使用者更新、刪除、插入和翻閱控制項中的項。 當 FormView 控件綁定到數據來源控制項時,FormView 控制項可以利用資料來源控制元件的功能並提供自動更新、刪除、插入和分頁功能。 FormView 控制項可為與其他類型的資料來源的更新、刪除、插入和分頁操作提供支援;但是,您必須提供適當的事件處理程式,並實現這些操作。

由於 FormView 控制件使用範本,因此它不提供自動生成命令按鈕以執行更新、刪除或插入操作的方法。 您必須手動將這些命令按鈕包含在相應的範本中。 FormView 控制件可識別某些按鈕,這些按鈕的命令**名稱**屬性設置為特定值。 下表列出了 FormView 控件識別的命令按鈕。

| **Button** | **命令名稱值** | **說明** |
| --- | --- | --- |
| 取消 | 取消" | 用於更新或插入操作以取消操作並丟棄使用者輸入的值。 然後,FormView 控件返回到預設模式屬性指定的模式。 |
| 刪除 | "Delete" | 移除從資料來源中移除顯示的記錄的操作。 建立項目刪除和項目刪除事件。 |
| 編輯 | "編輯" | 用於更新操作,將 FormView 控制件置於編輯模式。 為數據列顯示**在 EditItemTemplate**屬性中指定的內容。 |
| 插入 | "插入" | 用於插入操作,嘗試使用使用者提供的值在數據源中插入新記錄。 引發專案插入和專案插入事件。 |
| 新增 | "新建" | 用於插入操作,將 FormView 控制件置於插入模式。 在**InsertItemTemplate**屬性中指定的內容將顯示為數據列。 |
| 頁面 | "頁" | 用於尋呼操作,以表示執行分頁的尋呼行中的按鈕。 要指定分頁操作,請將按鈕的**CommandArgument**屬性設置為「下一步」、「前一」、「第一」、「最後」或要導航的頁面的索引。 引發頁面索引更改和頁面索引更改事件。 |
| 更新 | "更新" | 用於更新操作,以嘗試使用使用者提供的值更新數據源中顯示的記錄。 引發專案更新和專案更新事件。 |

與"刪除"按鈕(立即刪除顯示的記錄)不同,當按下「編輯」或「新建」按鈕時,「FormView」控件將分別進入編輯或插入模式。 在編輯模式下,當前數據項將顯示 **「編輯項目範本」** 屬性中包含的內容。 通常,定義編輯項目範本,以便將"編輯"按鈕替換為"更新"和"取消"按鈕。 適合欄位資料類型(如 TextBox 或 CheckBox 控件)的輸入控制項通常也會顯示欄位的值供使用者修改。 按下"更新"按鈕會更新數據源中的記錄,而按兩下"取消"按鈕將放棄任何更改。

同樣,當控件處於插入模式**InsertItemTemplate**時,數據項中包含的內容。 插入項範本通常定義,以便將「新建」按鈕替換為「插入」和「取消」按鈕,並顯示空輸入控制項,以便使用者輸入新記錄的值。 按下「插入」按鈕會將記錄插入資料源中,而單擊"取消"按鈕將放棄任何更改。

FormView 控制件提供分頁功能,允許用戶導航到數據源中的其他記錄。 啟用後,在包含頁面導航控制件的 FormView 控件中將顯示尋呼行。 要開啟分頁,請將**Allow 分頁**屬性設定為**true**。 您可以通過設定尋呼機樣式和尋呼程式設置屬性中包含的物件的屬性來自定義尋呼機行。 您可以使用**尋呼器範本**屬性創建自己的 UI,而不是使用內建尋呼機行 UI。

## <a name="customizing-the-user-interface"></a>自訂使用者介面

您可以通過為控制項的不同部分設定樣式屬性來自定義 FormView 控制件的外觀。 下表列出了不同的樣式屬性。

| **樣式屬性** | **說明** |
| --- | --- |
| 編輯行樣式 | 當 FormView 控制件處於編輯模式時,數據行的樣式設置。 |
| 空白資料行樣式 | 當數據來源不包含任何記錄時,表單檢視控制項中顯示的空數據行的樣式設置。 |
| 腳法 | FormView 控件的腳行的樣式設置。 |
| 標題樣式 | FormView 控件的標頭行的樣式設置。 |
| 插入行樣式 | 當 FormView 控件處於插入模式時,數據行的樣式設置。 |
| 呼叫樣式 | 啟用分頁功能時,在 FormView 控件中顯示的尋呼機行的樣式設置。 |
| 行樣式 | 當 FormView 控件處於唯讀模式時,數據行的樣式設置。 |

## <a name="events"></a>事件

FormView 控制項提供了多個事件,您可以針對這些事件進行程式設計。 這允許您在發生事件時運行自定義例程。 下表列出了 FormView 控制件支援的事件。

| **事件** | **說明** |
| --- | --- |
| 專案指令 | 按下 FormView 控件中的按鈕時發生。 當在控制項中按一下按鈕時,此事件通常用於執行任務。 |
| 項目建立 | 在表單表控制件中創建所有 FormViewRow 物件後發生。 此事件通常用於在顯示記錄之前修改記錄的值。 |
| 項目已移除 | 按下「刪除」按鈕(其**CommandName**屬性設置為"刪除"的按鈕),但在 FormView 控制項從資料來源中刪除記錄後,將發生這種情況。 此事件通常用於檢查刪除操作的結果。 |
| 項目刪除 | 按下"刪除"按鈕,但在 FormView 控件從數據源中刪除記錄之前發生。 此事件通常用於取消刪除操作。 |
| 專案已插入 | 按下「插入」按鈕(其**CommandName**屬性設定為「插入」的按鈕),但在 FormView 控制項插入記錄後,將發生這種情況。 此事件通常用於檢查插入操作的結果。 |
| 專案插入 | 按下「插入」按鈕,但在 FormView 控件插入記錄之前發生。 此事件通常用於取消插入操作。 |
| 專案更新 | 按下「更新」按鈕(其**CommandName**屬性設置為"更新"的按鈕),但在 FormView 控制件更新行後,將發生。 此事件通常用於檢查更新操作的結果。 |
| 專案更新 | 按下"更新"按鈕,但在 FormView 控件更新記錄之前發生。 此事件通常用於取消更新操作。 |
| 模式已變更 | 在 FormView 控制件更改模式(編輯、插入或唯讀模式)後發生。 此事件通常用於在 FormView 控制件更改模式時執行任務。 |
| 模式變更 | 在 FormView 控制件更改模式之前發生(以編輯、插入或唯讀模式)。 此事件通常用於取消模式更改。 |
| 頁面索引已變更 | 按一下其中一個尋呼機按鈕,但在 FormView 控件處理分頁操作後發生。 當用戶導航到控制項中的不同記錄後需要執行任務時,通常使用此事件。 |
| 頁面索引變更 | 按一下其中一個尋呼機按鈕,但在 FormView 控件處理分頁操作之前發生。 此事件通常用於取消分頁操作。 |

## <a name="detailsview"></a>詳細資訊檢視

"詳細資訊檢視"控制件用於顯示表中資料源中的單個記錄,其中記錄的每個欄位都顯示在表的一行中。 它可以與 GridView 控件結合使用,用於主詳細資訊方案。 "詳細資訊檢視"控制件支援以下功能:

- 綁定到資料源控件,如 SqlDataSource。
- 內置插入功能。
- 內置更新和刪除功能。
- 內置尋呼功能。
- 對 DetailsView 物件模型的程式設計存取,以動態設置屬性、處理事件等。
- 通過主題和樣式自定義外觀。

## <a name="row-fields"></a>列欄位

"詳細資訊檢視"控制件中的每個資料行都是通過聲明欄位控制項創建的。 不同的行欄位類型確定控制項中的行的行為。 欄位控制項派生自資料控制欄位。 下表列出了可以使用的不同行欄位類型。

| **欄位型別** | **說明** |
| --- | --- |
| BoundField | 將資料來源中的欄位值顯示為文字。 |
| ButtonField | 在「詳細資訊查看」控件中顯示命令按鈕。 這允許您顯示具有自訂按鈕控制件(如"添加"或"刪除"按鈕)的行。 |
| CheckBoxField | 在「詳細資訊查看」控件中顯示複選框。 此行欄位類型通常用於顯示具有布林值的欄位。 |
| CommandField | 顯示內建命令按鈕,用於在「詳細資訊檢視」控件中執行編輯、插入或刪除操作。 |
| HyperLinkField | 將數據源中的欄位值顯示為超連結。 此行欄位類型允許您將第二個字段綁定到超連結的 URL。 |
| ImageField | 在「詳細資訊檢視」控件中顯示圖像。 |
| 樣本欄位 | 根據指定的範本在「詳細資訊檢視」控件中顯示行的使用者定義內容。 此行欄位類型允許您建立自訂列欄位。 |

預設情況下,AutoGenerateRows 屬性設置為**true**,該屬性會自動為資料源中可綁定類型的每個字段生成綁定行欄位物件。 有效的可綁定類型是字串、日期時間、十進位、Guid和基元類型集。 然後,每個欄位以文本形式以每個欄位在資料源中顯示的順序顯示。

自動生成行提供了一種快速簡便的方法來顯示記錄中的每個欄位。 但是,要利用"詳細資訊視圖"控件的高級功能,必須顯式聲明要包含在"詳細資訊視圖"控件中的行欄位。 要宣告列欄位,首先將**AutoGenerateRows**屬性設定為**false**。 接下來,在「詳細資訊檢視」控制件的打開和關閉標記之間添加打開和關閉**&lt;欄位&gt;** 標記。 最後,列出要在「欄位」 標記之間包含的列**&lt;欄&gt;位**。 指定的行欄位按列出的順序加入到欄位集合中。 **欄位**「集合允許您以程式設計方式管理」詳細資訊檢視「控制件中的行欄位。

> [!NOTE]
> 自動生成的行欄位不會添加到欄位集合中。

## <a name="binding-to-data"></a>繫結到資料

詳細資訊檢視控制項可以綁定到資料來源控制項(如**SqlDataSource**或 AccessDataSource)或實現系統的任何資料來源。

使用以下方法之一將「詳細資訊檢視」控制項裝置型態為相應的資料來源類型:

- 要綁定到資料源控制項,請將「詳細資訊檢視」控制件的 DataSourceID 屬性設定為資料來源控制項的 ID 值。 "詳細資訊檢視"控制件會自動綁定到指定的資料源控制件。 這是綁定到數據的首選方法。
- 要綁定到實現**System.集合.IE50ble 介面**的數據源,請以程式設計方式將「詳細資訊視圖」控件的 DataSource 屬性設置為數據源,然後調用 DataBind 方法。

## <a name="security"></a>安全性

此控件可用於顯示使用者輸入,其中可能包括惡意用戶端腳本。 在應用程式中顯示可執行文本、SQL 語句或其他代碼之前,請檢查從用戶端發送的任何資訊。 ASP.NET提供輸入請求驗證功能,以阻止使用者輸入中的文本和 HTML。

## <a name="data-operations"></a>資料作業

"詳細資訊視圖"控制件提供內置功能,允許使用者更新、刪除、插入和翻閱控制件中的項。 當「詳細資訊檢視」控制件綁定到資料來源控制項時,詳細資訊檢視控制項可以利用資料來源控制件的功能並提供自動更新、刪除、插入和分頁功能。

"詳細資訊檢視"控制件可以為與其他類型的資料源的更新、刪除、插入和分頁操作提供支援;但是,您必須在適當的事件處理程式中為這些操作提供實現。

"詳細資訊檢視"控制件可以通過分別將"自動生成編輯按鈕"、"自動生成刪除按鈕"或"自動生成插入按鈕"屬性設置為**true,** 自動添加具有"編輯"、"刪除"或"新建"按鈕的**CommandField**行欄位。 與"刪除"按鈕(立即刪除所選記錄)不同,按一下「編輯」或「新建」按鈕時,「詳細資訊視圖」控制件將分別進入編輯或插入模式。 在編輯模式下,"編輯"按鈕將替換為"更新"和"取消"按鈕。 適合欄位資料類型(如 TextBox 或 CheckBox 控制件)的輸入控制項將顯示欄位的值,供使用者修改。 按下"更新"按鈕會更新數據源中的記錄,而按兩下"取消"按鈕將放棄任何更改。 同樣,在插入模式下,"新建"按鈕將替換為"插入"和"取消"按鈕,並顯示空輸入控制項,以便使用者輸入新記錄的值。

"詳細資訊視圖"控制件提供分頁功能,允許使用者導航到資料源中的其他記錄。 啟用後,頁面導航控件將顯示在尋呼機行中。 要開啟分頁,請將 Allow 分頁屬性設定為**true**。 可以使用尋呼機樣式和尋呼器設置屬性自定義尋呼機行。

## <a name="customizing-the-user-interface"></a>自訂使用者介面

您可以通過為控制項的不同部分設置樣式屬性來自定義「詳細資訊檢視」控制件的外觀。 下表列出了不同的樣式屬性。

| **樣式屬性** | **說明** |
| --- | --- |
| 替代行樣式 | "詳細資訊檢視"控制件中交替資料行的樣式設置。 設置此屬性時,數據行在 RowStyle 設置和**交替行設置**之間交替顯示。 |
| 命令列樣式 | 包含「詳細資訊檢視」控制件中的內置命令按鈕的行的樣式設置。 |
| 編輯行樣式 | 當"詳細資訊視圖"控制件處於編輯模式時,數據行的樣式設置。 |
| 空白資料行樣式 | 當數據源不包含任何記錄時,在「詳細資訊檢視」控件中顯示的空數據行的樣式設置。 |
| 腳法 | "詳細資訊視圖"控制件的腳行的樣式設置。 |
| 標題樣式 | 詳細資訊視圖控件的標頭行的樣式設置。 |
| 插入行樣式 | 當「詳細資訊檢視」控件處於插入模式時,數據行的樣式設置。 |
| 呼叫樣式 | "詳細資訊視圖"控制件的尋呼機行的樣式設置。 |
| 行樣式 | 詳細資訊檢視控件中數據行的樣式設置。 當還設置**交替羅文樣式**屬性時,數據行將顯示在 **「行樣式」** 設置和**交替行設置**之間交替顯示。 |
| 欄位標題樣式 | "詳細資訊檢視"控制件的標題列的樣式設置。 |

## <a name="events"></a>事件

"詳細資訊檢視"控制件提供了多個事件,您可以針對這些事件進行程式設計。 這允許您在發生事件時運行自定義例程。 下表列出了詳細資訊視圖控制項支援的事件。 "詳細資訊視圖"控件還從其基本類繼承這些事件:數據綁定、數據綁定、已處置、Init、載入、預渲染和渲染。

| **事件** | **說明** |
| --- | --- |
| 專案指令 | 在「詳細資訊查看」控件中按一下按鈕時發生。 |
| 項目建立 | 在「詳細資訊檢視」控制件中創建所有詳細資訊檢視行物件後發生。 此事件通常用於在顯示記錄之前修改記錄的值。 |
| 項目已移除 | 按下「刪除」按鈕,但在「詳細資訊查看」控件從數據源中刪除記錄後發生。 此事件通常用於檢查刪除操作的結果。 |
| 項目刪除 | 按下「刪除」按鈕,但在「詳細資訊查看」控件從數據源中刪除記錄之前發生。 此事件通常用於取消刪除操作。 |
| 專案已插入 | 按下「插入」按鈕,但在「詳細資訊檢視」控件插入記錄後發生。 此事件通常用於檢查插入操作的結果。 |
| 專案插入 | 按下「插入」按鈕,但在「詳細資訊檢視」控件插入記錄之前發生。 此事件通常用於取消插入操作。 |
| 專案更新 | 按下「更新」按鈕時發生,但在「詳細資訊查看」控件更新行後發生。 此事件通常用於檢查更新操作的結果。 |
| 專案更新 | 按下「更新」按鈕,但在「詳細資訊查看」控件更新記錄之前發生。 此事件通常用於取消更新操作。 |
| 模式已變更 | 在「詳細資訊檢視」控制件更改模式(編輯、插入或唯讀模式)後發生。 當"詳細資訊視圖"控制項更改模式時,此事件通常用於執行任務。 |
| 模式變更 | 在「詳細資訊檢視」控制件更改模式(編輯、插入或唯讀模式)之前發生。 此事件通常用於取消模式更改。 |
| 頁面索引已變更 | 按一下其中一個尋呼機按鈕,但在「詳細資訊檢視」控件處理分頁操作後發生。 當用戶導航到控制項中的不同記錄後需要執行任務時,通常使用此事件。 |
| 頁面索引變更 | 按一下其中一個尋呼機按鈕,但在「詳細資訊檢視」控件處理分頁操作之前發生。 此事件通常用於取消分頁操作。 |

## <a name="the-menu-control"></a>選單控制項

ASP.NET 2.0 中的功能表控件設計為功能齊全的導航系統。 它可以輕鬆地將數據綁定到分層數據源(如 SiteMapDataSource)。

功能表控制項結構可以聲明性或動態定義,由單個根節點和任意數量的子節點組成。 以下代碼聲明性地定義了功能表控件的功能表。

[!code-aspx[Main](data-bound-controls/samples/sample4.aspx)]

在上面的示例中,Home.aspx 節點是根節點。 所有其他節點都嵌套在不同級別的根節點中。

功能表控制項可以呈現兩種類型的功能表;靜態功能表和動態功能表。 靜態功能表由始終可見的菜單項組成。 動態功能表由功能表項組成,這些功能表僅在使用者用滑鼠懸停在功能表項上時才可見。 客戶可能會經常將靜態功能表與聲明性功能表和動態功能表與運行時數據綁定的菜單混淆。 事實上,動態功能表和靜態功能表與總體方法無關。 術語*靜態*和*動態*僅指默認情況下功能表是靜態顯示還是僅在使用者執行某些操作時顯示。

**StaticDisplayLevels 屬性**用於配置功能表的級別是靜態的,因此默認情況下顯示。 在上面的示例中,將**StaticDisplayLevels**屬性設置為值 2 將導致菜單靜態顯示主節點、音樂節點和影片節點。 當使用者懸停在父節點上時,將動態顯示所有其他節點。

**"最大動態顯示等級屬性**配置選單能夠顯示的最大動態等級數。 任何級別高於**最大動態顯示級別**屬性指定的值的動態功能表都會被丟棄。

> [!NOTE]
> 幾乎可以肯定的是,由於「最大動態顯示級別」屬性,您可能會遇到菜單未顯示的情況。 在這些情況下,請確保屬性設置得足夠,以便顯示客戶功能表。

## <a name="data-binding-the-menu-control"></a>資料繫結單控制項

功能表控制項可以綁定到任何分層資料來源,如 SiteMapDataSource 或 XMLDataSource。 SiteMapDataSource 是將數據綁定到功能表控件最常用的方法,因為它從 Web.sitemap 檔及其架構中饋送到功能表控件的已知 API。 下面的清單顯示了一個簡單的 Web.sitemap 檔。

[!code-xml[Main](data-bound-controls/samples/sample5.xml)]

請注意,只有一個根網站MapNode元素,在這種情況下,是Home元素。 可以為每個網站 MapNode 配置多個屬性。 最常用的屬性是:

- **url**指定使用者按一下選單項時要顯示的網址。 如果此屬性不存在,則節點在單擊時將僅重新發佈。
- **標題**指定選單項目顯示的文字。
- **描述**用作節點的文檔。 當滑鼠懸停在節點上時,也會顯示為工具提示。
- **網站地圖檔案**允許嵌套網站地圖。 此屬性必須指向格式良好的ASP.NET網站地圖檔。
- **角色**允許由ASP.NET安全修整控制節點的外觀。

請注意,雖然這些屬性都是可選的,但如果未指定菜單,則功能表的行為可能不是預期。 例如,如果指定*了 URL*屬性,但*描述*屬性未指定,則節點將不可見,並且無法導航到指定的 URL。

## <a name="controlling-a-menus-operation"></a>控制選單操作

有幾個屬性會影響ASP.NET菜單控件的操作;但是,有幾個屬性會影響菜單控件的操作。**方向**屬性 **、"消失後"** 屬性、**靜態專案格式字串 屬性**和**StaticPopoutImageUrl**屬性僅是其中的幾個屬性。

- "**方向"** 可以設置為*水平*或*垂直*,並控制靜態功能表項是水準排列在一行中,還是垂直堆疊在一起。 此屬性不會影響動態功能表。
- **"消失後"** 屬性配置動態功能表在滑鼠移離後應保持可見的時間。 該值以毫秒為單位指定,預設值為 500。 將此屬性設置為 -1 的值將導致功能表永遠不會自動消失。 在這種情況下,功能表將僅在用戶單擊功能表外部時消失。
- **StaticItemFormatString**屬性使功能表系統中維護一致措辭變得容易。 指定此屬性時,*{0}* 應輸入代替資料來源中顯示的說明。 例如,為了讓練習 1 中的功能表項「訪問我們的產品頁面」等,您需要指定「訪問{0}我們的頁面」以執行靜態專案格式字串。 在運行時,ASP.NET將用功能表項的正確說明{0}替換的任何匹配項。
- **StaticPopoutImageUrl**屬性指定用於指示特定功能表節點具有可以通過懸停在該節點上訪問的子節點的圖像。 動態功能表將繼續使用預設影像。

## <a name="templated-menu-controls"></a>樣本化選單控制項

功能表控制項是範本化控制項,允許兩個不同的 ItemTemplate;靜態專案範本和動態專案範本。 使用這些範本,您可以輕鬆地將伺服器控制項或使用者控制項添加到菜單中。

要編輯 Visual Studio .NET 中的範本,請單擊功能表上的「智慧標記」按鈕,然後選擇「編輯範本」。 然後,您可以選擇編輯靜態專案範本或動態專案範本。

載入頁面時,添加到 StaticItemTemplate 的任何控制項都將顯示在靜態選單中。 添加到動態項目範本的任何控制項都將顯示在所有彈出式功能表上。

## <a name="menu-events"></a>選單事件

"功能表"控制項有兩個對此獨有的事件;**功能表專案已單擊**和**功能表項數據綁定**事件。

單擊功能表項時,將引發"功能表項目單擊"事件。 當功能表項資料綁定時,將引發 MenuItemData 綁定事件。 傳遞到事件處理程式的**MenuEventArgs**通過 Item 屬性提供對功能表項的訪問。

## <a name="controlling-a-menus-appearance"></a>控制選單外觀

您還可以使用可用於設置功能表格式的許多樣式中的一種或多種樣式來影響功能表控制件的外觀。 其中包括**靜態選單樣式**、**動態選單樣式**、**動態選單樣式**、**動態選擇樣式**與**動態懸停樣式**。 這些屬性使用標準 HTML 樣式字串進行配置。 例如,以下內容將影響動態功能表的樣式。

[!code-aspx[Main](data-bound-controls/samples/sample6.aspx)]

> [!NOTE]
> 如果使用任何懸停樣式,則需要在頁面中&lt;新增&gt;頭 元素,其中*runat*元素設定為*伺服器*。

功能表控件還支援使用ASP.NET 2.0 主題。

## <a name="the-treeview-control"></a>樹狀圖控制項

TreeView 控件在樹狀結構中顯示數據。 與功能表控制項一樣,它可以輕鬆地綁定到任何分層資料來源(如 SiteMapDataSource)的數據。

客戶可能會詢問ASP.NET 2.0 中的 TreeView 控件的第一個問題是,該控件是否與可用於 ASP.NET 1.x 的 TreeView IE WebControl 相關。 不是。 ASP.NET 2.0 TreeView 控件是從零開始編寫的,與之前可用的 IE TreeView WebControl 提供了顯著改進。

我不會詳細介紹如何將 TreeView 控件綁定到網站地圖,因為它的執行方式與「功能表」控件完全相同。 但是,TreeView 控件在操作方式上存在一些明顯差異。

默認情況下,TreeView控件顯示為完全展開。 要更改初始載入時的擴展等級,請修改控制項的 **「展開深度**」屬性。 這在 TreeView 在擴展特定節點時的數據綁定的情況下尤其重要。

## <a name="databinding-the-treeview-control"></a>資料繫結檔檢視控制項

與「功能表」控件不同,TreeView 非常適合處理大量數據。 因此,除了與 SiteMapDataSource 或 XMLDataSource 的數據綁定外,TreeView 通常是綁定到 DataSet 或其他關係數據的數據。 如果 TreeView 控件綁定到大量數據,則最好僅綁定到控件中實際可見的數據。 然後,當 TreeView 節點展開時,可以將數據綁定到其他數據。

在這些情況下,樹狀圖的**填充 OnDemand**屬性應設定為*true*。 然後,您需要為**TreeNode 填充**方法提供實現。

## <a name="data-binding-without-postback"></a>數據繫結,無需回郵

請注意,當您首次展開上一個示例中的節點時,頁面會重新發佈並刷新。 在此示例中,這不是問題,但可以想像它可能位於具有大量數據的生產環境中。 更好的方案是 TreeView 仍將動態填充其節點,但不會回伺服器。

通過將 **「填充NodesFromClient」** 和 **「填充OnDemand」** 屬性設定為 true,ASP.NET TreeView 控件將動態填充節點,而無需回帖。 擴展父節點時,將從用戶端發出 XMLHttp 請求,並觸發 OnTreeNode 填充事件。 伺服器使用 XML 數據孤島進行回應,然後用於數據綁定子節點。

ASP.NET動態創建實現此功能的用戶端代碼。 包含&lt;文&gt;稿 的文稿標記將生成指向 AXD 檔。 例如,下面的清單顯示了生成 XMLHttp 請求的文本代碼的腳本連結。

[!code-html[Main](data-bound-controls/samples/sample7.html)]

如果您在瀏覽器中流覽上面的 AXD 檔並打開該檔案,您將看到實現 XMLHttp 請求的代碼。 此方法可防止客戶修改文本檔。

## <a name="controlling-the-operation-of-the-treeview-control"></a>控制樹檢視控制元件的操作

TreeView 控件具有影響控制項操作的幾個屬性。 最明顯的屬性是 **「顯示檢查框****」、「顯示展開摺疊」** 和「**顯示線**」。

**"ShowCheckBox"** 屬性會影響節點在渲染時是否顯示複選框。 此屬性的有效值為 **"無**"、"**根**"、"**父**"、"**葉**"和"**全部**"。 這些影響樹檢視控制件如下所示:

| **屬性值** | **效果** |
| --- | --- |
| None | 複選框不顯示在任何節點上。 這是預設值。 |
| Root | 複選框僅顯示在根節點上。 |
| 父系 | 複選框僅顯示在具有子節點的節點上。 這些子節點可以是父節點或葉節點。 |
| 分葉 | 複選框僅顯示在沒有子節點的節點上。 |
| 全部 | 所有節點上都顯示一個複選框。 |

使用複選框時 **,"CheckNodes"** 屬性將返回在回郵時檢查的 TreeView 節點的集合。

**ShowExpandCollapse**屬性控制根節點和父節點旁邊的展開/摺疊圖像的外觀。 如果此屬性設置為**false,** 則 TreeView 節點將呈現為超連結,並通過按一下連結展開/摺疊。

**ShowLines**屬性控制是否顯示將父節點連接到子節點的線路。 當**false(** 預設值)時,不顯示任何行。 **當為 true**時,TreeView 控制件將使用**LineImageFolder**屬性指定的資料夾中的線圖像。

要自定義 TreeView 線條的外觀,Visual Studio .NET 2005 包括一個線設計器工具。 您可以使用「樹檢視」控制件上的「智慧標記」按鈕存取此工具,如下所示。

![](data-bound-controls/_static/image1.jpg)

**圖 1**

選擇 **「自訂線圖像」** 選單選項時,將啟動「線設計器」工具,以允許您設定 TreeView 線的外觀。

## <a name="treeview-events"></a>樹狀圖事件

TreeView 控制件具有以下唯一事件:

- 當根據 **「選擇操作」** 屬性選擇節點時,將發生「選擇節點更改」。
- 更改節點複選框狀態時,將發生樹節點檢查更改。
- 當節點基於**SelectAction**屬性展開時,將發生樹節點擴展。
- 當節點摺疊時,樹節點摺疊發生。
- 當節點被數據綁定時,就會發生樹節點數據綁定。
- 填充節點時發生樹節點填充。

**SelectAction**屬性允許您設定選擇節點時觸發的事件。 SelectAction 屬性提供以下操作:

- 樹節點選擇操作.在選擇節點時展開引發樹節點展開。
- 樹節點選擇操作.當節點被選中時,不引發任何事件。
- 樹節點選擇操作.選擇在選擇節點時引發"選定節點更改"事件。
- 樹節點選擇操作.選擇展開在選擇節點時同時引發"選定節點更改"事件和樹節點展開事件。

## <a name="controlling-appearance-with-styles"></a>使用樣式控制外觀

TreeView 控件提供了許多屬性,用於使用樣式控制控制件的外觀。 有下列屬性可供使用。

| **屬性名稱** | **控制項** |
| --- | --- |
| 暫停節點樣式 | 當滑鼠懸停在節點上時,控制節點的樣式。 |
| 葉節點樣式 | 控制葉節點的樣式。 |
| 節點樣式 | 控制所有節點的樣式。 特定節點樣式(如 LeafNodeStyle)覆蓋此樣式。 |
| 父節點樣式 | 控制所有父節點的樣式。 |
| 根節點樣式 | 控制根節點的樣式。 |
| 選擇的節點樣式 | 控制所選節點的樣式。 |

每個屬性都是唯讀的。 但是,它們各自將返回一個**TreeNodeStyle**物件,並且可以使用*屬性子屬性*格式修改該物件的屬性。 例如,要設置 **「選定NodeStyle」** 的**ForeColor**屬性,請使用以下語法:

[!code-aspx[Main](data-bound-controls/samples/sample8.aspx)]

請注意,上面的標記未關閉。 這是因為,當使用此處顯示的聲明性語法時,您也會在 HTML 代碼中包括 TreeViews 節點。

樣式屬性也可以使用*屬性.subproperty*格式在代碼中指定。 例如,要在代碼中設定**RootNodeStyle**的**ForeColor**屬性,請使用以下文法:

[!code-csharp[Main](data-bound-controls/samples/sample9.cs)]

> [!NOTE]
> 有關不同樣式屬性的完整清單,請參閱 TreeNodeStyle 物件上的 MSDN 文檔。

## <a name="the-sitemappath-control"></a>站台地圖路徑控制項

SiteMapPath 控制項為ASP.NET開發人員提供了麵包屑導航控件。 與其他導航控制項一樣,它可以輕鬆地綁定到分層資料來源(如 SiteMapDataSource 或 XmlDataSource)的數據。

網站地圖路徑控制件由網站映射節點項目物件組成。 有三種類型的節點;根節點、父節點和當前節點。 根節點是層次結構頂部的節點。 當前節點表示當前頁面。 所有其他節點都是父節點。

## <a name="controlling-the-operation-of-the-sitemappath-control"></a>控制站台地圖路徑控制項

控制站台地圖路徑控制元件操作的屬性如下所示:

| **屬性** | **財產描述** |
| --- | --- |
| 顯示父級 | 控制顯示的父節點數。 默認值為 -1,它對顯示的父節點數沒有限制。 |
| 路徑方向 | 控制網站地圖路徑的方向。 有效值為「根到當前」(預設)和「當前到根」。 |
| 路徑分離器 | 控制分隔站點地圖路徑控制項中節點的字元的字串。 默認值為 :。 |
| 成成電流節點連結 | 控制當前節點是否呈現為連結的布爾值。 預設值是 False。 |
| 略過連結文字 | 當螢幕閱讀器查看頁面時,有助於輔助訪問。 此屬性允許螢幕閱讀器跳過網站地圖路徑控制項。 要禁用此功能,請將屬性設置為 String.Empty。 |

## <a name="templated-sitemappath-controls"></a>樣本化網站地圖路徑控制項

SiteMapControl 是一個範本化控制項,因此,您可以定義不同的範本以用於顯示控制項。 要編輯 SiteMapPath 控制件中的範本,請單擊控制項上的「智慧標記」按鈕,並從菜單中選擇「編輯範本」。 這將顯示 SiteMapTasks 選單,如下所示,您可以在其中選擇可用的不同範本。

![](data-bound-controls/_static/image2.jpg)

**圖 2**

**節點範本**引用網站地圖路徑中的任何節點。 如果節點是根節點或當前節點,並且配置了**RootNodeTemplate**或**CurrentNodeTemplate,** 則節點範本將被覆蓋。

## <a name="sitemappath-events"></a>站台地圖路徑事件

SiteMapPath 控制項有兩個不是從控制項類派生的事件;另一個事件不是從控制項類派生的。**專案建立**事件和**專案數據綁定**事件。 創建網站地圖路徑項時,將引發"項目創建"事件。 在 SiteMapPath 節點的資料綁定期間調用 DataBind 方法時,將引發 ItemDataBound。 **網站映射NodeItemEventArgs**物件通過 Item 屬性提供對特定網站MapNodeItem的訪問。

## <a name="controlling-appearance-with-styles"></a>使用樣式控制外觀

以下樣式可用於設置網站地圖路徑控制項的格式。

| **屬性名稱** | **控制項** |
| --- | --- |
| 目前節點樣式 | 控制當前節點的文本樣式。 |
| 根節點樣式 | 控制根節點的文本樣式。 |
| 節點樣式 | 控制所有節點的文本樣式,前提是當前NodeStyle 或 RootNodeStyle 不適用。 |

NodeStyle 屬性被當前節點樣式或 RootNodeStyle 覆蓋。 每個屬性都是唯讀的,並傳回一個**Style**物件。 要使用這些屬性之一影響節點的外觀,您需要設置返回的 Style 物件的屬性。 例如,下面的代碼更改當前節點的前色屬性。

[!code-aspx[Main](data-bound-controls/samples/sample10.aspx)]

也可以按照如下方式以程式設計方式應用該屬性:

[!code-csharp[Main](data-bound-controls/samples/sample11.cs)]

> [!NOTE]
> 如果應用範本,將不會應用該樣式。

## <a name="lab-1-configuring-an-aspnet-menu-control"></a>實驗 1:設定ASP.NET選單控制項

1. 建立新網站。
2. 以從檔案範本清單中選擇「檔案、新建、檔案和選擇網站映射」來添加網站映射檔。
3. 打開網站地圖(預設情況下為 Web.sitemap),並對其進行修改,使其看起來像下面的清單。 在網站地圖檔中鏈接到的頁面實際上不存在,但這不是本練習的問題。

    [!code-xml[Main](data-bound-controls/samples/sample12.xml)]
4. 在"設計"視圖中打開預設 Web 窗體。
5. 從工具箱的導航部分,向頁面添加新的"功能表"控制件。
6. 從工具箱的數據部分,添加新的 SiteMapDataSource。 SiteMapDataSource 將自動使用網站中的 Web.sitemap 檔。 (Web.sitemap 檔案*必須*位於網站的根資料夾中。
7. 按下「功能表」控件,然後按下「智慧標記」按鈕以顯示「功能表任務」對話框。
8. 在「選擇資料來源」下拉下拉清單,選擇 SiteMapDataSource1。
9. 按下「自動格式」連結並選擇功能表的格式。
10. 在"屬性"窗格中,將 **「靜態顯示級別」** 屬性設置為 2。 "選單"控制項現在應在設計器中顯示"主頁"、"產品和服務"節點。
11. 流覽瀏覽器中的頁面以使用功能表。 (由於添加到網站地圖的頁面實際上不存在,因此當您嘗試瀏覽這些頁面時,您將看到錯誤。

嘗試更改靜態顯示級別和最大動態顯示級別屬性,並瞭解它們如何影響功能表的呈現方式。

## <a name="lab-2-dynamically-binding-a-treeview-control"></a>實驗 2:動態繫結點樹檢視控制項

本練習假定 SQL Server 在本地運行,並且北風資料庫存在於 SQL Server 實例上。 如果未滿足這些條件,請更改範例中的連接字串。 請注意,您可能還需要指定 SQL Server 身份驗證,而不是受信任的連接。

1. 建立新網站。
2. 切換到 Default.aspx 的代碼檢視,並將所有代碼替換為下面列出的代碼。 

    [!code-aspx[Main](data-bound-controls/samples/sample13.aspx)]
3. 將頁面另存為樹視圖.aspx。
4. 瀏覽頁面。
5. 首次顯示頁面時,在瀏覽器中查看頁面源。 請注意,只有可見節點發送到用戶端。
6. 單擊任何節點旁邊的加號。
7. 再次查看頁面上的源。 請注意,新顯示的節點現在存在。

## <a name="lab-3-details-view-and-editing-data-using-a-gridview-and-detailsview"></a>實驗 3:使用網格檢視和詳細資訊查看查看和編輯資料的詳細資訊

1. 建立新網站。
2. 向網站添加新的 Web.config。
3. 將連接字串新增到 Web.config 檔案,如下所示: 

    [!code-xml[Main](data-bound-controls/samples/sample14.xml)]

    > [!NOTE]
    > 您可能需要根據環境更改連接字串。
4. 儲存並關閉 web.config 檔案。
5. 打開 Default.aspx 並添加新的 SqlDataSource 控制項。
6. 將 SqlDataSource 控制件的 ID 變更為**產品**。
7. 在**SqlDataSource 任務**選單中,按下 **「設定數據來源**」 。。
8. 在連接下拉清單中選擇 **「北風**」,然後單擊「下一步」。
9. 從 **"名稱**"下拉清單中選擇**產品**,然後選中 **"產品 ID、****產品名稱**、**單價**"和 **"單位庫存**"複選框,如下所示。 

![](data-bound-controls/_static/image3.jpg)

    **Figure 3**
10. 按 [下一步]  。
11. 按一下 [完成]  。
12. 切換到「源」檢視並檢查生成的代碼。 請注意新增到 SqlDataSource 控制元件的**Select 命令**,**刪除命令**,**插入命令**與**更新命令**。 另請注意添加的參數。
13. 切換到"設計"視圖,並將新的 GridView 控件添加到頁面。
14. 從**選擇資料來源**下拉清單中選擇**產品**。
15. 勾選此**選項, 啟用分頁**和**啟用選擇**,如下所示。 

![](data-bound-controls/_static/image4.jpg)

    **Figure 4**
16. 點選 **「編輯列」** 連結,並確保選取**自動產生欄位**。
17. 按一下 [確定]  。
18. 選擇 GridView 控制件後,按下「屬性」窗格中的**DataKeyNames**屬性旁邊的按鈕。
19. 從 **「可用資料欄位**」 清單**&gt;** 中選擇 **「產品 ID」,** 然後按下這個按鈕進行添加。
20. 按一下 [確定]。
21. 向頁面添加新的 SqlDataSource 控制件。
22. 將 SqlDataSource 控制件的 ID 變更為**詳細資訊**。
23. 在 SqlDataSource 任務選單中,選擇 **「設定資料來源**」 。。
24. 從下拉清單中選擇**北風**,然後單擊 **「下一步**」。。
25. 從<strong>"名稱</strong>"下拉清單<strong>\<中選擇<strong>"產品</strong>",然後選中<strong>"列</strong>列表"框中的/強>* 複選框。
26. 按下 **「WHERE」** 按鈕。
27. 從**欄**「下拉清單中選擇**產品 ID。**
28. 在**=**「操作員下拉清單」中選擇。
29. 從 **「源**」下拉清單中選擇 **「控制件**」。
30. 從**控制 ID**下拉清單中選擇**GridView1。**
31. 按下「**添加**」按鈕以添加 WHERE 子句。
32. 按一下 [確定]  。
33. 按下 **「進階」** 按鈕,然後選中 **「生成插入」、「更新」和「刪除語句」** 複選框。
34. 按一下 [確定]  。
35. 按下 **「下一步**」,然後按兩下 **「完成**」。。
36. 向頁面添加"詳細資訊查看"控制件。
37. 在**選擇資料來源**下拉下拉清單,選擇 **「詳細資訊**」 。
38. 選中"**啟用編輯**「複選框,如下所示。 

![](data-bound-controls/_static/image1.gif)

    **Figure 5**
39. 保存頁面並流覽預設.aspx。
40. 按下不同記錄旁邊的 **「選擇**」連結,自動查看「詳細資訊查看」 更新。
41. 按下「詳細資訊查看」 控制件中的 **「編輯**」 連結。
42. 更改記錄,然後單擊 **"更新**"。
