---
uid: web-forms/overview/moving-to-aspnet-20/membership
title: 會員 |微軟文件
author: rick-anderson
description: ASP.NET成員資格基於表單身份驗證模型從ASP.NET1.x的成功為基礎。 ASP.NET窗體身份驗證提供了一種便捷的方法來進行體形...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: f2339485-5d78-4c5e-8c0a-dc9b8a315345
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/membership
msc.type: authoredcontent
ms.openlocfilehash: ed48c11cbd483de088239bad7c2452b7fc60a1cf
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543765"
---
# <a name="membership"></a>成員資格

由[微軟](https://github.com/microsoft)

> ASP.NET成員資格基於表單身份驗證模型從ASP.NET1.x的成功為基礎。 ASP.NET窗體身份驗證提供了將登錄表單合併到ASP.NET應用程式中以及根據資料庫或其他數據存儲驗證使用者的便捷方法。

ASP.NET成員資格基於表單身份驗證模型從ASP.NET1.x的成功為基礎。 ASP.NET窗體身份驗證提供了將登錄表單合併到ASP.NET應用程式中以及根據資料庫或其他數據存儲驗證使用者的便捷方法。 表單身份驗證類的成員可以處理 Cookie 進行身分驗證、檢查有效登錄、登出使用者等。但是,在ASP.NET 1.x 應用程序中實現窗體身份驗證可能需要大量代碼。

ASP.NET 2.0 中的成員資格是單獨使用窗體身份驗證的一大進步。 (與表單身份驗證結合時,成員資格最可靠,但使用窗體身份驗證不是要求。正如您很快就會看到的那樣,您可以使用ASP.NET 2.0 中的ASP.NET成員資格和登錄控制項來實現強大的成員資格系統,而無需編寫大量代碼。

## <a name="implementing-membership-in-aspnet-20"></a>在 ASP.NET 2.0 中實施成員資格

成員資格通過以下四個步驟實現。 請記住,涉及許多子步驟以及可選配置,也可以實現。 這些步驟旨在說明配置成員資格的大圖景。

1. 創建成員資格資料庫(如果 SQL Server 用作成員資格存儲。
2. 指定應用程式設定檔中的成員資格選項。 (默認情況下啟用成員資格。
3. 確定要使用的成員資格存儲的類型。 選項包括： 

    - 微軟 SQL 伺服器(版本 7.0 或更高版本)
    - 活動目錄儲存
    - 自訂成員資格提供者
4. 配置應用程式以進行ASP.NET窗體身份驗證。 再次,成員資格旨在利用窗體身份驗證,但使用窗體身份驗證不是一項要求。
5. 為成員資格定義使用者帳戶,並根據需要配置角色。

## <a name="creating-the-membership-database"></a>建立成員資格資料庫

如果您使用 SQL Server 7.0 或更高版本作為成員資格存儲,則可以\_使用 aspnet regsql 實用程式(從 Visual Studio .NET 2005 命令提示符中最容易使用)來配置資料庫。 aspnet\_regsql 實用程式可用作命令提示工具或透過 GUI 精靈。 嚮導方法是配置資料庫的最簡單方法。 要存取精靈,只需執行以下指令:

`aspnet_regsql W`

運行該命令後,將顯示ASP.NET SQL 伺服器設置嚮導,如下所示。

![](membership/_static/image1.jpg)

**圖 1**

ASP.NET SQL 伺服器設置精靈會在嚮導中指定的實例中創建網站。 但是,ASP.NET將使用計算機中的連接字串。 預設情況下,此連接字串將指向 SQL Server 2005 實例,因此,如果您使用的是 SQL Server 2000 或 SQL Server 7.0 實例,則需要修改電腦中的連接字元串。 該連線字串可以位於此處:

[!code-xml[Main](membership/samples/sample1.xml)]

遺憾的是,如果不修改連接字串,ASP.NET不會給您帶來描述性錯誤。 它會繼續抱怨說,你還沒有創建資料庫。 在上面的案例中,我修改了連接字串以指向我的本地 SQL Server 2000 實例。

## <a name="specifying-configuration-and-adding-users-and-roles"></a>指定設定與新增使用者與角色

設定成員資格的下一步是向應用程式的 Web.config 檔添加必要的資訊。 在ASP.NET 1.x 中,由於使用較低CamelCase和缺乏 Intellisense,修改 Web.config 文件有時很困難。 Visual Studio .NET 2005 使配置檔的 Intellisense 任務更加輕鬆,但 ASP.NET 2.0 透過提供用於編輯設定檔的網頁介面更進一步。

您可以透過單擊解決方案資源管理器工具列上的ASP.NET配置按鈕來啟動 Web 介面,如下所示。 您還可以透過插入登入控制項時顯示的彈出視窗啟動 Web 介面。

![](membership/_static/image2.jpg)

**圖 2**

這將啟動下面所示的ASP.NET網站管理工具。 ASP.NET網站管理是一個四選項卡介面,便於管理應用程式設置。 以下選項卡可用:

- **首頁**
- **安全性**配置使用者、角色和訪問許可權。
- **套用**配置應用程式設置。
- **供應商**配置和測試應用程式成員資格提供者。

網站管理工具允許您輕鬆創建新使用者、創建新角色以及管理使用者和角色。 此功能在 Windows 介面中不可用。 Windows 介面允許您輕鬆定義授權設置,並添加、刪除和管理不在網站管理工具中的提供程式。

要啟動 Windows 介面,請打開 Internet 資訊服務卡入,右鍵單擊應用程式,然後選擇"屬性"。 按下ASP.NET選項卡,然後按下「編輯配置」按鈕。 (應用程式必須在 2.0 ASP.NET 下運行才能啟用"編輯配置"按鈕。 您還可以在ASP.NET對話框中配置ASP.NET版本。ASP.NET 配置設置對話方塊如下所示。

![](membership/_static/image3.jpg)

**圖 3**

在「常規」選項卡上,將列出連接字串和應用程式設定。 斜體的任何設定都在父配置檔(機器.config 或更高級別的 Web.config)中定義,而斜體化的設置來自應用程式配置檔。 如果在應用程式級別添加、刪除或編輯設定,ASP.NET將在應用程式級別 Web.config 上添加、刪除或修改該設定,而不是從繼承該設定的設定檔中刪除該設定。

"身份驗證"選項卡如下所示。 這是您將配置成員資格設置的位置。 可以在此處配置窗體身份驗證設置、成員資格提供程式和角色提供程式。

![](membership/_static/image4.jpg)

**圖 4**

## <a name="implementing-membership-in-your-application"></a>在應用程式中實現成員資格

實現應用程式中ASP.NET 2.0 成員資格的最簡單方法是使用提供的登錄控制項。 此方法允許您實現ASP.NET 2.0 成員資格的基礎知識,而無需編寫任何代碼。

以下登入控制項在 2.0 ASP.NET 中可用:

## <a name="login-control"></a>登入控制

登錄控制項為某人提供登錄您的成員資格系統的介面。 它為您提供使用者名稱和密碼文本框和登錄按鈕。 許多其他常見功能,例如尚未註冊的使用者的連結、允許使用者在後續訪問時自動登錄的複選框、密碼提醒連結等。登錄控制件的所有功能都可透過控制的屬性進行自定義。

在ASP.NET 1.x 中,開發人員在使用窗體身份驗證時必須編寫相當數量的代碼來執行查找。 使用ASP.NET 2.0 成員資格,無需編寫任何代碼即可驗證使用者。 ASP.NET會自動為您查找使用者。 (如果您使用登錄控制項而不使用ASP.NET成員資格,則可以使用**OnAuthenticate**方法驗證使用者。

## <a name="loginview-control"></a>LoginView 控制項

LoginView 控件是一個範本化控制項,預設情況下提供兩個範本;匿名範本和登錄範本。 顯示的範本由使用者是否登錄到您的成員資格系統決定。 此控件通常用於在使用者尚未登錄時顯示登錄控制項,以及使用者登錄時的登錄狀態控制項和/或其他登錄控制項。 如果在ASP.NET應用程式中使用角色管理,則LoginView控制項可以基於使用者角色顯示特定的範本。 (稍後將介紹有關ASP.NET角色管理的更多內容。

## <a name="passwordrecovery-control"></a>密碼修復控制

密碼修復控制項允許使用者接收包含其當前密碼的電子郵件或重置其密碼。 可以恢復明文和加密的密碼並通過電子郵件發送給使用者。 如果密碼已哈希,則無法恢復密碼。 相反,使用者將需要執行密碼重置。

## <a name="loginstatus-control"></a>登入狀態控制

登錄狀態控制項用於向未登錄的使用者顯示登錄指示器,向目前登錄的使用者顯示登出指示器。 "請求.已驗證"屬性用於確定要顯示的指示器。 登錄狀態控制項顯示的指示器可以是文本(透過**登錄文本**和**註銷文本**屬性實現)或圖像(透過**登錄圖像Url**和**LogoutImageUrl**屬性實現)。

當使用者通過登錄狀態控件註銷時,他或她將重定向到**LogoutPageUrl**屬性指定的 URL。 如果未設置該屬性,則刷新當前頁面。 由於網站可能受窗體身份驗證保護,因此當前頁面的刷新將用戶重定向到網站的登錄頁。

## <a name="loginname-control"></a>登入名控制

"登錄名稱"控制件顯示當前登錄到網站的使用者的使用者名稱。

## <a name="createuserwizard-control"></a>建立使用者精靈控制項

CreateUserWizard 控制項為使用者提供註冊會員系統的便捷方式。 您可以通過如下所示的介面添加步驟(作為嚮導步驟的集合實現)。

![](membership/_static/image5.jpg)

**圖 5**

CreateUserWizard 是一個範本化控制項,派生自嚮導類並提供以下範本:

- **標題樣本**此範本控制嚮導標頭的外觀。
- **側邊欄樣本**此範本控制嚮導側邊欄的外觀。
- **開機瀏覽樣本**此範本控制導航的外觀是嚮導在開始步驟。
- **步進瀏覽樣本**此範本控制在導航區域的外觀時不在開始或完成步驟中。
- **完成瀏覽樣本**此範本控制導航區域在完成步驟上的外觀。

此外,對於添加到嚮導的每個步驟,ASP.NET將創建一個自定義範本,其中包含該步驟的內容範本和自定義導航範本。 有關自訂 CreateUserWizard 的完整詳細資訊,請參閱 2005 年VS.NET文檔:

## <a name="changepassword-control"></a>變更密碼控制

更改密碼控制項允許使用者更改其密碼。 如果 DisplayUserName 屬性為 true(預設情況下為 false),則用戶可以在未登錄時更改其密碼。 如果使用者*已*登錄,並且 DisplayUserName 屬性為 true,則使用者將能夠更改未登錄的其他使用者的密碼,前提是他們知道該使用者的使用者 ID。

請記住,如果您希望用戶能夠在無需登錄的情況下更改密碼,則需要確保顯示更改密碼控制項的頁面允許匿名存取。 顯然,用戶必須提供其舊密碼才能更改其密碼。

## <a name="role-management"></a>角色管理

角色管理允許您將使用者分配給特定角色,然後根據該角色限制對某些檔或資料夾的訪問。 角色管理還提供 API,以便您可以以程式設計方式確定某人的角色或確定特定角色的所有使用者並做出相應回應。

角色管理不是ASP.NET成員的要求,也不是使用角色管理的要求。 然而,兩者互相補充得很好,開發人員可能會將它們結合使用。

要在應用程式中啟用角色管理,請對 Web.config 檔中進行以下變更:

[!code-xml[Main](membership/samples/sample2.xml)]

當**快取RolesInCookie**屬性設置為 true 時,ASP.NET緩存用戶端 Cookie 中的使用者角色成員身份。 這允許在不調用角色提供程序的情況下進行角色查找。 使用此屬性時,鼓勵開發人員確保**cookie 保護**屬性設置為" 全部" (這是默認設置。這可確保 Cookie 數據經過加密,並有助於確保 Cookie 內容未被更改。 可以使用網站管理工具添加角色。 它允許您輕鬆定義角色、根據這些角色配置對網站部分的訪問,並將使用者分配給角色。

![](membership/_static/image6.jpg)

**圖 6**

如上所述,只需輸入角色的名稱,然後單擊"添加角色"即可添加新角色。 通過按一下現有角色清單中的相應連結,可以管理或刪除現有角色。

管理角色時,可以添加或刪除使用者,如下所示。

![](membership/_static/image7.jpg)

**圖 7**

通過選中「用戶處於角色」複選框,可以輕鬆地將使用者添加到特定角色。 ASP.NET將自動使用適當的條目更新您的成員資格資料庫。 您還需要為應用程式設定訪問規則。 ASP.NET 1.x 開發人員熟悉通過 Web.config 檔中&lt;的授權&gt;元素執行此操作,該選項在 2.0 ASP.NET 中仍然可用。 但是,它更易於使用網站管理工具管理訪問規則,如下所示。

![](membership/_static/image8.jpg)

**圖 8**

在這種情況下,管理資料夾將突出顯示(由於該工具以淺灰色突出顯示它而難以查看),並且管理員角色已被授予訪問許可權。 所有其他使用者都被拒絕。 您可以按下頭部圖示來選擇規則,然後使用「向上移動」 和「向下移動」按鈕來排列規則。 與ASP.NET&lt;&gt;授權 元素一樣,規則按它們出現的順序進行處理。 換句話說,如果上述鏡頭中的規則順序顛倒,則任何人都無法訪問管理檔夾,因為ASP.NET遇到的第一個規則是拒絕所有人到該資料夾的規則。

ASP.NET 2.0 將 Web.config 檔添加到要為其指定訪問規則的資料夾。 訪問規則可以通過配置檔或通過網站管理工具進行編輯。 換句話說,網站管理工具只是一個介面,可以通過該介面在使用者友好的環境中編輯配置檔。

## <a name="using-roles-in-code"></a>在程式碼中使用角色

自版本 1.x 以來,用於角色管理的 API 未更改。 **IsInRole**方法用於確定使用者是否處於特定角色。

[!code-csharp[Main](membership/samples/sample3.cs)]

ASP.NET還會創建作為當前上下文的成員的 RoleThe 實例。 RoleThe 物件可用於獲取使用者所屬的所有角色,如下所示:

[!code-csharp[Main](membership/samples/sample4.cs)]

## <a name="using-rolegroups-with-the-loginview-control"></a>將角色群組與登入檢視控制項一起使用

現在,您已經瞭解了角色管理和成員資格,讓我們簡要討論一下 LoginView 控件如何在 ASP.NET 2.0 中利用此功能。 如前所述,LoginView 控件是一個範本化控制項,預設情況下包含兩個範本;預設情況下,該控件包含兩個範本。匿名範本和登錄範本。 在「登錄查看工作」對話框中,是一個連結(如下所示),允許您編輯角色組。

![](membership/_static/image9.jpg)

**圖 9**

每個 RoleGroup 物件都包含一個字串陣列,用於定義角色組應用於哪些角色。 要向「登錄檢視」控制件添加新角色組,請單擊「編輯角色組」連結。 在上面的映射中,您可以看到我為管理員添加了新的角色組。 通過從「檢視」下拉清單中選擇該角色組(RoleGroup{0}),我可以配置一個僅顯示給管理員角色的範本。 在下圖中,我添加了一個新的 RoleGroup,該角色組適用於銷售角色和分發角色的成員。 這會將第二個角色組添加到 LoginView 任務對話方塊中的「視圖」下拉下拉,而添加到該範本的任何內容都將被「銷售」或「分發」角色中的任何使用者看到。

![](membership/_static/image10.jpg)

**圖 10**

## <a name="overriding-the-existing-membership-provider"></a>重寫現有成員資格提供者

有幾種方法可以擴展ASP.NET成員資格的功能。 首先,您顯然可以通過繼承 SqlSasas 提供者類並重寫其方法來更改其現有功能。 例如,如果要在創建使用者時實現自己的功能,可以創建自己的類,從 SqlSaasProvider 繼承,如下所示:

[!code-csharp[Main](membership/samples/sample5.cs)]

另一方面,如果要創建自己的提供程式(例如,將成員資格資訊存儲在 Access 資料庫中),則可以創建自己的提供程式。

## <a name="creating-your-own-membership-provider"></a>建立您自己的成員資格提供者

要創建自己的成員資格提供程式,首先需要創建從成員資格提供程式類繼承的類。 如果使用VB.NET,Visual Studio 2005 將添加需要重寫的所有方法的存根。 如果使用 C#,則要添加存根。

您需要重寫以下內容:

- 應用程式名稱屬性
- 變更密碼功能
- 變更密碼問答功能
- 建立使用者函數
- 移除使用者功能
- 開啟密碼重設屬性
- 開啟密碼擷取權
- 尋找使用者電子郵件功能
- 尋找使用者依名稱函數
- 取得所有使用者功能
- 取得使用者數量上線功能
- 取得密碼功能
- 取得使用者功能
- 取得使用者名稱透過電子郵件功能
- 最大不合法密碼嘗試屬性
- 最小必需的NonAlpha字元屬性
- 最小所需密碼長度屬性
- 密碼嘗試視窗屬性
- 密碼格式屬性
- 密碼強度正規表示式屬性
- 需要問答屬性
- 需要唯一電子郵件屬性
- 重置密碼功能
- 解除鎖定使用者功能
- 更新使用者功能
- 驗證使用者功能

這是一個相當的清單,以C#開發人員實現。 您可能會發現在沒有任何實現的情況下在VB.NET中創建類會更容易,然後使用 .NET 反射器或類似工具將代碼轉換為 C#。

連接字串和其他屬性應設定為初始化方法中的預設值。 (在運行時載入提供程式時,將觸發初始化方法。初始化方法的第二個參數是 System.集合.專業.NameValueCollection,它是對 Web.config&lt;&gt;檔中與自訂提供程式關聯的添加元素的引用。 該條目如下所示:

[!code-xml[Main](membership/samples/sample6.xml)]

下面是初始化方法的示例。

[!code-csharp[Main](membership/samples/sample7.cs)]

為了驗證使用者提交登錄表單時,您需要使用驗證使用者方法。 當用戶按一下登錄控制項中的登錄按鈕時,將觸發此方法。 您將在此方法中放置執行使用者查找的代碼。

正如您所看到的,編寫自己的成員資格提供程式並不困難,允許您擴展ASP.NET 2.0 的強大功能。
