---
uid: web-forms/overview/moving-to-aspnet-20/profiles-themes-and-web-parts
title: 設定檔、主題和 Web 部件 ( 2) ( S)微軟文件
author: rick-anderson
description: ASP.NET 2.0 中的配置和檢測發生了重大變化。 新的ASP.NET配置 API 允許進行配置更改。
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 92df4051-77c6-492c-bd34-23d24189cea4
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/profiles-themes-and-web-parts
msc.type: authoredcontent
ms.openlocfilehash: 4bc98cca226a0bd9bd766a21e88b0facf2a4b610
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543635"
---
# <a name="profiles-themes-and-web-parts"></a>設定檔、佈景主題與 Web 組件

由[微軟](https://github.com/microsoft)

> ASP.NET 2.0 中的配置和檢測發生了重大變化。 新的ASP.NET配置 API 允許以程式設計方式進行配置更改。 此外,存在許多新的配置設置允許新的配置和檢測。

ASP.NET 2.0 表示個人化網站領域的顯著改善。 除了我們已經介紹的成員資格功能外,ASP.NET配置檔、主題和 Web 部件還顯著增強了網站的個人化。

## <a name="aspnet-profiles"></a>ASP.NET 設定檔

ASP.NET配置檔類似於工作階段。 區別在於配置檔是永久性的,而當瀏覽器關閉時會話丟失。 作業階段和設定檔之間的另一個巨大區別是配置檔類型強,因此在開發過程中為您提供 IntelliSense。

設定檔在電腦設定檔或應用程式的 Web.config 檔中定義。 (您不能在子資料夾 Web.config 檔中定義設定檔。下面的代碼定義了一個配置檔來存儲網站訪問者的名字和姓氏。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample1.xml)]

設定檔屬性的預設資料類型為 System.String。 在上面的示例中,未指定數據類型。 因此,名字和姓氏屬性都是字串類型。 如前所述,配置檔屬性是強類型。 下面的代碼為 Int32 類型的年齡添加了一個新屬性。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample2.xml)]

設定檔通常與ASP.NET窗體身份驗證一起使用。 當與表單身份驗證結合使用時,每個使用者都有與其使用者 ID 關聯的單獨配置檔。 但是,還可以允許在匿名應用程式中使用配置檔中的&lt;配置檔,使用配置檔中的匿名&gt;標識 元素以及**allowAnonymous**屬性,如下所示:

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample3.xml)]

當匿名用戶瀏覽網站時,ASP.NET為使用者創建**ProfileCommon**實例。 此設定檔使用儲存在瀏覽器 Cookie 中的唯一 ID 來識別使用者為唯一存取者。 通過這種方式,您可以為匿名瀏覽的使用者儲存配置檔資訊。

## <a name="profile-groups"></a>設定檔群組

可以對配置檔的屬性進行分組。 通過分組屬性,可以類比特定應用程式的多個配置檔。

以下設定為兩個組設定「Name」 和「姓氏」屬性;買家和潛在客戶。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample4.xml)]

然後,可以按照如下方式設置特定組的屬性:

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample5.cs)]

## <a name="storing-complex-objects"></a>儲存複雜物件

到目前為止,我們介紹的示例已存儲在配置檔中的簡單數據類型。 還可以透過使用**序列化 As**屬性指定序列化方法,將複雜的資料型態儲存在設定檔中,如下所示:

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample6.xml)]

在這種情況下,類型是採購發票。 採購發票類需要標記為可序列化,並可以包含任意數量的屬性。 例如,如果購買發票具有名為**NumItems購買**的屬性,則可以在代碼中引用該屬性,如下所示:

[!code-css[Main](profiles-themes-and-web-parts/samples/sample7.css)]

## <a name="profile-inheritance"></a>設定檔案繼承

可以創建用於多個應用程式的配置檔。 以建立派生自 ProfileBase 的設定檔類,可以使用**繼承**屬性在多個應用程式中重用設定檔,如下所示:

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample8.xml)]

在這種情況下,類**採購配置檔**如下所示:

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample9.cs)]

## <a name="profile-providers"></a>設定檔案提供者

ASP.NET配置檔使用提供程式模型。 預設提供程式使用 SqlProfileProvider 提供程式將資訊儲存\_在 Web 應用程式的應用資料資料夾中的 SQL Server Express 資料庫中。 如果資料庫不存在,ASP.NET將在設定檔嘗試儲存資訊時自動創建它。

但是,在某些情況下,您可能需要開發自己的配置檔提供程式。 ASP.NET配置檔功能使您能夠輕鬆使用不同的提供程式。

在:

- 您需要在資料來源(如 FoxPro 資料庫或 Oracle 資料庫中)儲存設定檔資訊,而 .NET Framework 中包含的設定檔提供者不支援這些資訊。
- 您需要使用與 .NET 框架中包含的提供程式使用的資料庫架構不同的資料庫架構來管理設定檔資訊。 一個常見範例是,您希望將設定檔資訊與現有 SQL Server 資料庫中的用戶數據整合。

### <a name="required-classes"></a>必填類

要實現設定檔提供者,請建立繼承 System.Web.Profile.Profile.ProfileProvider 抽象類的類。 **配置檔提供程式**抽象類反過來繼承 System.配置.settingsProvider 提供程式抽象類,該類繼承系統.配置.提供程式.提供程式基礎抽象類。 由於此繼承鏈,除了**配置檔提供程式**類的必需成員外,還必須實現**設置提供程式**和**提供程式基礎**類所需的成員。

下表描述了必須從**提供程式基礎**、**設定提供者**和**設定檔提供程式**抽象類實現的屬性和方法。

### <a name="providerbase-members"></a>提供者基礎成員

| **成員** | **說明** |
| --- | --- |
| Initialize 方法 | 將提供程式實例的名稱和配置設定的 NameValue 集合作為輸入。 用於為提供程式實例設置選項和屬性值,包括計算機配置或 Web.config 檔中指定的特定於實現的值和選項。 |

### <a name="settingsprovider-members"></a>設定提供者成員

| **成員** | **說明** |
| --- | --- |
| 應用程式名稱屬性 | 與每個配置檔一起存儲的應用程式名稱。 設定檔提供程式使用應用程式名稱為每個應用程式單獨儲存設定檔資訊。 這樣,如果在不同的應用程式中創建相同的使用者名,則多個ASP.NET應用程式可以使用相同的數據源,而不會發生衝突。 或者,多個ASP.NET應用程式可以通過指定相同的應用程式名稱共用配置檔數據來源。 |
| 取得屬性值方法 | 將「設置上下文」和「設定屬性收集」物件作為輸入。 **設置上下文**提供有關用戶的資訊。 可以使用資訊作為主鍵來檢索使用者的配置檔屬性資訊。 使用 **「設定上下文」** 物件獲取使用者名稱以及使用者是否經過身份驗證還是匿名。 **"設定屬性集合**"包含設置屬性物件的集合。 每個**SettingsProperty**物件都提供屬性的名稱和類型以及其他資訊,例如屬性的預設值以及該屬性是否為唯讀。 **GetPropertyValue**方法基於作為輸入提供的 **「設定屬性」** 物件使用「設定屬性值」物件填充「設定屬性值集合」。 指定用戶的數據來源中的值將分配給每個**SettingsPropertyValue**物件的屬性值屬性,並返回整個集合。 呼叫 該方法還會將指定使用者設定檔的「上次活動日期」值更新為當前日期和時間。 |
| 設定屬性值方法 | 將 **「設定上下文」** 和 **「設定屬性值收集」** 物件作為輸入。 **設置上下文**提供有關用戶的資訊。 可以使用資訊作為主鍵來檢索使用者的配置檔屬性資訊。 使用 **「設定上下文」** 物件獲取使用者名稱以及使用者是否經過身份驗證還是匿名。 **設定屬性值集合**"包含**設定屬性值**物件的集合。 每個**SettingsPropertyValue 物件**都提供屬性的名稱、類型和值以及其他資訊,例如屬性的預設值以及該屬性是否為唯讀。 **SetPropertyValue**方法更新指定使用者的數據來源中的設定檔屬性值。 呼叫 該方法還會將指定使用者設定檔**的「上次活動日期」** 和「上次更新日期」值更新為當前日期和時間。 |

### <a name="profileprovider-members"></a>設定檔提供者成員

| **成員** | **說明** |
| --- | --- |
| 刪除設定檔方法 | 將使用者名字符串陣組作為輸入,並從資料源中刪除應用程式名稱與**應用程式名稱**屬性值匹配的指定名稱的所有配置檔資訊和屬性值。 如果資料來源支援事務,建議您在事務中包括所有刪除操作,並在任何刪除操作失敗時回滾事務並引發異常。 |
| 刪除設定檔方法 | 將 ProfileInfo 物件的集合作為輸入,並從資料源中刪除應用程式名稱與**應用程式名稱匹配應用程式名稱**屬性值的每個配置檔的所有設定檔資訊和屬性值。 如果數據源支援事務,建議您在事務中包括所有刪除操作,並回滾事務,並在任何刪除操作失敗時引發異常。 |
| 移除非作用設定檔方法 | 將 Profile 身份驗證選項值和 DateTime 物件作為輸入,並從資料來源中刪除最後活動日期小於或等於指定日期和時間且應用程式名稱與**應用程式名稱與應用程式名稱**屬性值匹配的所有設定檔資訊和屬性值。 **設定檔身份驗證選項**參數指定是否僅刪除匿名設定檔、僅身份驗證的設定檔或所有設定檔。 如果數據源支援事務,建議您在事務中包括所有刪除操作,並回滾事務,並在任何刪除操作失敗時引發異常。 |
| 取得所有設定檔方法 | 將**設定檔身份驗證選項**值、指定頁面索引的整數、指定頁面大小的整數和將設置為設定檔總計數的整數的引用作為輸入。 傳回設定檔資訊集合,其中包含資料來源中所有設定檔的**配置檔,** 其中應用程式名稱與**應用程式名稱**屬性值匹配。 **設定檔身份驗證選項**參數指定是否僅返回匿名設定檔、僅身份驗證的設定檔或所有設定檔。 **GetAllProfiles**方法返回的結果受頁面索引和頁面大小值的約束。 頁面大小值指定要在**設定檔資訊集合**中傳回的最大**設定檔資訊**物件數。 頁面索引值指定要返回的結果頁面,其中 1 標識第一頁。 總記錄的參數是一個 out 參數(您可以在 Visual Basic 中使用**ByRef),** 該參數設定為設定檔的總數。 例如,如果資料存儲包含應用程式的 13 個設定檔,並且頁面索引值為 2,頁面大小為**5,則傳回的 ProfileInfoCollection**包含第六個到第十個設定檔。 當方法返回時,總記錄值設置為 13。 |
| 取得所有非作用設定檔方法 | 將**設定檔身份驗證選項**值 **、DateTime**物件、指定頁面索引的整數、指定頁面大小的整數以及將設置為設定檔總計數的整數的引用作為輸入。 傳**回 設定檔資訊集合**,其中包含資料來源中所有設定檔的**ProfileInfo**物件,其中上次活動日期小於或等於指定的**DateTime,** 並且應用程式名稱與**應用程式名稱**屬性值匹配。 **設定檔身份驗證選項**參數指定是否僅返回匿名設定檔、僅身份驗證的設定檔或所有設定檔。 **GetAllInactive 配置檔**方法返回的結果受頁面索引和頁面大小值的約束。 頁面大小值指定要在**設定檔資訊集合**中傳回的最大**設定檔資訊**物件數。 頁面索引值指定要返回的結果頁面,其中 1 標識第一頁。 總記錄的參數是一個 out 參數(您可以在 Visual Basic 中使用**ByRef),** 該參數設定為設定檔的總數。 例如,如果資料存儲包含應用程式的 13 個設定檔,並且頁面索引值為 2,頁面大小為**5,則傳回的 ProfileInfoCollection**包含第六個到第十個設定檔。 當方法返回時,總記錄值設置為 13。 |
| 尋找設定檔以使用者名稱 | 將 Profile**身份驗證選項**值、包含使用者名的字串、指定頁面索引的整數、指定頁面大小的整數以及將設置為配置檔總計數的整數的引用作為輸入。 傳**回 設定檔資訊集合**,其中包含資料來源中所有設定檔的**ProfileInfo**物件,其中使用者名稱與指定的使用者名匹配,應用程式名稱與**應用程式名稱**屬性值匹配。 **設定檔身份驗證選項**參數指定是否僅返回匿名設定檔、僅身份驗證的設定檔或所有設定檔。 如果數據源支援其他搜索功能(如通配符),則可以為使用者名提供更廣泛的搜索功能。 **FindProfilesByUserName**方法傳回的結果受頁面索引和頁面大小值的約束。 頁面大小值指定要在**設定檔資訊集合**中傳回的最大**設定檔資訊**物件數。 頁面索引值指定要返回的結果頁面,其中 1 標識第一頁。 總記錄的參數是一個 out 參數(您可以在 Visual Basic 中使用**ByRef),** 該參數設定為設定檔的總數。 例如,如果資料存儲包含應用程式的 13 個設定檔,並且頁面索引值為 2,頁面大小為**5,則傳回的 ProfileInfoCollection**包含第六個到第十個設定檔。 當方法返回時,總記錄值設置為 13。 |
| 尋找非作用設定檔以使用者名稱方法 | 將 Profile**身份驗證選項**值、包含使用者名的字串 **、DateTime**物件、指定頁面索引的整數、指定頁面大小的整數以及對將設定為設定檔總計數的整數的引用作為輸入。 傳**回 設定檔資訊集合**,其中包含資料來源中所有設定檔的**ProfileInfo**物件,其中使用者名稱與指定的使用者名稱符合,上次活動日期小於或等於指定的**DateTime**,以及應用程式名稱與**應用程式名稱**屬性值匹配。 **設定檔身份驗證選項**參數指定是否僅返回匿名設定檔、僅身份驗證的設定檔或所有設定檔。 如果數據源支援其他搜索功能(如通配符),則可以為使用者名提供更廣泛的搜索功能。 **FindInactive設定檔ByUserName**方法傳回的結果受頁面索引和頁面大小值的約束。 頁面大小值指定要在**設定檔資訊集合**中傳回的最大**設定檔資訊**物件數。 頁面索引值指定要返回的結果頁面,其中 1 標識第一頁。 總記錄的參數是一個 out 參數(您可以在 Visual Basic 中使用**ByRef),** 該參數設定為設定檔的總數。 例如,如果資料存儲包含應用程式的 13 個設定檔,並且頁面索引值為 2,頁面大小為**5,則傳回的 ProfileInfoCollection**包含第六個到第十個設定檔。 當方法返回時,總記錄值設置為 13。 |
| 取得非作用設定檔方法的數量 | 將**設定檔身份驗證選項**值和**DateTime**物件作為輸入,並傳回資料來源中所有設定檔的計數,其中上次活動日期小於或等於指定的**DateTime,** 並且應用程式名稱與**應用程式名稱**屬性值匹配。 **設定檔身份驗證選項**參數指定是否僅計算匿名設定檔、僅身份驗證的設定檔或所有設定檔。 |

### <a name="applicationname"></a>ApplicationName

由於配置檔提供程式為每個應用程式單獨儲存設定檔資訊,因此必須確保資料架構包含應用程式名稱,並且查詢和更新也包含應用程式名稱。 例如,以下命令用於根據使用者名和配置檔是否匿名從資料庫中檢索屬性值,並確保**應用程式中名**值包含在查詢中。

[!code-sql[Main](profiles-themes-and-web-parts/samples/sample10.sql)]

## <a name="aspnet-themes"></a>ASP.NET主題

## <a name="what-are-aspnet-20-themes"></a>什麼是2.0主題ASP.NET?

Web 應用程式最重要的方面之一是整個網站的外觀和感覺一致。 ASP.NET 1.x 開發人員通常使用級聯樣式表 (CSS) 來實現一致的外觀。 ASP.NET 2.0 主題在 CSS 上顯著提高,因為它們使 ASP.NET 開發人員能夠定義 ASP.NET 伺服器控制件和 HTML 元素的外觀。 ASP.NET主題可以應用於單個控制項、特定網頁或整個 Web 應用程式。 如果需要影像,主題使用 CSS 檔、可選外觀檔和可選圖像目錄的組合。 外觀檔案控制伺服器控制件ASP.NET的視覺外觀。

## <a name="where-are-themes-stored"></a>主題存儲在哪裡?

主題的存儲位置因主題的範圍而異。 可套用於任何應用程式的主題儲存在以下資料夾中:

`C:\WINDOWS\Microsoft.NET\Framework\v2.x.xxxxx\ASP.NETClientFiles\Themes\<Theme_Name>`

特定於特定應用程式的主題存儲在`App\_Themes\<Theme\_Name>`網站根目錄中。

> [!NOTE]
> 外觀檔應僅修改影響外觀的伺服器控制項屬性。

全域主題是一個主題,可應用於 Web 伺服器上運行的任何應用程式或網站。 默認情況下,這些主題存儲在 v2.x.xxxxx 目錄內的 ASP.NETClientfile_主題目錄中。 或者,您可以將主題檔移動到網站根目錄中的 aspnet\_\_用戶端/ 系統 Web/[版本]/主題/[\_主題名稱]資料夾中。

特定於應用程式的主題只能應用於檔所在的應用程式。 這些檔案存儲在`App\_Themes/<theme\_name>`網站根目錄中。

## <a name="the-components-of-a-theme"></a>主題的組成部分

主題由一個或多個 CSS 檔、可選外觀檔和可選的圖像資料夾組成。 CSS 檔案可以是您希望的任何名稱(即預設.css 或主題.css 等),並且必須位於主題資料夾的根目錄中。 CSS 檔案用於定義特定選擇器的普通 CSS 類和屬性。 要將其中一個 CSS 類應用於頁面元素,將使用**CSSClass**屬性。

外觀檔是一個 XML 檔,其中包含ASP.NET伺服器控件的屬性定義。 下面列出的代碼是示例外觀檔。

[!code-aspx[Main](profiles-themes-and-web-parts/samples/sample11.aspx)]

**下圖 1**顯示了瀏覽的一個小ASP.NET頁面,其中沒有應用主題。 **圖 2**顯示了應用主題的同一檔。 背景顏色和文字顏色透過 CSS 檔進行設定。 按鈕和文字框的外觀使用上面列出的外觀檔進行配置。

![沒有主題](profiles-themes-and-web-parts/_static/image1.gif)

**圖 1**: 無佈景主題

![應用程式](profiles-themes-and-web-parts/_static/image2.gif)

**圖 2**: 應用的主題

上面列出的外觀檔為所有 TextBox 控制件和 Button 控制件定義了預設外觀。 這意味著,插入到頁面上的每個 TextBox 控制件和按鈕控制項都將採用此外觀。 您還可以使用控制項的**SkinID**屬性定義可應用於這些控制件的特定實例的皮膚。

下面的代碼為 Button 控制件定義外觀。 只有具有**goButton** **SkinID**屬性的 Button 控制件才會呈現外觀。

[!code-aspx[Main](profiles-themes-and-web-parts/samples/sample12.aspx)]

每個伺服器控制項類型只能有一個預設外觀。 如果需要其他外觀,則應使用 SkinID 屬性。

## <a name="applying-themes-to-pages"></a>將主題應用於頁面

可以使用以下任一方法應用主題:

- 在&lt;Web.config 檔案&gt;的頁面 元素中
- 在@Page頁面的指令中
- 以程式設計方式

## <a name="applying-a-theme-in-the-configuration-file"></a>在設定檔中應用程式

在應用程式設定檔中應用主題,請使用以下語法:

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample13.xml)]

這個處指定的主題名稱必須與主題資料夾的名稱匹配。 此資料夾可以存在於本課程前面提到的任意位置。 如果嘗試應用不存在的主題,則會發生配置錯誤。

## <a name="applying-a-theme-in-the-page-directive"></a>套用頁面指令中的主題

您還可以在 @ Page 指令中應用主題。 此方法允許您為特定頁面使用主題。

要應用指令中@Page的主題,請使用以下語法:

[!code-aspx[Main](profiles-themes-and-web-parts/samples/sample14.aspx)]

同樣,此處指定的主題必須與前面提到的主題資料夾匹配。 如果嘗試應用不存在的主題,則會發生生成失敗。 Visual Studio 還將突出顯示該屬性,並通知您不存在此類主題。

## <a name="applying-a-theme-programmatically"></a>以程式設計方式應用程式

要以程式設計方式應用主題,必須在 **「\_頁面 PreInit」** 方法中指定頁面**的主題**屬性。

要以程式設計方式應用程式,請使用以下語法:

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample15.cs)]

由於頁面生命週期,有必要在 PreInit 方法中應用主題。 如果在該點之後應用它,則運行時已應用頁面主題,並且此時的更改在生命週期中為時已晚。 如果應用不存在的主題,則會發生 **"例外"。** 以程式設計方式應用主題時,如果任何伺服器控制項指定了 SkinID 屬性,則將發生生成警告。 此警告旨在通知您,沒有聲明性地應用任何主題,並且可以忽略它。

## <a name="exercise-1--applying-a-theme"></a>練習 1 : 應用主題

在本練習中,您將對網站應用ASP.NET主題。

> [!IMPORTANT]
> 如果使用 Microsoft Word 在外觀檔中輸入資訊,請確保不會用智慧引號替換常規報價。 智慧引號會導致皮膚文件出現問題。

1. 建立新的 ASP.NET 網站。
2. 右鍵單擊解決方案資源管理器中的專案,然後選擇"添加新專案"。
3. 從檔案清單中選擇 Web 設定檔,然後按一下「添加」。
4. 右鍵單擊解決方案資源管理器中的專案,然後選擇"添加新專案"。
5. 選擇"皮膚檔",然後單擊"添加"。
6. 當被問及是否希望將檔放在應用\_主題資料夾內時,請單擊"是"。
7. 右鍵單擊解決方案資源管理器中應用\_主題資料夾內的 SkinFile 資料夾,然後選擇「添加新專案」。。
8. 從檔案清單中選擇"樣式表",然後單擊"添加"。 現在,您擁有實現新主題所需的所有檔。 但是,Visual Studio 已命名您的主題資料夾 SkinFile。 右鍵按這裏目錄並將名稱更改為 CoolTheme。
9. 開啟 SkinFile.skin 檔,並在檔案末尾添加以下代碼: 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample16.aspx)]
10. 保存外觀檔.皮膚檔。
11. 開啟樣式表。css.
12. 將其中的所有文字取代為以下內容: 

    [!code-css[Main](profiles-themes-and-web-parts/samples/sample17.css)]
13. 保存樣式表.css 檔。
14. 打開預設.aspx 頁面。
15. 新增文字框控制項和按鈕控制項。
16. 儲存網頁。 現在流覽預設.aspx 頁面。 它應顯示為普通 Web 窗體。
17. 打開 Web.config 檔。
18. 在開啟`<system.web>`標籤的正下方新增以下內容: 

    [!code-xml[Main](profiles-themes-and-web-parts/samples/sample18.xml)]
19. 保存 Web.config 檔。 現在流覽預設.aspx 頁面。 它應顯示應用的主題。
20. 如果尚未打開,則打開 Visual Studio 中的 Default.aspx 頁面。
21. 選擇按鈕。
22. 將**SkinID**屬性更改為「 按鈕」。 請注意,Visual Studio 提供了一個帶有按鈕控件有效 SkinID 值的下拉清單。
23. 儲存網頁。 現在再次在瀏覽器中預覽頁面。 按鈕現在應該說"去",並且應該在外觀上更寬。

使用**SkinID**屬性,可以輕鬆地為特定類型的伺服器控制件的不同實例配置不同的外觀。

## <a name="the-stylesheettheme-property"></a>樣式表主題屬性

到目前為止,我們只討論了使用主題屬性應用主題。 使用主題屬性時,外觀檔將覆蓋伺服器控制項的任何聲明性設置。 例如,在練習 1 中,您為 Button 控件指定了" goButton" 的 SkinID,並將按鈕的文字更改為" go" 您可能已經注意到,設計器中的 Button 的 Text 屬性設置為"按鈕",但主題超過了該屬性。 主題將始終覆蓋設計器中的任何屬性設置。

如果希望能夠使用設計器中指定的屬性覆蓋主題外觀檔中定義的屬性,則可以使用**StyleSheetTheme**屬性而不是主題屬性。 StyleSheetTheme 屬性與主題屬性相同,只不過它不覆蓋所有顯式屬性設置(如主題屬性)。

要檢視此操作,應開啟練習 1 中的專案中的 Web.config 檔,`<pages>`並將該元素變更為以下內容:

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample19.xml)]

現在瀏覽 Default.aspx 頁面,您將看到 Button 控制件再次具有「按鈕」的文本屬性。 這是因為設計器中的顯式屬性設置重寫 goButton SkinID 設置的文本屬性。

## <a name="overriding-themes"></a>壓倒主題

通過在應用程式的「應用\_主題」資料夾中應用同名主題,可以覆蓋全域主題。 但是,主題不會應用於真正的重寫方案。 如果運行時遇到應用\_主題資料夾中的主題檔,它將使用這些文件應用主題,並將忽略全域主題。

StyleSheetTheme 屬性是可重寫的,可以在代碼中重寫,如下所示:

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample20.cs)]

## <a name="web-parts"></a>Web 組件

ASP.NET Web 部件是一組整合的控制項,用於建立網站,使最終使用者能夠直接從瀏覽器修改網頁的內容、外觀和行為。 修改可以應用於網站上的所有使用者或單個使用者。 當使用者修改頁面和控件時,可以保存這些設置,以便在將來的瀏覽器會話中保留使用者的個人首選項,這是一種稱為個人化的功能。 這些 Web 部件功能意味著開發人員可以授權最終使用者動態個人化 Web 應用程式,而無需開發人員或管理員干預。

使用 Web 元件控制項集,作為開發人員,您可以讓最終使用者能夠:

- 個人化頁面內容。 用戶可以向頁面添加新的 Web 部件控制件、刪除它們、隱藏它們或像普通視窗一樣最小化它們。
- 個人化頁面佈局。 用戶可以將 Web 部件控制器拖動到頁面上的不同區域,或更改其外觀、屬性和行為。
- 匯出和導入控制。 用戶可以導入或匯出 Web 部件控制元件設定以用於其他頁面或網站,保留控制項中的屬性、外觀甚至資料。 這減少了最終用戶的數據輸入和配置需求。
- 建立連接。 用戶可以在控制項之間建立連接,以便圖表控制項可以在股票代碼控制件中顯示數據的圖形。 用戶不僅可以個人化連接本身,還可以對圖表控件如何顯示數據的外觀和詳細資訊進行個人化設置。
- 管理和個人化網站級設置。 授權用戶可以配置網站級設置、確定誰可以訪問網站或頁面、設置基於角色的控制項存取等。 例如,管理角色中的使用者可以將 Web 部件控制項設置為由所有使用者共用,並防止非管理員的使用者對共用控制件進行個人化設置。

通常,您將使用 Web 部件的三種方式之一:創建使用 Web 部件控制元件的頁面、創建單獨的 Web 部件控制件或創建完整、可個人化的 Web 應用程式(如門戶)。

## <a name="page-development"></a>頁面開發

頁面開發人員可以使用可視化設計工具(如 Microsoft Visual Studio 2005)創建使用 Web 部件的頁面。 使用 Visual Studio 等工具的一個優點是,Web 部件控制項集提供了用於在可視化設計器中拖放創建和配置 Web 部件控制項的功能。 例如,可以使用設計器將 Web 部件區域或 Web 部件編輯器控制元件拖到設計圖面上,然後使用 Web 部件控制者提供的 UI 在設計器中配置控制元件。 這可以加快 Web 部件應用程式的開發,並減少必須編寫的代碼量。

## <a name="control-development"></a>控制開發

您可以將任何現有的ASP.NET控制項用作Web 元件控制項,包括標準 Web 伺服器控制項、自訂伺服器控制項和使用者控制項。 為了最大限度地程式設計地控制環境,您還可以創建派生自 WebPart 類的自訂 Web 部件控制件。 對於單個 Web 部件控制件開發,您通常會創建使用者控制項並將其用作 Web 部件控制項,或者開發自訂 Web 部件控制元件。

作為開發自訂 Web 部件控制件的範例,您可以建立一個控制項來提供其他ASP.NET伺服器控制件提供的任何功能,這些功能可能可用於打包為可個人化 Web 部件控制件:日曆、清單、財務資訊、新聞、計算機、用於更新內容的豐富文本控制項、連接到資料庫的可編輯網格、動態更新其顯示器的圖表,或天氣和旅行資訊。 如果為視覺設計器提供了控制項,則使用 Visual Studio 的任何頁面開發人員只需將控制項拖入 Web 部件區域並在設計時對其進行配置,而無需編寫其他代碼即可。

個人化是 Web 部件功能的基礎。 它使用戶能夠修改或個人化頁面上 Web 部件控制件的佈局、外觀和行為。 個性化設置是長期存在的:它們不僅在當前瀏覽器會話期間(如視圖狀態)保留,而且還保存在長期存儲中,以便用戶的設置也保存為將來的瀏覽器會話。 默認情況下,為 Web 部件頁面啟用個人化。

UI 結構元件依賴於個人化,並提供所有 Web 部件控制件所需的核心結構和服務。 每個 Web 部件頁面上都需要一個 UI 結構元件是 WebPartManager 控制件。 儘管永遠不會可見,但此控制件具有協調頁面上所有 Web 部件控制項的關鍵任務。 例如,它跟蹤所有單獨的 Web 部件控制元件。 它管理 Web 部件區域(在頁面上包含 Web 部件控制項的區域),以及哪些控制件位於哪些區域中。 它還追蹤和控制頁面可以採用的不同顯示模式,例如瀏覽、連接、編輯或目錄模式,以及個人化更改是否適用於所有使用者或單個使用者。 最後,它啟動和跟蹤 Web 部件控制元件之間的連接和通訊。

第二種 UI 結構元件是區域。 區域充當 Web 部件頁上的佈局管理員。 它們包含並組織派生自 Part 類(零件控制件)的控制項,並提供以水準或垂直方向執行模組化頁面佈局的能力。 區域還提供常見和一致的 UI 元素(如標題和頁腳樣式、標題、邊框樣式、操作按鈕等)以包含每個控制件;這些常見元素稱為控件的鑲邊。 在不同的顯示模式和各種控制項中,使用幾種專用類型的區域。 不同類型的區域在下面的"Web 部件基本控制"部分中介紹。

Web 部件 UI 控制件(所有這些控制者都派生自**部件**類)構成了 Web 部件頁上的主 UI。 Web 部件控制項集在創建零件控制元件的選項中具有靈活性和包容性。 除了創建自己的自定義 Web 部件控制件外,還可以使用現有的 ASP.NET 伺服器控制項、使用者控制件或自訂伺服器控制件作為 Web 部件控制件。 下一節將介紹最常用於創建 Web 部件頁的基本控件。

## <a name="web-parts-essential-controls"></a>Web 組件控制

Web 部件控制項集很廣泛,但某些控制項至關重要,因為它們是 Web 元件工作所必需的,或者因為它們是 Web 部件頁面上最常用的控制項。 當您開始使用 Web 部件並創建基本的 Web 部件頁時,熟悉下表中描述的基本 Web 部件控制件會很有説明。

| **Web 組件控制項** | **說明** |
| --- | --- |
| Web 組件管理員 | 管理頁面上的所有 Web 部件控制項。 每個 Web 部件頁面都需要一個(並且只有一個 **)WebPartManager**控制件。 |
| 目錄區 | 包含目錄部分控制項。 使用此區域可以創建 Web 部件控制件的目錄,使用者可以從中選擇要添加到頁面的控制項。 |
| 編輯器區域 | 包含編輯器部分控制項。 使用此區域可使用戶能夠編輯和個人化頁面上的 Web 部件控制元件。 |
| Web 部分區域 | 包含並提供有關構成頁面主 UI 的 WebPart 控件的總體佈局。 每當使用 Web 部件控制件創建頁面時,都會使用此區域。 頁面可以包含一個或多個區域。 |
| 連接區域 | 包含 WebPart 連接控制項,並提供用於管理連接的 UI。 |
| Web 組件(一般 Web 部分) | 呈現主 UI;大多數 Web 部件 UI 控件都屬於此類別。 為了進行最大的程式設計控制,您可以創建從基本**WebPart**控制件派生的自訂 Web 部件控制件。 您還可以使用現有的伺服器控制項、使用者控制項或自訂控制項為 Web 元件控制項。 每當將其中任何一個控制項放置在區域中時 **,WebPartManager**控制件會在執行時自動將其與**泛型WebPart**控制件進行包裝,以便您可以將它們與 Web 部件功能一起使用。 |
| 目錄部分 | 包含使用者可以添加到頁面的可用 Web 部件控制項的清單。 |
| Web 部分連線 | 在頁面上的兩個 Web 部件控制件之間建立連接。 連接將其中一個 Web 部件控制件定義為提供程式(資料),另一個控制項定義為消費者。 |
| 編輯器部分 | 用作專用編輯器控制件的基類。 |
| 編輯器部分控制器(外觀編輯器部分、佈局編輯器部分、行為編輯器部分和屬性閘格編輯器部分) | 允許使用者在頁面上個人化 Web 部件 UI 控制項的各個方面 |

## <a name="lab-create-a-web-part-page"></a>實驗室:建立網頁零件頁面

在本實驗中,您將創建一個 Web 部件頁,該頁面將透過 ASP.NET 設定檔保留資訊。

### <a name="creating-a-simple-page-with-web-parts"></a>使用 Web 元件建立簡單頁面

在這個演練的這一部分中,您將建立一個使用 Web 部件控制器顯示靜態內容的頁面。 使用 Web 部件的第一步是創建包含兩個必需結構元素的頁面。 首先,Web 部件頁需要 WebPartManager 控制件來追蹤和協調所有 Web 部件控制項。 其次,Web 部件頁需要一個或多個區域,這些區域是包含 WebPart 或其他伺服器控制項並佔用頁面指定區域的複合控制件。

> [!NOTE]
> 您無需執行任何操作來啟用 Web 部件個人化;默認情況下,它為 Web 部件控制件集啟用。 首次在網站上運行 Web 部件頁面時,ASP.NET設置預設個人化提供程式以存儲使用者個人化設置。 有關個人化的詳細資訊,請參閱 Web 部件個人化概述。

### <a name="to-create-a-page-for-containing-web-parts-controls"></a>建立用於包含 Web 元件控制元件的頁面

1. 關閉預設頁面,向名為 WebPartsDemo.aspx 的網站添加新頁面。
2. 切換到 **"設計"** 視圖。
3. 在 **「查看」** 選單中,請確保選擇了 **「非可視控件**和**詳細資訊**」選項,以便可以看到沒有 UI 的佈局標記和控制項。
4. 將插入點放在設計圖`<div>`面上的標記之前,然後按 ENTER 添加新行。 將插入點放在新行字元之前,按一下選單上的 **「塊格式」** 下拉清單控制項,然後選擇**標題 1**選項。 在標題中, 加入文字**Web 部件範例**。
5. 從工具箱的**WebParts**選項卡中,將**WebPartManager**控件拖到頁面上,將其定位在新行`<div>`字元之後和標記之前。   
  
   **WebPartManager**控制件不呈現任何輸出,因此它在設計器表面上顯示為灰色框。
6. 將插入點移至標記中`<div>`。
7. 在**版佈局「 選**單中」,按下 **「插入表**」並建立一個包含一行和三列的新錶。 按下 **「儲存格屬性**」 按鈕,從 **「垂直對齊**下拉清單」 中選擇**頂部**,按下「**確定**」,然後再次按下 **「確定**」 以建立表。
8. 將 WebPartZone 控制件拖動到左側表列中。 右鍵按這裏網頁**部件( S)****Properties**   
  
   ID: 邊欄區域   
  
   標題文字:邊列
9. 將第二個**WebPartZone 控制檔**拖曳到中間表列中並設定以下屬性:   
  
   ID: 主區域   
  
   標題文字:主
10. 儲存檔案。

您的頁面現在有兩個不同的區域,您可以單獨控制。 但是,這兩個區域都沒有任何內容,因此創建內容是下一步。 在本演練中,您可以使用僅顯示靜態內容的 Web 部件控制元件。

Web 部件區域的佈局&lt;由區域範&gt;本 元素指定。 在區域範本中,可以添加任何ASP.NET控件,無論是自訂Web部件控制項、使用者控制項還是現有伺服器控制件。 請注意,此處使用"標籤"控件,並且只需添加靜態文本即可。 將常規伺服器控制元件放置在**WebPartZone**區域時,ASP.NET 在執行時將該控制項視為 Web 元件控制項,從而在控制項上啟用 Web 元件功能。

**為主區域建立內容**

1. 在 **「設計」** 檢視中,將 **「標籤」** 控制項從工具箱**的「標準**」選項卡拖動到其**ID**屬性設定為 MainZone 的區域的內容區域中。
2. 切換到**源**視圖。 請注意,&lt;已添加&gt;區域 樣本元素以包裝 MainZone 中**的標籤**控制項。
3. 將名為**標題**的屬性添加到&lt;asp:label&gt;元素,並將其值設置為"內容"。 從&lt;asp:label&gt;元素中刪除 Text="Label"屬性。 在&lt;&gt;asp:label 元素的打開和關閉標記之間,在&lt;一對&gt;h2 元素標記中添加一些文字,如 **"歡迎到我的主頁**"。 您的代碼應如下所示。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample21.aspx)]
4. 儲存檔案。

接下來,創建一個使用者控制項,該控制項也可以作為 Web 部件控制件添加到頁面。

### <a name="to-create-a-user-control"></a>建立使用者控制項

1. 向您的網站添加新的 Web 使用者控制項以用作搜尋控制項。 取消選擇要**將原始碼放在單獨的檔中**的選項。 將其添加到與 WebPartsDemo.aspx 頁面相同的目錄中,並將其命名為「搜索使用者控制.ascx」。。   
  
    > [!NOTE]
    > 本演練的使用者控件不實現實際搜索功能;因此,此演練的使用者控件不實現實際搜索功能。它僅用於演示 Web 部件功能。
2. 切換到 **"設計"** 視圖。 從工具箱的 **「標準**」選項卡中,將文字框控件拖到頁面上。
3. 將插入點放在剛剛添加的文本框後,然後按 ENTER 添加新行。
4. 將「按鈕」控制器拖到您剛剛加入的文字框下方的新行上的頁面上。
5. 切換到**源**視圖。 確保使用者控制的原始碼類似於以下範例。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample22.aspx)]
6. 儲存並關閉檔案。

現在,您可以將 Web 部件控制件添加到邊欄區域。 您將向邊欄區域添加兩個控制項,一個包含連結清單,另一個控制項是您在上一個過程中創建的使用者控制項。 這些連結添加為標準**Label**伺服器控制項,類似於為主區域創建靜態文本的方式。 但是,儘管使用者控件中包含的單個伺服器控件可以直接包含在區域中(如標籤控件),但在這種情況下,它們不是。 相反,它們是您在上一過程中創建的使用者控制項的一部分。 這演示了一種常見方法,用於打包使用者控件中所需的任何控制項和額外功能,然後將區域中的控制項引用為 Web 部件控制元件。

在運行時,Web 部件控制件集使用泛型WebPart控制項換行兩個控制項。 當**GenericWebPart**控制件包裝 Web 伺服器控制項時,通用組件控制項是父控制項,您可以透過父控制項的子控制件屬性存取伺服器控制件。 使用通用部件控制項使標準 Web 伺服器控制件具有與從**WebPart**類派生的 Web 部件控制元件相同的基本行為和屬性。

### <a name="to-add-web-parts-controls-to-the-sidebar-zone"></a>將 Web 組件加入到邊欄區域

1. 打開 WebPartsDemo.aspx 頁面。
2. 切換到 **"設計"** 視圖。
3. 將您創建的使用者控制件頁面 SearchUserControl.ascx 從**解決方案資源管理器**拖曳到其**ID**屬性設定為 SidebarZone 的區域,並將其拖放到該區域。
4. 保存 WebPartsDemo.aspx 頁面。
5. 切換到**源**視圖。
6. 在側&lt;邊欄區域的 asp:webpartzone&gt;元素(對使用者控制項的引用正上方&lt;)內,&gt;添加包含連結的 asp:label 元素,如以下範例所示。 此外,向使用者控制件標記添加**Title**屬性,其值為 **「搜索**」,如圖所示。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample23.aspx)]
7. 儲存並關閉檔案。

現在,您可以通過在瀏覽器中瀏覽頁面來測試頁面。 該頁顯示兩個區域。 下面的屏幕截圖顯示了頁面。

**包含兩個區域的 Web 部件展示頁面**

![Web 元件 VS 演練 1 螢幕截圖](profiles-themes-and-web-parts/_static/image3.gif)

**圖 3**: Web 元件 VS 演練 1 螢幕擷取

在每個控制項的標題列中,是一個向下箭頭,用於造訪可在控制項上執行的可用操作的謂詞選單。 按下其中一個控制項的謂詞選單,然後單擊 **「最小化**」謂詞並注意該控制件最小化。 在謂詞功能表中,按一下「**還原**」,控件將返回到其正常大小。

### <a name="enabling-users-to-edit-pages-and-change-layout"></a>允許使用者編輯頁面和變更佈局

Web 部件為使用者提供了透過將 Web 元件控制項從一個區域拖動到另一個區域來更改其佈局的功能。 除了允許使用者將**WebPart**控件從一個區域移動到另一個區域外,還可以允許使用者編輯控制件的各種特徵,包括其外觀、佈局和行為。 Web 部件控制項集為**WebPart**控制件提供了基本編輯功能。 儘管在本演練中不會這樣做,但您也可以創建自定義編輯器控制項,允許使用者編輯**WebPart**控制件的功能。 與更改**WebPart**控件的位置一樣,編輯控制件的屬性依賴於 ASP.NET 個人化來保存使用者所做的更改。

在本演練的這一部分中,您可以添加使用者編輯頁面上任何**WebPart**控件的基本特徵的能力。 要啟用這些功能,向頁面添加另一個自定義使用者控制件以及 asp:editorzone&lt;&gt;元素和兩個編輯控制件。

### <a name="to-create-a-user-control-that-enables-changing-page-layout"></a>建立變更頁面佈局的使用者控制項

1. 在可視化工作室中,在「**檔案**」功能表中,選擇 **「新建**子功能表」,然後按下「**檔**」選項。
2. 在「**新增新項目」** 對話框中,選擇**Web 使用者控制件**。 命名新檔案 DisplayModeMenu.ascx。 取消選擇要**將原始碼放在單獨的檔中**的選項。
3. 按下「添加」以創建新控制件。
4. 切換到**源**視圖。
5. 刪除新檔中的所有現有代碼,並貼上到以下代碼中。 此使用者控制程式碼使用 Web 部件控制元件集的功能,使頁面能夠更改其檢視或顯示模式,還使您能夠在某些顯示模式下更改頁面的實體外觀和佈局。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample24.aspx)]
6. 以按一下工具列上的「儲存」 圖示或選擇 **「 在檔案**」 選單上**儲存**檔案來儲存檔。

### <a name="to-enable-users-to-change-the-layout"></a>允許使用者變更佈局

1. 打開 WebPartsDemo.aspx 頁面,然後切換到 **「設計」** 檢視。
2. 在之前添加的**WebPartManager**控制件之後,將插入點放置在 **「設計」** 視圖中。 在文字後添加硬返回,以便在**WebPartManager**控件之後有一個空白行。 將插入點放在空白行上。
3. 將您剛剛創建的使用者控制項(該檔名為 DisplayModeMenu.ascx)拖到 WebPartsDemo.aspx 頁面,並將其拖放到空白列上。
4. 將編輯器區域控制件從工具箱的**Web 部件**部分拖曳到 WebPartsDemo.aspx 頁中的剩餘打開的表單元格。
5. 從工具箱的**Web 部件**部分,將外觀編輯器部分控制件和佈局編輯器部分控制項拖動到**編輯器區域**控制項中。
6. 切換到**源**視圖。 表單元格中生成的代碼應類似於以下代碼。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample25.aspx)]
7. 保存 WebPartsDemo.aspx 檔。 您已建立一個允許使用者更改顯示模式和更改頁面佈局的使用者控制項,並且已引用主 Web 頁上的控制項。

您現在可以測試編輯頁面和更改佈局的功能。

### <a name="to-test-layout-changes"></a>測試配置變更

1. 在瀏覽器中載入頁面。
2. 按下 **「顯示模式**」下拉選單,然後選擇 **「編輯**」。 將顯示區域標題。
3. 按標題列將 **「我的連結」** 控制項從邊欄區域拖動到主區域的底部。 您的頁面應類似於以下螢幕截圖。

### <a name="web-parts-demo-page-with-my-links-control-moved"></a>移動「我的連結」控制件的 Web 部件展示頁面

![Web 元件 VS 演練 2 螢幕擷取](profiles-themes-and-web-parts/_static/image4.gif)

**圖 4**: Web 元件 VS 演練 2 螢幕擷取

1. 按下 **「顯示模式**」下拉選單,然後選擇 **「瀏覽**」。 頁面將刷新,區域名稱消失,「**我的連結」** 控制項將保留您定位的位置。
2. 要證明個人化功能是否正常工作,關閉瀏覽器,然後再次載入頁面。 您所做的更改將儲存為將來的瀏覽器作業階段。
3. 在 **「顯示模式」** 選單中,選擇 **「編輯**」 。   
  
   頁面上的每個控件現在在其標題列中顯示一個向下箭頭,其中包含謂詞下拉菜單。
4. 按下箭號以在「**我的連結」** 控制項上顯示謂詞選單。 按下 **「編輯」** 謂詞。   
  
   將顯示 **「編輯器區域**」控制件,顯示您添加的編輯器部分控制項。
5. 在編輯控制項的 **「外觀」** 部份中,將 **「標題**更改為「我的我的最愛」,使用 **「Chrome 類型**」下拉清單選擇 **「僅限標題**」,然後按一下「**應用**」 。 以下螢幕截圖顯示頁面處於編輯模式。

### <a name="web-parts-demo-page-in-edit-mode"></a>編輯模式的網頁 元件展示頁面

![Web 元件 VS 演練 3 螢幕截圖](profiles-themes-and-web-parts/_static/image5.gif)

**圖 5**: Web 元件 VS 演練 3 螢幕擷取

1. 按下 **「顯示模式」** 選單,然後選擇 **「瀏覽」** 以返回到瀏覽模式。
2. 控件現在具有更新的標題和沒有邊框,如下螢幕拍攝所示。

### <a name="edited-web-parts-demo-page"></a>編輯的 Web 組件展示頁面

![Web 元件 VS 演練 4 螢幕擷取](profiles-themes-and-web-parts/_static/image6.gif)

**圖 4**: Web 元件 VS 演練 4 螢幕擷取

### <a name="adding-web-parts-at-run-time"></a>在執行時新增 Web 元件

您還可以允許使用者在執行時將 Web 部件控制項添加到其頁面。 為此,請使用 Web 部件目錄配置頁面,該目錄包含要提供給使用者的 Web 部件控制項的清單。

**允許使用者在執行時新增 Web 元件**

1. 打開 WebPartsDemo.aspx 頁面,然後切換到 **「設計」** 檢視。
2. 從工具箱的**Web 部件**選項卡中,將目錄區域控制元件拖曳到「**編輯器區域」** 控制元件下方的表右列中。   
  
   兩個控件可以位於同一表單元格中,因為它們不會同時顯示。
3. 在「屬性」窗格中,將字串 **「添加 Web 部件」** 分配給**目錄區域**控制項的「標題文字」 屬性。
4. 從工具箱的**Web 部件**部分,將聲明目錄部分控制項拖動到**目錄區域**控制件的內容區域中。
5. 按下 **「聲明目錄」** 控制器右上角的箭頭以公開其任務選單,然後選擇 **「編輯範本**」。
6. 從工具箱**的標準**部分,將**檔上傳**控制件和**行事曆**控制元件拖動到**聲明目錄部分**的**WebPartsTemplate**部分。
7. 切換到**源**視圖。 檢查&lt;asp:catalog&gt;區域 元素的原始碼。 請注意,**聲明目錄部分**控制檔包含一個 Webpartstemplate&lt;&gt;元素,其中包含兩個隨附的伺服器控制項,您將能夠從目錄中添加到頁面。
8. 使用下面代碼範例中為每個標題顯示的字串值,將**Title**屬性添加到添加到目錄中的每個控制項。 即使標題不是您通常在設計時可以在這兩個伺服器控制項上設置的屬性,但當使用者在運行時將這些控制項從目錄添加到**WebPartZone**區域時,它們都用**泛型 WebPart**控件進行包裝。 這使他們能夠充當 Web 部件控制,因此它們將能夠顯示標題。   
  
   **聲明目錄Part**控件中包含的兩個控件的代碼應如下所示。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample26.aspx)]
9. 儲存網頁。

您現在可以測試目錄。

### <a name="to-test-the-web-parts-catalog"></a>測試 Web 組件目錄

1. 在瀏覽器中載入頁面。
2. 按下 **「顯示模式**」下拉選單,然後選擇 **「目錄**」。   
  
   將顯示標題為 **「添加 Web 部件」的**目錄。
3. 將 **"我的我的最愛"** 控制項從主區域拖回邊欄區域的頂部,然後將其拖放到該區域的頂部。
4. 在 **"添加 Web 部件**"目錄中,選擇兩個複選框,然後從包含可用區域的下拉列表中選擇 **"主"。**
5. 按下「在目錄中**添加**」。 控制項將加入主區域。 如果需要,可以將多個控制項實例從目錄添加到頁面。   
  
   以下螢幕截圖顯示包含檔上載控制件的頁面和主區域中的日曆。 

![從目錄加入主區的控制項](profiles-themes-and-web-parts/_static/image7.gif)

    **Figure 5**: Controls added to Main zone from the catalog
6. 按下 **「顯示模式**」下拉選單,然後選擇 **「瀏覽**」。 目錄將消失,頁面將刷新。
7. 關閉瀏覽器。 再次載入頁面。 您所做的更改將保持不變。
