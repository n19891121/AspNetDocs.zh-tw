---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: 自訂多個環境的資料庫部署 |Microsoft Docs
author: jrjlee
description: 本主題描述如何在部署過程中，將資料庫的屬性量身打造為特定的目標環境。 注意：本主題假設 。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 8ae8cb1a322afb95c5d2e8d5e73c7825c7b2fe5a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78604024"
---
# <a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="35e2d-104">自訂多個環境的資料庫部署</span><span class="sxs-lookup"><span data-stu-id="35e2d-104">Customizing Database Deployments for Multiple Environments</span></span>

<span data-ttu-id="35e2d-105">[Jason 先生](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="35e2d-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="35e2d-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="35e2d-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="35e2d-107">本主題描述如何在部署過程中，將資料庫的屬性量身打造為特定的目標環境。</span><span class="sxs-lookup"><span data-stu-id="35e2d-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="35e2d-108">本主題假設您正在使用 Msbuild.exe 和 VSDBCMD 部署 Visual Studio 2010 資料庫專案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="35e2d-109">如需如何選擇這種方法的詳細資訊，請參閱[企業中的 Web 部署](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)和[部署資料庫專案](../web-deployment-in-the-enterprise/deploying-database-projects.md)。</span><span class="sxs-lookup"><span data-stu-id="35e2d-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="35e2d-110">當您將資料庫專案部署至多個目的地時，您通常會想要自訂每個目標環境的資料庫部署屬性。</span><span class="sxs-lookup"><span data-stu-id="35e2d-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="35e2d-111">例如，在測試環境中，您通常會在每個部署上重新建立資料庫，而在預備或生產環境中，您很可能會進行累加式更新以保留您的資料。</span><span class="sxs-lookup"><span data-stu-id="35e2d-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="35e2d-112">在 Visual Studio 2010 資料庫專案中，部署設定會包含在部署設定（. sqldeployment）檔案中。</span><span class="sxs-lookup"><span data-stu-id="35e2d-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="35e2d-113">本主題將說明如何建立環境專屬的部署設定檔，並指定您想要做為 VSDBCMD 參數使用的檔案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>

<span data-ttu-id="35e2d-114">本主題會根據名為 Fabrikam，Inc. 之虛構公司的企業部署需求，形成一系列教學課程的一部分。本教學課程系列使用&#x2014; [Contact Manager 解決方案](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;的範例解決方案，來代表具有實際複雜度層級的 web 應用程式，包括 ASP.NET MVC 3 應用程式、Windows Communication Foundation （WCF）服務和資料庫專案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="35e2d-115">這些教學課程中的部署方法是以[瞭解專案](../web-deployment-in-the-enterprise/understanding-the-project-file.md)檔中所述的分割專案檔案方法為基礎，其中的組建程式是由兩個專案&#x2014;檔所控制，其中包含適用于每個目的地環境的組建指示，另一個包含環境特定的組建和部署設定。</span><span class="sxs-lookup"><span data-stu-id="35e2d-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="35e2d-116">在組建期間，環境特定的專案檔會合並到環境無關的專案檔中，以形成一組完整的組建指示。</span><span class="sxs-lookup"><span data-stu-id="35e2d-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="35e2d-117">工作總覽</span><span class="sxs-lookup"><span data-stu-id="35e2d-117">Task Overview</span></span>

<span data-ttu-id="35e2d-118">本主題假設：</span><span class="sxs-lookup"><span data-stu-id="35e2d-118">This topic assumes that:</span></span>

- <span data-ttu-id="35e2d-119">如[瞭解專案](../web-deployment-in-the-enterprise/understanding-the-project-file.md)檔中所述，您可以使用分割專案檔案方法來部署解決方案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="35e2d-120">您可以從專案檔呼叫 VSDBCMD 來部署資料庫專案，如[瞭解組建](../web-deployment-in-the-enterprise/understanding-the-build-process.md)程式中所述。</span><span class="sxs-lookup"><span data-stu-id="35e2d-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="35e2d-121">若要建立支援在目標環境之間改變資料庫部署屬性的部署系統，您必須：</span><span class="sxs-lookup"><span data-stu-id="35e2d-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="35e2d-122">為每個目標環境建立部署設定（. sqldeployment）檔案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="35e2d-123">建立 VSDBCMD 命令，將部署設定檔指定為命令列參數。</span><span class="sxs-lookup"><span data-stu-id="35e2d-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="35e2d-124">參數化 Microsoft Build Engine （MSBuild）專案檔中的 VSDBCMD 命令，讓 VSDBCMD 選項適用于目標環境。</span><span class="sxs-lookup"><span data-stu-id="35e2d-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="35e2d-125">本主題將說明如何執行上述每個程式。</span><span class="sxs-lookup"><span data-stu-id="35e2d-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="35e2d-126">建立環境特定的部署設定檔</span><span class="sxs-lookup"><span data-stu-id="35e2d-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="35e2d-127">根據預設，資料庫專案會包含名為*sqldeployment*的單一部署設定檔。</span><span class="sxs-lookup"><span data-stu-id="35e2d-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="35e2d-128">如果您在 Visual Studio 2010 中開啟此檔案，您會看到可供您使用的不同部署選項：</span><span class="sxs-lookup"><span data-stu-id="35e2d-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="35e2d-129">**部署比較定序**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="35e2d-130">這可讓您選擇是否要使用專案的資料庫定序（*來源*定序）或目的地伺服器的資料庫定序（*目標*定序）。</span><span class="sxs-lookup"><span data-stu-id="35e2d-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="35e2d-131">在大部分情況下，當您部署到開發或測試環境時，您會想要使用來源定序。</span><span class="sxs-lookup"><span data-stu-id="35e2d-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="35e2d-132">當您部署至預備或生產環境時，您通常會想要將目標定序保持不變，以避免發生任何互通性問題。</span><span class="sxs-lookup"><span data-stu-id="35e2d-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="35e2d-133">**部署資料庫屬性**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-133">**Deploy database properties**.</span></span> <span data-ttu-id="35e2d-134">這可讓您選擇是否要套用資料庫屬性，如*sqlsettings*檔案中所定義。</span><span class="sxs-lookup"><span data-stu-id="35e2d-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="35e2d-135">當您第一次部署資料庫時，您應該部署資料庫屬性。</span><span class="sxs-lookup"><span data-stu-id="35e2d-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="35e2d-136">如果您要更新現有的資料庫，屬性應該已準備就緒，您應該不需要再次部署它們。</span><span class="sxs-lookup"><span data-stu-id="35e2d-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="35e2d-137">**一律重新建立資料庫**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-137">**Always re-create database**.</span></span> <span data-ttu-id="35e2d-138">這可讓您選擇是否要在每次部署時重新建立目標資料庫，或進行累加式變更，使目標資料庫與您的架構保持在最新狀態。</span><span class="sxs-lookup"><span data-stu-id="35e2d-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="35e2d-139">如果您重新建立資料庫，將會遺失現有資料庫中的任何資料。</span><span class="sxs-lookup"><span data-stu-id="35e2d-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="35e2d-140">因此，您通常應該將此設定為**false** ，以部署至預備或生產環境。</span><span class="sxs-lookup"><span data-stu-id="35e2d-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="35e2d-141">**如果可能發生資料遺失，則封鎖累加式部署**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="35e2d-142">這可讓您選擇如果資料庫架構的變更會造成資料遺失，是否應該停止部署。</span><span class="sxs-lookup"><span data-stu-id="35e2d-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="35e2d-143">您通常會將此**值**設定為 true，以部署到生產環境，讓您有機會介入和保護任何重要資料。</span><span class="sxs-lookup"><span data-stu-id="35e2d-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="35e2d-144">如果您已將 [**永遠重新建立資料庫**] 設定為 [ **false**]，則此設定不會有任何作用。</span><span class="sxs-lookup"><span data-stu-id="35e2d-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="35e2d-145">**以單一使用者模式執行部署**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="35e2d-146">在開發或測試環境中，這通常不是問題。</span><span class="sxs-lookup"><span data-stu-id="35e2d-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="35e2d-147">不過，您通常應該將此設定為**true** ，以部署至預備或生產環境。</span><span class="sxs-lookup"><span data-stu-id="35e2d-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="35e2d-148">這可防止使用者在部署進行時對資料庫進行變更。</span><span class="sxs-lookup"><span data-stu-id="35e2d-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="35e2d-149">**部署前備份資料庫**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-149">**Back up database before deployment**.</span></span> <span data-ttu-id="35e2d-150">當您部署到生產環境時，通常會將此設定為**true** ，以預防資料遺失。</span><span class="sxs-lookup"><span data-stu-id="35e2d-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="35e2d-151">當您部署至預備環境時，如果您的臨時資料庫包含大量資料，您可能也會想要將它設定為**true** 。</span><span class="sxs-lookup"><span data-stu-id="35e2d-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="35e2d-152">**針對目標資料庫中但不在資料庫專案中的物件產生 DROP 語句**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="35e2d-153">在大部分情況下，這是對資料庫進行累加式變更時不可或缺的一部分。</span><span class="sxs-lookup"><span data-stu-id="35e2d-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="35e2d-154">如果您已將 [**永遠重新建立資料庫**] 設定為 [ **false**]，則此設定不會有任何作用。</span><span class="sxs-lookup"><span data-stu-id="35e2d-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="35e2d-155">**請勿使用 ALTER ASSEMBLY 語句來更新 CLR 類型**。</span><span class="sxs-lookup"><span data-stu-id="35e2d-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="35e2d-156">此設定會決定 SQL Server 如何將 common language runtime （CLR）類型更新為較新的元件版本。</span><span class="sxs-lookup"><span data-stu-id="35e2d-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="35e2d-157">在大部分的情況下，這應該設定為**false** 。</span><span class="sxs-lookup"><span data-stu-id="35e2d-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="35e2d-158">下表顯示不同目的地環境的一般部署設定。</span><span class="sxs-lookup"><span data-stu-id="35e2d-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="35e2d-159">不過，視您的確切需求而定，您的設定可能會有所不同。</span><span class="sxs-lookup"><span data-stu-id="35e2d-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="35e2d-160">開發人員/測試</span><span class="sxs-lookup"><span data-stu-id="35e2d-160">Developer/Test</span></span> | <span data-ttu-id="35e2d-161">預備/整合</span><span class="sxs-lookup"><span data-stu-id="35e2d-161">Staging/Integration</span></span> | <span data-ttu-id="35e2d-162">生產環境</span><span class="sxs-lookup"><span data-stu-id="35e2d-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="35e2d-163">**部署比較定序**</span><span class="sxs-lookup"><span data-stu-id="35e2d-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="35e2d-164">原始程式檔</span><span class="sxs-lookup"><span data-stu-id="35e2d-164">Source</span></span> | <span data-ttu-id="35e2d-165">Target</span><span class="sxs-lookup"><span data-stu-id="35e2d-165">Target</span></span> | <span data-ttu-id="35e2d-166">Target</span><span class="sxs-lookup"><span data-stu-id="35e2d-166">Target</span></span> |
| <span data-ttu-id="35e2d-167">**部署資料庫屬性**</span><span class="sxs-lookup"><span data-stu-id="35e2d-167">**Deploy database properties**</span></span> | <span data-ttu-id="35e2d-168">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-168">True</span></span> | <span data-ttu-id="35e2d-169">第一次只有</span><span class="sxs-lookup"><span data-stu-id="35e2d-169">First time only</span></span> | <span data-ttu-id="35e2d-170">第一次只有</span><span class="sxs-lookup"><span data-stu-id="35e2d-170">First time only</span></span> |
| <span data-ttu-id="35e2d-171">**一律重新建立資料庫**</span><span class="sxs-lookup"><span data-stu-id="35e2d-171">**Always re-create database**</span></span> | <span data-ttu-id="35e2d-172">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-172">True</span></span> | <span data-ttu-id="35e2d-173">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-173">False</span></span> | <span data-ttu-id="35e2d-174">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-174">False</span></span> |
| <span data-ttu-id="35e2d-175">**如果可能發生資料遺失，則封鎖增量部署**</span><span class="sxs-lookup"><span data-stu-id="35e2d-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="35e2d-176">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-176">False</span></span> | <span data-ttu-id="35e2d-177">可能</span><span class="sxs-lookup"><span data-stu-id="35e2d-177">Maybe</span></span> | <span data-ttu-id="35e2d-178">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-178">True</span></span> |
| <span data-ttu-id="35e2d-179">**以單一使用者模式執行部署腳本**</span><span class="sxs-lookup"><span data-stu-id="35e2d-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="35e2d-180">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-180">False</span></span> | <span data-ttu-id="35e2d-181">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-181">True</span></span> | <span data-ttu-id="35e2d-182">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-182">True</span></span> |
| <span data-ttu-id="35e2d-183">**部署前備份資料庫**</span><span class="sxs-lookup"><span data-stu-id="35e2d-183">**Back up database before deployment**</span></span> | <span data-ttu-id="35e2d-184">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-184">False</span></span> | <span data-ttu-id="35e2d-185">可能</span><span class="sxs-lookup"><span data-stu-id="35e2d-185">Maybe</span></span> | <span data-ttu-id="35e2d-186">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-186">True</span></span> |
| <span data-ttu-id="35e2d-187">**針對目標資料庫中但不在資料庫專案中的物件產生 DROP 語句**</span><span class="sxs-lookup"><span data-stu-id="35e2d-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="35e2d-188">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-188">False</span></span> | <span data-ttu-id="35e2d-189">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-189">True</span></span> | <span data-ttu-id="35e2d-190">True</span><span class="sxs-lookup"><span data-stu-id="35e2d-190">True</span></span> |
| <span data-ttu-id="35e2d-191">**請勿使用 ALTER ASSEMBLY 語句來更新 CLR 類型**</span><span class="sxs-lookup"><span data-stu-id="35e2d-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="35e2d-192">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-192">False</span></span> | <span data-ttu-id="35e2d-193">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-193">False</span></span> | <span data-ttu-id="35e2d-194">False</span><span class="sxs-lookup"><span data-stu-id="35e2d-194">False</span></span> |

> [!NOTE]
> <span data-ttu-id="35e2d-195">如需有關資料庫部署屬性和環境考慮的詳細資訊，請參閱[資料庫專案設定總覽](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)、[如何：設定部署詳細資料的屬性](https://msdn.microsoft.com/library/dd172125.aspx)、[建立資料庫並部署至隔離開發環境](https://msdn.microsoft.com/library/dd193409.aspx)，以及[建立資料庫並將其部署至預備或生產環境](https://msdn.microsoft.com/library/dd193413.aspx)。</span><span class="sxs-lookup"><span data-stu-id="35e2d-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/library/dd193413.aspx).</span></span>

<span data-ttu-id="35e2d-196">若要支援將資料庫專案部署至多個目的地，您應該為每個目標環境建立部署設定檔。</span><span class="sxs-lookup"><span data-stu-id="35e2d-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="35e2d-197">**建立環境特定的設定檔**</span><span class="sxs-lookup"><span data-stu-id="35e2d-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="35e2d-198">在 Visual Studio 2010 的 [**方案總管**] 視窗中，以滑鼠右鍵按一下您的資料庫專案，然後按一下 [**屬性**]。</span><span class="sxs-lookup"><span data-stu-id="35e2d-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="35e2d-199">在 [資料庫專案屬性] 頁面的 [**部署**] 索引標籤上，按一下 [**部署設定檔**] 資料列中的 [**新增**]。</span><span class="sxs-lookup"><span data-stu-id="35e2d-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="35e2d-200">在 [**新增部署設定檔**] 對話方塊中，為檔案提供有意義的名稱（例如， **TestEnvironment. sqldeployment**），然後按一下 [**儲存**]。</span><span class="sxs-lookup"><span data-stu-id="35e2d-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="35e2d-201">在 *[Filename] \* \* \* sqldeployment*\* 頁面上，設定部署內容以符合目的地環境的需求，然後儲存檔案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-201">On the *[Filename]\*\*\*.sqldeployment*\* page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="35e2d-202">請注意，新的檔案會加入至您資料庫專案的 [屬性] 資料夾中。</span><span class="sxs-lookup"><span data-stu-id="35e2d-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="35e2d-203">在 VSDBCMD 中指定部署設定檔</span><span class="sxs-lookup"><span data-stu-id="35e2d-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="35e2d-204">當您使用 Visual Studio 2010 內的解決方案設定（例如 Debug 和 Release）時，您可以將部署設定檔與每個設定產生關聯。</span><span class="sxs-lookup"><span data-stu-id="35e2d-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="35e2d-205">當您建立特定設定時，組建程式會產生特定設定的部署資訊清單檔案，該檔案會指向設定特定的部署設定檔。</span><span class="sxs-lookup"><span data-stu-id="35e2d-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="35e2d-206">不過，這些教學課程中所述部署方法的其中一個主要目標是讓使用者能夠控制部署流程，而不需要使用 Visual Studio 2010 和解決方案設定。</span><span class="sxs-lookup"><span data-stu-id="35e2d-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="35e2d-207">在此方法中，不論目標部署環境為何，解決方案設定都相同。</span><span class="sxs-lookup"><span data-stu-id="35e2d-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="35e2d-208">若要將您的資料庫部署量身打造到特定的目的地環境，您可以使用 VSDBCMD 命令列選項來指定您的部署設定檔。</span><span class="sxs-lookup"><span data-stu-id="35e2d-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="35e2d-209">若要在 VSDBCMD 中指定部署設定檔，請使用**p：/DeploymentConfigurationFile**參數，並提供檔案的完整路徑。</span><span class="sxs-lookup"><span data-stu-id="35e2d-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="35e2d-210">這會覆寫部署資訊清單所識別的部署設定檔。</span><span class="sxs-lookup"><span data-stu-id="35e2d-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="35e2d-211">例如，您可以使用這個 VSDBCMD 命令，將**ContactManager**資料庫部署到測試環境：</span><span class="sxs-lookup"><span data-stu-id="35e2d-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>

[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]

> [!NOTE]
> <span data-ttu-id="35e2d-212">請注意，建立程式會在將檔案複製到輸出目錄時，重新命名您的 sqldeployment 檔案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>

<span data-ttu-id="35e2d-213">如果您在預先部署或部署後的 SQL 腳本中使用 SQL 命令變數，您可以使用類似的方法，將環境特定的 sqlcmdvars 檔案與您的部署產生關聯。</span><span class="sxs-lookup"><span data-stu-id="35e2d-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="35e2d-214">在此情況下，您會使用**p：/SqlCommandVariablesFile**參數來識別您的 sqlcmdvars 檔案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="35e2d-215">從 MSBuild 專案檔執行 VSDBCMD 命令</span><span class="sxs-lookup"><span data-stu-id="35e2d-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="35e2d-216">您可以使用 MSBuild 目標中的**Exec**工作，從 msbuild 專案檔叫用 VSDBCMD 命令。</span><span class="sxs-lookup"><span data-stu-id="35e2d-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="35e2d-217">最簡單的形式如下所示：</span><span class="sxs-lookup"><span data-stu-id="35e2d-217">In its simplest form, it would look like this:</span></span>

[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]

- <span data-ttu-id="35e2d-218">實際上，若要讓您的專案檔易於閱讀和重複使用，您會想要建立屬性來儲存各種命令列參數。</span><span class="sxs-lookup"><span data-stu-id="35e2d-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="35e2d-219">這可讓使用者更輕鬆地在環境特定的專案檔中提供屬性值，或從 MSBuild 命令列覆寫預設值。</span><span class="sxs-lookup"><span data-stu-id="35e2d-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="35e2d-220">如果您使用[瞭解專案](../web-deployment-in-the-enterprise/understanding-the-project-file.md)檔中所述的分割專案檔方法，您應該據以將組建指示和屬性分成兩個檔案：</span><span class="sxs-lookup"><span data-stu-id="35e2d-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="35e2d-221">環境特定的設定（例如部署設定檔案名、資料庫連接字串和目標資料庫名稱）應該會在環境特定的專案檔中。</span><span class="sxs-lookup"><span data-stu-id="35e2d-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="35e2d-222">執行 VSDBCMD 命令的 MSBuild 目標，以及任何通用屬性（例如 VSDBCMD 可執行檔的位置），都應該放在通用專案檔中。</span><span class="sxs-lookup"><span data-stu-id="35e2d-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="35e2d-223">您也應該先確定您已建立資料庫專案，再叫用 VSDBCMD，以便建立 deploymanifest 檔案並備妥可供使用。</span><span class="sxs-lookup"><span data-stu-id="35e2d-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="35e2d-224">您可以在[瞭解組建](../web-deployment-in-the-enterprise/understanding-the-build-process.md)程式主題中看到這種方法的完整範例，該程式會逐步引導您完成[Contact Manager 範例解決方案](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)中的專案檔案。</span><span class="sxs-lookup"><span data-stu-id="35e2d-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="35e2d-225">結論</span><span class="sxs-lookup"><span data-stu-id="35e2d-225">Conclusion</span></span>

<span data-ttu-id="35e2d-226">本主題說明當您使用 MSBuild 和 VSDBCMD 部署資料庫專案時，如何將資料庫屬性量身打造至不同的目的地環境。</span><span class="sxs-lookup"><span data-stu-id="35e2d-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="35e2d-227">當您需要將資料庫專案部署為較大型企業級解決方案的一部分時，這個方法很有用。</span><span class="sxs-lookup"><span data-stu-id="35e2d-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="35e2d-228">這些解決方案通常會部署到多個目的地，例如沙箱開發或測試環境、預備或整合平臺，以及生產或即時環境。</span><span class="sxs-lookup"><span data-stu-id="35e2d-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="35e2d-229">這些目標環境中的每個通常都需要一組唯一的資料庫部署屬性。</span><span class="sxs-lookup"><span data-stu-id="35e2d-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="35e2d-230">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="35e2d-230">Further Reading</span></span>

<span data-ttu-id="35e2d-231">如需使用 VSDBCMD 部署資料庫專案的詳細資訊，請參閱[部署資料庫專案](../web-deployment-in-the-enterprise/deploying-database-projects.md)。</span><span class="sxs-lookup"><span data-stu-id="35e2d-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="35e2d-232">如需使用自訂 MSBuild 專案檔控制部署程式的詳細資訊，請參閱[瞭解專案](../web-deployment-in-the-enterprise/understanding-the-project-file.md)檔和[瞭解組建](../web-deployment-in-the-enterprise/understanding-the-build-process.md)程式。</span><span class="sxs-lookup"><span data-stu-id="35e2d-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="35e2d-233">MSDN 上的這些文章提供有關資料庫部署的一般指引：</span><span class="sxs-lookup"><span data-stu-id="35e2d-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="35e2d-234">[資料庫專案設定總覽](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="35e2d-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="35e2d-235">如何：設定部署詳細資料的屬性</span><span class="sxs-lookup"><span data-stu-id="35e2d-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/library/dd172125.aspx)
- [<span data-ttu-id="35e2d-236">建立資料庫並將其部署至隔離開發環境</span><span class="sxs-lookup"><span data-stu-id="35e2d-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/library/dd193409.aspx)
- [<span data-ttu-id="35e2d-237">建立資料庫並將其部署至預備或生產環境</span><span class="sxs-lookup"><span data-stu-id="35e2d-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="35e2d-238">[上一頁](performing-a-what-if-deployment.md)
> [下一頁](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="35e2d-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
