---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: 部署資料庫專案 |Microsoft Docs
author: jrjlee
description: 注意：在許多企業部署案例中，您都需要能夠將累加式更新發佈到已部署的資料庫。 替代方案是重新建立 。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: 221808758492aedb8e8329364e511df28fd11105
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78634264"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="3e0c8-104">部署資料庫專案</span><span class="sxs-lookup"><span data-stu-id="3e0c8-104">Deploying Database Projects</span></span>

<span data-ttu-id="3e0c8-105">[Jason 先生](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="3e0c8-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="3e0c8-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="3e0c8-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="3e0c8-107">在許多企業部署案例中，您都需要能夠將累加式更新發佈到已部署的資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="3e0c8-108">替代方案是在每個部署上重新建立資料庫，這表示您會遺失現有資料庫中的任何資料。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="3e0c8-109">當您使用 Visual Studio 2010 時，使用 VSDBCMD 是累加式資料庫發佈的建議方法。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="3e0c8-110">不過，下一版的 Visual Studio 和 Web 發行管線（WPP）將包含可直接支援累加式發行的工具。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>

<span data-ttu-id="3e0c8-111">如果您在 Visual Studio 2010 中開啟 Contact Manager 範例方案，您會看到資料庫專案包含包含四個檔案的 [Properties] 資料夾。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="3e0c8-112">與專案檔（在此案例中為*ContactManager* ），這些檔案會控制組建和部署程式的各個層面：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="3e0c8-113">*Sqlcmdvars*檔案會提供部署專案時使用之任何 SQLCMD 變數的值。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="3e0c8-114">每個解決方案設定（例如，debug 和 release）都可以指定不同的 sqlcmdvars 檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="3e0c8-115">*Sqldeployment*檔案提供部署專屬的設定，例如是否要使用專案中所定義的定序或目的地伺服器的定序、是否每次重新建立目的地資料庫，或只是修改現有的資料庫使其成為最新狀態等等。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="3e0c8-116">每個解決方案設定都可以指定不同的 sqldeployment 檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="3e0c8-117">*.Sqlpermissions*檔案是一個 XML 檔，您可以用它來定義您想要加入至目標資料庫的任何許可權。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="3e0c8-118">所有解決方案設定都會共用相同的 .sqlpermissions 檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="3e0c8-119">*Sqlsettings*檔案會指定要在建立資料庫時使用的資料庫層級屬性，例如要使用的定序、比較運算子的行為等等。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="3e0c8-120">所有解決方案設定都會共用相同的 sqlsettings 檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="3e0c8-121">值得一提的是，在 Visual Studio 中開啟這些檔案，並讓自己熟悉內容。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="3e0c8-122">當您建立資料庫專案時，組建進程會建立兩個檔案：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="3e0c8-123">*資料庫架構*（.dbschema 檔案）。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="3e0c8-124">這會描述您想要以 XML 格式建立之資料庫的架構。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="3e0c8-125">*部署資訊清單*（deploymanifest 檔案）。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="3e0c8-126">其中包含建立及部署資料庫所需的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="3e0c8-127">它會參考 .dbschema 檔案以及其他資源，例如部署指示（sqldeployment 檔案），以及任何預先部署或部署後的 SQL 腳本。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="3e0c8-128">這會顯示這些資源之間的關聯性：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="3e0c8-129">如您所見，sqlsettings 檔案和 .sqlpermissions 檔案是組建進程的輸入。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="3e0c8-130">除了資料庫專案檔，這些檔案也會用來建立資料庫架構檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="3e0c8-131">Sqldeployment 檔案和 sqlcmdvars 檔案會原封不動地通過組建進程。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="3e0c8-132">部署資訊清單會指出資料庫架構的位置、sqldeployment 檔案、sqlcmdvars 檔案，以及任何預先部署或部署後 SQL 腳本。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="3e0c8-133">為何要使用 VSDBCMD 來部署資料庫專案？</span><span class="sxs-lookup"><span data-stu-id="3e0c8-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="3e0c8-134">有各種不同的方法可以部署資料庫專案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="3e0c8-135">不過，並非全部都適用于在企業環境中將資料庫專案部署至遠端伺服器。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="3e0c8-136">從資料庫專案部署考慮您想要的結果。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="3e0c8-137">在企業部署案例中，您可能會想要：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="3e0c8-138">從遠端位置部署資料庫專案的能力。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="3e0c8-139">對現有資料庫進行累加式更新的功能。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="3e0c8-140">包含預先部署腳本或部署後腳本的功能。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="3e0c8-141">將部署量身打造到多個目的地環境的能力。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="3e0c8-142">能夠將資料庫專案部署為較大型、通常已編寫腳本的單一步驟解決方案部署的一部分。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="3e0c8-143">您可以使用三種主要方法來部署資料庫專案：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="3e0c8-144">您可以在 Visual Studio 2010 中，將部署功能與資料庫專案類型搭配使用。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="3e0c8-145">當您在 Visual Studio 2010 中建立及部署資料庫專案時，部署程式會使用部署資訊清單來產生組建設定特有的 SQL 部署檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="3e0c8-146">這會建立資料庫（如果尚未存在），或對資料庫進行任何必要的變更（如果已經存在）。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="3e0c8-147">您可以使用 SQLCMD 在目的地伺服器上執行這個檔案，也可以設定 Visual Studio 來建立和執行檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="3e0c8-148">這種方法的缺點是您只能控制部署設定的限制。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="3e0c8-149">您通常可能也需要修改 SQL 部署檔案，以提供環境特定變數值。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="3e0c8-150">您只能從已安裝 Visual Studio 2010 的電腦使用此方法，而開發人員必須知道並提供所有目的地環境的連接字串和認證。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="3e0c8-151">您可以使用 Internet Information Services （IIS） Web 部署工具（Web Deploy），將[資料庫部署為 Web 應用程式專案的一部分](https://msdn.microsoft.com/library/dd465343.aspx)。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="3e0c8-152">不過，如果您想要部署資料庫專案，而不只是在目的地伺服器上複寫現有的本機資料庫，這個方法就會變得更複雜。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="3e0c8-153">您可以設定 Web Deploy 來執行資料庫專案所產生的 SQL 部署腳本，但為了這麼做，您必須為 Web 應用程式專案建立自訂的 WPP 目標檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="3e0c8-154">這會在部署程式中增加相當大的複雜度。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="3e0c8-155">此外，Web Deploy 不會直接支援現有資料庫的累加式更新。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="3e0c8-156">如需這種方法的詳細資訊，請參閱將[Web 發佈管線擴充至封裝資料庫專案部署的 SQL](https://go.microsoft.com/?linkid=9805121)檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="3e0c8-157">您可以使用 VSDBCMD 公用程式來部署資料庫，方法是使用資料庫架構或部署資訊清單。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="3e0c8-158">您可以從 MSBuild 目標呼叫 VSDBCMD，這可讓您在較大的腳本式部署程式中發佈資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="3e0c8-159">您可以從 VSDBCMD 命令覆寫 sqlcmdvars 檔案和許多其他資料庫屬性中的變數，這可讓您針對不同的環境自訂部署，而不需要建立多個組建設定。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="3e0c8-160">VSDBCMD 提供差異化功能，這表示它只會進行必要的變更，使目的地資料庫與您的資料庫架構一致。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="3e0c8-161">VSDBCMD 也提供廣泛的命令列選項，可讓您更精細地控制部署流程。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="3e0c8-162">在此總覽中，您可以看到使用 VSDBCMD 搭配 MSBuild 是最適合一般企業部署案例的方法：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="3e0c8-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="3e0c8-163">Visual Studio 2010</span></span> | <span data-ttu-id="3e0c8-164">Web Deploy 2.0</span><span class="sxs-lookup"><span data-stu-id="3e0c8-164">Web Deploy 2.0</span></span> | <span data-ttu-id="3e0c8-165">VSDBCMD .exe</span><span class="sxs-lookup"><span data-stu-id="3e0c8-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="3e0c8-166">支援遠端部署？</span><span class="sxs-lookup"><span data-stu-id="3e0c8-166">Supports remote deployment?</span></span> | <span data-ttu-id="3e0c8-167">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-167">Yes</span></span> | <span data-ttu-id="3e0c8-168">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-168">Yes</span></span> | <span data-ttu-id="3e0c8-169">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-169">Yes</span></span> |
| <span data-ttu-id="3e0c8-170">支援累加式更新？</span><span class="sxs-lookup"><span data-stu-id="3e0c8-170">Supports incremental updates?</span></span> | <span data-ttu-id="3e0c8-171">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-171">Yes</span></span> | <span data-ttu-id="3e0c8-172">否</span><span class="sxs-lookup"><span data-stu-id="3e0c8-172">No</span></span> | <span data-ttu-id="3e0c8-173">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-173">Yes</span></span> |
| <span data-ttu-id="3e0c8-174">支援前置/部署後腳本？</span><span class="sxs-lookup"><span data-stu-id="3e0c8-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="3e0c8-175">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-175">Yes</span></span> | <span data-ttu-id="3e0c8-176">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-176">Yes</span></span> | <span data-ttu-id="3e0c8-177">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-177">Yes</span></span> |
| <span data-ttu-id="3e0c8-178">支援多環境部署嗎？</span><span class="sxs-lookup"><span data-stu-id="3e0c8-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="3e0c8-179">有限</span><span class="sxs-lookup"><span data-stu-id="3e0c8-179">Limited</span></span> | <span data-ttu-id="3e0c8-180">有限</span><span class="sxs-lookup"><span data-stu-id="3e0c8-180">Limited</span></span> | <span data-ttu-id="3e0c8-181">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-181">Yes</span></span> |
| <span data-ttu-id="3e0c8-182">支援腳本式部署？</span><span class="sxs-lookup"><span data-stu-id="3e0c8-182">Supports scripted deployment?</span></span> | <span data-ttu-id="3e0c8-183">有限</span><span class="sxs-lookup"><span data-stu-id="3e0c8-183">Limited</span></span> | <span data-ttu-id="3e0c8-184">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-184">Yes</span></span> | <span data-ttu-id="3e0c8-185">[是]</span><span class="sxs-lookup"><span data-stu-id="3e0c8-185">Yes</span></span> |

<span data-ttu-id="3e0c8-186">本主題的其餘部分將說明如何使用 VSDBCMD 搭配 MSBuild 來部署資料庫專案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="3e0c8-187">瞭解部署程式</span><span class="sxs-lookup"><span data-stu-id="3e0c8-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="3e0c8-188">VSDBCMD 公用程式可讓您使用資料庫架構（.dbschema 檔案）或部署資訊清單（deploymanifest 檔案）來部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="3e0c8-189">在實務上，您幾乎一律會使用部署資訊清單，因為部署資訊清單可讓您為各種部署屬性提供預設值，並識別您想要執行的任何預先部署或部署後 SQL 腳本。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="3e0c8-190">例如，此 VSDBCMD 命令是用來將**ContactManager**資料庫部署到測試環境中的資料庫伺服器：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>

[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]

<span data-ttu-id="3e0c8-191">在此情況下：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-191">In this case:</span></span>

- <span data-ttu-id="3e0c8-192">**/A** （或 **/Action**）參數會指定您想要 VSDBCMD 執行的動作。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="3e0c8-193">您可以將此設定為 [匯**入**] 或 [**部署**]。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="3e0c8-194">[匯**入**] 選項是用來從現有的資料庫產生 .dbschema 檔案，而 [**部署**] 選項是用來將 .dbschema 檔案部署到目標資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="3e0c8-195">**/Manifest** （或 **/ManifestFile**）交換器會識別您想要部署的 deploymanifest 檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="3e0c8-196">如果您想要改為使用 .dbschema 檔案，請使用 **/model** （或 **/ModelFile**）參數。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="3e0c8-197">**/Cs** （或 **/ConnectionString**）參數會提供目標資料庫伺服器的連接字串。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="3e0c8-198">請注意，這不會包含連接到伺服器&#x2014;以建立資料庫所需的資料庫 VSDBCMD 名稱。它不需要連接至個別的資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="3e0c8-199">如果您的 deploymanifest 檔案包含連接字串，您可以省略此參數。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="3e0c8-200">如果您仍然使用參數，參數值會覆寫 deploymanifest 值。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="3e0c8-201"><strong>/P： TargetDatabase</strong>屬性會提供您想要在建立時指派給目標資料庫的名稱。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="3e0c8-202">這會覆寫 deploymanifest 檔案中<strong>TargetDatabase</strong>屬性的值。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="3e0c8-203">您可以使用<strong>/p：</strong> <em>[property name]</em>語法來設定各種不同的部署屬性，並覆寫 sqlcmdvars 檔案中所宣告的任何 SQLCMD 變數。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="3e0c8-204">**/Dd +** （或 **/DeployToDatabase +** ）參數表示您想要建立部署，並將其部署至目標環境。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="3e0c8-205">如果您指定 **/dd-** ，或省略參數，VSDBCMD 會產生部署腳本，但不會將它部署至目標環境。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="3e0c8-206">此參數通常是混淆的來源，並會在下一節中更詳細地說明。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="3e0c8-207">**/Script** （或 **/DeploymentScriptFile**）參數會指定您要產生部署腳本的位置。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="3e0c8-208">這個值不會影響部署進程。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="3e0c8-209">如需 VSDBCMD 的詳細資訊，請參閱[VSDBCMD 的命令列參考。EXE （部署和架構匯入）](https://msdn.microsoft.com/library/dd193283.aspx)和[如何：使用 VSDBCMD 從命令提示字元準備要部署的資料庫。EXE](https://msdn.microsoft.com/library/dd193258.aspx)。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="3e0c8-210">如需如何從 MSBuild 專案檔使用 VSDBCMD 的範例，請參閱[瞭解組建處理](understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="3e0c8-211">如需如何為多個環境設定資料庫部署設定的範例，請參閱[自訂多個環境的資料庫](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)部署。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="3e0c8-212">瞭解 DeployToDatabase 交換器</span><span class="sxs-lookup"><span data-stu-id="3e0c8-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="3e0c8-213">**/Dd**或 **/DeployToDatabase**參數的行為取決於您是使用 VSDBCMD 搭配 .dbschema 檔案或 deploymanifest 檔案。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="3e0c8-214">如果您使用的是 .dbschema 檔案，其行為相當簡單：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="3e0c8-215">如果您指定 **/dd +** 或 **/dd**，VSDBCMD 會產生部署腳本並部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="3e0c8-216">如果您指定 **/dd-** 或省略參數，VSDBCMD 只會產生部署腳本。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="3e0c8-217">如果您使用的是 deploymanifest 檔案，則行為會變得複雜許多。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="3e0c8-218">這是因為 deploymanifest 檔案包含屬性名稱**DeployToDatabase** ，這也會決定是否已部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>

[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]

<span data-ttu-id="3e0c8-219">這個屬性的值是根據資料庫專案的屬性來設定。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="3e0c8-220">如果您將 [**部署] 動作**設定為 [**建立部署腳本（.sql）** ]，此值將會是**False**。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="3e0c8-221">如果您將 [**部署] 動作**設定為**建立部署腳本（.sql），並部署到資料庫**，則值將為**True**。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="3e0c8-222">這些設定會與特定的組建設定和平臺相關聯。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="3e0c8-223">例如，如果您設定了 [ **Debug** ] 設定，然後使用 [**發行**] 設定發佈，將不會使用您的設定。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>

![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="3e0c8-224">在此案例中，[**部署] 動作**應一律設定為 [**建立部署腳本（.sql）** ]，因為您不想要 Visual Studio 2010 來部署您的資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="3e0c8-225">換句話說， **DeployToDatabase**屬性應該一律為**False**。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>

<span data-ttu-id="3e0c8-226">當指定了**DeployToDatabase**屬性時，如果屬性值為**false**，則 **/dd**參數只會覆寫屬性：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="3e0c8-227">如果**DeployToDatabase**屬性為**False**，而且您指定了 **/dd +** 或 **/Dd**，則 VSDBCMD 會覆寫**DeployToDatabase**屬性並部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="3e0c8-228">如果**DeployToDatabase**屬性為**False**，而且您指定 **/DD-** 或省略參數，VSDBCMD 就不會部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="3e0c8-229">如果**DeployToDatabase**屬性為**True**，則 VSDBCMD 會忽略參數並部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="3e0c8-230">無論您是否也要部署資料庫，都是在每個案例中產生部署腳本。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="3e0c8-231">結論</span><span class="sxs-lookup"><span data-stu-id="3e0c8-231">Conclusion</span></span>

<span data-ttu-id="3e0c8-232">本主題提供 Visual Studio 2010 中資料庫專案的組建和部署程式總覽。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="3e0c8-233">同時也會說明如何使用 VSDBCMD 搭配 MSBuild 來支援企業級資料庫部署。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="3e0c8-234">如需如何在實務中運作的詳細資訊，請參閱[自訂多個環境的資料庫部署](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="3e0c8-235">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="3e0c8-235">Further Reading</span></span>

<span data-ttu-id="3e0c8-236">如需如何為每個環境建立個別的部署設定檔，以自訂資料庫部署的詳細資訊，請參閱[自訂多個環境的資料庫部署](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="3e0c8-237">如需有關如何藉由執行部署後腳本來設定資料庫角色成員資格的指引，請參閱將[資料庫角色成員資格部署到測試環境](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="3e0c8-238">如需管理成員資格資料庫所強加之一些獨特挑戰的指引，請參閱[將成員資格資料庫部署到企業環境](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="3e0c8-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="3e0c8-239">MSDN 上的這些主題會針對 Visual Studio 資料庫專案和資料庫部署程式，提供更廣泛的指引和背景資訊：</span><span class="sxs-lookup"><span data-stu-id="3e0c8-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="3e0c8-240">Visual Studio 2010 SQL Server 資料庫專案</span><span class="sxs-lookup"><span data-stu-id="3e0c8-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="3e0c8-241">管理資料庫變更</span><span class="sxs-lookup"><span data-stu-id="3e0c8-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="3e0c8-242">如何：使用 VSDBCMD 從命令提示字元準備要部署的資料庫。CONVERT.EXE</span><span class="sxs-lookup"><span data-stu-id="3e0c8-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="3e0c8-243">資料庫組建和部署總覽</span><span class="sxs-lookup"><span data-stu-id="3e0c8-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="3e0c8-244">[上一頁](deploying-web-packages.md)
> [下一頁](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="3e0c8-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
