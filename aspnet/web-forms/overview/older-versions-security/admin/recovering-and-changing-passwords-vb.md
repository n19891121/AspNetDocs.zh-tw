---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-vb
title: 復原及變更密碼（VB） |Microsoft Docs
author: rick-anderson
description: ASP.NET 包含兩個 Web 控制項，協助您復原和變更密碼。 PasswordRecovery 控制項可讓訪客復原遺失的 pa 。
ms.author: riande
ms.date: 04/01/2008
ms.assetid: f9adcb5d-6d70-4885-a3bf-ed95efb4da1a
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-vb
msc.type: authoredcontent
ms.openlocfilehash: 0ed1df9455af94a86ce59ecc06c55846a4880596
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74618888"
---
# <a name="recovering-and-changing-passwords-vb"></a><span data-ttu-id="c8c8b-104">復原及變更密碼 (VB)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-104">Recovering and Changing Passwords (VB)</span></span>

<span data-ttu-id="c8c8b-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c8c8b-106">[下載程式代碼](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.13.zip)或[下載 PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.13.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_vb.pdf)</span></span>

> <span data-ttu-id="c8c8b-107">ASP.NET 包含兩個 Web 控制項，協助您復原和變更密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="c8c8b-108">PasswordRecovery 控制項可讓訪客復原其遺失的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="c8c8b-109">ChangePassword 控制項可讓使用者更新其密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="c8c8b-110">就像我們在本教學課程系列中所見到的其他登入相關 Web 控制項一樣，PasswordRecovery 和 ChangePassword 控制項也會在幕後使用成員資格架構來重設或修改使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

## <a name="introduction"></a><span data-ttu-id="c8c8b-111">簡介</span><span class="sxs-lookup"><span data-stu-id="c8c8b-111">Introduction</span></span>

<span data-ttu-id="c8c8b-112">在我的銀行、公用程式公司、電話公司、電子郵件帳戶和個人化 web 入口網站之間，我與大多數人一樣，都有數十種不同的密碼需要記住。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="c8c8b-113">因為有這麼多的認證可以記住這些日子，所以人們不太常忘記自己的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="c8c8b-114">為因應此情況，提供使用者帳戶的網站必須包含一種方法，讓使用者能夠復原自己的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="c8c8b-115">此程式通常牽涉到產生新的隨機密碼，並以電子郵件傳送給使用者在檔案上的電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="c8c8b-116">接收到新密碼之後，大部分的使用者都會回到網站，並將其密碼從隨機產生的密碼變更為更容易記住的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="c8c8b-117">ASP.NET 包含兩個 Web 控制項，協助您復原和變更密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="c8c8b-118">PasswordRecovery 控制項可讓訪客復原其遺失的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="c8c8b-119">ChangePassword 控制項可讓使用者更新其密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="c8c8b-120">就像我們在本教學課程系列中所見到的其他登入相關 Web 控制項一樣，PasswordRecovery 和 ChangePassword 控制項也會在幕後使用成員資格架構來重設或修改使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="c8c8b-121">在本教學課程中，我們將使用這兩個控制項來進行檢查。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="c8c8b-122">我們也會瞭解如何透過 `MembershipUser` 類別的 `ChangePassword` 和 `ResetPassword` 方法，以程式設計方式變更和重設使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="c8c8b-123">步驟1：協助使用者復原遺失的密碼</span><span class="sxs-lookup"><span data-stu-id="c8c8b-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="c8c8b-124">所有支援使用者帳戶的網站都必須為使用者提供一些機制來復原其遺忘的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="c8c8b-125">好消息是，您可以輕鬆地在 ASP.NET 中執行這類功能，這是因為 PasswordRecovery 的 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="c8c8b-126">PasswordRecovery 控制項會轉譯介面，以提示使用者輸入其使用者名稱，並視需要回應其安全性問題的答案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="c8c8b-127">然後，它會以電子郵件傳送使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-128">由於電子郵件訊息是透過網路以純文字傳輸，因此在透過電子郵件傳送使用者的密碼時，會有安全性風險。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>

<span data-ttu-id="c8c8b-129">PasswordRecovery 控制項包含三個視圖：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="c8c8b-130">**Username** -提示訪客提供他們的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="c8c8b-131">這是初始的視圖。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-131">This is the initial view.</span></span>
- <span data-ttu-id="c8c8b-132">**問題**-將使用者的使用者名稱和安全性問題顯示為文字，並附上一個文字方塊，讓使用者輸入他的安全性問題答案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="c8c8b-133">**成功**-顯示訊息，通知使用者他的密碼已通過電子郵件傳送。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="c8c8b-134">顯示的視圖和 PasswordRecovery 控制項執行的動作，取決於下列成員資格設定：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="c8c8b-135">成員資格架構的 `RequiresQuestionAndAnswer` 設定會指出在註冊帳戶時，使用者是否必須指定安全性問題和答案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="c8c8b-136">如我們在<a id="_msoanchor_1"> </a>[*建立使用者帳戶*](../membership/creating-user-accounts-vb.md)教學課程中所討論，如果 `RequiresQuestionAndAnswer` 為 True （預設值），則 CreateUserWizard 的介面會包含新使用者安全性問題和答案的 TextBox 控制項。如果 `RequiresQuestionAndAnswer` 為 False，則不會收集這類資訊。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-vb.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="c8c8b-137">同樣地，如果 `RequiresQuestionAndAnswer` 為 True，則 PasswordRecovery 控制項會在使用者輸入其使用者名稱之後，顯示問題視圖;只有當使用者輸入正確的安全性答案時，才會復原密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="c8c8b-138">不過，如果 `RequiresQuestionAndAnswer` 為 False，則 PasswordRecovery 控制項會直接從 [使用者名稱] 視圖移至 [成功] 視圖。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="c8c8b-139">在使用者提供他的使用者名稱（或其使用者名稱和安全性答案）之後，如果 `RequiresQuestionAndAnswer` 為 True，PasswordRecovery 會以電子郵件傳送使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="c8c8b-140">如果 [`EnablePasswordRetrieval`] 選項設定為 [True]，則會以電子郵件將其目前的密碼傳送給使用者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="c8c8b-141">如果設定為 False，且 `EnablePasswordReset` 設定為 True，則 PasswordRecovery 控制項會為使用者產生新的隨機密碼，並以電子郵件將新密碼傳送給他們。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="c8c8b-142">如果 `EnablePasswordRetrieval` 和 `EnablePasswordReset` 都是 False，則 PasswordRecovery 控制項會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-143">回想一下，`SqlMembershipProvider` 會以下列三種格式的其中一種來儲存使用者的密碼：清除、雜湊（預設值）或加密。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="c8c8b-144">所使用的儲存機制視成員資格設定而定;示範應用程式會使用雜湊的密碼格式。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="c8c8b-145">使用雜湊的密碼格式時，`EnablePasswordRetrieval` 選項必須設定為 False，因為系統無法從資料庫中儲存的雜湊版本判斷使用者的實際密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>

<span data-ttu-id="c8c8b-146">[圖 1] 說明 PasswordRecovery 的介面和行為如何受到成員資格設定的影響。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>

<span data-ttu-id="c8c8b-147">[![RequiresQuestionAndAnswer、EnablePasswordRetrieval 和 EnablePasswordReset 會影響 PasswordRecovery 控制項的外觀和行為](recovering-and-changing-passwords-vb/_static/image2.png)](recovering-and-changing-passwords-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-vb/_static/image2.png)](recovering-and-changing-passwords-vb/_static/image1.png)</span></span>

<span data-ttu-id="c8c8b-148">**圖 1**： `RequiresQuestionAndAnswer`、`EnablePasswordRetrieval`和 `EnablePasswordReset` 會影響 PasswordRecovery 控制項的外觀和行為（[按一下以觀看完整大小的影像](recovering-and-changing-passwords-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image3.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-149"><a id="_msoanchor_2"></a>在[*SQL Server 中建立成員資格架構*](../membership/creating-the-membership-schema-in-sql-server-vb.md)教學課程中，我們會將 `RequiresQuestionAndAnswer` 設定為 true、`EnablePasswordRetrieval` 設為 False，並 `EnablePasswordReset` 為 true 來設定成員資格提供者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>

### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="c8c8b-150">使用 PasswordRecovery 控制項</span><span class="sxs-lookup"><span data-stu-id="c8c8b-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="c8c8b-151">讓我們看一下如何在 ASP.NET 網頁中使用 PasswordRecovery 控制項。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="c8c8b-152">開啟 `RecoverPassword.aspx`，並將 PasswordRecovery 控制項從 [工具箱] 拖放到設計工具上;將其 `ID` 設定為 `RecoverPwd`。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="c8c8b-153">如同 Login 和 CreateUserWizard Web 控制項，PasswordRecovery 控制項的 views 會轉譯豐富的複合介面，其中包含標籤、文字方塊、按鈕和驗證控制項。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="c8c8b-154">您可以透過控制項的樣式屬性自訂視圖的外觀，或將 views 轉換成範本。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="c8c8b-155">我將這個練習留給感興趣的讀者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="c8c8b-156">當使用者造訪此頁面時，她會輸入她的使用者名稱，然後按一下 [提交] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="c8c8b-157">因為我們已在成員資格設定設定中，將 `RequiresQuestionAndAnswer` 屬性設為 True，所以 PasswordRecovery 控制項會顯示問題視圖。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="c8c8b-158">在使用者輸入正確的安全性答案，並按一下 [提交] 之後，PasswordRecovery 控制項會將使用者的密碼更新為隨機產生的密碼，並以電子郵件將此密碼傳送至檔案上的電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="c8c8b-159">這一切都可以讓我們不必撰寫一行程式碼！</span><span class="sxs-lookup"><span data-stu-id="c8c8b-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="c8c8b-160">在測試此頁面之前，有一個設定的最後一個部分通常是：我們需要在 `Web.config`中指定郵件傳遞設定。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="c8c8b-161">PasswordRecovery 控制項會依賴這些設定來傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="c8c8b-162">郵件傳遞設定是透過[`<system.net>` 元素](https://msdn.microsoft.com/library/6484zdc1.aspx)的[`<mailSettings>` 元素](https://msdn.microsoft.com/library/w355a94k.aspx)所指定。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="c8c8b-163">使用[`<smtp>` 元素](https://msdn.microsoft.com/library/ms164240.aspx)來指出傳遞方法和預設的 [寄件者] 位址。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="c8c8b-164">下列標記會將郵件設置設定為使用通訊埠25上名為 `smtp.example.com` 的網路 SMTP 伺服器，並以使用者名稱和密碼的使用者名稱/密碼認證。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-165">`<system.net>` 是根 `<configuration>` 元素的子專案，以及 `<system.web>`的同級元素。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="c8c8b-166">因此，請勿將 `<system.net>` 元素放在 `<system.web>` 元素內;相反地，請將它放在相同的層級。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>

[!code-xml[Main](recovering-and-changing-passwords-vb/samples/sample1.xml)]

<span data-ttu-id="c8c8b-167">除了使用網路上的 SMTP 伺服器以外，您也可以指定要傳送電子郵件訊息的收取目錄。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="c8c8b-168">設定 SMTP 設定之後，請透過瀏覽器造訪 [`RecoverPassword.aspx`] 頁面。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="c8c8b-169">請先嘗試輸入不存在於使用者存放區中的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="c8c8b-170">如 [圖 2] 所示，PasswordRecovery 控制項會顯示一則訊息，指出無法存取使用者資訊。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="c8c8b-171">訊息的文字可以透過控制項的[`UserNameFailureText` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx)自訂。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>

<span data-ttu-id="c8c8b-172">[如果輸入的使用者名稱無效，就會顯示 ![錯誤訊息](recovering-and-changing-passwords-vb/_static/image5.png)](recovering-and-changing-passwords-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-vb/_static/image5.png)](recovering-and-changing-passwords-vb/_static/image4.png)</span></span>

<span data-ttu-id="c8c8b-173">**圖 2**：如果輸入的使用者名稱無效，就會顯示錯誤訊息（[按一下以查看完整大小的影像](recovering-and-changing-passwords-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image6.png))</span></span>

<span data-ttu-id="c8c8b-174">現在輸入使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-174">Now enter a username.</span></span> <span data-ttu-id="c8c8b-175">使用系統中帳戶的使用者名稱，以及您可以存取的電子郵件地址，以及您知道的安全性答案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="c8c8b-176">輸入使用者名稱並按一下 [提交] 之後，PasswordRecovery 控制項會顯示其問題視圖。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="c8c8b-177">如同 [使用者名稱] 視圖，如果您輸入不正確的答案，PasswordRecovery 控制項會顯示錯誤訊息（請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="c8c8b-178">使用 [ [`QuestionFailureText`] 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx)來自訂此錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>

<span data-ttu-id="c8c8b-179">[![如果使用者輸入不正確安全性答案，就會顯示錯誤訊息](recovering-and-changing-passwords-vb/_static/image8.png)](recovering-and-changing-passwords-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-vb/_static/image8.png)](recovering-and-changing-passwords-vb/_static/image7.png)</span></span>

<span data-ttu-id="c8c8b-180">**圖 3**：如果使用者輸入不正確安全性答案（[按一下以觀看完整大小的影像](recovering-and-changing-passwords-vb/_static/image9.png)），就會顯示錯誤訊息</span><span class="sxs-lookup"><span data-stu-id="c8c8b-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image9.png))</span></span>

<span data-ttu-id="c8c8b-181">最後，輸入正確的安全性答案，然後按一下 [提交]。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="c8c8b-182">PasswordRecovery 控制項會在幕後產生隨機密碼、將它指派給使用者帳戶、傳送電子郵件通知使用者新密碼（請參閱 [圖 4]），然後顯示成功的視圖。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>

<span data-ttu-id="c8c8b-183">[![使用者會收到電子郵件，附有他的新密碼](recovering-and-changing-passwords-vb/_static/image11.png)](recovering-and-changing-passwords-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-vb/_static/image11.png)](recovering-and-changing-passwords-vb/_static/image10.png)</span></span>

<span data-ttu-id="c8c8b-184">**圖 4**：使用新密碼傳送電子郵件給使用者（[按一下以觀看完整大小的影像](recovering-and-changing-passwords-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image12.png))</span></span>

### <a name="customizing-the-email"></a><span data-ttu-id="c8c8b-185">自訂電子郵件</span><span class="sxs-lookup"><span data-stu-id="c8c8b-185">Customizing the Email</span></span>

<span data-ttu-id="c8c8b-186">PasswordRecovery 控制項所傳送的預設電子郵件相當乏味（請參閱 [圖 4]）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="c8c8b-187">訊息是從 `<smtp>` 專案的 `from` 屬性中所指定的帳號，使用主體密碼和純文字主體來傳送：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="c8c8b-188">請回到網站，並使用下列資訊登入。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="c8c8b-189">使用者名稱： *username*</span><span class="sxs-lookup"><span data-stu-id="c8c8b-189">User Name: *username*</span></span>

<span data-ttu-id="c8c8b-190">密碼：*密碼*</span><span class="sxs-lookup"><span data-stu-id="c8c8b-190">Password: *password*</span></span>

<span data-ttu-id="c8c8b-191">您可以透過 PasswordRecovery 控制項之[`SendingMail` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx)的事件處理常式，或以宣告方式透過[`MailDefinition` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx)自訂此訊息。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="c8c8b-192">讓我們來探索這兩個選項。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-192">Let's explore both of these options.</span></span>

<span data-ttu-id="c8c8b-193">`SendingMail` 事件會在電子郵件訊息傳送之前引發，而這是以程式設計方式調整電子郵件訊息的最後機會。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="c8c8b-194">當引發這個事件時，事件處理常式會傳遞[`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx)類型的物件，其 `Message` 屬性包含要傳送之電子郵件的參考。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="c8c8b-195">建立 `SendingMail` 事件的事件處理常式，並加入下列程式碼，以程式設計方式將 `webmaster@example.com` 新增至 [CC] 清單。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-vb[Main](recovering-and-changing-passwords-vb/samples/sample2.vb)]

<span data-ttu-id="c8c8b-196">也可以透過宣告式方式來設定電子郵件訊息。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="c8c8b-197">PasswordRecovery 的 `MailDefinition` 屬性是[`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx)類型的物件。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="c8c8b-198">`MailDefinition` 類別提供與電子郵件相關的屬性主控制項，包括 `From`、`CC`、`Priority`、`Subject`、`IsBodyHtml`、`BodyFileName`和其他專案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="c8c8b-199">針對初學者，將[`Subject` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx)設定為比預設值（密碼）更具描述性的內容，例如您的密碼已重設 。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="c8c8b-200">若要自訂電子郵件訊息的本文，我們需要建立另一個包含本文內容的電子郵件範本檔案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="c8c8b-201">首先，在名為 `EmailTemplates`的網站中建立新的資料夾。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="c8c8b-202">接下來，將新的文字檔新增至此名為 `PasswordRecovery.txt` 的資料夾，並新增下列內容：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-vb/samples/sample3.aspx)]

<span data-ttu-id="c8c8b-203">請注意，`<%UserName%>` 和 `<%Password%>`的預留位置用法。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="c8c8b-204">PasswordRecovery 控制項會在傳送電子郵件之前，自動以使用者的使用者名稱和已復原的密碼取代這兩個預留位置。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="c8c8b-205">最後，將 `MailDefinition`的[`BodyFileName` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx)指向我們剛才建立的電子郵件範本（`~/EmailTemplates/PasswordRecovery.txt`）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="c8c8b-206">進行這些變更之後，請重新流覽 `RecoverPassword.aspx` 頁面，並輸入您的使用者名稱和安全性解答。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="c8c8b-207">您應該會收到如 [圖 5] 所示的電子郵件。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="c8c8b-208">請注意，`webmaster@example.com` 已是「抄送」，而且主旨和本文已更新。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>

<span data-ttu-id="c8c8b-209">[![[主旨]、[主體] 和 [副本] 清單已更新](recovering-and-changing-passwords-vb/_static/image14.png)](recovering-and-changing-passwords-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-vb/_static/image14.png)](recovering-and-changing-passwords-vb/_static/image13.png)</span></span>

<span data-ttu-id="c8c8b-210">**圖 5**： [主旨]、[主體] 和 [副本] 清單已更新（[按一下以觀看完整大小的影像](recovering-and-changing-passwords-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image15.png))</span></span>

<span data-ttu-id="c8c8b-211">若要將 HTML 格式的電子郵件集傳送[`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx)為 True （預設值為 False），並更新電子郵件範本以包含 HTML。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="c8c8b-212">`MailDefinition` 屬性對 PasswordRecovery 類別而言並不是唯一的。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="c8c8b-213">如我們在步驟2中所見，ChangePassword 控制項也提供 `MailDefinition` 的屬性。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="c8c8b-214">此外，CreateUserWizard 控制項還包含了這類屬性，您可以將其設定為自動傳送歡迎電子郵件訊息給新使用者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-215">左側導覽中目前沒有連結可到達 [`RecoverPassword.aspx`] 頁面。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="c8c8b-216">如果使用者無法成功登入網站，則只會有興趣造訪此頁面。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="c8c8b-217">因此，請更新 [`Login.aspx`] 頁面，以包含 [`RecoverPassword.aspx`] 頁面的連結。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>

### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="c8c8b-218">以程式設計方式重設使用者的密碼</span><span class="sxs-lookup"><span data-stu-id="c8c8b-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="c8c8b-219">重設使用者的密碼時，PasswordRecovery 控制項會呼叫 `MembershipUser` 物件的[`ResetPassword` 方法](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="c8c8b-220">這個方法有兩個多載：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-220">This method has two overloads:</span></span>

- <span data-ttu-id="c8c8b-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** 重設使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="c8c8b-222">如果 `RequiresQuestionAndAnswer` 為 False，請使用此多載。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="c8c8b-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** -只有當提供的*securityAnswer*正確時，才重設使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="c8c8b-224">如果 `RequiresQuestionAndAnswer` 為 True，則使用此多載。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="c8c8b-225">這兩個多載會傳回隨機產生的新密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="c8c8b-226">如同成員資格架構中的其他方法，`ResetPassword` 方法會委派至已設定的提供者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="c8c8b-227">`SqlMembershipProvider` 會叫用 `aspnet_Membership_ResetPassword` 預存程式，傳入使用者的使用者名稱、新密碼和提供的密碼解答，還有其他欄位。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="c8c8b-228">預存程式可確保密碼答案符合，然後更新使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="c8c8b-229">一些低層級的執行附注：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="c8c8b-230">已鎖定的使用者無法重設密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="c8c8b-231">不過，未經核准的使用者可能會。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-231">However, an unapproved user may.</span></span> <span data-ttu-id="c8c8b-232">我們將在解除鎖定和核准<a id="_msoanchor_3"> </a>[*使用者*](unlocking-and-approving-user-accounts-vb.md)帳戶教學課程中更詳細地討論已鎖定和已核准的狀態。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-vb.md) Accounts tutorial.</span></span>
- <span data-ttu-id="c8c8b-233">如果密碼答案不正確，使用者的失敗密碼解答嘗試計數會遞增。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="c8c8b-234">如果在指定的時間範圍內發生指定的無效安全性答案嘗試次數，使用者就會被鎖定。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="c8c8b-235">如何產生隨機密碼的單字</span><span class="sxs-lookup"><span data-stu-id="c8c8b-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="c8c8b-236">以 [圖 4] 和 [5] 中的電子郵件訊息顯示的隨機產生密碼，是由成員資格類別的[`GeneratePassword` 方法](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx)所建立。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="c8c8b-237">這個方法會接受兩個整數輸入參數-*長度*和*numberOfNonAlphanumericCharacters* ，並以至少*numberOfNonAlphanumericCharacters*的非英數位元數目，傳回*長度*至少為個字元的字串。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="c8c8b-238">從成員資格類別或登入相關的 Web 控制項呼叫這個方法時，這兩個參數的值是由成員資格設定的 `MinRequiredPasswordLength` 和 `MinRequiredNonalphanumericCharacters` 屬性所決定，分別為7和1。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="c8c8b-239">`GeneratePassword` 方法會使用密碼編譯增強式亂數產生器，以確保選取的隨機字元不會有任何偏差。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="c8c8b-240">此外，`GeneratePassword` 是 `Public`的，這表示如果您需要產生隨機字串或密碼，就可以直接從 ASP.NET 應用程式使用它。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-240">Furthermore, `GeneratePassword` is `Public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-241">`SqlMembershipProvider` 類別一律會產生長度至少為14個字元的隨機密碼，因此，如果 `MinRequiredPasswordLength` 小於14，則會忽略其值。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>

## <a name="step-2-changing-passwords"></a><span data-ttu-id="c8c8b-242">步驟2：變更密碼</span><span class="sxs-lookup"><span data-stu-id="c8c8b-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="c8c8b-243">隨機產生的密碼很容易記住。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="c8c8b-244">請考慮 [圖4： `WWGUZv(f2yM:Bd`] 中顯示的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="c8c8b-245">請嘗試將它認可到記憶體！</span><span class="sxs-lookup"><span data-stu-id="c8c8b-245">Try committing that to memory!</span></span> <span data-ttu-id="c8c8b-246">不用說，在使用者傳送此類隨機產生的密碼之後，她會想要將密碼變更為較容易記住的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="c8c8b-247">您可以使用 ChangePassword 控制項來建立介面，讓使用者變更其密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="c8c8b-248">ChangePassword 控制項與 PasswordRecovery 控制項非常類似，它包含兩個觀點：變更密碼和成功。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="c8c8b-249">[變更密碼] 視圖會提示使用者提供舊密碼和新密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="c8c8b-250">當提供正確的舊密碼和符合最小長度和非英數位元需求的新密碼時，ChangePassword 控制項會更新使用者的密碼，並顯示成功的視圖。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-251">ChangePassword 控制項會藉由叫用 `MembershipUser` 物件的[`ChangePassword` 方法](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx)來修改使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="c8c8b-252">ChangePassword 方法會接受兩個 `String` 輸入參數- *oldPassword*和*newPassword*，並使用*newPassword*更新使用者的帳戶，假設提供的*oldPassword*是正確的。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-252">The ChangePassword method accepts two `String` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>

<span data-ttu-id="c8c8b-253">開啟 [`ChangePassword.aspx`] 頁面，並將 [ChangePassword] 控制項新增至頁面，並將其命名為 `ChangePwd`。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="c8c8b-254">此時，設計檢視應該會顯示 [變更密碼] 視圖（請參閱 [圖 6]）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="c8c8b-255">如同 PasswordRecovery 控制項，您可以透過控制項的智慧標籤切換 views。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="c8c8b-256">此外，這些視圖的外觀也可以透過各種樣式屬性來自訂，或將它們轉換成範本。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>

<span data-ttu-id="c8c8b-257">[![將 ChangePassword 控制項新增至頁面](recovering-and-changing-passwords-vb/_static/image17.png)](recovering-and-changing-passwords-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-vb/_static/image17.png)](recovering-and-changing-passwords-vb/_static/image16.png)</span></span>

<span data-ttu-id="c8c8b-258">**圖 6**：將 ChangePassword 控制項新增至頁面（[按一下以查看完整大小的影像](recovering-and-changing-passwords-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image18.png))</span></span>

<span data-ttu-id="c8c8b-259">ChangePassword 控制項可以更新目前登入的使用者密碼，*或*另一個指定使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="c8c8b-260">如 [圖 6] 所示，預設的 [變更密碼] 視圖只會轉譯三個 TextBox 控制項：一個用於舊密碼，另兩個用於新密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="c8c8b-261">這個預設介面是用來更新目前登入的使用者密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="c8c8b-262">若要使用 ChangePassword 控制項來更新其他使用者的密碼，請將控制項的[`DisplayUserName` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx)設定為 True。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="c8c8b-263">這麼做會在頁面中新增第四個文字方塊，提示您輸入要變更其密碼的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="c8c8b-264">如果您想讓已登出的使用者變更密碼而不需要登入，將 `DisplayUserName` 設定為 True 會很有用。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="c8c8b-265">我個人認為，要求使用者登入並不會有任何問題，讓她能夠變更密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="c8c8b-266">因此，請將 `DisplayUserName` 設為 False （預設值）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="c8c8b-267">不過，在進行這項決策時，我們基本上會禁止匿名使用者到達此頁面。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="c8c8b-268">更新網站的 URL 授權規則，以便拒絕匿名使用者造訪 `ChangePassword.aspx`。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="c8c8b-269">如果您需要在 URL 授權規則語法上重新整理記憶體，請回頭參閱以<a id="_msoanchor_4"> </a>[*使用者為基礎的授權*](../membership/user-based-authorization-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-270">`DisplayUserName` 屬性似乎可以讓系統管理員變更其他使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="c8c8b-271">不過，即使 `DisplayUserName` 設定為 True，也必須知道正確的舊密碼並加以輸入。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="c8c8b-272">我們會討論可讓系統管理員在步驟3中變更使用者密碼的技術。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>

<span data-ttu-id="c8c8b-273">請造訪瀏覽器的 `ChangePassword.aspx` 頁面並變更您的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="c8c8b-274">請注意，如果您輸入的新密碼無法符合成員資格設定中所指定的密碼長度和非英數位元需求，就會顯示錯誤訊息（請參閱 [圖 7]）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>

<span data-ttu-id="c8c8b-275">[![將 ChangePassword 控制項新增至頁面](recovering-and-changing-passwords-vb/_static/image20.png)](recovering-and-changing-passwords-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-vb/_static/image20.png)](recovering-and-changing-passwords-vb/_static/image19.png)</span></span>

<span data-ttu-id="c8c8b-276">**圖 7**：將 ChangePassword 控制項新增至頁面（[按一下以查看完整大小的影像](recovering-and-changing-passwords-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image21.png))</span></span>

<span data-ttu-id="c8c8b-277">在輸入正確的舊密碼和有效的新密碼時，會變更登入的使用者密碼，並顯示成功的視圖。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="c8c8b-278">傳送確認電子郵件</span><span class="sxs-lookup"><span data-stu-id="c8c8b-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="c8c8b-279">根據預設，[ChangePassword] 控制項不會傳送電子郵件訊息給剛更新其密碼的使用者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="c8c8b-280">如果您想要傳送電子郵件，只需設定控制項的 `MailDefinition` 屬性。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="c8c8b-281">讓我們設定 [ChangePassword] 控制項，以便將包含新密碼的 HTML 格式電子郵件傳送給使用者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="c8c8b-282">首先，在名為 `ChangePassword.htm`的 `EmailTemplates` 資料夾中建立新檔案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="c8c8b-283">新增下列標記：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-vb/samples/sample4.html)]

<span data-ttu-id="c8c8b-284">接下來，將 ChangePassword 控制項的 `MailDefinition` 屬性的 `BodyFileName`、`IsBodyHtml`和 `Subject` 屬性設定為 ~/EmailTemplates/ChangePassword.htm、True，且您的密碼已分別變更為！。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="c8c8b-285">進行這些變更之後，再次流覽頁面並變更您的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="c8c8b-286">這次，ChangePassword 控制項會將自訂的 HTML 格式電子郵件傳送至使用者在檔案上的電子郵件地址（請參閱 [圖 8]）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>

<span data-ttu-id="c8c8b-287">[![電子郵件訊息，通知使用者他們的密碼已變更](recovering-and-changing-passwords-vb/_static/image23.png)](recovering-and-changing-passwords-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-vb/_static/image23.png)](recovering-and-changing-passwords-vb/_static/image22.png)</span></span>

<span data-ttu-id="c8c8b-288">**圖 8**：電子郵件訊息通知使用者他們的密碼已變更（[按一下以觀看完整大小的影像](recovering-and-changing-passwords-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image24.png))</span></span>

## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="c8c8b-289">步驟3：允許系統管理員變更使用者的密碼</span><span class="sxs-lookup"><span data-stu-id="c8c8b-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="c8c8b-290">在支援使用者帳戶的應用程式中，常見的功能是系統管理使用者變更其他使用者密碼的能力。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="c8c8b-291">有時候這是必要的功能，因為系統無法讓使用者變更自己的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="c8c8b-292">在這種情況下，使用者復原忘記密碼的唯一方式，就是讓系統管理員為他們指派新密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="c8c8b-293">不過，使用 PasswordRecovery 和 ChangePassword 控制項時，系統管理使用者不需要在變更使用者密碼的情況下自行運作，因為使用者可以自行執行此動作。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="c8c8b-294">但如果您的用戶端堅持該系統管理使用者應該能夠變更其他使用者的密碼，該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="c8c8b-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="c8c8b-295">可惜的是，加入這項功能可能會有一些工作。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="c8c8b-296">若要變更使用者的密碼，必須提供新舊密碼給 `MembershipUser` 物件的 `ChangePassword` 方法，但系統管理員不應該知道使用者的密碼，就能修改它。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="c8c8b-297">其中一個因應措施是先重設使用者的密碼，然後使用如下所示的程式碼，將它變更為新密碼：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-vb[Main](recovering-and-changing-passwords-vb/samples/sample5.vb)]

<span data-ttu-id="c8c8b-298">此程式碼一開始會抓取使用者*名稱*的相關資訊，也就是系統管理員想要變更其密碼的使用者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="c8c8b-299">接下來，會叫用 `ResetPassword` 方法，這會為使用者指派新的隨機密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="c8c8b-300">這個隨機產生的密碼是由方法傳回，並儲存在 `resetPwd`變數中。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="c8c8b-301">知道使用者的密碼之後，就可以透過對 `ChangePassword`的呼叫來變更它。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="c8c8b-302">問題在於，此程式碼只有在設定成員資格系統組態時才有效，因此 `RequiresQuestionAndAnswer` 為 False。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="c8c8b-303">如果 `RequiresQuestionAndAnswer` 為 True，與我們的應用程式相同，則必須將 `ResetPassword` 方法傳遞至安全性答案，否則會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="c8c8b-304">如果將成員資格架構設定為需要安全性問題和答案，但您的用戶端堅持系統管理員能夠變更使用者的密碼，您有三個選項：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="c8c8b-305">將您的手放在空中，告訴您的用戶端，這只是無法完成的一件事。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="c8c8b-306">將 `RequiresQuestionAndAnswer` 設定為 False。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="c8c8b-307">這會導致較不安全的應用程式。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-307">This results in a less secure application.</span></span> <span data-ttu-id="c8c8b-308">想像一下，惡意使用者已取得另一位使用者電子郵件收件匣的存取權。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="c8c8b-309">可能是遭入侵的使用者離開了午餐，而未鎖定工作站，或是他們從公用終端機存取他們的電子郵件，而未登出。不論是哪一種情況，惡意使用者都可以造訪 [`RecoverPassword.aspx`] 頁面，並輸入使用者的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="c8c8b-310">系統接著會以電子郵件傳送已復原的密碼，而不會提示您輸入安全性答案。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="c8c8b-311">略過成員資格架構所建立的抽象層，並直接使用 SQL Server 資料庫。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="c8c8b-312">成員資格架構包含名為 `aspnet_Membership_SetPassword` 的預存程式，其會設定使用者的密碼，而且不需要安全性答案或舊密碼，即可完成其工作。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="c8c8b-313">這些選項都不是特別吸引人，但這就是開發人員有時候的生命週期。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="c8c8b-314">我已經開始執行第三個方法，撰寫程式碼來略過 `Membership` 並 `MembershipUser` 類別，並直接針對 `SecurityTutorials` 資料庫操作。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-315">藉由直接使用資料庫，成員資格架構所提供的封裝會被破碎。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="c8c8b-316">這種決策會將我們與 `SqlMembershipProvider`結合，使程式碼的可攜性較低。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="c8c8b-317">此外，如果成員資格架構變更，此程式碼可能無法在未來版本的 ASP.NET 中如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="c8c8b-318">這種方法是一個因應措施，如同大部分的因應措施，並不是最佳作法的範例。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>

<span data-ttu-id="c8c8b-319">程式碼有一些不討喜位，而且相當冗長。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="c8c8b-320">因此，我不想要對此教學課程進行深入的檢查。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="c8c8b-321">如果您有興趣深入瞭解，請下載本教學課程的程式碼，並造訪 `~/Administration/ManageUsers.aspx` 頁面。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="c8c8b-322">我們在<a id="_msoanchor_5"> </a>[前一個教學](building-an-interface-to-select-one-user-account-from-many-vb.md)課程中建立的這個頁面會列出每個使用者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-vb.md), lists each user.</span></span> <span data-ttu-id="c8c8b-323">我已更新 GridView 以包含 `UserInformation.aspx` 頁面的連結，並透過 querystring 傳遞所選使用者的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="c8c8b-324">[`UserInformation.aspx`] 頁面會顯示所選使用者的相關資訊，以及變更其密碼的文字方塊（請參閱 [圖 9]）。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="c8c8b-325">輸入新密碼之後，在第二個文字方塊中確認，然後按一下 [更新使用者] 按鈕，就會叫用回傳接踵而來和 `aspnet_Membership_SetPassword` 預存程式，並更新使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="c8c8b-326">我鼓勵那些對這項功能感興趣的讀者更熟悉程式碼，並嘗試擴充功能以包含傳送電子郵件給密碼已變更的使用者。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>

<span data-ttu-id="c8c8b-327">[![系統管理員可以變更使用者的密碼](recovering-and-changing-passwords-vb/_static/image26.png)](recovering-and-changing-passwords-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-vb/_static/image26.png)](recovering-and-changing-passwords-vb/_static/image25.png)</span></span>

<span data-ttu-id="c8c8b-328">**圖 9**：系統管理員可以變更使用者的密碼（[按一下以觀看完整大小的影像](recovering-and-changing-passwords-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="c8c8b-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image27.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c8c8b-329">目前只有在成員資格架構設定為以純文字或雜湊格式儲存密碼時，[`UserInformation.aspx`] 頁面才有作用。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="c8c8b-330">雖然您已獲邀加入此功能，但它缺少加密新密碼的程式碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="c8c8b-331">我建議新增必要程式碼的方式，是使用解編程式（例如[反映](http://www.aisto.com/roeder/dotnet/)程式）來檢查 .NET Framework 中方法的原始程式碼;從檢查 `SqlMembershipProvider` 類別的 `ChangePassword` 方法開始。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="c8c8b-332">這是我用來撰寫程式碼來建立密碼雜湊的技巧。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-332">This is the technique I used to write the code for creating a hash of the password.</span></span>

## <a name="summary"></a><span data-ttu-id="c8c8b-333">總結</span><span class="sxs-lookup"><span data-stu-id="c8c8b-333">Summary</span></span>

<span data-ttu-id="c8c8b-334">ASP.NET 提供兩個可協助使用者管理其密碼的控制項。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="c8c8b-335">PasswordRecovery 控制項對忘記其密碼的人來說非常有用。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="c8c8b-336">視成員資格架構的設定而定，使用者可以透過電子郵件傳送其現有的密碼或隨機產生的新密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="c8c8b-337">ChangePassword 控制項可讓使用者更新其密碼。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="c8c8b-338">就像 Login 和 CreateUserWizard 控制項一樣，PasswordRecovery 和 ChangePassword 控制項會呈現豐富的使用者介面，而不需要撰寫宣告式標記或程式程式碼的舔。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="c8c8b-339">如果預設使用者介面不符合您的需求，您可以透過各種樣式屬性來自訂它。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="c8c8b-340">或者，控制項的介面也可以轉換成樣板，以獲得更精細的控制程度。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="c8c8b-341">這些控制項會在幕後使用成員資格 API，叫用 `MembershipUser` 物件的 `ResetPassword` 和 `ChangePassword` 方法。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="c8c8b-342">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="c8c8b-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c8c8b-343">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="c8c8b-343">Further Reading</span></span>

<span data-ttu-id="c8c8b-344">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="c8c8b-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c8c8b-345">ChangePassword 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="c8c8b-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="c8c8b-346">PasswordRecovery 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="c8c8b-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="c8c8b-347">在 ASP.NET 中傳送電子郵件</span><span class="sxs-lookup"><span data-stu-id="c8c8b-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="c8c8b-348">`System.Net.Mail` 常見問題</span><span class="sxs-lookup"><span data-stu-id="c8c8b-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="c8c8b-349">關於作者</span><span class="sxs-lookup"><span data-stu-id="c8c8b-349">About the Author</span></span>

<span data-ttu-id="c8c8b-350">Scott Mitchell，自1998起，有多個 ASP/ASP. NET 書籍和創辦人的4GuysFromRolla.com。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c8c8b-351">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c8c8b-352">他的最新著作是 *[在24小時內讓自己的 ASP.NET 2.0](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* 。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c8c8b-353">Scott 可以在[mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)或透過他在[http://ScottOnWriting.NET](http://scottonwriting.net/)的 blog。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c8c8b-354">特別感謝</span><span class="sxs-lookup"><span data-stu-id="c8c8b-354">Special Thanks To</span></span>

<span data-ttu-id="c8c8b-355">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c8c8b-356">本教學課程的領導審查者包括 Michael Emmings 和 Suchi Banerjee。</span><span class="sxs-lookup"><span data-stu-id="c8c8b-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="c8c8b-357">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="c8c8b-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c8c8b-358">若是如此，請在[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)下拉一行</span><span class="sxs-lookup"><span data-stu-id="c8c8b-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c8c8b-359">[上一頁](building-an-interface-to-select-one-user-account-from-many-vb.md)
> [下一頁](unlocking-and-approving-user-accounts-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c8c8b-359">[Previous](building-an-interface-to-select-one-user-account-from-many-vb.md)
[Next](unlocking-and-approving-user-accounts-vb.md)</span></span>
