---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
title: 復原及變更密碼 (C#) |Microsoft Docs
author: rick-anderson
description: ASP.NET 包含兩個 Web 控制項，可協助復原及變更密碼。 Provider 控制項可讓造訪者得以復原他遺失的 pa...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 19c4d042-4e34-4b44-9f1d-6bf2253ba366
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
msc.type: authoredcontent
ms.openlocfilehash: c04ed8ae18a3739f5519e30dea7768b8f6c7c7ff
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/01/2019
ms.locfileid: "57045315"
---
<a name="recovering-and-changing-passwords-c"></a><span data-ttu-id="fb4c0-104">復原及變更密碼 (C#)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-104">Recovering and Changing Passwords (C#)</span></span>
====================
<span data-ttu-id="fb4c0-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="fb4c0-106">[下載程式碼](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip)或[下載 PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span></span>

> <span data-ttu-id="fb4c0-107">ASP.NET 包含兩個 Web 控制項，可協助復原及變更密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="fb4c0-108">Provider 控制項可讓造訪者得以復原遺失的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="fb4c0-109">ChangePassword 控制項可讓使用者更新其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="fb4c0-110">在此教學課程系列，Provider 所見如同其他的登入相關的 Web 控制項和 ChangePassword 控制項與成員資格架構，來重設或修改使用者的密碼在幕後的工作。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>


## <a name="introduction"></a><span data-ttu-id="fb4c0-111">簡介</span><span class="sxs-lookup"><span data-stu-id="fb4c0-111">Introduction</span></span>

<span data-ttu-id="fb4c0-112">之間的我的銀行、 公共事業公司、 電話公司、 電子郵件帳戶和個人化的 web 入口網站的網站，我，大多數人來說，例如有數十種不同的密碼，請記住。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="fb4c0-113">記住這幾天內這麼多的認證，並不是常有人將忘記其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="fb4c0-114">為了說明這一點，提供使用者帳戶的網站需要包含讓使用者能夠復原其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="fb4c0-115">此程序通常需要產生新的隨機密碼，並以電子郵件傳送檔案的使用者的電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="fb4c0-116">接收到其新的密碼後大部分使用者回到網站，並變更其密碼，從更令人印象深刻的一個隨機產生的一個。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="fb4c0-117">ASP.NET 包含兩個 Web 控制項，可協助復原及變更密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="fb4c0-118">Provider 控制項可讓造訪者得以復原遺失的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="fb4c0-119">ChangePassword 控制項可讓使用者更新其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="fb4c0-120">在此教學課程系列，Provider 所見如同其他的登入相關的 Web 控制項和 ChangePassword 控制項與成員資格架構，來重設或修改使用者的密碼在幕後的工作。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="fb4c0-121">在本教學課程中，我們會檢查使用這兩個控制項。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="fb4c0-122">我們也將了解如何以程式設計方式變更和重設使用者的密碼，透過`MembershipUser`類別的`ChangePassword`和`ResetPassword`方法。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="fb4c0-123">步驟 1：協助使用者復原遺失的密碼</span><span class="sxs-lookup"><span data-stu-id="fb4c0-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="fb4c0-124">支援使用者帳戶的所有網站都需要為使用者提供一些機制來修復遺忘的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="fb4c0-125">好消息是，在 ASP.NET 中實作這類功能是由於 Provider Web 控制項變得輕而易舉。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="fb4c0-126">Provider 控制項呈現的介面會提示使用者輸入其使用者名稱，並在必要時，其安全性問題的答案。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="fb4c0-127">它然後傳送電子郵件給使用者其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-128">因為透過網路以純文字傳送電子郵件訊息有安全性風險相關傳送使用者的密碼，透過電子郵件。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>


<span data-ttu-id="fb4c0-129">Provider 控制項是由三個檢視所組成：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="fb4c0-130">**使用者名稱**-會提示他們的使用者名稱的訪客。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="fb4c0-131">這是初始檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-131">This is the initial view.</span></span>
- <span data-ttu-id="fb4c0-132">**問題**-文字，以及使用者輸入他的安全性問題的答案文字方塊以顯示使用者的使用者名稱和安全性問題。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="fb4c0-133">**成功**-會顯示訊息，通知已傳送電子郵件密碼的使用者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="fb4c0-134">顯示檢視和 Provider 控制項所執行的動作取決於下列成員資格的組態設定：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="fb4c0-135">成員資格架構`RequiresQuestionAndAnswer`設定指出是否時，使用者必須指定安全性問題與解答的帳戶註冊。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="fb4c0-136">如我們所述<a id="_msoanchor_1"> </a> [*建立使用者帳戶*](../membership/creating-user-accounts-cs.md)教學課程中，如果`RequiresQuestionAndAnswer`則 CreateUserWizard 介面包含文字方塊中，則為 True （預設值）新使用者的安全性問題和答案; 控制項如果`RequiresQuestionAndAnswer`為 False 時，會收集任何這類資訊。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="fb4c0-137">同樣地，如果`RequiresQuestionAndAnswer`是 True，則問題檢視使用者輸入其使用者名稱後 Provider 控制項顯示; 只有當使用者輸入正確的安全性解答復原密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="fb4c0-138">如果`RequiresQuestionAndAnswer`為 False，不過，Provider 控制項直接從使用者名稱 檢視將移至 成功 檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="fb4c0-139">使用者提供他的使用者名稱-或其使用者名稱和安全性的解答，如果之後`RequiresQuestionAndAnswer`Provider 是 True-傳送電子郵件給使用者其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="fb4c0-140">如果`EnablePasswordRetrieval`選項設為 True，則使用者傳送電子郵件，其目前的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="fb4c0-141">如果設定為 False 和`EnablePasswordReset`設為 True，則 Provider 控制項產生新隨機密碼對於使用者而言，與這個新的密碼，給他們的電子郵件。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="fb4c0-142">如果兩個`EnablePasswordRetrieval`和`EnablePasswordReset`為 False，Provider 控制會擲回的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-143">請記得，`SqlMembershipProvider`將使用者的密碼儲存在三種格式之一：清除，雜湊 （預設值） 或加密。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="fb4c0-144">使用的儲存體機制取決於成員資格的設定;示範應用程式使用 Hashed 密碼格式。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="fb4c0-145">使用 Hashed 密碼格式時`EnablePasswordRetrieval`選項必須設定為 False，因為系統無法判斷使用者的實際密碼雜湊儲存在資料庫中的版本。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>


<span data-ttu-id="fb4c0-146">[圖 1] 說明 Provider 的介面和行為方式會影響成員資格設定。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>


<span data-ttu-id="fb4c0-147">[![RequiresQuestionAndAnswer、 EnablePasswordRetrieval，以及 EnablePasswordReset 影響 Provider 控制項的外觀和行為](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span></span>

<span data-ttu-id="fb4c0-148">**圖 1**:`RequiresQuestionAndAnswer`， `EnablePasswordRetrieval`，並`EnablePasswordReset`影響 Provider 控制項的外觀和行為 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image3.png))</span></span>


> [!NOTE]
> <span data-ttu-id="fb4c0-149">在  <a id="_msoanchor_2"> </a> [*在 SQL Server 中建立成員資格結構描述*](../membership/creating-the-membership-schema-in-sql-server-cs.md)我們透過設定來設定成員資格提供者的教學課程`RequiresQuestionAndAnswer`設為 True，`EnablePasswordRetrieval`來為 false，和`EnablePasswordReset`設為 True。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>


### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="fb4c0-150">使用 Provider 控制項</span><span class="sxs-lookup"><span data-stu-id="fb4c0-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="fb4c0-151">讓我們看看使用 ASP.NET 網頁中的 Provider 控制項。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="fb4c0-152">開啟`RecoverPassword.aspx`並拖曳和置放 Provider 控制項從 [工具箱] 拖曳至設計工具; 設定其`ID`至`RecoverPwd`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="fb4c0-153">登入及 CreateUserWizard Web 控制項，例如 Provider 控制項的檢視會呈現豐富的複合介面包含標籤、 文字方塊、 按鈕和驗證控制項。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="fb4c0-154">您可以自訂檢視透過控制項的樣式屬性，或藉由將檢視轉換成範本的外觀。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="fb4c0-155">我不要更動此練習中，有興趣的讀者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="fb4c0-156">當使用者造訪此頁面她會輸入其使用者名稱，然後按一下 [提交] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="fb4c0-157">因為我們設定`RequiresQuestionAndAnswer`屬性設為 True，在我們的成員資格組態設定，Provider 控制項將接著顯示 [問題] 檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="fb4c0-158">使用者輸入其正確的安全性解答，並按一下 送出之後，將使用者的密碼更新為隨機產生一個 Provider 控制項，並將其電子郵件傳送此電子郵件地址，檔案的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="fb4c0-159">所有這些都是可能沒有我們不必撰寫一行程式碼 ！</span><span class="sxs-lookup"><span data-stu-id="fb4c0-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="fb4c0-160">在測試此頁面之前，沒有要容易的組態的最後一個項目： 我們需要指定中的郵件傳遞設定`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="fb4c0-161">Provider 控制項要依賴這些設定來傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="fb4c0-162">透過所指定的郵件傳遞組態[`<system.net>`項目](https://msdn.microsoft.com/library/6484zdc1.aspx)的[`<mailSettings>`項目](https://msdn.microsoft.com/library/w355a94k.aspx)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="fb4c0-163">使用[`<smtp>`項目](https://msdn.microsoft.com/library/ms164240.aspx)來指出傳遞方法和地址的預設值。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="fb4c0-164">下列標記會設定為使用名為網路 SMTP 伺服器的郵件設定`smtp.example.com`連接埠 25 上且擁有的使用者名稱和密碼的使用者名稱/密碼認證。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-165">`<system.net>` 是根的子元素`<configuration>`項目和的同層級`<system.web>`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="fb4c0-166">因此，請勿`<system.net>`內的項目`<system.web>`項目; 相反地，將它放在相同的層級。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>


[!code-xml[Main](recovering-and-changing-passwords-cs/samples/sample1.xml)]

<span data-ttu-id="fb4c0-167">除了在網路上使用 SMTP 伺服器，您也可以指定應該均存放要傳送的電子郵件訊息的收取目錄。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="fb4c0-168">一旦您已設定的 SMTP 設定，請瀏覽`RecoverPassword.aspx`透過瀏覽器的頁面。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="fb4c0-169">第一次嘗試輸入在使用者存放區不存在的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="fb4c0-170">如 圖 2 所示，Provider 控制項就會顯示訊息，指出 無法存取使用者資訊。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="fb4c0-171">您可以透過控制項的自訂訊息的文字[`UserNameFailureText`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>


<span data-ttu-id="fb4c0-172">[![如果輸入無效的使用者名稱，就會顯示一則錯誤訊息](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span></span>

<span data-ttu-id="fb4c0-173">**圖 2**:如果輸入無效的使用者名稱，就會顯示一則錯誤訊息 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image6.png))</span></span>


<span data-ttu-id="fb4c0-174">現在，請輸入使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-174">Now enter a username.</span></span> <span data-ttu-id="fb4c0-175">知道使用者的電子郵件地址，您可以存取，以及其安全性回答您的系統中的帳戶名稱使用。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="fb4c0-176">輸入使用者名稱，然後按一下 [送出之後, Provider 控制項會顯示其問題] 檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="fb4c0-177">為使用使用者名稱 檢視中，如果您輸入不正確回答 Provider 控制項會顯示的錯誤訊息 （請參閱 圖 3）。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="fb4c0-178">使用[`QuestionFailureText`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx)來自訂此錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>


<span data-ttu-id="fb4c0-179">[![如果使用者輸入無效的安全性解答，就會顯示一則錯誤訊息](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span></span>

<span data-ttu-id="fb4c0-180">**圖 3**:如果使用者輸入無效的安全性解答，就會顯示一則錯誤訊息 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image9.png))</span></span>


<span data-ttu-id="fb4c0-181">最後，輸入正確的安全性解答，然後按一下 提交。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="fb4c0-182">在幕後，Provider 控制產生的隨機密碼，將它指派給使用者帳戶，傳送電子郵件通知使用者的新密碼 （請參閱 圖 4），然後顯示 成功 檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>


<span data-ttu-id="fb4c0-183">[![使用者會傳送一封電子郵件與他的新密碼](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span></span>

<span data-ttu-id="fb4c0-184">**圖 4**:使用者會傳送一封電子郵件與他的新密碼 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image12.png))</span></span>


### <a name="customizing-the-email"></a><span data-ttu-id="fb4c0-185">自訂電子郵件</span><span class="sxs-lookup"><span data-stu-id="fb4c0-185">Customizing the Email</span></span>

<span data-ttu-id="fb4c0-186">Provider 控制項所傳送的預設電子郵件是而晦暗，而且 （請參閱 圖 4）。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="fb4c0-187">從指定的帳戶傳送訊息`<smtp>`項目的`from`主旨為密碼的屬性和純文字主體：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="fb4c0-188">請返回該網站，然後使用下列資訊來登入。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="fb4c0-189">使用者名稱：*使用者名稱*</span><span class="sxs-lookup"><span data-stu-id="fb4c0-189">User Name: *username*</span></span>

<span data-ttu-id="fb4c0-190">密碼：*密碼*</span><span class="sxs-lookup"><span data-stu-id="fb4c0-190">Password: *password*</span></span>

<span data-ttu-id="fb4c0-191">此訊息可以透過程式設計方式自訂透過 Provider 控制項的事件處理常式[`SendingMail`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx)，或以宣告方式透過[`MailDefinition`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="fb4c0-192">讓我們來探索這兩種選項。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-192">Let's explore both of these options.</span></span>

<span data-ttu-id="fb4c0-193">`SendingMail`電子郵件訊息傳送，且最後一個機會來以程式設計方式調整電子郵件訊息之前，引發事件。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="fb4c0-194">型別的物件時，引發這個事件時，要傳遞事件處理常式[ `MailMessageEventArgs` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx)，其`Message`屬性包含傳送電子郵件的參考。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="fb4c0-195">建立事件處理常式`SendingMail`事件，並新增下列程式碼，以程式設計方式將`webmaster@example.com`CC 清單。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-csharp[Main](recovering-and-changing-passwords-cs/samples/sample2.cs)]

<span data-ttu-id="fb4c0-196">也可以透過宣告式的方式設定電子郵件訊息。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="fb4c0-197">Provider`MailDefinition`屬性是物件型別的[ `MailDefinition` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="fb4c0-198">`MailDefinition`類別提供了一堆電子郵件相關的屬性，包括`From`， `CC`， `Priority`， `Subject`， `IsBodyHtml`， `BodyFileName`，和其他人。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="fb4c0-199">首先，設定[`Subject`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx)為更具描述性，比使用預設 （密碼），例如您的密碼已重設...</span><span class="sxs-lookup"><span data-stu-id="fb4c0-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="fb4c0-200">若要自訂我們需要建立個別的電子郵件範本檔案的電子郵件訊息的主體包含主體的內容。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="fb4c0-201">開始建立新的資料夾中名為網站`EmailTemplates`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="fb4c0-202">接下來，將新的文字檔新增至名為此資料夾`PasswordRecovery.txt`並新增下列內容：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample3.aspx)]

<span data-ttu-id="fb4c0-203">請注意，預留位置`<%UserName%>`和`<%Password%>`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="fb4c0-204">Provider 控制會自動取代這些兩個預留位置，使用者的使用者名稱和復原的密碼，再傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="fb4c0-205">最後，指向`MailDefinition`的[`BodyFileName`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx)我們剛剛建立的電子郵件範本 (`~/EmailTemplates/PasswordRecovery.txt`)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="fb4c0-206">進行這些變更重新審視之後`RecoverPassword.aspx`頁面，然後輸入您使用者名稱和安全性的答案。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="fb4c0-207">您會收到應該看起來像圖 5 中的電子郵件。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="fb4c0-208">請注意， `webmaster@example.com` CC 會和，已更新的主旨和本文。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>


<span data-ttu-id="fb4c0-209">[![更新主旨、 主體和 [副本] 清單](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span></span>

<span data-ttu-id="fb4c0-210">**圖 5**:主旨、 主體和 [副本] 已更新清單 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image15.png))</span></span>


<span data-ttu-id="fb4c0-211">若要傳送 HTML 格式的電子郵件設定[ `IsBodyHtml` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) True （預設值為 False） 和更新電子郵件範本，以包含 HTML。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="fb4c0-212">`MailDefinition`屬性不是唯一的 Provider 類別。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="fb4c0-213">我們將在步驟 2 中所看到的 ChangePassword 控制項也提供`MailDefinition`屬性。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="fb4c0-214">此外，CreateUserWizard 控制項包含這類屬性，您可以設定自動傳送給新使用者的 歡迎使用電子郵件訊息。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-215">目前沒有任何連結在左側導覽中用來觸達`RecoverPassword.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="fb4c0-216">如果她無法成功登入此網站，瀏覽此頁面只會在意使用者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="fb4c0-217">因此，更新`Login.aspx`頁面，即可包含的連結`RecoverPassword.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>


### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="fb4c0-218">以程式設計方式重設使用者的密碼</span><span class="sxs-lookup"><span data-stu-id="fb4c0-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="fb4c0-219">當重設使用者的密碼 Provider 控制呼叫`MembershipUser`物件的[`ResetPassword`方法](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="fb4c0-220">這個方法有兩個多載：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-220">This method has two overloads:</span></span>

- <span data-ttu-id="fb4c0-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** -重設使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="fb4c0-222">如果使用這個多載`RequiresQuestionAndAnswer`為 False。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="fb4c0-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** -重設使用者的密碼才提供*securityAnswer*正確無誤。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="fb4c0-224">如果使用這個多載`RequiresQuestionAndAnswer`為 True。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="fb4c0-225">這兩個多載會傳回新的隨機產生密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="fb4c0-226">使用其他方法，在 成員資格架構，例如`ResetPassword`方法會委派到設定的提供者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="fb4c0-227">`SqlMembershipProvider`叫用`aspnet_Membership_ResetPassword`預存程序，並傳遞使用者的使用者名稱、 新的密碼和提供的密碼答案，在其他欄位。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="fb4c0-228">預存程序可確保密碼解答比對，，然後更新 使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="fb4c0-229">幾個低層級的實作附註：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="fb4c0-230">鎖定的使用者無法重設其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="fb4c0-231">不過，有可能會在未經核准的使用者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-231">However, an unapproved user may.</span></span> <span data-ttu-id="fb4c0-232">我們將討論出鎖定，並核准狀態更詳細地<a id="_msoanchor_3"> </a> [ *Unlocking 和核准使用者*](unlocking-and-approving-user-accounts-cs.md)帳戶教學課程。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-cs.md) Accounts tutorial.</span></span>
- <span data-ttu-id="fb4c0-233">如果不正確的密碼解答，使用者的密碼解答嘗試計數會遞增。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="fb4c0-234">如果指定的多個無效的安全性解答嘗試就會發生在指定的時間範圍內，使用者遭到鎖定。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="fb4c0-235">產生方式的隨機密碼文字</span><span class="sxs-lookup"><span data-stu-id="fb4c0-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="fb4c0-236">電子郵件中的訊息數字 4 和 5 所示的隨機產生密碼藉由 Membership 類別[`GeneratePassword`方法](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="fb4c0-237">這個方法會接受兩個整數輸入的參數-*長度*並*numberOfNonAlphanumericCharacters* -並至少傳回一個字串*長度*在長時間使用字元至少*numberOfNonAlphanumericCharacters*非英數的字元數。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="fb4c0-238">當這個方法從呼叫內的成員資格類別或登入相關的 Web 控制項時，這兩個參數的值取決於成員資格的組態`MinRequiredPasswordLength`和`MinRequiredNonalphanumericCharacters`我們分別設定為 7 和 1 的屬性。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="fb4c0-239">`GeneratePassword`方法會使用強式密碼編譯亂數產生器，以確保在已選取哪些隨機字元所組成，沒有任何偏差。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="fb4c0-240">此外，`GeneratePassword`是`public`，也就是說，您可以使用它直接從您的 ASP.NET 應用程式若要產生隨機字串或密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-240">Furthermore, `GeneratePassword` is `public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-241">`SqlMembershipProvider`類別一律會產生隨機密碼，至少 14 個字元，因此如果`MinRequiredPasswordLength`是小於 14，則會忽略其值。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>


## <a name="step-2-changing-passwords"></a><span data-ttu-id="fb4c0-242">步驟 2：變更密碼</span><span class="sxs-lookup"><span data-stu-id="fb4c0-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="fb4c0-243">隨機產生密碼難以記住。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="fb4c0-244">[圖 4] 所示的密碼，請考慮： `WWGUZv(f2yM:Bd`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="fb4c0-245">嘗試認可的記憶體 ！</span><span class="sxs-lookup"><span data-stu-id="fb4c0-245">Try committing that to memory!</span></span> <span data-ttu-id="fb4c0-246">不用說，這類的隨機產生密碼傳送給使用者之後，她會想要將密碼變更為更令人印象深刻的項目。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="fb4c0-247">若要建立要變更其密碼的使用者介面使用 ChangePassword 控制項。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="fb4c0-248">更 Provider 控制項，例如 ChangePassword 控制項包含兩種檢視：變更密碼和成功與否。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="fb4c0-249">變更密碼 檢視會提示使用者輸入其舊和新密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="fb4c0-250">在提供正確的舊密碼和新的密碼符合最小長度以及非英數的字元需求，ChangePassword 控制項更新使用者的密碼，並顯示 [成功] 檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-251">ChangePassword 控制項修改使用者的密碼，藉由叫用`MembershipUser`物件的[`ChangePassword`方法](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="fb4c0-252">ChangePassword 方法接受兩個`string`輸入參數- *oldPassword*並*newPassword*-並更新使用者的帳戶具有*newPassword*，假設所提供*oldPassword*正確無誤。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-252">The ChangePassword method accepts two `string` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>


<span data-ttu-id="fb4c0-253">開啟`ChangePassword.aspx`頁面上，並將 ChangePassword 控制項新增至頁面上，將它命名為`ChangePwd`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="fb4c0-254">此時，設計 檢視應該會顯示 變更密碼 （請參閱 圖 6） 的檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="fb4c0-255">例如與 Provider 控制項，您可以切換透過控制項的智慧標籤的檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="fb4c0-256">此外，這些檢視的外觀會透過各種的樣式屬性，或將它們轉換成範本，將可自訂的。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>


<span data-ttu-id="fb4c0-257">[![ChangePassword 控制項加入頁面](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span></span>

<span data-ttu-id="fb4c0-258">**圖 6**:ChangePassword 控制項加入頁面 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image18.png))</span></span>


<span data-ttu-id="fb4c0-259">ChangePassword 控制項可以更新目前登入使用者的密碼*或*另一個，指定使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="fb4c0-260">如 [圖 6] 所示，預設的 [變更密碼] 檢視會呈現只需要三個文字方塊控制項： 一個用於舊的密碼，兩個新的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="fb4c0-261">此預設介面用來更新目前登入使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="fb4c0-262">若要使用 ChangePassword 控制項更新另一位使用者的密碼，將控制項的[`DisplayUserName`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx)設為 True。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="fb4c0-263">如此一來，是在頁面上，若要變更其密碼提示使用者的使用者名稱中加入第四個文字方塊中。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="fb4c0-264">設定`DisplayUserName`要適合在您想要讓出記錄的使用者變更其密碼，而不需要登入則為 True。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="fb4c0-265">我個人認為沒有問題需要登入使用者，然後才允許她在變更其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="fb4c0-266">因此，保留`DisplayUserName`設為 False （預設值）。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="fb4c0-267">在進行這項決策，不過，我們基本上均無法到達此頁面的匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="fb4c0-268">更新站台的 URL 授權規則以拒絕匿名使用者造訪`ChangePassword.aspx`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="fb4c0-269">如果您需要重新整理您的 URL 授權規則語法上的記憶體，請參閱上一步<a id="_msoanchor_4"> </a> [*使用者為基礎的授權*](../membership/user-based-authorization-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-270">看起來好像沒，`DisplayUserName`屬性可用於讓系統管理員能夠變更其他使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="fb4c0-271">不過，即使`DisplayUserName`設為 True，必須知道並輸入正確的舊密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="fb4c0-272">我們會討論可讓系統管理員變更使用者的密碼，在步驟 3 中的技術。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>


<span data-ttu-id="fb4c0-273">請瀏覽`ChangePassword.aspx`透過瀏覽器頁面，並變更您的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="fb4c0-274">請注意，是否您輸入新的密碼無法滿足密碼長度和成員資格設定中指定的非英數的字元需求，會顯示一則錯誤訊息 （請參閱 圖 7）。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>


<span data-ttu-id="fb4c0-275">[![ChangePassword 控制項加入頁面](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span></span>

<span data-ttu-id="fb4c0-276">**圖 7**:ChangePassword 控制項加入頁面 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image21.png))</span></span>


<span data-ttu-id="fb4c0-277">在輸入正確的舊密碼和有效新密碼，登入使用者的密碼變更，並顯示 [成功] 檢視。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="fb4c0-278">傳送確認電子郵件</span><span class="sxs-lookup"><span data-stu-id="fb4c0-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="fb4c0-279">根據預設，ChangePassword 控制項不會對剛更新其密碼的使用者傳送電子郵件訊息。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="fb4c0-280">如果您想要傳送電子郵件，直接設定控制項的`MailDefinition`屬性。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="fb4c0-281">讓我們設定 ChangePassword 控制項，讓使用者傳送 HTML 格式的電子郵件，其中包含新的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="fb4c0-282">藉由建立新檔案中，啟動`EmailTemplates`名為資料夾`ChangePassword.htm`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="fb4c0-283">加入下列標記：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-cs/samples/sample4.html)]

<span data-ttu-id="fb4c0-284">接下來，將 ChangePassword 控制項的`MailDefinition`屬性的`BodyFileName`， `IsBodyHtml`，和`Subject`屬性 ~ EmailTemplates/ChangePassword.htm，True，且您的密碼已變更 / ！ 分別。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="fb4c0-285">進行這些變更之後，重新瀏覽的頁面，並再次變更您的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="fb4c0-286">此時，ChangePassword 控制項就會將自訂的 HTML 格式的電子郵件傳送檔案的使用者的電子郵件地址 （請參閱 圖 8）。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>


<span data-ttu-id="fb4c0-287">[![電子郵件訊息，通知使用者，其密碼已經變更](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span></span>

<span data-ttu-id="fb4c0-288">**圖 8**:電子郵件訊息會通知使用者，其密碼已經變更 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image24.png))</span></span>


## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="fb4c0-289">步驟 3：可讓系統管理員變更使用者的密碼</span><span class="sxs-lookup"><span data-stu-id="fb4c0-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="fb4c0-290">在支援使用者帳戶的應用程式中的常見功能是針對系統管理使用者，若要變更其他使用者的密碼的能力。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="fb4c0-291">有時候這項功能是必要，因為系統缺乏可讓使用者變更其自己的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="fb4c0-292">在此情況下，使用者復原遺忘的密碼的唯一方式是將它們指派新密碼管理員。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="fb4c0-293">Provider 和 ChangePassword 控制項，不過，系統管理使用者需要不忙碌本身與變更使用者的密碼，因為使用者都能執行此本身。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="fb4c0-294">但是，如果您的用戶端必須將系統管理使用者應該能夠變更其他使用者的密碼？</span><span class="sxs-lookup"><span data-stu-id="fb4c0-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="fb4c0-295">不幸的是，新增這項功能，可以是一些工作。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="fb4c0-296">若要變更使用者的密碼，必須提供舊的和新密碼給`MembershipUser`物件的`ChangePassword`方法，但系統管理員應該要知道使用者的密碼，才能修改它。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="fb4c0-297">一個解決方法是先重設使用者的密碼，然後將它變更為新的密碼，使用程式碼，如下所示：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample5.aspx)]

<span data-ttu-id="fb4c0-298">此程式碼一開始會擷取相關資訊*username*，這是系統管理員想要變更其密碼的使用者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="fb4c0-299">接下來，`ResetPassword`叫用方法時，哪些指派和新的隨機密碼的使用者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="fb4c0-300">是由方法傳回此隨機產生的密碼，並將其儲存在變數`resetPwd`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="fb4c0-301">既然我們已經知道使用者的密碼，我們就可以將它變更，透過對呼叫`ChangePassword`。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="fb4c0-302">問題是，此程式碼僅適用於成員資格系統組態設定，`RequiresQuestionAndAnswer`為 False。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="fb4c0-303">如果`RequiresQuestionAndAnswer`為 True，因為它是我們的應用程式，則`ResetPassword`方法必須傳送的安全性解答，否則它將會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="fb4c0-304">如果成員資格架構已設定為需要的安全性問題與解答，且您的用戶端尚未要求系統管理員可以變更使用者的密碼，您會有三個選項：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="fb4c0-305">在空中飛行時擲回您手裡，告訴您的用戶端，這是無法完成的只是一件事。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="fb4c0-306">設定`RequiresQuestionAndAnswer`設為 False。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="fb4c0-307">這會導致較不安全的應用程式。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-307">This results in a less secure application.</span></span> <span data-ttu-id="fb4c0-308">想像一下老道的惡意使用者能夠存取另一位使用者的電子郵件收件匣。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="fb4c0-309">遭盜用的使用者可能離開辦公桌去吃午餐，且未鎖定自己的工作站，或可能從公用的終端機存取其電子郵件及未登出。在任一情況下，惡意使用者可以瀏覽`RecoverPassword.aspx`頁面，然後輸入使用者的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="fb4c0-310">系統會然後傳送電子郵件已復原的密碼不會提示輸入安全性解答。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="fb4c0-311">略過成員資格架構和直接與 SQL Server 資料庫的工作所建立的抽象層。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="fb4c0-312">成員資格結構描述包含名為預存程序`aspnet_Membership_SetPassword`，設定使用者的密碼，而且不需要的安全性解答或舊的密碼以完成其工作。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="fb4c0-313">這些選項都特別吸引人，但這生命週期的開發人員有時會的方式。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="fb4c0-314">我把它，並實作第三個方法，撰寫程式碼，會略過`Membership`並`MembershipUser`類別，並直接對其進行`SecurityTutorials`資料庫。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="fb4c0-315">藉由直接使用資料庫，是大家所提供的成員資格架構的封裝。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="fb4c0-316">這項決定繫結在我們`SqlMembershipProvider`，讓我們較可攜式的程式碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="fb4c0-317">此外，此程式碼可能無法如預期般在未來版本的 ASP.NET 成員資格結構描述變更。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="fb4c0-318">這個方法會因應措施，和大部分的因應措施，例如不是最佳作法的範例。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>


<span data-ttu-id="fb4c0-319">程式碼有一些不討喜的位元，並會相當冗長。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="fb4c0-320">因此，我不想干擾本教學課程，深入檢驗它。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="fb4c0-321">如果您有興趣進一步了解更多資訊，請針對此教學課程和瀏覽下載程式碼`~/Administration/ManageUsers.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="fb4c0-322">此頁面上，我們在中建立<a id="_msoanchor_5"> </a>[前述教學課程](building-an-interface-to-select-one-user-account-from-many-cs.md)，列出每位使用者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-cs.md), lists each user.</span></span> <span data-ttu-id="fb4c0-323">我已更新要包含的連結 GridView`UserInformation.aspx`頁面上，將傳遞查詢字串透過所選的使用者的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="fb4c0-324">`UserInformation.aspx`頁面會顯示選取的使用者和文字方塊的相關資訊，變更其密碼 （請參閱 圖 9）。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="fb4c0-325">之後，輸入新的密碼、 確認在第二個文字方塊中，然後按一下更新的 [使用者] 按鈕，回傳是兩邊彼此乾瞪眼和`aspnet_Membership_SetPassword`預存程序會叫用，更新使用者的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="fb4c0-326">我非常鼓勵以更加熟悉程式碼，然後再試擴充功能，以包括傳送電子郵件給使用者的密碼已變更這項功能有興趣的讀者。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>


<span data-ttu-id="fb4c0-327">[![系統管理員可以變更使用者的密碼](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span></span>

<span data-ttu-id="fb4c0-328">**圖 9**:系統管理員可以變更使用者的密碼 ([按一下以檢視完整大小的影像](recovering-and-changing-passwords-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="fb4c0-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="fb4c0-329">`UserInformation.aspx`頁面目前僅適用於如果成員資格架構設定為清除或雜湊格式儲存密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="fb4c0-330">雖然我們誠邀您加入這項功能，它會缺少加密新的密碼，程式碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="fb4c0-331">建議您將必要的程式碼的方式是使用為解編程式，例如[Reflector](http://www.aisto.com/roeder/dotnet/)來檢查在.NET Framework 中; 方法的原始程式碼先檢查`SqlMembershipProvider`類別的`ChangePassword`方法。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="fb4c0-332">這是密碼的我用來撰寫的程式碼建立雜湊的技術。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-332">This is the technique I used to write the code for creating a hash of the password.</span></span>


## <a name="summary"></a><span data-ttu-id="fb4c0-333">總結</span><span class="sxs-lookup"><span data-stu-id="fb4c0-333">Summary</span></span>

<span data-ttu-id="fb4c0-334">ASP.NET 提供了兩個控制項，可協助使用者管理他們的密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="fb4c0-335">Provider 控制項可用於使用者忘記其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="fb4c0-336">根據成員資格架構的設定，使用者可以傳送電子郵件，其現有的密碼或隨機產生新密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="fb4c0-337">ChangePassword 控制項可讓使用者更新其密碼。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="fb4c0-338">登入及 CreateUserWizard 控制項，例如密碼與 ChangePassword 控制項會呈現豐富的使用者介面，而不需要撰寫可靠的宣告式標記或程式碼行。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="fb4c0-339">如果預設的使用者介面不符合您的需求，您可以自訂它透過各種不同的樣式屬性。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="fb4c0-340">或者，控制項的介面可能會轉換成範本，控制更精細的細微程度。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="fb4c0-341">在幕後，這些控制項使用 Membership API 中，叫用`MembershipUser`物件的`ResetPassword`和`ChangePassword`方法。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="fb4c0-342">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="fb4c0-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="fb4c0-343">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="fb4c0-343">Further Reading</span></span>

<span data-ttu-id="fb4c0-344">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="fb4c0-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="fb4c0-345">ChangePassword 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="fb4c0-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="fb4c0-346">Provider 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="fb4c0-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="fb4c0-347">在 ASP.NET 中傳送電子郵件</span><span class="sxs-lookup"><span data-stu-id="fb4c0-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="fb4c0-348">`System.Net.Mail` 常見問題集</span><span class="sxs-lookup"><span data-stu-id="fb4c0-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="fb4c0-349">關於作者</span><span class="sxs-lookup"><span data-stu-id="fb4c0-349">About the Author</span></span>

<span data-ttu-id="fb4c0-350">Scott Mitchell，多個 ASP 書籍的作者，他是 4GuysFromRolla.com 的創辦人，從事 Microsoft Web 技術工作自 1998 年。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="fb4c0-351">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="fb4c0-352">他最新的著作是 *[Sams 教導您自己 ASP.NET 2.0 在 24 小時內](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="fb4c0-353">Scott 要聯絡[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或透過他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="fb4c0-354">特別感謝</span><span class="sxs-lookup"><span data-stu-id="fb4c0-354">Special Thanks To</span></span>

<span data-ttu-id="fb4c0-355">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="fb4c0-356">本教學課程中的潛在客戶檢閱者加 Michael Emmings Suchi Banerjee。</span><span class="sxs-lookup"><span data-stu-id="fb4c0-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="fb4c0-357">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="fb4c0-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="fb4c0-358">如果是這樣，psychic 在 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="fb4c0-359">[上一頁](building-an-interface-to-select-one-user-account-from-many-cs.md)
> [下一頁](unlocking-and-approving-user-accounts-cs.md)</span><span class="sxs-lookup"><span data-stu-id="fb4c0-359">[Previous](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Next](unlocking-and-approving-user-accounts-cs.md)</span></span>
