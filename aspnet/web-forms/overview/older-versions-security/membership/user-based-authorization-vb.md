---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-vb
title: 使用者為基礎的授權 (VB) |Microsoft Docs
author: rick-anderson
description: 在本教學課程中我們將探討限制存取頁面，並限制透過各種技術的頁面層級功能。
ms.author: riande
ms.date: 01/18/2008
ms.assetid: bc937e9d-5c14-4fc4-aec7-440da924dd18
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-vb
msc.type: authoredcontent
ms.openlocfilehash: 965e1ff59866ce2946f6965cb31a751f20c1bcfc
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/06/2019
ms.locfileid: "65114630"
---
# <a name="user-based-authorization-vb"></a><span data-ttu-id="b695c-103">以使用者為基礎的授權 (VB)</span><span class="sxs-lookup"><span data-stu-id="b695c-103">User-Based Authorization (VB)</span></span>

<span data-ttu-id="b695c-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b695c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b695c-105">[下載程式碼](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip)或[下載 PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="b695c-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span></span>

> <span data-ttu-id="b695c-106">在本教學課程中我們將探討限制存取頁面，並限制透過各種技術的頁面層級功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>

## <a name="introduction"></a><span data-ttu-id="b695c-107">簡介</span><span class="sxs-lookup"><span data-stu-id="b695c-107">Introduction</span></span>

<span data-ttu-id="b695c-108">大部分的 web 應用程式提供使用者帳戶執行這項操作來限制特定的訪客存取網站內的特定網頁的組件中。</span><span class="sxs-lookup"><span data-stu-id="b695c-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="b695c-109">最線上的留言板站台，比方說，-匿名和已驗證的所有使用者都都能夠檢視的留言板文章，但只有經過驗證的使用者可以瀏覽網頁，以建立新的貼文。</span><span class="sxs-lookup"><span data-stu-id="b695c-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="b695c-110">而且可能只是供特定使用者 （或一組特定的使用者） 存取的系統管理頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="b695c-111">此外，使用者以使用者為基礎的頁面層級功能都不一樣。</span><span class="sxs-lookup"><span data-stu-id="b695c-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="b695c-112">檢視文章的清單，已驗證的使用者會顯示一個介面來評比每個文章中，而此介面不是匿名的訪客可用。</span><span class="sxs-lookup"><span data-stu-id="b695c-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="b695c-113">ASP.NET 可讓您輕鬆地定義使用者為基礎的授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="b695c-114">中的標記只需要稍微`Web.config`，特定的網頁或整個目錄可以鎖定，使其只能存取指定的使用者子集。</span><span class="sxs-lookup"><span data-stu-id="b695c-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="b695c-115">頁面層級功能可以開啟或關閉根據目前登入的使用者，透過程式設計的方式和宣告式的方式。</span><span class="sxs-lookup"><span data-stu-id="b695c-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="b695c-116">在本教學課程中我們將探討限制存取頁面，並限制透過各種技術的頁面層級功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="b695c-117">讓我們開始吧 ！</span><span class="sxs-lookup"><span data-stu-id="b695c-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="b695c-118">了解 URL 授權工作流程</span><span class="sxs-lookup"><span data-stu-id="b695c-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="b695c-119">中所述[*的表單驗證概觀*](../introduction/an-overview-of-forms-authentication-vb.md)教學課程中，當 ASP.NET 執行階段會處理要求的 ASP.NET 資源要求在其生命週期期間引發的事件數目。</span><span class="sxs-lookup"><span data-stu-id="b695c-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="b695c-120">*HTTP 模組*會執行其程式碼以回應要求的生命週期中的特定事件的 managed 的類別。</span><span class="sxs-lookup"><span data-stu-id="b695c-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="b695c-121">ASP.NET 隨附於多個執行基本工作，在幕後的 HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="b695c-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="b695c-122">這類 HTTP 模組是[ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b695c-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="b695c-123">在上一個教學課程的主要功能中所述`FormsAuthenticationModule`是要判斷目前要求的身分識別。</span><span class="sxs-lookup"><span data-stu-id="b695c-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="b695c-124">這是藉由檢查表單驗證票證，位於 cookie 或內嵌在 URL 內完成。</span><span class="sxs-lookup"><span data-stu-id="b695c-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="b695c-125">此識別發生期間[`AuthenticateRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b695c-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="b695c-126">另一個重要的 HTTP 模組[ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)，這會引發以回應[`AuthorizeRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx)(之後恰好`AuthenticateRequest`事件)。</span><span class="sxs-lookup"><span data-stu-id="b695c-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="b695c-127">`UrlAuthorizationModule`檢查中的組態標記`Web.config`來判斷目前的身分識別是否有權瀏覽指定的頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="b695c-128">此程序指*URL 授權*。</span><span class="sxs-lookup"><span data-stu-id="b695c-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="b695c-129">我們將檢驗在步驟 1 中的 URL 授權規則的語法但首先讓我們看看什麼`UrlAuthorizationModule`根據要求是否已獲授權或不會。</span><span class="sxs-lookup"><span data-stu-id="b695c-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="b695c-130">如果`UrlAuthorizationModule`決定要求已獲得授權，則它不會執行任何動作，以及其整個生命週期的要求會繼續。</span><span class="sxs-lookup"><span data-stu-id="b695c-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="b695c-131">不過，如果要求*未*獲授權，則`UrlAuthorizationModule`中止生命週期，並指示`Response`傳回的物件[HTTP 401 未經授權](http://www.checkupdown.com/status/E401.html)狀態。</span><span class="sxs-lookup"><span data-stu-id="b695c-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="b695c-132">使用表單驗證時此 HTTP 401 狀態永遠不傳回給用戶端因為如果`FormsAuthenticationModule`偵測到狀態是 HTTP 401 修改它[HTTP 302 重新導向](http://www.checkupdown.com/status/E302.html)登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="b695c-133">[圖 1] 說明的 ASP.NET 管線中的工作流程`FormsAuthenticationModule`，而`UrlAuthorizationModule`送達的未經授權的要求時。</span><span class="sxs-lookup"><span data-stu-id="b695c-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="b695c-134">特別是，[圖 1] 顯示匿名訪客要求`ProtectedPage.aspx`，這是給匿名使用者，拒絕存取的頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="b695c-135">造訪者是匿名的因為`UrlAuthorizationModule`中止要求，並傳回 HTTP 401 未經授權的狀態。</span><span class="sxs-lookup"><span data-stu-id="b695c-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="b695c-136">`FormsAuthenticationModule`然後 401 狀態轉換為 302 重新導向至登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="b695c-137">透過登入頁面會驗證使用者之後，他會重新導向至`ProtectedPage.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="b695c-138">這次`FormsAuthenticationModule`識別讓使用者根據其驗證票證。</span><span class="sxs-lookup"><span data-stu-id="b695c-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="b695c-139">既然已經過驗證的訪客，`UrlAuthorizationModule`允許存取該網頁。</span><span class="sxs-lookup"><span data-stu-id="b695c-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>

<span data-ttu-id="b695c-140">[![URL 授權工作流程與表單驗證](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span></span>

<span data-ttu-id="b695c-141">**圖 1**:URL 授權工作流程與表單驗證 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-vb/_static/image3.png))</span></span>

<span data-ttu-id="b695c-142">圖 1 說明匿名的造訪者嘗試存取不適用於匿名使用者的資源時，就會發生的互動。</span><span class="sxs-lookup"><span data-stu-id="b695c-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="b695c-143">在此情況下，會重新導向她嘗試瀏覽於 querystring 中指定頁面的 [登入] 頁面的匿名訪客。</span><span class="sxs-lookup"><span data-stu-id="b695c-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="b695c-144">使用者已成功登入之後，她將會自動重新導向回到她一開始嘗試檢視的資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="b695c-145">由匿名使用者進行未經授權的要求時，此工作流程非常簡單，很容易了解發生了什麼事的訪客和原因。</span><span class="sxs-lookup"><span data-stu-id="b695c-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="b695c-146">但請記住`FormsAuthenticationModule`將會重新導向*任何*未經授權的使用者登入 頁面中，即使已驗證的使用者提出要求。</span><span class="sxs-lookup"><span data-stu-id="b695c-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="b695c-147">如果已驗證的使用者嘗試瀏覽的頁面，讓她缺少授權單位，這可以導致令人困惑的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="b695c-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="b695c-148">想像我們的網站必須設定其 URL 授權規則，ASP.NET 網頁`OnlyTito.aspx`是順著只 Tito。</span><span class="sxs-lookup"><span data-stu-id="b695c-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="b695c-149">現在，想像一下 Sam 瀏覽網站、 登入，並再嘗試瀏覽`OnlyTito.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="b695c-150">`UrlAuthorizationModule`將會暫止要求的生命週期，並傳回 HTTP 401 未經授權的狀態，其中`FormsAuthenticationModule`會偵測並再將 Sam 重新導向至登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="b695c-151">由於 Sam 已登入，不過，她可能會想知道為什麼她已傳送到登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="b695c-152">她可能原因，她登入認證已遺失不知怎麼的或她輸入認證無效。</span><span class="sxs-lookup"><span data-stu-id="b695c-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="b695c-153">如果 Sam 成日自己的認證從登入頁面會 （再次） 登入她資料並重新導向至`OnlyTito.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="b695c-154">`UrlAuthorizationModule`會偵測 Sam 無法瀏覽此頁面，並將她將會傳回登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="b695c-155">圖 2 說明此令人困惑的工作流程。</span><span class="sxs-lookup"><span data-stu-id="b695c-155">Figure 2 depicts this confusing workflow.</span></span>

<span data-ttu-id="b695c-156">[![預設的工作流程可能會導致令人困惑的循環](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span></span>

<span data-ttu-id="b695c-157">**圖 2**:預設工作流程可能會導致令人困惑的循環 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-vb/_static/image6.png))</span></span>

<span data-ttu-id="b695c-158">[圖 2] 所示的工作流程可以快速 befuddle 即使大部分電腦精通訪客。</span><span class="sxs-lookup"><span data-stu-id="b695c-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="b695c-159">我們將探討如何防止這種混淆在步驟 2 中的循環。</span><span class="sxs-lookup"><span data-stu-id="b695c-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-160">ASP.NET 會使用兩種機制，判斷目前使用者是否可以存取特定網頁：URL 授權和檔案授權。</span><span class="sxs-lookup"><span data-stu-id="b695c-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="b695c-161">檔案授權由實作[ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx)，以決定授權單位 consulting 要求的檔案的 Acl。</span><span class="sxs-lookup"><span data-stu-id="b695c-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="b695c-162">檔案授權通常會用於使用 Windows 驗證，因為設定的 Acl 會套用到 Windows 帳戶的權限。</span><span class="sxs-lookup"><span data-stu-id="b695c-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="b695c-163">使用表單驗證時，所有的作業系統和檔案系統層級要求會執行相同的 Windows 帳戶，無論使用者瀏覽的網站。</span><span class="sxs-lookup"><span data-stu-id="b695c-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="b695c-164">因為本教學課程系列，著重於表單驗證，我們將不討論檔案授權。</span><span class="sxs-lookup"><span data-stu-id="b695c-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>

### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="b695c-165">URL 授權範圍</span><span class="sxs-lookup"><span data-stu-id="b695c-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="b695c-166">`UrlAuthorizationModule`是 managed 程式碼是在 ASP.NET 執行階段的一部分。</span><span class="sxs-lookup"><span data-stu-id="b695c-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="b695c-167">在 microsoft 的第 7 版之前[Internet Information Services (IIS)](https://www.iis.net/) web 伺服器沒有 IIS 的 HTTP 管線及 ASP.NET 執行階段的管線之間的相異屏障。</span><span class="sxs-lookup"><span data-stu-id="b695c-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="b695c-168">簡單地說，在 IIS 6 和更早版本，ASP。NET 的`UrlAuthorizationModule`只會要求從 IIS ASP.NET 執行階段委派時執行。</span><span class="sxs-lookup"><span data-stu-id="b695c-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="b695c-169">根據預設，IIS 處理像是 HTML 頁面和 CSS、 JavaScript 和影像檔-本身-靜態內容和才遞交給 ASP.NET 執行階段時使用的延伸模組頁面的要求`.aspx`， `.asmx`，或`.ashx`要求。</span><span class="sxs-lookup"><span data-stu-id="b695c-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="b695c-170">IIS 7 中，不過，用來整合的 IIS 和 ASP.NET 管線。</span><span class="sxs-lookup"><span data-stu-id="b695c-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="b695c-171">有一些組態設定中，您可以設定要叫用的 IIS 7 `UrlAuthorizationModule` for*所有*要求，這表示，可以定義任何類型的檔案的 URL 授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="b695c-172">此外，IIS 7 包含它自己的 URL 授權引擎。</span><span class="sxs-lookup"><span data-stu-id="b695c-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="b695c-173">如需有關整合 ASP.NET 和 IIS 7 的原生的 URL 授權功能的詳細資訊，請參閱[了解 IIS7 URL 授權](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)。</span><span class="sxs-lookup"><span data-stu-id="b695c-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="b695c-174">如 ASP.NET 和 IIS 7 的整合更深入探討，挑選 Shahram Khosravi 活頁簿，一份*Professional IIS 7 和 ASP.NET 整合式程式設計*(ISBN:978-0470152539).</span><span class="sxs-lookup"><span data-stu-id="b695c-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="b695c-175">簡單的說，在 IIS 7 之前的版本，URL 授權規則只適用於由 ASP.NET 執行階段的資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="b695c-176">但是，使用 IIS 7 就可以使用 IIS 的原生的 URL 授權功能或整合的 ASP。NET 的`UrlAuthorizationModule`至 IIS 的 HTTP 管線，藉此擴充這項功能的所有要求。</span><span class="sxs-lookup"><span data-stu-id="b695c-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-177">有一些細微但很重要的差異方式 ASP。NET 的`UrlAuthorizationModule`和 IIS 7 處理授權規則的 URL 授權功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="b695c-178">本教學課程不會檢查 IIS 7 的 URL 授權功能或它如何剖析相較於授權規則的差異`UrlAuthorizationModule`。</span><span class="sxs-lookup"><span data-stu-id="b695c-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="b695c-179">如需有關這些主題的詳細資訊，請參閱 MSDN 上或在 IIS 7 文件[www.iis.net](https://www.iis.net/)。</span><span class="sxs-lookup"><span data-stu-id="b695c-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>

## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="b695c-180">步驟 1：定義中的 URL 授權規則`Web.config`</span><span class="sxs-lookup"><span data-stu-id="b695c-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="b695c-181">`UrlAuthorizationModule`決定是否要授與或拒絕存取的應用程式的組態中定義的 URL 授權規則為基礎的特定身分識別要求的資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="b695c-182">授權規則會在拼[`<authorization>`項目](https://msdn.microsoft.com/library/8d82143t.aspx)的形式`<allow>`和`<deny>`子項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="b695c-183">每個`<allow>`和`<deny>`子項目可以指定：</span><span class="sxs-lookup"><span data-stu-id="b695c-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="b695c-184">特定使用者</span><span class="sxs-lookup"><span data-stu-id="b695c-184">A particular user</span></span>
- <span data-ttu-id="b695c-185">以逗號分隔的使用者清單</span><span class="sxs-lookup"><span data-stu-id="b695c-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="b695c-186">所有匿名使用者，表示由問號 （？）</span><span class="sxs-lookup"><span data-stu-id="b695c-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="b695c-187">以星號表示的所有使用者 (\*)</span><span class="sxs-lookup"><span data-stu-id="b695c-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="b695c-188">下列標記示範如何使用 URL 授權規則以允許使用者 Tito 和 Scott 並拒絕其他所有人：</span><span class="sxs-lookup"><span data-stu-id="b695c-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample1.xml)]

<span data-ttu-id="b695c-189">`<allow>`項目會定義哪些使用者可以-Tito 以及 Scott-雖然`<deny>`元素會指示所*所有*使用者被拒絕。</span><span class="sxs-lookup"><span data-stu-id="b695c-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-190">`<allow>`和`<deny>`項目也可以指定角色的授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="b695c-191">我們將檢視在未來的教學課程中的角色為基礎的授權。</span><span class="sxs-lookup"><span data-stu-id="b695c-191">We will examine role-based authorization in a future tutorial.</span></span>

<span data-ttu-id="b695c-192">下列設定會授與 Sam （包括匿名訪客） 以外的任何人的存取權：</span><span class="sxs-lookup"><span data-stu-id="b695c-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample2.xml)]

<span data-ttu-id="b695c-193">若要允許已驗證的使用者，請使用下列的設定中，拒絕所有匿名使用者的存取：</span><span class="sxs-lookup"><span data-stu-id="b695c-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample3.xml)]

<span data-ttu-id="b695c-194">授權規則定義內`<system.web>`中的項目`Web.config`並套用至所有 web 應用程式中的 ASP.NET 資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="b695c-195">有時候，應用程式會有不同的授權規則的不同區段。</span><span class="sxs-lookup"><span data-stu-id="b695c-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="b695c-196">比方說，在電子商務網站上，所有訪客可能產品閒時仔細研究，請參閱產品評論、 搜尋目錄，等等。</span><span class="sxs-lookup"><span data-stu-id="b695c-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="b695c-197">不過，只有已驗證的使用者可能會達到簽出或要管理其中的出貨歷程記錄的頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="b695c-198">此外，可能會有網站的僅供選取的使用者，例如站台系統管理員的部分。</span><span class="sxs-lookup"><span data-stu-id="b695c-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="b695c-199">ASP.NET 可讓您輕鬆地在網站定義不同的檔案和資料夾的不同的授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="b695c-200">指定根資料夾中的授權規則`Web.config`檔案將套用到站台中的所有 ASP.NET 資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="b695c-201">不過，這些預設授權設定可以覆寫特定的資料夾加`Web.config`與`<authorization>`一節。</span><span class="sxs-lookup"><span data-stu-id="b695c-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="b695c-202">讓我們更新我們的網站，讓只有經過驗證的使用者可以瀏覽中的 ASP.NET 網頁`Membership`資料夾。</span><span class="sxs-lookup"><span data-stu-id="b695c-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="b695c-203">若要這麼做我們需要加入`Web.config`檔案`Membership`資料夾並設定它拒絕匿名使用者的授權設定。</span><span class="sxs-lookup"><span data-stu-id="b695c-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="b695c-204">以滑鼠右鍵按一下`Membership`資料夾中的在 [方案總管] 中，從操作功能表中，選擇 [加入新項目] 功能表，然後加入新的 Web 組態檔，名為`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="b695c-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>

<span data-ttu-id="b695c-205">[![將 Web.config 檔案新增至 [成員資格] 資料夾](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span></span>

<span data-ttu-id="b695c-206">**圖 3**:新增`Web.config`的檔案`Membership`資料夾 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-vb/_static/image9.png))</span></span>

<span data-ttu-id="b695c-207">此時您的專案應該包含兩個`Web.config`檔案： 一個在目錄的根目錄，一個在`Membership`資料夾。</span><span class="sxs-lookup"><span data-stu-id="b695c-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>

<span data-ttu-id="b695c-208">[![您的應用程式現在應該包含兩個 Web.config 檔案](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span></span>

<span data-ttu-id="b695c-209">**圖 4**:您的應用程式應該現在包含兩個`Web.config`檔案 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-vb/_static/image12.png))</span></span>

<span data-ttu-id="b695c-210">更新組態檔中的`Membership`資料夾，讓它禁止匿名使用者的存取權。</span><span class="sxs-lookup"><span data-stu-id="b695c-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample4.xml)]

<span data-ttu-id="b695c-211">這樣就全部完成了！</span><span class="sxs-lookup"><span data-stu-id="b695c-211">That's all there is to it!</span></span>

<span data-ttu-id="b695c-212">若要測試這項變更，請瀏覽在瀏覽器首頁，請確定您登出。由於 ASP.NET 應用程式的預設行為是要讓所有的訪客，而且因為我們沒有製作根目錄的任何授權修改`Web.config`檔案中，我們就能夠瀏覽為匿名的訪客的根目錄中的檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="b695c-213">按一下左邊的資料行中找到的 [建立使用者帳戶] 連結。</span><span class="sxs-lookup"><span data-stu-id="b695c-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="b695c-214">這會帶您前往`~/Membership/CreatingUserAccounts.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="b695c-215">由於`Web.config`檔案中`Membership`資料夾定義的授權規則，以禁止匿名存取，`UrlAuthorizationModule`中止要求，並傳回 HTTP 401 未經授權的狀態。</span><span class="sxs-lookup"><span data-stu-id="b695c-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="b695c-216">`FormsAuthenticationModule`會加以修改以傳送給我們登入頁面 302 重新導向狀態。</span><span class="sxs-lookup"><span data-stu-id="b695c-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="b695c-217">請注意，頁面我們已嘗試存取 (`CreatingUserAccounts.aspx`) 傳遞至透過登入頁面`ReturnUrl`querystring 參數。</span><span class="sxs-lookup"><span data-stu-id="b695c-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>

<span data-ttu-id="b695c-218">[![URL 授權規則禁止匿名存取，因為我們會被重新導向至登入頁面](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span></span>

<span data-ttu-id="b695c-219">**圖 5**:URL 授權規則禁止匿名存取，因為我們會被重新導向至登入頁面 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-vb/_static/image15.png))</span></span>

<span data-ttu-id="b695c-220">在成功登入時，我們會重新導向至`CreatingUserAccounts.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="b695c-221">這次`UrlAuthorizationModule`允許存取該網頁，因為我們不會再為匿名。</span><span class="sxs-lookup"><span data-stu-id="b695c-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="b695c-222">套用至特定位置的 URL 授權規則</span><span class="sxs-lookup"><span data-stu-id="b695c-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="b695c-223">中定義的授權設定`<system.web>`一節`Web.config`套用至該目錄及其子目錄中的 ASP.NET 資源的所有 (否則覆寫另一個直到`Web.config`檔案)。</span><span class="sxs-lookup"><span data-stu-id="b695c-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="b695c-224">不過，在某些情況下，我們可能想要有特定的授權設定，除了一個或兩個特定的頁面指定目錄中的所有 ASP.NET 資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="b695c-225">這可藉由新增`<location>`中的項目`Web.config`指向不同的授權規則，該檔案，其中定義其唯一的授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="b695c-226">若要說明如何使用`<location>`若要覆寫特定資源的組態設定，讓我們自訂的授權設定，以便只 Tito 可以瀏覽的項目`CreatingUserAccounts.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="b695c-227">若要達成此目的，新增`<location>`項目`Membership`資料夾的`Web.config`檔案並更新其標記，使它看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="b695c-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample5.xml)]

<span data-ttu-id="b695c-228">`<authorization>`中的項目`<system.web>`定義中的 ASP.NET 資源的預設 URL 授權規則`Membership`資料夾及其子資料夾。</span><span class="sxs-lookup"><span data-stu-id="b695c-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="b695c-229">`<location>`項目可讓我們來覆寫這些規則的特定資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="b695c-230">在上述的標記`<location>`項目參考`CreatingUserAccounts.aspx`頁面上，並指定其授權規則，例如允許 Tito，但拒絕其他所有人。</span><span class="sxs-lookup"><span data-stu-id="b695c-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="b695c-231">若要測試這項授權變更，先瀏覽的網站為匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="b695c-232">如果您嘗試瀏覽中的任何頁面`Membership`資料夾，例如`UserBasedAuthorization.aspx`，則`UrlAuthorizationModule`將拒絕要求，您將會被重新導向至登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="b695c-233">為說 Scott，登入之後，您可以造訪中的任何網頁`Membership`資料夾*除了*如`CreatingUserAccounts.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="b695c-234">嘗試瀏覽`CreatingUserAccounts.aspx`登入的任何人但 Tito 將會導致未經授權的存取嘗試，將您重新導向回到登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-235">`<location>`項目必須出現在組態之外`<system.web>`項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="b695c-236">您必須使用個別`<location>`針對您想要覆寫其授權設定每個資源的項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>

### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="b695c-237">了解如何`UrlAuthorizationModule`使用授權規則授與或拒絕存取</span><span class="sxs-lookup"><span data-stu-id="b695c-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="b695c-238">`UrlAuthorizationModule`決定是否要為特定的 URL 授權特定的身分識別，藉由分析 URL 授權規則一次一個，從第一個啟動並開始一路往下。</span><span class="sxs-lookup"><span data-stu-id="b695c-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="b695c-239">只要找到相符項目，使用者會授與或拒絕存取，視在找到相符項`<allow>`或`<deny>`項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="b695c-240"><strong>如果找到相符項目，則使用者會獲得存取。</strong></span><span class="sxs-lookup"><span data-stu-id="b695c-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="b695c-241">因此，如果您想要限制存取，因此務必您使用`<deny>`URL 授權組態中的最後一個元素的項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="b695c-242"><strong>如果您省略</strong><strong>`<deny>`</strong><strong>項目中，所有使用者會都獲授與存取權。</strong></span><span class="sxs-lookup"><span data-stu-id="b695c-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="b695c-243">若要深入了解所使用的程序`UrlAuthorizationModule`我們稍早在此步驟中討論過的 URL 授權規則時判斷授權單位，請考量的範例。</span><span class="sxs-lookup"><span data-stu-id="b695c-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="b695c-244">第一個規則是`<allow>`允許存取 Tito 與 Scott 的項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="b695c-245">第二個規則是`<deny>`每個人都拒絕存取的項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="b695c-246">如果匿名使用者造訪，`UrlAuthorizationModule`是匿名的要求，啟動 Scott 或 Tito 嗎？</span><span class="sxs-lookup"><span data-stu-id="b695c-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="b695c-247">答案很明顯地，為 [否]，讓它繼續進行第二個規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="b695c-248">是匿名的在集中的每個人嗎？</span><span class="sxs-lookup"><span data-stu-id="b695c-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="b695c-249">因為答案以下是 [是]，`<deny>`作用中放入規則，並造訪者會重新導向至登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="b695c-250">同樣地，如果 Jisun 就瀏覽，`UrlAuthorizationModule`一開始會詢問您，是 Jisun Scott 或 Tito 嗎？</span><span class="sxs-lookup"><span data-stu-id="b695c-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="b695c-251">因為她是不是，`UrlAuthorizationModule`繼續進行第二個問題，是在集中的每個人的 Jisun 嗎？</span><span class="sxs-lookup"><span data-stu-id="b695c-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="b695c-252">她是，因此，也就無法存取。</span><span class="sxs-lookup"><span data-stu-id="b695c-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="b695c-253">最後，如果 Tito 造訪時，第一個問題所造成`UrlAuthorizationModule`是確定的回應，因此 Tito 授與存取權。</span><span class="sxs-lookup"><span data-stu-id="b695c-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="b695c-254">因為`UrlAuthorizationModule`授權規則從上而下，停止在任何相符項目，就一定要有更特定的規則前面較不特定的處理程序。</span><span class="sxs-lookup"><span data-stu-id="b695c-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="b695c-255">亦即，若要定義禁止 Jisun 和匿名使用者，但允許所有其他已驗證的使用者的授權規則，您會開始使用最明確的規則-一個影響 Jisun-，然後繼續進行較不特定的規則-允許所有其他的已驗證的使用者，但拒絕所有匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="b695c-256">下列的 URL 授權規則實作此原則的方式，先拒絕 Jisun，，然後再拒絕任何匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="b695c-257">Jisun 以外的任何已驗證的使用者會獲授與存取權因為都`<deny>`陳述式會比對。</span><span class="sxs-lookup"><span data-stu-id="b695c-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="b695c-258">步驟 2：修正未核准、 已驗證使用者的工作流程</span><span class="sxs-lookup"><span data-stu-id="b695c-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="b695c-259">如我們稍早在本教學課程中查看的 URL 授權工作流程 」 一節中所討論的隨時瓿未經授權的要求，`UrlAuthorizationModule`中止要求，並傳回 HTTP 401 未經授權的狀態。</span><span class="sxs-lookup"><span data-stu-id="b695c-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="b695c-260">修改此 401 狀態`FormsAuthenticationModule`到 302 重新導向至登入頁面會將使用者的狀態。</span><span class="sxs-lookup"><span data-stu-id="b695c-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="b695c-261">即使使用者經過驗證，此工作流程就會發生任何未經授權的要求。</span><span class="sxs-lookup"><span data-stu-id="b695c-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="b695c-262">可能將它們搞混，因為他們已經登入，系統會傳回已驗證的使用者登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="b695c-263">加上一些工作的我們可以改善此工作流程重新導向到頁面，其中說明他們已嘗試存取受限制的頁面進行未經授權的要求已驗證的使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="b695c-264">名為 web 應用程式的根資料夾中建立新的 ASP.NET 網頁著手`UnauthorizedAccess.aspx`; 別忘了將使用此頁面`Site.master`主版頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="b695c-265">建立此頁面之後, 移除參考的內容控制項`LoginContent`ContentPlaceHolder 以便主版頁面的預設內容將會顯示。</span><span class="sxs-lookup"><span data-stu-id="b695c-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="b695c-266">接下來，新增訊息，說明這種情況，也就是使用者嘗試存取受保護的資源。</span><span class="sxs-lookup"><span data-stu-id="b695c-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="b695c-267">新增這類訊息之後`UnauthorizedAccess.aspx`頁面的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="b695c-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample7.aspx)]

<span data-ttu-id="b695c-268">我們現在需要變更工作流程，因此，如果已驗證的使用者執行未經授權的要求，則會傳送至`UnauthorizedAccess.aspx`頁面而不是登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="b695c-269">將未經授權的要求重新導向至登入頁面的邏輯內嵌在私用方法的`FormsAuthenticationModule`類別中，因此我們無法自訂此行為。</span><span class="sxs-lookup"><span data-stu-id="b695c-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="b695c-270">我們可以做什麼，不過，若要將使用者重新導向的登入頁面加入我們自己的邏輯是`UnauthorizedAccess.aspx`，如有需要。</span><span class="sxs-lookup"><span data-stu-id="b695c-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="b695c-271">當`FormsAuthenticationModule`未經授權的訪客會將重新導向至登入頁面附加至查詢字串名稱的要求、 未經授權的 URL `ReturnUrl`。</span><span class="sxs-lookup"><span data-stu-id="b695c-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="b695c-272">例如，如果未經授權的使用者嘗試瀏覽`OnlyTito.aspx`，則`FormsAuthenticationModule`會將他們重新導向至`Login.aspx?ReturnUrl=OnlyTito.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="b695c-273">因此，如果查詢字串，其中包含與已驗證的使用者登入頁面會觸達`ReturnUrl`參數，則我們知道此未經驗證的使用者只嘗試來瀏覽的網頁，她未獲授權檢視。</span><span class="sxs-lookup"><span data-stu-id="b695c-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="b695c-274">在此情況下，我們想要重新導向她`UnauthorizedAccess.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="b695c-275">若要這麼做，將下列程式碼新增至登入頁面的`Page_Load`事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="b695c-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample8.vb)]

<span data-ttu-id="b695c-276">上述程式碼會將已驗證、 未經授權的使用者重新導向`UnauthorizedAccess.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="b695c-277">若要查看作用中的此邏輯，請瀏覽網站的匿名訪客並按一下左側的資料行中的 [建立使用者帳戶] 連結。</span><span class="sxs-lookup"><span data-stu-id="b695c-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="b695c-278">這會帶您前往`~/Membership/CreatingUserAccounts.aspx`頁面，其中在步驟 1 中我們設定為僅允許 Tito 存取。</span><span class="sxs-lookup"><span data-stu-id="b695c-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="b695c-279">因為匿名使用者被禁止，`FormsAuthenticationModule`將我們重新導向回到登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="b695c-280">此時我們是匿名的因此`Request.IsAuthenticated`會傳回`False`與我們未重新導向至`UnauthorizedAccess.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `False` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="b695c-281">相反地，登入頁面隨即出現。</span><span class="sxs-lookup"><span data-stu-id="b695c-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="b695c-282">Tito，例如 Bruce 以外的使用者身分登入。</span><span class="sxs-lookup"><span data-stu-id="b695c-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="b695c-283">輸入適當的認證之後, 的登入網頁我們回到的重新導向`~/Membership/CreatingUserAccounts.aspx`。</span><span class="sxs-lookup"><span data-stu-id="b695c-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="b695c-284">不過，此頁面才可存取 Tito，因為我們未經授權檢視它，並會立即傳回登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="b695c-285">這次，不過，`Request.IsAuthenticated`會傳回`True`(並`ReturnUrl`querystring 參數存在)，因此我們會重新導向至`UnauthorizedAccess.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-285">This time, however, `Request.IsAuthenticated` returns `True` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>

<span data-ttu-id="b695c-286">[![通過驗證，未經授權的使用者重新導向至 UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span></span>

<span data-ttu-id="b695c-287">**圖 6**:通過驗證，未經授權的使用者重新導向至`UnauthorizedAccess.aspx`([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-vb/_static/image18.png))</span></span>

<span data-ttu-id="b695c-288">這個自訂的工作流程會縮短 圖 2 所述的循環，以呈現更合理且簡單的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="b695c-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="b695c-289">步驟 3：限制目前登入使用者為基礎的功能</span><span class="sxs-lookup"><span data-stu-id="b695c-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="b695c-290">URL 授權可讓您輕鬆地指定粗略的授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="b695c-291">如我們所見在步驟 1 中，使用 URL 授權我們可以簡潔狀態允許哪些身分識別，以及哪些拒絕檢視資料夾中的特定頁面或所有頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="b695c-292">在某些情況下，不過，我們可能會想要允許所有使用者，請瀏覽 頁面上，但限制瀏覽它的使用者為基礎的網頁的功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="b695c-293">請考慮電子商務網站，可讓已驗證的訪客，若要檢閱其產品的情況。</span><span class="sxs-lookup"><span data-stu-id="b695c-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="b695c-294">當匿名使用者造訪的產品 頁面上時，他們會看到的產品資訊，並不會提供機會讓發表評論。</span><span class="sxs-lookup"><span data-stu-id="b695c-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="b695c-295">不過，瀏覽相同的頁面已驗證的使用者會看到檢閱的介面。</span><span class="sxs-lookup"><span data-stu-id="b695c-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="b695c-296">如果已驗證的使用者有尚未檢閱這項產品，介面會讓它們能夠送出檢閱;否則，它會顯示它們其先前提交檢閱。</span><span class="sxs-lookup"><span data-stu-id="b695c-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="b695c-297">若要採取這種情況下步驟此外，[產品] 頁面可能會顯示其他資訊，提供適用於電子商務公司的使用者擴充的功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="b695c-298">比方說，產品頁面可能會列出庫存清查，並包含編輯產品的價格和描述，當某員工瀏覽的選項。</span><span class="sxs-lookup"><span data-stu-id="b695c-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="b695c-299">可以實作這類精細的幅度授權規則，是以宣告方式或透過程式設計方式 （或兩者的某種組合）。</span><span class="sxs-lookup"><span data-stu-id="b695c-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="b695c-300">下一節中，我們將了解如何實作透過 LoginView 控制項的微調授權。</span><span class="sxs-lookup"><span data-stu-id="b695c-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="b695c-301">接下來，我們將探討程式設計技術。</span><span class="sxs-lookup"><span data-stu-id="b695c-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="b695c-302">我們來看看套用微調授權規則之前，不過，我們必須先建立的頁面，其功能取決於使用者瀏覽它。</span><span class="sxs-lookup"><span data-stu-id="b695c-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="b695c-303">讓我們建立頁面，其中列出 GridView 內的特定目錄中的檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="b695c-304">GridView 會列出每個檔案的名稱、 大小和其他資訊，以及包含 Linkbutton 的兩個資料行： 其中一個標題為檢視和一個標題為的刪除。</span><span class="sxs-lookup"><span data-stu-id="b695c-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="b695c-305">如果檢視 LinkButton 已按下，將會顯示所選檔案的內容;如果刪除 LinkButton 已按下，就會刪除檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="b695c-306">讓我們一開始建立，此頁面使其檢視和刪除功能可供所有使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="b695c-307">< 使用 LoginView 控制項和以程式設計的方式限制功能章節我們將了解如何啟用或停用這些功能，以瀏覽頁面的使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-308">我們即將建置的 ASP.NET 網頁會使用 GridView 控制項來顯示檔案清單。</span><span class="sxs-lookup"><span data-stu-id="b695c-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="b695c-309">本教學課程中 > 系列聚焦於表單驗證、 授權、 使用者帳戶和角色，因為我不想花太多時間討論 GridView 控制項的內部運作方式。</span><span class="sxs-lookup"><span data-stu-id="b695c-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="b695c-310">雖然本教學課程提供特定的逐步指示，設定此頁面，它不會不探討為什麼做特定選擇，或轉譯的輸出上有的效果的特定屬性的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="b695c-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="b695c-311">如 GridView 控制項徹底的檢查，請參閱我 *[使用 ASP.NET 2.0 中的資料](../../data-access/index.md)* 教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="b695c-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="b695c-312">首先開啟`UserBasedAuthorization.aspx`檔案中`Membership`資料夾，然後將 GridView 控制項新增至名為頁面`FilesGrid`。</span><span class="sxs-lookup"><span data-stu-id="b695c-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="b695c-313">從 GridView 的智慧標籤上，按一下 編輯資料行連結以啟動 欄位 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="b695c-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="b695c-314">從這裡開始，取消核取自動產生欄位核取方塊左下角。</span><span class="sxs-lookup"><span data-stu-id="b695c-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="b695c-315">接下來，新增 選取 按鈕、 刪除 按鈕和兩個 BoundFields 從左上角 （CommandField 類型之下可以找到 選取和刪除按鈕）。</span><span class="sxs-lookup"><span data-stu-id="b695c-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="b695c-316">設定 [選取] 按鈕`SelectText`屬性，以檢視與第一個的 BoundField`HeaderText`和`DataField`屬性名稱。</span><span class="sxs-lookup"><span data-stu-id="b695c-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="b695c-317">設定第二個的 BoundField`HeaderText`屬性，以位元組為單位的大小及其`DataField`屬性的長度，以其`DataFormatString`屬性設{0:N0}及其`HtmlEncode`屬性設定為 False。</span><span class="sxs-lookup"><span data-stu-id="b695c-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="b695c-318">設定 GridView 的資料行之後, 按一下 [確定] 關閉 [欄位] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="b695c-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="b695c-319">從 [屬性] 視窗中，設定 GridView`DataKeyNames`屬性設`FullName`。</span><span class="sxs-lookup"><span data-stu-id="b695c-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="b695c-320">此時 GridView 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="b695c-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample9.aspx)]

<span data-ttu-id="b695c-321">使用 GridView 的標記建立，我們可以撰寫的程式碼會擷取特定的目錄中的檔案，並將其繫結至 GridView。</span><span class="sxs-lookup"><span data-stu-id="b695c-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="b695c-322">將下列程式碼新增至網頁的`Page_Load`事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="b695c-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample10.vb)]

<span data-ttu-id="b695c-323">上述程式碼會使用[`DirectoryInfo`類別](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx)取得一份應用程式的根資料夾中的檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="b695c-324">[ `GetFiles()`方法](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx)傳回的所有檔案的目錄中，為陣列[`FileInfo`物件](https://msdn.microsoft.com/library/system.io.fileinfo.aspx)，它會接著繫結至 GridView。</span><span class="sxs-lookup"><span data-stu-id="b695c-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="b695c-325">`FileInfo`物件具有各種屬性，例如`Name`， `Length`，和`IsReadOnly`，其他項目。</span><span class="sxs-lookup"><span data-stu-id="b695c-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="b695c-326">如您所見，從其宣告的標記，只顯示 GridView`Name`和`Length`屬性。</span><span class="sxs-lookup"><span data-stu-id="b695c-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-327">`DirectoryInfo`並`FileInfo`類別位於[`System.IO`命名空間](https://msdn.microsoft.com/library/system.io.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b695c-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="b695c-328">因此，您將其命名空間名稱使用這些類別名稱前加上或匯入的類別檔案的命名空間需要 (透過`Imports System.IO`)。</span><span class="sxs-lookup"><span data-stu-id="b695c-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `Imports System.IO`).</span></span>

<span data-ttu-id="b695c-329">請花一點時間瀏覽此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="b695c-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="b695c-330">它會顯示位於應用程式的根目錄中檔案的清單。</span><span class="sxs-lookup"><span data-stu-id="b695c-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="b695c-331">按一下 檢視 或 刪除的 Linkbutton 的任何會導致回傳，但會發生任何動作，因為我們至今還建立必要的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="b695c-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>

<span data-ttu-id="b695c-332">[![GridView 列出 Web 應用程式的根目錄中的檔案](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span></span>

<span data-ttu-id="b695c-333">**圖 7**:GridView 列出 Web 應用程式的根目錄中的檔案 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-vb/_static/image21.png))</span></span>

<span data-ttu-id="b695c-334">我們需要一個方法來顯示所選檔案的內容。</span><span class="sxs-lookup"><span data-stu-id="b695c-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="b695c-335">返回 Visual Studio，並新增名為 TextBox `FileContents` GridView 上方。</span><span class="sxs-lookup"><span data-stu-id="b695c-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="b695c-336">設定其`TextMode`屬性，以`MultiLine`及其`Columns`和`Rows`屬性到 95%和 10，分別。</span><span class="sxs-lookup"><span data-stu-id="b695c-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample11.aspx)]

<span data-ttu-id="b695c-337">接下來，建立事件處理常式，如 GridView [ `SelectedIndexChanged`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx)並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="b695c-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample12.vb)]

<span data-ttu-id="b695c-338">此程式碼使用 GridView 的`SelectedValue`屬性來判斷所選檔案的完整檔案名稱。</span><span class="sxs-lookup"><span data-stu-id="b695c-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="b695c-339">就內部而言，`DataKeys`以取得參考集合`SelectedValue`，因此請務必設定 GridView 的`DataKeyNames`屬性名稱，如稍早在此步驟中所述。</span><span class="sxs-lookup"><span data-stu-id="b695c-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="b695c-340">[ `File`類別](https://msdn.microsoft.com/library/system.io.file.aspx)用來選取的檔案內容讀取到字串，然後指派給`FileContents`TextBox 的`Text`屬性，藉此顯示的頁面上選取的檔案內容。</span><span class="sxs-lookup"><span data-stu-id="b695c-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>

<span data-ttu-id="b695c-341">[![會出現在文字方塊中選取之檔案的內容](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span></span>

<span data-ttu-id="b695c-342">**圖 8**:選取之檔案的內容會顯示在文字方塊中 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-vb/_static/image24.png))</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-343">如果您檢視檔案，其中包含 HTML 標記的內容，並再嘗試檢視或刪除檔案，您會收到`HttpRequestValidationException`時發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="b695c-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="b695c-344">會發生這種情況是因為在回傳文字方塊的內容會傳送至 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="b695c-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="b695c-345">根據預設，ASP.NET 會引發`HttpRequestValidationException`每當有潛在危險的回傳內容，例如 HTML 標記，偵測到的錯誤。</span><span class="sxs-lookup"><span data-stu-id="b695c-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="b695c-346">若要停用這項錯誤發生，請關閉要求驗證頁面加上`ValidateRequest="false"`至`@Page`指示詞。</span><span class="sxs-lookup"><span data-stu-id="b695c-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="b695c-347">如需詳細資訊，以及以何種預防措施，您應該採取時的要求驗證的 「 優點先停用，讀取[要求驗證-防止指令碼攻擊](https://asp.net/learn/whitepapers/request-validation/)。</span><span class="sxs-lookup"><span data-stu-id="b695c-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>

<span data-ttu-id="b695c-348">最後，新增 GridView 的事件處理常式的下列程式碼[`RowDeleting`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="b695c-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample13.vb)]

<span data-ttu-id="b695c-349">程式碼只會顯示要刪除之檔案的完整名稱`FileContents`TextBox*而不需要*實際刪除該檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>

<span data-ttu-id="b695c-350">[![按一下 [刪除] 按鈕並不會實際刪除檔案](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span></span>

<span data-ttu-id="b695c-351">**圖 9**:按一下刪除按鈕不會實際刪除的檔案 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-vb/_static/image27.png))</span></span>

<span data-ttu-id="b695c-352">在步驟 1 中，我們設定 URL 授權規則，來禁止從檢視中的頁面的匿名使用者`Membership`資料夾。</span><span class="sxs-lookup"><span data-stu-id="b695c-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="b695c-353">若要進一步展現微調驗證，讓我們來允許匿名使用者造訪`UserBasedAuthorization.aspx` 頁面上，但功能受限。</span><span class="sxs-lookup"><span data-stu-id="b695c-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="b695c-354">若要開啟此頁面的所有使用者存取，新增下列`<location>`項目`Web.config`檔案中`Membership`資料夾：</span><span class="sxs-lookup"><span data-stu-id="b695c-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample14.xml)]

<span data-ttu-id="b695c-355">新增這項之後`<location>`項目，從站台的記錄，以測試新的 URL 授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="b695c-356">為匿名使用者應該允許前往`UserBasedAuthorization.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="b695c-357">目前，任何已驗證或匿名使用者可以瀏覽`UserBasedAuthorization.aspx`頁面並檢視或刪除檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="b695c-358">讓它，讓只有經過驗證的使用者可以檢視檔案的內容，並只 Tito 才能刪除檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="b695c-359">可以套用這類精細的幅度授權規則，以宣告方式，透過程式設計方式，或這兩種方法的組合。</span><span class="sxs-lookup"><span data-stu-id="b695c-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="b695c-360">讓我們來限制誰可以檢視檔案; 的內容中使用宣告式方法我們將使用以程式設計的方式，才能刪除檔案的限制。</span><span class="sxs-lookup"><span data-stu-id="b695c-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="b695c-361">使用 LoginView 控制項</span><span class="sxs-lookup"><span data-stu-id="b695c-361">Using the LoginView Control</span></span>

<span data-ttu-id="b695c-362">因為我們在過去的教學課程中所見，LoginView 控制項適用於顯示不同的介面，針對已驗證和匿名使用者，並提供簡單的方式，來隱藏不是可供匿名使用者存取的功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="b695c-363">因為匿名使用者無法檢視或刪除檔案，我們只需要顯示`FileContents`文字方塊中，當已驗證的使用者瀏覽頁面時。</span><span class="sxs-lookup"><span data-stu-id="b695c-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="b695c-364">若要這麼做，請將 LoginView 控制項加入頁面，將其命名`LoginViewForFileContentsTextBox`，並移動`FileContents`LoginView 控制項的文字方塊中的宣告式標記`LoggedInTemplate`。</span><span class="sxs-lookup"><span data-stu-id="b695c-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample15.aspx)]

<span data-ttu-id="b695c-365">LoginView 的範本中的 Web 控制項不再直接從程式碼後置類別存取。</span><span class="sxs-lookup"><span data-stu-id="b695c-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="b695c-366">比方說， `FilesGrid` GridView 的`SelectedIndexChanged`並`RowDeleting`事件處理常式目前參考`FileContents`喜歡使用程式碼的 TextBox 控制項：</span><span class="sxs-lookup"><span data-stu-id="b695c-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample16.aspx)]

<span data-ttu-id="b695c-367">不過，此程式碼不再有效。</span><span class="sxs-lookup"><span data-stu-id="b695c-367">However, this code is no longer valid.</span></span> <span data-ttu-id="b695c-368">藉由移動`FileContents`到 TextBox`LoggedInTemplate`文字方塊無法直接存取。</span><span class="sxs-lookup"><span data-stu-id="b695c-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="b695c-369">相反地，我們必須使用`FindControl("controlId")`方法來以程式設計方式參考的控制項。</span><span class="sxs-lookup"><span data-stu-id="b695c-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="b695c-370">更新`FilesGrid`事件處理常式，以參考文字方塊就像這樣：</span><span class="sxs-lookup"><span data-stu-id="b695c-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample17.vb)]

<span data-ttu-id="b695c-371">之後將文字方塊移至 LoginView`LoggedInTemplate`和更新網頁的程式碼參考文字方塊使用`FindControl("controlId")`模式中，瀏覽的頁面為匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="b695c-372">如 [圖 10] 所示，`FileContents`則不會顯示文字方塊。</span><span class="sxs-lookup"><span data-stu-id="b695c-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="b695c-373">不過，仍會顯示檢視 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="b695c-373">However, the View LinkButton is still displayed.</span></span>

<span data-ttu-id="b695c-374">[![LoginView 控制項只會呈現 FileContents 文字方塊中，已驗證的使用者](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span></span>

<span data-ttu-id="b695c-375">**圖 10**:LoginView 控制項只會呈現`FileContents`文字方塊中已驗證的使用者 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-vb/_static/image30.png))</span></span>

<span data-ttu-id="b695c-376">一種隱藏匿名使用者的 [檢視] 按鈕的方式是將 GridView 欄位轉換為 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="b695c-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="b695c-377">這會產生包含檢視 LinkButton 的宣告式標記的範本。</span><span class="sxs-lookup"><span data-stu-id="b695c-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="b695c-378">我們可以加入 TemplateField LoginView 控制項並放置在 LoginView LinkButton `LoggedInTemplate`，藉此隱藏之匿名訪客的 [檢視] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="b695c-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="b695c-379">若要這麼做，按一下 GridView 的智慧標籤，以啟動 [欄位] 對話方塊中的 [編輯資料行] 連結。</span><span class="sxs-lookup"><span data-stu-id="b695c-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="b695c-380">接下來，從左下角中的清單中選取 選取 按鈕，然後按一下 轉換為 TemplateField 連結此欄位。</span><span class="sxs-lookup"><span data-stu-id="b695c-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="b695c-381">如此一來，將會修改欄位的宣告式標記的來源：</span><span class="sxs-lookup"><span data-stu-id="b695c-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample18.aspx)]

 <span data-ttu-id="b695c-382">收件者:</span><span class="sxs-lookup"><span data-stu-id="b695c-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample19.aspx)]

 <span data-ttu-id="b695c-383">到目前為止，我們可以將 LoginView 加入 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="b695c-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="b695c-384">下列標記會顯示檢視 LinkButton 僅適用於已驗證的使用者。</span><span class="sxs-lookup"><span data-stu-id="b695c-384">The following markup displays the View LinkButton only for authenticated users.</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample20.aspx)]

<span data-ttu-id="b695c-385">如 [圖 11] 所示，最終結果不是，很與檢視資料行仍會顯示即使隱藏的資料行中檢視 Linkbutton。</span><span class="sxs-lookup"><span data-stu-id="b695c-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="b695c-386">我們將探討如何隱藏整個的 GridView 資料行 （和不只是 LinkButton） 下, 一節。</span><span class="sxs-lookup"><span data-stu-id="b695c-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>

<span data-ttu-id="b695c-387">[![LoginView 控制項隱藏檢視 Linkbutton 匿名訪客](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span></span>

<span data-ttu-id="b695c-388">**圖 11**:LoginView 控制項隱藏檢視 Linkbutton 匿名訪客 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-vb/_static/image33.png))</span></span>

### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="b695c-389">以程式設計的方式限制功能</span><span class="sxs-lookup"><span data-stu-id="b695c-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="b695c-390">在某些情況下，宣告式技巧會不足，無法限制至頁面的功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="b695c-391">例如，某些頁面功能的可用性可能相依於超出使用者瀏覽頁面是否為匿名或已驗證的準則。</span><span class="sxs-lookup"><span data-stu-id="b695c-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="b695c-392">在此情況下，各種使用者介面項目可以顯示或隱藏透過程式設計的方式。</span><span class="sxs-lookup"><span data-stu-id="b695c-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="b695c-393">若要以程式設計的方式限制功能，我們必須執行兩項工作：</span><span class="sxs-lookup"><span data-stu-id="b695c-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="b695c-394">判斷瀏覽頁面的使用者是否可以存取這些功能，以及</span><span class="sxs-lookup"><span data-stu-id="b695c-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="b695c-395">以程式設計方式修改根據使用者是否能夠存取的功能有問題的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="b695c-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="b695c-396">為了示範這兩項工作的應用程式，讓我們只允許 Tito GridView 從刪除檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="b695c-397">然後，我們第一項工作，是判斷它是否為 Tito 瀏覽的頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="b695c-398">之後，已判斷出，我們要隱藏 （或顯示） GridView 的刪除資料行。</span><span class="sxs-lookup"><span data-stu-id="b695c-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="b695c-399">GridView 資料行是可透過存取其`Columns`屬性; 如果資料行只會呈現其`Visible`屬性設定為`True`（預設值）。</span><span class="sxs-lookup"><span data-stu-id="b695c-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `True` (the default).</span></span>

<span data-ttu-id="b695c-400">將下列程式碼加入`Page_Load`之前將資料繫結至 GridView 的事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="b695c-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample21.vb)]

<span data-ttu-id="b695c-401">如我們所述[*的表單驗證概觀*](../introduction/an-overview-of-forms-authentication-vb.md)教學課程中，`User.Identity.Name`傳回身分識別的名稱。</span><span class="sxs-lookup"><span data-stu-id="b695c-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="b695c-402">這會對應至登入控制項中輸入的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="b695c-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="b695c-403">如果它是 Tito 瀏覽網頁，GridView 的第二個資料行的`Visible`屬性設定為`True`; 否則設定為`False`。</span><span class="sxs-lookup"><span data-stu-id="b695c-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `True`; otherwise, it is set to `False`.</span></span> <span data-ttu-id="b695c-404">最後結果就是，當 Tito 以外的其他人造訪的頁面上，另一個已驗證的使用者或匿名使用者，刪除資料行則不會呈現 （請參閱 圖 12）;不過，當 Tito 造訪網頁時，刪除資料行已存在 （請參閱 圖 13）。</span><span class="sxs-lookup"><span data-stu-id="b695c-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>

<span data-ttu-id="b695c-405">[![刪除資料行是不呈現時瀏覽過的人以外 Tito （例如 Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span></span>

<span data-ttu-id="b695c-406">**圖 12**:刪除資料行是不呈現時瀏覽過的人以外 Tito （例如 Bruce) ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-vb/_static/image36.png))</span></span>

<span data-ttu-id="b695c-407">[![刪除資料行呈現 Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-407">[![The Delete Column is Rendered for Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span></span>

<span data-ttu-id="b695c-408">**圖 13**:刪除資料行呈現 Tito ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-vb/_static/image39.png))</span></span>

## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="b695c-409">步驟 4：將授權規則套用至類別和方法</span><span class="sxs-lookup"><span data-stu-id="b695c-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="b695c-410">在步驟 3 中我們不允許匿名使用者無法檢視檔案的內容，並禁止所有使用者，但 Tito 刪除檔案。</span><span class="sxs-lookup"><span data-stu-id="b695c-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="b695c-411">這是藉由隱藏相關聯的使用者介面項目給未經授權的訪客，透過宣告式和程式設計技術來達成。</span><span class="sxs-lookup"><span data-stu-id="b695c-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="b695c-412">簡單範例中，適當地隱藏使用者介面項目已直接了當，但什麼是更複雜的網站可能是許多不同的方式來執行相同的功能嗎？</span><span class="sxs-lookup"><span data-stu-id="b695c-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="b695c-413">限制使用該功能以未經授權的使用者，萬一我們忘了隱藏或停用所有適用的使用者介面項目怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="b695c-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="b695c-414">簡單的方法，以確保未經授權的使用者無法存取特定的一種功能是該類別或方法的裝飾[`PrincipalPermission`屬性](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b695c-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="b695c-415">當.NET 執行階段會使用的類別，或執行其中一個方法時，它會檢查以確保目前的安全性內容有使用該類別或執行方法的權限。</span><span class="sxs-lookup"><span data-stu-id="b695c-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="b695c-416">`PrincipalPermission`屬性提供一個機制，讓我們可以定義這些規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="b695c-417">讓我們將示範如何使用`PrincipalPermission`屬性上的 GridView`SelectedIndexChanged`和`RowDeleting`分別禁止匿名使用者和 Tito，以外的使用者所執行的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="b695c-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="b695c-418">我們要做的只是新增在每個函式定義適當的屬性：</span><span class="sxs-lookup"><span data-stu-id="b695c-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample22.vb)]

<span data-ttu-id="b695c-419">屬性`SelectedIndexChanged`事件處理常式指定只有經過驗證的使用者可以執行的事件處理常式中，在做為屬性`RowDeleting`事件處理常式會限制 Tito 執行。</span><span class="sxs-lookup"><span data-stu-id="b695c-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-420">屬性可以套用至類別、 方法、 屬性或事件。</span><span class="sxs-lookup"><span data-stu-id="b695c-420">An attribute can be applied to a class, method, property, or event.</span></span> <span data-ttu-id="b695c-421">時新增的屬性，它必須是類別、 方法、 屬性或事件宣告陳述式的一部分。</span><span class="sxs-lookup"><span data-stu-id="b695c-421">When adding an attribute, it must be part of the class, method, property, or event declaration statement.</span></span> <span data-ttu-id="b695c-422">Visual Basic 使用換行，做為陳述式分隔符號，因為屬性必須出現在同一行宣告或正上方使用行接續字元 （底線）。</span><span class="sxs-lookup"><span data-stu-id="b695c-422">Since Visual Basic uses line breaks as statement delimiters, attributes must either appear on the same line as the declaration or directly above it with a line continuation character (the underscore).</span></span> <span data-ttu-id="b695c-423">在上述程式碼片段中，行接續字元用來將屬性放置於同一行及另一個方法宣告。</span><span class="sxs-lookup"><span data-stu-id="b695c-423">In the code snippet above, the line continuation character is used to place the attribute on one line and the method declaration on another.</span></span>

<span data-ttu-id="b695c-424">如果以某種方式，Tito 以外的使用者嘗試執行`RowDeleting`事件處理常式或未驗證的使用者嘗試執行`SelectedIndexChanged`.NET 執行階段將會引發的事件處理常式， `SecurityException`。</span><span class="sxs-lookup"><span data-stu-id="b695c-424">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>

<span data-ttu-id="b695c-425">[![如果安全性內容未獲授權執行方法，會擲回安全性例外狀況](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="b695c-425">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span></span>

<span data-ttu-id="b695c-426">**圖 14**:安全性內容無權執行此方法中，如果`SecurityException`就會擲回 ([按一下以檢視完整大小的影像](user-based-authorization-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="b695c-426">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-vb/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="b695c-427">若要允許存取類別或方法的多個安全性內容，裝飾的類別或方法具有`PrincipalPermission`針對每個安全性內容的屬性。</span><span class="sxs-lookup"><span data-stu-id="b695c-427">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="b695c-428">也就是說，若要讓 Tito 以及 Bruce 執行`RowDeleting`事件處理常式，加入*兩個*`PrincipalPermission`屬性：</span><span class="sxs-lookup"><span data-stu-id="b695c-428">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample23.vb)]

<span data-ttu-id="b695c-429">除了 ASP.NET 頁面中，許多應用程式還包含各種層級，例如商務邏輯和資料存取層的架構。</span><span class="sxs-lookup"><span data-stu-id="b695c-429">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="b695c-430">這些層級通常會實作為類別庫，並提供類別和方法來執行商務邏輯與資料相關的功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-430">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="b695c-431">`PrincipalPermission`屬性可用於將授權規則套用至這些層級。</span><span class="sxs-lookup"><span data-stu-id="b695c-431">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="b695c-432">如需有關使用`PrincipalPermission`屬性來定義類別和方法的授權規則，請參閱[Scott Guthrie](https://weblogs.asp.net/scottgu/)的部落格項目[的商務和資料層使用新增授權規則`PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="b695c-432">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="b695c-433">總結</span><span class="sxs-lookup"><span data-stu-id="b695c-433">Summary</span></span>

<span data-ttu-id="b695c-434">在本教學課程中，我們討論過如何套用使用者為基礎的授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-434">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="b695c-435">我們開始著手了解 ASP。NET 的 URL 授權架構。</span><span class="sxs-lookup"><span data-stu-id="b695c-435">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="b695c-436">每個要求，ASP.NET 引擎的`UrlAuthorizationModule`會檢查以判斷身分識別是否獲得授權存取所要求的資源的應用程式的組態中定義的 URL 授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-436">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="b695c-437">簡單地說，URL 授權讓您輕鬆地指定特定目錄中的特定頁面或所有頁面的授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-437">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="b695c-438">URL 授權架構會套用授權規則 頁面的頁面為基礎。</span><span class="sxs-lookup"><span data-stu-id="b695c-438">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="b695c-439">使用 URL 授權時，已獲授權存取特定資源，或不的要求識別。</span><span class="sxs-lookup"><span data-stu-id="b695c-439">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="b695c-440">許多案例中，不過，呼叫多個精細的幅度授權規則。</span><span class="sxs-lookup"><span data-stu-id="b695c-440">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="b695c-441">而不是定義誰可以存取的頁面，我們可能需要讓每個人存取的頁面，但會顯示不同的資料，或提供不同的功能，根據使用者瀏覽的頁面。</span><span class="sxs-lookup"><span data-stu-id="b695c-441">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="b695c-442">頁面層級的授權通常牽涉到隱藏特定的使用者介面項目，以防止未經授權的使用者存取禁止的功能。</span><span class="sxs-lookup"><span data-stu-id="b695c-442">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="b695c-443">此外，就可以使用屬性來限制存取類別和其方法，針對特定使用者執行。</span><span class="sxs-lookup"><span data-stu-id="b695c-443">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="b695c-444">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="b695c-444">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="b695c-445">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="b695c-445">Further Reading</span></span>

<span data-ttu-id="b695c-446">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="b695c-446">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="b695c-447">將授權規則新增至商務和資料層使用 `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="b695c-447">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="b695c-448">ASP.NET 授權</span><span class="sxs-lookup"><span data-stu-id="b695c-448">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="b695c-449">IIS6 和 IIS7 安全性之間的變更</span><span class="sxs-lookup"><span data-stu-id="b695c-449">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="b695c-450">設定特定的檔案和子目錄</span><span class="sxs-lookup"><span data-stu-id="b695c-450">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="b695c-451">根據使用者限制資料修改功能</span><span class="sxs-lookup"><span data-stu-id="b695c-451">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb.md)
- [<span data-ttu-id="b695c-452">LoginView 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="b695c-452">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="b695c-453">了解 IIS7 URL 授權</span><span class="sxs-lookup"><span data-stu-id="b695c-453">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="b695c-454">`UrlAuthorizationModule` 技術文件</span><span class="sxs-lookup"><span data-stu-id="b695c-454">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="b695c-455">使用 ASP.NET 2.0 中的資料</span><span class="sxs-lookup"><span data-stu-id="b695c-455">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="b695c-456">關於作者</span><span class="sxs-lookup"><span data-stu-id="b695c-456">About the Author</span></span>

<span data-ttu-id="b695c-457">Scott Mitchell，多個 ASP 書籍的作者，他是 4GuysFromRolla.com 的創辦人，從事 Microsoft Web 技術工作自 1998 年。</span><span class="sxs-lookup"><span data-stu-id="b695c-457">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b695c-458">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="b695c-458">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b695c-459">他最新的著作是 *[Sams 教導您自己 ASP.NET 2.0 在 24 小時內](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* 。</span><span class="sxs-lookup"><span data-stu-id="b695c-459">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="b695c-460">Scott 要聯絡[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或透過他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="b695c-460">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="b695c-461">特別感謝</span><span class="sxs-lookup"><span data-stu-id="b695c-461">Special Thanks To</span></span>

<span data-ttu-id="b695c-462">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="b695c-462">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b695c-463">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="b695c-463">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b695c-464">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com)。</span><span class="sxs-lookup"><span data-stu-id="b695c-464">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b695c-465">[上一頁](validating-user-credentials-against-the-membership-user-store-vb.md)
> [下一頁](storing-additional-user-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="b695c-465">[Previous](validating-user-credentials-against-the-membership-user-store-vb.md)
[Next](storing-additional-user-information-vb.md)</span></span>
