---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
title: 表單驗證設定和 Advanced 主題（VB） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將檢查各種形式的驗證設定，並瞭解如何透過 forms 元素加以修改。 這將需要詳細的 。
ms.author: riande
ms.date: 01/14/2008
ms.assetid: 829d2f56-5c48-445b-b826-3418a450c788
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
msc.type: authoredcontent
ms.openlocfilehash: 4d77816a489a4fa16cd70ec4214cd2f8ee563029
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74632165"
---
# <a name="forms-authentication-configuration-and-advanced-topics-vb"></a><span data-ttu-id="122d2-104">表單驗證組態和進階主題 (VB)</span><span class="sxs-lookup"><span data-stu-id="122d2-104">Forms Authentication Configuration and Advanced Topics (VB)</span></span>

<span data-ttu-id="122d2-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="122d2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="122d2-106">[下載程式代碼](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip)或[下載 PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="122d2-106">[Download Code](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) or [Download PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span></span>

> <span data-ttu-id="122d2-107">在本教學課程中，我們將檢查各種形式的驗證設定，並瞭解如何透過 forms 元素加以修改。</span><span class="sxs-lookup"><span data-stu-id="122d2-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="122d2-108">這將需要詳細的探討自訂表單驗證票證的超時值、使用具有自訂 URL 的登入頁面（例如 login .aspx 而不是 Login .aspx）和無 cookie 的表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="122d2-109">簡介</span><span class="sxs-lookup"><span data-stu-id="122d2-109">Introduction</span></span>

<span data-ttu-id="122d2-110">在[上一個教學](an-overview-of-forms-authentication-vb.md)課程中，我們探討了在 ASP.NET 應用程式中執行表單驗證所需的步驟，從在 web.config 中指定 configuration 設定來建立登入頁面，以顯示已驗證和匿名使用者的不同內容。</span><span class="sxs-lookup"><span data-stu-id="122d2-110">In the [previous tutorial](an-overview-of-forms-authentication-vb.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="122d2-111">回想一下，我們已設定網站使用表單驗證，方法是將 &lt;authentication&gt; 元素的 mode 屬性設為 Forms。</span><span class="sxs-lookup"><span data-stu-id="122d2-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="122d2-112">&lt;authentication&gt; 元素可以選擇性地包含 &lt;表單&gt; 子專案，而您可以在其中指定表單驗證設定的種類。</span><span class="sxs-lookup"><span data-stu-id="122d2-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="122d2-113">在本教學課程中，我們將檢查各種形式的驗證設定，並瞭解如何透過 &lt;forms&gt; 元素加以修改。</span><span class="sxs-lookup"><span data-stu-id="122d2-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="122d2-114">這將需要詳細的探討自訂表單驗證票證的超時值、使用具有自訂 URL 的登入頁面（例如 login .aspx 而不是 Login .aspx）和無 cookie 的表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="122d2-115">我們也會更仔細地檢查表單驗證票證的構成，並查看 ASP.NET 採取的預防措施，以確保票證的資料不受檢查和篡改的保護。</span><span class="sxs-lookup"><span data-stu-id="122d2-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="122d2-116">最後，我們將探討如何在表單驗證票證中儲存額外的使用者資料，以及如何透過自訂主體物件來建立此資料的模型。</span><span class="sxs-lookup"><span data-stu-id="122d2-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="122d2-117">步驟1：檢查 &lt;表單&gt; 設定</span><span class="sxs-lookup"><span data-stu-id="122d2-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="122d2-118">ASP.NET 中的表單驗證系統提供許多設定，可依應用程式逐一進行自訂。</span><span class="sxs-lookup"><span data-stu-id="122d2-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="122d2-119">這包括如下的設定：表單驗證票證的存留期;套用到票證的保護類型;在何種情況下會使用無 cookie 驗證票證;登入頁面的路徑;和其他資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="122d2-120">若要修改預設值，請將[&lt;表單&gt; 元素](https://msdn.microsoft.com/library/1d3t3c61.aspx)新增為[&lt;authentication&gt;](https://msdn.microsoft.com/library/532aee0e.aspx)專案的子系，並指定您想要自訂為 XML 屬性的屬性值，如下所示：</span><span class="sxs-lookup"><span data-stu-id="122d2-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample1.xml)]

<span data-ttu-id="122d2-121">[表 1] 摘要說明可透過 &lt;forms&gt; 元素自訂的屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="122d2-122">因為 web.config 是一個 XML 檔案，所以左欄中的屬性名稱會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="122d2-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="122d2-123"><strong>屬性</strong></span><span class="sxs-lookup"><span data-stu-id="122d2-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="122d2-124"><strong>說明</strong></span><span class="sxs-lookup"><span data-stu-id="122d2-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="122d2-125">cookie</span><span class="sxs-lookup"><span data-stu-id="122d2-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="122d2-126">這個屬性會指定在哪些條件下，驗證票證會儲存在 cookie 中，而不是內嵌在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="122d2-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="122d2-127">允許的值為： UseCookies;UseUri;檢測和 UseDeviceProfile （預設值）。</span><span class="sxs-lookup"><span data-stu-id="122d2-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="122d2-128">步驟2會更詳細地檢查這項設定。</span><span class="sxs-lookup"><span data-stu-id="122d2-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="122d2-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="122d2-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="122d2-130">指出如果查詢字串中沒有指定 RedirectUrl 值，使用者在登入頁面後重新導向至的 URL。</span><span class="sxs-lookup"><span data-stu-id="122d2-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="122d2-131">預設值為 default.aspx。</span><span class="sxs-lookup"><span data-stu-id="122d2-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="122d2-132">domain</span><span class="sxs-lookup"><span data-stu-id="122d2-132">domain</span></span>           | <span data-ttu-id="122d2-133">當使用以 cookie 為基礎的驗證票證時，此設定會指定 cookie 的網域值。</span><span class="sxs-lookup"><span data-stu-id="122d2-133">When using cookie-based authentication tickets, this setting specifies the cookie s domain value.</span></span> <span data-ttu-id="122d2-134">預設值為空字串，這會導致瀏覽器使用其發行所在的網域（例如 www.yourdomain.com）。</span><span class="sxs-lookup"><span data-stu-id="122d2-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="122d2-135">在此情況下，對子域進行要求時，<strong>不</strong>會傳送 cookie，例如 admin.yourdomain.com。</span><span class="sxs-lookup"><span data-stu-id="122d2-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="122d2-136">如果您想要將 cookie 傳遞給所有子域，您需要自訂網域屬性，將其設定為 yourdomain.com。</span><span class="sxs-lookup"><span data-stu-id="122d2-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="122d2-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="122d2-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="122d2-138">布林值，指出當重新導向至相同伺服器上其他 web 應用程式中的 Url 時，是否要記住已驗證的使用者。</span><span class="sxs-lookup"><span data-stu-id="122d2-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="122d2-139">預設為 false。</span><span class="sxs-lookup"><span data-stu-id="122d2-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="122d2-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="122d2-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="122d2-141">登入頁面的 URL。</span><span class="sxs-lookup"><span data-stu-id="122d2-141">The URL of the login page.</span></span> <span data-ttu-id="122d2-142">預設值為 login .aspx。</span><span class="sxs-lookup"><span data-stu-id="122d2-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="122d2-143">{2&gt;名稱&lt;2}</span><span class="sxs-lookup"><span data-stu-id="122d2-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="122d2-144">使用以 cookie 為基礎的驗證票證時，是 cookie 的名稱。</span><span class="sxs-lookup"><span data-stu-id="122d2-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="122d2-145">預設為.ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="122d2-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="122d2-146">path</span><span class="sxs-lookup"><span data-stu-id="122d2-146">path</span></span>            |                                                                             <span data-ttu-id="122d2-147">當使用以 cookie 為基礎的驗證票證時，此設定會指定 cookie 的 path 屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-147">When using cookie-based authentication tickets, this setting specifies the cookie s path attribute.</span></span> <span data-ttu-id="122d2-148">Path 屬性可讓開發人員將 cookie 的範圍限制為特定的目錄階層。</span><span class="sxs-lookup"><span data-stu-id="122d2-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="122d2-149">預設值為/，會通知瀏覽器將驗證票證 cookie 傳送至對網域提出的任何要求。</span><span class="sxs-lookup"><span data-stu-id="122d2-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="122d2-150">保護 - protection</span><span class="sxs-lookup"><span data-stu-id="122d2-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="122d2-151">指出用來保護表單驗證票證的技術。</span><span class="sxs-lookup"><span data-stu-id="122d2-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="122d2-152">允許的值為： All （預設值）;加密無和驗證。</span><span class="sxs-lookup"><span data-stu-id="122d2-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="122d2-153">步驟3會詳細討論這些設定。</span><span class="sxs-lookup"><span data-stu-id="122d2-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="122d2-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="122d2-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="122d2-155">布林值，指出是否需要 SSL 連線才能傳輸驗證 cookie。</span><span class="sxs-lookup"><span data-stu-id="122d2-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="122d2-156">預設值為 false。</span><span class="sxs-lookup"><span data-stu-id="122d2-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="122d2-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="122d2-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="122d2-158">布林值，指出每次使用者在單一會話中造訪網站時，是否重設驗證 cookie 的超時時間。</span><span class="sxs-lookup"><span data-stu-id="122d2-158">A Boolean value that indicates whether the authentication cookie s timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="122d2-159">預設值為 True。</span><span class="sxs-lookup"><span data-stu-id="122d2-159">The default value is true.</span></span> <span data-ttu-id="122d2-160">在指定票證的超時值一節中，將會更詳細地討論驗證票證超時原則。</span><span class="sxs-lookup"><span data-stu-id="122d2-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="122d2-161">逾時</span><span class="sxs-lookup"><span data-stu-id="122d2-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="122d2-162">指定驗證票證 cookie 到期的時間（以分鐘為單位）。</span><span class="sxs-lookup"><span data-stu-id="122d2-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="122d2-163">預設值是 30。</span><span class="sxs-lookup"><span data-stu-id="122d2-163">The default value is 30.</span></span> <span data-ttu-id="122d2-164">在指定票證的超時值一節中，將會更詳細地討論驗證票證超時原則。</span><span class="sxs-lookup"><span data-stu-id="122d2-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="122d2-165">**表 1**： &lt;表單&gt; 元素屬性的摘要</span><span class="sxs-lookup"><span data-stu-id="122d2-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="122d2-166">在 ASP.NET 2.0 和更高的範圍中，預設的表單驗證值會在 .NET Framework 的 FormsAuthenticationConfiguration 類別中硬式編碼。</span><span class="sxs-lookup"><span data-stu-id="122d2-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="122d2-167">任何修改都必須以應用程式為基礎，在 web.config 檔案中套用。</span><span class="sxs-lookup"><span data-stu-id="122d2-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="122d2-168">這與 ASP.NET 1.x 不同，其中預設的表單驗證值會儲存在 machine.config 檔案中（因此可透過編輯 machine.config 進行修改）。</span><span class="sxs-lookup"><span data-stu-id="122d2-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="122d2-169">在 ASP.NET 1.x 的主題中，值得一提的是，有一些表單驗證系統設定在 ASP.NET 2.0 中具有不同的預設值，而不是 ASP.NET 1.x。</span><span class="sxs-lookup"><span data-stu-id="122d2-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="122d2-170">如果您要從 ASP.NET 1.x 環境遷移應用程式，請務必留意這些差異。</span><span class="sxs-lookup"><span data-stu-id="122d2-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="122d2-171">如需差異清單，請參閱[&lt;表單&gt; 元素技術檔](https://msdn.microsoft.com/library/1d3t3c61.aspx)。</span><span class="sxs-lookup"><span data-stu-id="122d2-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-172">數種形式的驗證設定，例如 timeout、網域和路徑，會指定產生的表單驗證票證 cookie 的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="122d2-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="122d2-173">如需 cookie、其使用方式和其各種屬性的詳細資訊，請閱讀[此 cookie 教學](http://www.quirksmode.org/js/cookies.html)課程。</span><span class="sxs-lookup"><span data-stu-id="122d2-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="122d2-174">指定票證的超時值</span><span class="sxs-lookup"><span data-stu-id="122d2-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="122d2-175">表單驗證票證是代表身分識別的權杖。</span><span class="sxs-lookup"><span data-stu-id="122d2-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="122d2-176">使用以 cookie 為基礎的驗證票證時，此權杖會以 cookie 的形式保存，並在每個要求中傳送至 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="122d2-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="122d2-177">擁有權杖，基本上就是宣告、我的使用者*名稱*、我已經登入，而且會使用，以便在頁面流覽時記住使用者的身分識別。</span><span class="sxs-lookup"><span data-stu-id="122d2-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="122d2-178">表單驗證票證不僅包含使用者的身分識別，還包含可協助確保權杖完整性和安全性的資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="122d2-179">畢竟，我們不希望惡意使用者能夠建立假冒權杖，或是以某種 underhanded 的方式修改合法 token。</span><span class="sxs-lookup"><span data-stu-id="122d2-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="122d2-180">票證中包含的其中一項資訊是*到期*日，也就是票證不再有效的日期和時間。</span><span class="sxs-lookup"><span data-stu-id="122d2-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="122d2-181">每次又稱為 formsauthenticationmodule 檢查驗證票證時，它會確保票證的到期時間尚未通過。</span><span class="sxs-lookup"><span data-stu-id="122d2-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="122d2-182">如果有，則會忽略票證，並將使用者識別為匿名。</span><span class="sxs-lookup"><span data-stu-id="122d2-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="122d2-183">這種防護措施有助於防範重新執行攻擊。</span><span class="sxs-lookup"><span data-stu-id="122d2-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="122d2-184">如果駭客能夠取得使用者的有效驗證票證（也許是藉由取得電腦的實體存取權並透過 cookie 進行對應），他們就可以使用此竊取的驗證票證，將要求傳送到伺服器，而不會過期。取得專案。</span><span class="sxs-lookup"><span data-stu-id="122d2-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="122d2-185">雖然到期不會防止這種情況，但它會限制在這種情況下，這類攻擊可能會成功的時段。</span><span class="sxs-lookup"><span data-stu-id="122d2-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-186">步驟3會詳細說明表單驗證系統用來保護驗證票證的其他技術。</span><span class="sxs-lookup"><span data-stu-id="122d2-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="122d2-187">建立驗證票證時，表單驗證系統會藉由查閱 timeout 設定來判斷其到期日。</span><span class="sxs-lookup"><span data-stu-id="122d2-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="122d2-188">如表1所示，timeout 設定的預設值為30分鐘，這表示當表單驗證票證建立時，其到期日會設定為未來的日期和時間30分鐘。</span><span class="sxs-lookup"><span data-stu-id="122d2-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="122d2-189">到期日會定義表單驗證票證到期時的絕對時間。</span><span class="sxs-lookup"><span data-stu-id="122d2-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="122d2-190">但是，開發人員通常會想要執行滑動到期，每次使用者重提網站時都會重設一個。</span><span class="sxs-lookup"><span data-stu-id="122d2-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="122d2-191">此行為取決於 slidingExpiration 設定。</span><span class="sxs-lookup"><span data-stu-id="122d2-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="122d2-192">如果設定為 true （預設值），則每次又稱為 formsauthenticationmodule 驗證使用者時，就會更新票證的到期日。</span><span class="sxs-lookup"><span data-stu-id="122d2-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="122d2-193">如果設定為 false，就不會在每個要求上更新到期日，因而導致票證在第一次建立票證的過去分鐘數剛好過期。</span><span class="sxs-lookup"><span data-stu-id="122d2-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-194">儲存在驗證票證中的到期日是絕對日期和時間值，如8月2日 2008 11:34 AM。</span><span class="sxs-lookup"><span data-stu-id="122d2-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="122d2-195">此外，日期和時間會相對於 web 伺服器的當地時間。</span><span class="sxs-lookup"><span data-stu-id="122d2-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="122d2-196">這項設計決策在日光節約時間（DST）上可能會有一些有趣的副作用，也就是美國的時鐘在一小時後移動時（假設 web 伺服器裝載于觀察日光節約時間的地區設定）。</span><span class="sxs-lookup"><span data-stu-id="122d2-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="122d2-197">請考慮在 DST 開始時間接近30分鐘到期的 ASP.NET 網站會發生什麼事（位於上午2:00）。</span><span class="sxs-lookup"><span data-stu-id="122d2-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="122d2-198">假設造訪者登入位於2008年3月11日上午1:55 的網站。</span><span class="sxs-lookup"><span data-stu-id="122d2-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="122d2-199">這會產生「表單驗證票證」，其會在2008年3月11日上午2:25 （未來30分鐘）到期。</span><span class="sxs-lookup"><span data-stu-id="122d2-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="122d2-200">不過，一旦 2:00 AM 擲回，時鐘就會因為 DST 而跳到 3:00 AM。</span><span class="sxs-lookup"><span data-stu-id="122d2-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="122d2-201">當使用者在登入後6分鐘（上午3:01）載入新的頁面時，又稱為 formsauthenticationmodule 會注意到票證已過期，並將使用者重新導向至登入頁面。</span><span class="sxs-lookup"><span data-stu-id="122d2-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="122d2-202">如需此和其他驗證票證超時奇觀以及因應措施的詳細討論，請挑選一份 Stefan Schackow 的*專業 ASP.NET 2.0 安全性、成員資格和角色管理*（ISBN：978-0-7645-9698-8）。</span><span class="sxs-lookup"><span data-stu-id="122d2-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="122d2-203">[圖 1] 說明當 slidingExpiration 設定為 false 且 timeout 設定為30時的工作流程。</span><span class="sxs-lookup"><span data-stu-id="122d2-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="122d2-204">請注意，在登入時產生的驗證票證包含到期日，而此值不會在後續要求時更新。</span><span class="sxs-lookup"><span data-stu-id="122d2-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="122d2-205">如果又稱為 formsauthenticationmodule 發現票證已過期，則會將它捨棄，並將要求視為匿名。</span><span class="sxs-lookup"><span data-stu-id="122d2-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="122d2-206">[![當 slidingExpiration 為 false 時，表單驗證票證的到期圖形表示](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span></span>

<span data-ttu-id="122d2-207">**圖 01**：當 slidingExpiration 為 false 時，表單驗證票證到期的圖形表示（[按一下以查看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span></span>

<span data-ttu-id="122d2-208">[圖 2] 顯示當 slidingExpiration 設定為 true，且 timeout 設定為30時的工作流程。</span><span class="sxs-lookup"><span data-stu-id="122d2-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="122d2-209">收到已驗證的要求（具有未過期的票證）時，其到期日會更新為未來的超時分鐘數。</span><span class="sxs-lookup"><span data-stu-id="122d2-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="122d2-210">[當 slidingExpiration 為 true 時，![表單驗證票證的圖形標記法](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span></span>

<span data-ttu-id="122d2-211">**圖 02**：當 slidingExpiration 為 true 時，表單驗證票證的圖形表示（[按一下以查看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span></span>

<span data-ttu-id="122d2-212">使用以 cookie 為基礎的驗證票證（預設值）時，此討論會變得更加困惑，因為 cookie 也可以指定自己的 expiries。</span><span class="sxs-lookup"><span data-stu-id="122d2-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="122d2-213">Cookie 的到期（或缺少）會指示瀏覽器何時應終結 cookie。</span><span class="sxs-lookup"><span data-stu-id="122d2-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="122d2-214">如果 cookie 缺少到期日，則會在瀏覽器關閉時將其損毀。</span><span class="sxs-lookup"><span data-stu-id="122d2-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="122d2-215">不過，如果有到期日，cookie 就會一直儲存在使用者的電腦上，直到到期指定的日期和時間為止。</span><span class="sxs-lookup"><span data-stu-id="122d2-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="122d2-216">當瀏覽器終結 cookie 時，它就不會再傳送到 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="122d2-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="122d2-217">因此，cookie 的銷毀類似于使用者登出網站。</span><span class="sxs-lookup"><span data-stu-id="122d2-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-218">當然，使用者可能會主動移除儲存在電腦上的任何 cookie。</span><span class="sxs-lookup"><span data-stu-id="122d2-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="122d2-219">在 Internet Explorer 7 中，您可以移至 [工具]、[選項]，然後按一下 [流覽歷程記錄] 區段中的 [刪除] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="122d2-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="122d2-220">從該處按一下 [刪除 cookie] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="122d2-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="122d2-221">表單驗證系統會根據傳入*persistCookie*參數的值，建立以會話為基礎或以過期為基礎的 cookie。</span><span class="sxs-lookup"><span data-stu-id="122d2-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="122d2-222">回想一下，FormsAuthentication 類別的 GetAuthCookie、SetAuthCookie 和 RedirectFromLoginPage 方法會採用兩個輸入參數： *username*和*persistCookie*。</span><span class="sxs-lookup"><span data-stu-id="122d2-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="122d2-223">我們在前一個教學課程中建立的登入頁面包含 [記住我] 核取方塊，決定是否已建立持續性 cookie。</span><span class="sxs-lookup"><span data-stu-id="122d2-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="122d2-224">持續性 cookie 是以過期為基礎;非持續性 cookie 是以會話為基礎。</span><span class="sxs-lookup"><span data-stu-id="122d2-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="122d2-225">已討論的 timeout 和 slidingExpiration 概念，對會話和到期的 cookie 都套用相同的。</span><span class="sxs-lookup"><span data-stu-id="122d2-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="122d2-226">執行中只有一個次要差異：當使用以過期為基礎的 cookie，並將 slidingTimeout 設定為 true 時，只有在經過超過一半的指定時間時，才會更新 cookie 的到期日。</span><span class="sxs-lookup"><span data-stu-id="122d2-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="122d2-227">讓我們更新我們的網站驗證票證超時原則，讓票證在一小時後（60分鐘）就會使用滑動到期時間。</span><span class="sxs-lookup"><span data-stu-id="122d2-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="122d2-228">若要對此變更產生影響，請更新 Web.config 檔案，將 &lt;forms&gt; 元素新增至 &lt;authentication&gt; 專案，並加上下列標記：</span><span class="sxs-lookup"><span data-stu-id="122d2-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="122d2-229">使用 Login 以外的登入頁面 URL</span><span class="sxs-lookup"><span data-stu-id="122d2-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="122d2-230">由於又稱為 formsauthenticationmodule 會自動將未經授權的使用者重新導向至登入頁面，因此它必須知道登入頁面的 URL。</span><span class="sxs-lookup"><span data-stu-id="122d2-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="122d2-231">這個 URL 是由 &lt;表單&gt; 專案中的 loginUrl 屬性所指定，而且預設為 login .aspx。</span><span class="sxs-lookup"><span data-stu-id="122d2-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="122d2-232">如果您要移植現有的網站，您可能已經有一個具有不同 URL 的登入頁面，其中一個已由搜尋引擎加上書簽並編制索引。</span><span class="sxs-lookup"><span data-stu-id="122d2-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="122d2-233">您可以改為修改 loginUrl 屬性，以指向您的登入頁面，而不是將現有的登入頁面重新命名為 [登入 .aspx] 和 [中斷連結] 和 [使用者書簽]。</span><span class="sxs-lookup"><span data-stu-id="122d2-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="122d2-234">例如，如果您的登入頁面命名為 login .aspx，而且位於使用者目錄中，則您可以將 loginUrl 設定值指向 ~/Users/SignIn.aspx，如下所示：</span><span class="sxs-lookup"><span data-stu-id="122d2-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample3.xml)]

<span data-ttu-id="122d2-235">因為我們目前的應用程式已經有名為 Login 的登入頁面，所以不需要在 &lt;forms&gt; 元素中指定自訂值。</span><span class="sxs-lookup"><span data-stu-id="122d2-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="122d2-236">步驟2：使用無 Cookie 的表單驗證票證</span><span class="sxs-lookup"><span data-stu-id="122d2-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="122d2-237">根據預設，表單驗證系統會決定是否要將其驗證票證儲存在 cookie 集合中，或根據造訪網站的使用者代理程式將其內嵌在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="122d2-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="122d2-238">所有主流桌面瀏覽器（例如 Internet Explorer、Firefox、Opera 和 Safari）都支援 cookie，但並非所有行動裝置都有。</span><span class="sxs-lookup"><span data-stu-id="122d2-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="122d2-239">表單驗證系統所使用的 cookie 原則取決於 &lt;forms&gt; 元素中的無 cookie 設定，可以指派四個值的其中一個：</span><span class="sxs-lookup"><span data-stu-id="122d2-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="122d2-240">UseCookies-指定一律會使用以 cookie 為基礎的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="122d2-241">UseUri-指出永遠不會使用以 cookie 為基礎的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="122d2-242">自動偵測-如果裝置設定檔不支援 cookie，則不會使用以 cookie 為基礎的驗證票證;如果裝置設定檔支援 cookie，則會使用探查機制來判斷是否已啟用 cookie。</span><span class="sxs-lookup"><span data-stu-id="122d2-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="122d2-243">UseDeviceProfile-預設值;只有在裝置設定檔支援 cookie 時，才會使用 cookie 型驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="122d2-244">未使用任何探查機制。</span><span class="sxs-lookup"><span data-stu-id="122d2-244">No probing mechanism is used.</span></span>

<span data-ttu-id="122d2-245">[自動偵測] 和 [UseDeviceProfile] 設定會依賴*裝置設定檔*，查明是否要使用 cookie 型或無 cookie 驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="122d2-246">ASP.NET 會維護各種裝置及其功能的資料庫，例如它們是否支援 cookie、支援的 JavaScript 版本等等。</span><span class="sxs-lookup"><span data-stu-id="122d2-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="122d2-247">每次裝置從 web 伺服器要求網頁時，它會沿著用來識別裝置類型的*使用者代理程式*HTTP 標頭傳送該網頁。</span><span class="sxs-lookup"><span data-stu-id="122d2-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="122d2-248">ASP.NET 會自動將提供的使用者代理字串與其資料庫中指定的對應設定檔進行比對。</span><span class="sxs-lookup"><span data-stu-id="122d2-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-249">此裝置功能的資料庫會儲存在一些符合[瀏覽器定義檔案架構](https://msdn.microsoft.com/library/ms228122.aspx)的 XML 檔案中。</span><span class="sxs-lookup"><span data-stu-id="122d2-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="122d2-250">預設的裝置設定檔位於%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers。</span><span class="sxs-lookup"><span data-stu-id="122d2-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="122d2-251">您也可以將自訂檔案新增至應用程式的 [瀏覽器] 資料夾\_。</span><span class="sxs-lookup"><span data-stu-id="122d2-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="122d2-252">如需詳細資訊，請參閱[如何：在 ASP.NET Web Pages 中偵測瀏覽器類型](https://msdn.microsoft.com/library/3yekbd5b.aspx)。</span><span class="sxs-lookup"><span data-stu-id="122d2-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="122d2-253">由於預設設定為 UseDeviceProfile，因此當裝置瀏覽器的設定檔不支援 cookie 時，將會使用無 cookie 的表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="122d2-254">將 URL 中的驗證票證編碼</span><span class="sxs-lookup"><span data-stu-id="122d2-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="122d2-255">Cookie 是一個自然媒體，可將每個要求中的資訊納入特定網站，這也是為什麼當流覽裝置支援時，預設的表單驗證設定會使用 cookie。</span><span class="sxs-lookup"><span data-stu-id="122d2-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="122d2-256">如果不支援 cookie，則必須使用替代方法，將來自用戶端的驗證票證傳遞至伺服器。</span><span class="sxs-lookup"><span data-stu-id="122d2-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="122d2-257">在無 cookie 環境中使用的常見因應措施是將 URL 中的 cookie 資料編碼。</span><span class="sxs-lookup"><span data-stu-id="122d2-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="122d2-258">查看這類資訊如何內嵌在 URL 中的最佳方式，就是強制網站使用無 cookie 的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="122d2-259">這可以藉由將無 cookie 設定設定為 UseUri 來完成：</span><span class="sxs-lookup"><span data-stu-id="122d2-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample4.xml)]

<span data-ttu-id="122d2-260">完成此變更之後，請透過瀏覽器造訪網站。</span><span class="sxs-lookup"><span data-stu-id="122d2-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="122d2-261">以匿名使用者的身分造訪時，Url 看起來就像以前一樣。</span><span class="sxs-lookup"><span data-stu-id="122d2-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="122d2-262">例如，造訪 default.aspx 網頁時，我的瀏覽器網址列會顯示下列 URL：</span><span class="sxs-lookup"><span data-stu-id="122d2-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="122d2-263">不過，登入時，表單驗證票證會內嵌至 URL。</span><span class="sxs-lookup"><span data-stu-id="122d2-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="122d2-264">例如，流覽登入頁面並以 Sam 身分登入之後，我會回到 default.aspx 頁面，但這次的 URL 是：</span><span class="sxs-lookup"><span data-stu-id="122d2-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="122d2-265">表單驗證票證已內嵌在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="122d2-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="122d2-266">字串（F （jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2）代表十六進位編碼的驗證票證資訊，而且是通常儲存在 cookie 內的相同資料。</span><span class="sxs-lookup"><span data-stu-id="122d2-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="122d2-267">為了讓無 cookie 驗證票證能夠正常執行，系統必須將頁面上的所有 Url 編碼，以包含驗證票證資料，否則當使用者按一下連結時，將會遺失驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="122d2-268">幸好，此內嵌邏輯會自動執行。</span><span class="sxs-lookup"><span data-stu-id="122d2-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="122d2-269">若要示範這種功能，請開啟 default.aspx 頁面並加入 HyperLink 控制項，分別將其 Text 和 NavigateUrl 屬性設定為 Test Link 和 SomePage。</span><span class="sxs-lookup"><span data-stu-id="122d2-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="122d2-270">我們的專案中真的沒有一個名為 SomePage 的頁面。</span><span class="sxs-lookup"><span data-stu-id="122d2-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="122d2-271">將變更儲存至 default.aspx，然後透過瀏覽器造訪。</span><span class="sxs-lookup"><span data-stu-id="122d2-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="122d2-272">登入網站，以將表單驗證票證內嵌在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="122d2-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="122d2-273">接下來，從 default.aspx 中，按一下 [測試連結] 連結。</span><span class="sxs-lookup"><span data-stu-id="122d2-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="122d2-274">發生了什麼事？</span><span class="sxs-lookup"><span data-stu-id="122d2-274">What happened?</span></span> <span data-ttu-id="122d2-275">如果沒有名為 SomePage 的頁面存在，則會發生404錯誤，但這裡並不重要。</span><span class="sxs-lookup"><span data-stu-id="122d2-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="122d2-276">相反地，請將焦點放在瀏覽器的網址列上。</span><span class="sxs-lookup"><span data-stu-id="122d2-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="122d2-277">請注意，其中包含 URL 中的表單驗證票證！</span><span class="sxs-lookup"><span data-stu-id="122d2-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="122d2-278">連結中的 URL SomePage 已自動轉換成包含驗證票證的 URL-我們不需要撰寫舔的程式碼！</span><span class="sxs-lookup"><span data-stu-id="122d2-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="122d2-279">表單驗證票證會自動內嵌至任何不是以 HTTP://或/開頭之超連結的 URL 中。</span><span class="sxs-lookup"><span data-stu-id="122d2-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="122d2-280">超連結是否會出現在回應的呼叫中，並不重要。重新導向、超連結控制項或錨點 HTML 專案中（亦即，&lt;href = "..."&gt;...&lt;/a&gt;）。</span><span class="sxs-lookup"><span data-stu-id="122d2-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="122d2-281">只要 URL 不像 http://www.someserver.com/SomePage.aspx 或/SomePage.aspx，就會為我們內嵌表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-281">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-282">無 cookie 的表單驗證票證會與以 cookie 為基礎的驗證票證遵循相同的超時原則。</span><span class="sxs-lookup"><span data-stu-id="122d2-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="122d2-283">不過，無 cookie 驗證票證較容易重新執行攻擊，因為驗證票證直接內嵌在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="122d2-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="122d2-284">想像一下造訪網站、登入，然後以電子郵件將 URL 貼到同事的使用者。</span><span class="sxs-lookup"><span data-stu-id="122d2-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="122d2-285">如果同事在達到到期前按一下該連結，則會以傳送電子郵件的使用者身分登入！</span><span class="sxs-lookup"><span data-stu-id="122d2-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="122d2-286">步驟3：保護驗證票證</span><span class="sxs-lookup"><span data-stu-id="122d2-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="122d2-287">表單驗證票證會透過網路傳輸，不論是在 cookie 中，或直接內嵌在 URL 內。</span><span class="sxs-lookup"><span data-stu-id="122d2-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="122d2-288">除了身分識別資訊之外，驗證票證也可以包含使用者資料（如我們在步驟4中所見）。</span><span class="sxs-lookup"><span data-stu-id="122d2-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="122d2-289">因此，票證的資料必須從窺探的角度加密，而且更重要的是，表單驗證系統可以保證票證不會遭到篡改。</span><span class="sxs-lookup"><span data-stu-id="122d2-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="122d2-290">為確保票證資料的隱私權，表單驗證系統可以加密票證資料。</span><span class="sxs-lookup"><span data-stu-id="122d2-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="122d2-291">無法加密票證資料會以純文字形式透過網路傳送可能的機密資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="122d2-292">為了保證票證的真實性，表單驗證系統必須*驗證*票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="122d2-293">驗證是確保特定資料片段尚未修改的動作，並可透過 *[訊息驗證碼（MAC）](http://en.wikipedia.org/wiki/Message_authentication_code)* 來完成。</span><span class="sxs-lookup"><span data-stu-id="122d2-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="122d2-294">簡言之，MAC 是一小部分的資訊，可識別需要驗證的資料（在此案例中為票證）。</span><span class="sxs-lookup"><span data-stu-id="122d2-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="122d2-295">如果已修改 MAC 所代表的資料，則 MAC 和資料將不會相符。</span><span class="sxs-lookup"><span data-stu-id="122d2-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="122d2-296">此外，駭客也很難進行修改資料的運算，並產生自己的 MAC 來對應修改過的資料。</span><span class="sxs-lookup"><span data-stu-id="122d2-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="122d2-297">建立（或修改）票證時，表單驗證系統會建立 MAC，並將它附加至票證的資料。</span><span class="sxs-lookup"><span data-stu-id="122d2-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="122d2-298">當後續的要求抵達時，表單驗證系統會比較 MAC 和票證資料，以驗證票證資料的真實性。</span><span class="sxs-lookup"><span data-stu-id="122d2-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="122d2-299">[圖 3] 以圖形方式說明此工作流程。</span><span class="sxs-lookup"><span data-stu-id="122d2-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="122d2-300">[![透過 MAC 確保票證的真實性](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span></span>

<span data-ttu-id="122d2-301">**圖 03**：透過 MAC 確保票證的真實性（[按一下以觀看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span></span>

<span data-ttu-id="122d2-302">套用至驗證票證的安全性措施取決於 &lt;forms&gt; 元素中的保護設定。</span><span class="sxs-lookup"><span data-stu-id="122d2-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="122d2-303">保護設定可能會指派給下列三個值的其中一個：</span><span class="sxs-lookup"><span data-stu-id="122d2-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="122d2-304">All-此票證會經過加密和數位簽署（預設值）。</span><span class="sxs-lookup"><span data-stu-id="122d2-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="122d2-305">套用加密-只會套用加密-不會產生 MAC。</span><span class="sxs-lookup"><span data-stu-id="122d2-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="122d2-306">無-不會加密票證，也不會進行數位簽署。</span><span class="sxs-lookup"><span data-stu-id="122d2-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="122d2-307">驗證-產生 MAC，但票證資料是透過網路以純文字傳送。</span><span class="sxs-lookup"><span data-stu-id="122d2-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="122d2-308">Microsoft 強烈建議使用 [全部] 設定。</span><span class="sxs-lookup"><span data-stu-id="122d2-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="122d2-309">設定驗證和解密金鑰</span><span class="sxs-lookup"><span data-stu-id="122d2-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="122d2-310">表單驗證系統用來加密和驗證驗證票證的加密和雜湊演算法，可以透過 Web.config 中的[&lt;machineKey&gt; 元素](https://msdn.microsoft.com/library/w8h3skw9.aspx)進行自訂。[表 2] 概述 &lt;machineKey&gt; 元素的屬性及其可能的值。</span><span class="sxs-lookup"><span data-stu-id="122d2-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="122d2-311">**屬性**</span><span class="sxs-lookup"><span data-stu-id="122d2-311">**Attribute**</span></span> | <span data-ttu-id="122d2-312">**說明**</span><span class="sxs-lookup"><span data-stu-id="122d2-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="122d2-313">解密</span><span class="sxs-lookup"><span data-stu-id="122d2-313">decryption</span></span> | <span data-ttu-id="122d2-314">表示用於加密的演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="122d2-315">這個屬性可以有下列四個值的其中一個：-Auto-default。根據 Decryptionkey 機屬性的長度來決定演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="122d2-316">-AES-使用[進階加密標準（AES）](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="122d2-317">-DES-使用[資料加密標準（DES）](http://en.wikipedia.org/wiki/Data_Encryption_Standard)此演算法視為運算弱式，不應使用。</span><span class="sxs-lookup"><span data-stu-id="122d2-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="122d2-318">-3DES-使用[三](http://en.wikipedia.org/wiki/Triple_DES)重 des 演算法，其運作方式為三次。</span><span class="sxs-lookup"><span data-stu-id="122d2-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="122d2-319">Decryptionkey 機</span><span class="sxs-lookup"><span data-stu-id="122d2-319">decryptionKey</span></span> | <span data-ttu-id="122d2-320">加密演算法所使用的秘密金鑰。</span><span class="sxs-lookup"><span data-stu-id="122d2-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="122d2-321">這個值必須是適當長度的十六進位字串（根據解密中的值）、自動產生，或以 IsolateApps 附加的任何值。</span><span class="sxs-lookup"><span data-stu-id="122d2-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="122d2-322">新增 IsolateApps 會指示 ASP.NET 對每個應用程式使用唯一的值。</span><span class="sxs-lookup"><span data-stu-id="122d2-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="122d2-323">預設值為 [自動產生]、[IsolateApps]。</span><span class="sxs-lookup"><span data-stu-id="122d2-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="122d2-324">驗證</span><span class="sxs-lookup"><span data-stu-id="122d2-324">validation</span></span> | <span data-ttu-id="122d2-325">表示用於驗證的演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="122d2-326">此屬性可以有下列四個值的其中一個：-AES-使用進階加密標準（AES）演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="122d2-327">-MD5-使用[訊息摘要5（MD5）](http://en.wikipedia.org/wiki/MD5)演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="122d2-328">-SHA1-使用[SHA1](http://en.wikipedia.org/wiki/Sha1)演算法（預設值）。</span><span class="sxs-lookup"><span data-stu-id="122d2-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="122d2-329">-3DES-使用三重 DES 演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="122d2-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="122d2-330">validationKey</span></span> | <span data-ttu-id="122d2-331">驗證演算法所使用的秘密金鑰。</span><span class="sxs-lookup"><span data-stu-id="122d2-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="122d2-332">這個值必須是適當長度的十六進位字串（根據驗證中的值）、自動產生，或以 IsolateApps 附加的任何值。</span><span class="sxs-lookup"><span data-stu-id="122d2-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="122d2-333">新增 IsolateApps 會指示 ASP.NET 對每個應用程式使用唯一的值。</span><span class="sxs-lookup"><span data-stu-id="122d2-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="122d2-334">預設值為 [自動產生]、[IsolateApps]。</span><span class="sxs-lookup"><span data-stu-id="122d2-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="122d2-335">**表 2**： &lt;MachineKey&gt; 元素屬性</span><span class="sxs-lookup"><span data-stu-id="122d2-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="122d2-336">這些加密和驗證選項的完整討論，以及各種演算法的優缺點，已超出本教學課程的範圍。</span><span class="sxs-lookup"><span data-stu-id="122d2-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="122d2-337">如需深入瞭解這些問題，包括要使用的加密和驗證演算法、要使用的金鑰長度，以及如何產生這些金鑰，請參閱*專業 ASP.NET 2.0 安全性、成員資格和角色管理*。</span><span class="sxs-lookup"><span data-stu-id="122d2-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="122d2-338">根據預設，用於加密和驗證的金鑰會針對每個應用程式自動產生，而這些金鑰會儲存在本地安全機構（LSA）中。</span><span class="sxs-lookup"><span data-stu-id="122d2-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="122d2-339">簡單地說，預設設定會保證 web 伺服器上的唯一索引鍵，以及每個應用程式的基礎。</span><span class="sxs-lookup"><span data-stu-id="122d2-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="122d2-340">因此，在下列兩種情況下，此預設行為將無法運作：</span><span class="sxs-lookup"><span data-stu-id="122d2-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="122d2-341">**Web**伺服陣列-在[web](http://en.wikipedia.org/wiki/Web_farm)伺服陣列案例中，單一 web 應用程式會裝載于多部 web 伺服器上，以因應擴充性和冗余的目的。</span><span class="sxs-lookup"><span data-stu-id="122d2-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="122d2-342">每個連入要求都會分派到伺服器陣列中的伺服器，這表示在使用者會話的存留期內，可能會使用不同的伺服器來處理其各種要求。</span><span class="sxs-lookup"><span data-stu-id="122d2-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="122d2-343">因此，每部伺服器都必須使用相同的加密和驗證金鑰，如此一來，在一部伺服器上建立、加密及驗證的表單驗證票證，才能在伺服陣列中的不同伺服器上進行解密和驗證。</span><span class="sxs-lookup"><span data-stu-id="122d2-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="122d2-344">**跨應用程式票證共用**-單一 web 伺服器可以裝載多個 ASP.NET 應用程式。</span><span class="sxs-lookup"><span data-stu-id="122d2-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="122d2-345">如果您需要這些不同的應用程式共用單一表單驗證票證，其加密和驗證金鑰必須相符。</span><span class="sxs-lookup"><span data-stu-id="122d2-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="122d2-346">在 web 伺服陣列中工作或跨相同伺服器上的應用程式共用驗證票證時，您必須在受影響的應用程式中設定 &lt;machineKey&gt; 元素，使其 Decryptionkey 機和 validationKey 值相符。</span><span class="sxs-lookup"><span data-stu-id="122d2-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="122d2-347">雖然上述案例都不適用於我們的範例應用程式，但仍可指定明確的 Decryptionkey 機和 validationKey 值，並定義要使用的演算法。</span><span class="sxs-lookup"><span data-stu-id="122d2-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="122d2-348">將 &lt;machineKey&gt; 設定新增至 web.config 檔案：</span><span class="sxs-lookup"><span data-stu-id="122d2-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample5.xml)]

<span data-ttu-id="122d2-349">如需詳細資訊，請參閱[如何：在 ASP.NET 2.0 中設定 MachineKey](https://msdn.microsoft.com/library/ms998288.aspx)。</span><span class="sxs-lookup"><span data-stu-id="122d2-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-350">Decryptionkey 機和 validationKey 值取自[Steve Gibson](http://www.grc.com/stevegibson.htm)的 [[最佳密碼] 網頁](https://www.grc.com/passwords.htm)，這會在每一頁上產生64的隨機十六進位字元。</span><span class="sxs-lookup"><span data-stu-id="122d2-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="122d2-351">若要降低這些金鑰進入生產應用程式的可能性，建議您從 [最佳密碼] 頁面，將上述金鑰取代為隨機產生的金鑰。</span><span class="sxs-lookup"><span data-stu-id="122d2-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="122d2-352">步驟4：在票證中儲存額外的使用者資料</span><span class="sxs-lookup"><span data-stu-id="122d2-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="122d2-353">許多 web 應用程式會顯示目前登入之使用者的頁面顯示資訊，或以此為基礎。</span><span class="sxs-lookup"><span data-stu-id="122d2-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="122d2-354">例如，網頁可能會顯示使用者的名稱，以及她上次登入每個頁面右上角的日期。</span><span class="sxs-lookup"><span data-stu-id="122d2-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="122d2-355">表單驗證票證會儲存目前登入的使用者名稱，但當需要任何其他資訊時，頁面必須移至使用者存放區（通常是資料庫），以查閱未儲存在驗證票證中的資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="122d2-356">有了一些程式碼，我們就可以在表單驗證票證中儲存額外的使用者資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="122d2-357">這類資料可透過[FormsAuthenticationTicket 類別](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)的[UserData 屬性](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx)來表示。</span><span class="sxs-lookup"><span data-stu-id="122d2-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="122d2-358">這很適合用來放入通常需要的使用者相關的少量資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="122d2-359">[UserData] 屬性中指定的值會納入為驗證票證 cookie 的一部分，如同其他票證欄位，會根據表單驗證系統的設定來加密和驗證。</span><span class="sxs-lookup"><span data-stu-id="122d2-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="122d2-360">根據預設，UserData 是空字串。</span><span class="sxs-lookup"><span data-stu-id="122d2-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="122d2-361">為了將使用者資料儲存在驗證票證中，我們需要在登入頁面中撰寫一些程式碼來抓取使用者特定資訊，並將它儲存在票證中。</span><span class="sxs-lookup"><span data-stu-id="122d2-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="122d2-362">由於 UserData 是 String 類型的屬性，因此儲存在其中的資料必須正確地序列化為字串。</span><span class="sxs-lookup"><span data-stu-id="122d2-362">Since UserData is a property of type String, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="122d2-363">例如，假設我們的使用者存放區包含每位使用者的出生日期和雇主的名稱，而我們想要在驗證票證中儲存這兩個屬性值。</span><span class="sxs-lookup"><span data-stu-id="122d2-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="122d2-364">我們可以將使用者的生日字串與管道（|）串連，後面接著雇主名稱，藉此將這些值序列化成字串。</span><span class="sxs-lookup"><span data-stu-id="122d2-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="122d2-365">如果使用者是在1974年8月15日（適用于 Northwind 商貿），我們會指派字串： 1974-08-15 | 中的 UserData 屬性。Northwind 商貿。</span><span class="sxs-lookup"><span data-stu-id="122d2-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="122d2-366">只要我們需要存取儲存在票證中的資料，我們就可以抓取目前要求的 FormsAuthenticationTicket，並還原序列化 UserData 屬性來達到此目的。</span><span class="sxs-lookup"><span data-stu-id="122d2-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="122d2-367">在「出生日期」和「雇主名稱」範例的案例中，我們會根據分隔符號（|）將 UserData 字串分割成兩個子字串。</span><span class="sxs-lookup"><span data-stu-id="122d2-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="122d2-368">[![額外的使用者資訊可儲存在驗證票證中](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span></span>

<span data-ttu-id="122d2-369">**圖 04**：其他使用者資訊可以儲存在驗證票證中（[按一下以觀看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="122d2-370">將資訊寫入到 UserData</span><span class="sxs-lookup"><span data-stu-id="122d2-370">Writing Information to UserData</span></span>

<span data-ttu-id="122d2-371">可惜的是，將使用者特有的資訊新增至表單驗證票證，並不像預期般簡單。</span><span class="sxs-lookup"><span data-stu-id="122d2-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="122d2-372">FormsAuthenticationTicket 類別的 UserData 屬性是唯讀的，而且只能透過 FormsAuthenticationTicket 類別的函式來指定。</span><span class="sxs-lookup"><span data-stu-id="122d2-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="122d2-373">在此函式中指定 UserData 屬性時，我們也需要提供票證的其他值：使用者名稱、問題日期、到期日等等。</span><span class="sxs-lookup"><span data-stu-id="122d2-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="122d2-374">當我們在先前的教學課程中建立登入頁面時，FormsAuthentication 類別會為我們處理。</span><span class="sxs-lookup"><span data-stu-id="122d2-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="122d2-375">將 UserData 新增至 FormsAuthenticationTicket 時，我們必須撰寫程式碼來複寫 FormsAuthentication 類別已提供的許多功能。</span><span class="sxs-lookup"><span data-stu-id="122d2-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="122d2-376">讓我們來探索使用 UserData 的必要程式碼，方法是更新 Login .aspx 頁面，將使用者的其他資訊記錄到驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="122d2-377">假設我們的使用者存放區包含使用者適用之公司的相關資訊及其職稱，而我們想要在驗證票證中取得這項資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="122d2-378">更新 Login .aspx 頁面的 LoginButton Click 事件處理常式，以便程式碼看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="122d2-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample6.vb)]

<span data-ttu-id="122d2-379">讓我們一次逐步執行此程式碼一行。</span><span class="sxs-lookup"><span data-stu-id="122d2-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="122d2-380">方法一開始會定義四個字串陣列：使用者、密碼、公司名稱和 titleAtCompany。</span><span class="sxs-lookup"><span data-stu-id="122d2-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="122d2-381">這些陣列包含系統中使用者帳戶的使用者名稱、密碼、公司名稱和標題，其中有三個： Scott、Jisun 和 Sam。</span><span class="sxs-lookup"><span data-stu-id="122d2-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="122d2-382">在實際的應用程式中，會從使用者存放區中查詢這些值，而不是在頁面的原始程式碼中進行硬式編碼。</span><span class="sxs-lookup"><span data-stu-id="122d2-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="122d2-383">在上一個教學課程中，如果提供的認證有效，我們只會呼叫 FormsAuthentication. RedirectFromLoginPage （UserName. Text，RememberMe），這會執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="122d2-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="122d2-384">已建立表單驗證票證</span><span class="sxs-lookup"><span data-stu-id="122d2-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="122d2-385">已將票證寫入適當的存放區。</span><span class="sxs-lookup"><span data-stu-id="122d2-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="122d2-386">若為以 cookie 為基礎的驗證票證，則會使用瀏覽器的 cookie 集合;若為無 cookie 驗證票證，票證資料會序列化為 URL</span><span class="sxs-lookup"><span data-stu-id="122d2-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="122d2-387">將使用者重新導向至適當的頁面</span><span class="sxs-lookup"><span data-stu-id="122d2-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="122d2-388">這些步驟會在上述程式碼中複寫。</span><span class="sxs-lookup"><span data-stu-id="122d2-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="122d2-389">首先，最後要儲存在 UserData 屬性中的字串是藉由結合公司名稱和標題來形成，並將兩個值與一個管道字元（|）分隔。</span><span class="sxs-lookup"><span data-stu-id="122d2-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="122d2-390">Dim userDataString As String = String. Concat （公司名稱（i），"|"，titleAtCompany （i））</span><span class="sxs-lookup"><span data-stu-id="122d2-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span></span>

<span data-ttu-id="122d2-391">接下來，會叫用 FormsAuthentication. GetAuthCookie 方法，它會建立驗證票證、根據設定進行加密和驗證，並將其放在 HttpCookie 物件中。</span><span class="sxs-lookup"><span data-stu-id="122d2-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="122d2-392">Dim authCookie As HttpCookie = FormsAuthentication. GetAuthCookie （UserName. Text，RememberMe. Checked）</span><span class="sxs-lookup"><span data-stu-id="122d2-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span></span>

<span data-ttu-id="122d2-393">為了使用內嵌在 cookie 內的 FormAuthenticationTicket，我們需要呼叫 FormAuthentication 類別的[解密方法](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)，並傳入 cookie 值。</span><span class="sxs-lookup"><span data-stu-id="122d2-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="122d2-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication （authCookie 值）</span><span class="sxs-lookup"><span data-stu-id="122d2-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span></span>

<span data-ttu-id="122d2-395">然後，我們會根據現有的 FormsAuthenticationTicket 值，建立*新*的 FormsAuthenticationTicket 實例。</span><span class="sxs-lookup"><span data-stu-id="122d2-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="122d2-396">不過，這個新的票證包含使用者特定的資訊（userDataString）。</span><span class="sxs-lookup"><span data-stu-id="122d2-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="122d2-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket （ticket）。版本、票證。名稱、票證。IssueDate，票證。到期日，票證。IsPersistent、userDataString）</span><span class="sxs-lookup"><span data-stu-id="122d2-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span></span>

<span data-ttu-id="122d2-398">然後，我們會藉由呼叫[encrypt 方法](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)來加密（並驗證）新的 FormsAuthenticationTicket 實例，並將這個經過加密（並經過驗證）的資料放回 authCookie 中。</span><span class="sxs-lookup"><span data-stu-id="122d2-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="122d2-399">authCookie。 Value = FormsAuthentication （newTicket）</span><span class="sxs-lookup"><span data-stu-id="122d2-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span></span>

<span data-ttu-id="122d2-400">最後，authCookie 會新增至回應。 Cookie 集合和 GetRedirectUrl 方法會被呼叫，以決定要傳送給使用者的適當頁面。</span><span class="sxs-lookup"><span data-stu-id="122d2-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample7.vb)]

<span data-ttu-id="122d2-401">所有此程式碼都是必要的，因為 UserData 屬性是唯讀的，而 FormsAuthentication 類別並未提供任何方法來指定其 GetAuthCookie、SetAuthCookie 或 RedirectFromLoginPage 方法中的 UserData 資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-402">我們剛才檢查的程式碼會在以 cookie 為基礎的驗證票證中儲存使用者特定資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="122d2-403">負責將表單驗證票證序列化至 URL 的類別，是 .NET Framework 的內部。</span><span class="sxs-lookup"><span data-stu-id="122d2-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="122d2-404">短時間內，您無法將使用者資料儲存在無 cookie 的表單驗證票證中。</span><span class="sxs-lookup"><span data-stu-id="122d2-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="122d2-405">存取 UserData 資訊</span><span class="sxs-lookup"><span data-stu-id="122d2-405">Accessing the UserData Information</span></span>

<span data-ttu-id="122d2-406">此時，每個使用者的公司名稱和標題都會在登入時儲存在表單驗證票證的 UserData 屬性中。</span><span class="sxs-lookup"><span data-stu-id="122d2-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="122d2-407">此資訊可以從任何頁面上的驗證票證存取，而不需要使用者存放區。</span><span class="sxs-lookup"><span data-stu-id="122d2-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="122d2-408">為了說明如何從 UserData 屬性中抓取此資訊，讓我們更新 default.aspx，使其歡迎訊息不僅包含使用者的名稱，也包括其適用的公司及其職稱。</span><span class="sxs-lookup"><span data-stu-id="122d2-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="122d2-409">目前，default.aspx 包含具有名為 WelcomeBackMessage 之標籤控制項的 AuthenticatedMessagePanel 面板。</span><span class="sxs-lookup"><span data-stu-id="122d2-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="122d2-410">只有已驗證的使用者才會看到此面板。</span><span class="sxs-lookup"><span data-stu-id="122d2-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="122d2-411">更新 default.aspx 頁面中的程式碼\_載入事件處理常式，使其看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="122d2-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample8.vb)]

<span data-ttu-id="122d2-412">如果 IsAuthenticated 為 True，則 WelcomeBackMessage 的 Text 屬性會先設定為 [歡迎使用]、[使用者*名稱*]。</span><span class="sxs-lookup"><span data-stu-id="122d2-412">If Request.IsAuthenticated is True, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="122d2-413">然後，User. Identity 屬性會轉換成 FormsIdentity 物件，讓我們可以存取基礎 FormsAuthenticationTicket。</span><span class="sxs-lookup"><span data-stu-id="122d2-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="122d2-414">一旦有了 FormsAuthenticationTicket，我們就會將 UserData 屬性還原序列化為公司名稱和標題。</span><span class="sxs-lookup"><span data-stu-id="122d2-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="122d2-415">這是藉由在管道字元上分割字串來完成。</span><span class="sxs-lookup"><span data-stu-id="122d2-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="122d2-416">公司名稱和標題會顯示在 [WelcomeBackMessage] 標籤中。</span><span class="sxs-lookup"><span data-stu-id="122d2-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="122d2-417">[圖 5] 顯示此顯示動作的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="122d2-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="122d2-418">以 Scott 的身分登入，會顯示包含 Scott 公司和標題的歡迎後消息。</span><span class="sxs-lookup"><span data-stu-id="122d2-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="122d2-419">[顯示目前登入之使用者的公司和標題 ![](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span></span>

<span data-ttu-id="122d2-420">**圖 05**：顯示目前登入的使用者公司和標題（[按一下以觀看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-421">驗證票證的 UserData 屬性作為使用者存放區的快取。</span><span class="sxs-lookup"><span data-stu-id="122d2-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="122d2-422">就像任何快取一樣，修改基礎資料時需要更新它。</span><span class="sxs-lookup"><span data-stu-id="122d2-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="122d2-423">例如，如果有可讓使用者更新其設定檔的網頁，則必須重新整理 UserData 屬性中快取的欄位，以反映使用者所做的變更。</span><span class="sxs-lookup"><span data-stu-id="122d2-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="122d2-424">步驟5：使用自訂主體</span><span class="sxs-lookup"><span data-stu-id="122d2-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="122d2-425">在每個傳入要求中，又稱為 formsauthenticationmodule 會嘗試驗證使用者。</span><span class="sxs-lookup"><span data-stu-id="122d2-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="122d2-426">如果未過期的驗證票證存在，又稱為 formsauthenticationmodule 會將 HttpCoNtext 使用者屬性指派給新的 GenericPrincipal 物件。</span><span class="sxs-lookup"><span data-stu-id="122d2-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="122d2-427">這個 GenericPrincipal 物件具有 FormsIdentity 類型的身分識別，其中包含表單驗證票證的參考。</span><span class="sxs-lookup"><span data-stu-id="122d2-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="122d2-428">GenericPrincipal 類別包含實 IPrincipal 的類別所需的最小功能，它只具有 Identity 屬性和 IsInRole 方法。</span><span class="sxs-lookup"><span data-stu-id="122d2-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="122d2-429">主體物件有兩個責任：表示使用者所屬的角色，以及提供身分識別資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="122d2-430">這會分別透過 IPrincipal 介面的*IsInRole （「* 人」）方法和識別屬性來完成。</span><span class="sxs-lookup"><span data-stu-id="122d2-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="122d2-431">GenericPrincipal 類別可讓您透過其函式指定角色名稱的字串陣列;其*IsInRole （人員*）方法只會檢查字串陣列*中是否有傳入的用項*。</span><span class="sxs-lookup"><span data-stu-id="122d2-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="122d2-432">當又稱為 formsauthenticationmodule 建立 GenericPrincipal 時，它會將空字串陣列傳遞至 GenericPrincipal 的函式。</span><span class="sxs-lookup"><span data-stu-id="122d2-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="122d2-433">因此，任何對 IsInRole 的呼叫一律會傳回 False。</span><span class="sxs-lookup"><span data-stu-id="122d2-433">Consequently, any call to IsInRole will always return False.</span></span>

<span data-ttu-id="122d2-434">GenericPrincipal 類別符合大部分以表單為基礎的驗證案例的需求，其中不使用角色。</span><span class="sxs-lookup"><span data-stu-id="122d2-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="122d2-435">對於預設角色處理不足的情況，或當您需要將自訂 IIdentity 物件與使用者建立關聯時，您可以在驗證工作流程期間建立自訂 IPrincipal 物件，並將它指派給 HttpCoNtext 使用者屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-436">如我們在未來的教學課程中所見，ASP。NET 的 Roles framework 已啟用它會建立[RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx)類型的自訂主體物件，並覆寫表單驗證建立的 GenericPrincipal 物件。</span><span class="sxs-lookup"><span data-stu-id="122d2-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="122d2-437">它會執行這項工作，以自訂主體的 IsInRole 方法，以與角色架構的 API 互動。</span><span class="sxs-lookup"><span data-stu-id="122d2-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="122d2-438">因為我們還不在意角色，所以在這個位置建立自訂主體的唯一理由，就是將自訂 IIdentity 物件與主體建立關聯。</span><span class="sxs-lookup"><span data-stu-id="122d2-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="122d2-439">在步驟4中，我們探討了在驗證票證的 UserData 屬性中儲存額外的使用者資訊，特別是使用者的公司名稱和標題。</span><span class="sxs-lookup"><span data-stu-id="122d2-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="122d2-440">不過，只有透過驗證票證才可存取 UserData 資訊，而只是以序列化字串的形式，這表示每當我們想要查看儲存在票證中的使用者資訊時，我們需要剖析 UserData 屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="122d2-441">我們可以藉由建立一個可執行 IIdentity 的類別，並包含 [公司名稱] 和 [標題] 屬性來改善開發人員體驗。</span><span class="sxs-lookup"><span data-stu-id="122d2-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="122d2-442">如此一來，開發人員就可以直接透過 [公司名稱] 和 [標題] 屬性存取目前登入的使用者公司名稱和標題，而不需要知道如何剖析 UserData 屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="122d2-443">建立自訂身分識別和主體類別</span><span class="sxs-lookup"><span data-stu-id="122d2-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="122d2-444">在本教學課程中，我們將在應用程式中建立自訂主體和身分識別物件\_Code 資料夾。</span><span class="sxs-lookup"><span data-stu-id="122d2-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="122d2-445">首先，將應用程式\_Code 資料夾新增至您的專案-在方案總管中的專案名稱上按一下滑鼠右鍵，選取 [新增 ASP.NET 資料夾] 選項，然後選擇 [應用程式\_代碼]。</span><span class="sxs-lookup"><span data-stu-id="122d2-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="122d2-446">應用程式\_Code 資料夾是特殊的 ASP.NET 資料夾，其中包含網站特定的類別檔案。</span><span class="sxs-lookup"><span data-stu-id="122d2-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="122d2-447">只有在透過網站專案模型管理您的專案時，才應該使用 App\_程式碼資料夾。</span><span class="sxs-lookup"><span data-stu-id="122d2-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="122d2-448">如果您使用[Web 應用程式專案模型](https://msdn.microsoft.com/asp.net/Aa336618.aspx)，請建立標準資料夾，並將類別加入至其中。</span><span class="sxs-lookup"><span data-stu-id="122d2-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="122d2-449">例如，您可以新增名為 [類別] 的新資料夾，並將您的程式碼放在該處。</span><span class="sxs-lookup"><span data-stu-id="122d2-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="122d2-450">接下來，將兩個新的類別檔案新增至應用程式\_Code 資料夾，一個名為 CustomIdentity，另一個名為 CustomPrincipal。</span><span class="sxs-lookup"><span data-stu-id="122d2-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.vb and one named CustomPrincipal.vb.</span></span>

<span data-ttu-id="122d2-451">[![將 CustomIdentity 和 CustomPrincipal 類別新增至您的專案](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span></span>

<span data-ttu-id="122d2-452">**圖 06**：將 CustomIdentity 和 CustomPrincipal 類別新增至您的專案（[按一下以查看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span></span>

<span data-ttu-id="122d2-453">CustomIdentity 類別負責執行 IIdentity 介面，以定義 AuthenticationType、IsAuthenticated 和 Name 屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="122d2-454">除了這些必要的屬性之外，我們也想要公開基礎表單驗證票證，以及使用者的公司名稱和標題的屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="122d2-455">在 CustomIdentity 類別中輸入下列程式碼。</span><span class="sxs-lookup"><span data-stu-id="122d2-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample9.vb)]

<span data-ttu-id="122d2-456">請注意，類別包含 FormsAuthenticationTicket 成員變數（\_票證），而且必須透過此函式提供此票證資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="122d2-457">此票證資料是用來傳回身分識別的名稱。其 UserData 屬性會經過剖析，以傳回 [公司名稱] 和 [標題] 屬性的值。</span><span class="sxs-lookup"><span data-stu-id="122d2-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="122d2-458">接下來，建立 CustomPrincipal 類別。</span><span class="sxs-lookup"><span data-stu-id="122d2-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="122d2-459">由於我們並不在意角色，因此 CustomPrincipal 類別的函式只接受 CustomIdentity 物件;其 IsInRole 方法一律會傳回 False。</span><span class="sxs-lookup"><span data-stu-id="122d2-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns False.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample10.vb)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="122d2-460">將 CustomPrincipal 物件指派給連入要求的安全性內容</span><span class="sxs-lookup"><span data-stu-id="122d2-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="122d2-461">我們現在有一個類別，它會擴充預設 IIdentity 規格以包含 [公司名稱] 和 [標題] 屬性，以及使用自訂身分識別的自訂主體類別。</span><span class="sxs-lookup"><span data-stu-id="122d2-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="122d2-462">我們已準備好逐步執行 ASP.NET 管線，並將自訂主體物件指派給連入要求的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="122d2-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="122d2-463">ASP.NET 管線會接受傳入要求，並透過幾個步驟進行處理。</span><span class="sxs-lookup"><span data-stu-id="122d2-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="122d2-464">在每個步驟中，會引發特定事件，讓開發人員可以利用 ASP.NET 管線，並在其生命週期中的特定時間點修改要求。</span><span class="sxs-lookup"><span data-stu-id="122d2-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="122d2-465">例如，又稱為 formsauthenticationmodule 會等候 ASP.NET 引發[AuthenticateRequest 事件](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)，此時它會檢查驗證票證的連入要求。</span><span class="sxs-lookup"><span data-stu-id="122d2-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="122d2-466">如果找到驗證票證，則會建立 GenericPrincipal 物件，並將其指派給 HttpCoNtext 使用者屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="122d2-467">在 AuthenticateRequest 事件之後，ASP.NET 管線會引發[PostAuthenticateRequest 事件](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx)，我們可以在這裡將又稱為 formsauthenticationmodule 所建立的 GenericPrincipal 物件取代為 CustomPrincipal 物件的實例。</span><span class="sxs-lookup"><span data-stu-id="122d2-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="122d2-468">[圖 7] 說明此工作流程。</span><span class="sxs-lookup"><span data-stu-id="122d2-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="122d2-469">[![GenericPrincipal 由 PostAuthenticationRequest 事件中的 CustomPrincipal 所取代](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span></span>

<span data-ttu-id="122d2-470">**圖 07**： PostAuthenticationRequest 事件中的 CustomPrincipal 會取代 GenericPrincipal （[按一下以查看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span></span>

<span data-ttu-id="122d2-471">為了要執行程式碼以回應 ASP.NET 管線事件，我們可以在 global.asax 中建立適當的事件處理常式，或建立我們自己的 HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="122d2-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="122d2-472">在本教學課程中，我們將在 global.asax 中建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="122d2-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="122d2-473">首先，將 global.asax 加入您的網站。</span><span class="sxs-lookup"><span data-stu-id="122d2-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="122d2-474">在方案總管中，以滑鼠右鍵按一下專案名稱，並加入名為 global 的全域應用程式類別的專案。</span><span class="sxs-lookup"><span data-stu-id="122d2-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="122d2-475">[![將 global.asax 檔案新增至您的網站](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="122d2-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span></span>

<span data-ttu-id="122d2-476">**圖 08**：將 Global.asax 檔案新增至您的網站（[按一下以觀看完整大小的影像](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="122d2-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span></span>

<span data-ttu-id="122d2-477">預設的 global.asax 範本包含數個 ASP.NET 管線事件的事件處理常式，包括開始、結束和[錯誤事件](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx)等等。</span><span class="sxs-lookup"><span data-stu-id="122d2-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="122d2-478">請隨意移除這些事件處理常式，因為此應用程式不需要它們。</span><span class="sxs-lookup"><span data-stu-id="122d2-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="122d2-479">我們感興趣的事件是 PostAuthenticateRequest。</span><span class="sxs-lookup"><span data-stu-id="122d2-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="122d2-480">更新您的 global.asax 檔案，讓其標記看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="122d2-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample11.aspx)]

<span data-ttu-id="122d2-481">每當 ASP.NET 執行時間引發 PostAuthenticateRequest 事件時，就會執行應用程式\_OnPostAuthenticateRequest 方法，這會在每個傳入的頁面要求上發生一次。</span><span class="sxs-lookup"><span data-stu-id="122d2-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="122d2-482">事件處理常式一開始會先檢查使用者是否經過驗證，並通過表單驗證驗證。</span><span class="sxs-lookup"><span data-stu-id="122d2-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="122d2-483">若是如此，就會建立新的 CustomIdentity 物件，並在其函式中傳遞目前要求的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="122d2-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="122d2-484">之後，就會建立 CustomPrincipal 物件，並在其函式中傳遞剛建立的 CustomIdentity 物件。</span><span class="sxs-lookup"><span data-stu-id="122d2-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="122d2-485">最後，會將目前要求的安全性內容指派給新建立的 CustomPrincipal 物件。</span><span class="sxs-lookup"><span data-stu-id="122d2-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="122d2-486">請注意，最後一個步驟是將 CustomPrincipal 物件與要求的安全性內容產生關聯-將主體指派給兩個屬性： HttpCoNtext. User 和 Thread.currentprincipal。</span><span class="sxs-lookup"><span data-stu-id="122d2-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="122d2-487">這兩個指派是必要的，因為在 ASP.NET 中處理安全性內容的方式。</span><span class="sxs-lookup"><span data-stu-id="122d2-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="122d2-488">.NET Framework 會將安全性內容與每個執行中的執行緒產生關聯;這種資訊是透過[Thread 物件](https://msdn.microsoft.com/library/system.threading.thread.aspx)的[thread.currentprincipal 屬性](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx)，以 IPrincipal 物件的形式提供。</span><span class="sxs-lookup"><span data-stu-id="122d2-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="122d2-489">令人困惑的是，ASP.NET 有自己的安全性內容資訊（HttpCoNtext）。</span><span class="sxs-lookup"><span data-stu-id="122d2-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="122d2-490">在某些情況下，會在判斷安全性內容時檢查 Thread.currentprincipal 屬性。在其他情況下，則會使用 HttpCoNtext。</span><span class="sxs-lookup"><span data-stu-id="122d2-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="122d2-491">例如，.NET 中有一些安全性功能，可讓開發人員以宣告方式指出哪些使用者或角色可以具現化類別，或叫用特定方法（請參閱[使用 PrincipalPermissionAttributes 將授權規則新增至商務和資料層](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)）。</span><span class="sxs-lookup"><span data-stu-id="122d2-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="122d2-492">在幕後，這些宣告式技術會透過 Thread.currentprincipal 屬性來判斷安全性內容。</span><span class="sxs-lookup"><span data-stu-id="122d2-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="122d2-493">在其他案例中，會使用 HttpCoNtext. User 屬性。</span><span class="sxs-lookup"><span data-stu-id="122d2-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="122d2-494">例如，在上一個教學課程中，我們使用這個屬性來顯示目前登入的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="122d2-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="122d2-495">很明顯地，Thread.currentprincipal 和 HttpCoNtext 等使用者屬性中的安全性內容資訊必須相符。</span><span class="sxs-lookup"><span data-stu-id="122d2-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="122d2-496">ASP.NET 執行時間會自動為我們同步處理這些屬性值。</span><span class="sxs-lookup"><span data-stu-id="122d2-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="122d2-497">不過，此同步處理會在 AuthenticateRequest 事件之後，但在 PostAuthenticateRequest 事件*之前*發生。</span><span class="sxs-lookup"><span data-stu-id="122d2-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="122d2-498">因此，在 PostAuthenticateRequest 事件中新增自訂主體時，我們必須確定手動指派 Thread.currentprincipal 或 Thread.currentprincipal 和 HttpCoNtext。使用者將不會同步。如需此問題的詳細討論，請參閱[CoNtext. thread.currentprincipal。](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/)</span><span class="sxs-lookup"><span data-stu-id="122d2-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="122d2-499">存取 [公司名稱] 和 [標題] 屬性</span><span class="sxs-lookup"><span data-stu-id="122d2-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="122d2-500">每當要求抵達並分派至 ASP.NET 引擎時，就會引發 global.asax 中的應用程式\_OnPostAuthenticateRequest 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="122d2-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="122d2-501">如果要求已由又稱為 formsauthenticationmodule 成功驗證，則事件處理常式會根據表單驗證票證，建立具有 CustomIdentity 物件的新 CustomPrincipal 物件。</span><span class="sxs-lookup"><span data-stu-id="122d2-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="122d2-502">有了這個邏輯，存取目前登入之使用者的公司名稱和標題的相關資訊相當簡單。</span><span class="sxs-lookup"><span data-stu-id="122d2-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="122d2-503">回到 default.aspx 的頁面\_載入事件處理常式，在步驟4中，我們撰寫了程式碼來抓取表單驗證票證，並剖析 UserData 屬性以顯示使用者的公司名稱和標題。</span><span class="sxs-lookup"><span data-stu-id="122d2-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="122d2-504">現在使用 CustomPrincipal 和 CustomIdentity 物件，就不需要剖析票證的 UserData 屬性的值。</span><span class="sxs-lookup"><span data-stu-id="122d2-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="122d2-505">相反地，只要取得 CustomIdentity 物件的參考，並使用其 [公司名稱] 和 [標題] 屬性即可：</span><span class="sxs-lookup"><span data-stu-id="122d2-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample12.vb)]

## <a name="summary"></a><span data-ttu-id="122d2-506">總結</span><span class="sxs-lookup"><span data-stu-id="122d2-506">Summary</span></span>

<span data-ttu-id="122d2-507">在本教學課程中，我們已檢查如何透過 Web.config 自訂表單驗證系統的設定。我們探討了如何處理驗證票證的到期日，以及如何使用加密和驗證保護措施來保護票證，使其無法進行檢查和修改。</span><span class="sxs-lookup"><span data-stu-id="122d2-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="122d2-508">最後，我們討論過使用驗證票證的 UserData 屬性，將其他使用者資訊儲存在票證本身，以及如何使用自訂主體和身分識別物件，以更方便開發人員的方式來公開這項資訊。</span><span class="sxs-lookup"><span data-stu-id="122d2-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="122d2-509">本教學課程將說明如何在 ASP.NET 中檢查表單驗證。</span><span class="sxs-lookup"><span data-stu-id="122d2-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="122d2-510">下一個教學課程會開始我們的成員資格架構旅程。</span><span class="sxs-lookup"><span data-stu-id="122d2-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="122d2-511">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="122d2-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="122d2-512">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="122d2-512">Further Reading</span></span>

<span data-ttu-id="122d2-513">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="122d2-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="122d2-514">剖析表單驗證</span><span class="sxs-lookup"><span data-stu-id="122d2-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="122d2-515">說明： ASP.NET 2.0 中的表單驗證</span><span class="sxs-lookup"><span data-stu-id="122d2-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="122d2-516">如何：保護 ASP.NET 2.0 中的表單驗證</span><span class="sxs-lookup"><span data-stu-id="122d2-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="122d2-517">[Professional ASP.NET 2.0 安全性、成員資格和角色管理](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html)（ISBN：978-0-7645-9698-8）</span><span class="sxs-lookup"><span data-stu-id="122d2-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="122d2-518">保護登入控制項</span><span class="sxs-lookup"><span data-stu-id="122d2-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="122d2-519">&lt;authentication&gt; 元素</span><span class="sxs-lookup"><span data-stu-id="122d2-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="122d2-520">&lt;驗證的 &lt;表單&gt; 元素&gt;</span><span class="sxs-lookup"><span data-stu-id="122d2-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="122d2-521">&lt;machineKey&gt; 元素</span><span class="sxs-lookup"><span data-stu-id="122d2-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="122d2-522">瞭解表單驗證票證和 Cookie</span><span class="sxs-lookup"><span data-stu-id="122d2-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="122d2-523">本教學課程中所含主題的影片訓練</span><span class="sxs-lookup"><span data-stu-id="122d2-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="122d2-524">如何變更表單驗證屬性</span><span class="sxs-lookup"><span data-stu-id="122d2-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="122d2-525">如何在 ASP.NET 應用程式中設定並使用無 Cookie 驗證</span><span class="sxs-lookup"><span data-stu-id="122d2-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="122d2-526">ASP 表單登入重新配置</span><span class="sxs-lookup"><span data-stu-id="122d2-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="122d2-527">表單登入自訂金鑰組態</span><span class="sxs-lookup"><span data-stu-id="122d2-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="122d2-528">將自訂資料新增至驗證方法</span><span class="sxs-lookup"><span data-stu-id="122d2-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="122d2-529">使用自訂的主體物件</span><span class="sxs-lookup"><span data-stu-id="122d2-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="122d2-530">關於作者</span><span class="sxs-lookup"><span data-stu-id="122d2-530">About the Author</span></span>

<span data-ttu-id="122d2-531">Scott Mitchell，自1998起，有多個 ASP/ASP. NET 書籍和創辦人的4GuysFromRolla.com。</span><span class="sxs-lookup"><span data-stu-id="122d2-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="122d2-532">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="122d2-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="122d2-533">他的最新著作是 *[在24小時內讓自己的 ASP.NET 2.0](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* 。</span><span class="sxs-lookup"><span data-stu-id="122d2-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="122d2-534">Scott 可以在[mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)或透過他在[http://ScottOnWriting.NET](http://scottonwriting.net/)的 blog。</span><span class="sxs-lookup"><span data-stu-id="122d2-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="122d2-535">特別感謝</span><span class="sxs-lookup"><span data-stu-id="122d2-535">Special Thanks To</span></span>

<span data-ttu-id="122d2-536">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="122d2-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="122d2-537">本教學課程的領導審查者為 Alicja Maziarz。</span><span class="sxs-lookup"><span data-stu-id="122d2-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="122d2-538">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="122d2-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="122d2-539">若是如此，請在[mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com)的那一行下拉式。</span><span class="sxs-lookup"><span data-stu-id="122d2-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="122d2-540">上一篇</span><span class="sxs-lookup"><span data-stu-id="122d2-540">Previous</span></span>](an-overview-of-forms-authentication-vb.md)
