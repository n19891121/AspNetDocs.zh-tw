---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: 表單驗證組態和進階的主題 (C#) |Microsoft Docs
author: rick-anderson
description: 在本教學課程，我們會檢查各種表單驗證設定，並了解如何透過表單項目來修改它們。 這會需要詳細...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: 9665dafb23b885fdf9e4ea5f1a515a0c6dcc9a9a
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/09/2019
ms.locfileid: "59410626"
---
# <a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="6cb3d-104">表單驗證組態和進階主題 (C#)</span><span class="sxs-lookup"><span data-stu-id="6cb3d-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>

<span data-ttu-id="6cb3d-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6cb3d-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6cb3d-106">[下載程式碼](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip)或[下載 PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="6cb3d-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="6cb3d-107">在本教學課程，我們會檢查各種表單驗證設定，並了解如何透過表單項目來修改它們。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="6cb3d-108">這將需要深入了解自訂表單驗證票證逾時值，使用自訂的 URL （例如 SignIn.aspx 而不是 Login.aspx) 和 cookieless 表單驗證票證的登入頁面。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>


## <a name="introduction"></a><span data-ttu-id="6cb3d-109">簡介</span><span class="sxs-lookup"><span data-stu-id="6cb3d-109">Introduction</span></span>

<span data-ttu-id="6cb3d-110">在 [先前的教學課程](an-overview-of-forms-authentication-cs.md)我們探討了 ASP.NET 應用程式中，從 Web.config 中指定組態設定，來建立頁面，即可顯示的記錄檔不同實作表單驗證所需的步驟已驗證和匿名使用者的內容。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="6cb3d-111">您應該記得，我們將網站設定為使用表單驗證，藉由設定目的 mode 屬性&lt;驗證&gt;form 項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="6cb3d-112">&lt;驗證&gt;項目可選擇性地包含&lt;form&gt;子項目，可能會指定表單驗證設定的分類。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="6cb3d-113">在本教學課程中我們將檢查各種表單驗證設定，並了解如何透過修改&lt;form&gt;項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="6cb3d-114">這將需要深入了解自訂表單驗證票證逾時值，使用自訂的 URL （例如 SignIn.aspx 而不是 Login.aspx) 和 cookieless 表單驗證票證的登入頁面。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="6cb3d-115">我們也會更仔細檢查表單驗證票證的結構，並請參閱 ASP.NET 會以確保票券的資料是從檢查和竄改的安全預防措施。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="6cb3d-116">最後，我們將探討如何將額外的使用者資料儲存在表單驗證票證，以及如何建立自訂的主體物件透過此資料的模型。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="6cb3d-117">步驟 1：檢查&lt;form&gt;組態設定</span><span class="sxs-lookup"><span data-stu-id="6cb3d-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="6cb3d-118">在 ASP.NET 表單驗證系統提供的可自訂的應用程式的應用程式為基礎的組態設定。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="6cb3d-119">這包括設定，例如： 存留期的表單驗證票證;哪些種類的保護套用至票證;在哪些條件 cookieless 驗證票證才能使用;登入 頁面中，路徑和其他資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="6cb3d-120">若要修改預設值，將[ &lt;form&gt;項目](https://msdn.microsoft.com/library/1d3t3c61.aspx)為子系[&lt;驗證&gt;項目](https://msdn.microsoft.com/library/532aee0e.aspx)，指定這些屬性您想要自訂為 XML 屬性的值，就像這樣：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="6cb3d-121">表 1 摘要說明您可以透過自訂的屬性&lt;form&gt;項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="6cb3d-122">Web.config 是一個 XML 檔案，因為在左側的資料行中的屬性名稱會區分大小寫。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>


| <strong><span data-ttu-id="6cb3d-123">屬性</span><span class="sxs-lookup"><span data-stu-id="6cb3d-123">Attribute</span></span></strong> |                                                                                                                                                                                                                                     <strong><span data-ttu-id="6cb3d-124">描述</span><span class="sxs-lookup"><span data-stu-id="6cb3d-124">Description</span></span></strong>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="6cb3d-125">cookieless</span><span class="sxs-lookup"><span data-stu-id="6cb3d-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="6cb3d-126">這個屬性會指定在哪些情況下驗證票證會儲存在 cookie 中與內嵌在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="6cb3d-127">允許的值如下：UseCookies;UseUri;自動偵測;和 UseDeviceProfile （預設值）。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="6cb3d-128">步驟 2 會檢查此詳細的設定。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="6cb3d-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="6cb3d-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="6cb3d-130">指出使用者重新導向至未於 querystring 中指定的 RedirectUrl 值是否從登入頁面登入後的 URL。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="6cb3d-131">預設值為 default.aspx。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="6cb3d-132">網域</span><span class="sxs-lookup"><span data-stu-id="6cb3d-132">domain</span></span>           | <span data-ttu-id="6cb3d-133">當使用以 cookie 為基礎的驗證票證，則此設定會指定 cookie 的網域值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="6cb3d-134">預設值是空字串，這會導致瀏覽器使用從中它已發行 （例如 www.yourdomain.com) 的網域。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="6cb3d-135">在此情況下，將會在 cookie<strong>不</strong>子網域，例如 admin.yourdomain.com 進行要求時傳送。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="6cb3d-136">如果您想要傳遞至所有子網域，您需要自訂網域屬性將它設定為 yourdomain.com cookie。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="6cb3d-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="6cb3d-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="6cb3d-138">布林值，指出是否在同一部伺服器上的其他 web 應用程式重新導向至 Url 時，是否需要記住已驗證的使用者。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="6cb3d-139">預設為 false。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="6cb3d-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="6cb3d-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="6cb3d-141">登入頁面的 URL。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-141">The URL of the login page.</span></span> <span data-ttu-id="6cb3d-142">預設值為 login.aspx。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="6cb3d-143">名稱</span><span class="sxs-lookup"><span data-stu-id="6cb3d-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="6cb3d-144">當使用以 cookie 為基礎的驗證票證的 cookie 名稱。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="6cb3d-145">預設值為。ASPXAUTH。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="6cb3d-146">路徑</span><span class="sxs-lookup"><span data-stu-id="6cb3d-146">path</span></span>            |                                                                             <span data-ttu-id="6cb3d-147">當使用以 cookie 為基礎的驗證票證，則此設定會指定 cookie 的路徑屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-147">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="6cb3d-148">Path 屬性可讓開發人員限制至特定的目錄階層的 cookie 的範圍。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="6cb3d-149">預設值是，/，而這會通知傳送到任何加入網域所提出的要求的驗證票證 cookie 的瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="6cb3d-150">保護</span><span class="sxs-lookup"><span data-stu-id="6cb3d-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="6cb3d-151">指示何種技術用來保護表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="6cb3d-152">允許的值為：全部 （預設值）;加密;無。和驗證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="6cb3d-153">在步驟 3 中詳細討論這些設定。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="6cb3d-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="6cb3d-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="6cb3d-155">布林值，指出是否需要 SSL 連線來傳送驗證 cookie。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="6cb3d-156">預設值為 false。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="6cb3d-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="6cb3d-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="6cb3d-158">布林值，指出是否每次重設驗證 cookie 逾時使用者造訪網站的單一工作階段期間。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-158">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="6cb3d-159">預設值為 true。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-159">The default value is true.</span></span> <span data-ttu-id="6cb3d-160">驗證票證逾時原則也會討論更詳細地指定票證逾時值一節。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="6cb3d-161">逾時</span><span class="sxs-lookup"><span data-stu-id="6cb3d-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="6cb3d-162">指定以分鐘為單位，驗證票證 cookie 到期之前的時間。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="6cb3d-163">預設值為 30。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-163">The default value is 30.</span></span> <span data-ttu-id="6cb3d-164">驗證票證逾時原則也會討論更詳細地指定票證逾時值一節。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="6cb3d-165">**表 1**:摘要&lt;form&gt;項目的屬性</span><span class="sxs-lookup"><span data-stu-id="6cb3d-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="6cb3d-166">在 ASP.NET 2.0 和更新版本，預設值的表單驗證的值會是硬式編碼 FormsAuthenticationConfiguration 類別在.NET Framework 中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="6cb3d-167">上的 Web.config 檔案中的應用程式的應用程式為基礎，就必須套用的任何修改。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="6cb3d-168">這不同於 ASP.NET 1.x 中，預設表單驗證值儲存在 machine.config 檔案中 （而因此無法修改透過編輯 machine.config）。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="6cb3d-169">在 ASP.NET 中的主題 1.x，或許值得對提及的表單驗證系統設定的數字有不同的預設值，在 ASP.NET 2.0 中和未來展望比在 ASP.NET 1.x。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="6cb3d-170">如果您從 ASP.NET 1.x 環境移轉您的應用程式，務必注意這些差異。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="6cb3d-171">請參閱[ &lt;form&gt;項目技術的文件](https://msdn.microsoft.com/library/1d3t3c61.aspx)如需差異的清單。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-172">數個表單驗證設定，例如逾時、 網域及路徑中，指定產生的表單驗證票證 cookie 的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="6cb3d-173">如需有關 cookie、 其運作方式，以及它們的各種屬性的詳細資訊，請參閱[本教學課程中的 Cookie](http://www.quirksmode.org/js/cookies.html)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>


### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="6cb3d-174">指定票證逾時值</span><span class="sxs-lookup"><span data-stu-id="6cb3d-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="6cb3d-175">表單驗證票證是表示身分識別的權杖。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="6cb3d-176">使用以 cookie 為基礎的驗證票證，會保留在 cookie 形式這個語彙基元，並將其傳送至 web 伺服器上每個要求中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="6cb3d-177">基本上，宣告的權杖的擁有權，我*username*，我已經登入，並使用，因此在網頁瀏覽系統可記住使用者的身分識別。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="6cb3d-178">表單驗證票證不只包含使用者的身分識別，但也包含可協助確保完整性與安全性權杖的資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="6cb3d-179">畢竟，我們不想惡意使用者可以建立的盜版的語彙基元，或修改某些 underhanded 的方式與合適的語彙基元。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="6cb3d-180">是一個這類票證中包含的位元*到期*，這是票證已不再有效的時間與日期。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="6cb3d-181">它可確保 FormsAuthenticationModule 會檢查驗證票證，每次會將票證到期日不具有尚未成功。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="6cb3d-182">如果是，它會忽略該票證，並識別為匿名使用者。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="6cb3d-183">此保護有助於防範重新執行攻擊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="6cb3d-184">沒有到期日，如果駭客已能夠實體存取其電腦，並瀏覽其 cookie 可能取得使用者的有效驗證票證-她實習-他們可以將要求傳送至具有此竊取的驗證票證的伺服器和取得項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="6cb3d-185">到期不會防止這種情況下，它會限制這類攻擊會成功期間的視窗。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-186">步驟 3 的表單驗證系統用來保護驗證票證的詳細資料其他技巧。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>


<span data-ttu-id="6cb3d-187">當建立驗證票證，表單驗證系統會判斷其到期 consulting 逾時設定。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="6cb3d-188">表 1，逾時設定預設值為 30 分鐘，所述，這表示表單驗證票證建立時的日期和時間在未來 30 分鐘內設定其到期。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="6cb3d-189">過期狀態定義絕對未來表單驗證票證到期的時間。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="6cb3d-190">但是，開發人員通常想要實作滑動過期，就會在每次使用者重新審視站台重設的其中一個。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="6cb3d-191">此行為取決於 slidingExpiration 設定。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="6cb3d-192">如果設為 true （預設值），的每當 FormsAuthenticationModule 驗證使用者時，便會更新票證到期日。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="6cb3d-193">如果設為 false，到期不會更新每個要求，因而導致票證過期完全逾時分鐘數超過第一次票證被建立。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-194">儲存驗證票證在過期狀態是為絕對日期和時間值，例如 2008 年 8 月 2 日上午 11:34。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="6cb3d-195">此外，日期和時間會相對於 web 伺服器的本機時間。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="6cb3d-196">此設計決策可能有一些有趣的副作用周圍日光節約時間 (DST)，也就是在美國境內的時鐘移動繼續進行 （假設在觀察到日光節約時間的地區設定中裝載 web 伺服器） 的一小時時。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="6cb3d-197">請考慮會發生什麼情況的 DST 開始的時間附近的 30 分鐘到期與 ASP.NET 網站 （此為上午 2:00）。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="6cb3d-198">想像一下訪客登入站台在 2008 年 3 月 11 日上午 1:55。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="6cb3d-199">這會產生表單驗證票證到期在 2008 年 3 月 11 日上午 2:25 （在未來 30 分鐘）。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="6cb3d-200">不過，一旦 2:00 AM 彙周圍，時鐘會跳到上午 3:00 因為 DST。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="6cb3d-201">當使用者載入新的頁面六分鐘內 （上午 3:01） 登入之後時，票證已過期，將使用者重新導向至登入頁面會註明 FormsAuthenticationModule。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="6cb3d-202">這和其他驗證票證逾時奇觀，以及因應措施的深入討論，請選擇一份 Stefan Schackow *Professional ASP.NET 2.0 安全性、 成員資格和角色管理*(ISBN:978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="6cb3d-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>


<span data-ttu-id="6cb3d-203">圖 1 說明的工作流程，當 slidingExpiration 設為 false，而且逾時設定為 30。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="6cb3d-204">請注意，在登入時所產生的驗證票證包含到期日，在後續要求將不會更新這個值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="6cb3d-205">如果 FormsAuthenticationModule 找到票證已過期，它會捨棄它，並要求視為匿名。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>


[![A <span data-ttu-id="6cb3d-206">表單驗證票證到期時 slidingExpiration 圖形表示法為偽]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-206">Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)

<span data-ttu-id="6cb3d-207">**圖 01**:以圖形表示的表單驗證票證到期時 slidingExpiration 為 false ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>


<span data-ttu-id="6cb3d-208">圖 2 顯示工作流程，當 slidingExpiration 設為 true，且逾時設定為 30。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="6cb3d-209">已驗證的要求收到 （具有未過期的票證） 時屆到期會更新為在未來分鐘的逾時數中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>


[![A <span data-ttu-id="6cb3d-210">表單驗證票證的圖形表示法 slidingExpiration 為 true 時]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-210">Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)

<span data-ttu-id="6cb3d-211">**圖 02**:以圖形表示的表單驗證票證的 slidingExpiration 時，則為 true ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>


<span data-ttu-id="6cb3d-212">當使用以 cookie 為基礎的驗證票證 （預設值），在本文中會變成更令人困惑，因為 cookie 也可以指定自己 expiries。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="6cb3d-213">Cookie 的到期 （或無區域性） 會指示瀏覽器時 cookie 應該予以終結。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="6cb3d-214">如果 cookie 缺少有效期限，它會終結瀏覽器關閉時。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="6cb3d-215">如果到期，則 cookie 到期的日期保留在使用者電腦上儲存但已超過指定時間的過期狀態。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="6cb3d-216">Cookie 終結時，瀏覽器，它不會再傳送至 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="6cb3d-217">因此，損毀是 cookie 的類似於使用者登出網站記錄。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-218">當然，使用者可以主動移除儲存在他們的電腦上的所有 cookie。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="6cb3d-219">在 Internet Explorer 7，您會前往 工具，選項，然後按一下 瀏覽歷程記錄區段中的 刪除 按鈕。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="6cb3d-220">從該處按一下 [刪除 cookies] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-220">From there, click the Delete cookies button.</span></span>


<span data-ttu-id="6cb3d-221">表單驗證系統會建立工作階段或到期日為基礎的 cookie 傳遞給的值而定*persistCookie*參數。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="6cb3d-222">回想一下，FormsAuthentication 類別的 GetAuthCookie、 SetAuthCookie 和 RedirectFromLoginPage 方法會採用兩個輸入參數：*使用者名稱*並*persistCookie*。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="6cb3d-223">我們在先前的教學課程中建立的登入頁面包含記住我 核取方塊，判斷是否已建立永續性 cookie。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="6cb3d-224">持續性 cookie 則到期日為基礎;非持續性 cookie，則工作階段為基礎。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="6cb3d-225">已經討論過的逾時和 slidingExpiration 概念適用於相同這兩個工作階段和到期日為基礎的 cookie。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="6cb3d-226">沒有在執行中只能有一個很小的差異： 搭配使用時到期日為基礎的 cookie slidingTimeout 設為 true，cookie 的到期日，才會更新時超過一半的指定時間已過。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="6cb3d-227">因此，票證逾時之後一小時 （60 分鐘），使用滑動期限，讓我們更新我們的網站驗證票證逾時原則。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="6cb3d-228">若要影響這項變更，更新 Web.config 檔案中，新增&lt;form&gt;項目&lt;驗證&gt;以下列標記的項目：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="6cb3d-229">使用 Login.aspx 以外的登入頁面 URL</span><span class="sxs-lookup"><span data-stu-id="6cb3d-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="6cb3d-230">FormsAuthenticationModule 自動將未經授權的使用者重新導向至登入頁面，因為它需要知道登入頁面的 URL。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="6cb3d-231">此 URL 中的 loginUrl 屬性所指定&lt;form&gt;項目，預設值為 login.aspx。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="6cb3d-232">如果您要移植現有的網站上，您可能已經有不同的 URL，其中已設為書籤並由搜尋引擎編製索引的登入頁面。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="6cb3d-233">而不是重新命名現有的登入頁面到 login.aspx 和中斷連結和使用者的書籤，您可以改為修改 loginUrl 屬性以指向您的登入頁面。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="6cb3d-234">比方說，如果您登入頁面命名為 SignIn.aspx，而且已位於使用者的目錄中，您可以指向 loginUrl 組態設定，以 ~/Users/SignIn.aspx 就像這樣：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="6cb3d-235">我們目前應用程式已經具有名為 Login.aspx 的登入頁面，因為沒有指定自訂值中的不需要&lt;form&gt;項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="6cb3d-236">步驟 2：使用 Cookieless 表單驗證票證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="6cb3d-237">根據預設表單驗證系統會決定是否要儲存其驗證票證的 cookie 集合中，或將其內嵌在造訪該網站的使用者代理程式為基礎的 URL。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="6cb3d-238">所有主流的桌面瀏覽器讓 Internet Explorer、 Firefox、 Opera 和 Safari 支援 cookie，但並非所有的行動裝置。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="6cb3d-239">使用表單驗證系統的 cookie 原則取決於在無 cookie 的設定&lt;form&gt;項目，可以指派四個值之一：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="6cb3d-240">UseCookies-指定將一律使用以 cookie 為基礎的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="6cb3d-241">UseUri-表示將永遠不會使用以 cookie 為基礎的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="6cb3d-242">不會自動偵測-如果裝置設定檔不支援以 cookie 為基礎的驗證票證的 cookie;如果裝置設定檔支援 cookie，探查機制用來判斷是否已啟用 cookie。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="6cb3d-243">UseDeviceProfile-預設值;只有當裝置設定檔支援 cookie，請使用以 cookie 為基礎的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="6cb3d-244">會不使用任何探查機制。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-244">No probing mechanism is used.</span></span>

<span data-ttu-id="6cb3d-245">自動偵測及 UseDeviceProfile 設定依賴*裝置設定檔*中查明是否會使用以 cookie 為基礎或無 cookie 驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="6cb3d-246">ASP.NET 會維護各種裝置和其功能，例如它們是否支援 cookie，其所支援的 JavaScript 等等的什麼版本的資料庫。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="6cb3d-247">每次裝置網頁從 web 伺服器要求不會沿著*使用者代理程式*識別的裝置類型的 HTTP 標頭。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="6cb3d-248">ASP.NET 會自動符合提供的使用者代理程式字串與對應其資料庫中指定的設定檔。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-249">裝置功能的這個資料庫會儲存在多個 XML 檔案符合[瀏覽器定義檔結構描述](https://msdn.microsoft.com/library/ms228122.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="6cb3d-250">預設的裝置設定檔檔案位於 %windir%\microsoft.net\framework\v2.0.50727\config\browsers。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="6cb3d-251">您也可以將自訂的檔案加入您的應用程式的應用程式\_瀏覽器資料夾。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="6cb3d-252">如需詳細資訊，請參閱[How To:ASP.NET Web pages 中偵測瀏覽器類型](https://msdn.microsoft.com/library/3yekbd5b.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>


<span data-ttu-id="6cb3d-253">因為預設值是 UseDeviceProfile，當其設定檔會報告它不支援 cookie 的裝置瀏覽網站時將使用 cookieless 表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="6cb3d-254">編碼 URL 中的驗證票證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="6cb3d-255">Cookie 是自然的中型至特定網站，這就是為什麼預設表單驗證設定會使用 cookie，如果正在瀏覽的裝置支援它們的每個要求中包含從瀏覽器的資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="6cb3d-256">若不支援 cookie，就必須採用替代方式來將從用戶端的驗證票證傳遞至伺服器。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="6cb3d-257">使用無 cookie 的環境中常見的解決方法是編碼在 URL 中的 cookie 資料。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="6cb3d-258">若要查看如何內嵌這類資訊，在 url 的最佳方式是要強制站台使用無 cookie 驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="6cb3d-259">這可藉由將無 cookie 的組態設定至 UseUri:</span><span class="sxs-lookup"><span data-stu-id="6cb3d-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="6cb3d-260">一旦您進行這項變更，請瀏覽的網站，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="6cb3d-261">當匿名使用者的身分瀏覽，Url 看起來如同之前一樣。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="6cb3d-262">比方說，瀏覽 Default.aspx 頁面時我的瀏覽器網址列會顯示下列 URL:</span><span class="sxs-lookup"><span data-stu-id="6cb3d-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="6cb3d-263">不過，在登入時，表單驗證票證將內嵌 URL。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="6cb3d-264">比方說，瀏覽登入頁面，並以 Sam 身分登入之後, 我回到 Default.aspx 頁面上，但 URL 這次是：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="6cb3d-265">表單驗證票證已內嵌在 url 中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="6cb3d-266">字串 (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv rfezq0gKadKX0YPZCkA2) 代表十六進位編碼的驗證票證資訊，而且是相同的資料通常儲存在 cookie 中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="6cb3d-267">為了讓運作的無 cookie 驗證票證，系統必須編碼在頁面上的所有 Url，以包含驗證票券資料，否則當使用者按一下連結時的驗證票證將會遺失。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="6cb3d-268">幸好這個內嵌的邏輯會自動執行。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="6cb3d-269">為了示範這項功能，請開啟 Default.aspx 頁面，並新增超連結控制項，將其文字和 NavigateUrl 屬性分別設定為 [測試] 連結和 SomePage.aspx。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="6cb3d-270">它並不重要，根本沒有頁面在名為 SomePage.aspx 專案。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="6cb3d-271">將變更儲存至 Default.aspx，然後透過瀏覽器瀏覽它。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="6cb3d-272">使表單驗證票證會內嵌在 URL 中登入網站。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="6cb3d-273">接下來，從 Default.aspx，按一下 [測試連結] 連結。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="6cb3d-274">發生什麼情況？</span><span class="sxs-lookup"><span data-stu-id="6cb3d-274">What happened?</span></span> <span data-ttu-id="6cb3d-275">如果存在名為 SomePage.aspx 沒有頁面，然後 404 錯誤發生，但不是重要這裡。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="6cb3d-276">相反地，著重於在瀏覽器中的 [網址] 列。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="6cb3d-277">請注意，在 URL 中包含表單驗證票證 ！</span><span class="sxs-lookup"><span data-stu-id="6cb3d-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="6cb3d-278">在連線 URL SomePage.aspx 已自動轉換成包含驗證 ticket-URL 我們不必撰寫可靠的程式碼 ！</span><span class="sxs-lookup"><span data-stu-id="6cb3d-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="6cb3d-279">表單驗證票證自動將不會啟動與任何超連結 URL 中內嵌`http://`或`/`。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with `http://` or `/`.</span></span> <span data-ttu-id="6cb3d-280">如果超連結出現 Response.Redirect 呼叫、 超連結控制項，或錨定 HTML 項目並不重要 (亦即， `<a href="...">...</a>`)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., `<a href="...">...</a>`).</span></span> <span data-ttu-id="6cb3d-281">只要 URL 不是類似`http://www.someserver.com/SomePage.aspx`或`/SomePage.aspx`，讓我們將內嵌表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-281">As long as the URL isn't something like `http://www.someserver.com/SomePage.aspx` or `/SomePage.aspx`, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-282">Cookieless 表單驗證票證遵守相同的逾時原則，以 cookie 為基礎的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="6cb3d-283">不過，無 cookie 驗證票證會更容易重新執行攻擊，因為直接在 URL 中內嵌的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="6cb3d-284">假設使用者瀏覽網站、 登入，然後將 URL 貼至電子郵件給同事。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="6cb3d-285">如果達到在到期之前的同事按一下該連結，就會記錄的使用者身分傳送電子郵件 ！</span><span class="sxs-lookup"><span data-stu-id="6cb3d-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>


## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="6cb3d-286">步驟 3：保護驗證票證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="6cb3d-287">透過網路傳輸的表單驗證票證 cookie 中或直接在 URL 中內嵌。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="6cb3d-288">身分識別資訊，除了驗證票證也會包含使用者資料 （如步驟 4 所示）。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="6cb3d-289">因此，很重要的票證資料會加密和 （甚至更重要的是），從表單驗證系統可以保證票證器未遭竄改。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="6cb3d-290">若要確保票證資料的隱私權，表單驗證系統可以加密的票證資料。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="6cb3d-291">無法加密的票證資料會透過網路以純文字傳送潛在的敏感資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="6cb3d-292">若要確保票證的真實性，表單驗證系統必須*驗證*票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="6cb3d-293">驗證是確保特定的資料未被修改，並完成透過 act *[訊息驗證碼 (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="6cb3d-294">簡單的說，MAC 是資訊的一小部分，識別需要驗證 （在此案例，票證） 的資料。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="6cb3d-295">如果 MAC 所表示的資料遭到修改，然後在 MAC 和資料會符合。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="6cb3d-296">此外，根本很密集駭客同時修改資料，並產生自己的 MAC 與修改過的資料。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="6cb3d-297">時建立 （或修改） 的票證，表單驗證系統會建立 MAC，並將它附加至的票證資料。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="6cb3d-298">後續要求抵達時，表單驗證系統會比較驗證票券資料的真實性的 MAC 和票證資料。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="6cb3d-299">[圖 3] 以圖形方式說明此工作流程。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-299">Figure 3 illustrates this workflow graphically.</span></span>


[![T<span data-ttu-id="6cb3d-300">他的票證的確有透過 MAC]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-300">he Ticket's Authenticity is Ensured through a MAC]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)

<span data-ttu-id="6cb3d-301">**圖 03**:票證的確有透過 MAC ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>


<span data-ttu-id="6cb3d-302">哪些安全性量值會套用至驗證票證中的 [保護] 設定而定&lt;form&gt;項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="6cb3d-303">保護設定可能會指派給下列三個值之一：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="6cb3d-304">所有-票證同時加密和數位簽章 （預設值）。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="6cb3d-305">加密-只加密已套用-沒有 MAC，會產生。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="6cb3d-306">無-票證不是加密或數位簽章。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="6cb3d-307">產生驗證-MAC，但票證資料會透過網路以純文字傳送。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="6cb3d-308">Microsoft 強烈建議使用所有的設定。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="6cb3d-309">設定驗證和解密金鑰</span><span class="sxs-lookup"><span data-stu-id="6cb3d-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="6cb3d-310">加密和雜湊演算法來加密和驗證的驗證票證使用表單驗證系統會透過可自訂[ &lt;machineKey&gt;項目](https://msdn.microsoft.com/library/w8h3skw9.aspx)Web.config 中。表 2 外框輪廓&lt;machineKey&gt;項目的屬性和其可能的值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| **<span data-ttu-id="6cb3d-311">屬性</span><span class="sxs-lookup"><span data-stu-id="6cb3d-311">Attribute</span></span>** | **<span data-ttu-id="6cb3d-312">描述</span><span class="sxs-lookup"><span data-stu-id="6cb3d-312">Description</span></span>** |
| --- | --- |
| <span data-ttu-id="6cb3d-313">解密</span><span class="sxs-lookup"><span data-stu-id="6cb3d-313">decryption</span></span> | <span data-ttu-id="6cb3d-314">表示用於加密的演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="6cb3d-315">這個屬性可以具有下列四個值之一:-自動-預設值;決定 decryptionKey 屬性的長度為基礎的演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="6cb3d-316">使用 AES-[進階加密標準 (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="6cb3d-317">DES-使用[的資料加密標準 (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard)這個演算法會被視為弱式運算資源，而且不應該使用。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="6cb3d-318">-3DES-使用[Triple DES](http://en.wikipedia.org/wiki/Triple_DES)演算法，其運作方式是套用 DES 演算法三次。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="6cb3d-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="6cb3d-319">decryptionKey</span></span> | <span data-ttu-id="6cb3d-320">使用的加密演算法的祕密金鑰。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="6cb3d-321">此值必須是適當的長度 （以解密中的值為基礎）、 自動產生，或附加，其中一個值為十六進位字串 IsolateApps。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="6cb3d-322">新增 IsolateApps 指示 ASP.NET 為每個應用程式使用唯一的值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="6cb3d-323">預設值為 AutoGenerate，IsolateApps。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="6cb3d-324">驗證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-324">validation</span></span> | <span data-ttu-id="6cb3d-325">表示用於驗證的演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="6cb3d-326">這個屬性可以具有下列四個值之一:-AES-使用進階加密標準 (AES) 演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="6cb3d-327">-MD5-使用[訊息摘要 5 (MD5)](http://en.wikipedia.org/wiki/MD5)演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="6cb3d-328">-SHA1-使用[SHA1](http://en.wikipedia.org/wiki/Sha1)演算法 （預設值）。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="6cb3d-329">-3DES-會使用 Triple DES 演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="6cb3d-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="6cb3d-330">validationKey</span></span> | <span data-ttu-id="6cb3d-331">使用的驗證演算法的祕密金鑰。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="6cb3d-332">此值必須是適當的長度 （根據驗證中的值）、 自動產生，或附加，其中一個值為十六進位字串 IsolateApps。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="6cb3d-333">新增 IsolateApps 指示 ASP.NET 為每個應用程式使用唯一的值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="6cb3d-334">預設值為 AutoGenerate，IsolateApps。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="6cb3d-335">**表 2**:&lt;MachineKey&gt;元素屬性</span><span class="sxs-lookup"><span data-stu-id="6cb3d-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="6cb3d-336">這些加密和驗證選項和專業人員的討論的各種演算法優缺點已超出本教學課程的範圍。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="6cb3d-337">如深入探討這些問題，包括哪些加密及驗證的演算法，若要使用，指引哪些金鑰的長度，若要使用，以及如何妥善地產生這些金鑰，請參閱*Professional ASP.NET 2.0 安全性、 成員資格和角色管理*.</span><span class="sxs-lookup"><span data-stu-id="6cb3d-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="6cb3d-338">根據預設，用來加密及驗證的金鑰會自動產生每個應用程式，而這些金鑰會儲存在本機安全性授權 (LSA)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="6cb3d-339">簡單來說，預設設定保證唯一索引鍵的網頁伺服器的 web 伺服器和應用程式的應用程式為基礎。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="6cb3d-340">因此，此預設行為並不適用於下列兩個案例：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="6cb3d-341">**Web 伺服陣列**-在[web 伺服陣列](http://en.wikipedia.org/wiki/Web_farm)案例中，單一 web 應用程式裝載於多部網頁伺服器的延展性和備援的目的。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="6cb3d-342">每個傳入要求分派至伺服器陣列中，這表示使用者的工作階段的存留期，不同的伺服器可能會用來處理其各種要求的伺服器。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="6cb3d-343">因此，每一部伺服器，以便建立表單驗證票證，必須使用相同的加密和驗證金鑰、 加密及驗證上一部伺服器可以解密和驗證伺服器陣列中不同的伺服器上。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="6cb3d-344">**跨應用程式票證共用**-單一 web 伺服器可以裝載多個 ASP.NET 應用程式。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="6cb3d-345">如果您需要這些不同的應用程式共用單一的表單驗證票證，請務必其加密和驗證金鑰匹配。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="6cb3d-346">Web 伺服陣列設定，或共用相同的伺服器上的應用程式的驗證票證在工作時，您必須設定&lt;machineKey&gt;受影響的應用程式中的項目，讓其 decryptionKey 和validationKey 值配對。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="6cb3d-347">雖然上述狀況都不會套用至我們的範例應用程式，但我們仍會指定明確的 Validationkey 與 validationKey 值，並定義要使用的演算法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="6cb3d-348">新增&lt;machineKey&gt;設為 Web.config 檔案：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="6cb3d-349">如需詳細資訊請參閱[How To:在 ASP.NET 2.0 設定 MachineKey](https://msdn.microsoft.com/library/ms998288.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-350">Validationkey 與 validationKey 值取自[Steve Gibson](http://www.grc.com/stevegibson.htm)的[完美密碼網頁](https://www.grc.com/passwords.htm)，以在每個頁面造訪產生 64 隨機的十六進位字元。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="6cb3d-351">若要可降低這些機碼，讓它們進入生產應用程式的可能性，便建議使用隨機產生的項目從 [完美的密碼] 頁面取代上述的金鑰。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>


## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="6cb3d-352">步驟 4：在票證中的儲存額外的使用者資料</span><span class="sxs-lookup"><span data-stu-id="6cb3d-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="6cb3d-353">許多 web 應用程式顯示的相關資訊，或目前登入使用者的基礎頁面的顯示。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="6cb3d-354">例如，網頁可能會顯示使用者的名稱和日期她上次登入在每個頁面的上方。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="6cb3d-355">表單驗證票證會儲存使用者目前登入的使用者名稱，但需要的任何其他資訊時，頁面必須移至查閱不會儲存在驗證票證資訊的使用者存放區-通常是資料庫層。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="6cb3d-356">我們可以加上一些程式碼，來儲存表單驗證票證額外的使用者資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="6cb3d-357">這類資料可透過表示[FormsAuthenticationTicket 類別](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)的[UserData 屬性](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="6cb3d-358">這是將少量的使用者，經常需要的相關資訊的好地方。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="6cb3d-359">在 [UserData] 屬性中包含的驗證票證 cookie，並像其他票證欄位，會加密和驗證所指定的值會根據表單驗證系統的組態。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="6cb3d-360">根據預設，保留使用者資料會是空字串。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="6cb3d-361">若要將使用者資料儲存在驗證票證，我們要撰寫的程式碼中擷取使用者特定資訊，並將它儲存在票證中的登入頁面。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="6cb3d-362">因為 UserData 是字串類型屬性，在其中儲存的資料必須正確地序列化為字串。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-362">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="6cb3d-363">比方說，假設我們的使用者存放區包含每位使用者的出生日期以及其雇主的名稱，而我們想要儲存這些兩個屬性值中的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="6cb3d-364">我們無法藉由串連使用者的日期的生日的字串，以垂直線 (|)，後面接著雇主名稱，以將這些值序列化成字串。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="6cb3d-365">使用者在 1974 年 8 月 15，適用於 Northwind Traders，就要將 [UserData] 屬性的字串：1974-08-15 |Northwind Traders。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="6cb3d-366">每當我們需要存取儲存在票證中的資料，我們可以這麼做抓取目前的要求 FormsAuthenticationTicket，然後還原序列化 [UserData] 屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="6cb3d-367">生日及雇主名稱範例日期，如果我們會將 UserData 字串分割成兩個分隔字元 (|) 為基礎的子字串。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>


[![A<span data-ttu-id="6cb3d-368">其他使用者資訊可以儲存在驗證票證]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-368">dditional User Information Can Be Stored in the Authentication Ticket]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)

<span data-ttu-id="6cb3d-369">**圖 04**:其他使用者資訊可以儲存在驗證票證 ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>


### <a name="writing-information-to-userdata"></a><span data-ttu-id="6cb3d-370">寫入資訊至 UserData</span><span class="sxs-lookup"><span data-stu-id="6cb3d-370">Writing Information to UserData</span></span>

<span data-ttu-id="6cb3d-371">不幸的是，將使用者專屬資訊新增至表單驗證票證不是其中一個預期的那麼簡單。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="6cb3d-372">FormsAuthenticationTicket 類別的 [UserData] 屬性是唯讀的並只能透過 FormsAuthenticationTicket 類別建構函式指定。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="6cb3d-373">當指定 [UserData] 屬性的建構函式中，我們也需要提供票證的其他值： 使用者名稱、 發行日期、 到期日和等等。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="6cb3d-374">我們在先前的教學課程中建立的登入頁面，這是所有我們由 FormsAuthentication 類別處理。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="6cb3d-375">當加入 FormsAuthenticationTicket UserData，我們必須撰寫程式碼以將複寫的許多功能所提供的 FormsAuthentication 類別。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="6cb3d-376">讓我們來探索必要的程式碼使用 UserData 藉由更新的 Login.aspx 頁面，來記錄使用者驗證票證相關的其他資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="6cb3d-377">假設我們的使用者存放區包含資訊適用於使用者的公司和職稱，和我們想要擷取這項資訊驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="6cb3d-378">更新的 Login.aspx 頁面 LoginButton Click 事件處理常式，使程式碼看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="6cb3d-379">讓我們逐步執行一行此程式碼一次。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="6cb3d-380">方法會定義四個字串陣列： 使用者、 密碼、 companyName 和 titleAtCompany。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="6cb3d-381">這些陣列有使用者名稱、 密碼、 公司名稱和標題的使用者帳戶的系統中的其中有三個：Scott、 Jisun 和 Sam。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="6cb3d-382">在實際的應用程式中，會從使用者存放區，不硬式編碼在頁面的原始程式碼中查詢這些值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="6cb3d-383">在上一個教學課程中，如果提供的認證不正確我們只要呼叫 FormsAuthentication.RedirectFromLoginPage UserName.Text (RememberMe.Checked），執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="6cb3d-384">建立表單驗證票證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="6cb3d-385">寫入適當的存放區中的票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="6cb3d-386">以 cookie 為基礎的驗證票證，它會使用的瀏覽器的 cookie 集合;cookieless 驗證票證的票券資料序列化成 URL</span><span class="sxs-lookup"><span data-stu-id="6cb3d-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="6cb3d-387">重新導向到適當的網頁的使用者</span><span class="sxs-lookup"><span data-stu-id="6cb3d-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="6cb3d-388">上述程式碼中，會複寫這些步驟。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="6cb3d-389">首先，我們會將最終會儲存在 [UserData] 屬性的字串會形成藉由結合公司名稱和標題，用來分隔兩個值使用縱線字元 (|)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="6cb3d-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span><span class="sxs-lookup"><span data-stu-id="6cb3d-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="6cb3d-391">接下來，FormsAuthentication.GetAuthCookie 叫用方法時，這會建立驗證票證，加密和驗證根據組態設定，並將它放在 HttpCookie 物件。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="6cb3d-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span><span class="sxs-lookup"><span data-stu-id="6cb3d-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="6cb3d-393">若要使用內嵌在 cookie 內 FormAuthenticationTicket，我們要呼叫 FormAuthentication 類別[解密方法](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)，並傳入的 cookie 值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="6cb3d-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span><span class="sxs-lookup"><span data-stu-id="6cb3d-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="6cb3d-395">然後，我們建立*新*FormsAuthenticationTicket 執行個體根據現有的 FormsAuthenticationTicket 值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="6cb3d-396">不過，這個新的票證包含使用者特定資訊 (userDataString)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="6cb3d-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span><span class="sxs-lookup"><span data-stu-id="6cb3d-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="6cb3d-398">我們再加密 （和驗證） 新的 FormsAuthenticationTicket 執行個體，藉由呼叫[加密方法](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)，並將此加密 （和已驗證） 的資料放入 authCookie 的上一步。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="6cb3d-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span><span class="sxs-lookup"><span data-stu-id="6cb3d-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="6cb3d-400">最後，authCookie 加入至 Response.Cookies 集合並 GetRedirectUrl 方法會呼叫來決定適當的頁面，以傳送給使用者。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="6cb3d-401">這段程式碼需要因為 [UserData] 屬性是唯讀的而且 FormsAuthentication 類別不提供任何方法來指定其 GetAuthCookie、 SetAuthCookie 或 RedirectFromLoginPage 的方法中的 UserData 資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-402">我們剛剛檢查過的程式碼會將使用者特定資訊儲存在 cookie 為基礎的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="6cb3d-403">類別負責序列化表單驗證票證的 url 為內部.NET framework 物件。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="6cb3d-404">長話短說，您無法儲存使用者資料在 cookieless 表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>


### <a name="accessing-the-userdata-information"></a><span data-ttu-id="6cb3d-405">存取保留使用者資料資訊</span><span class="sxs-lookup"><span data-stu-id="6cb3d-405">Accessing the UserData Information</span></span>

<span data-ttu-id="6cb3d-406">現在每位使用者的公司名稱和標題會儲存在表單驗證票證的 UserData 屬性在登入時。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="6cb3d-407">這項資訊可以從任何頁面上的驗證票證存取，而不需要某趟車程支付的使用者存放區。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="6cb3d-408">若要說明如何擷取這項資訊，從 [UserData] 屬性，讓我們將更新 Default.aspx，使其歡迎訊息包含不只使用者的名稱，但也它們適用於公司和職稱。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="6cb3d-409">目前，Default.aspx 包含 Label 控制項，名為 WelcomeBackMessage AuthenticatedMessagePanel 面板。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="6cb3d-410">此面板只會顯示已驗證的使用者。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="6cb3d-411">更新 Default.aspx 的頁面中的程式碼\_Load 事件處理常式，使它看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="6cb3d-412">如果 Request.IsAuthenticated 為 true，則 WelcomeBackMessage 的 Text 屬性第一次設定歡迎您再次啟用，為*username*。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-412">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="6cb3d-413">然後，User.Identity 屬性會轉換成 FormsIdentity 物件，以便我們可以存取基礎 FormsAuthenticationTicket。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="6cb3d-414">一旦我們擁有 FormsAuthenticationTicket，我們會還原 [UserData] 屬性序列化至的公司名稱和標題中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="6cb3d-415">這被透過分割以縱線字元字串。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="6cb3d-416">然後 WelcomeBackMessage 標籤中顯示的公司名稱和標題。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="6cb3d-417">圖 5 顯示作用中的此顯示畫面的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="6cb3d-418">以Scott的身份登錄，並顯示包含Scott的公司和頭銜的歡迎信息。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>


[![T<span data-ttu-id="6cb3d-419">他目前登入使用者的公司和標題會顯示]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-419">he Currently Logged On User's Company and Title are Displayed]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)

<span data-ttu-id="6cb3d-420">**圖 05**:會顯示目前登入使用者的公司和標題 ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="6cb3d-421">驗證票證的 UserData 屬性可做為快取的使用者存放區中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="6cb3d-422">像是任何快取，它必須修改基礎資料時，會更新。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="6cb3d-423">比方說，如果網頁上的使用者可以更新其設定檔，在 [UserData] 屬性中快取的欄位必須重新整理以反映使用者所做的變更。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>


## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="6cb3d-424">步驟 5：使用自訂主體</span><span class="sxs-lookup"><span data-stu-id="6cb3d-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="6cb3d-425">在每個傳入要求上 FormsAuthenticationModule 會嘗試驗證使用者。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="6cb3d-426">如果未過期的驗證票證，則 FormsAuthenticationModule 會將 HttpContext.User 屬性指派至新的 GenericPrincipal 物件。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="6cb3d-427">這個 GenericPrincipal 物件具有 FormsIdentity，包含表單驗證票證的參考類型的身分識別。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="6cb3d-428">GenericPrincipal 類別包含實作 IPrincipal 的類別所需的裸機最小功能-它只是具有 Identity 屬性和 IsInRole 方法。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="6cb3d-429">主體的物件有兩個責任： 指出哪些使用者所屬的角色，並提供身分識別資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="6cb3d-430">這是透過 IPrincipal 介面的 IsInRole (*roleName*) 方法和身分識別屬性，分別。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="6cb3d-431">GenericPrincipal 類別允許透過其建構函式; 指定之角色名稱的字串陣列其 IsInRole (*roleName*) 方法只會檢查是否要傳遞中*roleName*存在於字串陣列。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="6cb3d-432">當 FormsAuthenticationModule 建立 GenericPrincipal 時，傳遞空字串陣列中 GenericPrincipal 的建構函式。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="6cb3d-433">因此，任何對 IsInRole 的呼叫一律會傳回 false。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-433">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="6cb3d-434">GenericPrincipal 類別符合大部分的表單型的驗證情況下，不使用角色的需求。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="6cb3d-435">這種情況下，其中的預設角色處理是不足或當您需要自訂的 IIdentity 物件相關聯的使用者，您可以在驗證工作流程期間建立的自訂 IPrincipal 物件，並將它指派給 HttpContext.User 屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-436">我們在未來將會看到教學課程中，當 ASP。NET 的角色架構會啟用它會建立類型的自訂主體物件[RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx)並覆寫的表單驗證建立 GenericPrincipal 物件。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="6cb3d-437">這麼做是要自訂主體的 IsInRole 方法，以便與角色架構的 API。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>


<span data-ttu-id="6cb3d-438">因為我們有不關心自行角色尚未，我們必須在此時建立自訂主體的唯一理由是自訂的 IIdentity 物件的主體產生關聯。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="6cb3d-439">步驟 4 中，我們討論過其他使用者資訊儲存在特定的驗證票證的 UserData 屬性中，使用者的公司名稱和其標題。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="6cb3d-440">不過，UserData 資訊才可透過驗證票證存取，而且只，然後做為序列化的字串，這表示每當我們想要檢視使用者資訊儲存在票證中我們需要剖析 [UserData] 屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="6cb3d-441">我們可以建立一個類別來實作 IIdentity 和包含公司名稱和標題的屬性，以改善開發人員體驗。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="6cb3d-442">如此一來，開發人員可以存取目前登入使用者的公司名稱和標題，直接透過 CompanyName 和 標題的屬性，而不需要知道如何剖析 UserData 屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="6cb3d-443">建立自訂身分識別和主體類別</span><span class="sxs-lookup"><span data-stu-id="6cb3d-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="6cb3d-444">本教學課程中，讓我們來建立自訂的 principal 和 identity 物件 」 應用程式中\_程式碼資料夾。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="6cb3d-445">新增應用程式開始\_程式碼到您的專案資料夾-以滑鼠右鍵按一下方案總管 中的專案名稱、 選擇加入 ASP.NET 資料夾，然後選擇應用程式\_程式碼。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="6cb3d-446">應用程式\_程式碼資料夾是特殊的 ASP.NET 資料夾所在之網站的特定類別的檔案。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="6cb3d-447">應用程式\_管理您透過網站專案模型的專案時，應該只使用程式碼資料夾。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="6cb3d-448">如果您使用[Web 應用程式專案模型](https://msdn.microsoft.com/asp.net/Aa336618.aspx)、 建立標準的資料夾，並將類別加入至該。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="6cb3d-449">比方說，您可以加入名為類別的新資料夾，並將您的程式碼放至該處。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-449">For example, you could add a new folder named Classes, and place your code there.</span></span>


<span data-ttu-id="6cb3d-450">接下來，在應用程式中新增兩個新的類別檔案\_程式碼資料夾，一個具名的 CustomIdentity.cs，另一個名為 CustomPrincipal.cs。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>


[![A<span data-ttu-id="6cb3d-451">dd CustomIdentity 和 CustomPrincipal 類別，以您的專案]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-451">dd the CustomIdentity and CustomPrincipal Classes to Your Project]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)

<span data-ttu-id="6cb3d-452">**圖 06**:將 CustomIdentity 和 CustomPrincipal 類別新增至您的專案 ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>


<span data-ttu-id="6cb3d-453">CustomIdentity 類別負責實作 IIdentity 介面，可定義 AuthenticationType、 IsAuthenticated 和名稱屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="6cb3d-454">除了這些必要的屬性，我們感興趣公開基礎表單驗證票證，以及使用者的公司名稱和標題的屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="6cb3d-455">輸入下列程式碼到 CustomIdentity 類別。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="6cb3d-456">請注意，此類別包含 FormsAuthenticationTicket 成員變數 (\_票證) 以及透過建構函式時必須提供此票證資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="6cb3d-457">此票證資料會在傳回的身分識別的名稱;其 UserData 屬性會傳回 CompanyName 和 標題屬性的值進行剖析。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="6cb3d-458">接下來，建立 CustomPrincipal 類別。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="6cb3d-459">因為我們不關心的角色在此時，CustomPrincipal 類別的建構函式會接受只有 CustomIdentity 物件;它的 IsInRole 方法永遠傳回 false。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="6cb3d-460">CustomPrincipal 物件指派給內送要求的安全性內容</span><span class="sxs-lookup"><span data-stu-id="6cb3d-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="6cb3d-461">此外，我們現在會有該類別可擴充預設 IIdentity 規格，以包含公司名稱和標題的屬性，以及使用自訂身分識別的自訂主體類別。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="6cb3d-462">我們已準備好進入 ASP.NET 管線，並將我們自訂的主體物件指派給內送要求的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="6cb3d-463">ASP.NET 管線會採用傳入的要求，並處理它透過幾個步驟。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="6cb3d-464">在每個步驟中，會引發特定事件，讓開發人員善用 ASP.NET 管線，並修改其生命週期中的特定點的要求。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="6cb3d-465">FormsAuthenticationModule，比方說，等候要引發的 ASP.NET [AuthenticateRequest 事件](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)，此時它會檢查驗證 ticket 的連入要求。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="6cb3d-466">如果找到已驗證票證，GenericPrincipal 物件建立，並指派給 HttpContext.User 屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="6cb3d-467">ASP.NET 管線引發 AuthenticateRequest 事件之後[PostAuthenticateRequest 事件](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx)，這是我們可以在其中取代所使用的執行個體 FormsAuthenticationModule 建立 GenericPrincipal 物件我們CustomPrincipal 物件。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="6cb3d-468">[圖 7] 描述此工作流程。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-468">Figure 7 depicts this workflow.</span></span>


[![T<span data-ttu-id="6cb3d-469">他 GenericPrincipal 由 CustomPrincipal PostAuthenticationRequest 事件中取代]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-469">he GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)

<span data-ttu-id="6cb3d-470">**圖 07**:GenericPrincipal 取代 CustomPrincipal PostAuthenticationRequest 事件中 ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>


<span data-ttu-id="6cb3d-471">為了回應 ASP.NET 管線事件中執行程式碼，我們可以在 Global.asax 中建立適當的事件處理常式，或建立自己的 HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="6cb3d-472">本教學課程中讓我們在 Global.asax 中建立的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="6cb3d-473">開始將 Global.asax 新增至您的網站。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="6cb3d-474">以滑鼠右鍵按一下方案總管 中的專案名稱，並新增名為 Global.asax 的全域應用程式類別類型的項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>


[![A<span data-ttu-id="6cb3d-475">dd Global.asax 檔案到您的網站]</span><span class="sxs-lookup"><span data-stu-id="6cb3d-475">dd a Global.asax File to Your Website]</span></span>(forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)

<span data-ttu-id="6cb3d-476">**圖 08**:Global.asax 檔案加入您的網站 ([按一下以檢視完整大小的影像](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="6cb3d-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>


<span data-ttu-id="6cb3d-477">預設 Global.asax 範本包含事件處理常式，如有多個 ASP.NET 管線事件，包括開始時，結束並[錯誤事件](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx)，其他項目。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="6cb3d-478">請放心地移除這些事件處理常式，因為我們不需要他們為此應用程式。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="6cb3d-479">我們感興趣的事件是 PostAuthenticateRequest。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="6cb3d-480">更新 Global.asax 檔案，所以其標記看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="6cb3d-481">應用程式\_OnPostAuthenticateRequest 方法執行的每當 ASP.NET 執行階段引發 PostAuthenticateRequest 事件，在每個連入的頁面要求上一次發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="6cb3d-482">事件處理常式會先檢查以查看使用者是否經過驗證，並透過表單驗證的驗證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="6cb3d-483">如果是的話，新的 CustomIdentity 物件建立，並傳入其建構函式中的目前要求的驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="6cb3d-484">接下來，會 CustomPrincipal 物件建立，並在其建構函式中傳遞的剛建立 CustomIdentity 物件。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="6cb3d-485">最後，目前要求的安全性內容被指派給新建立的 CustomPrincipal 物件中。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="6cb3d-486">請注意，最後一個步驟-建立 CustomPrincipal 物件關聯與要求的安全性內容-將主體指派給兩個屬性：HttpContext.User 和 Thread.CurrentPrincipal。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="6cb3d-487">這兩項指派是必要的因為在 ASP.NET 中處理安全性內容的方式。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="6cb3d-488">.NET Framework 關聯每個執行中的執行緒; 中的安全性內容這項資訊可從透過的 IPrincipal 物件[執行緒物件](https://msdn.microsoft.com/library/system.threading.thread.aspx)的[CurrentPrincipal 屬性](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="6cb3d-489">令人困惑的是 ASP.NET 有它自己的安全性內容資訊 (HttpContext.User)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="6cb3d-490">在某些情況下，判斷安全性內容中; 時，會檢查 Thread.CurrentPrincipal 屬性在其他情況下，會使用 HttpContext.User。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="6cb3d-491">例如，在.NET 中的安全性功能可讓開發人員以宣告方式狀態的哪些使用者或角色可以具現化類別，或叫用特定方法 (請參閱[新增授權規則的商務和資料層使用PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx))。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="6cb3d-492">基本上，這些宣告式技巧會決定透過 Thread.CurrentPrincipal 屬性的安全性內容。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="6cb3d-493">在其他情況下，會使用 HttpContext.User 屬性。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="6cb3d-494">例如，先前的教學課程中我們使用這個屬性來顯示目前登入使用者的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="6cb3d-495">很明顯地，然後，它是命令式的 Thread.CurrentPrincipal 和 HttpContext.User 屬性中的安全性內容資訊匹配。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="6cb3d-496">ASP.NET 執行階段會自動同步為我們的這些屬性值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="6cb3d-497">不過，這項同步處理會發生 AuthenticateRequest 事件之後，但*之前*PostAuthenticateRequest 事件。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="6cb3d-498">因此，我們 PostAuthenticateRequest 事件中加入自訂的主體時要使用特定手動指派 Thread.CurrentPrincipal，否則 Thread.CurrentPrincipal，而 HttpContext.User 將會同步。請參閱[Context.User vs。Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/)如需此問題的更詳細討論。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="6cb3d-499">存取的公司名稱和標題屬性</span><span class="sxs-lookup"><span data-stu-id="6cb3d-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="6cb3d-500">每當要求抵達時，會分派至應用程式的 ASP.NET 引擎\_OnPostAuthenticateRequest Global.asax 中的事件處理常式就會引發。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="6cb3d-501">如果 FormsAuthenticationModule 成功驗證要求，事件處理常式就會建立新的 CustomPrincipal 物件與 CustomIdentity 物件根據表單驗證票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="6cb3d-502">就地此邏輯，以存取目前登入使用者的公司名稱和標題的相關資訊會變得簡單無比。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="6cb3d-503">返回頁面\_在 Default.aspx 中，其中在步驟 4 中我們要撰寫程式碼來擷取表單驗證票證和剖析 [UserData] 屬性，以顯示使用者的公司名稱和標題的 Load 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="6cb3d-504">現在使用 CustomPrincipal 和 CustomIdentity 物件，使用中，則不需要剖析出票證的 UserData 屬性的值。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="6cb3d-505">相反地，只要取得 CustomIdentity 物件的參考，並使用其公司名稱和標題的屬性：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="6cb3d-506">總結</span><span class="sxs-lookup"><span data-stu-id="6cb3d-506">Summary</span></span>

<span data-ttu-id="6cb3d-507">在本教學課程中，我們檢查如何自訂表單驗證系統的設定，透過 Web.config。我們討論過如何處理驗證票證的到期日，以及如何使用的加密和驗證的防護措施來防止檢驗和修改的票證。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="6cb3d-508">最後，我們討論過使用驗證票證的 UserData 屬性儲存在票證本身的其他使用者資訊以及如何使用自訂的 principal 和 identity 物件，以更適合開發人員的方式公開此資訊。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="6cb3d-509">本教學課程結束時，我們在 ASP.NET 中的表單驗證檢查。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="6cb3d-510">下一個教學課程中，會啟動我們的旅程，到成員資格架構。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="6cb3d-511">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="6cb3d-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="6cb3d-512">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="6cb3d-512">Further Reading</span></span>

<span data-ttu-id="6cb3d-513">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="6cb3d-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="6cb3d-514">剖析表單驗證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="6cb3d-515">說明：ASP.NET 2.0 中的表單驗證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="6cb3d-516">如何：保護 ASP.NET 2.0 中的表單驗證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="6cb3d-517">[Professional ASP.NET 2.0 安全性、 成員資格和角色管理](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html)(ISBN:978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="6cb3d-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="6cb3d-518">設定登入控制項的安全性</span><span class="sxs-lookup"><span data-stu-id="6cb3d-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="6cb3d-519">&lt;驗證&gt;項目</span><span class="sxs-lookup"><span data-stu-id="6cb3d-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="6cb3d-520">&lt;Form&gt;項目&lt;驗證&gt;</span><span class="sxs-lookup"><span data-stu-id="6cb3d-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="6cb3d-521">&lt;MachineKey&gt;項目</span><span class="sxs-lookup"><span data-stu-id="6cb3d-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="6cb3d-522">了解表格驗證票證和 Cookie</span><span class="sxs-lookup"><span data-stu-id="6cb3d-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="6cb3d-523">在本教學課程中所包含的主題的影片訓練</span><span class="sxs-lookup"><span data-stu-id="6cb3d-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="6cb3d-524">如何變更表單驗證屬性</span><span class="sxs-lookup"><span data-stu-id="6cb3d-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="6cb3d-525">如何在 ASP.NET 應用程式的安裝和使用無 Cookie 驗證</span><span class="sxs-lookup"><span data-stu-id="6cb3d-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="6cb3d-526">ASP 表單登入重新配置</span><span class="sxs-lookup"><span data-stu-id="6cb3d-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="6cb3d-527">表單登入自訂金鑰設定</span><span class="sxs-lookup"><span data-stu-id="6cb3d-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="6cb3d-528">將自訂資料新增至驗證方法</span><span class="sxs-lookup"><span data-stu-id="6cb3d-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="6cb3d-529">使用自訂的主體物件</span><span class="sxs-lookup"><span data-stu-id="6cb3d-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="6cb3d-530">關於作者</span><span class="sxs-lookup"><span data-stu-id="6cb3d-530">About the Author</span></span>

<span data-ttu-id="6cb3d-531">Scott Mitchell，多個 ASP 書籍的作者，他是 4GuysFromRolla.com 的創辦人，從事 Microsoft Web 技術工作自 1998 年。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6cb3d-532">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6cb3d-533">他最新的著作是 *[Sams 教導您自己 ASP.NET 2.0 在 24 小時內](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="6cb3d-534">Scott 要聯絡[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或透過他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="6cb3d-535">特別感謝</span><span class="sxs-lookup"><span data-stu-id="6cb3d-535">Special Thanks To</span></span>

<span data-ttu-id="6cb3d-536">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6cb3d-537">本教學課程中的潛在客戶檢閱者已 Alicja Maziarz。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="6cb3d-538">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="6cb3d-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6cb3d-539">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="6cb3d-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6cb3d-540">[上一頁](an-overview-of-forms-authentication-cs.md)
> [下一頁](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="6cb3d-540">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
