---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
title: 建立和管理角色（VB） |Microsoft Docs
author: rick-anderson
description: 本教學課程會檢查設定角色架構所需的步驟。 之後，我們將建立網頁來建立及刪除角色。
ms.author: riande
ms.date: 03/24/2008
ms.assetid: 83af9f5f-9a00-4f83-8afc-e98bdd49014e
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
msc.type: authoredcontent
ms.openlocfilehash: 825e2afb750925637d308b7ceb35e1b02b708c1d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74586369"
---
# <a name="creating-and-managing-roles-vb"></a><span data-ttu-id="d98ab-104">建立及管理角色 (VB)</span><span class="sxs-lookup"><span data-stu-id="d98ab-104">Creating and Managing Roles (VB)</span></span>

<span data-ttu-id="d98ab-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d98ab-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d98ab-106">[下載程式代碼](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip)或[下載 PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="d98ab-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span></span>

> <span data-ttu-id="d98ab-107">本教學課程會檢查設定角色架構所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="d98ab-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="d98ab-108">之後，我們將建立網頁來建立及刪除角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-108">Following that, we will build web pages to create and delete roles.</span></span>

## <a name="introduction"></a><span data-ttu-id="d98ab-109">簡介</span><span class="sxs-lookup"><span data-stu-id="d98ab-109">Introduction</span></span>

<span data-ttu-id="d98ab-110">在以<a id="_msoanchor_1"> </a>[*使用者為基礎的授權*](../membership/user-based-authorization-vb.md)教學課程中，我們探討了如何使用 URL 授權，從一組頁面限制特定使用者，並探索宣告式和程式設計技巧，以根據造訪的使用者調整 ASP.NET 網頁的功能。</span><span class="sxs-lookup"><span data-stu-id="d98ab-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="d98ab-111">不過，以使用者為基礎授與頁面存取或功能的許可權，但在有許多使用者帳戶或使用者的許可權經常變更的情況下，可能會變得很麻煩。</span><span class="sxs-lookup"><span data-stu-id="d98ab-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="d98ab-112">每當使用者取得或失去執行特定工作的授權時，系統管理員就必須更新適當的 URL 授權規則、宣告式標記和程式碼。</span><span class="sxs-lookup"><span data-stu-id="d98ab-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="d98ab-113">它通常有助於將使用者分類為群組或*角色*，然後依角色逐一套用許可權。</span><span class="sxs-lookup"><span data-stu-id="d98ab-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="d98ab-114">例如，大部分的 web 應用程式都有一組特定的頁面或工作，只保留給系統管理使用者。</span><span class="sxs-lookup"><span data-stu-id="d98ab-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="d98ab-115">使用以使用者為基礎的*授權*教學課程中所學到的技術，我們將新增適當的 URL 授權規則、宣告式標記和程式碼，以允許指定的使用者帳戶執行系統管理工作。</span><span class="sxs-lookup"><span data-stu-id="d98ab-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="d98ab-116">但是，如果已加入新的系統管理員，或現有的系統管理員需要撤銷其管理許可權，我們就必須傳回並更新設定檔和網頁。</span><span class="sxs-lookup"><span data-stu-id="d98ab-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="d98ab-117">不過，有了角色，我們可以建立一個名為 Administrators 的角色，並將這些信任的使用者指派給系統管理員角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="d98ab-118">接下來，我們要新增適當的 URL 授權規則、宣告式標記和程式碼，讓系統管理員角色能夠執行各種系統管理工作。</span><span class="sxs-lookup"><span data-stu-id="d98ab-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="d98ab-119">當此基礎結構就緒時，將新的系統管理員加入至網站或移除現有的系統管理員，就像在 [系統管理員] 角色中包含或移除使用者一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="d98ab-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="d98ab-120">不需要設定、宣告式標記或程式碼變更。</span><span class="sxs-lookup"><span data-stu-id="d98ab-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="d98ab-121">ASP.NET 提供角色架構來定義角色，並將它們與使用者帳戶建立關聯。</span><span class="sxs-lookup"><span data-stu-id="d98ab-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="d98ab-122">有了角色架構，我們就可以建立和刪除角色、在角色中新增使用者或移除使用者、判斷屬於特定角色的使用者集合，以及判斷使用者是否屬於特定角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="d98ab-123">一旦設定了角色架構，我們就可以透過 URL 授權規則來限制每個角色對頁面的存取權，並根據目前登入的使用者角色，顯示或隱藏頁面上的其他資訊或功能。</span><span class="sxs-lookup"><span data-stu-id="d98ab-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="d98ab-124">本教學課程會檢查設定角色架構所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="d98ab-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="d98ab-125">之後，我們將建立網頁來建立及刪除角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="d98ab-126">在將<a id="_msoanchor_2"> </a>[*角色指派給使用者*](assigning-roles-to-users-vb.md)教學課程中，我們將探討如何從角色新增和移除使用者。</span><span class="sxs-lookup"><span data-stu-id="d98ab-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-vb.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="d98ab-127">在以<a id="_msoanchor_3"> </a>[*角色為基礎的授權*](role-based-authorization-vb.md)教學課程中，我們將瞭解如何依角色來限制頁面的存取權，以及如何根據造訪的使用者角色來調整頁面功能。</span><span class="sxs-lookup"><span data-stu-id="d98ab-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="d98ab-128">讓我們開始吧！</span><span class="sxs-lookup"><span data-stu-id="d98ab-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="d98ab-129">步驟1：加入新的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="d98ab-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="d98ab-130">在本教學課程和接下來的兩個中，我們將探討各種角色相關的功能和功能。</span><span class="sxs-lookup"><span data-stu-id="d98ab-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="d98ab-131">我們將需要一系列的 ASP.NET 網頁，以執行整個教學課程中所探討的主題。</span><span class="sxs-lookup"><span data-stu-id="d98ab-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="d98ab-132">讓我們建立這些頁面並更新網站地圖。</span><span class="sxs-lookup"><span data-stu-id="d98ab-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="d98ab-133">首先，在名為 `Roles`的專案中建立新的資料夾。</span><span class="sxs-lookup"><span data-stu-id="d98ab-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="d98ab-134">接下來，在 [`Roles`] 資料夾中新增四個新的 ASP.NET 網頁，並將每個頁面與 `Site.master` 主版頁面連結。</span><span class="sxs-lookup"><span data-stu-id="d98ab-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="d98ab-135">將頁面命名為：</span><span class="sxs-lookup"><span data-stu-id="d98ab-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="d98ab-136">此時，專案的方案總管看起來應該像 [圖 1] 所示的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="d98ab-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="d98ab-137">[[角色] 資料夾中已加入 ![四個新頁面](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d98ab-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span></span>

<span data-ttu-id="d98ab-138">**圖 1**： [`Roles`] 資料夾中已加入四個新頁面（[按一下以觀看完整大小的影像](creating-and-managing-roles-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="d98ab-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image3.png))</span></span>

<span data-ttu-id="d98ab-139">此時，每個頁面都應該有兩個內容控制項，每一個主版頁面的 ContentPlaceHolders： `MainContent` 和 `LoginContent`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample1.aspx)]

<span data-ttu-id="d98ab-140">回想一下，`LoginContent` ContentPlaceHolder 的預設標記會根據使用者是否經過驗證，顯示登入或登出網站的連結。</span><span class="sxs-lookup"><span data-stu-id="d98ab-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="d98ab-141">不過，ASP.NET 網頁中存在 `Content2` 內容控制項，會覆寫主版頁面的預設標記。</span><span class="sxs-lookup"><span data-stu-id="d98ab-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="d98ab-142">如我們在<a id="_msoanchor_4"> </a>[*表單驗*](../introduction/an-overview-of-forms-authentication-vb.md)證教學課程的總覽中所討論，覆寫預設標記在頁面中很有用，因為我們不想要在左欄中顯示登入相關的選項。</span><span class="sxs-lookup"><span data-stu-id="d98ab-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="d98ab-143">不過，針對這四個頁面，我們想要顯示主版頁面的 `LoginContent` ContentPlaceHolder 的預設標記。</span><span class="sxs-lookup"><span data-stu-id="d98ab-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="d98ab-144">因此，請移除 `Content2` 內容控制項的宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="d98ab-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="d98ab-145">這麼做之後，四個頁面的每一個標記都應該只包含一個內容控制項。</span><span class="sxs-lookup"><span data-stu-id="d98ab-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="d98ab-146">最後，讓我們更新網站地圖（`Web.sitemap`）以包含這些新的網頁。</span><span class="sxs-lookup"><span data-stu-id="d98ab-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="d98ab-147">在我們為成員資格教學課程新增的 `<siteMapNode>` 之後，新增下列 XML。</span><span class="sxs-lookup"><span data-stu-id="d98ab-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample2.xml)]

<span data-ttu-id="d98ab-148">更新網站地圖之後，請透過瀏覽器造訪網站。</span><span class="sxs-lookup"><span data-stu-id="d98ab-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="d98ab-149">如 [圖 2] 所示，左邊的導覽現在包含角色教學課程的專案。</span><span class="sxs-lookup"><span data-stu-id="d98ab-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>

<span data-ttu-id="d98ab-150">[[角色] 資料夾中已加入 ![四個新頁面](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d98ab-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span></span>

<span data-ttu-id="d98ab-151">**圖 2**：已將四個新頁面新增至 [`Roles`] 資料夾（[按一下以查看完整大小的影像](creating-and-managing-roles-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="d98ab-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image6.png))</span></span>

## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="d98ab-152">步驟2：指定及設定角色架構提供者</span><span class="sxs-lookup"><span data-stu-id="d98ab-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="d98ab-153">如同成員資格架構，角色架構是建立在提供者模型的上方。</span><span class="sxs-lookup"><span data-stu-id="d98ab-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="d98ab-154">如<a id="_msoanchor_5"> </a>[*安全性基本概念和 ASP.NET 支援*](../introduction/security-basics-and-asp-net-support-vb.md)教學課程中所述，.NET Framework 隨附三個內建角色提供者： [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx)、 [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx)和[`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d98ab-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-vb.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="d98ab-155">本教學課程系列著重于 `SqlRoleProvider`，其使用 Microsoft SQL Server 資料庫做為角色存放區。</span><span class="sxs-lookup"><span data-stu-id="d98ab-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="d98ab-156">底下的角色架構和 `SqlRoleProvider` 的工作就像成員資格架構和 `SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="d98ab-157">.NET Framework 包含 `Roles` 類別，可作為角色架構的 API。</span><span class="sxs-lookup"><span data-stu-id="d98ab-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="d98ab-158">`Roles` 類別具有共用方法，例如 `CreateRole`、`DeleteRole`、`GetAllRoles`、`AddUserToRole`、`IsUserInRole`等等。</span><span class="sxs-lookup"><span data-stu-id="d98ab-158">The `Roles` class has shared methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="d98ab-159">當叫用這些方法的其中之一時，`Roles` 類別會將呼叫委派給已設定的提供者。</span><span class="sxs-lookup"><span data-stu-id="d98ab-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="d98ab-160">`SqlRoleProvider` 適用于特定角色的資料表（`aspnet_Roles` 和 `aspnet_UsersInRoles`）以回應。</span><span class="sxs-lookup"><span data-stu-id="d98ab-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="d98ab-161">為了在我們的應用程式中使用 `SqlRoleProvider` 提供者，我們必須指定要做為存放區使用的資料庫。</span><span class="sxs-lookup"><span data-stu-id="d98ab-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="d98ab-162">`SqlRoleProvider` 預期指定的角色存放區具有特定資料庫資料表、視圖和預存程式。</span><span class="sxs-lookup"><span data-stu-id="d98ab-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="d98ab-163">您可以使用[`aspnet_regsql.exe` 工具](https://msdn.microsoft.com/library/ms229862.aspx)來新增這些必要的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="d98ab-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="d98ab-164">此時，我們已經有一個資料庫，其中包含了 `SqlRoleProvider`所需的架構。</span><span class="sxs-lookup"><span data-stu-id="d98ab-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="d98ab-165"><a id="_msoanchor_6"></a>回到在[*SQL Server 建立成員資格架構*](../membership/creating-the-membership-schema-in-sql-server-vb.md)教學課程中，我們建立了名為 `SecurityTutorials.mdf` 的資料庫，並使用 `aspnet_regsql.exe` 加入應用程式服務，其中包含 `SqlRoleProvider`所需的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="d98ab-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="d98ab-166">因此，我們只需要告訴角色架構啟用角色支援，並使用 `SqlRoleProvider` 搭配 `SecurityTutorials.mdf` 資料庫作為角色存放區。</span><span class="sxs-lookup"><span data-stu-id="d98ab-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="d98ab-167">角色架構是透過應用程式 `Web.config` 檔案中的 `<roleManager>` 元素來設定。</span><span class="sxs-lookup"><span data-stu-id="d98ab-167">The Roles framework is configured via the `<roleManager>` element in the application's `Web.config` file.</span></span> <span data-ttu-id="d98ab-168">預設會停用角色支援。</span><span class="sxs-lookup"><span data-stu-id="d98ab-168">By default, role support is disabled.</span></span> <span data-ttu-id="d98ab-169">若要啟用它，您必須將[`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx)元素的 `enabled` 屬性設定為 `true` 如下所示：</span><span class="sxs-lookup"><span data-stu-id="d98ab-169">To enable it, you must set the [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample3.xml)]

<span data-ttu-id="d98ab-170">根據預設，所有 web 應用程式都有一個名為 `AspNetSqlRoleProvider` 類型為 `SqlRoleProvider`的角色提供者。</span><span class="sxs-lookup"><span data-stu-id="d98ab-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="d98ab-171">這個預設提供者會在 `machine.config` 中註冊（位於 `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`）：</span><span class="sxs-lookup"><span data-stu-id="d98ab-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample4.xml)]

<span data-ttu-id="d98ab-172">提供者的 `connectionStringName` 屬性會指定所使用的角色存放區。</span><span class="sxs-lookup"><span data-stu-id="d98ab-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="d98ab-173">`AspNetSqlRoleProvider` 提供者會將這個屬性設定為 `LocalSqlServer`，這也會在 `machine.config` 和點中定義為 `App_Data` 資料夾中名為 `aspnet.mdf`的 SQL Server 2005 Express Edition 資料庫。</span><span class="sxs-lookup"><span data-stu-id="d98ab-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="d98ab-174">因此，如果我們只在應用程式的 `Web.config` 檔中啟用角色架構，而不指定任何提供者資訊，應用程式就會使用預設的已註冊角色提供者，`AspNetSqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="d98ab-175">如果 `~/App_Data/aspnet.mdf` 資料庫不存在，ASP.NET 執行時間會自動建立它並加入應用程式服務架構。</span><span class="sxs-lookup"><span data-stu-id="d98ab-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="d98ab-176">不過，我們不想要使用 `aspnet.mdf` 資料庫;相反地，我們想要使用我們已建立的 `SecurityTutorials.mdf` 資料庫，並將應用程式服務架構新增至。</span><span class="sxs-lookup"><span data-stu-id="d98ab-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="d98ab-177">這項修改可以透過下列兩種方式的其中一種來完成：</span><span class="sxs-lookup"><span data-stu-id="d98ab-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="d98ab-178">在<strong>`Web.config`</strong>中<strong>指定</strong><strong>`LocalSqlServer`</strong><strong>連接字串名稱</strong>的值<strong>。</strong></span><span class="sxs-lookup"><span data-stu-id="d98ab-178"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="d98ab-179">藉由覆寫 `Web.config`中的 `LocalSqlServer` 連接字串名稱值，我們可以使用預設的已註冊角色提供者（`AspNetSqlRoleProvider`），並讓它正確地使用 `SecurityTutorials.mdf` 資料庫。</span><span class="sxs-lookup"><span data-stu-id="d98ab-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="d98ab-180">如需這項技術的詳細資訊，請參閱[Scott Guthrie](https://weblogs.asp.net/scottgu/)的 blog 文章，[將 ASP.NET 2.0 應用程式服務設定為使用 SQL Server 2000 或 SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d98ab-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="d98ab-181"><strong>新增`SqlRoleProvider`類型的已註冊提供者</strong> <strong>，並將其</strong><strong>`connectionStringName`</strong><strong>設定設為指向</strong><strong>`SecurityTutorials.mdf`</strong><strong>資料庫。</strong></span><span class="sxs-lookup"><span data-stu-id="d98ab-181"><strong>Add a new registered provider of type</strong><strong>`SqlRoleProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="d98ab-182">這是我在 SQL Server 教學課程中<a id="_msoanchor_7"> </a>[*建立成員資格架構*](../membership/creating-the-membership-schema-in-sql-server-vb.md)時所建議和使用的方法，而且也是我將在本教學課程中使用的方法。</span><span class="sxs-lookup"><span data-stu-id="d98ab-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="d98ab-183">將下列角色設定標記新增至 `Web.config` 檔案。</span><span class="sxs-lookup"><span data-stu-id="d98ab-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="d98ab-184">此標記會註冊名為的新提供者 `SecurityTutorialsSqlRoleProvider.`</span><span class="sxs-lookup"><span data-stu-id="d98ab-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider.`</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample5.xml)]

<span data-ttu-id="d98ab-185">上述標記會將 `SecurityTutorialsSqlRoleProvider` 定義為預設提供者（透過 `<roleManager>` 元素中的 `defaultProvider` 屬性）。</span><span class="sxs-lookup"><span data-stu-id="d98ab-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="d98ab-186">它也會將 `SecurityTutorialsSqlRoleProvider`的 `applicationName` 設定設定為 `SecurityTutorials`，這是成員資格提供者（`SecurityTutorialsSqlMembershipProvider`）所使用的相同 `applicationName` 設定。</span><span class="sxs-lookup"><span data-stu-id="d98ab-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="d98ab-187">雖然此處未顯示，但 `SqlRoleProvider` 的[`<add>` 元素](https://msdn.microsoft.com/library/ms164662.aspx)也可能包含 `commandTimeout` 屬性，以指定資料庫超時時間（以秒為單位）。</span><span class="sxs-lookup"><span data-stu-id="d98ab-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="d98ab-188">預設值是 30。</span><span class="sxs-lookup"><span data-stu-id="d98ab-188">The default value is 30.</span></span>

<span data-ttu-id="d98ab-189">當此設定標記備妥之後，我們就可以開始在應用程式中使用角色功能。</span><span class="sxs-lookup"><span data-stu-id="d98ab-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="d98ab-190">上述設定標記說明如何使用 `<roleManager>` 元素的 `enabled` 和 `defaultProvider` 屬性。</span><span class="sxs-lookup"><span data-stu-id="d98ab-190">The above configuration markup illustrates using the `<roleManager>` element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="d98ab-191">還有一些其他屬性會影響角色架構如何以使用者為基礎來關聯角色資訊。</span><span class="sxs-lookup"><span data-stu-id="d98ab-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="d98ab-192">我們將在以<a id="_msoanchor_8"> </a>[*角色為基礎的授權*](role-based-authorization-vb.md)教學課程中檢查這些設定。</span><span class="sxs-lookup"><span data-stu-id="d98ab-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial.</span></span>

## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="d98ab-193">步驟3：檢查角色 API</span><span class="sxs-lookup"><span data-stu-id="d98ab-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="d98ab-194">角色架構的功能是透過[`Roles` 類別](https://msdn.microsoft.com/library/system.web.security.roles.aspx)公開，其中包含13個共用方法，可執行以角色為基礎的作業。</span><span class="sxs-lookup"><span data-stu-id="d98ab-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen shared methods for performing role-based operations.</span></span> <span data-ttu-id="d98ab-195">當我們查看在步驟4和6中建立和刪除角色時，將會使用[`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx)和[`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx)方法，這會在系統中新增或移除角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="d98ab-196">若要取得系統中所有角色的清單，請使用[`GetAllRoles` 方法](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)（請參閱步驟5）。</span><span class="sxs-lookup"><span data-stu-id="d98ab-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="d98ab-197">[`RoleExists` 方法](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx)會傳回布林值，指出指定的角色是否存在。</span><span class="sxs-lookup"><span data-stu-id="d98ab-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="d98ab-198">在下一個教學課程中，我們將探討如何將使用者與角色產生關聯。</span><span class="sxs-lookup"><span data-stu-id="d98ab-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="d98ab-199">`Roles` 類別的[`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx)、 [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx)、 [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx)和[`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx)方法會將一或多個使用者新增至一或多個角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="d98ab-200">若要從角色中移除使用者，請使用[`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)、 [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx)、 [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx)或[`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="d98ab-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="d98ab-201">在以<a id="_msoanchor_9"> </a>[*角色為基礎的授權*](role-based-authorization-vb.md)教學課程中，我們將探討以程式設計方式，根據目前登入的使用者角色來顯示或隱藏功能的方式。</span><span class="sxs-lookup"><span data-stu-id="d98ab-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="d98ab-202">為了達成此目的，我們可以使用 Role 類別的[`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx)、 [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx)、 [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)或[`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="d98ab-202">To accomplish this, we can use the Role class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="d98ab-203">請記住，每當叫用其中一種方法時，`Roles` 類別就會將呼叫委派給已設定的提供者。</span><span class="sxs-lookup"><span data-stu-id="d98ab-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="d98ab-204">在我們的案例中，這表示會將呼叫傳送至 `SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="d98ab-205">然後，`SqlRoleProvider` 會根據叫用的方法執行適當的資料庫作業。</span><span class="sxs-lookup"><span data-stu-id="d98ab-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="d98ab-206">例如，程式碼 `Roles.CreateRole("Administrators")` 會導致 `SqlRoleProvider` 執行 `aspnet_Roles_CreateRole` 預存程式，這會將新記錄插入名為 Administrators 的 `aspnet_Roles` 資料表。</span><span class="sxs-lookup"><span data-stu-id="d98ab-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>

<span data-ttu-id="d98ab-207">本教學課程的其餘部分將探討如何使用 `Roles` 類別的 `CreateRole`、`GetAllRoles`和 `DeleteRole` 方法來管理系統中的角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="d98ab-208">步驟4：建立新的角色</span><span class="sxs-lookup"><span data-stu-id="d98ab-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="d98ab-209">角色提供任意群組使用者的方式，而且最常見的群組是用來更方便的方式來套用授權規則。</span><span class="sxs-lookup"><span data-stu-id="d98ab-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="d98ab-210">但是，若要使用角色做為授權機制，我們必須先定義應用程式中存在哪些角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="d98ab-211">可惜的是，ASP.NET 不包含 CreateRoleWizard 控制項。</span><span class="sxs-lookup"><span data-stu-id="d98ab-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="d98ab-212">為了加入新的角色，我們需要建立適當的使用者介面，並自行叫用角色 API。</span><span class="sxs-lookup"><span data-stu-id="d98ab-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="d98ab-213">好消息是，這很容易完成。</span><span class="sxs-lookup"><span data-stu-id="d98ab-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="d98ab-214">雖然沒有 CreateRoleWizard Web 控制項，但有[ASP.NET 的網站管理工具](https://msdn.microsoft.com/library/ms228053.aspx)，它是一種本機 ASP.NET 應用程式，專門設計來協助您查看和管理 Web 應用程式的設定。</span><span class="sxs-lookup"><span data-stu-id="d98ab-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="d98ab-215">不過，我不是 ASP.NET 網站管理工具的大風扇，原因有兩個。</span><span class="sxs-lookup"><span data-stu-id="d98ab-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="d98ab-216">首先，這有點錯誤，而使用者經驗卻不太需要。</span><span class="sxs-lookup"><span data-stu-id="d98ab-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="d98ab-217">第二，ASP.NET 網站管理工具的設計是只在本機上工作，這表示如果您需要從遠端系統管理即時網站上的角色，就必須建立自己的角色管理網頁。</span><span class="sxs-lookup"><span data-stu-id="d98ab-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="d98ab-218">基於這兩個原因，本教學課程和下一步將著重于在網頁中建立必要的角色管理工具，而不是依賴 ASP.NET 的網站管理工具。</span><span class="sxs-lookup"><span data-stu-id="d98ab-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>

<span data-ttu-id="d98ab-219">開啟 [`Roles`] 資料夾中的 [`ManageRoles.aspx`] 頁面，然後在頁面中加入 TextBox 和 Button Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="d98ab-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="d98ab-220">將 TextBox 控制項的 `ID` 屬性設定為 [`RoleName`]，然後將按鈕的 `ID` 和 `Text` 屬性分別設為 [`CreateRoleButton`] 和 [建立角色]。</span><span class="sxs-lookup"><span data-stu-id="d98ab-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="d98ab-221">此時，您頁面的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="d98ab-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample6.aspx)]

<span data-ttu-id="d98ab-222">接下來，按兩下設計工具中的 [`CreateRoleButton`] 按鈕控制項，以建立 `Click` 事件處理常式，然後新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="d98ab-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample7.vb)]

<span data-ttu-id="d98ab-223">上述程式碼一開始會將 [`RoleName`] 文字方塊中輸入的修剪角色名稱，指派給 `newRoleName` 變數。</span><span class="sxs-lookup"><span data-stu-id="d98ab-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="d98ab-224">接下來，會呼叫 `Roles` 類別的 `RoleExists` 方法，以判斷角色 `newRoleName` 是否已存在於系統中。</span><span class="sxs-lookup"><span data-stu-id="d98ab-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="d98ab-225">如果角色不存在，則會透過呼叫 `CreateRole` 方法來建立。</span><span class="sxs-lookup"><span data-stu-id="d98ab-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="d98ab-226">如果將已存在系統中的角色名稱傳遞給 `CreateRole` 方法，則會擲回 `ProviderException` 例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d98ab-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="d98ab-227">這就是為什麼程式碼會先檢查以確保該角色不存在於系統中，然後才呼叫 `CreateRole`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="d98ab-228">`Click` 事件處理常式會藉由清除 `RoleName` TextBox 的 `Text` 屬性來結束。</span><span class="sxs-lookup"><span data-stu-id="d98ab-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="d98ab-229">您可能想知道，如果使用者未在 [`RoleName`] 文字方塊中輸入任何值，將會發生什麼事。</span><span class="sxs-lookup"><span data-stu-id="d98ab-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="d98ab-230">如果傳入 `CreateRole` 方法的值為 `Nothing` 或空字串，則會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d98ab-230">If the value passed into the `CreateRole` method is `Nothing` or an empty string, an exception is raised.</span></span> <span data-ttu-id="d98ab-231">同樣地，如果角色名稱包含逗號，則會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d98ab-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="d98ab-232">因此，此頁面應該包含驗證控制項，以確保使用者輸入角色，且不包含任何逗號。</span><span class="sxs-lookup"><span data-stu-id="d98ab-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="d98ab-233">我為讀者保持練習。</span><span class="sxs-lookup"><span data-stu-id="d98ab-233">I leave as an exercise for the reader.</span></span>

<span data-ttu-id="d98ab-234">讓我們建立一個名為 Administrators 的角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="d98ab-235">透過瀏覽器造訪 `ManageRoles.aspx` 頁面，在文字方塊中輸入 Administrators （請參閱 [圖 3]），然後按一下 [建立角色] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="d98ab-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>

<span data-ttu-id="d98ab-236">[![建立系統管理員角色](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d98ab-236">[![Create an Administrators Role](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span></span>

<span data-ttu-id="d98ab-237">**圖 3**：建立系統管理員角色（[按一下以觀看完整大小的影像](creating-and-managing-roles-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="d98ab-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image9.png))</span></span>

<span data-ttu-id="d98ab-238">會發生什麼事？</span><span class="sxs-lookup"><span data-stu-id="d98ab-238">What happens?</span></span> <span data-ttu-id="d98ab-239">發生回傳，但是沒有視覺提示，因為該角色實際上已加入系統中。</span><span class="sxs-lookup"><span data-stu-id="d98ab-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="d98ab-240">我們會在步驟5中更新此頁面，以包含視覺效果的意見反應。</span><span class="sxs-lookup"><span data-stu-id="d98ab-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="d98ab-241">不過，現在您可以前往 [`SecurityTutorials.mdf`] 資料庫，並顯示 [`aspnet_Roles`] 資料表中的資料，來確認角色是否已建立。</span><span class="sxs-lookup"><span data-stu-id="d98ab-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="d98ab-242">如 [圖 4] 所示，[`aspnet_Roles`] 資料表包含剛新增之系統管理員角色的記錄。</span><span class="sxs-lookup"><span data-stu-id="d98ab-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>

<span data-ttu-id="d98ab-243">[![aspnet_Roles 資料表包含系統管理員的資料列](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="d98ab-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span></span>

<span data-ttu-id="d98ab-244">**圖 4**： `aspnet_Roles` 資料表有系統管理員的資料列（[按一下以查看完整大小的影像](creating-and-managing-roles-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="d98ab-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image12.png))</span></span>

## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="d98ab-245">步驟5：顯示系統中的角色</span><span class="sxs-lookup"><span data-stu-id="d98ab-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="d98ab-246">讓我們擴大 [`ManageRoles.aspx`] 頁面，以包含系統中目前角色的清單。</span><span class="sxs-lookup"><span data-stu-id="d98ab-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="d98ab-247">若要完成此動作，請將 GridView 控制項新增至頁面，並將其 `ID` 屬性設為 `RoleList`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="d98ab-248">接下來，使用下列程式碼，將方法加入至頁面的程式碼後置類別（名為 `DisplayRolesInGrid`）：</span><span class="sxs-lookup"><span data-stu-id="d98ab-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample8.vb)]

<span data-ttu-id="d98ab-249">`Roles` 類別的 `GetAllRoles` 方法會以字串陣列的形式傳回系統中的所有角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="d98ab-250">這個字串陣列接著會系結至 GridView。</span><span class="sxs-lookup"><span data-stu-id="d98ab-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="d98ab-251">若要在第一次載入頁面時將角色清單系結至 GridView，我們需要從頁面的 `Page_Load` 事件處理常式中呼叫 `DisplayRolesInGrid` 方法。</span><span class="sxs-lookup"><span data-stu-id="d98ab-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="d98ab-252">下列程式碼會在第一次流覽頁面時呼叫這個方法，而不是在後續的回傳上。</span><span class="sxs-lookup"><span data-stu-id="d98ab-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample9.vb)]

<span data-ttu-id="d98ab-253">將此程式碼備妥之後，請透過瀏覽器造訪頁面。</span><span class="sxs-lookup"><span data-stu-id="d98ab-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="d98ab-254">如 [圖 5] 所示，您應該會看到一個方格，其中包含標示為 Item 的單一資料行。</span><span class="sxs-lookup"><span data-stu-id="d98ab-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="d98ab-255">方格會針對我們在步驟4中新增的系統管理員角色包含一個資料列。</span><span class="sxs-lookup"><span data-stu-id="d98ab-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>

<span data-ttu-id="d98ab-256">[![GridView 在單一資料行中顯示角色](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d98ab-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span></span>

<span data-ttu-id="d98ab-257">**圖 5**： GridView 會在單一資料行中顯示角色（[按一下以查看完整大小的影像](creating-and-managing-roles-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="d98ab-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image15.png))</span></span>

<span data-ttu-id="d98ab-258">GridView 會顯示標示為 [專案] 的獨立資料行，因為 GridView 的 `AutoGenerateColumns` 屬性設定為 True （預設值），這會導致 GridView 自動為其 `DataSource`中的每個屬性建立資料行。</span><span class="sxs-lookup"><span data-stu-id="d98ab-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="d98ab-259">陣列具有單一屬性，代表陣列中的元素，因此是 GridView 中的單一資料行。</span><span class="sxs-lookup"><span data-stu-id="d98ab-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="d98ab-260">使用 GridView 顯示資料時，我偏好明確定義我的資料行，而不是由 GridView 隱含產生。</span><span class="sxs-lookup"><span data-stu-id="d98ab-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="d98ab-261">藉由明確定義資料行，就能更輕鬆地將資料格式化、重新排列資料行，以及執行其他一般工作。</span><span class="sxs-lookup"><span data-stu-id="d98ab-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="d98ab-262">因此，讓我們更新 GridView 的宣告式標記，以便明確地定義其資料行。</span><span class="sxs-lookup"><span data-stu-id="d98ab-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="d98ab-263">首先，將 GridView 的 `AutoGenerateColumns` 屬性設定為 False。</span><span class="sxs-lookup"><span data-stu-id="d98ab-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="d98ab-264">接下來，將 TemplateField 新增至方格，將其 `HeaderText` 屬性設為 角色，並設定其 `ItemTemplate`，讓它顯示陣列的內容。</span><span class="sxs-lookup"><span data-stu-id="d98ab-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="d98ab-265">若要完成此動作，請將名為 `RoleNameLabel` 的標籤 Web 控制項新增至 `ItemTemplate`，並將其 `Text` 屬性系結至 `Container.DataItem.`</span><span class="sxs-lookup"><span data-stu-id="d98ab-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem.`</span></span>

<span data-ttu-id="d98ab-266">這些屬性和 `ItemTemplate`的內容可以用宣告方式或透過 GridView 的 [欄位] 對話方塊和 [編輯範本] 介面來設定。</span><span class="sxs-lookup"><span data-stu-id="d98ab-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="d98ab-267">若要到達 [欄位] 對話方塊，請按一下 GridView 智慧標籤中的 [編輯資料行] 連結。</span><span class="sxs-lookup"><span data-stu-id="d98ab-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="d98ab-268">接下來，取消核取 [自動產生欄位] 核取方塊，將 `AutoGenerateColumns` 屬性設定為 [False]，然後將 TemplateField 新增至 GridView，將其 [`HeaderText`] 屬性設定為 [角色]。</span><span class="sxs-lookup"><span data-stu-id="d98ab-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="d98ab-269">若要定義 `ItemTemplate`的內容，請從 GridView 的智慧標籤中選擇 [編輯範本] 選項。</span><span class="sxs-lookup"><span data-stu-id="d98ab-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="d98ab-270">將 [標籤] Web 控制項拖曳至 [`ItemTemplate`]，將其 [`ID`] 屬性設為 [`RoleNameLabel`]，並設定其資料系結設定，使其 `Text` 屬性系結至 `Container.DataItem`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="d98ab-271">無論您使用何種方法，GridView 產生的宣告式標記在完成時看起來應該如下所示。</span><span class="sxs-lookup"><span data-stu-id="d98ab-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="d98ab-272">陣列的內容會使用資料系結語法 `<%# Container.DataItem %>`來顯示。</span><span class="sxs-lookup"><span data-stu-id="d98ab-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="d98ab-273">有關在顯示系結至 GridView 的陣列內容時，為何使用此語法的詳細說明，已超出本教學課程的範圍。</span><span class="sxs-lookup"><span data-stu-id="d98ab-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="d98ab-274">如需有關此問題的詳細資訊，請參閱將純量陣列系結[至資料 Web 控制項](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d98ab-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="d98ab-275">目前，`RoleList` GridView 只會在第一次造訪網頁時系結至角色清單。</span><span class="sxs-lookup"><span data-stu-id="d98ab-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="d98ab-276">每當新增新角色時，就需要重新整理方格。</span><span class="sxs-lookup"><span data-stu-id="d98ab-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="d98ab-277">若要完成此動作，請更新 `CreateRoleButton` 按鈕的 `Click` 事件處理常式，以便在建立新角色時呼叫 `DisplayRolesInGrid` 方法。</span><span class="sxs-lookup"><span data-stu-id="d98ab-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample11.vb)]

<span data-ttu-id="d98ab-278">現在當使用者新增新角色時，`RoleList` GridView 會在回傳時顯示剛新增的角色，並提供已成功建立角色的視覺化回饋。</span><span class="sxs-lookup"><span data-stu-id="d98ab-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="d98ab-279">為了說明這一點，請造訪瀏覽器中的 [`ManageRoles.aspx`] 頁面，並新增名為 [主管] 的角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="d98ab-280">當您按一下 [建立角色] 按鈕時，回傳將會控制發生，且方格會更新為包含系統管理員以及新角色 [主管]。</span><span class="sxs-lookup"><span data-stu-id="d98ab-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>

<span data-ttu-id="d98ab-281">[已新增 ![監督員角色](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="d98ab-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span></span>

<span data-ttu-id="d98ab-282">**圖 6**：已新增監督員角色（[按一下以觀看完整大小的影像](creating-and-managing-roles-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="d98ab-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image18.png))</span></span>

## <a name="step-6-deleting-roles"></a><span data-ttu-id="d98ab-283">步驟6：刪除角色</span><span class="sxs-lookup"><span data-stu-id="d98ab-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="d98ab-284">此時，使用者可以建立新的角色，並從 [`ManageRoles.aspx`] 頁面中查看所有現有的角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="d98ab-285">讓我們允許使用者也刪除角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="d98ab-286">`Roles.DeleteRole` 的方法有兩個多載：</span><span class="sxs-lookup"><span data-stu-id="d98ab-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="d98ab-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) -*刪除角色擁有*端。</span><span class="sxs-lookup"><span data-stu-id="d98ab-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="d98ab-288">如果角色包含一或多個成員，則會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d98ab-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="d98ab-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) -*刪除角色擁有*端。</span><span class="sxs-lookup"><span data-stu-id="d98ab-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="d98ab-290">如果 `True`*throwOnPopulateRole* ，則如果角色包含一或多個成員，就會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d98ab-290">If *throwOnPopulateRole* is `True`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="d98ab-291">如果 `False`*throwOnPopulateRole* ，則會刪除角色，不論其是否包含任何成員。</span><span class="sxs-lookup"><span data-stu-id="d98ab-291">If *throwOnPopulateRole* is `False`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="d98ab-292">就內部而言，`DeleteRole(roleName)` 方法會呼叫 `DeleteRole(roleName, True)`。</span><span class="sxs-lookup"><span data-stu-id="d98ab-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, True)`.</span></span>

<span data-ttu-id="d98ab-293">如果使用*的是 `Nothing`* 或空字串，或如果使用*中包含逗號*，則 `DeleteRole` 方法也會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d98ab-293">The `DeleteRole` method will also throw an exception if *roleName* is `Nothing` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="d98ab-294">如果*系統中沒有該*等位，`DeleteRole` 會無訊息地失敗，而不會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="d98ab-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="d98ab-295">讓我們將 `ManageRoles.aspx` 中的 GridView 擴大為包含 [刪除] 按鈕，當您按一下時，就會刪除選取的角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="d98ab-296">首先，前往 [欄位] 對話方塊並新增 [刪除] 按鈕（位於 [CommandField] 選項底下），將 [刪除] 按鈕新增至 GridView。</span><span class="sxs-lookup"><span data-stu-id="d98ab-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="d98ab-297">將 [刪除] 按鈕設為最左邊的資料行，並將其 `DeleteText` 屬性設定為 [刪除角色]。</span><span class="sxs-lookup"><span data-stu-id="d98ab-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>

<span data-ttu-id="d98ab-298">[![將 [刪除] 按鈕新增至 Rolelist& roles GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d98ab-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span></span>

<span data-ttu-id="d98ab-299">**圖 7**：將 [刪除] 按鈕新增至 `RoleList` GridView （[按一下以查看完整大小的影像](creating-and-managing-roles-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="d98ab-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image21.png))</span></span>

<span data-ttu-id="d98ab-300">加入 [刪除] 按鈕之後，GridView 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="d98ab-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample12.aspx)]

<span data-ttu-id="d98ab-301">接下來，為 GridView 的 `RowDeleting` 事件建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="d98ab-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="d98ab-302">這是按一下 [刪除角色] 按鈕時，在回傳時引發的事件。</span><span class="sxs-lookup"><span data-stu-id="d98ab-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="d98ab-303">將下列程式碼加入事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="d98ab-303">Add the following code to the event handler.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample13.vb)]

<span data-ttu-id="d98ab-304">程式碼一開始會以程式設計方式，參考已按下 [刪除角色] 按鈕的資料列中的 `RoleNameLabel` Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="d98ab-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="d98ab-305">接著會叫用 `Roles.DeleteRole` 方法，傳入 `RoleNameLabel` 和 `False`的 `Text`，藉此刪除角色，而不論是否有任何使用者與角色相關聯。</span><span class="sxs-lookup"><span data-stu-id="d98ab-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `False`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="d98ab-306">最後，`RoleList` GridView 會重新整理，使剛刪除的角色不會再出現在方格中。</span><span class="sxs-lookup"><span data-stu-id="d98ab-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="d98ab-307">在刪除角色之前，[刪除角色] 按鈕不需要使用者進行任何確認。</span><span class="sxs-lookup"><span data-stu-id="d98ab-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="d98ab-308">確認動作最簡單的方法之一，是透過用戶端確認對話方塊。</span><span class="sxs-lookup"><span data-stu-id="d98ab-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="d98ab-309">如需這項技術的詳細資訊，請參閱[在刪除時新增用戶端確認](https://asp.net/learn/data-access/tutorial-42-vb.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d98ab-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="d98ab-310">總結</span><span class="sxs-lookup"><span data-stu-id="d98ab-310">Summary</span></span>

<span data-ttu-id="d98ab-311">許多 web 應用程式都有特定的授權規則或頁面層級功能，僅供特定的使用者類別使用。</span><span class="sxs-lookup"><span data-stu-id="d98ab-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="d98ab-312">例如，可能有一組只有系統管理員可以存取的網頁。</span><span class="sxs-lookup"><span data-stu-id="d98ab-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="d98ab-313">與其以使用者為基礎定義這些授權規則，通常會比根據角色定義規則更有説明。</span><span class="sxs-lookup"><span data-stu-id="d98ab-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="d98ab-314">也就是說，不是明確允許 Scott 和 Jisun 存取系統管理網頁，而是允許系統管理員角色的成員存取這些頁面，然後代表 Scott 和 Jisun，因為使用者屬於系統管理員角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="d98ab-315">角色架構可讓您輕鬆地建立及管理角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="d98ab-316">在本教學課程中，我們已檢查如何設定 Roles 架構，以使用 `SqlRoleProvider`，其使用 Microsoft SQL Server 資料庫做為角色存放區。</span><span class="sxs-lookup"><span data-stu-id="d98ab-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="d98ab-317">我們也建立了一個網頁，其中列出系統中的現有角色，並允許建立新的角色並刪除現有的角色。</span><span class="sxs-lookup"><span data-stu-id="d98ab-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="d98ab-318">在後續的教學課程中，我們將瞭解如何將使用者指派給角色，以及如何套用以角色為基礎的授權。</span><span class="sxs-lookup"><span data-stu-id="d98ab-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="d98ab-319">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="d98ab-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="d98ab-320">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="d98ab-320">Further Reading</span></span>

<span data-ttu-id="d98ab-321">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="d98ab-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d98ab-322">檢查 ASP.NET 2.0 的成員資格、角色和設定檔</span><span class="sxs-lookup"><span data-stu-id="d98ab-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="d98ab-323">如何：在 ASP.NET 2.0 中使用角色管理員</span><span class="sxs-lookup"><span data-stu-id="d98ab-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="d98ab-324">角色提供者</span><span class="sxs-lookup"><span data-stu-id="d98ab-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="d98ab-325">推出您自己的網站管理工具</span><span class="sxs-lookup"><span data-stu-id="d98ab-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="d98ab-326">`<roleManager>` 元素的技術檔</span><span class="sxs-lookup"><span data-stu-id="d98ab-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="d98ab-327">使用成員資格和角色管理員 Api</span><span class="sxs-lookup"><span data-stu-id="d98ab-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="d98ab-328">關於作者</span><span class="sxs-lookup"><span data-stu-id="d98ab-328">About the Author</span></span>

<span data-ttu-id="d98ab-329">Scott Mitchell，自1998起，有多個 ASP/ASP. NET 書籍和創辦人的4GuysFromRolla.com。</span><span class="sxs-lookup"><span data-stu-id="d98ab-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d98ab-330">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="d98ab-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d98ab-331">他的最新著作是 *[在24小時內讓自己的 ASP.NET 2.0](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* 。</span><span class="sxs-lookup"><span data-stu-id="d98ab-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="d98ab-332">Scott 可以在[mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)或透過他在[http://ScottOnWriting.NET](http://scottonwriting.net/)的 blog。</span><span class="sxs-lookup"><span data-stu-id="d98ab-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="d98ab-333">特別感謝</span><span class="sxs-lookup"><span data-stu-id="d98ab-333">Special Thanks To</span></span>

<span data-ttu-id="d98ab-334">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="d98ab-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d98ab-335">本教學課程的領導審查者包括 Alicja Maziarz、Suchi Banerjee 和 Teresa Murphy。</span><span class="sxs-lookup"><span data-stu-id="d98ab-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="d98ab-336">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="d98ab-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d98ab-337">若是如此，請在[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)下拉一行</span><span class="sxs-lookup"><span data-stu-id="d98ab-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d98ab-338">[上一頁](role-based-authorization-cs.md)
> [下一頁](assigning-roles-to-users-vb.md)</span><span class="sxs-lookup"><span data-stu-id="d98ab-338">[Previous](role-based-authorization-cs.md)
[Next](assigning-roles-to-users-vb.md)</span></span>
