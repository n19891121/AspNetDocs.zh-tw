---
uid: web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
title: 建立資料存取層（C#） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將從頭開始，並使用具類型資料集來建立資料存取層（DAL）來存取資料庫中的資訊。
ms.author: riande
ms.date: 04/05/2010
ms.assetid: cfe2a6a0-1e56-4dc8-9537-c8ec76ba96a4
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 5aaf97dc8448dcb7b94ef2e4e23f34fd37ac4426
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78605039"
---
# <a name="creating-a-data-access-layer-c"></a><span data-ttu-id="c0eca-103">建立資料存取層 (C#)</span><span class="sxs-lookup"><span data-stu-id="c0eca-103">Creating a Data Access Layer (C#)</span></span>

<span data-ttu-id="c0eca-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c0eca-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

[<span data-ttu-id="c0eca-105">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="c0eca-105">Download PDF</span></span>](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)

> <span data-ttu-id="c0eca-106">在本教學課程中，我們將從頭開始，並使用具類型資料集來建立資料存取層（DAL）來存取資料庫中的資訊。</span><span class="sxs-lookup"><span data-stu-id="c0eca-106">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), using typed DataSets, to access the information in a database.</span></span>

## <a name="introduction"></a><span data-ttu-id="c0eca-107">簡介</span><span class="sxs-lookup"><span data-stu-id="c0eca-107">Introduction</span></span>

<span data-ttu-id="c0eca-108">身為 網頁程式開發人員，我們的生活會在處理資料方面。</span><span class="sxs-lookup"><span data-stu-id="c0eca-108">As web developers, our lives revolve around working with data.</span></span> <span data-ttu-id="c0eca-109">我們會建立用來儲存資料的資料庫、用來抓取和修改的程式碼，以及用來收集和摘要的 web 網頁。</span><span class="sxs-lookup"><span data-stu-id="c0eca-109">We create databases to store the data, code to retrieve and modify it, and web pages to collect and summarize it.</span></span> <span data-ttu-id="c0eca-110">這是冗長系列中的第一個教學課程，會探索在 ASP.NET 2.0 中執行這些常見模式的技術。</span><span class="sxs-lookup"><span data-stu-id="c0eca-110">This is the first tutorial in a lengthy series that will explore techniques for implementing these common patterns in ASP.NET 2.0.</span></span> <span data-ttu-id="c0eca-111">我們將從建立由資料存取層（DAL）組成的[軟體架構](http://en.wikipedia.org/wiki/Software_architecture)，使用具類型的資料集、會強制執行自訂商務規則的商業邏輯層（BLL），以及由共用通用頁面配置的 ASP.NET 網頁組成的展示層。</span><span class="sxs-lookup"><span data-stu-id="c0eca-111">We'll start with creating a [software architecture](http://en.wikipedia.org/wiki/Software_architecture) composed of a Data Access Layer (DAL) using Typed DataSets, a Business Logic Layer (BLL) that enforces custom business rules, and a presentation layer composed of ASP.NET pages that share a common page layout.</span></span> <span data-ttu-id="c0eca-112">一旦完成這後端的基礎，我們將移至報告，示範如何顯示、摘要、收集和驗證 web 應用程式中的資料。</span><span class="sxs-lookup"><span data-stu-id="c0eca-112">Once this backend groundwork has been laid, we'll move into reporting, showing how to display, summarize, collect, and validate data from a web application.</span></span> <span data-ttu-id="c0eca-113">這些教學課程的目的是要精簡，並提供逐步指示，讓您能以視覺化方式逐步完成整個流程。</span><span class="sxs-lookup"><span data-stu-id="c0eca-113">These tutorials are geared to be concise and provide step-by-step instructions with plenty of screen shots to walk you through the process visually.</span></span> <span data-ttu-id="c0eca-114">每個教學課程都C#可在和 Visual Basic 版本中取得，並包含下載所使用的完整程式碼。</span><span class="sxs-lookup"><span data-stu-id="c0eca-114">Each tutorial is available in C# and Visual Basic versions and includes a download of the complete code used.</span></span> <span data-ttu-id="c0eca-115">（第一個教學課程的時間很長，但其餘部分會以更消化的區塊呈現）。</span><span class="sxs-lookup"><span data-stu-id="c0eca-115">(This first tutorial is quite lengthy, but the rest are presented in much more digestible chunks.)</span></span>

<span data-ttu-id="c0eca-116">在這些教學課程中，我們將使用位於**應用程式\_資料**目錄中的 Microsoft SQL Server 2005 Express Edition 版本的 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0eca-116">For these tutorials we'll be using a Microsoft SQL Server 2005 Express Edition version of the Northwind database placed in the **App\_Data** directory.</span></span> <span data-ttu-id="c0eca-117">除了資料庫檔案之外，**應用程式\_Data**資料夾也包含用來建立資料庫的 SQL 腳本，以防您想要使用不同的資料庫版本。</span><span class="sxs-lookup"><span data-stu-id="c0eca-117">In addition to the database file, the **App\_Data** folder also contains the SQL scripts for creating the database, in case you want to use a different database version.</span></span> <span data-ttu-id="c0eca-118">如果您想要的話，也可以[直接從 Microsoft 下載](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)這些腳本。</span><span class="sxs-lookup"><span data-stu-id="c0eca-118">These scripts can be also be [downloaded directly from Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), if you'd prefer.</span></span> <span data-ttu-id="c0eca-119">如果您使用不同的 SQL Server 版本的 Northwind 資料庫，則必須更新應用程式的**web.config**檔案中的**NORTHWNDConnectionString**設定。</span><span class="sxs-lookup"><span data-stu-id="c0eca-119">If you use a different SQL Server version of the Northwind database, you will need to update the **NORTHWNDConnectionString** setting in the application's **Web.config** file.</span></span> <span data-ttu-id="c0eca-120">Web 應用程式是使用 Visual Studio 2005 Professional Edition 作為以檔案系統為基礎的網站專案所建立。</span><span class="sxs-lookup"><span data-stu-id="c0eca-120">The web application was built using Visual Studio 2005 Professional Edition as a file system-based Web site project.</span></span> <span data-ttu-id="c0eca-121">不過，所有教學課程都適用于免費版的 Visual Studio 2005、 [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/)。</span><span class="sxs-lookup"><span data-stu-id="c0eca-121">However, all of the tutorials will work equally well with the free version of Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span></span>  
  
<span data-ttu-id="c0eca-122">在本教學課程中，我們將從頭開始，並建立資料存取層（DAL），接著在第二個教學課程中建立商務邏輯層（BLL），然後使用第三個頁面配置和導覽。</span><span class="sxs-lookup"><span data-stu-id="c0eca-122">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), followed by creating the Business Logic Layer (BLL) in the second tutorial, and working on page layout and navigation in the third.</span></span> <span data-ttu-id="c0eca-123">第三個教學課程之後，將會根據前三個所配置的基礎來建立。</span><span class="sxs-lookup"><span data-stu-id="c0eca-123">The tutorials after the third one will build upon the foundation laid in the first three.</span></span> <span data-ttu-id="c0eca-124">在第一個教學課程中，我們有很多討論，所以 Visual Studio，讓我們開始吧！</span><span class="sxs-lookup"><span data-stu-id="c0eca-124">We've got a lot to cover in this first tutorial, so fire up Visual Studio and let's get started!</span></span>

## <a name="step-1-creating-a-web-project-and-connecting-to-the-database"></a><span data-ttu-id="c0eca-125">步驟1：建立 Web 專案並連接到資料庫</span><span class="sxs-lookup"><span data-stu-id="c0eca-125">Step 1: Creating a Web Project and Connecting to the Database</span></span>

<span data-ttu-id="c0eca-126">在建立資料存取層（DAL）之前，我們必須先建立網站，並設定我們的資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0eca-126">Before we can create our Data Access Layer (DAL), we first need to create a web site and setup our database.</span></span> <span data-ttu-id="c0eca-127">一開始請先建立新的以檔案系統為基礎的 ASP.NET 網站。</span><span class="sxs-lookup"><span data-stu-id="c0eca-127">Start by creating a new file system-based ASP.NET web site.</span></span> <span data-ttu-id="c0eca-128">若要完成此動作，請移至 [檔案] 功能表，然後選擇 [新網站]，並顯示 [新網站] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="c0eca-128">To accomplish this, go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="c0eca-129">選擇 [ASP.NET 網站] 範本，將 [位置] 下拉式清單設定為 [檔案系統]，選擇要放置網站的資料夾，然後將語言設定為C#。</span><span class="sxs-lookup"><span data-stu-id="c0eca-129">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to C#.</span></span>

<span data-ttu-id="c0eca-130">[![建立以檔案系統為基礎的新網站](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-130">[![Create a New File System-Based Web Site](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span></span>

<span data-ttu-id="c0eca-131">**圖 1**：建立以檔案系統為基礎的新網站（[按一下以觀看完整大小的影像](creating-a-data-access-layer-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-131">**Figure 1**: Create a New File System-Based Web Site ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image3.png))</span></span>

<span data-ttu-id="c0eca-132">這會建立一個新的網站，其中包含**default.aspx** ASP.NET 網頁和**應用程式\_Data**資料夾。</span><span class="sxs-lookup"><span data-stu-id="c0eca-132">This will create a new web site with a **Default.aspx** ASP.NET page and an **App\_Data** folder.</span></span>

<span data-ttu-id="c0eca-133">建立網站後，下一個步驟是在 Visual Studio 的伺服器總管中加入資料庫的參考。</span><span class="sxs-lookup"><span data-stu-id="c0eca-133">With the web site created, the next step is to add a reference to the database in Visual Studio's Server Explorer.</span></span> <span data-ttu-id="c0eca-134">藉由將資料庫加入伺服器總管，您可以從 Visual Studio 內新增資料表、預存程式、views 等等。</span><span class="sxs-lookup"><span data-stu-id="c0eca-134">By adding a database to the Server Explorer you can add tables, stored procedures, views, and so on all from within Visual Studio.</span></span> <span data-ttu-id="c0eca-135">您也可以透過 [查詢產生器] 手動或以圖形方式來查看資料表資料或建立自己的查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-135">You can also view table data or create your own queries either by hand or graphically via the Query Builder.</span></span> <span data-ttu-id="c0eca-136">此外，當我們為 DAL 建立具類型的資料集時，我們必須將 Visual Studio 指向應該用來結構化具類型資料集的資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0eca-136">Furthermore, when we build the Typed DataSets for the DAL we'll need to point Visual Studio to the database from which the Typed DataSets should be constructed.</span></span> <span data-ttu-id="c0eca-137">雖然我們可以在該時間點提供此連接資訊，Visual Studio 會自動填入伺服器總管中已註冊之資料庫的下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="c0eca-137">While we can provide this connection information at that point in time, Visual Studio automatically populates a drop-down list of the databases already registered in the Server Explorer.</span></span>

<span data-ttu-id="c0eca-138">將 Northwind 資料庫新增至伺服器總管的步驟取決於您想要使用**應用程式\_** 資料夾中的 SQL Server 2005 Express Edition 資料庫，還是您有想要改用 Microsoft SQL Server 2000 或2005資料庫伺服器安裝程式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-138">The steps for adding the Northwind database to the Server Explorer depend on whether you want to use the SQL Server 2005 Express Edition database in the **App\_Data** folder or if you have a Microsoft SQL Server 2000 or 2005 database server setup that you want to use instead.</span></span>

## <a name="using-a-database-in-the-app_data-folder"></a><span data-ttu-id="c0eca-139">使用應用程式中的資料庫\_Data 資料夾</span><span class="sxs-lookup"><span data-stu-id="c0eca-139">Using a Database in the App\_Data Folder</span></span>

<span data-ttu-id="c0eca-140">如果您沒有要連接的 SQL Server 2000 或2005資料庫伺服器，或者您只想要避免將資料庫新增至資料庫伺服器，您可以使用下載網站的**應用程式\_Data**資料夾（northwnd.mdf 檔）中的 SQL Server 2005 Express Edition 版本的 Northwind 資料庫 **.MDF**）。</span><span class="sxs-lookup"><span data-stu-id="c0eca-140">If you do not have a SQL Server 2000 or 2005 database server to connect to, or you simply want to avoid having to add the database to a database server, you can use the SQL Server 2005 Express Edition version of the Northwind database that is located in the downloaded website's **App\_Data** folder (**NORTHWND.MDF**).</span></span>

<span data-ttu-id="c0eca-141">放在**應用程式\_Data**資料夾中的資料庫會自動新增至伺服器總管。</span><span class="sxs-lookup"><span data-stu-id="c0eca-141">A database placed in the **App\_Data** folder is automatically added to the Server Explorer.</span></span> <span data-ttu-id="c0eca-142">假設您已在電腦上安裝 SQL Server 2005 Express Edition，您應該會看到名為 NORTHWND.MDF 檔的節點。MDF 在伺服器總管中，您可以展開並流覽其資料表、視圖、預存程式等（請參閱 [圖 2]）。</span><span class="sxs-lookup"><span data-stu-id="c0eca-142">Assuming you have SQL Server 2005 Express Edition installed on your machine you should see a node named NORTHWND.MDF in the Server Explorer, which you can expand and explore its tables, views, stored procedure, and so on (see Figure 2).</span></span>

<span data-ttu-id="c0eca-143">**應用程式\_Data**資料夾也可以保存 Microsoft Access **.mdb**檔案，如同其 SQL Server 對應專案一樣，會自動新增至伺服器總管。</span><span class="sxs-lookup"><span data-stu-id="c0eca-143">The **App\_Data** folder can also hold Microsoft Access **.mdb** files, which, like their SQL Server counterparts, are automatically added to the Server Explorer.</span></span> <span data-ttu-id="c0eca-144">如果您不想要使用任何 SQL Server 選項，可以隨時[下載 Northwind 資料庫檔案的 Microsoft Access 版本](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN)，並將其放入**應用程式\_資料**目錄中。</span><span class="sxs-lookup"><span data-stu-id="c0eca-144">If you don't want to use any of the SQL Server options, you can always [download a Microsoft Access version of the Northwind database file](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) and drop into the **App\_Data** directory.</span></span> <span data-ttu-id="c0eca-145">不過，請記住，Access 資料庫並不像 SQL Server 的功能豐富，而且不是設計用於網站案例中。</span><span class="sxs-lookup"><span data-stu-id="c0eca-145">Keep in mind, however, that Access databases aren't as feature-rich as SQL Server, and aren't designed to be used in web site scenarios.</span></span> <span data-ttu-id="c0eca-146">此外，有幾個35個以上的教學課程會利用存取所不支援的某些資料庫層級功能。</span><span class="sxs-lookup"><span data-stu-id="c0eca-146">Furthermore, a couple of the 35+ tutorials will utilize certain database-level features that aren't supported by Access.</span></span>

## <a name="connecting-to-the-database-in-a-microsoft-sql-server-2000-or-2005-database-server"></a><span data-ttu-id="c0eca-147">連接到 Microsoft SQL Server 2000 或2005資料庫伺服器中的資料庫</span><span class="sxs-lookup"><span data-stu-id="c0eca-147">Connecting to the Database in a Microsoft SQL Server 2000 or 2005 Database Server</span></span>

<span data-ttu-id="c0eca-148">或者，您也可以連接到安裝在資料庫伺服器上的 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0eca-148">Alternatively, you may connect to a Northwind database installed on a database server.</span></span> <span data-ttu-id="c0eca-149">如果資料庫伺服器尚未安裝 Northwind 資料庫，您必須先執行本教學課程下載所包含的安裝腳本，或直接從 Microsoft 網站[下載 SQL Server 2000 版的 Northwind 和安裝腳本](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)，以將它加入至資料庫伺服器。</span><span class="sxs-lookup"><span data-stu-id="c0eca-149">If the database server does not already have the Northwind database installed, you first must add it to database server by running the installation script included in this tutorial's download or by [downloading the SQL Server 2000 version of Northwind and installation script](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directly from Microsoft's web site.</span></span>

<span data-ttu-id="c0eca-150">安裝資料庫之後，請移至 Visual Studio 中的伺服器總管，以滑鼠右鍵按一下 [資料連線] 節點，然後選擇 [加入連接]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-150">Once you have the database installed, go to the Server Explorer in Visual Studio, right-click on the Data Connections node, and choose Add Connection.</span></span> <span data-ttu-id="c0eca-151">如果您看不到 伺服器總管移至 View/伺服器總管，或按 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="c0eca-151">If you don't see the Server Explorer go to the View / Server Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="c0eca-152">這會顯示 [新增連接] 對話方塊，您可以在其中指定要連接的伺服器、驗證資訊，以及資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="c0eca-152">This will bring up the Add Connection dialog box, where you can specify the server to connect to, the authentication information, and the database name.</span></span> <span data-ttu-id="c0eca-153">當您成功設定資料庫連接資訊，並按一下 [確定] 按鈕之後，資料庫就會加入為 [資料連線] 節點底下的節點。</span><span class="sxs-lookup"><span data-stu-id="c0eca-153">Once you have successfully configured the database connection information and clicked the OK button, the database will be added as a node underneath the Data Connections node.</span></span> <span data-ttu-id="c0eca-154">您可以展開資料庫節點，以流覽其資料表、視圖、預存程式等等。</span><span class="sxs-lookup"><span data-stu-id="c0eca-154">You can expand the database node to explore its tables, views, stored procedures, and so on.</span></span>

![新增連接至資料庫伺服器的 Northwind 資料庫](creating-a-data-access-layer-cs/_static/image4.png)

<span data-ttu-id="c0eca-156">**圖 2**：將連接新增至資料庫伺服器的 Northwind 資料庫</span><span class="sxs-lookup"><span data-stu-id="c0eca-156">**Figure 2**: Add a Connection to Your Database Server's Northwind Database</span></span>

## <a name="step-2-creating-the-data-access-layer"></a><span data-ttu-id="c0eca-157">步驟2：建立資料存取層</span><span class="sxs-lookup"><span data-stu-id="c0eca-157">Step 2: Creating the Data Access Layer</span></span>

<span data-ttu-id="c0eca-158">使用資料時，其中一個選項是將資料特有的邏輯直接內嵌到展示層（在 web 應用程式中，ASP.NET 網頁會構成展示層）。</span><span class="sxs-lookup"><span data-stu-id="c0eca-158">When working with data one option is to embed the data-specific logic directly into the presentation layer (in a web application, the ASP.NET pages make up the presentation layer).</span></span> <span data-ttu-id="c0eca-159">這可能會在 ASP.NET 網頁的程式碼部分中撰寫 ADO.NET 程式碼，或使用標記部分的 SqlDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="c0eca-159">This may take the form of writing ADO.NET code in the ASP.NET page's code portion or using the SqlDataSource control from the markup portion.</span></span> <span data-ttu-id="c0eca-160">不論是哪一種情況，這種方法都會將資料存取邏輯與展示層緊密耦合在一起。</span><span class="sxs-lookup"><span data-stu-id="c0eca-160">In either case, this approach tightly couples the data access logic with the presentation layer.</span></span> <span data-ttu-id="c0eca-161">不過，建議的方法是將資料存取邏輯與展示層分開。</span><span class="sxs-lookup"><span data-stu-id="c0eca-161">The recommended approach, however, is to separate the data access logic from the presentation layer.</span></span> <span data-ttu-id="c0eca-162">這種個別層稱為「資料存取層」，簡稱為 DAL，而且通常會實作為個別的類別庫專案。</span><span class="sxs-lookup"><span data-stu-id="c0eca-162">This separate layer is referred to as the Data Access Layer, DAL for short, and is typically implemented as a separate Class Library project.</span></span> <span data-ttu-id="c0eca-163">此分層架構的優點已妥善記載（請參閱本教學課程結尾處的「進一步閱讀」一節，以取得這些優點的相關資訊），這是我們將在此系列中採用的方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-163">The benefits of this layered architecture are well documented (see the "Further Readings" section at the end of this tutorial for information on these advantages) and is the approach we will take in this series.</span></span>

<span data-ttu-id="c0eca-164">基礎資料來源特有的所有程式碼，例如建立資料庫連接、發行**SELECT**、 **INSERT**、 **UPDATE**和**DELETE**命令等等，都應該位於 DAL 中。</span><span class="sxs-lookup"><span data-stu-id="c0eca-164">All code that is specific to the underlying data source such as creating a connection to the database, issuing **SELECT**, **INSERT**, **UPDATE**, and **DELETE** commands, and so on should be located in the DAL.</span></span> <span data-ttu-id="c0eca-165">展示層不應包含任何對這類資料存取程式碼的參考，而應該改為呼叫 DAL 以進行任何和所有資料要求。</span><span class="sxs-lookup"><span data-stu-id="c0eca-165">The presentation layer should not contain any references to such data access code, but should instead make calls into the DAL for any and all data requests.</span></span> <span data-ttu-id="c0eca-166">資料存取層通常包含存取基礎資料庫資料的方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-166">Data Access Layers typically contain methods for accessing the underlying database data.</span></span> <span data-ttu-id="c0eca-167">例如，Northwind 資料庫具有**products**和 category 資料表，可記錄要銷售的產品及其所屬的**類別目錄。**</span><span class="sxs-lookup"><span data-stu-id="c0eca-167">The Northwind database, for example, has **Products** and **Categories** tables that record the products for sale and the categories to which they belong.</span></span> <span data-ttu-id="c0eca-168">在 DAL 中，我們將會有如下的方法：</span><span class="sxs-lookup"><span data-stu-id="c0eca-168">In our DAL we will have methods like:</span></span>

- <span data-ttu-id="c0eca-169">**GetCategories （），** 它會傳回所有類別的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="c0eca-169">**GetCategories(),** which will return information about all of the categories</span></span>
- <span data-ttu-id="c0eca-170">**GetProducts （）** ，它會傳回所有產品的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="c0eca-170">**GetProducts()**, which will return information about all of the products</span></span>
- <span data-ttu-id="c0eca-171">**GetProductsByCategoryID （*類別*目錄）** ，會傳回屬於指定分類的所有產品</span><span class="sxs-lookup"><span data-stu-id="c0eca-171">**GetProductsByCategoryID(*categoryID*)**, which will return all products that belong to a specified category</span></span>
- <span data-ttu-id="c0eca-172">**GetProductByProductID （*productID*）** ，會傳回特定產品的相關資訊</span><span class="sxs-lookup"><span data-stu-id="c0eca-172">**GetProductByProductID(*productID*)**, which will return information about a particular product</span></span>

<span data-ttu-id="c0eca-173">這些方法在叫用時，將會連接到資料庫、發出適當的查詢，然後傳回結果。</span><span class="sxs-lookup"><span data-stu-id="c0eca-173">These methods, when invoked, will connect to the database, issue the appropriate query, and return the results.</span></span> <span data-ttu-id="c0eca-174">我們傳回這些結果的方式很重要。</span><span class="sxs-lookup"><span data-stu-id="c0eca-174">How we return these results is important.</span></span> <span data-ttu-id="c0eca-175">這些方法可能只會傳回資料庫查詢所填入的資料集或 DataReader，但最好是使用*強型別物件*傳回這些結果。</span><span class="sxs-lookup"><span data-stu-id="c0eca-175">These methods could simply return a DataSet or DataReader populated by the database query, but ideally these results should be returned using *strongly-typed objects*.</span></span> <span data-ttu-id="c0eca-176">強型別物件是其架構在編譯時期是嚴格定義的，相反地，是鬆散型別物件，這是在執行時間之前不知道其架構的一個。</span><span class="sxs-lookup"><span data-stu-id="c0eca-176">A strongly-typed object is one whose schema is rigidly defined at compile time, whereas the opposite, a loosely-typed object, is one whose schema is not known until runtime.</span></span>

<span data-ttu-id="c0eca-177">例如，DataReader 和資料集（預設值）是鬆散類型的物件，因為其架構是由用來填入它們的資料庫查詢所傳回的資料行所定義。</span><span class="sxs-lookup"><span data-stu-id="c0eca-177">For example, the DataReader and the DataSet (by default) are loosely-typed objects since their schema is defined by the columns returned by the database query used to populate them.</span></span> <span data-ttu-id="c0eca-178">若要從鬆散類型的 DataTable 存取特定資料行，我們需要使用類似以下的語法：  <strong><em>DataTable</em>。Rows [<em>index</em>] ["<em>columnName</em>"]</strong>。</span><span class="sxs-lookup"><span data-stu-id="c0eca-178">To access a particular column from a loosely-typed DataTable we need to use syntax like: <strong><em>DataTable</em>.Rows[<em>index</em>]["<em>columnName</em>"]</strong>.</span></span> <span data-ttu-id="c0eca-179">在此範例中，DataTable 的鬆散類型是由我們需要使用字串或序數索引來存取資料行名稱的事實所展現。</span><span class="sxs-lookup"><span data-stu-id="c0eca-179">The DataTable's loose typing in this example is exhibited by the fact that we need to access the column name using a string or ordinal index.</span></span> <span data-ttu-id="c0eca-180">另一方面，強型別 DataTable 會將它的每個資料行都實作為屬性，產生如下的程式碼：  <strong><em>DataTable</em>。資料列 [<em>index</em>]。*columnName</strong>* 。</span><span class="sxs-lookup"><span data-stu-id="c0eca-180">A strongly-typed DataTable, on the other hand, will have each of its columns implemented as properties, resulting in code that looks like: <strong><em>DataTable</em>.Rows[<em>index</em>].*columnName</strong>*.</span></span>

<span data-ttu-id="c0eca-181">若要傳回強型別物件，開發人員可以建立自己的自訂商務物件或使用具類型的資料集。</span><span class="sxs-lookup"><span data-stu-id="c0eca-181">To return strongly-typed objects, developers can either create their own custom business objects or use Typed DataSets.</span></span> <span data-ttu-id="c0eca-182">開發人員會將商務物件實作為一個類別，其屬性通常會反映商務物件所代表之基礎資料庫資料表的資料行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-182">A business object is implemented by the developer as a class whose properties typically reflect the columns of the underlying database table the business object represents.</span></span> <span data-ttu-id="c0eca-183">具類型資料集是根據資料庫架構 Visual Studio 產生的類別，而且其成員是根據此架構而強型別。</span><span class="sxs-lookup"><span data-stu-id="c0eca-183">A Typed DataSet is a class generated for you by Visual Studio based on a database schema and whose members are strongly-typed according to this schema.</span></span> <span data-ttu-id="c0eca-184">具類型的資料集本身是由擴充 ADO.NET 資料集、DataTable 和 DataRow 類別的類別所組成。</span><span class="sxs-lookup"><span data-stu-id="c0eca-184">The Typed DataSet itself consists of classes that extend the ADO.NET DataSet, DataTable, and DataRow classes.</span></span> <span data-ttu-id="c0eca-185">除了強型別的 Datatable，型別資料集現在也包含 Tableadapter，也就是具有方法來填入資料集的 Datatable，並將 Datatable 中的修改傳播回資料庫的類別。</span><span class="sxs-lookup"><span data-stu-id="c0eca-185">In addition to strongly-typed DataTables, Typed DataSets now also include TableAdapters, which are classes with methods for populating the DataSet's DataTables and propagating modifications within the DataTables back to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="c0eca-186">如需有關使用具類型資料集與自訂商務物件之優缺點的詳細資訊，請參閱[設計資料層元件和透過層來傳遞資料](https://msdn.microsoft.com/library/ms978496.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c0eca-186">For more information on the advantages and disadvantages of using Typed DataSets versus custom business objects, refer to [Designing Data Tier Components and Passing Data Through Tiers](https://msdn.microsoft.com/library/ms978496.aspx).</span></span>

<span data-ttu-id="c0eca-187">我們會將強型別資料集用於這些教學課程的架構。</span><span class="sxs-lookup"><span data-stu-id="c0eca-187">We'll use strongly-typed DataSets for these tutorials' architecture.</span></span> <span data-ttu-id="c0eca-188">[圖 3] 說明使用具型別資料集之應用程式的不同層之間的工作流程。</span><span class="sxs-lookup"><span data-stu-id="c0eca-188">Figure 3 illustrates the workflow between the different layers of an application that uses Typed DataSets.</span></span>

<span data-ttu-id="c0eca-189">[![所有資料存取程式碼都已歸入 DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-189">[![All Data Access Code is Relegated to the DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span></span>

<span data-ttu-id="c0eca-190">**圖 3**：所有資料存取程式碼都已歸入 DAL （[按一下以觀看完整大小的影像](creating-a-data-access-layer-cs/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-190">**Figure 3**: All Data Access Code is Relegated to the DAL ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image7.png))</span></span>

## <a name="creating-a-typed-dataset-and-table-adapter"></a><span data-ttu-id="c0eca-191">建立具類型的資料集和資料表介面卡</span><span class="sxs-lookup"><span data-stu-id="c0eca-191">Creating a Typed DataSet and Table Adapter</span></span>

<span data-ttu-id="c0eca-192">若要開始建立 DAL，我們一開始會先將具型別資料集加入至專案。</span><span class="sxs-lookup"><span data-stu-id="c0eca-192">To begin creating our DAL, we start by adding a Typed DataSet to our project.</span></span> <span data-ttu-id="c0eca-193">若要完成這項操作，請以滑鼠右鍵按一下 方案總管中的專案節點，然後選擇 加入新專案。</span><span class="sxs-lookup"><span data-stu-id="c0eca-193">To accomplish this, right-click on the project node in the Solution Explorer and choose Add a New Item.</span></span> <span data-ttu-id="c0eca-194">從範本清單中選取 [資料集] 選項，並將它命名為**Northwind. xsd**。</span><span class="sxs-lookup"><span data-stu-id="c0eca-194">Select the DataSet option from the list of templates and name it **Northwind.xsd**.</span></span>

<span data-ttu-id="c0eca-195">[![選擇將新的資料集加入至您的專案](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-195">[![Choose to Add a New DataSet to Your Project](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span></span>

<span data-ttu-id="c0eca-196">**圖 4**：選擇將新的資料集加入至您的專案（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-196">**Figure 4**: Choose to Add a New DataSet to Your Project ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image10.png))</span></span>

<span data-ttu-id="c0eca-197">按一下 [新增] 之後，當系統提示您將資料集新增至**應用程式\_Code**資料夾時，請選擇 [是]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-197">After clicking Add, when prompted to add the DataSet to the **App\_Code** folder, choose Yes.</span></span> <span data-ttu-id="c0eca-198">然後會顯示具類型資料集的設計工具，並啟動 TableAdapter 設定 Wizard，讓您將第一個 TableAdapter 新增至具類型的資料集。</span><span class="sxs-lookup"><span data-stu-id="c0eca-198">The Designer for the Typed DataSet will then be displayed, and the TableAdapter Configuration Wizard will start, allowing you to add your first TableAdapter to the Typed DataSet.</span></span>

<span data-ttu-id="c0eca-199">具類型資料集可做為資料的強型別集合。它是由強型別 DataTable 實例所組成，其中每一個都是由強型別的 DataRow 實例所組成。</span><span class="sxs-lookup"><span data-stu-id="c0eca-199">A Typed DataSet serves as a strongly-typed collection of data; it is composed of strongly-typed DataTable instances, each of which is in turn composed of strongly-typed DataRow instances.</span></span> <span data-ttu-id="c0eca-200">我們會針對每個需要在此教學課程系列中使用的基礎資料庫資料表，建立一個強型別 DataTable。</span><span class="sxs-lookup"><span data-stu-id="c0eca-200">We will create a strongly-typed DataTable for each of the underlying database tables that we need to work with in this tutorials series.</span></span> <span data-ttu-id="c0eca-201">讓我們從建立**Products**資料表的 DataTable 開始。</span><span class="sxs-lookup"><span data-stu-id="c0eca-201">Let's start with creating a DataTable for the **Products** table.</span></span>

<span data-ttu-id="c0eca-202">請記住，強型別 Datatable 不會包含有關如何從其基礎資料庫資料表存取資料的任何資訊。</span><span class="sxs-lookup"><span data-stu-id="c0eca-202">Keep in mind that strongly-typed DataTables do not include any information on how to access data from their underlying database table.</span></span> <span data-ttu-id="c0eca-203">為了抓取資料以填入 DataTable，我們使用 TableAdapter 類別，其作用就像我們的資料存取層。</span><span class="sxs-lookup"><span data-stu-id="c0eca-203">In order to retrieve the data to populate the DataTable, we use a TableAdapter class, which functions as our Data Access Layer.</span></span> <span data-ttu-id="c0eca-204">針對我們的**Products** DataTable，TableAdapter 會包含**GetProducts （）** 、 **GetProductByCategoryID （[*類別*]）** 等方法，我們將從展示層叫用。</span><span class="sxs-lookup"><span data-stu-id="c0eca-204">For our **Products** DataTable, the TableAdapter will contain the methods **GetProducts()**, **GetProductByCategoryID(*categoryID*)**, and so on that we'll invoke from the presentation layer.</span></span> <span data-ttu-id="c0eca-205">DataTable 的角色是用來在層之間傳遞資料的強型別物件。</span><span class="sxs-lookup"><span data-stu-id="c0eca-205">The DataTable's role is to serve as the strongly-typed objects used to pass data between the layers.</span></span>

<span data-ttu-id="c0eca-206">TableAdapter 設定向導一開始會提示您選取要使用的資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0eca-206">The TableAdapter Configuration Wizard begins by prompting you to select which database to work with.</span></span> <span data-ttu-id="c0eca-207">下拉式清單會顯示伺服器總管中的那些資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0eca-207">The drop-down list shows those databases in the Server Explorer.</span></span> <span data-ttu-id="c0eca-208">如果您未將 Northwind 資料庫新增至伺服器總管，此時您可以按一下 [新增連接] 按鈕來執行此動作。</span><span class="sxs-lookup"><span data-stu-id="c0eca-208">If you did not add the Northwind database to the Server Explorer, you can click the New Connection button at this time to do so.</span></span>

<span data-ttu-id="c0eca-209">[![從下拉式清單中選擇 Northwind 資料庫](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-209">[![Choose the Northwind Database from the Drop-Down List](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span></span>

<span data-ttu-id="c0eca-210">**圖 5**：從下拉式清單中選擇 Northwind 資料庫（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image13.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-210">**Figure 5**: Choose the Northwind Database from the Drop-Down List ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image13.png))</span></span>

<span data-ttu-id="c0eca-211">選取資料庫並按一下 [下一步] 之後，系統會詢問您是否要將連接字串儲存在**web.config 檔案**中。</span><span class="sxs-lookup"><span data-stu-id="c0eca-211">After selecting the database and clicking Next, you'll be asked if you want to save the connection string in the **Web.config** file.</span></span> <span data-ttu-id="c0eca-212">藉由儲存連接字串，您將可避免在 TableAdapter 類別中硬式編碼，以在未來連接字串資訊變更時簡化專案。</span><span class="sxs-lookup"><span data-stu-id="c0eca-212">By saving the connection string you'll avoid having it hard coded in the TableAdapter classes, which simplifies things if the connection string information changes in the future.</span></span> <span data-ttu-id="c0eca-213">如果您選擇將連接字串儲存在設定檔中，它會放在 [ **&lt;connectionStrings&gt;** ] 區段中，您可以[選擇性地](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)將它加密以提高安全性，或稍後透過 IIS GUI 管理工具中的 [新 ASP.NET 2.0] 屬性頁進行修改，這對系統管理員更是理想的選擇。</span><span class="sxs-lookup"><span data-stu-id="c0eca-213">If you opt to save the connection string in the configuration file it's placed in the **&lt;connectionStrings&gt;** section, which can be [optionally encrypted](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) for improved security or modified later through the new ASP.NET 2.0 Property Page within the IIS GUI Admin Tool, which is more ideal for administrators.</span></span>

<span data-ttu-id="c0eca-214">[![將連接字串儲存至 web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-214">[![Save the Connection String to Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span></span>

<span data-ttu-id="c0eca-215">**圖 6** **：將連接字串儲存到 web.config** （[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-215">**Figure 6**: Save the Connection String to **Web.config** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image16.png))</span></span>

<span data-ttu-id="c0eca-216">接下來，我們需要定義第一個強型別 DataTable 的架構，並提供在擴展強型別資料集時，用於 TableAdapter 的第一個方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-216">Next, we need to define the schema for the first strongly-typed DataTable and provide the first method for our TableAdapter to use when populating the strongly-typed DataSet.</span></span> <span data-ttu-id="c0eca-217">這兩個步驟的完成方式是建立查詢，以傳回資料表中我們想要反映在 DataTable 中的資料行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-217">These two steps are accomplished simultaneously by creating a query that returns the columns from the table that we want reflected in our DataTable.</span></span> <span data-ttu-id="c0eca-218">在嚮導的結尾，我們會提供方法名稱給此查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-218">At the end of the wizard we'll give a method name to this query.</span></span> <span data-ttu-id="c0eca-219">完成之後，就可以從我們的展示層叫用這個方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-219">Once that's been accomplished, this method can be invoked from our presentation layer.</span></span> <span data-ttu-id="c0eca-220">方法會執行已定義的查詢，並填入強型別的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="c0eca-220">The method will execute the defined query and populate a strongly-typed DataTable.</span></span>

<span data-ttu-id="c0eca-221">若要開始定義 SQL 查詢，我們必須先指出要如何讓 TableAdapter 發出查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-221">To get started defining the SQL query we must first indicate how we want the TableAdapter to issue the query.</span></span> <span data-ttu-id="c0eca-222">我們可以使用特定 SQL 語句、建立新的預存程式，或使用現有的預存程式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-222">We can use an ad-hoc SQL statement, create a new stored procedure, or use an existing stored procedure.</span></span> <span data-ttu-id="c0eca-223">在這些教學課程中，我們將使用特定 SQL 語句。</span><span class="sxs-lookup"><span data-stu-id="c0eca-223">For these tutorials we'll use ad-hoc SQL statements.</span></span> <span data-ttu-id="c0eca-224">如需使用預存程式的範例，請參閱[Brian Noyes](http://briannoyes.net/)的文章，[使用 Visual Studio 2005 DataSet 設計工具建立資料存取層。](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)</span><span class="sxs-lookup"><span data-stu-id="c0eca-224">Refer to [Brian Noyes](http://briannoyes.net/)'s article, [Build a Data Access Layer with the Visual Studio 2005 DataSet Designer](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) for an example of using stored procedures.</span></span>

<span data-ttu-id="c0eca-225">[![使用特定 SQL 語句來查詢資料](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-225">[![Query the Data Using an Ad-Hoc SQL Statement](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span></span>

<span data-ttu-id="c0eca-226">**圖 7**：使用臨機操作 SQL 語句來查詢資料（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image19.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-226">**Figure 7**: Query the Data Using an Ad-Hoc SQL Statement ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image19.png))</span></span>

<span data-ttu-id="c0eca-227">此時，我們可以手動輸入 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-227">At this point we can type in the SQL query by hand.</span></span> <span data-ttu-id="c0eca-228">在 TableAdapter 中建立第一個方法時，您通常會想要讓查詢傳回必須在對應 DataTable 中表示的那些資料行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-228">When creating the first method in the TableAdapter you typically want to have the query return those columns that need to be expressed in the corresponding DataTable.</span></span> <span data-ttu-id="c0eca-229">我們可以藉由建立查詢來傳回**Products**資料表中的所有資料行和所有資料列，來完成這項工作：</span><span class="sxs-lookup"><span data-stu-id="c0eca-229">We can accomplish this by creating a query that returns all columns and all rows from the **Products** table:</span></span>

<span data-ttu-id="c0eca-230">[![在文字方塊中輸入 SQL 查詢](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-230">[![Enter the SQL Query Into the Textbox](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span></span>

<span data-ttu-id="c0eca-231">**圖 8**：在文字方塊中輸入 SQL 查詢（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-231">**Figure 8**: Enter the SQL Query Into the Textbox ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image22.png))</span></span>

<span data-ttu-id="c0eca-232">或者，使用 [查詢產生器] 並以圖形方式建立查詢，如 [圖 9] 所示。</span><span class="sxs-lookup"><span data-stu-id="c0eca-232">Alternatively, use the Query Builder and graphically construct the query, as shown in Figure 9.</span></span>

<span data-ttu-id="c0eca-233">[![透過查詢編輯器以圖形方式建立查詢](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-233">[![Create the Query Graphically, through the Query Editor](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span></span>

<span data-ttu-id="c0eca-234">**圖 9**：透過查詢編輯器以圖形方式建立查詢（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image25.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-234">**Figure 9**: Create the Query Graphically, through the Query Editor ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image25.png))</span></span>

<span data-ttu-id="c0eca-235">建立查詢之後，在移至下一個畫面之前，請按一下 [Advanced Options] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="c0eca-235">After creating the query, but before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="c0eca-236">在網站專案中，預設會選取 [產生 Insert、Update 和 Delete 語句] 唯一的 [advanced] 選項;如果您從類別庫或 Windows 專案執行此嚮導，也會一併選取 [使用開放式平行存取] 選項。</span><span class="sxs-lookup"><span data-stu-id="c0eca-236">In Web Site Projects, "Generate Insert, Update, and Delete statements" is the only advanced option selected by default; if you run this wizard from a Class Library or a Windows Project the "Use optimistic concurrency" option will also be selected.</span></span> <span data-ttu-id="c0eca-237">請暫時不要勾選 [使用開放式平行存取] 選項。</span><span class="sxs-lookup"><span data-stu-id="c0eca-237">Leave the "Use optimistic concurrency" option unchecked for now.</span></span> <span data-ttu-id="c0eca-238">我們將在未來的教學課程中檢查開放式平行存取。</span><span class="sxs-lookup"><span data-stu-id="c0eca-238">We'll examine optimistic concurrency in future tutorials.</span></span>

<span data-ttu-id="c0eca-239">[![只選取 [產生 Insert、Update 和 Delete 語句] 選項](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-239">[![Select Only the Generate Insert, Update, and Delete statements Option](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span></span>

<span data-ttu-id="c0eca-240">**圖 10**：只選取 [產生 Insert]、[Update] 和 [Delete 語句] 選項（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image28.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-240">**Figure 10**: Select Only the Generate Insert, Update, and Delete statements Option ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image28.png))</span></span>

<span data-ttu-id="c0eca-241">驗證 advanced 選項之後，請按 [下一步] 繼續前往最後一個畫面。</span><span class="sxs-lookup"><span data-stu-id="c0eca-241">After verifying the advanced options, click Next to proceed to the final screen.</span></span> <span data-ttu-id="c0eca-242">在這裡，我們會要求您選取要新增至 TableAdapter 的方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-242">Here we are asked to select which methods to add to the TableAdapter.</span></span> <span data-ttu-id="c0eca-243">填入資料的模式有兩種：</span><span class="sxs-lookup"><span data-stu-id="c0eca-243">There are two patterns for populating data:</span></span>

- <span data-ttu-id="c0eca-244">以這種方法**填入 datatable** ：建立的方法會採用 DataTable 做為參數，並根據查詢結果填入它。</span><span class="sxs-lookup"><span data-stu-id="c0eca-244">**Fill a DataTable** with this approach a method is created that takes in a DataTable as a parameter and populates it based on the results of the query.</span></span> <span data-ttu-id="c0eca-245">例如，ADO.NET DataAdapter 類別會使用其**Fill （）** 方法來執行此模式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-245">The ADO.NET DataAdapter class, for example, implements this pattern with its **Fill()** method.</span></span>
- <span data-ttu-id="c0eca-246">傳回具有這個方法的**datatable** 。此方法會為您建立並填滿 datatable，並傳回做為方法傳回值。</span><span class="sxs-lookup"><span data-stu-id="c0eca-246">**Return a DataTable** with this approach the method creates and fills the DataTable for you and returns it as the methods return value.</span></span>

<span data-ttu-id="c0eca-247">您可以讓 TableAdapter 執行其中一種或兩種模式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-247">You can have the TableAdapter implement one or both of these patterns.</span></span> <span data-ttu-id="c0eca-248">您也可以重新命名此處提供的方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-248">You can also rename the methods provided here.</span></span> <span data-ttu-id="c0eca-249">讓我們將這兩個核取方塊保留為已核取，即使在這些教學課程中，我們只會使用第二個模式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-249">Let's leave both checkboxes checked, even though we'll only be using the latter pattern throughout these tutorials.</span></span> <span data-ttu-id="c0eca-250">此外，讓我們將（而不**是一般的**方式）重新命名為**GetProducts**。</span><span class="sxs-lookup"><span data-stu-id="c0eca-250">Also, let's rename the rather generic **GetData** method to **GetProducts**.</span></span>

<span data-ttu-id="c0eca-251">若已核取，則最後一個核取方塊 "GenerateDBDirectMethods" 會建立 TableAdapter 的**Insert （）** 、 **Update （）** 和**Delete （）** 方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-251">If checked, the final checkbox, "GenerateDBDirectMethods," creates **Insert()**, **Update()**, and **Delete()** methods for the TableAdapter.</span></span> <span data-ttu-id="c0eca-252">如果您將此選項保留為未核取，則必須透過 TableAdapter 的唯一**Update （）** 方法來完成所有更新，這會採用具類型的資料集、DataTable、單一 DataRow 或 datarow 的陣列。</span><span class="sxs-lookup"><span data-stu-id="c0eca-252">If you leave this option unchecked, all updates will need to be done through the TableAdapter's sole **Update()** method, which takes in the Typed DataSet, a DataTable, a single DataRow, or an array of DataRows.</span></span> <span data-ttu-id="c0eca-253">（如果您已從 [圖 9] 中的 [advanced] 屬性取消核取 [產生 Insert、Update 和 Delete 語句] 選項，則此核取方塊的設定將不會有任何作用。）讓我們將此核取方塊保留為已選取。</span><span class="sxs-lookup"><span data-stu-id="c0eca-253">(If you've unchecked the "Generate Insert, Update, and Delete statements" option from the advanced properties in Figure 9 this checkbox's setting will have no effect.) Let's leave this checkbox selected.</span></span>

<span data-ttu-id="c0eca-254">[![將方法名稱從 [GetProducts] 變更為 []](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-254">[![Change the Method Name from GetData to GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span></span>

<span data-ttu-id="c0eca-255">**圖 11** **：將方法名稱從 [** 大小] 變更為 [ **GetProducts** ] （[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image31.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-255">**Figure 11**: Change the Method Name from **GetData** to **GetProducts** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image31.png))</span></span>

<span data-ttu-id="c0eca-256">按一下 [完成] 以完成嚮導。</span><span class="sxs-lookup"><span data-stu-id="c0eca-256">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="c0eca-257">在嚮導關閉之後，我們會回到 [DataSet 設計工具]，其中會顯示我們剛才建立的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="c0eca-257">After the wizard closes we are returned to the DataSet Designer which shows the DataTable we just created.</span></span> <span data-ttu-id="c0eca-258">您可以查看**Products** DataTable （**ProductID**、 **ProductName**等等）中的資料行清單，以及**ProductsTableAdapter** （**Fill （）** 和**GetProducts （）** ）的方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-258">You can see the list of columns in the **Products** DataTable (**ProductID**, **ProductName**, and so on), as well as the methods of the **ProductsTableAdapter** (**Fill()** and **GetProducts()**).</span></span>

<span data-ttu-id="c0eca-259">[![Products DataTable 和 ProductsTableAdapter 已加入至具類型的資料集](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-259">[![The Products DataTable and ProductsTableAdapter have been Added to the Typed DataSet](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span></span>

<span data-ttu-id="c0eca-260">**圖 12**： **Products** DataTable 和**ProductsTableAdapter**已加入至具類型的資料集（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image34.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-260">**Figure 12**: The **Products** DataTable and **ProductsTableAdapter** have been Added to the Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image34.png))</span></span>

<span data-ttu-id="c0eca-261">此時，我們有一個具有單一 DataTable （**Northwind. Products**）的具型別資料集，以及一個具有**GetProducts （）** 方法的強型別 DataAdapter 類別（**NorthwindTableAdapters. ProductsTableAdapter**）。</span><span class="sxs-lookup"><span data-stu-id="c0eca-261">At this point we have a Typed DataSet with a single DataTable (**Northwind.Products**) and a strongly-typed DataAdapter class (**NorthwindTableAdapters.ProductsTableAdapter**) with a **GetProducts()** method.</span></span> <span data-ttu-id="c0eca-262">這些物件可以用來從程式碼存取所有產品的清單，例如：</span><span class="sxs-lookup"><span data-stu-id="c0eca-262">These objects can be used to access a list of all products from code like:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample1.html)]

<span data-ttu-id="c0eca-263">這段程式碼不需要我們撰寫一位資料存取特定的程式碼。</span><span class="sxs-lookup"><span data-stu-id="c0eca-263">This code did not require us to write one bit of data access-specific code.</span></span> <span data-ttu-id="c0eca-264">我們不需要具現化任何 ADO.NET 類別，我們不需要參考任何連接字串、SQL 查詢或預存程式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-264">We did not have to instantiate any ADO.NET classes, we didn't have to refer to any connection strings, SQL queries, or stored procedures.</span></span> <span data-ttu-id="c0eca-265">相反地，TableAdapter 會為我們提供低層級的資料存取程式碼。</span><span class="sxs-lookup"><span data-stu-id="c0eca-265">Instead, the TableAdapter provides the low-level data access code for us.</span></span>

<span data-ttu-id="c0eca-266">這個範例中使用的每個物件也都是強型別，可讓 Visual Studio 提供 IntelliSense 和編譯時間型別檢查。</span><span class="sxs-lookup"><span data-stu-id="c0eca-266">Each object used in this example is also strongly-typed, allowing Visual Studio to provide IntelliSense and compile-time type checking.</span></span> <span data-ttu-id="c0eca-267">而且所有由 TableAdapter 傳回的 Datatable，都可以系結至 ASP.NET 資料 Web 控制項，例如 GridView、DetailsView、DropDownList、CheckBoxList 和其他幾個。</span><span class="sxs-lookup"><span data-stu-id="c0eca-267">And best of all the DataTables returned by the TableAdapter can be bound to ASP.NET data Web controls, such as the GridView, DetailsView, DropDownList, CheckBoxList, and several others.</span></span> <span data-ttu-id="c0eca-268">下列範例說明如何將**GetProducts （）** 方法傳回的 DataTable 系結至 GridView，只要缺乏說明致頁面內的三行程式碼 **\_載入**事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-268">The following example illustrates binding the DataTable returned by the **GetProducts()** method to a GridView in just a scant three lines of code within the **Page\_Load** event handler.</span></span>

<span data-ttu-id="c0eca-269">AllProducts .aspx</span><span class="sxs-lookup"><span data-stu-id="c0eca-269">AllProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample2.aspx)]

<span data-ttu-id="c0eca-270">AllProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="c0eca-270">AllProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample3.cs)]

<span data-ttu-id="c0eca-271">[![顯示在 GridView 中的產品清單](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-271">[![The List of Products is Displayed in a GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span></span>

<span data-ttu-id="c0eca-272">**圖 13**：產品清單會顯示在 GridView 中（[按一下以觀看完整大小的影像](creating-a-data-access-layer-cs/_static/image37.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-272">**Figure 13**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image37.png))</span></span>

<span data-ttu-id="c0eca-273">雖然此範例需要在 ASP.NET 網頁的頁面中撰寫三行程式碼 **\_載入**事件處理常式，但在未來的教學課程中，我們將探討如何使用 ObjectDataSource，以宣告的方式從 DAL 取得資料。</span><span class="sxs-lookup"><span data-stu-id="c0eca-273">While this example required that we write three lines of code in our ASP.NET page's **Page\_Load** event handler, in future tutorials we'll examine how to use the ObjectDataSource to declaratively retrieve the data from the DAL.</span></span> <span data-ttu-id="c0eca-274">有了 ObjectDataSource，我們就不需要撰寫任何程式碼，而且也會取得分頁和排序支援！</span><span class="sxs-lookup"><span data-stu-id="c0eca-274">With the ObjectDataSource we'll not have to write any code and will get paging and sorting support as well!</span></span>

## <a name="step-3-adding-parameterized-methods-to-the-data-access-layer"></a><span data-ttu-id="c0eca-275">步驟3：將參數化方法加入至資料存取層</span><span class="sxs-lookup"><span data-stu-id="c0eca-275">Step 3: Adding Parameterized Methods to the Data Access Layer</span></span>

<span data-ttu-id="c0eca-276">此時，我們的**ProductsTableAdapter**類別有一個方法**GetProducts （）** ，它會傳回資料庫中的所有產品。</span><span class="sxs-lookup"><span data-stu-id="c0eca-276">At this point our **ProductsTableAdapter** class has but one method, **GetProducts()**, which returns all of the products in the database.</span></span> <span data-ttu-id="c0eca-277">雖然能夠使用所有產品都非常有用，但有時候我們會想要取得特定產品的相關資訊，或屬於特定類別的所有產品。</span><span class="sxs-lookup"><span data-stu-id="c0eca-277">While being able to work with all products is definitely useful, there are times when we'll want to retrieve information about a specific product, or all products that belong to a particular category.</span></span> <span data-ttu-id="c0eca-278">若要在資料存取層中加入這類功能，我們可以將參數化方法加入至 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="c0eca-278">To add such functionality to our Data Access Layer we can add parameterized methods to the TableAdapter.</span></span>

<span data-ttu-id="c0eca-279">讓我們新增**GetProductsByCategoryID （*類別*的）** 方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-279">Let's add the **GetProductsByCategoryID(*categoryID*)** method.</span></span> <span data-ttu-id="c0eca-280">若要將新的方法加入 DAL，請回到 DataSet 設計工具，以滑鼠右鍵按一下 [ **ProductsTableAdapter** ] 區段，然後選擇 [加入查詢]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-280">To add a new method to the DAL, return to the DataSet Designer, right-click in the **ProductsTableAdapter** section, and choose Add Query.</span></span>

![以滑鼠右鍵按一下 TableAdapter，然後選擇 [加入查詢]](creating-a-data-access-layer-cs/_static/image38.png)

<span data-ttu-id="c0eca-282">**圖 14**：以滑鼠右鍵按一下 TableAdapter，然後選擇 [加入查詢]</span><span class="sxs-lookup"><span data-stu-id="c0eca-282">**Figure 14**: Right-Click on the TableAdapter and Choose Add Query</span></span>

<span data-ttu-id="c0eca-283">我們會先提示我們是否要使用特定 SQL 語句或新的或現有的預存程式來存取資料庫。</span><span class="sxs-lookup"><span data-stu-id="c0eca-283">We are first prompted about whether we want to access the database using an ad-hoc SQL statement or a new or existing stored procedure.</span></span> <span data-ttu-id="c0eca-284">讓我們選擇再次使用特定 SQL 語句。</span><span class="sxs-lookup"><span data-stu-id="c0eca-284">Let's choose to use an ad-hoc SQL statement again.</span></span> <span data-ttu-id="c0eca-285">接下來，我們會詢問您想要使用哪種類型的 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-285">Next, we are asked what type of SQL query we'd like to use.</span></span> <span data-ttu-id="c0eca-286">因為我們想要傳回屬於指定類別的所有產品，所以我們想要撰寫會傳回資料列的**SELECT**語句。</span><span class="sxs-lookup"><span data-stu-id="c0eca-286">Since we want to return all products that belong to a specified category, we want to write a **SELECT** statement which returns rows.</span></span>

<span data-ttu-id="c0eca-287">[![選擇建立會傳回資料列的 SELECT 語句](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-287">[![Choose to Create a SELECT Statement Which Returns Rows](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span></span>

<span data-ttu-id="c0eca-288">**圖 15**：選擇建立會傳回資料列的**SELECT**語句（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image41.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-288">**Figure 15**: Choose to Create a **SELECT** Statement Which Returns Rows ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image41.png))</span></span>

<span data-ttu-id="c0eca-289">下一個步驟是定義用來存取資料的 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-289">The next step is to define the SQL query used to access the data.</span></span> <span data-ttu-id="c0eca-290">因為我們想要只傳回屬於特定分類的產品，所以我從<strong>GetProducts （）</strong>使用相同的<strong>SELECT</strong>語句，但新增下列<strong>where</strong>子句： <strong>where 類別目錄 = @CategoryID</strong>。</span><span class="sxs-lookup"><span data-stu-id="c0eca-290">Since we want to return only those products that belong to a particular category, I use the same <strong>SELECT</strong> statement from <strong>GetProducts()</strong>, but add the following <strong>WHERE</strong> clause: <strong>WHERE CategoryID = @CategoryID</strong>.</span></span> <span data-ttu-id="c0eca-291"><strong>@CategoryID</strong>參數會向 TableAdapter wizard 指示，我們所建立的方法將需要對應類型的輸入參數（也就是可為 null 的整數）。</span><span class="sxs-lookup"><span data-stu-id="c0eca-291">The <strong>@CategoryID</strong> parameter indicates to the TableAdapter wizard that the method we're creating will require an input parameter of the corresponding type (namely, a nullable integer).</span></span>

<span data-ttu-id="c0eca-292">[![輸入查詢，只傳回指定分類中的產品](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-292">[![Enter a Query to Only Return Products in a Specified Category](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span></span>

<span data-ttu-id="c0eca-293">**圖 16**：輸入只傳回指定分類中之產品的查詢（[按一下以觀看完整大小的影像](creating-a-data-access-layer-cs/_static/image44.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-293">**Figure 16**: Enter a Query to Only Return Products in a Specified Category ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image44.png))</span></span>

<span data-ttu-id="c0eca-294">在最後一個步驟中，我們可以選擇要使用的資料存取模式，以及自訂所產生之方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="c0eca-294">In the final step we can choose which data access patterns to use, as well as customize the names of the methods generated.</span></span> <span data-ttu-id="c0eca-295">在填滿模式中，讓我們將名稱變更為<strong>FillByCategoryID</strong> ，並針對傳回 DataTable 傳回模式（ <strong>Get*X</strong>* 方法），讓我們使用<strong>GetProductsByCategoryID</strong>。</span><span class="sxs-lookup"><span data-stu-id="c0eca-295">For the Fill pattern, let's change the name to <strong>FillByCategoryID</strong> and for the return a DataTable return pattern (the <strong>Get*X</strong>* methods), let's use <strong>GetProductsByCategoryID</strong>.</span></span>

<span data-ttu-id="c0eca-296">[![選擇 TableAdapter 方法的名稱](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-296">[![Choose the Names for the TableAdapter Methods](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span></span>

<span data-ttu-id="c0eca-297">**圖 17**：選擇 TableAdapter 方法的名稱（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image47.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-297">**Figure 17**: Choose the Names for the TableAdapter Methods ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image47.png))</span></span>

<span data-ttu-id="c0eca-298">完成 wizard 之後，[DataSet 設計工具] 會包含新的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-298">After completing the wizard, the DataSet Designer includes the new TableAdapter methods.</span></span>

![產品現在可以依類別進行查詢](creating-a-data-access-layer-cs/_static/image48.png)

<span data-ttu-id="c0eca-300">**圖 18**：產品現在可以依類別進行查詢</span><span class="sxs-lookup"><span data-stu-id="c0eca-300">**Figure 18**: The Products Can Now be Queried by Category</span></span>

<span data-ttu-id="c0eca-301">請花點時間使用相同的技巧來新增**GetProductByProductID （*productID*）** 方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-301">Take a moment to add a **GetProductByProductID(*productID*)** method using the same technique.</span></span>

<span data-ttu-id="c0eca-302">這些參數化查詢可以直接從 DataSet 設計工具進行測試。</span><span class="sxs-lookup"><span data-stu-id="c0eca-302">These parameterized queries can be tested directly from the DataSet Designer.</span></span> <span data-ttu-id="c0eca-303">以滑鼠右鍵按一下 TableAdapter 中的方法，然後選擇 [預覽資料]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-303">Right-click on the method in the TableAdapter and choose Preview Data.</span></span> <span data-ttu-id="c0eca-304">接下來，輸入要用於參數的值，然後按一下 [預覽]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-304">Next, enter the values to use for the parameters and click Preview.</span></span>

<span data-ttu-id="c0eca-305">[會顯示屬於飲料類別的產品 ![](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-305">[![Those Products Belonging to the Beverages Category are Shown](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span></span>

<span data-ttu-id="c0eca-306">**圖 19**：顯示屬於飲料類別的產品（[按一下以觀看完整大小的影像](creating-a-data-access-layer-cs/_static/image51.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-306">**Figure 19**: Those Products Belonging to the Beverages Category are Shown ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image51.png))</span></span>

<span data-ttu-id="c0eca-307">透過我們 DAL 中的**GetProductsByCategoryID （*類別*目錄）** 方法，我們現在可以建立 ASP.NET 網頁，只顯示指定類別中的產品。</span><span class="sxs-lookup"><span data-stu-id="c0eca-307">With the **GetProductsByCategoryID(*categoryID*)** method in our DAL, we can now create an ASP.NET page that displays only those products in a specified category.</span></span> <span data-ttu-id="c0eca-308">下列範例會顯示 [飲料] 分類中的所有產品，其中的 [**類別**目錄] 為1。</span><span class="sxs-lookup"><span data-stu-id="c0eca-308">The following example shows all products that are in the Beverages category, which have a **CategoryID** of 1.</span></span>

<span data-ttu-id="c0eca-309">飲料 asp</span><span class="sxs-lookup"><span data-stu-id="c0eca-309">Beverages.asp</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample4.aspx)]

<span data-ttu-id="c0eca-310">Beverages.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="c0eca-310">Beverages.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample5.cs)]

<span data-ttu-id="c0eca-311">[會顯示 [飲料] 類別中的產品 ![](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-311">[![Those Products in the Beverages Category are Displayed](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span></span>

<span data-ttu-id="c0eca-312">**圖 20**：顯示飲料類別中的產品（[按一下以觀看完整大小的影像](creating-a-data-access-layer-cs/_static/image54.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-312">**Figure 20**: Those Products in the Beverages Category are Displayed ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image54.png))</span></span>

## <a name="step-4-inserting-updating-and-deleting-data"></a><span data-ttu-id="c0eca-313">步驟4：插入、更新和刪除資料</span><span class="sxs-lookup"><span data-stu-id="c0eca-313">Step 4: Inserting, Updating, and Deleting Data</span></span>

<span data-ttu-id="c0eca-314">有兩種模式通常用於插入、更新和刪除資料。</span><span class="sxs-lookup"><span data-stu-id="c0eca-314">There are two patterns commonly used for inserting, updating, and deleting data.</span></span> <span data-ttu-id="c0eca-315">第一個要呼叫資料庫直接模式的模式，牽涉到建立方法，在叫用時，對在單一資料庫記錄上運作的資料庫發出**INSERT**、 **UPDATE**或**DELETE**命令。</span><span class="sxs-lookup"><span data-stu-id="c0eca-315">The first pattern, which I'll call the database direct pattern, involves creating methods that, when invoked, issue an **INSERT**, **UPDATE**, or **DELETE** command to the database that operates on a single database record.</span></span> <span data-ttu-id="c0eca-316">這類方法通常會以一系列的純量值（整數、字串、布林值、日期時間等等）來傳遞，並對應至要插入、更新或刪除的值。</span><span class="sxs-lookup"><span data-stu-id="c0eca-316">Such methods are typically passed in a series of scalar values (integers, strings, Booleans, DateTimes, and so on) that correspond to the values to insert, update, or delete.</span></span> <span data-ttu-id="c0eca-317">例如，針對**Products**資料表，delete 方法會採用整數參數，表示要刪除之記錄的**ProductID** ，而 Insert 方法會接受**ProductName**的字串，而**單價**的十進位、 **UnitsOnStock**的整數等，則為，依此類推。</span><span class="sxs-lookup"><span data-stu-id="c0eca-317">For example, with this pattern for the **Products** table the delete method would take in an integer parameter, indicating the **ProductID** of the record to delete, while the insert method would take in a string for the **ProductName**, a decimal for the **UnitPrice**, an integer for the **UnitsOnStock**, and so on.</span></span>

<span data-ttu-id="c0eca-318">[![每個插入、更新和刪除要求都會立即傳送至資料庫](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-318">[![Each Insert, Update, and Delete Request is Sent to the Database Immediately](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span></span>

<span data-ttu-id="c0eca-319">**圖 21**：每個插入、更新和刪除要求都會立即傳送至資料庫（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image57.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-319">**Figure 21**: Each Insert, Update, and Delete Request is Sent to the Database Immediately ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image57.png))</span></span>

<span data-ttu-id="c0eca-320">另一個稱為「批次更新」模式的模式，就是在一個方法呼叫中更新整個資料集、DataTable 或 Datarow 的集合。</span><span class="sxs-lookup"><span data-stu-id="c0eca-320">The other pattern, which I'll refer to as the batch update pattern, is to update an entire DataSet, DataTable, or collection of DataRows in one method call.</span></span> <span data-ttu-id="c0eca-321">使用此模式時，開發人員會刪除、插入及修改 DataTable 中的 Datarow，然後將這些 Datarow 或 DataTable 傳遞至更新方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-321">With this pattern a developer deletes, inserts, and modifies the DataRows in a DataTable and then passes those DataRows or DataTable into an update method.</span></span> <span data-ttu-id="c0eca-322">然後，這個方法會列舉傳入的 Datarow，判斷它們是否已修改、加入或刪除（透過 DataRow 的[RowState 屬性](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx)值），並針對每一筆記錄發出適當的資料庫要求。</span><span class="sxs-lookup"><span data-stu-id="c0eca-322">This method then enumerates the DataRows passed in, determines whether or not they've been modified, added, or deleted (via the DataRow's [RowState property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) value), and issues the appropriate database request for each record.</span></span>

<span data-ttu-id="c0eca-323">[當叫用 Update 方法時，![所有變更都會與資料庫同步處理](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-323">[![All Changes are Synchronized with the Database When the Update Method is Invoked](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span></span>

<span data-ttu-id="c0eca-324">**圖 22**：叫用 Update 方法時，所有的變更都會與資料庫同步處理（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image60.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-324">**Figure 22**: All Changes are Synchronized with the Database When the Update Method is Invoked ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image60.png))</span></span>

<span data-ttu-id="c0eca-325">根據預設，TableAdapter 會使用批次更新模式，但也支援 DB 直接模式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-325">The TableAdapter uses the batch update pattern by default, but also supports the DB direct pattern.</span></span> <span data-ttu-id="c0eca-326">因為我們在建立 TableAdapter 時，從 [Advanced] 屬性選取 [產生 Insert、Update 和 Delete 語句] 選項，所以**ProductsTableAdapter**包含一個**Update （）** 方法，它會執行批次更新模式。</span><span class="sxs-lookup"><span data-stu-id="c0eca-326">Since we selected the "Generate Insert, Update, and Delete statements" option from the Advanced Properties when creating our TableAdapter, the **ProductsTableAdapter** contains an **Update()** method, which implements the batch update pattern.</span></span> <span data-ttu-id="c0eca-327">具體而言，TableAdapter 包含**Update （）** 方法，可以傳遞具類型的資料集、強型別的 DataTable 或一或多個 datarow。</span><span class="sxs-lookup"><span data-stu-id="c0eca-327">Specifically, the TableAdapter contains an **Update()** method that can be passed the Typed DataSet, a strongly-typed DataTable, or one or more DataRows.</span></span> <span data-ttu-id="c0eca-328">如果您在第一次建立 TableAdapter 時已核取 [GenerateDBDirectMethods] 核取方塊，則 DB 直接模式也會透過**Insert （）** 、 **Update （）** 和**Delete （）** 方法來執行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-328">If you left the "GenerateDBDirectMethods" checkbox checked when first creating the TableAdapter the DB direct pattern will also be implemented via **Insert()**, **Update()**, and **Delete()** methods.</span></span>

<span data-ttu-id="c0eca-329">這兩種資料修改模式都會使用 TableAdapter 的**InsertCommand**、 **UpdateCommand**和**DeleteCommand**屬性，對資料庫發出**INSERT**、 **UPDATE**和**DELETE**命令。</span><span class="sxs-lookup"><span data-stu-id="c0eca-329">Both data modification patterns use the TableAdapter's **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties to issue their **INSERT**, **UPDATE**, and **DELETE** commands to the database.</span></span> <span data-ttu-id="c0eca-330">您可以藉由按一下 DataSet 設計工具中的 TableAdapter，然後前往 [屬性視窗]，來檢查和修改**InsertCommand**、 **UpdateCommand**和**DeleteCommand**屬性。</span><span class="sxs-lookup"><span data-stu-id="c0eca-330">You can inspect and modify the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties by clicking on the TableAdapter in the DataSet Designer and then going to the Properties window.</span></span> <span data-ttu-id="c0eca-331">（請確定您已選取 TableAdapter，而且**ProductsTableAdapter**物件是在 [屬性視窗] 的下拉式清單中選取的）。</span><span class="sxs-lookup"><span data-stu-id="c0eca-331">(Make sure you have selected the TableAdapter, and that the **ProductsTableAdapter** object is the one selected in the drop-down list in the Properties window.)</span></span>

<span data-ttu-id="c0eca-332">[![TableAdapter 具有 InsertCommand、UpdateCommand 和 DeleteCommand 屬性](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-332">[![The TableAdapter has InsertCommand, UpdateCommand, and DeleteCommand Properties](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span></span>

<span data-ttu-id="c0eca-333">**圖 23**： TableAdapter 具有**InsertCommand**、 **UpdateCommand**和**DeleteCommand**屬性（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image63.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-333">**Figure 23**: The TableAdapter has **InsertCommand**, **UpdateCommand**, and **DeleteCommand** Properties ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image63.png))</span></span>

<span data-ttu-id="c0eca-334">若要檢查或修改任何資料庫命令屬性，請按一下 [ **CommandText** ] 子屬性，這會顯示 [查詢產生器]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-334">To examine or modify any of these database command properties, click on the **CommandText** subproperty, which will bring up the Query Builder.</span></span>

<span data-ttu-id="c0eca-335">[![在查詢產生器中設定 INSERT、UPDATE 和 DELETE 子句](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-335">[![Configure the INSERT, UPDATE, and DELETE Statements in the Query Builder](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span></span>

<span data-ttu-id="c0eca-336">**圖 24**：在查詢產生器中設定**INSERT**、 **UPDATE**和**DELETE**語句（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image66.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-336">**Figure 24**: Configure the **INSERT**, **UPDATE**, and **DELETE** Statements in the Query Builder ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image66.png))</span></span>

<span data-ttu-id="c0eca-337">下列程式碼範例示範如何使用批次更新模式，將所有未中止且具有25個單位或更少的產品的價格加倍：</span><span class="sxs-lookup"><span data-stu-id="c0eca-337">The following code example shows how to use the batch update pattern to double the price of all products that are not discontinued and that have 25 units in stock or less:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample6.cs)]

<span data-ttu-id="c0eca-338">下列程式碼說明如何使用 DB direct 模式，以程式設計方式刪除特定產品，然後更新一個，然後再新增一個：</span><span class="sxs-lookup"><span data-stu-id="c0eca-338">The code below illustrates how to use the DB direct pattern to programmatically delete a particular product, then update one, and then add a new one:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample7.cs)]

## <a name="creating-custom-insert-update-and-delete-methods"></a><span data-ttu-id="c0eca-339">建立自訂插入、更新和刪除方法</span><span class="sxs-lookup"><span data-stu-id="c0eca-339">Creating Custom Insert, Update, and Delete Methods</span></span>

<span data-ttu-id="c0eca-340">DB 直接方法所建立的**Insert （）** 、 **Update （）** 和**Delete （）** 方法可能有點麻煩，特別是針對具有許多資料行的資料表。</span><span class="sxs-lookup"><span data-stu-id="c0eca-340">The **Insert()**, **Update()**, and **Delete()** methods created by the DB direct method can be a bit cumbersome, especially for tables with many columns.</span></span> <span data-ttu-id="c0eca-341">查看先前的程式碼範例時，如果沒有 IntelliSense 的協助，就不會特別清楚哪些**Products**資料表資料行對應至**Update （）** 和**Insert （）** 方法的每個輸入參數。</span><span class="sxs-lookup"><span data-stu-id="c0eca-341">Looking at the previous code example, without IntelliSense's help it's not particularly clear what **Products** table column maps to each input parameter to the **Update()** and **Insert()** methods.</span></span> <span data-ttu-id="c0eca-342">有時候，我們只想要更新單一資料行或兩個，或想要自訂的**Insert （）** 方法，這可能會傳回新插入之記錄的**識別**（自動遞增）欄位的值。</span><span class="sxs-lookup"><span data-stu-id="c0eca-342">There may be times when we only want to update a single column or two, or want a customized **Insert()** method that will, perhaps, return the value of the newly inserted record's **IDENTITY** (auto-increment) field.</span></span>

<span data-ttu-id="c0eca-343">若要建立這類自訂方法，請回到 DataSet 設計工具。</span><span class="sxs-lookup"><span data-stu-id="c0eca-343">To create such a custom method, return to the DataSet Designer.</span></span> <span data-ttu-id="c0eca-344">以滑鼠右鍵按一下 TableAdapter，然後選擇 [加入查詢]，返回 [TableAdapter wizard]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-344">Right-click on the TableAdapter and choose Add Query, returning to the TableAdapter wizard.</span></span> <span data-ttu-id="c0eca-345">在第二個畫面上，我們可以指定要建立的查詢類型。</span><span class="sxs-lookup"><span data-stu-id="c0eca-345">On the second screen we can indicate the type of query to create.</span></span> <span data-ttu-id="c0eca-346">讓我們建立一個方法，它會加入新的產品，然後傳回新加入之記錄**ProductID**的值。</span><span class="sxs-lookup"><span data-stu-id="c0eca-346">Let's create a method that adds a new product and then returns the value of the newly added record's **ProductID**.</span></span> <span data-ttu-id="c0eca-347">因此，選擇建立**INSERT**查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-347">Therefore, opt to create an **INSERT** query.</span></span>

<span data-ttu-id="c0eca-348">[![建立方法，以將新的資料列加入 Products 資料表](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-348">[![Create a Method to Add a New Row to the Products Table](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span></span>

<span data-ttu-id="c0eca-349">**圖 25**：建立方法以將新的資料列加入**Products**資料表（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image69.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-349">**Figure 25**: Create a Method to Add a New Row to the **Products** Table ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image69.png))</span></span>

<span data-ttu-id="c0eca-350">在下一個畫面上， **InsertCommand**的**CommandText**隨即出現。</span><span class="sxs-lookup"><span data-stu-id="c0eca-350">On the next screen the **InsertCommand**'s **CommandText** appears.</span></span> <span data-ttu-id="c0eca-351">藉由在查詢結尾加入**選取範圍\_IDENTITY （）** 來擴大此查詢，這會傳回在相同範圍內的**標識**列中所插入的最後一個識別值。</span><span class="sxs-lookup"><span data-stu-id="c0eca-351">Augment this query by adding **SELECT SCOPE\_IDENTITY()** at the end of the query, which will return the last identity value inserted into an **IDENTITY** column in the same scope.</span></span> <span data-ttu-id="c0eca-352">（如需有關**範圍\_身分識別**的詳細資訊，請參閱[技術檔](https://msdn.microsoft.com/library/ms190315.aspx)（），以及您可能想要[使用範圍\_身分識別（）代替 @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx)的原因。）請確定您在加入**SELECT**語句之前，以分號結束**INSERT**語句。</span><span class="sxs-lookup"><span data-stu-id="c0eca-352">(See the [technical documentation](https://msdn.microsoft.com/library/ms190315.aspx) for more information about **SCOPE\_IDENTITY()** and why you probably want to [use SCOPE\_IDENTITY() in lieu of @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Make sure that you end the **INSERT** statement with a semi-colon before adding the **SELECT** statement.</span></span>

<span data-ttu-id="c0eca-353">[![擴大查詢，以傳回 SCOPE_IDENTITY （）值](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-353">[![Augment the Query to Return the SCOPE_IDENTITY() Value](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span></span>

<span data-ttu-id="c0eca-354">**圖 26**：擴大查詢，以傳回 **\_IDENTITY （）** 值的範圍（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image72.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-354">**Figure 26**: Augment the Query to Return the **SCOPE\_IDENTITY()** Value ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image72.png))</span></span>

<span data-ttu-id="c0eca-355">最後，將新方法命名為**InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="c0eca-355">Finally, name the new method **InsertProduct**.</span></span>

<span data-ttu-id="c0eca-356">[![將新的方法名稱設定為 InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-356">[![Set the New Method Name to InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span></span>

<span data-ttu-id="c0eca-357">**圖 27**：將新的方法名稱設定為**InsertProduct** （[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image75.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-357">**Figure 27**: Set the New Method Name to **InsertProduct** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image75.png))</span></span>

<span data-ttu-id="c0eca-358">當您返回 DataSet 設計工具時，您會看到**ProductsTableAdapter**包含新的方法**InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="c0eca-358">When you return to the DataSet Designer you'll see that the **ProductsTableAdapter** contains a new method, **InsertProduct**.</span></span> <span data-ttu-id="c0eca-359">如果這個新方法沒有**Products**資料表中每個資料行的參數，您可能會忘記使用分號來終止**INSERT**語句。</span><span class="sxs-lookup"><span data-stu-id="c0eca-359">If this new method doesn't have a parameter for each column in the **Products** table, chances are you forgot to terminate the **INSERT** statement with a semi-colon.</span></span> <span data-ttu-id="c0eca-360">設定**InsertProduct**方法，並確定您有分號分隔**INSERT**和**SELECT**語句。</span><span class="sxs-lookup"><span data-stu-id="c0eca-360">Configure the **InsertProduct** method and ensure you have a semi-colon delimiting the **INSERT** and **SELECT** statements.</span></span>

<span data-ttu-id="c0eca-361">根據預設，insert 方法會發出非查詢方法，這表示它們會傳回受影響的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="c0eca-361">By default, insert methods issue non-query methods, meaning that they return the number of affected rows.</span></span> <span data-ttu-id="c0eca-362">不過，我們希望**InsertProduct**方法傳回查詢所傳回的值，而不是受影響的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="c0eca-362">However, we want the **InsertProduct** method to return the value returned by the query, not the number of rows affected.</span></span> <span data-ttu-id="c0eca-363">若要完成此動作，請將**InsertProduct**方法的**ExecuteMode**屬性調整為純**量。**</span><span class="sxs-lookup"><span data-stu-id="c0eca-363">To accomplish this, adjust the **InsertProduct** method's **ExecuteMode** property to **Scalar**.</span></span>

<span data-ttu-id="c0eca-364">[![將 ExecuteMode 屬性變更為純量](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-364">[![Change the ExecuteMode Property to Scalar](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span></span>

<span data-ttu-id="c0eca-365">**圖 28**：將 [ **ExecuteMode** ] 屬性**變更為 [** 純量] （[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image78.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-365">**Figure 28**: Change the **ExecuteMode** Property to **Scalar** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image78.png))</span></span>

<span data-ttu-id="c0eca-366">下列程式碼顯示此新的**InsertProduct**方法運作方式：</span><span class="sxs-lookup"><span data-stu-id="c0eca-366">The following code shows this new **InsertProduct** method in action:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample8.cs)]

## <a name="step-5-completing-the-data-access-layer"></a><span data-ttu-id="c0eca-367">步驟5：完成資料存取層</span><span class="sxs-lookup"><span data-stu-id="c0eca-367">Step 5: Completing the Data Access Layer</span></span>

<span data-ttu-id="c0eca-368">請注意， **ProductsTableAdapters**類別會從**Products**資料表傳回 [類別**名稱** **] 和 [** 已供貨**商**] 值，但不包含 [category] 資料表**中的 [類別目錄]** 資料行或 [**供應商**] 資料表中的 [**公司名稱**] 資料行，雖然這些可能是在顯示產品資訊時要顯示的資料行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-368">Note that the **ProductsTableAdapters** class returns the **CategoryID** and **SupplierID** values from the **Products** table, but doesn't include the **CategoryName** column from the **Categories** table or the **CompanyName** column from the **Suppliers** table, although these are likely the columns we want to display when showing product information.</span></span> <span data-ttu-id="c0eca-369">我們可以擴充 TableAdapter 的初始方法**GetProducts （）** ，以同時包含 [**類別名稱**] 和 [**公司名稱**] 資料行值，這會更新強型別 DataTable，以包含這些新資料行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-369">We can augment the TableAdapter's initial method, **GetProducts()**, to include both the **CategoryName** and **CompanyName** column values, which will update the strongly-typed DataTable to include these new columns as well.</span></span>

<span data-ttu-id="c0eca-370">不過，這可能會發生問題，因為 TableAdapter 用來插入、更新和刪除資料的方法是以這個初始方法為基礎。</span><span class="sxs-lookup"><span data-stu-id="c0eca-370">This can present a problem, however, as the TableAdapter's methods for inserting, updating, and deleting data are based off of this initial method.</span></span> <span data-ttu-id="c0eca-371">幸好，自動產生的插入、更新和刪除方法不會受到**SELECT**子句中的子查詢影響。</span><span class="sxs-lookup"><span data-stu-id="c0eca-371">Fortunately, the auto-generated methods for inserting, updating, and deleting are not affected by subqueries in the **SELECT** clause.</span></span> <span data-ttu-id="c0eca-372">藉由將查詢加入**分類**和**供應商**做為子查詢，而不是**聯結**，我們不需要重新撰寫修改資料的方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-372">By taking care to add our queries to **Categories** and **Suppliers** as subqueries, rather than **JOIN** s, we'll avoid having to rework those methods for modifying data.</span></span> <span data-ttu-id="c0eca-373">以滑鼠右鍵按一下**ProductsTableAdapter**中的**GetProducts （）** 方法，然後選擇 [設定]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-373">Right-click on the **GetProducts()** method in the **ProductsTableAdapter** and choose Configure.</span></span> <span data-ttu-id="c0eca-374">然後，調整**SELECT**子句，使其看起來像這樣：</span><span class="sxs-lookup"><span data-stu-id="c0eca-374">Then, adjust the **SELECT** clause so that it looks like:</span></span>

[!code-sql[Main](creating-a-data-access-layer-cs/samples/sample9.sql)]

<span data-ttu-id="c0eca-375">[![更新 GetProducts （）方法的 SELECT 語句](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-375">[![Update the SELECT Statement for the GetProducts() Method](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span></span>

<span data-ttu-id="c0eca-376">**圖 29**：更新**GetProducts （）** 方法的**SELECT**語句（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image81.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-376">**Figure 29**: Update the **SELECT** Statement for the **GetProducts()** Method ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image81.png))</span></span>

<span data-ttu-id="c0eca-377">更新**GetProducts （）** 方法以使用這個新查詢之後，DataTable 會包含兩個新的資料行： [**類別名稱**] 和 [**供應商**]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-377">After updating the **GetProducts()** method to use this new query the DataTable will include two new columns: **CategoryName** and **SupplierName**.</span></span>

![Products DataTable 有兩個新的資料行](creating-a-data-access-layer-cs/_static/image82.png)

<span data-ttu-id="c0eca-379">**圖 30**： **Products** DataTable 有兩個新的資料行</span><span class="sxs-lookup"><span data-stu-id="c0eca-379">**Figure 30**: The **Products** DataTable has Two New Columns</span></span>

<span data-ttu-id="c0eca-380">也請花點時間更新**GetProductsByCategoryID （*類別 id*）** 方法中的**SELECT**子句。</span><span class="sxs-lookup"><span data-stu-id="c0eca-380">Take a moment to update the **SELECT** clause in the **GetProductsByCategoryID(*categoryID*)** method as well.</span></span>

<span data-ttu-id="c0eca-381">如果您更新**GetProducts （）** ，**請選取**[使用**聯結**語法]，DataSet 設計工具將無法自動產生方法，以使用 DB direct 模式來插入、更新和刪除資料庫資料。</span><span class="sxs-lookup"><span data-stu-id="c0eca-381">If you update the **GetProducts()** **SELECT** using **JOIN** syntax the DataSet Designer won't be able to auto-generate the methods for inserting, updating, and deleting database data using the DB direct pattern.</span></span> <span data-ttu-id="c0eca-382">相反地，您必須手動建立它們，就像我們稍早在本教學課程中使用**InsertProduct**方法所做的一樣。</span><span class="sxs-lookup"><span data-stu-id="c0eca-382">Instead, you'll have to manually create them much like we did with the **InsertProduct** method earlier in this tutorial.</span></span> <span data-ttu-id="c0eca-383">此外，如果您想要使用批次更新模式，也必須提供**InsertCommand**、 **UpdateCommand**和**DeleteCommand**屬性值。</span><span class="sxs-lookup"><span data-stu-id="c0eca-383">Furthermore, you'll manually have to provide the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** property values if you want to use the batch updating pattern.</span></span>

## <a name="adding-the-remaining-tableadapters"></a><span data-ttu-id="c0eca-384">新增其餘的 Tableadapter</span><span class="sxs-lookup"><span data-stu-id="c0eca-384">Adding the Remaining TableAdapters</span></span>

<span data-ttu-id="c0eca-385">到目前為止，我們只探討了如何針對單一資料庫資料表使用單一 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="c0eca-385">Up until now, we've only looked at working with a single TableAdapter for a single database table.</span></span> <span data-ttu-id="c0eca-386">不過，Northwind 資料庫包含數個相關的資料表，我們需要在 web 應用程式中使用。</span><span class="sxs-lookup"><span data-stu-id="c0eca-386">However, the Northwind database contains several related tables that we'll need to work with in our web application.</span></span> <span data-ttu-id="c0eca-387">具類型的資料集可以包含多個相關的 Datatable。</span><span class="sxs-lookup"><span data-stu-id="c0eca-387">A Typed DataSet can contain multiple, related DataTables.</span></span> <span data-ttu-id="c0eca-388">因此，若要完成 DAL，我們必須在這些教學課程中，為我們將使用的其他資料表新增 Datatable。</span><span class="sxs-lookup"><span data-stu-id="c0eca-388">Therefore, to complete our DAL we need to add DataTables for the other tables we'll be using in these tutorials.</span></span> <span data-ttu-id="c0eca-389">若要將新的 TableAdapter 加入至具類型的資料集，請開啟 DataSet 設計工具，在設計工具中按一下滑鼠右鍵，然後選擇 [新增/TableAdapter]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-389">To add a new TableAdapter to a Typed DataSet, open the DataSet Designer, right-click in the Designer, and choose Add / TableAdapter.</span></span> <span data-ttu-id="c0eca-390">這會建立新的 DataTable 和 TableAdapter，並逐步引導您完成我們稍早在本教學課程中所檢查的 wizard。</span><span class="sxs-lookup"><span data-stu-id="c0eca-390">This will create a new DataTable and TableAdapter and walk you through the wizard we examined earlier in this tutorial.</span></span>

<span data-ttu-id="c0eca-391">請花幾分鐘的時間，使用下列查詢建立下列 Tableadapter 和方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-391">Take a few minutes to create the following TableAdapters and methods using the following queries.</span></span> <span data-ttu-id="c0eca-392">請注意， **ProductsTableAdapter**中的查詢包含用來抓取每個產品類別目錄和供應商名稱的子查詢。</span><span class="sxs-lookup"><span data-stu-id="c0eca-392">Note that the queries in the **ProductsTableAdapter** include the subqueries to grab each product's category and supplier names.</span></span> <span data-ttu-id="c0eca-393">此外，如果您已經跟著做過，就已經加入了**ProductsTableAdapter**類別的**GetProducts （）** 和**GetProductsByCategoryID （*類別*的）** 方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-393">Additionally, if you've been following along, you've already added the **ProductsTableAdapter** class's **GetProducts()** and **GetProductsByCategoryID(*categoryID*)** methods.</span></span>

- <span data-ttu-id="c0eca-394">**ProductsTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="c0eca-394">**ProductsTableAdapter**</span></span>

  - <span data-ttu-id="c0eca-395">**GetProducts**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-395">**GetProducts**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample10.sql)]
  - <span data-ttu-id="c0eca-396">**GetProductsByCategoryID**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-396">**GetProductsByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample11.sql)]
  - <span data-ttu-id="c0eca-397">**GetProductsBySupplierID**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-397">**GetProductsBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample12.sql)]
  - <span data-ttu-id="c0eca-398">**GetProductByProductID**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-398">**GetProductByProductID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample13.sql)]
- <span data-ttu-id="c0eca-399">**CategoriesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="c0eca-399">**CategoriesTableAdapter**</span></span>

  - <span data-ttu-id="c0eca-400">**GetCategories**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-400">**GetCategories**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample14.sql)]
  - <span data-ttu-id="c0eca-401">**GetCategoryByCategoryID**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-401">**GetCategoryByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample15.sql)]
- <span data-ttu-id="c0eca-402">**SuppliersTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="c0eca-402">**SuppliersTableAdapter**</span></span>

  - <span data-ttu-id="c0eca-403">**GetSuppliers**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-403">**GetSuppliers**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample16.sql)]
  - <span data-ttu-id="c0eca-404">**GetSuppliersByCountry**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-404">**GetSuppliersByCountry**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample17.sql)]
  - <span data-ttu-id="c0eca-405">**GetSupplierBySupplierID**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-405">**GetSupplierBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample18.sql)]
- <span data-ttu-id="c0eca-406">**EmployeesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="c0eca-406">**EmployeesTableAdapter**</span></span>

  - <span data-ttu-id="c0eca-407">**GetEmployees**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-407">**GetEmployees**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample19.sql)]
  - <span data-ttu-id="c0eca-408">**GetEmployeesByManager**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-408">**GetEmployeesByManager**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample20.sql)]
  - <span data-ttu-id="c0eca-409">**GetEmployeeByEmployeeID**：</span><span class="sxs-lookup"><span data-stu-id="c0eca-409">**GetEmployeeByEmployeeID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample21.sql)]

<span data-ttu-id="c0eca-410">[加入四個 Tableadapter 之後，![DataSet 設計工具](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-410">[![The DataSet Designer After the Four TableAdapters Have Been Added](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span></span>

<span data-ttu-id="c0eca-411">**圖 31**：已加入四個 tableadapter 之後的 DataSet 設計工具（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image85.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-411">**Figure 31**: The DataSet Designer After the Four TableAdapters Have Been Added ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image85.png))</span></span>

## <a name="adding-custom-code-to-the-dal"></a><span data-ttu-id="c0eca-412">將自訂程式碼新增至 DAL</span><span class="sxs-lookup"><span data-stu-id="c0eca-412">Adding Custom Code to the DAL</span></span>

<span data-ttu-id="c0eca-413">加入至具類型資料集的 Tableadapter 和 Datatable 會以 XML 架構定義檔（**Northwind**）來表示。</span><span class="sxs-lookup"><span data-stu-id="c0eca-413">The TableAdapters and DataTables added to the Typed DataSet are expressed as an XML Schema Definition file (**Northwind.xsd**).</span></span> <span data-ttu-id="c0eca-414">以滑鼠右鍵按一下 方案總管中的  **Northwind**  檔案，然後選擇 查看程式碼，即可查看此架構資訊。</span><span class="sxs-lookup"><span data-stu-id="c0eca-414">You can view this schema information by right-clicking on the **Northwind.xsd** file in the Solution Explorer and choosing View Code.</span></span>

<span data-ttu-id="c0eca-415">[![Northwinds 具類型資料集的 XML 架構定義（XSD）檔案](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-415">[![The XML Schema Definition (XSD) File for the Northwinds Typed DataSet](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span></span>

<span data-ttu-id="c0eca-416">**圖 32**： Northwinds 具類型資料集的 XML 架構定義（XSD）檔案（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image88.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-416">**Figure 32**: The XML Schema Definition (XSD) File for the Northwinds Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image88.png))</span></span>

<span data-ttu-id="c0eca-417">在編譯或執行時間（ C#如有需要）時，此架構資訊會在設計階段轉譯為或 Visual Basic 程式碼，此時您可以使用偵錯工具逐步執行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-417">This schema information is translated into C# or Visual Basic code at design time when compiled or at runtime (if needed), at which point you can step through it with the debugger.</span></span> <span data-ttu-id="c0eca-418">若要查看這個自動產生的程式碼，請移至類別檢視並向下切入至 TableAdapter 或具類型的資料集類別。</span><span class="sxs-lookup"><span data-stu-id="c0eca-418">To view this auto-generated code go to the Class View and drill down to the TableAdapter or Typed DataSet classes.</span></span> <span data-ttu-id="c0eca-419">如果您在螢幕上看不到類別檢視，請移至 [View] 功能表並從該處選取，或按 Ctrl + Shift + C。</span><span class="sxs-lookup"><span data-stu-id="c0eca-419">If you don't see the Class View on your screen, go to the View menu and select it from there, or hit Ctrl+Shift+C.</span></span> <span data-ttu-id="c0eca-420">您可以從類別檢視查看具類型資料集和 TableAdapter 類別的屬性、方法和事件。</span><span class="sxs-lookup"><span data-stu-id="c0eca-420">From the Class View you can see the properties, methods, and events of the Typed DataSet and TableAdapter classes.</span></span> <span data-ttu-id="c0eca-421">若要查看特定方法的程式碼，請按兩下類別檢視中的方法名稱，或在其上按一下滑鼠右鍵，然後選擇 [移至定義]。</span><span class="sxs-lookup"><span data-stu-id="c0eca-421">To view the code for a particular method, double-click the method name in the Class View or right-click on it and choose Go To Definition.</span></span>

![從類別檢視選取 [移至定義]，檢查自動產生的程式碼](creating-a-data-access-layer-cs/_static/image89.png)

<span data-ttu-id="c0eca-423">**圖 33**：從類別檢視選取 [移至定義]，檢查自動產生的程式碼</span><span class="sxs-lookup"><span data-stu-id="c0eca-423">**Figure 33**: Inspect the Auto-Generated Code by Selecting Go To Definition from the Class View</span></span>

<span data-ttu-id="c0eca-424">雖然自動產生的程式碼可以是很好的時間，但程式碼通常非常通用，而且需要自訂以符合應用程式的獨特需求。</span><span class="sxs-lookup"><span data-stu-id="c0eca-424">While auto-generated code can be a great time saver, the code is often very generic and needs to be customized to meet the unique needs of an application.</span></span> <span data-ttu-id="c0eca-425">不過，擴充自動產生的程式碼的風險是，產生程式碼的工具可能會決定何時「重新產生」並覆寫您的自訂。</span><span class="sxs-lookup"><span data-stu-id="c0eca-425">The risk of extending auto-generated code, though, is that the tool that generated the code might decide it's time to "regenerate" and overwrite your customizations.</span></span> <span data-ttu-id="c0eca-426">有了 .NET 2.0 的新部分類別概念，就可以輕鬆地將類別分割成多個檔案。</span><span class="sxs-lookup"><span data-stu-id="c0eca-426">With .NET 2.0's new partial class concept, it's easy to split a class across multiple files.</span></span> <span data-ttu-id="c0eca-427">這可讓我們將自己的方法、屬性和事件新增至自動產生的類別，而不必擔心 Visual Studio 覆寫我們的自訂。</span><span class="sxs-lookup"><span data-stu-id="c0eca-427">This enables us to add our own methods, properties, and events to the auto-generated classes without having to worry about Visual Studio overwriting our customizations.</span></span>

<span data-ttu-id="c0eca-428">為了示範如何自訂 DAL，讓我們將**GetProducts （）** 方法新增至**SuppliersRow**類別。</span><span class="sxs-lookup"><span data-stu-id="c0eca-428">To demonstrate how to customize the DAL, let's add a **GetProducts()** method to the **SuppliersRow** class.</span></span> <span data-ttu-id="c0eca-429">**SuppliersRow**類別代表**供應商**資料表中的單一記錄;每個供應商可以提供零到多個產品，因此**GetProducts （）** 會傳回指定供應商的這些產品。</span><span class="sxs-lookup"><span data-stu-id="c0eca-429">The **SuppliersRow** class represents a single record in the **Suppliers** table; each supplier can provider zero to many products, so **GetProducts()** will return those products of the specified supplier.</span></span> <span data-ttu-id="c0eca-430">若要完成這項工作，請在**應用程式**中建立名為**SuppliersRow.cs**的新類別檔案，\_的 code 資料夾，並新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="c0eca-430">To accomplish this create a new class file in the **App\_Code** folder named **SuppliersRow.cs** and add the following code:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample22.cs)]

<span data-ttu-id="c0eca-431">這個部分類別會指示編譯器在建立**SuppliersRow**類別時，要包含我們剛剛定義的**GetProducts （）** 方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-431">This partial class instructs the compiler that when building the **Northwind.SuppliersRow** class to include the **GetProducts()** method we just defined.</span></span> <span data-ttu-id="c0eca-432">如果您建立專案，然後回到類別檢視，您會看到**GetProducts （）** 現在列為**SuppliersRow**的方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-432">If you build your project and then return to the Class View you'll see **GetProducts()** now listed as a method of **Northwind.SuppliersRow**.</span></span>

![GetProducts （）方法現在是 SuppliersRow 類別的一部分](creating-a-data-access-layer-cs/_static/image90.png)

<span data-ttu-id="c0eca-434">**圖 34**： **GetProducts （）** 方法現在是**SuppliersRow**類別的一部分</span><span class="sxs-lookup"><span data-stu-id="c0eca-434">**Figure 34**: The **GetProducts()** Method is Now Part of the **Northwind.SuppliersRow** Class</span></span>

<span data-ttu-id="c0eca-435">**GetProducts （）** 方法現在可以用來列舉特定供應商的產品集合，如下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="c0eca-435">The **GetProducts()** method can now be used to enumerate the set of products for a particular supplier, as the following code shows:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample23.html)]

<span data-ttu-id="c0eca-436">這項資料也可以顯示在任何 ASP 中。NET 的資料 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="c0eca-436">This data can also be displayed in any of ASP.NET's data Web controls.</span></span> <span data-ttu-id="c0eca-437">下列頁面會使用具有兩個欄位的 GridView 控制項：</span><span class="sxs-lookup"><span data-stu-id="c0eca-437">The following page uses a GridView control with two fields:</span></span>

- <span data-ttu-id="c0eca-438">顯示每個供應商名稱的 BoundField，以及</span><span class="sxs-lookup"><span data-stu-id="c0eca-438">A BoundField that displays the name of each supplier, and</span></span>
- <span data-ttu-id="c0eca-439">包含 BulletedList 控制項的 TemplateField，其系結至每個供應商的**GetProducts （）** 方法所傳回的結果。</span><span class="sxs-lookup"><span data-stu-id="c0eca-439">A TemplateField that contains a BulletedList control that is bound to the results returned by the **GetProducts()** method for each supplier.</span></span>

<span data-ttu-id="c0eca-440">我們將在未來的教學課程中，檢查如何顯示這類主版詳細資料包表。</span><span class="sxs-lookup"><span data-stu-id="c0eca-440">We'll examine how to display such master-detail reports in future tutorials.</span></span> <span data-ttu-id="c0eca-441">目前，此範例的設計目的是要說明如何使用新增至**SuppliersRow**類別的自訂方法。</span><span class="sxs-lookup"><span data-stu-id="c0eca-441">For now, this example is designed to illustrate using the custom method added to the **Northwind.SuppliersRow** class.</span></span>

<span data-ttu-id="c0eca-442">SuppliersAndProducts .aspx</span><span class="sxs-lookup"><span data-stu-id="c0eca-442">SuppliersAndProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample24.aspx)]

<span data-ttu-id="c0eca-443">SuppliersAndProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="c0eca-443">SuppliersAndProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample25.cs)]

<span data-ttu-id="c0eca-444">[![供應商的公司名稱列在左欄中，其產品位於右邊](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span><span class="sxs-lookup"><span data-stu-id="c0eca-444">[![The Supplier's Company Name is Listed in the Left Column, Their Products in the Right](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span></span>

<span data-ttu-id="c0eca-445">**圖 35**：供應商的公司名稱列在左欄中，其產品位於右側（[按一下以查看完整大小的影像](creating-a-data-access-layer-cs/_static/image93.png)）</span><span class="sxs-lookup"><span data-stu-id="c0eca-445">**Figure 35**: The Supplier's Company Name is Listed in the Left Column, Their Products in the Right ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image93.png))</span></span>

## <a name="summary"></a><span data-ttu-id="c0eca-446">總結</span><span class="sxs-lookup"><span data-stu-id="c0eca-446">Summary</span></span>

<span data-ttu-id="c0eca-447">建立 web 應用程式時，必須是您在開始建立展示層之前的第一個步驟。</span><span class="sxs-lookup"><span data-stu-id="c0eca-447">When building a web application creating the DAL should be one of your first steps, occurring before you start creating your presentation layer.</span></span> <span data-ttu-id="c0eca-448">有了 Visual Studio，根據具類型的資料集建立 DAL 是一項可在10-15 分鐘內完成的工作，而不需要撰寫一行程式碼。</span><span class="sxs-lookup"><span data-stu-id="c0eca-448">With Visual Studio, creating a DAL based on Typed DataSets is a task that can be accomplished in 10-15 minutes without writing a line of code.</span></span> <span data-ttu-id="c0eca-449">繼續進行的教學課程將以此 DAL 為基礎。</span><span class="sxs-lookup"><span data-stu-id="c0eca-449">The tutorials moving forward will build upon this DAL.</span></span> <span data-ttu-id="c0eca-450">在[下一個教學](creating-a-business-logic-layer-cs.md)課程中，我們將定義一些商務規則，並瞭解如何在不同的商業邏輯層中執行。</span><span class="sxs-lookup"><span data-stu-id="c0eca-450">In the [next tutorial](creating-a-business-logic-layer-cs.md) we'll define a number of business rules and see how to implement them in a separate Business Logic Layer.</span></span>

<span data-ttu-id="c0eca-451">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="c0eca-451">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="c0eca-452">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="c0eca-452">Further Reading</span></span>

<span data-ttu-id="c0eca-453">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="c0eca-453">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c0eca-454">在 VS 2005 和 ASP.NET 2.0 中使用強型別 Tableadapter 和 Datatable 建立 DAL</span><span class="sxs-lookup"><span data-stu-id="c0eca-454">Building a DAL using Strongly Typed TableAdapters and DataTables in VS 2005 and ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/435498)
- [<span data-ttu-id="c0eca-455">設計資料層元件和透過層級傳遞資料</span><span class="sxs-lookup"><span data-stu-id="c0eca-455">Designing Data Tier Components and Passing Data Through Tiers</span></span>](https://msdn.microsoft.com/library/ms978496.aspx)
- [<span data-ttu-id="c0eca-456">使用 Visual Studio 2005 DataSet 設計工具建立資料存取層</span><span class="sxs-lookup"><span data-stu-id="c0eca-456">Build a Data Access Layer with the Visual Studio 2005 DataSet Designer</span></span>](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)
- [<span data-ttu-id="c0eca-457">加密 ASP.NET 2.0 應用程式中的設定資訊</span><span class="sxs-lookup"><span data-stu-id="c0eca-457">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="c0eca-458">TableAdapter 概觀</span><span class="sxs-lookup"><span data-stu-id="c0eca-458">TableAdapter Overview</span></span>](https://msdn.microsoft.com/library/bz9tthwx.aspx)
- [<span data-ttu-id="c0eca-459">使用具類型的資料集</span><span class="sxs-lookup"><span data-stu-id="c0eca-459">Working with a Typed DataSet</span></span>](https://msdn.microsoft.com/library/esbykkzb.aspx)
- [<span data-ttu-id="c0eca-460">在 Visual Studio 2005 和 ASP.NET 2.0 中使用強型別資料存取</span><span class="sxs-lookup"><span data-stu-id="c0eca-460">Using Strongly-Typed Data Access in Visual Studio 2005 and ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/020806-1.aspx)
- [<span data-ttu-id="c0eca-461">如何擴充 TableAdapter 方法</span><span class="sxs-lookup"><span data-stu-id="c0eca-461">How to Extend TableAdapter Methods</span></span>](https://blogs.msdn.com/vbteam/archive/2005/05/04/ExtendingTableAdapters.aspx)
- [<span data-ttu-id="c0eca-462">從預存程式中取出純量資料</span><span class="sxs-lookup"><span data-stu-id="c0eca-462">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="c0eca-463">本教學課程中所含主題的影片訓練</span><span class="sxs-lookup"><span data-stu-id="c0eca-463">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="c0eca-464">ASP.NET 應用程式中的資料存取層</span><span class="sxs-lookup"><span data-stu-id="c0eca-464">Data Access Layers in ASP.NET Applications</span></span>](../../../videos/data-access/adonet-data-services/data-access-layers-in-aspnet-applications.md)
- [<span data-ttu-id="c0eca-465">如何將資料集手動系結至 Datagrid</span><span class="sxs-lookup"><span data-stu-id="c0eca-465">How to Manually Bind a Dataset to a Datagrid</span></span>](../../../videos/data-access/adonet-data-services/how-to-manually-bind-a-dataset-to-a-datagrid.md)
- [<span data-ttu-id="c0eca-466">如何從 ASP 應用程式使用資料集和篩選</span><span class="sxs-lookup"><span data-stu-id="c0eca-466">How to Work with Datasets and Filters from an ASP Application</span></span>](../../../videos/data-access/adonet-data-services/how-to-work-with-datasets-and-filters-from-an-asp-application.md)

## <a name="about-the-author"></a><span data-ttu-id="c0eca-467">關於作者</span><span class="sxs-lookup"><span data-stu-id="c0eca-467">About the Author</span></span>

<span data-ttu-id="c0eca-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="c0eca-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c0eca-469">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="c0eca-469">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c0eca-470">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="c0eca-470">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c0eca-471">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c0eca-471">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c0eca-472">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="c0eca-472">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c0eca-473">特別感謝</span><span class="sxs-lookup"><span data-stu-id="c0eca-473">Special Thanks To</span></span>

<span data-ttu-id="c0eca-474">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="c0eca-474">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c0eca-475">本教學課程的領導審查者為 Ron 環保、Hilton Giesenow、Dennis Patterson、Liz Shulok、Abel Gomez 和 Carlos Santos。</span><span class="sxs-lookup"><span data-stu-id="c0eca-475">Lead reviewers for this tutorial were Ron Green, Hilton Giesenow, Dennis Patterson, Liz Shulok, Abel Gomez, and Carlos Santos.</span></span> <span data-ttu-id="c0eca-476">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="c0eca-476">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c0eca-477">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c0eca-477">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="c0eca-478">下一個</span><span class="sxs-lookup"><span data-stu-id="c0eca-478">Next</span></span>](creating-a-business-logic-layer-cs.md)
