---
uid: web-forms/overview/data-access/custom-button-actions-with-the-datalist-and-repeater/custom-buttons-in-the-datalist-and-repeater-cs
title: DataList 和中繼器中的自訂按鈕C#（） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將建立一個介面，以使用重複項來列出系統中的類別，每個類別都提供一個按鈕來顯示其 associ 。
ms.author: riande
ms.date: 11/13/2006
ms.assetid: 1f42e332-78dc-438b-9e35-0c97aa0ad929
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions-with-the-datalist-and-repeater/custom-buttons-in-the-datalist-and-repeater-cs
msc.type: authoredcontent
ms.openlocfilehash: e8cb1054068327c25e057b6df1cc7506feec8d37
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74601721"
---
# <a name="custom-buttons-in-the-datalist-and-repeater-c"></a><span data-ttu-id="fc499-103">在 DataList 與重複項中自訂按鈕 (C#)</span><span class="sxs-lookup"><span data-stu-id="fc499-103">Custom Buttons in the DataList and Repeater (C#)</span></span>

<span data-ttu-id="fc499-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="fc499-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="fc499-105">[下載範例應用程式](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_46_CS.exe)或[下載 PDF](custom-buttons-in-the-datalist-and-repeater-cs/_static/datatutorial46cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="fc499-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_46_CS.exe) or [Download PDF](custom-buttons-in-the-datalist-and-repeater-cs/_static/datatutorial46cs1.pdf)</span></span>

> <span data-ttu-id="fc499-106">在本教學課程中，我們將建立一個介面，以使用重複項來列出系統中的類別，每個類別都會提供一個按鈕，以使用 BulletedList 控制項來顯示其相關聯的產品。</span><span class="sxs-lookup"><span data-stu-id="fc499-106">In this tutorial we'll build an interface that uses a Repeater to list the categories in the system, with each category providing a button to show its associated products using a BulletedList control.</span></span>

## <a name="introduction"></a><span data-ttu-id="fc499-107">簡介</span><span class="sxs-lookup"><span data-stu-id="fc499-107">Introduction</span></span>

<span data-ttu-id="fc499-108">在過去的十七個 DataList 和中繼器教學課程中，我們已建立唯讀範例和編輯和刪除範例。</span><span class="sxs-lookup"><span data-stu-id="fc499-108">Throughout the past seventeen DataList and Repeater tutorials, we ve created both read-only examples and editing and deleting examples.</span></span> <span data-ttu-id="fc499-109">為了協助在 DataList 中編輯和刪除功能，我們將按鈕新增至 DataList s `ItemTemplate`，按下時，會導致回傳並引發對應于按鈕 s `CommandName` 屬性的 DataList 事件。</span><span class="sxs-lookup"><span data-stu-id="fc499-109">To facilitate editing and deleting capabilities within a DataList, we added buttons to the DataList s `ItemTemplate` that, when clicked, caused a postback and raised a DataList event corresponding to the button s `CommandName` property.</span></span> <span data-ttu-id="fc499-110">例如，將按鈕加入具有 `CommandName` 屬性值為 Edit 的 `ItemTemplate`，會導致 DataList s `EditCommand` 在回傳時引發;其中一個具有 `CommandName` Delete 會引發 `DeleteCommand`。</span><span class="sxs-lookup"><span data-stu-id="fc499-110">For example, adding a button to the `ItemTemplate` with a `CommandName` property value of Edit causes the DataList s `EditCommand` to fire on postback; one with the `CommandName` Delete raises the `DeleteCommand`.</span></span>

<span data-ttu-id="fc499-111">除了 [編輯] 和 [刪除] 按鈕以外，DataList 和重複項控制項也可以包含按鈕、LinkButtons 或 ImageButtons，當按下時，就會執行一些自訂的伺服器端邏輯。</span><span class="sxs-lookup"><span data-stu-id="fc499-111">In addition to Edit and Delete buttons, the DataList and Repeater controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="fc499-112">在本教學課程中，我們將建立使用中繼器來列出系統中類別的介面。</span><span class="sxs-lookup"><span data-stu-id="fc499-112">In this tutorial we'll build an interface that uses a Repeater to list the categories in the system.</span></span> <span data-ttu-id="fc499-113">針對每個類別，中繼器會包含一個按鈕，以使用 BulletedList 控制項來顯示與類別相關聯的產品（請參閱 [圖 1]）。</span><span class="sxs-lookup"><span data-stu-id="fc499-113">For each category, the Repeater will include a button to show the category s associated products using a BulletedList control (see Figure 1).</span></span>

<span data-ttu-id="fc499-114">[![按一下 [顯示產品] 連結，會以項目符號清單顯示產品類別目錄](custom-buttons-in-the-datalist-and-repeater-cs/_static/image2.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="fc499-114">[![Clicking the Show Products Link Displays the Category s Products in a Bulleted List](custom-buttons-in-the-datalist-and-repeater-cs/_static/image2.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image1.png)</span></span>

<span data-ttu-id="fc499-115">**圖 1**：按一下 [顯示產品] 連結會以項目符號清單顯示產品類別目錄（[按一下以觀看完整大小的影像](custom-buttons-in-the-datalist-and-repeater-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="fc499-115">**Figure 1**: Clicking the Show Products Link Displays the Category s Products in a Bulleted List ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-cs/_static/image3.png))</span></span>

## <a name="step-1-adding-the-custom-button-tutorial-web-pages"></a><span data-ttu-id="fc499-116">步驟1：新增自訂按鈕教學課程網頁</span><span class="sxs-lookup"><span data-stu-id="fc499-116">Step 1: Adding the Custom Button Tutorial Web Pages</span></span>

<span data-ttu-id="fc499-117">在查看如何新增自訂按鈕之前，先讓我們先花點時間在我們的網站專案中建立 ASP.NET 網頁，我們將在本教學課程中需要此功能。</span><span class="sxs-lookup"><span data-stu-id="fc499-117">Before we look at how to add a custom button, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="fc499-118">從新增名為 `CustomButtonsDataListRepeater`的資料夾開始。</span><span class="sxs-lookup"><span data-stu-id="fc499-118">Start by adding a new folder named `CustomButtonsDataListRepeater`.</span></span> <span data-ttu-id="fc499-119">接下來，將下列兩個 ASP.NET 網頁新增至該資料夾，並確定每個頁面都與 `Site.master` 主版頁面相關聯：</span><span class="sxs-lookup"><span data-stu-id="fc499-119">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`

![新增自訂按鈕相關教學課程的 ASP.NET 網頁](custom-buttons-in-the-datalist-and-repeater-cs/_static/image4.png)

<span data-ttu-id="fc499-121">**圖 2**：新增自訂按鈕相關教學課程的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="fc499-121">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>

<span data-ttu-id="fc499-122">如同在其他資料夾中，[`CustomButtonsDataListRepeater`] 資料夾中的 `Default.aspx` 會在其區段中列出教學課程。</span><span class="sxs-lookup"><span data-stu-id="fc499-122">Like in the other folders, `Default.aspx` in the `CustomButtonsDataListRepeater` folder will list the tutorials in its section.</span></span> <span data-ttu-id="fc499-123">回想一下，`SectionLevelTutorialListing.ascx` 的使用者控制項會提供這種功能。</span><span class="sxs-lookup"><span data-stu-id="fc499-123">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="fc499-124">將此使用者控制項從方案總管拖曳至頁面 s 設計檢視，以將其新增至 `Default.aspx`。</span><span class="sxs-lookup"><span data-stu-id="fc499-124">Add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="fc499-125">[![將 SectionLevelTutorialListing 的 .ascx 使用者控制項新增至 default.aspx](custom-buttons-in-the-datalist-and-repeater-cs/_static/image6.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="fc499-125">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](custom-buttons-in-the-datalist-and-repeater-cs/_static/image6.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image5.png)</span></span>

<span data-ttu-id="fc499-126">**圖 3**：將 `SectionLevelTutorialListing.ascx` 使用者控制項加入 `Default.aspx` （[按一下以查看完整大小的影像](custom-buttons-in-the-datalist-and-repeater-cs/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="fc499-126">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-cs/_static/image7.png))</span></span>

<span data-ttu-id="fc499-127">最後，將頁面新增為 `Web.sitemap` 檔案的專案。</span><span class="sxs-lookup"><span data-stu-id="fc499-127">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="fc499-128">具體而言，請使用 DataList 和中繼器 `<siteMapNode>`，在分頁和排序之後加入下列標記：</span><span class="sxs-lookup"><span data-stu-id="fc499-128">Specifically, add the following markup after the Paging and Sorting with the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-xml[Main](custom-buttons-in-the-datalist-and-repeater-cs/samples/sample1.xml)]

<span data-ttu-id="fc499-129">更新 `Web.sitemap`之後，請花一點時間透過瀏覽器來觀看教學課程網站。</span><span class="sxs-lookup"><span data-stu-id="fc499-129">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="fc499-130">左側功能表現在包含用於編輯、插入及刪除教學課程的專案。</span><span class="sxs-lookup"><span data-stu-id="fc499-130">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![網站地圖現在包含自訂按鈕教學課程的專案](custom-buttons-in-the-datalist-and-repeater-cs/_static/image8.png)

<span data-ttu-id="fc499-132">[**圖 4**]：網站地圖現在包含自訂按鈕教學課程的專案</span><span class="sxs-lookup"><span data-stu-id="fc499-132">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>

## <a name="step-2-adding-the-list-of-categories"></a><span data-ttu-id="fc499-133">步驟2：加入分類清單</span><span class="sxs-lookup"><span data-stu-id="fc499-133">Step 2: Adding the List of Categories</span></span>

<span data-ttu-id="fc499-134">在本教學課程中，我們需要建立一個會列出所有分類的重複項，並顯示產品 LinkButton，當您按一下時，就會在項目符號清單中顯示相關聯的類別目錄產品。</span><span class="sxs-lookup"><span data-stu-id="fc499-134">For this tutorial we need to create a Repeater that lists all categories along with a Show Products LinkButton that, when clicked, displays the associated category s products in a bulleted list.</span></span> <span data-ttu-id="fc499-135">讓我們先建立一個簡單的重複項，以列出系統中的類別。</span><span class="sxs-lookup"><span data-stu-id="fc499-135">Let s first create a simple Repeater that lists the categories in the system.</span></span> <span data-ttu-id="fc499-136">從開啟 [`CustomButtonsDataListRepeater`] 資料夾中的 [`CustomButtons.aspx`] 頁面開始。</span><span class="sxs-lookup"><span data-stu-id="fc499-136">Start by opening the `CustomButtons.aspx` page in the `CustomButtonsDataListRepeater` folder.</span></span> <span data-ttu-id="fc499-137">從 [工具箱] 將 [中繼器] 拖曳至設計工具，並將其 [`ID`] 屬性設定為 [`Categories`]。</span><span class="sxs-lookup"><span data-stu-id="fc499-137">Drag a Repeater from the Toolbox onto the Designer and set its `ID` property to `Categories`.</span></span> <span data-ttu-id="fc499-138">接下來，從 [中繼器] 智慧標籤建立新的資料來源控制項。</span><span class="sxs-lookup"><span data-stu-id="fc499-138">Next, create a new data source control from the Repeater s smart tag.</span></span> <span data-ttu-id="fc499-139">具體而言，請建立名為 `CategoriesDataSource` 的新 ObjectDataSource 控制項，從 `CategoriesBLL` 類別 s `GetCategories()` 方法中選取其資料。</span><span class="sxs-lookup"><span data-stu-id="fc499-139">Specifically, create a new ObjectDataSource control named `CategoriesDataSource` that selects its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>

<span data-ttu-id="fc499-140">[![將 ObjectDataSource 設定為使用 CategoriesBLL 類別的 GetCategories （）方法](custom-buttons-in-the-datalist-and-repeater-cs/_static/image10.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="fc499-140">[![Configure the ObjectDataSource to Use the CategoriesBLL Class s GetCategories() Method](custom-buttons-in-the-datalist-and-repeater-cs/_static/image10.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image9.png)</span></span>

<span data-ttu-id="fc499-141">**圖 5**：設定 ObjectDataSource 使用 `CategoriesBLL` 類別的 `GetCategories()` 方法（[按一下以查看完整大小的影像](custom-buttons-in-the-datalist-and-repeater-cs/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="fc499-141">**Figure 5**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class s `GetCategories()` Method ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-cs/_static/image11.png))</span></span>

<span data-ttu-id="fc499-142">不同于 DataList 控制項，Visual Studio 根據資料來源建立預設 `ItemTemplate`，必須手動定義中繼器的範本。</span><span class="sxs-lookup"><span data-stu-id="fc499-142">Unlike the DataList control, for which Visual Studio creates a default `ItemTemplate` based on the data source, the Repeater s templates must be manually defined.</span></span> <span data-ttu-id="fc499-143">此外，您必須以宣告方式建立和編輯中繼器的範本（也就是，在中繼器 s 智慧標籤中沒有 [編輯範本] 選項）。</span><span class="sxs-lookup"><span data-stu-id="fc499-143">Furthermore, the Repeater s templates must be created and edited declaratively (that is, there s no Edit Templates option in the Repeater s smart tag).</span></span>

<span data-ttu-id="fc499-144">按一下左下角的 [來源] 索引標籤，然後加入一個 `ItemTemplate`，在 `<h3>` 元素中顯示類別目錄的名稱，並將其描述放在段落標記中;包含在每個類別之間顯示水準規則（`<hr />`）的 `SeparatorTemplate`。</span><span class="sxs-lookup"><span data-stu-id="fc499-144">Click on the Source tab in the bottom left corner and add an `ItemTemplate` that displays the category s name in an `<h3>` element and its description in a paragraph tag; include a `SeparatorTemplate` that displays a horizontal rule (`<hr />`) between each category.</span></span> <span data-ttu-id="fc499-145">同時新增 LinkButton，並將其 `Text` 屬性設定為 [顯示產品]。</span><span class="sxs-lookup"><span data-stu-id="fc499-145">Also add a LinkButton with its `Text` property set to Show Products.</span></span> <span data-ttu-id="fc499-146">完成這些步驟之後，您的頁面宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="fc499-146">After completing these steps, your page s declarative markup should look like the following:</span></span>

[!code-aspx[Main](custom-buttons-in-the-datalist-and-repeater-cs/samples/sample2.aspx)]

<span data-ttu-id="fc499-147">[圖 6] 顯示透過瀏覽器觀看的頁面。</span><span class="sxs-lookup"><span data-stu-id="fc499-147">Figure 6 shows the page when viewed through a browser.</span></span> <span data-ttu-id="fc499-148">列出每個類別目錄名稱和描述。</span><span class="sxs-lookup"><span data-stu-id="fc499-148">Each category name and description is listed.</span></span> <span data-ttu-id="fc499-149">按一下 [顯示產品] 按鈕會導致回傳，但尚未執行任何動作。</span><span class="sxs-lookup"><span data-stu-id="fc499-149">The Show Products button, when clicked, causes a postback but does not yet perform any action.</span></span>

<span data-ttu-id="fc499-150">[![會顯示每個類別目錄名稱和描述，以及顯示產品 LinkButton](custom-buttons-in-the-datalist-and-repeater-cs/_static/image13.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="fc499-150">[![Each Category s Name and Description is Displayed, Along with a Show Products LinkButton](custom-buttons-in-the-datalist-and-repeater-cs/_static/image13.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image12.png)</span></span>

<span data-ttu-id="fc499-151">**圖 6**：每個類別目錄的名稱和描述，以及顯示產品 LinkButton （[按一下以觀看完整大小的影像](custom-buttons-in-the-datalist-and-repeater-cs/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="fc499-151">**Figure 6**: Each Category s Name and Description is Displayed, Along with a Show Products LinkButton ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-cs/_static/image14.png))</span></span>

## <a name="step-3-executing-server-side-logic-when-the-show-products-linkbutton-is-clicked"></a><span data-ttu-id="fc499-152">步驟3：按一下 [顯示產品] LinkButton 時，執行伺服器端邏輯</span><span class="sxs-lookup"><span data-stu-id="fc499-152">Step 3: Executing Server-Side Logic When the Show Products LinkButton is Clicked</span></span>

<span data-ttu-id="fc499-153">每當按一下 DataList 或重複項中範本內的按鈕、LinkButton 或 ImageButton 時，就會發生回傳，而 DataList 或 Repeater `ItemCommand` 事件會引發。</span><span class="sxs-lookup"><span data-stu-id="fc499-153">Anytime a Button, LinkButton, or ImageButton within a template in a DataList or Repeater is clicked, a postback occurs and the DataList or Repeater s `ItemCommand` event fires.</span></span> <span data-ttu-id="fc499-154">除了 `ItemCommand` 事件以外，如果按鈕的 `CommandName` 屬性設定為其中一個保留字元串（Delete、Edit、Cancel、Update 或 Select），DataList 控制項也可能會引發另一個更特定的事件，但 `ItemCommand` 事件*一律*會引發。</span><span class="sxs-lookup"><span data-stu-id="fc499-154">In addition to the `ItemCommand` event, the DataList control may also raise another, more specific event if the button s `CommandName` property is set to one of the reserved strings ( Delete, Edit, Cancel, Update, or Select ), but the `ItemCommand` event is *always* fired.</span></span>

<span data-ttu-id="fc499-155">當按一下 DataList 或中繼器內的按鈕時，通常需要傳遞按下哪一個按鈕（在控制項中可能有多個按鈕，例如 [編輯] 和 [刪除] 按鈕），還有一些額外的資訊（例如已按下按鈕的專案主要索引鍵值。</span><span class="sxs-lookup"><span data-stu-id="fc499-155">When a button is clicked within a DataList or Repeater, oftentimes we need to pass along which button was clicked (in the case that there may be multiple buttons within the control, such as both an Edit and Delete button) and perhaps some additional information (such as the primary key value of the item whose button was clicked).</span></span> <span data-ttu-id="fc499-156">按鈕、LinkButton 和 ImageButton 提供兩個屬性，其值會傳遞至 `ItemCommand` 事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="fc499-156">The Button, LinkButton, and ImageButton provide two properties whose values are passed to the `ItemCommand` event handler:</span></span>

- <span data-ttu-id="fc499-157">`CommandName` 通常用來識別範本中每個按鈕的字串</span><span class="sxs-lookup"><span data-stu-id="fc499-157">`CommandName` a string typically used to identify each button in the template</span></span>
- <span data-ttu-id="fc499-158">`CommandArgument` 通常用來保存某些資料欄位的值，例如主要金鑰值</span><span class="sxs-lookup"><span data-stu-id="fc499-158">`CommandArgument` commonly used to hold the value of some data field, such as the primary key value</span></span>

<span data-ttu-id="fc499-159">在此範例中，請將 LinkButton 的 `CommandName` 屬性設定為 ShowProducts，並使用資料系結語法 `CategoryArgument='<%# Eval("CategoryID") %>'`，將目前的記錄 s 主要金鑰值 `CategoryID` 系結至 `CommandArgument` 的屬性。</span><span class="sxs-lookup"><span data-stu-id="fc499-159">For this example, set the LinkButton s `CommandName` property to ShowProducts and bind the current record s primary key value `CategoryID` to the `CommandArgument` property using the databinding syntax `CategoryArgument='<%# Eval("CategoryID") %>'`.</span></span> <span data-ttu-id="fc499-160">指定這兩個屬性之後，LinkButton 的宣告式語法應如下所示：</span><span class="sxs-lookup"><span data-stu-id="fc499-160">After specifying these two properties, the LinkButton s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](custom-buttons-in-the-datalist-and-repeater-cs/samples/sample3.aspx)]

<span data-ttu-id="fc499-161">按一下按鈕時，就會發生回傳，而 DataList 或中繼器 `ItemCommand` 事件會引發。</span><span class="sxs-lookup"><span data-stu-id="fc499-161">When the button is clicked, a postback occurs and the DataList or Repeater s `ItemCommand` event fires.</span></span> <span data-ttu-id="fc499-162">事件處理常式會傳遞按鈕 s `CommandName` 並 `CommandArgument` 值。</span><span class="sxs-lookup"><span data-stu-id="fc499-162">The event handler is passed the button s `CommandName` and `CommandArgument` values.</span></span>

<span data-ttu-id="fc499-163">建立中繼器 `ItemCommand` 事件的事件處理常式，並記下傳遞至事件處理常式的第二個參數（名為 `e`）。</span><span class="sxs-lookup"><span data-stu-id="fc499-163">Create an event handler for the Repeater s `ItemCommand` event and note the second parameter passed into the event handler (named `e`).</span></span> <span data-ttu-id="fc499-164">第二個參數的類型是[`RepeaterCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeatercommandeventargs.aspx) ，而且具有下列四個屬性：</span><span class="sxs-lookup"><span data-stu-id="fc499-164">This second parameter is of type [`RepeaterCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeatercommandeventargs.aspx) and has the following four properties:</span></span>

- <span data-ttu-id="fc499-165">`CommandArgument` 已按下按鈕 `CommandArgument` 屬性的值</span><span class="sxs-lookup"><span data-stu-id="fc499-165">`CommandArgument` the value of the clicked button s `CommandArgument` property</span></span>
- <span data-ttu-id="fc499-166">`CommandName` 按鈕 `CommandName` 屬性的值</span><span class="sxs-lookup"><span data-stu-id="fc499-166">`CommandName` the value of the button s `CommandName` property</span></span>
- <span data-ttu-id="fc499-167">`CommandSource` 已按下的按鈕控制項的參考</span><span class="sxs-lookup"><span data-stu-id="fc499-167">`CommandSource` a reference to the button control that was clicked</span></span>
- <span data-ttu-id="fc499-168">`Item` [`RepeaterItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeateritem.aspx)的參考，其中包含已按下的按鈕;系結至中繼器的每一筆記錄都是以 `RepeaterItem`</span><span class="sxs-lookup"><span data-stu-id="fc499-168">`Item` a reference to the [`RepeaterItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeateritem.aspx) that contains the button that was clicked; each record bound to the Repeater is manifested as a `RepeaterItem`</span></span>

<span data-ttu-id="fc499-169">因為選取的類別目錄 `CategoryID` 是透過 `CommandArgument` 屬性傳入，所以我們可以在 `ItemCommand` 事件處理常式中，取得與所選分類相關聯的產品集合。</span><span class="sxs-lookup"><span data-stu-id="fc499-169">Since the selected category s `CategoryID` is passed in via the `CommandArgument` property, we can get the set of products associated with the selected category in the `ItemCommand` event handler.</span></span> <span data-ttu-id="fc499-170">這些產品接著可以系結至 `ItemTemplate` 中的 BulletedList 控制項（我們尚未新增）。</span><span class="sxs-lookup"><span data-stu-id="fc499-170">These products can then be bound to a BulletedList control in the `ItemTemplate` (which we ve yet to add).</span></span> <span data-ttu-id="fc499-171">剩下的就是新增 BulletedList，在 `ItemCommand` 事件處理常式中參考它，然後系結至所選類別的一組產品，我們將在步驟4中解決。</span><span class="sxs-lookup"><span data-stu-id="fc499-171">All that remains, then, is to add the BulletedList, reference it in the `ItemCommand` event handler, and bind to it the set of products for the selected category, which we'll tackle in Step 4.</span></span>

> [!NOTE]
> <span data-ttu-id="fc499-172">DataList s `ItemCommand` 事件處理常式會傳遞[`DataListCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistcommandeventargs.aspx)類型的物件，這會提供與 `RepeaterCommandEventArgs` 類別相同的四個屬性。</span><span class="sxs-lookup"><span data-stu-id="fc499-172">The DataList s `ItemCommand` event handler is passed an object of type [`DataListCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistcommandeventargs.aspx), which offers the same four properties as the `RepeaterCommandEventArgs` class.</span></span>

## <a name="step-4-displaying-the-selected-category-s-products-in-a-bulleted-list"></a><span data-ttu-id="fc499-173">步驟4：在項目符號清單中顯示選取的類別 s 產品</span><span class="sxs-lookup"><span data-stu-id="fc499-173">Step 4: Displaying the Selected Category s Products in a Bulleted List</span></span>

<span data-ttu-id="fc499-174">選取的類別目錄產品可以使用任意數目的控制項顯示在中繼器 `ItemTemplate` 內。</span><span class="sxs-lookup"><span data-stu-id="fc499-174">The selected category s products can be displayed within the Repeater s `ItemTemplate` using any number of controls.</span></span> <span data-ttu-id="fc499-175">我們可以加入另一個嵌套的中繼器、DataList、DropDownList、GridView 等等。</span><span class="sxs-lookup"><span data-stu-id="fc499-175">We could add another nested Repeater, a DataList, a DropDownList, a GridView, and so on.</span></span> <span data-ttu-id="fc499-176">不過，因為我們想要將產品顯示為項目符號清單，所以我們將使用 BulletedList 控制項。</span><span class="sxs-lookup"><span data-stu-id="fc499-176">Since we want to display the products as a bulleted list, though, we'll use the BulletedList control.</span></span> <span data-ttu-id="fc499-177">回到 `CustomButtons.aspx` 頁面的宣告式標記，將 BulletedList 控制項新增至 顯示產品 LinkButton 之後的 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="fc499-177">Returning to the `CustomButtons.aspx` page s declarative markup, add a BulletedList control to the `ItemTemplate` after the Show Products LinkButton.</span></span> <span data-ttu-id="fc499-178">將 BulletedLists s `ID` 設定為 `ProductsInCategory`。</span><span class="sxs-lookup"><span data-stu-id="fc499-178">Set the BulletedLists s `ID` to `ProductsInCategory`.</span></span> <span data-ttu-id="fc499-179">BulletedList 會顯示透過 `DataTextField` 屬性指定的資料欄位值。由於此控制項將會系結產品資訊，因此請將 `DataTextField` 屬性設為 `ProductName`。</span><span class="sxs-lookup"><span data-stu-id="fc499-179">The BulletedList displays the value of the data field specified via the `DataTextField` property; since this control will have product information bound to it, set the `DataTextField` property to `ProductName`.</span></span>

[!code-aspx[Main](custom-buttons-in-the-datalist-and-repeater-cs/samples/sample4.aspx)]

<span data-ttu-id="fc499-180">在 `ItemCommand` 事件處理常式中，使用 `e.Item.FindControl("ProductsInCategory")` 參考此控制項，並將它系結至與所選分類相關聯的產品集合。</span><span class="sxs-lookup"><span data-stu-id="fc499-180">In the `ItemCommand` event handler, reference this control using `e.Item.FindControl("ProductsInCategory")` and bind it to the set of products associated with the selected category.</span></span>

[!code-csharp[Main](custom-buttons-in-the-datalist-and-repeater-cs/samples/sample5.cs)]

<span data-ttu-id="fc499-181">在 `ItemCommand` 事件處理常式中執行任何動作之前，最好先檢查傳入 `CommandName`的值。</span><span class="sxs-lookup"><span data-stu-id="fc499-181">Before performing any action in the `ItemCommand` event handler, it s prudent to first check the value of the incoming `CommandName`.</span></span> <span data-ttu-id="fc499-182">由於在按一下*任何*按鈕時，會引發 `ItemCommand` 事件處理常式，因此，如果範本中有多個按鈕，請使用 `CommandName` 值來辨別要採取的動作。</span><span class="sxs-lookup"><span data-stu-id="fc499-182">Since the `ItemCommand` event handler fires when *any* button is clicked, if there are multiple buttons in the template use the `CommandName` value to discern what action to take.</span></span> <span data-ttu-id="fc499-183">在這裡檢查 `CommandName` 是想法，因為我們只有一個按鈕，但最好是建立表單的習慣。</span><span class="sxs-lookup"><span data-stu-id="fc499-183">Checking the `CommandName` here is moot, since we only have a single button, but it is a good habit to form.</span></span> <span data-ttu-id="fc499-184">接下來，會從 `CommandArgument` 屬性中抓取所選類別的 `CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="fc499-184">Next, the `CategoryID` of the selected category is retrieved from the `CommandArgument` property.</span></span> <span data-ttu-id="fc499-185">然後會參考範本中的 BulletedList 控制項，並將其系結至 `ProductsBLL` 類別 s `GetProductsByCategoryID(categoryID)` 方法的結果。</span><span class="sxs-lookup"><span data-stu-id="fc499-185">The BulletedList control in the template is then referenced and bound to the results of the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span>

<span data-ttu-id="fc499-186">在先前的教學課程中，使用 DataList 中的按鈕，例如在[datalist 中編輯和刪除資料的總覽](../editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)，我們已透過 `DataKeys` 集合判斷出給定專案的主要索引鍵值。</span><span class="sxs-lookup"><span data-stu-id="fc499-186">In previous tutorials that used the buttons within a DataList, such as [An Overview of Editing and Deleting Data in the DataList](../editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md), we determined the primary key value of a given item via the `DataKeys` collection.</span></span> <span data-ttu-id="fc499-187">雖然這種方法適用于 DataList，但中繼器並沒有 `DataKeys` 的屬性。</span><span class="sxs-lookup"><span data-stu-id="fc499-187">While this approach works well with the DataList, the Repeater does not have a `DataKeys` property.</span></span> <span data-ttu-id="fc499-188">相反地，我們必須使用替代方法來提供主鍵值，例如透過按鈕的 `CommandArgument` 屬性，或將主要索引鍵值指派給範本內的隱藏標籤 Web 控制項，並使用 `e.Item.FindControl("LabelID")`在 `ItemCommand` 事件處理常式中讀取其值。</span><span class="sxs-lookup"><span data-stu-id="fc499-188">Instead, we must use an alternative approach for supplying the primary key value, such as through the button s `CommandArgument` property or by assigning the primary key value to a hidden Label Web control within the template and reading its value back in the `ItemCommand` event handler using `e.Item.FindControl("LabelID")`.</span></span>

<span data-ttu-id="fc499-189">完成 `ItemCommand` 事件處理常式之後，請花點時間在瀏覽器中測試此頁面。</span><span class="sxs-lookup"><span data-stu-id="fc499-189">After completing the `ItemCommand` event handler, take a moment to test out this page in a browser.</span></span> <span data-ttu-id="fc499-190">如 [圖 7] 所示，按一下 [顯示產品] 連結會導致回傳，並在 BulletedList 中顯示所選取類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="fc499-190">As Figure 7 shows, clicking the Show Products link causes a postback and displays the products for the selected category in a BulletedList.</span></span> <span data-ttu-id="fc499-191">此外，也請注意，即使按一下其他類別顯示產品連結，此產品資訊仍會保留。</span><span class="sxs-lookup"><span data-stu-id="fc499-191">Furthermore, note that this product information remains, even if other categories Show Products links are clicked.</span></span>

> [!NOTE]
> <span data-ttu-id="fc499-192">如果您想要修改此報告的行為，只會列出一次一個類別目錄的產品，只要將 [BulletedList 控制項] `EnableViewState` 屬性設定為 [`False`] 即可。</span><span class="sxs-lookup"><span data-stu-id="fc499-192">If you want to modify the behavior of this report, such that the only one category s products are listed at a time, simply set the BulletedList control s `EnableViewState` property to `False`.</span></span>

<span data-ttu-id="fc499-193">[![使用 BulletedList 來顯示所選類別目錄的產品](custom-buttons-in-the-datalist-and-repeater-cs/_static/image16.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="fc499-193">[![A BulletedList is used to Display the Products of the Selected Category](custom-buttons-in-the-datalist-and-repeater-cs/_static/image16.png)](custom-buttons-in-the-datalist-and-repeater-cs/_static/image15.png)</span></span>

<span data-ttu-id="fc499-194">**圖 7**： BulletedList 用來顯示所選類別的產品（[按一下以觀看完整大小的影像](custom-buttons-in-the-datalist-and-repeater-cs/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="fc499-194">**Figure 7**: A BulletedList is used to Display the Products of the Selected Category ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-cs/_static/image17.png))</span></span>

## <a name="summary"></a><span data-ttu-id="fc499-195">總結</span><span class="sxs-lookup"><span data-stu-id="fc499-195">Summary</span></span>

<span data-ttu-id="fc499-196">DataList 和中繼器控制項可以在其範本中包含任意數目的按鈕、LinkButtons 或 ImageButtons。</span><span class="sxs-lookup"><span data-stu-id="fc499-196">The DataList and Repeater controls can include any number of Buttons, LinkButtons, or ImageButtons within their templates.</span></span> <span data-ttu-id="fc499-197">按一下這類按鈕時，會導致回傳並引發 `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="fc499-197">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event.</span></span> <span data-ttu-id="fc499-198">若要將自訂伺服器端動作與按一下的按鈕產生關聯，請建立 `ItemCommand` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="fc499-198">To associate custom server-side action with a button being clicked, create an event handler for the `ItemCommand` event.</span></span> <span data-ttu-id="fc499-199">在此事件處理常式中，會先檢查傳入的 `CommandName` 值，以判斷所按的按鈕。</span><span class="sxs-lookup"><span data-stu-id="fc499-199">In this event handler first check the incoming `CommandName` value to determine which button was clicked.</span></span> <span data-ttu-id="fc499-200">您可以選擇性地透過按鈕 `CommandArgument` 屬性來提供其他資訊。</span><span class="sxs-lookup"><span data-stu-id="fc499-200">Additional information can optionally be supplied through the button s `CommandArgument` property.</span></span>

<span data-ttu-id="fc499-201">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="fc499-201">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="fc499-202">關於作者</span><span class="sxs-lookup"><span data-stu-id="fc499-202">About the Author</span></span>

<span data-ttu-id="fc499-203">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="fc499-203">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="fc499-204">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="fc499-204">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="fc499-205">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="fc499-205">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="fc499-206">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fc499-206">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="fc499-207">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="fc499-207">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="fc499-208">特別感謝</span><span class="sxs-lookup"><span data-stu-id="fc499-208">Special Thanks To</span></span>

<span data-ttu-id="fc499-209">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="fc499-209">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="fc499-210">本教學課程的領導審查者為 Dennis Patterson。</span><span class="sxs-lookup"><span data-stu-id="fc499-210">Lead reviewer for this tutorial was Dennis Patterson.</span></span> <span data-ttu-id="fc499-211">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="fc499-211">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="fc499-212">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fc499-212">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="fc499-213">下一步</span><span class="sxs-lookup"><span data-stu-id="fc499-213">Next</span></span>](custom-buttons-in-the-datalist-and-repeater-vb.md)
