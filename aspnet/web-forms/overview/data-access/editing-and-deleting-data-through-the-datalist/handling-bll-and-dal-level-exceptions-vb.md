---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: 處理 BLL 和 DAL 層級例外狀況 (VB) |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們會看到如何巧妙地向處理可編輯的 DataList 更新工作流程期間引發的例外狀況。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 5108c1f04d73da4ce236fd0a872e0f64b82cbafa
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/06/2019
ms.locfileid: "65119575"
---
# <a name="handling-bll--and-dal-level-exceptions-vb"></a><span data-ttu-id="89f0e-103">處理 BLL 和 DAL 層級的例外狀況 (VB)</span><span class="sxs-lookup"><span data-stu-id="89f0e-103">Handling BLL- and DAL-Level Exceptions (VB)</span></span>

<span data-ttu-id="89f0e-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="89f0e-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="89f0e-105">[下載範例應用程式](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe)或[下載 PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="89f0e-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span></span>

> <span data-ttu-id="89f0e-106">在本教學課程中，我們會看到如何巧妙地向處理可編輯的 DataList 更新工作流程期間引發的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>

## <a name="introduction"></a><span data-ttu-id="89f0e-107">簡介</span><span class="sxs-lookup"><span data-stu-id="89f0e-107">Introduction</span></span>

<span data-ttu-id="89f0e-108">在 [概觀的編輯和刪除資料 DataList 中](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)教學課程中，我們會建立簡單的編輯和刪除功能形式提供給 DataList。</span><span class="sxs-lookup"><span data-stu-id="89f0e-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="89f0e-109">完整運作，這是不太方便使用，以在編輯期間發生任何錯誤，或刪除處理程序造成未處理的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="89f0e-110">比方說，省略 s 產品名稱，或當您編輯產品，輸入的價格值非常實惠 ！，則會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="89f0e-111">程式碼中攔截不到這個例外狀況，因為它會顯示最多 ASP.NET 執行階段，然後在網頁中顯示的 s 的例外狀況詳細資料。</span><span class="sxs-lookup"><span data-stu-id="89f0e-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="89f0e-112">如我們在中所見[處理 BLL 和 DAL 層級例外狀況，在 ASP.NET 網頁](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)教學課程中，如果從深海帶上來的商務邏輯或資料存取層級，會引發例外狀況的例外狀況詳細資料都會回到 ObjectDataSource 和然後至 GridView。</span><span class="sxs-lookup"><span data-stu-id="89f0e-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="89f0e-113">我們了解如何依正常程序建立處理這些例外狀況`Updated`或`RowUpdated`ObjectDataSource 或 GridView，檢查例外狀況，以及指出 已處理例外狀況的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89f0e-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="89f0e-114">不過，我們 DataList 教學課程中，不使用 ObjectDataSource 的更新和刪除資料。</span><span class="sxs-lookup"><span data-stu-id="89f0e-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="89f0e-115">相反地，我們正努力直接針對 BLL。</span><span class="sxs-lookup"><span data-stu-id="89f0e-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="89f0e-116">若要偵測源自於 BLL 或 DAL 的例外狀況，我們要實作例外狀況處理程式碼後置我們的 ASP.NET 網頁中的程式碼。</span><span class="sxs-lookup"><span data-stu-id="89f0e-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="89f0e-117">在本教學課程中，我們會看到如何更巧妙地向處理可編輯的 DataList s，正在更新工作流程期間引發的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="89f0e-118">在 *概觀的編輯和刪除資料 DataList*更新使用 ObjectDataSource 教學課程中我們討論過編輯和刪除資料 DataList 的不同技術，一些技巧，涉及和正在刪除。</span><span class="sxs-lookup"><span data-stu-id="89f0e-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="89f0e-119">如果您採用這些技術，您可以處理從 DAL 的 BLL 透過 ObjectDataSource s 的例外狀況`Updated`或`Deleted`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89f0e-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>

## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="89f0e-120">步驟 1：建立可編輯的資料清單</span><span class="sxs-lookup"><span data-stu-id="89f0e-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="89f0e-121">我們會擔心處理更新的工作流程期間發生的例外狀況之前，讓第一次建立可編輯的 DataList。</span><span class="sxs-lookup"><span data-stu-id="89f0e-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="89f0e-122">開啟`ErrorHandling.aspx`頁面中`EditDeleteDataList`資料夾中，DataList 加入設計工具中，設定其`ID`屬性設`Products`，並新增名為新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="89f0e-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="89f0e-123">設定要使用 ObjectDataSource`ProductsBLL`類別的`GetProducts()`選取方法會記錄; 設定下拉式清單中的插入、 更新和刪除索引標籤為 （無）。</span><span class="sxs-lookup"><span data-stu-id="89f0e-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="89f0e-124">[![傳回使用 GetProducts() 方法的產品資訊](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="89f0e-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span></span>

<span data-ttu-id="89f0e-125">**圖 1**:傳回產品資訊使用`GetProducts()`方法 ([按一下以檢視完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="89f0e-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="89f0e-126">完成 ObjectDataSource 精靈之後，Visual Studio 會自動建立`ItemTemplate`的 DataList。</span><span class="sxs-lookup"><span data-stu-id="89f0e-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="89f0e-127">將此取代為`ItemTemplate`，顯示每個產品的名稱和價格，並包含 [編輯] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="89f0e-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="89f0e-128">接下來，建立`EditItemTemplate`與 TextBox Web 控制項的名稱和價格和更新 和 取消 按鈕。</span><span class="sxs-lookup"><span data-stu-id="89f0e-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="89f0e-129">最後，設定 DataList 的`RepeatColumns`屬性設為 2。</span><span class="sxs-lookup"><span data-stu-id="89f0e-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="89f0e-130">這些變更之後，請頁面 s 的宣告式標記看起來應該如下所示。</span><span class="sxs-lookup"><span data-stu-id="89f0e-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="89f0e-131">若要進行特定的編輯，也就是 [取消]，請仔細檢查和更新的按鈕有其`CommandName`編輯、 取消，並更新，請分別設定的屬性。</span><span class="sxs-lookup"><span data-stu-id="89f0e-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="89f0e-132">在本教學課程 DataList 必須啟用 s 檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="89f0e-132">For this tutorial the DataList s view state must be enabled.</span></span>

<span data-ttu-id="89f0e-133">請花一點時間檢閱我們的進度，透過瀏覽器 （請參閱 圖 2）。</span><span class="sxs-lookup"><span data-stu-id="89f0e-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>

<span data-ttu-id="89f0e-134">[![每一個產品包含 [編輯] 按鈕](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="89f0e-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span></span>

<span data-ttu-id="89f0e-135">**圖 2**:每一個產品包含 [編輯] 按鈕 ([按一下以檢視完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="89f0e-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span></span>

<span data-ttu-id="89f0e-136">目前，[編輯] 按鈕只會造成回傳它不 t 尚未讓產品可供編輯。</span><span class="sxs-lookup"><span data-stu-id="89f0e-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="89f0e-137">若要啟用編輯，我們需要建立事件處理常式 DataList s `EditCommand`， `CancelCommand`，和`UpdateCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="89f0e-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="89f0e-138">`EditCommand`並`CancelCommand`事件只會更新 DataList 的`EditItemIndex`屬性和重新繫結至 DataList 的資料：</span><span class="sxs-lookup"><span data-stu-id="89f0e-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="89f0e-139">`UpdateCommand`事件處理常式會稍微複雜一點。</span><span class="sxs-lookup"><span data-stu-id="89f0e-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="89f0e-140">它需要讀取已編輯的產品 s`ProductID`從`DataKeys`集合，以及產品的名稱和價格與中的文字方塊`EditItemTemplate`，然後呼叫`ProductsBLL`類別的`UpdateProduct`方法，再傳回 DataList為其預先編輯的狀態。</span><span class="sxs-lookup"><span data-stu-id="89f0e-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="89f0e-141">現在，讓 s 只使用完全相同的程式碼，從`UpdateCommand`中的事件處理常式*概觀的編輯和刪除資料 DataList 中*教學課程。</span><span class="sxs-lookup"><span data-stu-id="89f0e-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="89f0e-142">我們將新增程式碼來依正常程序處理步驟 2 中的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="89f0e-143">發生無效的輸入可以是格式不正確的單價、 不合法的單位價格值會類似-$5.00 或省略的產品名稱，將會引發例外狀況的表單中。</span><span class="sxs-lookup"><span data-stu-id="89f0e-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="89f0e-144">因為`UpdateCommand`事件處理常式不包含任何例外狀況處理程式碼，此時，例外狀況會反昇至 ASP.NET 執行階段，它顯示給使用者 （請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="89f0e-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>

![發生未處理的例外狀況時，使用者會看到錯誤頁面](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

<span data-ttu-id="89f0e-146">**圖 3**:發生未處理的例外狀況時，使用者會看到錯誤頁面</span><span class="sxs-lookup"><span data-stu-id="89f0e-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>

## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="89f0e-147">步驟 2：依正常程序中處理例外狀況的 UpdateCommand 事件處理常式</span><span class="sxs-lookup"><span data-stu-id="89f0e-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="89f0e-148">在更新的工作流程期間發生例外狀況可以`UpdateCommand`DAL、 BLL 或事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89f0e-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="89f0e-149">比方說，如果使用者輸入的價格為太昂貴`Decimal.Parse`中的陳述式`UpdateCommand`事件處理常式將會擲回`FormatException`例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="89f0e-150">如果在使用者遺漏產品的名稱或價格的值是負數，DAL 會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="89f0e-151">發生例外狀況時，我們想要顯示資訊訊息本身在頁面中。</span><span class="sxs-lookup"><span data-stu-id="89f0e-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="89f0e-152">新增標籤網頁控制項至網頁`ID`設為`ExceptionDetails`。</span><span class="sxs-lookup"><span data-stu-id="89f0e-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="89f0e-153">設定要以紅色顯示，超大型，藉由指定粗體和斜體字型的標籤的文字及其`CssClass`屬性，以`Warning`CSS 類別，其定義於`Styles.css`檔案。</span><span class="sxs-lookup"><span data-stu-id="89f0e-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="89f0e-154">發生錯誤時，我們只想要一次顯示的標籤。</span><span class="sxs-lookup"><span data-stu-id="89f0e-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="89f0e-155">也就是說，在後續回傳時，標籤的警告訊息應該會消失。</span><span class="sxs-lookup"><span data-stu-id="89f0e-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="89f0e-156">這可藉由任一個清除標籤 s`Text`屬性或設定其`Visible`屬性設`False`中`Page_Load`事件處理常式 (如同我們在上一步[處理 BLL 和 DAL 層級在 ASP 中的例外狀況.NET 頁面](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)教學課程)，或者停用標籤的檢視狀態的支援。</span><span class="sxs-lookup"><span data-stu-id="89f0e-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="89f0e-157">可讓 s 使用後面這個選項。</span><span class="sxs-lookup"><span data-stu-id="89f0e-157">Let s use the latter option.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

<span data-ttu-id="89f0e-158">當引發例外狀況時，我們將指派的例外狀況的詳細資料`ExceptionDetails`標籤控制項的`Text`屬性。</span><span class="sxs-lookup"><span data-stu-id="89f0e-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="89f0e-159">因為其檢視狀態已停用，在後續回傳時`Text`屬性 s 以程式設計方式變更將會遺失，再還原至預設文字 （空字串），藉此隱藏的警告訊息。</span><span class="sxs-lookup"><span data-stu-id="89f0e-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="89f0e-160">若要判斷為了幫助的訊息顯示在頁面上引發錯誤，我們需要加入`Try ... Catch`封鎖`UpdateCommand`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89f0e-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="89f0e-161">`Try`部分包含程式碼，可能會導致例外狀況，而`Catch`區塊包含在例外狀況下執行的程式碼。</span><span class="sxs-lookup"><span data-stu-id="89f0e-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="89f0e-162">請參閱[例外狀況處理基本概念](https://msdn.microsoft.com/library/2w8f0bss.aspx)一節中的.NET Framework 文件，如需詳細資訊，在`Try ... Catch`區塊。</span><span class="sxs-lookup"><span data-stu-id="89f0e-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="89f0e-163">當內的程式碼所擲回任何類型的例外狀況`Try`區塊，`Catch`區塊 s 程式碼會開始執行。</span><span class="sxs-lookup"><span data-stu-id="89f0e-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="89f0e-164">就會擲回的例外狀況的類型`DbException`， `NoNullAllowedException`， `ArgumentException`，並依此類推，取決於內容、 在第一時間導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="89f0e-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="89f0e-165">如果在資料庫層級中，那里的問題`DbException`就會擲回。</span><span class="sxs-lookup"><span data-stu-id="89f0e-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="89f0e-166">如果輸入不合法的值`UnitPrice`， `UnitsInStock`， `UnitsOnOrder`，或`ReorderLevel`欄位`ArgumentException`將會擲回，我們加入程式碼，以驗證這些欄位值`ProductsDataTable`類別 (請參閱[建立商業邏輯層](../introduction/creating-a-business-logic-layer-vb.md)教學課程)。</span><span class="sxs-lookup"><span data-stu-id="89f0e-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span></span>

<span data-ttu-id="89f0e-167">我們可以攔截到例外狀況的類型為基礎的訊息文字，使用者提供更有用的說明。</span><span class="sxs-lookup"><span data-stu-id="89f0e-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="89f0e-168">下列程式碼幾乎完全相同的表單中用年代[處理 BLL 和 DAL 層級例外狀況，在 ASP.NET 網頁](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)教學課程提供此詳細層級：</span><span class="sxs-lookup"><span data-stu-id="89f0e-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial provides this level of detail:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

<span data-ttu-id="89f0e-169">若要完成本教學課程中，只要呼叫`DisplayExceptionDetails`方法，從`Catch`區塊中攔截到傳遞`Exception`執行個體 (`ex`)。</span><span class="sxs-lookup"><span data-stu-id="89f0e-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="89f0e-170">使用`Try ... Catch`就地區塊中，使用者會使用更具參考性的錯誤訊息，以數字 4 和 5 的顯示。</span><span class="sxs-lookup"><span data-stu-id="89f0e-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="89f0e-171">請注意，面對 DataList 例外狀況會保留在編輯模式。</span><span class="sxs-lookup"><span data-stu-id="89f0e-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="89f0e-172">這是因為在控制流程之後發生的例外狀況，立即重新導向至`Catch`區塊，並略過 DataList 回到預先編輯狀態的程式碼。</span><span class="sxs-lookup"><span data-stu-id="89f0e-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="89f0e-173">[![如果使用者遺漏必要的欄位，就會顯示一則錯誤訊息](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="89f0e-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span></span>

<span data-ttu-id="89f0e-174">**圖 4**:如果使用者遺漏必要的欄位，就會顯示一則錯誤訊息 ([按一下以檢視完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="89f0e-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span></span>

<span data-ttu-id="89f0e-175">[![錯誤訊息會顯示當輸入是負的價格](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="89f0e-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span></span>

<span data-ttu-id="89f0e-176">**圖 5**:錯誤訊息會顯示當輸入是負的價格 ([按一下以檢視完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="89f0e-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span></span>

## <a name="summary"></a><span data-ttu-id="89f0e-177">總結</span><span class="sxs-lookup"><span data-stu-id="89f0e-177">Summary</span></span>

<span data-ttu-id="89f0e-178">GridView 和 ObjectDataSource 提供後置的層級的事件處理常式，包括任何更新和刪除工作流程期間所引發的例外狀況，以及可以表示例外狀況已經過設定屬性的相關資訊處理。</span><span class="sxs-lookup"><span data-stu-id="89f0e-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="89f0e-179">這些功能，不過，則無法使用時使用 DataList 與直接使用 BLL。</span><span class="sxs-lookup"><span data-stu-id="89f0e-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="89f0e-180">相反地，我們會負責實作例外狀況處理。</span><span class="sxs-lookup"><span data-stu-id="89f0e-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="89f0e-181">在本教學課程中，我們看到如何新增例外狀況處理來更新工作流程，藉由新增一個可編輯 DataList s`Try ... Catch`封鎖`UpdateCommand`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89f0e-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="89f0e-182">如果在更新的工作流程期間引發例外狀況`Catch`區塊 s 程式碼執行時，顯示有用的資訊在`ExceptionDetails`標籤。</span><span class="sxs-lookup"><span data-stu-id="89f0e-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="89f0e-183">此時，DataList 一概不會以防止在第一時間發生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89f0e-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="89f0e-184">即使我們已經知道負的價格將會導致例外狀況，我們還沒有尚未新增任何功能來主動防止使用者輸入這類無效的輸入。</span><span class="sxs-lookup"><span data-stu-id="89f0e-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="89f0e-185">在我們的下一個教學課程中，我們將看到如何協助減少將驗證控制項中的加入無效的使用者輸入所造成的例外狀況`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="89f0e-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="89f0e-186">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="89f0e-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="89f0e-187">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="89f0e-187">Further Reading</span></span>

<span data-ttu-id="89f0e-188">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="89f0e-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="89f0e-189">例外狀況的設計方針</span><span class="sxs-lookup"><span data-stu-id="89f0e-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="89f0e-190">[錯誤記錄模組和處理常式 (ELMAH)](http://workspaces.gotdotnet.com/elmah) （記錄錯誤的開放原始碼程式庫）</span><span class="sxs-lookup"><span data-stu-id="89f0e-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="89f0e-191">[Enterprise Library for.NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) （包括例外狀況管理應用程式區塊）</span><span class="sxs-lookup"><span data-stu-id="89f0e-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="89f0e-192">關於作者</span><span class="sxs-lookup"><span data-stu-id="89f0e-192">About the Author</span></span>

<span data-ttu-id="89f0e-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="89f0e-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="89f0e-194">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="89f0e-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="89f0e-195">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="89f0e-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="89f0e-196">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="89f0e-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="89f0e-197">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="89f0e-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="89f0e-198">特別感謝</span><span class="sxs-lookup"><span data-stu-id="89f0e-198">Special Thanks To</span></span>

<span data-ttu-id="89f0e-199">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="89f0e-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="89f0e-200">本教學課程中的潛在客戶檢閱者已 Ken Pespisa。</span><span class="sxs-lookup"><span data-stu-id="89f0e-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="89f0e-201">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="89f0e-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="89f0e-202">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="89f0e-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="89f0e-203">[上一頁](performing-batch-updates-vb.md)
> [下一頁](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="89f0e-203">[Previous](performing-batch-updates-vb.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span></span>
