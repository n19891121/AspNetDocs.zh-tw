---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: 處理 BLL 和 DAL 層級的例外狀況（VB） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將瞭解如何 tactfully 處理在可編輯的 DataList 更新工作流程期間引發的例外狀況。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 319ab44f2e65afc77f6f89ca8aa58c529f40d05c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78593664"
---
# <a name="handling-bll--and-dal-level-exceptions-vb"></a><span data-ttu-id="8a6df-103">處理 BLL 和 DAL 層級的例外狀況 (VB)</span><span class="sxs-lookup"><span data-stu-id="8a6df-103">Handling BLL- and DAL-Level Exceptions (VB)</span></span>

<span data-ttu-id="8a6df-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8a6df-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8a6df-105">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe)或[下載 PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8a6df-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span></span>

> <span data-ttu-id="8a6df-106">在本教學課程中，我們將瞭解如何 tactfully 處理在可編輯的 DataList 更新工作流程期間引發的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>

## <a name="introduction"></a><span data-ttu-id="8a6df-107">簡介</span><span class="sxs-lookup"><span data-stu-id="8a6df-107">Introduction</span></span>

<span data-ttu-id="8a6df-108">在 DataList 教學課程中[編輯和刪除資料的總覽](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)中，我們建立了一個 DataList，提供簡單的編輯和刪除功能。</span><span class="sxs-lookup"><span data-stu-id="8a6df-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="8a6df-109">雖然功能完整，但使用者並不容易使用，因為在編輯或刪除程式期間發生的任何錯誤都會導致未處理的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="8a6df-110">例如，省略產品的名稱，或在編輯產品時，輸入非常實惠的價格值！會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="8a6df-111">由於此例外狀況不會在程式碼中攔截，因此會反升至 ASP.NET 執行時間，然後在網頁中顯示例外狀況的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="8a6df-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="8a6df-112">如同在[ASP.NET 網頁中處理 BLL 和 DAL 層級的例外](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)狀況教學課程中所見，如果從商務邏輯或資料存取層的深度引發例外狀況，例外狀況詳細資料會傳回給 ObjectDataSource，然後再傳給 GridView。</span><span class="sxs-lookup"><span data-stu-id="8a6df-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="8a6df-113">我們已瞭解如何藉由建立 ObjectDataSource 或 GridView 的 `Updated` 或 `RowUpdated` 事件處理常式、檢查是否有例外狀況，然後指出是否已處理例外狀況，來適當地處理這些例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="8a6df-114">不過，我們的 DataList 教學課程不會使用 ObjectDataSource 來更新和刪除資料。</span><span class="sxs-lookup"><span data-stu-id="8a6df-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="8a6df-115">相反地，我們會直接針對 BLL 進行操作。</span><span class="sxs-lookup"><span data-stu-id="8a6df-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="8a6df-116">為了偵測源自 BLL 或 DAL 的例外狀況，我們需要在 ASP.NET 網頁的程式碼後置中，執行例外狀況處理常式代碼。</span><span class="sxs-lookup"><span data-stu-id="8a6df-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="8a6df-117">在本教學課程中，我們將瞭解如何在可編輯的 DataList s 更新工作流程期間，更 tactfully 處理引發的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="8a6df-118">在 DataList 教學課程中*編輯和刪除資料的總覽*中，我們討論過從 datalist 中編輯和刪除資料的不同技巧，其中包括使用 ObjectDataSource 進行更新和刪除的一些技巧。</span><span class="sxs-lookup"><span data-stu-id="8a6df-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="8a6df-119">如果您採用這些技術，您可以透過 ObjectDataSource `Updated` 或 `Deleted` 事件處理常式，處理來自 BLL 或 DAL 的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>

## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="8a6df-120">步驟1：建立可編輯的 DataList</span><span class="sxs-lookup"><span data-stu-id="8a6df-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="8a6df-121">在我們擔心如何處理更新工作流程期間所發生的例外狀況之前，先建立一個可編輯的 DataList。</span><span class="sxs-lookup"><span data-stu-id="8a6df-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="8a6df-122">開啟 [`EditDeleteDataList`] 資料夾中的 [`ErrorHandling.aspx`] 頁面，將 DataList 新增至設計工具，將其 `ID` 屬性設定為 [`Products`]，然後新增名為 `ProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="8a6df-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="8a6df-123">設定 ObjectDataSource 以使用 `ProductsBLL` 類別 s `GetProducts()` 方法來選取記錄;將 [插入]、[更新] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="8a6df-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="8a6df-124">[![使用 GetProducts （）方法傳回產品資訊](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8a6df-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span></span>

<span data-ttu-id="8a6df-125">**圖 1**：使用 `GetProducts()` 方法傳回產品資訊（[按一下以查看完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="8a6df-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="8a6df-126">完成 ObjectDataSource wizard 之後，Visual Studio 會自動建立 DataList 的 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="8a6df-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="8a6df-127">將此取代為顯示每個產品名稱和價格的 `ItemTemplate`，並包含 [編輯] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8a6df-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="8a6df-128">接下來，建立具有 [名稱] 和 [價格] 和 [更新] 和 [取消] 按鈕之 TextBox Web 控制項的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="8a6df-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="8a6df-129">最後，將 DataList s `RepeatColumns` 屬性設為2。</span><span class="sxs-lookup"><span data-stu-id="8a6df-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="8a6df-130">這些變更之後，您的頁面宣告式標記看起來應該如下所示。</span><span class="sxs-lookup"><span data-stu-id="8a6df-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="8a6df-131">請仔細檢查 [編輯]、[取消] 和 [更新] 按鈕，將其 `CommandName` 屬性分別設定為 [編輯]、[取消] 和 [更新]。</span><span class="sxs-lookup"><span data-stu-id="8a6df-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="8a6df-132">在本教學課程中，必須啟用 DataList s 檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="8a6df-132">For this tutorial the DataList s view state must be enabled.</span></span>

<span data-ttu-id="8a6df-133">請花點時間透過瀏覽器查看進度（請參閱 [圖 2]）。</span><span class="sxs-lookup"><span data-stu-id="8a6df-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>

<span data-ttu-id="8a6df-134">[![每個產品都包含 [編輯] 按鈕](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8a6df-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span></span>

<span data-ttu-id="8a6df-135">**圖 2**：每個產品都包含 [編輯] 按鈕（[按一下以觀看完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="8a6df-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span></span>

<span data-ttu-id="8a6df-136">目前，[編輯] 按鈕只會導致回傳，而不會讓產品變成可編輯狀態。</span><span class="sxs-lookup"><span data-stu-id="8a6df-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="8a6df-137">若要啟用編輯，我們必須建立 DataList s `EditCommand`、`CancelCommand`和 `UpdateCommand` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="8a6df-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="8a6df-138">`EditCommand` 和 `CancelCommand` 事件只會更新 DataList s `EditItemIndex` 屬性，並將資料重新系結至 DataList：</span><span class="sxs-lookup"><span data-stu-id="8a6df-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="8a6df-139">`UpdateCommand` 事件處理常式比較複雜。</span><span class="sxs-lookup"><span data-stu-id="8a6df-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="8a6df-140">它必須從 `DataKeys` 集合中讀取已編輯的產品 `ProductID`，連同 `EditItemTemplate`中文字方塊的產品名稱和價格，然後在將 DataList 傳回其預先編輯狀態之前，先呼叫 `ProductsBLL` 類別的 `UpdateProduct` 方法。</span><span class="sxs-lookup"><span data-stu-id="8a6df-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="8a6df-141">現在，讓我們在 DataList 教學課程中*編輯和刪除資料的總覽*中，使用 `UpdateCommand` 事件處理常式中完全相同的程式碼。</span><span class="sxs-lookup"><span data-stu-id="8a6df-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="8a6df-142">我們會新增程式碼，以正常處理步驟2中的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="8a6df-143">在臉部不正確輸入中，其格式可能不正確、不合法的單位價格值（例如-$5.00），或省略產品的名稱時，將會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="8a6df-144">由於 `UpdateCommand` 事件處理常式在此時不會包含任何例外狀況處理常式代碼，因此例外狀況會反升至 ASP.NET 執行時間，並在其中向終端使用者顯示（請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="8a6df-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>

![當未處理的例外狀況發生時，終端使用者會看到錯誤頁面](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

<span data-ttu-id="8a6df-146">**圖 3**：當發生未處理的例外狀況時，終端使用者會看到錯誤頁面</span><span class="sxs-lookup"><span data-stu-id="8a6df-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>

## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="8a6df-147">步驟2：正常處理 UpdateCommand 事件處理常式中的例外狀況</span><span class="sxs-lookup"><span data-stu-id="8a6df-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="8a6df-148">在更新工作流程期間，例外狀況可能會發生在 `UpdateCommand` 事件處理常式、BLL 或 DAL 中。</span><span class="sxs-lookup"><span data-stu-id="8a6df-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="8a6df-149">例如，如果使用者輸入的價格過高，`UpdateCommand` 事件處理常式中的 `Decimal.Parse` 語句將會擲回 `FormatException` 例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="8a6df-150">如果使用者省略產品的名稱，或如果價格具有負值，則 DAL 會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="8a6df-151">發生例外狀況時，我們想要在頁面本身內顯示資訊訊息。</span><span class="sxs-lookup"><span data-stu-id="8a6df-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="8a6df-152">將 [標籤] Web 控制項新增至頁面，其 `ID` 設定為 [`ExceptionDetails`]。</span><span class="sxs-lookup"><span data-stu-id="8a6df-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="8a6df-153">藉由將標籤的 [`CssClass`] 屬性指派給在 `Styles.css` 檔中定義的 `Warning` CSS 類別，設定要以紅色、超大、粗體和斜體字型顯示的文字。</span><span class="sxs-lookup"><span data-stu-id="8a6df-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="8a6df-154">發生錯誤時，我們只希望標籤顯示一次。</span><span class="sxs-lookup"><span data-stu-id="8a6df-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="8a6df-155">也就是說，在後續回傳時，標籤 s 警告訊息應該會消失。</span><span class="sxs-lookup"><span data-stu-id="8a6df-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="8a6df-156">這可以藉由清除標籤 `Text` 屬性來完成，或將其 `Visible` 屬性設定為 `Page_Load` 事件處理常式中 `False` （如同我們在 ASP.NET 網頁教學課程中[處理 BLL 和 DAL 層級的例外](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)狀況），或停用標籤 s 檢視狀態支援。</span><span class="sxs-lookup"><span data-stu-id="8a6df-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="8a6df-157">讓 s 使用第二個選項。</span><span class="sxs-lookup"><span data-stu-id="8a6df-157">Let s use the latter option.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

<span data-ttu-id="8a6df-158">當引發例外狀況時，我們會將例外狀況的詳細資料指派給 `ExceptionDetails` Label 控制項 s `Text` 屬性。</span><span class="sxs-lookup"><span data-stu-id="8a6df-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="8a6df-159">因為已停用其 view 狀態，所以在後續回傳時，`Text` 屬性 s 程式設計變更將會遺失，並還原為預設文字（空字串），因此會隱藏警告訊息。</span><span class="sxs-lookup"><span data-stu-id="8a6df-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="8a6df-160">若要判斷何時引發錯誤以便在頁面上顯示有用的訊息，我們必須將 `Try ... Catch` 區塊加入 `UpdateCommand` 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="8a6df-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="8a6df-161">`Try` 部分包含可能會導致例外狀況的程式碼，而 `Catch` 區塊包含在發生例外狀況時執行的程式碼。</span><span class="sxs-lookup"><span data-stu-id="8a6df-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="8a6df-162">如需有關 `Try ... Catch` 組塊的詳細資訊，請參閱 .NET Framework 檔中的[例外狀況處理基本](https://msdn.microsoft.com/library/2w8f0bss.aspx)概念一節。</span><span class="sxs-lookup"><span data-stu-id="8a6df-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="8a6df-163">當 `Try` 區塊內的程式碼擲回任何類型的例外狀況時，`Catch` 區塊程式碼就會開始執行。</span><span class="sxs-lookup"><span data-stu-id="8a6df-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="8a6df-164">`DbException`、`NoNullAllowedException`、`ArgumentException`等等所擲回的例外狀況類型，取決於第一次促使錯誤的確切狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="8a6df-165">如果資料庫層級發生問題，則會擲回 `DbException`。</span><span class="sxs-lookup"><span data-stu-id="8a6df-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="8a6df-166">如果為 `UnitPrice`、`UnitsInStock`、`UnitsOnOrder`或 `ReorderLevel` 欄位輸入了不合法的值，將會擲回 `ArgumentException`，因為我們已新增程式碼來驗證 `ProductsDataTable` 類別中的域值（請參閱[建立商務邏輯層](../introduction/creating-a-business-logic-layer-vb.md)教學課程）。</span><span class="sxs-lookup"><span data-stu-id="8a6df-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span></span>

<span data-ttu-id="8a6df-167">我們可以藉由在攔截到的例外狀況類型上建立郵件內文，為使用者提供更實用的說明。</span><span class="sxs-lookup"><span data-stu-id="8a6df-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="8a6df-168">在 ASP.NET 網頁教學課程中，用來[處理 BLL 和 DAL 層級例外](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)狀況的下列程式碼，會提供此層級的詳細資料：</span><span class="sxs-lookup"><span data-stu-id="8a6df-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial provides this level of detail:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

<span data-ttu-id="8a6df-169">若要完成本教學課程，只需要從 `Catch` 區塊呼叫 `DisplayExceptionDetails` 方法，傳入攔截到的 `Exception` 實例（`ex`）。</span><span class="sxs-lookup"><span data-stu-id="8a6df-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="8a6df-170">當 `Try ... Catch` 組塊就緒時，使用者會看到更具資訊性的錯誤訊息，如 [圖 4] 和 [5] 所示。</span><span class="sxs-lookup"><span data-stu-id="8a6df-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="8a6df-171">請注意，在發生例外狀況的情況下，DataList 會維持在編輯模式。</span><span class="sxs-lookup"><span data-stu-id="8a6df-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="8a6df-172">這是因為一旦發生例外狀況，就會立即將控制流程重新導向至 `Catch` 區塊，略過將 DataList 傳回其預先編輯狀態的程式碼。</span><span class="sxs-lookup"><span data-stu-id="8a6df-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="8a6df-173">[![如果使用者省略必要欄位，就會顯示錯誤訊息](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="8a6df-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span></span>

<span data-ttu-id="8a6df-174">**圖 4**：如果使用者省略必要欄位（[按一下以觀看完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image10.png)），就會顯示錯誤訊息</span><span class="sxs-lookup"><span data-stu-id="8a6df-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span></span>

<span data-ttu-id="8a6df-175">[輸入負值時，會顯示 ![錯誤訊息](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="8a6df-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span></span>

<span data-ttu-id="8a6df-176">**圖 5**：輸入負值時，會顯示錯誤訊息（[按一下以查看完整大小的影像](handling-bll-and-dal-level-exceptions-vb/_static/image13.png)）</span><span class="sxs-lookup"><span data-stu-id="8a6df-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span></span>

## <a name="summary"></a><span data-ttu-id="8a6df-177">總結</span><span class="sxs-lookup"><span data-stu-id="8a6df-177">Summary</span></span>

<span data-ttu-id="8a6df-178">GridView 和 ObjectDataSource 提供了後續層級的事件處理常式，其中包含在更新和刪除工作流程期間引發之任何例外狀況的相關資訊，以及可設定來指出是否已有例外狀況的屬性。dps.</span><span class="sxs-lookup"><span data-stu-id="8a6df-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="8a6df-179">不過，這些功能在處理 DataList 並直接使用 BLL 時無法使用。</span><span class="sxs-lookup"><span data-stu-id="8a6df-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="8a6df-180">相反地，我們會負責執行例外狀況處理。</span><span class="sxs-lookup"><span data-stu-id="8a6df-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="8a6df-181">在本教學課程中，我們已瞭解如何藉由將 `Try ... Catch` 區塊加入 `UpdateCommand` 事件處理常式中，將例外狀況處理新增至可編輯的 DataList s 更新工作流程。</span><span class="sxs-lookup"><span data-stu-id="8a6df-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="8a6df-182">如果在更新工作流程期間引發例外狀況，則會執行 `Catch` 區塊 s 程式碼，並在 `ExceptionDetails` 標籤中顯示有用的資訊。</span><span class="sxs-lookup"><span data-stu-id="8a6df-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="8a6df-183">此時，DataList 不會避免發生例外狀況的一開始。</span><span class="sxs-lookup"><span data-stu-id="8a6df-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="8a6df-184">雖然我們知道負的價格會導致例外狀況，但我們尚未新增任何功能，以主動防止使用者輸入這類不正確輸入。</span><span class="sxs-lookup"><span data-stu-id="8a6df-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="8a6df-185">在下一個教學課程中，我們將瞭解如何在 `EditItemTemplate`中新增驗證控制項，以協助減少無效使用者輸入所造成的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="8a6df-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="8a6df-186">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="8a6df-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="8a6df-187">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="8a6df-187">Further Reading</span></span>

<span data-ttu-id="8a6df-188">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="8a6df-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="8a6df-189">例外狀況的設計方針</span><span class="sxs-lookup"><span data-stu-id="8a6df-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="8a6df-190">[錯誤記錄模組和處理常式（ELMAH）](http://workspaces.gotdotnet.com/elmah) （用來記錄錯誤的開放原始碼程式庫）</span><span class="sxs-lookup"><span data-stu-id="8a6df-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="8a6df-191">[適用于 .NET Framework 2.0 的企業程式庫](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en)（包括例外狀況管理應用程式區塊）</span><span class="sxs-lookup"><span data-stu-id="8a6df-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8a6df-192">關於作者</span><span class="sxs-lookup"><span data-stu-id="8a6df-192">About the Author</span></span>

<span data-ttu-id="8a6df-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="8a6df-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8a6df-194">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="8a6df-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8a6df-195">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="8a6df-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8a6df-196">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8a6df-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8a6df-197">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="8a6df-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8a6df-198">特別感謝</span><span class="sxs-lookup"><span data-stu-id="8a6df-198">Special Thanks To</span></span>

<span data-ttu-id="8a6df-199">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="8a6df-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8a6df-200">本教學課程的領導審查者為 Ken Pespisa。</span><span class="sxs-lookup"><span data-stu-id="8a6df-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="8a6df-201">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="8a6df-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8a6df-202">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8a6df-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8a6df-203">[上一頁](performing-batch-updates-vb.md)
> [下一頁](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="8a6df-203">[Previous](performing-batch-updates-vb.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span></span>
