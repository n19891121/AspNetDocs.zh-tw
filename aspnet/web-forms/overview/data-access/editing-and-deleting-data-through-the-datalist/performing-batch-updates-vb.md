---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
title: 執行批次更新（VB） |Microsoft Docs
author: rick-anderson
description: 瞭解如何建立可完全編輯的 DataList，其中所有的專案都處於編輯模式，而其值可透過按一下 [...] 上的 [全部更新] 按鈕來儲存
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 8dac22a7-91de-4e3b-888f-a4c438b03851
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
msc.type: authoredcontent
ms.openlocfilehash: e54c9fc12da278492b54164cf657eea142a3dae6
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78610695"
---
# <a name="performing-batch-updates-vb"></a><span data-ttu-id="88440-103">執行批次更新 (VB)</span><span class="sxs-lookup"><span data-stu-id="88440-103">Performing Batch Updates (VB)</span></span>

<span data-ttu-id="88440-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="88440-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="88440-105">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe)或[下載 PDF](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="88440-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe) or [Download PDF](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span></span>

> <span data-ttu-id="88440-106">瞭解如何建立可完全編輯的 DataList，其中所有的專案都處於編輯模式，而且可以按一下頁面上的 [全部更新] 按鈕來儲存其值。</span><span class="sxs-lookup"><span data-stu-id="88440-106">Learn how to create a fully-editable DataList where all of its items are in edit mode and whose values can be saved by clicking an "Update All" button on the page.</span></span>

## <a name="introduction"></a><span data-ttu-id="88440-107">簡介</span><span class="sxs-lookup"><span data-stu-id="88440-107">Introduction</span></span>

<span data-ttu-id="88440-108">在[先前的教學](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)課程中，我們已探討如何建立專案層級 DataList。</span><span class="sxs-lookup"><span data-stu-id="88440-108">In the [preceding tutorial](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md) we examined how to create an item-level DataList.</span></span> <span data-ttu-id="88440-109">如同標準可編輯的 GridView，DataList 中的每個專案都包含 [編輯] 按鈕，當您按一下時，就會讓專案可供編輯。</span><span class="sxs-lookup"><span data-stu-id="88440-109">Like the standard editable GridView, each item in the DataList included an Edit button that, when clicked, would make the item editable.</span></span> <span data-ttu-id="88440-110">雖然此專案層級的編輯功能適用于只偶爾更新的資料，但某些使用案例需要使用者編輯許多記錄。</span><span class="sxs-lookup"><span data-stu-id="88440-110">While this item-level editing works well for data that is only updated occasionally, certain use case scenarios require the user to edit many records.</span></span> <span data-ttu-id="88440-111">如果使用者需要編輯數十筆記錄，並強制按一下 [編輯]、進行變更，然後按一下每一個的 [更新]，則按一下的量可能會妨礙她的生產力。</span><span class="sxs-lookup"><span data-stu-id="88440-111">If a user needs to edit dozens of records and is forced to click Edit, make their changes, and click Update for each one, the amount of clicking can hamper her productivity.</span></span> <span data-ttu-id="88440-112">在這種情況下，較好的選項是提供可完全編輯的 DataList，*其中一個*專案是在編輯模式中，而且可以按一下頁面上的 [全部更新] 按鈕來編輯其值（請參閱 [圖 1]）。</span><span class="sxs-lookup"><span data-stu-id="88440-112">In such situations, a better option is to provide a fully-editable DataList, one where *all* of its items are in edit mode and whose values can be edited by clicking an Update All button on the page (see Figure 1).</span></span>

<span data-ttu-id="88440-113">[可以修改可完全編輯之 DataList 中的每個專案 ![](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="88440-113">[![Each Item in a Fully Editable DataList can be Modified](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span></span>

<span data-ttu-id="88440-114">**圖 1**：可以修改完全可編輯的 DataList 中的每個專案（[按一下以查看完整大小的影像](performing-batch-updates-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="88440-114">**Figure 1**: Each Item in a Fully Editable DataList can be Modified ([Click to view full-size image](performing-batch-updates-vb/_static/image3.png))</span></span>

<span data-ttu-id="88440-115">在本教學課程中，我們將探討如何讓使用者使用完全可編輯的 DataList 來更新供應商位址資訊。</span><span class="sxs-lookup"><span data-stu-id="88440-115">In this tutorial we'll examine how to enable users to update suppliers address information using a fully editable DataList.</span></span>

## <a name="step-1-create-the-editable-user-interface-in-the-datalist-s-itemtemplate"></a><span data-ttu-id="88440-116">步驟1：在 DataList s ItemTemplate 中建立可編輯的使用者介面</span><span class="sxs-lookup"><span data-stu-id="88440-116">Step 1: Create the Editable User Interface in the DataList s ItemTemplate</span></span>

<span data-ttu-id="88440-117">在先前的教學課程中，我們會在這裡建立標準的專案層級可編輯 DataList，我們使用了兩個範本：</span><span class="sxs-lookup"><span data-stu-id="88440-117">In the preceding tutorial, where we creating a standard, item-level editable DataList, we used two templates:</span></span>

- <span data-ttu-id="88440-118">`ItemTemplate` 包含唯讀使用者介面（標籤 Web 控制項，用於顯示每個產品的名稱和價格）。</span><span class="sxs-lookup"><span data-stu-id="88440-118">`ItemTemplate` contained the read-only user interface (the Label Web controls for displaying each product s name and price).</span></span>
- <span data-ttu-id="88440-119">`EditItemTemplate` 包含編輯模式使用者介面（這兩個 TextBox Web 控制項）。</span><span class="sxs-lookup"><span data-stu-id="88440-119">`EditItemTemplate` contained the edit mode user interface (the two TextBox Web controls).</span></span>

<span data-ttu-id="88440-120">DataList s `EditItemIndex` 屬性會指定使用 `EditItemTemplate`轉譯 `DataListItem` （如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="88440-120">The DataList s `EditItemIndex` property dictates what `DataListItem` (if any) is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="88440-121">特別是，其 `ItemIndex` 值符合 DataList s `EditItemIndex` 屬性的 `DataListItem` 會使用 `EditItemTemplate`來呈現。</span><span class="sxs-lookup"><span data-stu-id="88440-121">In particular, the `DataListItem` whose `ItemIndex` value matches the DataList s `EditItemIndex` property is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="88440-122">當您一次只能編輯一個專案，但在建立可完全編輯的 DataList 時，此模型的運作良好。</span><span class="sxs-lookup"><span data-stu-id="88440-122">This model works well when only one item can be edited at a time, but falls apart when creating a fully-editable DataList.</span></span>

<span data-ttu-id="88440-123">針對可完全編輯的 DataList，我們想要使用可編輯的介面來轉譯*所有*的 `DataListItem`。</span><span class="sxs-lookup"><span data-stu-id="88440-123">For a fully editable DataList, we want *all* of the `DataListItem` s to render using the editable interface.</span></span> <span data-ttu-id="88440-124">完成這項操作的最簡單方式是在 `ItemTemplate`中定義可編輯的介面。</span><span class="sxs-lookup"><span data-stu-id="88440-124">The simplest way to accomplish this is to define the editable interface in the `ItemTemplate`.</span></span> <span data-ttu-id="88440-125">若要修改供應商位址資訊，可編輯的介面會將供應商名稱包含為文字，然後將 [位址]、[城市] 和 [國家/地區] 值設為文字方塊。</span><span class="sxs-lookup"><span data-stu-id="88440-125">For modifying the suppliers address information, the editable interface contains the supplier name as text and then TextBoxes for the address, city, and country values.</span></span>

<span data-ttu-id="88440-126">一開始先開啟 [`BatchUpdate.aspx`] 頁面，加入 DataList 控制項，然後將其 [`ID`] 屬性設定為 [`Suppliers`]。</span><span class="sxs-lookup"><span data-stu-id="88440-126">Start by opening the `BatchUpdate.aspx` page, add a DataList control, and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="88440-127">從 DataList s 智慧標籤中，加入宣告名為 `SuppliersDataSource`的新 ObjectDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="88440-127">From the DataList s smart tag, opt to add a new ObjectDataSource control named `SuppliersDataSource`.</span></span>

<span data-ttu-id="88440-128">[![建立名為 SuppliersDataSource 的新 ObjectDataSource](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="88440-128">[![Create a New ObjectDataSource Named SuppliersDataSource](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span></span>

<span data-ttu-id="88440-129">**圖 2**：建立名為 `SuppliersDataSource` 的新 ObjectDataSource （[按一下以查看完整大小的影像](performing-batch-updates-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="88440-129">**Figure 2**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](performing-batch-updates-vb/_static/image6.png))</span></span>

<span data-ttu-id="88440-130">使用 `SuppliersBLL` 類別的 `GetSuppliers()` 方法，將 ObjectDataSource 設定為取出資料（請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="88440-130">Configure the ObjectDataSource to retrieve data using the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 3).</span></span> <span data-ttu-id="88440-131">如同先前的教學課程，我們將直接使用商務邏輯層，而不是透過 ObjectDataSource 更新供應商資訊。</span><span class="sxs-lookup"><span data-stu-id="88440-131">As with the preceding tutorial, rather than updating the supplier information through the ObjectDataSource, we'll work directly with the Business Logic Layer.</span></span> <span data-ttu-id="88440-132">因此，請在 [更新] 索引標籤中，將下拉式清單設定為 [（無）] （請參閱 [圖 4]）。</span><span class="sxs-lookup"><span data-stu-id="88440-132">Therefore, set the drop-down list to (None) in the UPDATE tab (see Figure 4).</span></span>

<span data-ttu-id="88440-133">[![使用 GetSuppliers （）方法來取得供應商資訊](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="88440-133">[![Retrieve Supplier Information Using the GetSuppliers() Method](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span></span>

<span data-ttu-id="88440-134">**圖 3**：使用 `GetSuppliers()` 方法取出供應商資訊（[按一下以觀看完整大小的影像](performing-batch-updates-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="88440-134">**Figure 3**: Retrieve Supplier Information Using the `GetSuppliers()` Method ([Click to view full-size image](performing-batch-updates-vb/_static/image9.png))</span></span>

<span data-ttu-id="88440-135">[![在 [更新] 索引標籤中將下拉式清單設定為 [（無）]](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="88440-135">[![Set the Drop-Down List to (None) in the UPDATE Tab](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span></span>

<span data-ttu-id="88440-136">**圖 4**：在 [更新] 索引標籤中，將下拉式清單設定為 [（無）] （[按一下以查看完整大小的影像](performing-batch-updates-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="88440-136">**Figure 4**: Set the Drop-Down List to (None) in the UPDATE Tab ([Click to view full-size image](performing-batch-updates-vb/_static/image12.png))</span></span>

<span data-ttu-id="88440-137">完成 wizard 之後，Visual Studio 會自動產生 DataList s `ItemTemplate`，以便在標籤 Web 控制項中顯示資料來源所傳回的每個資料欄位。</span><span class="sxs-lookup"><span data-stu-id="88440-137">After completing the wizard, Visual Studio automatically generates the DataList s `ItemTemplate` to display each data field returned by the data source in a Label Web control.</span></span> <span data-ttu-id="88440-138">我們需要修改此範本，使其改為提供編輯介面。</span><span class="sxs-lookup"><span data-stu-id="88440-138">We need to modify this template so that it provides the editing interface instead.</span></span> <span data-ttu-id="88440-139">您可以使用 DataList s 智慧標籤中的 [編輯範本] 選項，或直接透過宣告式語法，透過設計工具自訂 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="88440-139">The `ItemTemplate` can be customized through the Designer using the Edit Templates option from the DataList s smart tag or directly through the declarative syntax.</span></span>

<span data-ttu-id="88440-140">花點時間建立以文字顯示供應商名稱的編輯介面，但包含供應商位址、城市和國家/地區值的文字方塊。</span><span class="sxs-lookup"><span data-stu-id="88440-140">Take a moment to create an editing interface that displays the supplier s name as text, but includes TextBoxes for the supplier s address, city, and country values.</span></span> <span data-ttu-id="88440-141">進行這些變更之後，您的頁面宣告式語法看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="88440-141">After making these changes, your page s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](performing-batch-updates-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="88440-142">如同先前的教學課程，本教學課程中的 DataList 必須啟用其檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="88440-142">As with the preceding tutorial, the DataList in this tutorial must have its view state enabled.</span></span>

<span data-ttu-id="88440-143">在 `ItemTemplate` I m 使用兩個新的 CSS 類別，`SupplierPropertyLabel` 和 `SupplierPropertyValue`，其已加入至 `Styles.css` 類別，並已設定為使用與 `ProductPropertyLabel` 和 `ProductPropertyValue` CSS 類別相同的樣式設定。</span><span class="sxs-lookup"><span data-stu-id="88440-143">In the `ItemTemplate` I m using two new CSS classes, `SupplierPropertyLabel` and `SupplierPropertyValue`, which have been added to the `Styles.css` class and configured to use the same style settings as the `ProductPropertyLabel` and `ProductPropertyValue` CSS classes.</span></span>

[!code-css[Main](performing-batch-updates-vb/samples/sample2.css)]

<span data-ttu-id="88440-144">進行這些變更之後，請透過瀏覽器造訪此頁面。</span><span class="sxs-lookup"><span data-stu-id="88440-144">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="88440-145">如 [圖 5] 所示，每個 DataList 專案都會將供應商名稱顯示為文字，並使用文字方塊來顯示位址、城市和國家/地區。</span><span class="sxs-lookup"><span data-stu-id="88440-145">As Figure 5 shows, each DataList item displays the supplier name as text and uses TextBoxes to display the address, city, and country.</span></span>

<span data-ttu-id="88440-146">[DataList 中的每個供應商 ![可編輯](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="88440-146">[![Each Supplier in the DataList is Editable](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span></span>

<span data-ttu-id="88440-147">**圖 5**： DataList 中的每個供應商都是可編輯的（[按一下以查看完整大小的影像](performing-batch-updates-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="88440-147">**Figure 5**: Each Supplier in the DataList is Editable ([Click to view full-size image](performing-batch-updates-vb/_static/image15.png))</span></span>

## <a name="step-2-adding-an-update-all-button"></a><span data-ttu-id="88440-148">步驟2：新增全部更新按鈕</span><span class="sxs-lookup"><span data-stu-id="88440-148">Step 2: Adding an Update All Button</span></span>

<span data-ttu-id="88440-149">雖然 [圖 5] 中的每個供應商都在文字方塊中顯示其位址、城市和國家（地區）欄位，但目前沒有可用的 [更新] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="88440-149">While each supplier in Figure 5 has its address, city, and country fields displayed in a TextBox, there currently is no Update button available.</span></span> <span data-ttu-id="88440-150">並不是每個專案都有 [更新] 按鈕，而且具有完全可編輯的 DataLists，頁面上通常會有一個 [全部更新] 按鈕，當您按一下時，就會更新 DataList 中的*所有*記錄。</span><span class="sxs-lookup"><span data-stu-id="88440-150">Rather than having an Update button per item, with fully editable DataLists there is typically a single Update All button on the page that, when clicked, updates *all* of the records in the DataList.</span></span> <span data-ttu-id="88440-151">在本教學課程中，讓我們新增兩個 [全部更新] 按鈕-一個在頁面頂端，另一個位於底部（雖然按一下任一按鈕會有相同的效果）。</span><span class="sxs-lookup"><span data-stu-id="88440-151">For this tutorial, let s add two Update All buttons - one at the top of the page and one at the bottom (although clicking either button will have the same effect).</span></span>

<span data-ttu-id="88440-152">首先，在 DataList 上方加入按鈕 Web 控制項，並將其 `ID` 屬性設為 `UpdateAll1`。</span><span class="sxs-lookup"><span data-stu-id="88440-152">Start by adding a Button Web control above the DataList and set its `ID` property to `UpdateAll1`.</span></span> <span data-ttu-id="88440-153">接下來，在 DataList 底下新增第二個按鈕 Web 控制項，將其 `ID` 設定為 `UpdateAll2`。</span><span class="sxs-lookup"><span data-stu-id="88440-153">Next, add the second Button Web control beneath the DataList, setting its `ID` to `UpdateAll2`.</span></span> <span data-ttu-id="88440-154">將兩個按鈕的 `Text` 屬性設定為 [全部更新]。</span><span class="sxs-lookup"><span data-stu-id="88440-154">Set the `Text` properties for the two Buttons to Update All.</span></span> <span data-ttu-id="88440-155">最後，`Click` 事件的兩個按鈕建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="88440-155">Lastly, create event handlers for both Buttons `Click` events.</span></span> <span data-ttu-id="88440-156">我們不會在每個事件處理常式中複製更新邏輯，而是將該邏輯重構到第三個方法，`UpdateAllSupplierAddresses`，讓事件處理常式只叫用第三個方法。</span><span class="sxs-lookup"><span data-stu-id="88440-156">Rather than duplicating the update logic in each of the event handlers, let s refactor that logic to a third method, `UpdateAllSupplierAddresses`, having the event handlers simply invoking this third method.</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample3.vb)]

<span data-ttu-id="88440-157">[圖 6] 顯示新增 [更新所有] 按鈕之後的頁面。</span><span class="sxs-lookup"><span data-stu-id="88440-157">Figure 6 shows the page after the Update All buttons have been added.</span></span>

<span data-ttu-id="88440-158">[已將 [![兩個更新] 按鈕新增至頁面](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="88440-158">[![Two Update All Buttons have been Added to the Page](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span></span>

<span data-ttu-id="88440-159">**圖 6**：已將兩個 Update 按鈕新增至頁面（[按一下以觀看完整大小的影像](performing-batch-updates-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="88440-159">**Figure 6**: Two Update All Buttons have been Added to the Page ([Click to view full-size image](performing-batch-updates-vb/_static/image18.png))</span></span>

## <a name="step-3-updating-all-of-the-suppliers-address-information"></a><span data-ttu-id="88440-160">步驟3：更新所有供應商位址資訊</span><span class="sxs-lookup"><span data-stu-id="88440-160">Step 3: Updating All of the Suppliers Address Information</span></span>

<span data-ttu-id="88440-161">所有 DataList 的專案都顯示編輯介面，並新增 [全部更新] 按鈕之後，剩下的工作就是撰寫程式碼來執行批次更新。</span><span class="sxs-lookup"><span data-stu-id="88440-161">With all of the DataList s items displaying the editing interface and with the addition of the Update All buttons, all that remains is writing the code to perform the batch update.</span></span> <span data-ttu-id="88440-162">具體而言，我們需要對 DataList 的專案執行迴圈，並為每個專案呼叫 `SuppliersBLL` 類別 s `UpdateSupplierAddress` 方法。</span><span class="sxs-lookup"><span data-stu-id="88440-162">Specifically, we need to loop through the DataList s items and call the `SuppliersBLL` class s `UpdateSupplierAddress` method for each one.</span></span>

<span data-ttu-id="88440-163">組成 DataList 的 `DataListItem` 實例集合，可以透過 DataList s [`Items` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx)來存取。</span><span class="sxs-lookup"><span data-stu-id="88440-163">The collection of `DataListItem` instances that makeup the DataList can be accessed via the DataList s [`Items` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span></span> <span data-ttu-id="88440-164">透過 `DataListItem`的參考，我們可以從 `DataKeys` 集合抓取對應的 `SupplierID`，並以程式設計方式參考 `ItemTemplate` 中的 TextBox Web 控制項，如下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="88440-164">With a reference to a `DataListItem`, we can grab the corresponding `SupplierID` from the `DataKeys` collection and programmatically reference the TextBox Web controls within the `ItemTemplate` as the following code illustrates:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample4.vb)]

<span data-ttu-id="88440-165">當使用者按一下其中一個 [全部更新] 按鈕時，`UpdateAllSupplierAddresses` 方法會逐一查看 `Suppliers` DataList 中的每個 `DataListItem`，並呼叫 `SuppliersBLL` 類別的 `UpdateSupplierAddress` 方法，並傳入對應的值。</span><span class="sxs-lookup"><span data-stu-id="88440-165">When the user clicks one of the Update All buttons, the `UpdateAllSupplierAddresses` method iterates through each `DataListItem` in the `Suppliers` DataList and calls the `SuppliersBLL` class s `UpdateSupplierAddress` method, passing in the corresponding values.</span></span> <span data-ttu-id="88440-166">[位址]、[城市] 或 [國家/地區] 階段的非輸入值是 `UpdateSupplierAddress` 的 `Nothing` 值（而不是空白字串），這會導致資料庫 `NULL` 用於基礎記錄 s 欄位。</span><span class="sxs-lookup"><span data-stu-id="88440-166">A non-entered value for address, city, or country passes is a value of `Nothing` to `UpdateSupplierAddress` (rather than a blank string), which results in a database `NULL` for the underlying record s fields.</span></span>

> [!NOTE]
> <span data-ttu-id="88440-167">做為增強功能，您可能會想要在執行批次更新之後，將狀態標籤 Web 控制項新增至提供一些確認訊息的頁面。</span><span class="sxs-lookup"><span data-stu-id="88440-167">As an enhancement, you may want to add a status Label Web control to the page that provides some confirmation message after the batch update is performed.</span></span>

## <a name="updating-only-those-addresses-that-have-been-modified"></a><span data-ttu-id="88440-168">僅更新已修改的位址</span><span class="sxs-lookup"><span data-stu-id="88440-168">Updating Only Those Addresses That Have Been Modified</span></span>

<span data-ttu-id="88440-169">本教學課程所使用的批次更新演算法會針對 DataList 中的*每個*供應商呼叫 `UpdateSupplierAddress` 方法，而不論其位址資訊是否已變更。</span><span class="sxs-lookup"><span data-stu-id="88440-169">The batch update algorithm used for this tutorial calls the `UpdateSupplierAddress` method for *every* supplier in the DataList, regardless of whether their address information has been changed.</span></span> <span data-ttu-id="88440-170">雖然這類盲人更新通常不會造成效能問題，但如果您重新審核資料庫資料表的變更，它們可能會導致多餘的記錄。</span><span class="sxs-lookup"><span data-stu-id="88440-170">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="88440-171">例如，如果您使用觸發程式將 `Suppliers` 資料表的所有 `UPDATE` 記錄到審核表中，則每次使用者按一下 [全部更新] 按鈕時，系統就會為系統中的每個供應商建立新的 audit 記錄，而不論使用者是否進行任何變更。</span><span class="sxs-lookup"><span data-stu-id="88440-171">For example, if you use triggers to record all `UPDATE` s to the `Suppliers` table to an auditing table, every time a user clicks the Update All button a new audit record will be created for each supplier in the system, regardless of whether the user made any changes.</span></span>

<span data-ttu-id="88440-172">ADO.NET DataTable 和 DataAdapter 類別是設計用來支援批次更新，其中只有已修改、已刪除和新的記錄會導致任何資料庫通訊。</span><span class="sxs-lookup"><span data-stu-id="88440-172">The ADO.NET DataTable and DataAdapter classes are designed to support batch updates where only modified, deleted, and new records results in any database communication.</span></span> <span data-ttu-id="88440-173">DataTable 中的每個資料列都有一個[`RowState` 屬性](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx)，可指出資料列是否已加入至 DataTable、已從它刪除、修改或保持不變。</span><span class="sxs-lookup"><span data-stu-id="88440-173">Each row in the DataTable has a [`RowState` property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) that indicates whether the row has been added to the DataTable, deleted from it, modified, or remains unchanged.</span></span> <span data-ttu-id="88440-174">一開始填入 DataTable 時，所有資料列都會標示為不變。</span><span class="sxs-lookup"><span data-stu-id="88440-174">When a DataTable is initially populated, all rows are marked unchanged.</span></span> <span data-ttu-id="88440-175">變更任何資料列資料行的值，會將資料列標示為已修改。</span><span class="sxs-lookup"><span data-stu-id="88440-175">Changing the value of any of the row s columns marks the row as modified.</span></span>

<span data-ttu-id="88440-176">在 `SuppliersBLL` 類別中，我們會先將單一供應商記錄讀入 `SuppliersDataTable`，然後使用下列程式碼來設定 `Address`、`City`和 `Country` 資料行值，以更新指定的供應商位址資訊：</span><span class="sxs-lookup"><span data-stu-id="88440-176">In the `SuppliersBLL` class we update the specified supplier s address information by first reading in the single supplier record into a `SuppliersDataTable` and then set the `Address`, `City`, and `Country` column values using the following code:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample5.vb)]

<span data-ttu-id="88440-177">這段程式碼輕鬆自在管理會將傳入的位址、城市和國家值指派給 `SuppliersDataTable` 中的 `SuppliersRow`，而不論值是否已變更。</span><span class="sxs-lookup"><span data-stu-id="88440-177">This code naively assigns the passed-in address, city, and country values to the `SuppliersRow` in the `SuppliersDataTable` regardless of whether or not the values have changed.</span></span> <span data-ttu-id="88440-178">這些修改會導致 `SuppliersRow` s `RowState` 屬性標示為已修改。</span><span class="sxs-lookup"><span data-stu-id="88440-178">These modifications cause the `SuppliersRow` s `RowState` property to be marked as modified.</span></span> <span data-ttu-id="88440-179">呼叫資料存取層 `Update` 方法時，它會看到 `SupplierRow` 已經過修改，因此會將 `UPDATE` 的命令傳送至資料庫。</span><span class="sxs-lookup"><span data-stu-id="88440-179">When the Data Access Layer s `Update` method is called, it sees that the `SupplierRow` has been modified and therefore sends an `UPDATE` command to the database.</span></span>

<span data-ttu-id="88440-180">不過，假設我們已將程式碼新增至這個方法，只會指派傳入的位址、城市和國家/地區值（如果它們與 `SuppliersRow` 的現有值不同）。</span><span class="sxs-lookup"><span data-stu-id="88440-180">Imagine, however, that we added code to this method to only assign the passed-in address, city, and country values if they differ from the `SuppliersRow` s existing values.</span></span> <span data-ttu-id="88440-181">在位址、城市和國家/地區與現有資料相同的情況下，將不會進行任何變更，而且 `SupplierRow` s `RowState` 會保持不變。</span><span class="sxs-lookup"><span data-stu-id="88440-181">In the case where the address, city, and country are the same as the existing data, no changes will be made and the `SupplierRow` s `RowState` will be left marked as unchanged.</span></span> <span data-ttu-id="88440-182">最後的結果是，當呼叫 DAL s `Update` 方法時，不會進行任何資料庫呼叫，因為 `SuppliersRow` 尚未修改。</span><span class="sxs-lookup"><span data-stu-id="88440-182">The net result is that when the DAL s `Update` method is called, no database call will be made because the `SuppliersRow` has not been modified.</span></span>

<span data-ttu-id="88440-183">若要制定這項變更，請以下列程式碼取代會盲目指派傳入位址、城市和國家/地區值的語句：</span><span class="sxs-lookup"><span data-stu-id="88440-183">To enact this change, replace the statements that blindly assign the passed-in address, city, and country values with the following code:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample6.vb)]

<span data-ttu-id="88440-184">使用這段新增的程式碼，DAL 的 `Update` 方法只會針對位址相關值已變更的記錄，將 `UPDATE` 語句傳送到資料庫。</span><span class="sxs-lookup"><span data-stu-id="88440-184">With this added code, the DAL s `Update` method sends an `UPDATE` statement to the database for only those records whose address-related values have changed.</span></span>

<span data-ttu-id="88440-185">或者，我們可以追蹤傳入的位址欄位和資料庫資料之間是否有任何差異，如果沒有，則只會略過對 DAL s `Update` 方法的呼叫。</span><span class="sxs-lookup"><span data-stu-id="88440-185">Alternatively, we could keep track of whether there are any differences between the passed-in address fields and the database data and, if there are none, simply bypass the call to the DAL s `Update` method.</span></span> <span data-ttu-id="88440-186">如果您重新使用 DB 直接方法，這種方法就很好用，因為 DB 直接方法不會傳遞 `SuppliersRow` 實例，其 `RowState` 可以檢查以判斷是否真的需要資料庫呼叫。</span><span class="sxs-lookup"><span data-stu-id="88440-186">This approach works well if you re using the DB direct method, since the DB direct method isn t passed a `SuppliersRow` instance whose `RowState` can be checked to determine whether a database call is actually needed.</span></span>

> [!NOTE]
> <span data-ttu-id="88440-187">每次叫用 `UpdateSupplierAddress` 方法時，就會對資料庫進行呼叫，以取得有關已更新記錄的資訊。</span><span class="sxs-lookup"><span data-stu-id="88440-187">Each time the `UpdateSupplierAddress` method is invoked, a call is made to the database to retrieve information about the updated record.</span></span> <span data-ttu-id="88440-188">然後，如果資料有任何變更，就會對資料庫進行另一個呼叫，以更新資料表資料列。</span><span class="sxs-lookup"><span data-stu-id="88440-188">Then, if there are any changes in data, another call to the database is made to update the table row.</span></span> <span data-ttu-id="88440-189">藉由建立可接受 `EmployeesDataTable` 實例（其中包含 `BatchUpdate.aspx` 頁面的*所有*變更）的 `UpdateSupplierAddress` 方法多載，即可優化此工作流程。</span><span class="sxs-lookup"><span data-stu-id="88440-189">This workflow could be optimized by creating an `UpdateSupplierAddress` method overload that accepts an `EmployeesDataTable` instance that has *all* of the changes from the `BatchUpdate.aspx` page.</span></span> <span data-ttu-id="88440-190">然後，它可以對資料庫進行一次呼叫，以取得 `Suppliers` 資料表中的所有記錄。</span><span class="sxs-lookup"><span data-stu-id="88440-190">Then, it could make one call to the database to get all of the records from the `Suppliers` table.</span></span> <span data-ttu-id="88440-191">然後可以列舉這兩個結果集，而且只會更新已發生變更的記錄。</span><span class="sxs-lookup"><span data-stu-id="88440-191">The two resultsets could then be enumerated and only those records where changes have occurred could be updated.</span></span>

## <a name="summary"></a><span data-ttu-id="88440-192">總結</span><span class="sxs-lookup"><span data-stu-id="88440-192">Summary</span></span>

<span data-ttu-id="88440-193">在本教學課程中，我們已瞭解如何建立可完全編輯的 DataList，讓使用者可以快速地修改多個供應商的位址資訊。</span><span class="sxs-lookup"><span data-stu-id="88440-193">In this tutorial we saw how to create a fully editable DataList, allowing a user to quickly modify the address information for multiple suppliers.</span></span> <span data-ttu-id="88440-194">我們從在 DataList s `ItemTemplate`中，為供應商的位址、城市和國家/地區值定義編輯介面的 TextBox Web 控制項開始。</span><span class="sxs-lookup"><span data-stu-id="88440-194">We started by defining the editing interface a TextBox Web control for the supplier s address, city, and country values in the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="88440-195">接下來，我們已將 [更新所有] 按鈕新增至 DataList 的上方和下方。</span><span class="sxs-lookup"><span data-stu-id="88440-195">Next, we added Update All buttons above and below the DataList.</span></span> <span data-ttu-id="88440-196">使用者進行變更並按一下其中一個 [全部更新] 按鈕之後，就會列舉 `DataListItem`，並對 `SuppliersBLL` class s `UpdateSupplierAddress` 方法進行呼叫。</span><span class="sxs-lookup"><span data-stu-id="88440-196">After a user has made his changes and clicked one of the Update All buttons, the `DataListItem` s are enumerated and a call to the `SuppliersBLL` class s `UpdateSupplierAddress` method is made.</span></span>

<span data-ttu-id="88440-197">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="88440-197">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="88440-198">關於作者</span><span class="sxs-lookup"><span data-stu-id="88440-198">About the Author</span></span>

<span data-ttu-id="88440-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="88440-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="88440-200">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="88440-200">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="88440-201">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="88440-201">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="88440-202">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="88440-202">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="88440-203">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="88440-203">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="88440-204">特別感謝</span><span class="sxs-lookup"><span data-stu-id="88440-204">Special Thanks To</span></span>

<span data-ttu-id="88440-205">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="88440-205">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="88440-206">本教學課程的領導審查者為 Zack，和 Ken Pespisa。</span><span class="sxs-lookup"><span data-stu-id="88440-206">Lead reviewers for this tutorial were Zack Jones and Ken Pespisa.</span></span> <span data-ttu-id="88440-207">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="88440-207">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="88440-208">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="88440-208">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="88440-209">[上一頁](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
> [下一頁](handling-bll-and-dal-level-exceptions-vb.md)</span><span class="sxs-lookup"><span data-stu-id="88440-209">[Previous](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
[Next](handling-bll-and-dal-level-exceptions-vb.md)</span></span>
