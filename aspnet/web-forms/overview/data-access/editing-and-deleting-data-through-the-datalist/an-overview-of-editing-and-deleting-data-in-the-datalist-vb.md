---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb
title: 在 DataList 中編輯和刪除資料的總覽（VB） |Microsoft Docs
author: rick-anderson
description: 雖然 DataList 缺少內建的編輯和刪除功能，但在本教學課程中，我們將瞭解如何建立可支援編輯和刪除的 DataList 。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 9410a23c-9697-4f07-bd71-e62b0ceac655
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb
msc.type: authoredcontent
ms.openlocfilehash: 49b09cbf0f12f7c7233c3bb2a8b3b2c073bf117e
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78611269"
---
# <a name="an-overview-of-editing-and-deleting-data-in-the-datalist-vb"></a><span data-ttu-id="32967-103">在 DataList 中編輯和刪除資料的總覽（VB）</span><span class="sxs-lookup"><span data-stu-id="32967-103">An Overview of Editing and Deleting Data in the DataList (VB)</span></span>

<span data-ttu-id="32967-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="32967-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="32967-105">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_VB.exe)或[下載 PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/datatutorial36vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="32967-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_VB.exe) or [Download PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/datatutorial36vb1.pdf)</span></span>

> <span data-ttu-id="32967-106">雖然 DataList 缺少內建的編輯和刪除功能，但在本教學課程中，我們將瞭解如何建立 DataList，以支援編輯和刪除其基礎資料。</span><span class="sxs-lookup"><span data-stu-id="32967-106">While the DataList lacks built-in editing and deleting capabilities, in this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span>

## <a name="introduction"></a><span data-ttu-id="32967-107">簡介</span><span class="sxs-lookup"><span data-stu-id="32967-107">Introduction</span></span>

<span data-ttu-id="32967-108">在[插入、更新和刪除資料](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教學課程的總覽中，我們探討了如何使用應用程式架構、ObjectDataSource 和 GridView、DetailsView 和 FormView 控制項來插入、更新和刪除資料。</span><span class="sxs-lookup"><span data-stu-id="32967-108">In the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial we looked at how to insert, update, and delete data using the application architecture, an ObjectDataSource, and the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="32967-109">有了 ObjectDataSource 和這三個數據 Web 控制項，執行簡單的資料修改介面就是一種貼齊，只涉及智慧標籤的核取方塊。</span><span class="sxs-lookup"><span data-stu-id="32967-109">With the ObjectDataSource and these three data Web controls, implementing simple data modification interfaces was a snap and involved merely ticking a checkbox from a smart tag.</span></span> <span data-ttu-id="32967-110">不需要撰寫任何程式碼。</span><span class="sxs-lookup"><span data-stu-id="32967-110">No code needed to be written.</span></span>

<span data-ttu-id="32967-111">可惜的是，DataList 缺少 GridView 控制項中固有的內建編輯和刪除功能。</span><span class="sxs-lookup"><span data-stu-id="32967-111">Unfortunately, the DataList lacks the built-in editing and deleting capabilities inherent in the GridView control.</span></span> <span data-ttu-id="32967-112">這項遺漏功能的原因是，當您無法使用宣告式資料來源控制項和無程式碼的資料修改頁面時，DataList 是來自舊版 ASP.NET 的 new relic。</span><span class="sxs-lookup"><span data-stu-id="32967-112">This missing functionality is due in part to the fact that the DataList is a relic from the previous version of ASP.NET, when declarative data source controls and code-free data modification pages were unavailable.</span></span> <span data-ttu-id="32967-113">雖然 ASP.NET 2.0 中的 DataList 並未提供與 GridView 相同的現成資料修改功能，但我們可以使用 ASP.NET 1.x 技術來加入這類功能。</span><span class="sxs-lookup"><span data-stu-id="32967-113">While the DataList in ASP.NET 2.0 does not offer the same out of the box data modification capabilities as the GridView, we can use ASP.NET 1.x techniques to include such functionality.</span></span> <span data-ttu-id="32967-114">這種方法需要一些程式碼，但如我們在本教學課程中所見，DataList 有一些事件和屬性可協助進行此程式。</span><span class="sxs-lookup"><span data-stu-id="32967-114">This approach requires a bit of code but, as we'll see in this tutorial, the DataList has some events and properties in place to aid in this process.</span></span>

<span data-ttu-id="32967-115">在本教學課程中，我們將瞭解如何建立 DataList，以支援編輯和刪除其基礎資料。</span><span class="sxs-lookup"><span data-stu-id="32967-115">In this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span> <span data-ttu-id="32967-116">未來的教學課程會檢查更先進的編輯和刪除案例，包括輸入欄位驗證、正常處理從資料存取或商務邏輯層引發的例外狀況等等。</span><span class="sxs-lookup"><span data-stu-id="32967-116">Future tutorials will examine more advanced editing and deleting scenarios, including input field validation, gracefully handling exceptions raised from the Data Access or Business Logic Layers, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="32967-117">就像 DataList 一樣，中繼器控制項缺少插入、更新或刪除的現成功能。</span><span class="sxs-lookup"><span data-stu-id="32967-117">Like the DataList, the Repeater control lacks the out of the box functionality for inserting, updating, or deleting.</span></span> <span data-ttu-id="32967-118">雖然可以加入這類功能，但 DataList 卻包含在中繼器中找不到的屬性和事件，可簡化新增這類功能。</span><span class="sxs-lookup"><span data-stu-id="32967-118">While such functionality can be added, the DataList includes properties and events not found in the Repeater that simplify adding such capabilities.</span></span> <span data-ttu-id="32967-119">因此，本教學課程和未來查看編輯和刪除的教學課程，將會嚴格著重在 DataList 上。</span><span class="sxs-lookup"><span data-stu-id="32967-119">Therefore, this tutorial and future ones that look at editing and deleting will focus strictly on the DataList.</span></span>

## <a name="step-1-creating-the-editing-and-deleting-tutorials-web-pages"></a><span data-ttu-id="32967-120">步驟1：建立編輯和刪除教學課程的網頁</span><span class="sxs-lookup"><span data-stu-id="32967-120">Step 1: Creating the Editing and Deleting Tutorials Web Pages</span></span>

<span data-ttu-id="32967-121">開始探索如何從 DataList 更新和刪除資料之前，讓我們先花點時間在我們的網站專案中建立 ASP.NET 網頁，我們將在本教學課程中使用，以及接下來的幾頁。</span><span class="sxs-lookup"><span data-stu-id="32967-121">Before we start exploring how to update and delete data from a DataList, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="32967-122">從新增名為 `EditDeleteDataList`的資料夾開始。</span><span class="sxs-lookup"><span data-stu-id="32967-122">Start by adding a new folder named `EditDeleteDataList`.</span></span> <span data-ttu-id="32967-123">接下來，將下列 ASP.NET 網頁新增至該資料夾，並確定每個頁面都與 `Site.master` 主版頁面相關聯：</span><span class="sxs-lookup"><span data-stu-id="32967-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `BatchUpdate.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`

![新增教學課程的 ASP.NET 網頁](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image1.png)

<span data-ttu-id="32967-125">**圖 1**：新增教學課程的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="32967-125">**Figure 1**: Add the ASP.NET Pages for the Tutorials</span></span>

<span data-ttu-id="32967-126">如同在其他資料夾中，[`EditDeleteDataList`] 資料夾中的 `Default.aspx` 會列出其章節中的教學課程。</span><span class="sxs-lookup"><span data-stu-id="32967-126">Like in the other folders, `Default.aspx` in the `EditDeleteDataList` folder lists the tutorials in its section.</span></span> <span data-ttu-id="32967-127">回想一下，`SectionLevelTutorialListing.ascx` 的使用者控制項會提供這種功能。</span><span class="sxs-lookup"><span data-stu-id="32967-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="32967-128">因此，請將這個使用者控制項加入至 `Default.aspx`，方法是將它從方案總管拖曳至頁面 s 設計檢視。</span><span class="sxs-lookup"><span data-stu-id="32967-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="32967-129">[![將 SectionLevelTutorialListing 的 .ascx 使用者控制項新增至 default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="32967-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image2.png)</span></span>

<span data-ttu-id="32967-130">**圖 2**：將 `SectionLevelTutorialListing.ascx` 使用者控制項加入 `Default.aspx` （[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image4.png))</span></span>

<span data-ttu-id="32967-131">最後，將頁面新增為 `Web.sitemap` 檔案的專案。</span><span class="sxs-lookup"><span data-stu-id="32967-131">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="32967-132">具體而言，請在具有 DataList 和中繼器 `<siteMapNode>`的主要/詳細資料包表之後，加入下列標記：</span><span class="sxs-lookup"><span data-stu-id="32967-132">Specifically, add the following markup after the Master/Detail Reports with the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-xml[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample1.xml)]

<span data-ttu-id="32967-133">更新 `Web.sitemap`之後，請花一點時間透過瀏覽器來觀看教學課程網站。</span><span class="sxs-lookup"><span data-stu-id="32967-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="32967-134">左側功能表現在包含 DataList 編輯和刪除教學課程的專案。</span><span class="sxs-lookup"><span data-stu-id="32967-134">The menu on the left now includes items for the DataList editing and deleting tutorials.</span></span>

![網站地圖現在包含 DataList 編輯和刪除教學課程的專案](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image5.png)

<span data-ttu-id="32967-136">**圖 3**：網站地圖現在包含 DataList 編輯和刪除教學課程的專案</span><span class="sxs-lookup"><span data-stu-id="32967-136">**Figure 3**: The Site Map Now Includes Entries for the DataList Editing and Deleting Tutorials</span></span>

## <a name="step-2-examining-techniques-for-updating-and-deleting-data"></a><span data-ttu-id="32967-137">步驟2：檢查更新和刪除資料的技術</span><span class="sxs-lookup"><span data-stu-id="32967-137">Step 2: Examining Techniques for Updating and Deleting Data</span></span>

<span data-ttu-id="32967-138">使用 GridView 編輯和刪除資料非常簡單，因為在幕後，GridView 和 ObjectDataSource 會共同工作。</span><span class="sxs-lookup"><span data-stu-id="32967-138">Editing and deleting data with the GridView is so easy because, underneath the covers, the GridView and ObjectDataSource work in concert.</span></span> <span data-ttu-id="32967-139">如[檢查與插入、更新和刪除教學課程相關聯的事件](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)中所述，當您按一下 [資料列 s 更新] 按鈕時，GridView 會自動將使用雙向資料系結的欄位指派給其 ObjectDataSource 的 `UpdateParameters` 集合，然後叫用該 objectdatasource 的 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="32967-139">As discussed in the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) tutorial, when a row s Update button is clicked, the GridView automatically assigns its fields that used two-way databinding to the `UpdateParameters` collection of its ObjectDataSource and then invokes that ObjectDataSource s `Update()` method.</span></span>

<span data-ttu-id="32967-140">可惜的是，DataList 並不提供任何一種內建功能。</span><span class="sxs-lookup"><span data-stu-id="32967-140">Sadly, the DataList does not provide any of this built-in functionality.</span></span> <span data-ttu-id="32967-141">我們負責確保使用者的值會指派給 ObjectDataSource s 參數，而且會呼叫其 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="32967-141">It is our responsibility to ensure that the user s values are assigned to the ObjectDataSource s parameters and that its `Update()` method is called.</span></span> <span data-ttu-id="32967-142">為了協助我們進行這項工作，DataList 提供下列屬性和事件：</span><span class="sxs-lookup"><span data-stu-id="32967-142">To aid us in this endeavor, the DataList provides the following properties and events:</span></span>

- <span data-ttu-id="32967-143">當更新或刪除時，  **[`DataKeyField` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** ，我們必須能夠唯一識別 DataList 中的每個專案。</span><span class="sxs-lookup"><span data-stu-id="32967-143">**The [`DataKeyField` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** when updating or deleting, we need to be able to uniquely identify each item in the DataList.</span></span> <span data-ttu-id="32967-144">將此屬性設定為所顯示資料的 [主要金鑰] 欄位。</span><span class="sxs-lookup"><span data-stu-id="32967-144">Set this property to the primary key field of the displayed data.</span></span> <span data-ttu-id="32967-145">這麼做會將每個 DataList 專案的指定 `DataKeyField` 值填入 DataList s [`DataKeys` 集合](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx)。</span><span class="sxs-lookup"><span data-stu-id="32967-145">Doing so will populate the DataList s [`DataKeys` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx) with the specified `DataKeyField` value for each DataList item.</span></span>
- <span data-ttu-id="32967-146">按一下 `CommandName` 屬性設為 [編輯] 的按鈕、LinkButton 或 ImageButton 時，就會引發 **[`EditCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="32967-146">**The [`EditCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Edit is clicked.</span></span>
- <span data-ttu-id="32967-147">按一下 `CommandName` 屬性設為 [取消] 的按鈕、LinkButton 或 ImageButton 時，就會引發 **[`CancelCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="32967-147">**The [`CancelCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Cancel is clicked.</span></span>
- <span data-ttu-id="32967-148">按一下 `CommandName` 屬性設為 Update 的按鈕、LinkButton 或 ImageButton 時，就會引發 **[`UpdateCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="32967-148">**The [`UpdateCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Update is clicked.</span></span>
- <span data-ttu-id="32967-149">按一下 `CommandName` 屬性設為 [刪除] 的按鈕、LinkButton 或 ImageButton 時，就會引發 **[`DeleteCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="32967-149">**The [`DeleteCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete is clicked.</span></span>

<span data-ttu-id="32967-150">使用這些屬性和事件，我們可以使用四種方法來更新和刪除 DataList 中的資料：</span><span class="sxs-lookup"><span data-stu-id="32967-150">Using these properties and events, there are four approaches we can use to update and delete data from the DataList:</span></span>

1. <span data-ttu-id="32967-151">**使用 ASP.NET 1.X 技術**，DataList 在 ASP.NET 2.0 和 ObjectDataSources 之前就已存在，而且能夠透過程式設計的方式來完全更新和刪除資料。</span><span class="sxs-lookup"><span data-stu-id="32967-151">**Using ASP.NET 1.x Techniques** the DataList existed prior to ASP.NET 2.0 and ObjectDataSources and was able to update and delete data entirely through programmatic means.</span></span> <span data-ttu-id="32967-152">這項技術完全 ditches ObjectDataSource，而且需要將資料直接從商務邏輯層系結至 DataList，這兩者都是在抓取要顯示的資料，以及更新或刪除記錄時。</span><span class="sxs-lookup"><span data-stu-id="32967-152">This technique ditches the ObjectDataSource altogether and requires that we bind the data to the DataList directly from the Business Logic Layer, both in retrieving the data to display and when updating or deleting a record.</span></span>
2. <span data-ttu-id="32967-153">當 DataList 缺少 GridView 的固有編輯和刪除功能時，在**頁面上使用單一 ObjectDataSource 控制項來進行選取、更新和刪除**，因此無法將它們加入自己。</span><span class="sxs-lookup"><span data-stu-id="32967-153">**Using a Single ObjectDataSource Control on the Page for Selecting, Updating, and Deleting** while the DataList lacks the GridView s inherent editing and deleting capabilities, there s no reason we can t add them in ourselves.</span></span> <span data-ttu-id="32967-154">使用這種方法時，我們會使用 ObjectDataSource，就像在 GridView 範例中一樣，但必須建立 DataList s `UpdateCommand` 事件的事件處理常式，而我們會在其中設定 ObjectDataSource s 參數並呼叫其 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="32967-154">With this approach, we use an ObjectDataSource just like in the GridView examples, but must create an event handler for the DataList s `UpdateCommand` event where we set the ObjectDataSource s parameters and call its `Update()` method.</span></span>
3. <span data-ttu-id="32967-155">當使用選項2時，**使用 ObjectDataSource 控制項來選取，但是直接針對 BLL 進行更新和刪除**，我們需要在 `UpdateCommand` 事件中撰寫一些程式碼，並指派參數值等等。</span><span class="sxs-lookup"><span data-stu-id="32967-155">**Using an ObjectDataSource Control for Selecting, but Updating and Deleting Directly Against the BLL** when using option 2, we need to write a bit of code in the `UpdateCommand` event, assigning parameter values and so on.</span></span> <span data-ttu-id="32967-156">相反地，我們可以使用 ObjectDataSource 來選取，但是直接針對 BLL 進行更新和刪除呼叫（如選項1）。</span><span class="sxs-lookup"><span data-stu-id="32967-156">Instead, we can stick with using the ObjectDataSource for selecting, but make the updating and deleting calls directly against the BLL (like with option 1).</span></span> <span data-ttu-id="32967-157">就我的觀點而言，直接與 BLL 互動來更新資料，會導致更容易閱讀的程式碼，而不是指派 ObjectDataSource s `UpdateParameters` 並呼叫其 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="32967-157">In my opinion, updating data by interfacing directly with the BLL leads to more readable code than assigning the ObjectDataSource s `UpdateParameters` and calling its `Update()` method.</span></span>
4. <span data-ttu-id="32967-158">**透過多個 ObjectDataSources 使用宣告式方法**，先前的三種方法都需要一些程式碼。</span><span class="sxs-lookup"><span data-stu-id="32967-158">**Using Declarative Means through Multiple ObjectDataSources** the previous three approaches all require a bit of code.</span></span> <span data-ttu-id="32967-159">如果您不想盡可能繼續使用宣告式語法，最後一個選項就是在頁面上包含多個 ObjectDataSources。</span><span class="sxs-lookup"><span data-stu-id="32967-159">If you d rather keep using as much declarative syntax as possible, a final option is to include multiple ObjectDataSources on the page.</span></span> <span data-ttu-id="32967-160">第一個 ObjectDataSource 會從 BLL 抓取資料，並將其系結至 DataList。</span><span class="sxs-lookup"><span data-stu-id="32967-160">The first ObjectDataSource retrieves the data from the BLL and binds it to the DataList.</span></span> <span data-ttu-id="32967-161">針對更新，會加入另一個 ObjectDataSource，但會直接加入至 DataList s `EditItemTemplate`中。</span><span class="sxs-lookup"><span data-stu-id="32967-161">For updating, another ObjectDataSource is added, but added directly within the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="32967-162">若要包含刪除支援，但 `ItemTemplate`中需要另一個 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="32967-162">To include deleting support, yet another ObjectDataSource would be needed in the `ItemTemplate`.</span></span> <span data-ttu-id="32967-163">使用此方法時，這些內嵌的 ObjectDataSource 會使用 `ControlParameters`，以宣告方式將 ObjectDataSource s 參數系結至使用者輸入控制項（而不需要在 DataList s `UpdateCommand` 事件處理常式中以程式設計方式指定它們）。</span><span class="sxs-lookup"><span data-stu-id="32967-163">With this approach, these embedded ObjectDataSource s use `ControlParameters` to declaratively bind the ObjectDataSource s parameters to the user input controls (rather than having to specify them programmatically in the DataList s `UpdateCommand` event handler).</span></span> <span data-ttu-id="32967-164">這種方法仍然需要一些程式碼，我們必須呼叫 embedded ObjectDataSource s `Update()` 或 `Delete()` 命令，但需要的時間遠低於其他三種方法。</span><span class="sxs-lookup"><span data-stu-id="32967-164">This approach still requires a bit of code we need to call the embedded ObjectDataSource s `Update()` or `Delete()` command but requires far less than with the other three approaches.</span></span> <span data-ttu-id="32967-165">這裡的缺點是，多個 ObjectDataSources 會從整體可讀性中注意力，而使頁面變得雜亂。</span><span class="sxs-lookup"><span data-stu-id="32967-165">The downside here is that the multiple ObjectDataSources do clutter up the page, detracting from the overall readability.</span></span>

<span data-ttu-id="32967-166">如果只強制使用其中一種方法，我可以選擇選項1，因為它提供最大的彈性，而且因為 DataList 原本是設計來配合這個模式。</span><span class="sxs-lookup"><span data-stu-id="32967-166">If forced to only ever use one of these approaches, I d choose option 1 because it provides the most flexibility and because the DataList was originally designed to accommodate this pattern.</span></span> <span data-ttu-id="32967-167">雖然 DataList 已擴充為可與 ASP.NET 2.0 資料來源控制項搭配使用，但並沒有官方 ASP.NET 2.0 資料 Web 控制項（GridView、DetailsView 和 FormView）的所有擴充點或功能。</span><span class="sxs-lookup"><span data-stu-id="32967-167">While the DataList was extended to work with the ASP.NET 2.0 data source controls, it does not have all of the extensibility points or features of the official ASP.NET 2.0 data Web controls (the GridView, DetailsView, and FormView).</span></span> <span data-ttu-id="32967-168">不過，選項2到4不會有任何優點。</span><span class="sxs-lookup"><span data-stu-id="32967-168">Options 2 through 4 are not without merit, though.</span></span>

<span data-ttu-id="32967-169">這和未來的編輯和刪除教學課程將使用 ObjectDataSource 來抓取資料，以顯示並直接呼叫 BLL 以更新和刪除資料（選項3）。</span><span class="sxs-lookup"><span data-stu-id="32967-169">This and the future editing and deleting tutorials will use an ObjectDataSource for retrieving the data to display and direct calls to the BLL to update and delete data (option 3).</span></span>

## <a name="step-3-adding-the-datalist-and-configuring-its-objectdatasource"></a><span data-ttu-id="32967-170">步驟3：加入 DataList 並設定其 ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="32967-170">Step 3: Adding the DataList and Configuring its ObjectDataSource</span></span>

<span data-ttu-id="32967-171">在本教學課程中，我們將建立一個會列出產品資訊的 DataList，而針對每個產品，會提供使用者編輯名稱和價格，以及完全刪除產品的功能。</span><span class="sxs-lookup"><span data-stu-id="32967-171">In this tutorial we will create a DataList that lists product information and, for each product, provides the user the ability to edit the name and price and to delete the product altogether.</span></span> <span data-ttu-id="32967-172">特別是，我們將使用 ObjectDataSource 抓取要顯示的記錄，但請直接與 BLL 互動來執行更新和刪除動作。</span><span class="sxs-lookup"><span data-stu-id="32967-172">In particular, we will retrieve the records to display using an ObjectDataSource, but perform the update and delete actions by interfacing directly with the BLL.</span></span> <span data-ttu-id="32967-173">在我們擔心如何對 DataList 執行編輯和刪除功能之前，先讓先取得頁面來顯示唯讀介面中的產品。</span><span class="sxs-lookup"><span data-stu-id="32967-173">Before we worry about implementing the editing and deleting capabilities to the DataList, let s first get the page to display the products in a read-only interface.</span></span> <span data-ttu-id="32967-174">因為我們已在先前的教學課程中檢查過這些步驟，所以我會快速地繼續進行。</span><span class="sxs-lookup"><span data-stu-id="32967-174">Since we ve examined these steps in previous tutorials, I'll proceed through them quickly.</span></span>

<span data-ttu-id="32967-175">一開始先開啟 `EditDeleteDataList` 資料夾中的 `Basics.aspx` 頁面，然後從 設計檢視將 DataList 加入至頁面。</span><span class="sxs-lookup"><span data-stu-id="32967-175">Start by opening the `Basics.aspx` page in the `EditDeleteDataList` folder and, from the Design view, add a DataList to the page.</span></span> <span data-ttu-id="32967-176">接下來，從 DataList s 智慧標籤建立新的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="32967-176">Next, from the DataList s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="32967-177">由於我們使用的是產品資料，因此請將它設定為使用 `ProductsBLL` 類別。</span><span class="sxs-lookup"><span data-stu-id="32967-177">Since we are working with product data, configure it to use the `ProductsBLL` class.</span></span> <span data-ttu-id="32967-178">若要取出*所有*產品，請選擇 [選取] 索引標籤中的 [`GetProducts()`] 方法。</span><span class="sxs-lookup"><span data-stu-id="32967-178">To retrieve *all* products, choose the `GetProducts()` method in the SELECT tab.</span></span>

<span data-ttu-id="32967-179">[![將 ObjectDataSource 設定為使用 ProductsBLL 類別](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="32967-179">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image6.png)</span></span>

<span data-ttu-id="32967-180">**圖 4**：設定 ObjectDataSource 使用 `ProductsBLL` 類別（[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-180">**Figure 4**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image8.png))</span></span>

<span data-ttu-id="32967-181">[![使用 GetProducts （）方法傳回產品資訊](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="32967-181">[![Return the Product Information Using the GetProducts() Method](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image9.png)</span></span>

<span data-ttu-id="32967-182">**圖 5**：使用 `GetProducts()` 方法傳回產品資訊（[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-182">**Figure 5**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image11.png))</span></span>

<span data-ttu-id="32967-183">DataList （如 GridView）並非設計用來插入新資料;因此，請從 [插入] 索引標籤的下拉式清單中選取 [（無）] 選項。也請為 [更新] 和 [刪除] 索引標籤選擇 [（無）]，因為更新和刪除將會透過 BLL 以程式設計方式執行。</span><span class="sxs-lookup"><span data-stu-id="32967-183">The DataList, like the GridView, is not designed for inserting new data; therefore, select the (None) option from the drop-down list in the INSERT tab. Also choose (None) for the UPDATE and DELETE tabs since the updates and deletes will be performed programmatically through the BLL.</span></span>

<span data-ttu-id="32967-184">[![確認 [ObjectDataSource] [插入]、[更新] 和 [刪除] 索引標籤中的下拉式清單已設定為 [（無）]](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="32967-184">[![Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image12.png)</span></span>

<span data-ttu-id="32967-185">**圖 6**：確認 [ObjectDataSource] [插入]、[更新] 和 [刪除] 索引標籤中的下拉式清單已設定為 [（無）] （[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-185">**Figure 6**: Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None) ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image14.png))</span></span>

<span data-ttu-id="32967-186">設定 ObjectDataSource 之後，請按一下 [完成]，返回設計工具。</span><span class="sxs-lookup"><span data-stu-id="32967-186">After configuring the ObjectDataSource, click Finish, returning to the Designer.</span></span> <span data-ttu-id="32967-187">如先前範例中所見，完成 ObjectDataSource 設定時，Visual Studio 會自動建立 DropDownList 的 `ItemTemplate`，並顯示每個資料欄位。</span><span class="sxs-lookup"><span data-stu-id="32967-187">As we ve seen in past examples, when completing the ObjectDataSource configuration, Visual Studio automatically creates an `ItemTemplate` for the DropDownList, displaying each of the data fields.</span></span> <span data-ttu-id="32967-188">以只顯示產品名稱和價格的 `ItemTemplate` 取代此項。</span><span class="sxs-lookup"><span data-stu-id="32967-188">Replace this `ItemTemplate` with one that displays only the product s name and price.</span></span> <span data-ttu-id="32967-189">此外，請將 `RepeatColumns` 屬性設定為2。</span><span class="sxs-lookup"><span data-stu-id="32967-189">Also, set the `RepeatColumns` property to 2.</span></span>

> [!NOTE]
> <span data-ttu-id="32967-190">如*插入、更新和刪除資料*教學課程中所述，使用 objectdatasource 來修改資料時，我們的架構需要從 ObjectDataSource s 宣告式標記中移除 `OldValuesParameterFormatString` 屬性（或將它重設為預設值，`{0}`）。</span><span class="sxs-lookup"><span data-stu-id="32967-190">As discussed in the *Overview of Inserting, Updating, and Deleting Data* tutorial, when modifying data using the ObjectDataSource our architecture requires that we remove the `OldValuesParameterFormatString` property from the ObjectDataSource s declarative markup (or reset it to its default value, `{0}`).</span></span> <span data-ttu-id="32967-191">不過，在本教學課程中，我們只會使用 ObjectDataSource 來抓取資料。</span><span class="sxs-lookup"><span data-stu-id="32967-191">In this tutorial, however, we are using the ObjectDataSource only for retrieving data.</span></span> <span data-ttu-id="32967-192">因此，我們不需要修改 ObjectDataSource s `OldValuesParameterFormatString` 屬性值（雖然不會有任何傷害）。</span><span class="sxs-lookup"><span data-stu-id="32967-192">Therefore, we do not need to modify the ObjectDataSource s `OldValuesParameterFormatString` property value (although it doesn t hurt to do so).</span></span>

<span data-ttu-id="32967-193">以自訂的 `ItemTemplate` 取代預設的 DataList 之後，您頁面上的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="32967-193">After replacing the default DataList `ItemTemplate` with a customized one, the declarative markup on your page should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample2.aspx)]

<span data-ttu-id="32967-194">請花點時間透過瀏覽器來查看進度。</span><span class="sxs-lookup"><span data-stu-id="32967-194">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="32967-195">如 [圖 7] 所示，DataList 會顯示兩個數據行中每個產品的產品名稱和單價。</span><span class="sxs-lookup"><span data-stu-id="32967-195">As Figure 7 shows, the DataList displays the product name and unit price for each product in two columns.</span></span>

<span data-ttu-id="32967-196">[![產品名稱和價格會顯示在兩個數據行的 DataList 中](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="32967-196">[![The Products Names and Prices are Displayed in a Two-Column DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image15.png)</span></span>

<span data-ttu-id="32967-197">**圖 7**：產品名稱和價格會顯示在兩個數據行的 DataList 中（[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-197">**Figure 7**: The Products Names and Prices are Displayed in a Two-Column DataList ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image17.png))</span></span>

> [!NOTE]
> <span data-ttu-id="32967-198">DataList 具有更新和刪除程式所需的一些屬性，而且這些值會以檢視狀態儲存。</span><span class="sxs-lookup"><span data-stu-id="32967-198">The DataList has a number of properties that are required for the updating and deleting process, and these values are stored in view state.</span></span> <span data-ttu-id="32967-199">因此，在建立支援編輯或刪除資料的 DataList 時，必須啟用 DataList s view 狀態。</span><span class="sxs-lookup"><span data-stu-id="32967-199">Therefore, when building a DataList that supports editing or deleting data, it is essential that the DataList s view state be enabled.</span></span>  
>   
> <span data-ttu-id="32967-200">精明的讀者可能會記得，在建立可編輯的 Gridview、DetailsViews 和 FormViews 時，可以停用 view 狀態。</span><span class="sxs-lookup"><span data-stu-id="32967-200">The astute reader may recall that we were able to disable view state when creating editable GridViews, DetailsViews, and FormViews.</span></span> <span data-ttu-id="32967-201">這是因為 ASP.NET 2.0 Web 控制項可以包含*控制項狀態*，也就是在檢視狀態之類的回傳之間保存的狀態，但被視為必要。</span><span class="sxs-lookup"><span data-stu-id="32967-201">This is because ASP.NET 2.0 Web controls can include *control state*, which is state persisted across postbacks like view state, but deemed essential.</span></span>

<span data-ttu-id="32967-202">停用 GridView 中的 view 狀態只會省略簡單的狀態資訊，但會維持控制項狀態（包括編輯和刪除所需的狀態）。</span><span class="sxs-lookup"><span data-stu-id="32967-202">Disabling view state in the GridView merely omits trivial state information, but maintains the control state (which includes the state necessary for editing and deleting).</span></span> <span data-ttu-id="32967-203">在 ASP.NET 1.x 時間範圍內建立的 DataList 不會利用控制項狀態，因此必須啟用檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="32967-203">The DataList, having been created in the ASP.NET 1.x timeframe, does not utilize control state and therefore must have view state enabled.</span></span> <span data-ttu-id="32967-204">如需控制狀態的用途以及它與檢視狀態有何差異的詳細資訊，請參閱[控制狀態與檢視狀態](https://msdn.microsoft.com/library/1whwt1k7.aspx)。</span><span class="sxs-lookup"><span data-stu-id="32967-204">See [Control State vs. View State](https://msdn.microsoft.com/library/1whwt1k7.aspx) for more information on the purpose of control state and how it differs from view state.</span></span>

## <a name="step-4-adding-an-editing-user-interface"></a><span data-ttu-id="32967-205">步驟4：新增編輯使用者介面</span><span class="sxs-lookup"><span data-stu-id="32967-205">Step 4: Adding an Editing User Interface</span></span>

<span data-ttu-id="32967-206">GridView 控制項是由欄位集合（BoundFields、CheckBoxFields、TemplateFields 等等）所組成。</span><span class="sxs-lookup"><span data-stu-id="32967-206">The GridView control is composed of a collection of fields (BoundFields, CheckBoxFields, TemplateFields, and so on).</span></span> <span data-ttu-id="32967-207">這些欄位可以根據其模式調整其呈現的標記。</span><span class="sxs-lookup"><span data-stu-id="32967-207">These fields can adjust their rendered markup depending on their mode.</span></span> <span data-ttu-id="32967-208">例如，在唯讀模式中，BoundField 會將其資料欄值顯示為文字;處於編輯模式時，它會呈現 TextBox Web 控制項，其 `Text` 屬性指派給資料欄位值。</span><span class="sxs-lookup"><span data-stu-id="32967-208">For example, when in read-only mode, a BoundField displays its data field value as text; when in edit mode, it renders a TextBox Web control whose `Text` property is assigned the data field value.</span></span>

<span data-ttu-id="32967-209">另一方面，DataList 會使用範本來呈現其專案。</span><span class="sxs-lookup"><span data-stu-id="32967-209">The DataList, on the other hand, renders its items using templates.</span></span> <span data-ttu-id="32967-210">唯讀專案會使用 `ItemTemplate` 來轉譯，而編輯模式中的專案則會透過 `EditItemTemplate`呈現。</span><span class="sxs-lookup"><span data-stu-id="32967-210">Read-only items are rendered using the `ItemTemplate` whereas items in edit mode are rendered via the `EditItemTemplate`.</span></span> <span data-ttu-id="32967-211">到目前為止，我們的 DataList 只有一個 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="32967-211">At this point, our DataList has only an `ItemTemplate`.</span></span> <span data-ttu-id="32967-212">為了支援專案層級的編輯功能，我們需要加入包含要針對可編輯專案顯示之標記的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="32967-212">To support item-level editing functionality we need to add an `EditItemTemplate` that contains the markup to be displayed for the editable item.</span></span> <span data-ttu-id="32967-213">在本教學課程中，我們將使用 TextBox Web 控制項來編輯產品的名稱和單價。</span><span class="sxs-lookup"><span data-stu-id="32967-213">For this tutorial, we'll use TextBox Web controls for editing the product s name and unit price.</span></span>

<span data-ttu-id="32967-214">`EditItemTemplate` 可以宣告方式或透過設計工具建立（從 DataList s 智慧標籤選取 [編輯範本] 選項）。</span><span class="sxs-lookup"><span data-stu-id="32967-214">The `EditItemTemplate` can be created either declaratively or through the Designer (by selecting the Edit Templates option from the DataList s smart tag).</span></span> <span data-ttu-id="32967-215">若要使用 [編輯範本] 選項，請先按一下智慧標籤中的 [編輯範本] 連結，然後從下拉式清單中選取 [`EditItemTemplate`] 專案。</span><span class="sxs-lookup"><span data-stu-id="32967-215">To use the Edit Templates option, first click the Edit Templates link in the smart tag and then select the `EditItemTemplate` item from the drop-down list.</span></span>

<span data-ttu-id="32967-216">[![選擇使用 DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="32967-216">[![Opt to Work with the DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image18.png)</span></span>

<span data-ttu-id="32967-217">**圖 8**：選擇使用 DataList s `EditItemTemplate` （[按一下以觀看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-217">**Figure 8**: Opt to Work with the DataList s `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image20.png))</span></span>

<span data-ttu-id="32967-218">接下來，輸入產品名稱：和價格：，然後將兩個 TextBox 控制項從 [工具箱] 拖曳至設計工具上的 `EditItemTemplate` 介面。</span><span class="sxs-lookup"><span data-stu-id="32967-218">Next, type in Product name: and Price: and then drag two TextBox controls from the Toolbox into the `EditItemTemplate` interface on the Designer.</span></span> <span data-ttu-id="32967-219">將 文字方塊 `ID` 屬性設定為 `ProductName` 和 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="32967-219">Set the TextBoxes `ID` properties to `ProductName` and `UnitPrice`.</span></span>

<span data-ttu-id="32967-220">[![為產品的名稱和價格新增文字方塊](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="32967-220">[![Add a TextBox for the Product s Name and Price](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image21.png)</span></span>

<span data-ttu-id="32967-221">**圖 9**：為產品的名稱和價格新增文字方塊（[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image23.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-221">**Figure 9**: Add a TextBox for the Product s Name and Price ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image23.png))</span></span>

<span data-ttu-id="32967-222">我們需要將對應的產品資料欄值系結到兩個文字方塊的 `Text` 屬性。</span><span class="sxs-lookup"><span data-stu-id="32967-222">We need to bind the corresponding product data field values to the `Text` properties of the two TextBoxes.</span></span> <span data-ttu-id="32967-223">從 [文字方塊] 智慧標籤，按一下 [編輯資料系結] 連結，然後將適當的資料欄位與 [`Text`] 屬性建立關聯，如 [圖 10] 所示。</span><span class="sxs-lookup"><span data-stu-id="32967-223">From the TextBoxes smart tags, click on the Edit DataBindings link and then associate the appropriate data field with the `Text` property, as shown in Figure 10.</span></span>

> [!NOTE]
> <span data-ttu-id="32967-224">將 `UnitPrice` 資料欄位系結至 [價格] 文字方塊 `Text` 欄位時，您可以將其格式化為貨幣值（`{0:C}`）、一般數位（`{0:N}`），或保持未格式化。</span><span class="sxs-lookup"><span data-stu-id="32967-224">When binding the `UnitPrice` data field to the price TextBox s `Text` field, you may format it as a currency value (`{0:C}`), a general number (`{0:N}`), or leave it unformatted.</span></span>

![將 [ProductName] 和 [單價] 資料欄位系結至文字方塊的 [文字] 屬性](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image24.png)

<span data-ttu-id="32967-226">**圖 10**：將 [`ProductName`] 和 [`UnitPrice` 資料] 欄位系結至文字方塊的 `Text` 屬性</span><span class="sxs-lookup"><span data-stu-id="32967-226">**Figure 10**: Bind the `ProductName` and `UnitPrice` Data Fields to the `Text` Properties of the TextBoxes</span></span>

<span data-ttu-id="32967-227">請注意 [圖 10] 中的 [編輯資料系結] 對話方塊，如何*不*包含在 GridView 或 DetailsView 中編輯 TemplateField 時出現的雙向資料系結核取方塊，或是 FormView 中的範本。</span><span class="sxs-lookup"><span data-stu-id="32967-227">Notice how the Edit DataBindings dialog box in Figure 10 does *not* include the Two-way databinding checkbox that is present when editing a TemplateField in the GridView or DetailsView, or a template in the FormView.</span></span> <span data-ttu-id="32967-228">雙向資料系結功能允許在輸入 Web 控制項中輸入的值，在插入或更新資料時，自動指派給對應的 ObjectDataSource s `InsertParameters` 或 `UpdateParameters`。</span><span class="sxs-lookup"><span data-stu-id="32967-228">The two-way databinding feature allowed the value entered into the input Web control to be automatically assigned to the corresponding ObjectDataSource s `InsertParameters` or `UpdateParameters` when inserting or updating data.</span></span> <span data-ttu-id="32967-229">DataList 不支援雙向資料系結，因為我們稍後會在本教學課程中看到，在使用者進行變更並準備好更新資料之後，我們需要以程式設計方式存取這些文字方塊 `Text` 屬性，並將其值傳入 `ProductsBLL` 類別中的適當 `UpdateProduct` 方法。</span><span class="sxs-lookup"><span data-stu-id="32967-229">The DataList does not support two-way databinding as we'll see later on in this tutorial, after the user makes her changes and is ready to update the data, we will need to programmatically access these TextBoxes `Text` properties and pass in their values to the appropriate `UpdateProduct` method in the `ProductsBLL` class.</span></span>

<span data-ttu-id="32967-230">最後，我們需要將 [更新] 和 [取消] 按鈕新增至 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="32967-230">Finally, we need to add Update and Cancel buttons to the `EditItemTemplate`.</span></span> <span data-ttu-id="32967-231">如我們在[主要/詳細資料中使用具有詳細資料 DataList 教學課程的主要記錄項目符號清單](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)中所見，當按鈕、LinkButton 或 ImageButton 的 `CommandName` 屬性設定是從中繼器或 datalist 內按一下時，就會引發 Repeater 或 datalist 的 `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="32967-231">As we saw in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial, when a Button, LinkButton, or ImageButton whose `CommandName` property is set is clicked from within a Repeater or DataList, the Repeater or DataList s `ItemCommand` event is raised.</span></span> <span data-ttu-id="32967-232">對於 DataList 而言，如果 `CommandName` 屬性設定為某個值，也可能會引發額外的事件。</span><span class="sxs-lookup"><span data-stu-id="32967-232">For the DataList, if the `CommandName` property is set to a certain value, an additional event may be raised as well.</span></span> <span data-ttu-id="32967-233">特殊的 `CommandName` 屬性值包括，還有其他內容：</span><span class="sxs-lookup"><span data-stu-id="32967-233">The special `CommandName` property values include, among others:</span></span>

- <span data-ttu-id="32967-234">[取消] 會引發 `CancelCommand` 事件</span><span class="sxs-lookup"><span data-stu-id="32967-234">Cancel raises the `CancelCommand` event</span></span>
- <span data-ttu-id="32967-235">編輯引發 `EditCommand` 事件</span><span class="sxs-lookup"><span data-stu-id="32967-235">Edit raises the `EditCommand` event</span></span>
- <span data-ttu-id="32967-236">Update 會引發 `UpdateCommand` 事件</span><span class="sxs-lookup"><span data-stu-id="32967-236">Update raises the `UpdateCommand` event</span></span>

<span data-ttu-id="32967-237">請記住，除了 `ItemCommand` 事件*之外*，也會引發這些事件。</span><span class="sxs-lookup"><span data-stu-id="32967-237">Keep in mind that these events are raised *in addition to* the `ItemCommand` event.</span></span>

<span data-ttu-id="32967-238">將加入至 [`EditItemTemplate`] 兩個按鈕 Web 控制項，其中 `CommandName` 設定為 [更新]，另一個設定為 [取消]。</span><span class="sxs-lookup"><span data-stu-id="32967-238">Add to the `EditItemTemplate` two Button Web controls, one whose `CommandName` is set to Update and the other s set to Cancel.</span></span> <span data-ttu-id="32967-239">新增這兩個按鈕 Web 控制項之後，設計工具看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="32967-239">After adding these two Button Web controls the Designer should look similar to the following:</span></span>

<span data-ttu-id="32967-240">[![將 [更新] 和 [取消] 按鈕新增至 EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="32967-240">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image25.png)</span></span>

<span data-ttu-id="32967-241">**圖 11**：將 [更新] 和 [取消] 按鈕新增至 `EditItemTemplate` （[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-241">**Figure 11**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image27.png))</span></span>

<span data-ttu-id="32967-242">使用 `EditItemTemplate` 完成 DataList 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="32967-242">With the `EditItemTemplate` complete your DataList s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample3.aspx)]

## <a name="step-5-adding-the-plumbing-to-enter-edit-mode"></a><span data-ttu-id="32967-243">步驟5：新增管線進入編輯模式</span><span class="sxs-lookup"><span data-stu-id="32967-243">Step 5: Adding the Plumbing to Enter Edit Mode</span></span>

<span data-ttu-id="32967-244">此時，我們的 DataList 具有透過其 `EditItemTemplate`定義的編輯介面;不過，目前沒有任何方法可以讓使用者造訪我們的頁面，指出他想要編輯產品的資訊。</span><span class="sxs-lookup"><span data-stu-id="32967-244">At this point our DataList has an editing interface defined via its `EditItemTemplate`; however, there s currently no way for a user visiting our page to indicate that he wants to edit a product s information.</span></span> <span data-ttu-id="32967-245">我們需要將 [編輯] 按鈕加入至每個產品，按下時，會在編輯模式中轉譯該 DataList 專案。</span><span class="sxs-lookup"><span data-stu-id="32967-245">We need to add an Edit button to each product that, when clicked, renders that DataList item in edit mode.</span></span> <span data-ttu-id="32967-246">首先，透過設計工具或以宣告的方式，將 [編輯] 按鈕加入至 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="32967-246">Start by adding an Edit button to the `ItemTemplate`, either through the Designer or declaratively.</span></span> <span data-ttu-id="32967-247">請務必將 [編輯] 按鈕 `CommandName` 屬性設定為 [編輯]。</span><span class="sxs-lookup"><span data-stu-id="32967-247">Be certain to set the Edit button s `CommandName` property to Edit .</span></span>

<span data-ttu-id="32967-248">新增此 [編輯] 按鈕之後，請花一點時間透過瀏覽器來觀看頁面。</span><span class="sxs-lookup"><span data-stu-id="32967-248">After you have added this Edit button, take a moment to view the page through a browser.</span></span> <span data-ttu-id="32967-249">透過這項新增，每個產品清單都應該包含 [編輯] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="32967-249">With this addition, each product listing should include an Edit button.</span></span>

<span data-ttu-id="32967-250">[![將 [更新] 和 [取消] 按鈕新增至 EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="32967-250">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image28.png)</span></span>

<span data-ttu-id="32967-251">**圖 12**：將 [更新] 和 [取消] 按鈕新增至 `EditItemTemplate` （[按一下以觀看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-251">**Figure 12**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image30.png))</span></span>

<span data-ttu-id="32967-252">按一下按鈕會導致回傳，但不會將產品*清單帶入編輯*模式。</span><span class="sxs-lookup"><span data-stu-id="32967-252">Clicking the button causes a postback, but does *not* bring the product listing into edit mode.</span></span> <span data-ttu-id="32967-253">若要讓產品可供編輯，我們必須：</span><span class="sxs-lookup"><span data-stu-id="32967-253">To make the product editable, we need to:</span></span>

1. <span data-ttu-id="32967-254">將 DataList s [`EditItemIndex` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)設定為剛才按一下編輯按鈕之 `DataListItem` 的索引。</span><span class="sxs-lookup"><span data-stu-id="32967-254">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of the `DataListItem` whose Edit button was just clicked.</span></span>
2. <span data-ttu-id="32967-255">將資料重新系結至 DataList。</span><span class="sxs-lookup"><span data-stu-id="32967-255">Rebind the data to the DataList.</span></span> <span data-ttu-id="32967-256">當 DataList 重新轉譯時，其 `ItemIndex` 對應至 DataList s `EditItemIndex` 的 `DataListItem` 會使用其 `EditItemTemplate`來呈現。</span><span class="sxs-lookup"><span data-stu-id="32967-256">When the DataList is re-rendered, the `DataListItem` whose `ItemIndex` corresponds with the DataList s `EditItemIndex` will render using its `EditItemTemplate`.</span></span>

<span data-ttu-id="32967-257">由於按一下 [編輯] 按鈕時，會引發 DataList s `EditCommand` 事件，請使用下列程式碼建立 `EditCommand` 事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="32967-257">Since the DataList s `EditCommand` event is fired when the Edit button is clicked, create an `EditCommand` event handler with the following code:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample4.vb)]

<span data-ttu-id="32967-258">`EditCommand` 事件處理常式會傳遞 `DataListCommandEventArgs` 類型的物件做為第二個輸入參數，其中包含按一下編輯按鈕之 `DataListItem` 的參考（`e.Item`）。</span><span class="sxs-lookup"><span data-stu-id="32967-258">The `EditCommand` event handler is passed in an object of type `DataListCommandEventArgs` as its second input parameter, which includes a reference to the `DataListItem` whose Edit button was clicked (`e.Item`).</span></span> <span data-ttu-id="32967-259">事件處理常式會先將 DataList s `EditItemIndex` 設定為可編輯 `DataListItem` 的 `ItemIndex`，然後藉由呼叫 DataList s `DataBind()` 方法，將資料重新系結至 DataList。</span><span class="sxs-lookup"><span data-stu-id="32967-259">The event handler first sets the DataList s `EditItemIndex` to the `ItemIndex` of the editable `DataListItem` and then rebinds the data to the DataList by calling the DataList s `DataBind()` method.</span></span>

<span data-ttu-id="32967-260">新增這個事件處理常式之後，請在瀏覽器中重新流覽頁面。</span><span class="sxs-lookup"><span data-stu-id="32967-260">After adding this event handler, revisit the page in a browser.</span></span> <span data-ttu-id="32967-261">按一下 [編輯] 按鈕現在會讓按一下的產品可供編輯（請參閱 [圖 13]）。</span><span class="sxs-lookup"><span data-stu-id="32967-261">Clicking the Edit button now makes the clicked product editable (see Figure 13).</span></span>

<span data-ttu-id="32967-262">[![按一下 [編輯] 按鈕可讓產品編輯](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="32967-262">[![Clicking the Edit Button Makes the Product Editable](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image31.png)</span></span>

<span data-ttu-id="32967-263">**圖 13**：按一下 [編輯] 按鈕可讓產品編輯（[按一下以觀看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-263">**Figure 13**: Clicking the Edit Button Makes the Product Editable ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image33.png))</span></span>

## <a name="step-6-saving-the-user-s-changes"></a><span data-ttu-id="32967-264">步驟6：儲存使用者的變更</span><span class="sxs-lookup"><span data-stu-id="32967-264">Step 6: Saving the User s Changes</span></span>

<span data-ttu-id="32967-265">按一下 [已編輯的產品] 更新或 [取消] 按鈕，此時不會執行任何操作;若要加入這種功能，我們必須為 DataList s `UpdateCommand` 和 `CancelCommand` 事件建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="32967-265">Clicking the edited product s Update or Cancel buttons does nothing at this point; to add this functionality we need to create event handlers for the DataList s `UpdateCommand` and `CancelCommand` events.</span></span> <span data-ttu-id="32967-266">首先建立 `CancelCommand` 事件處理常式，這會在按一下 [已編輯的產品] [取消] 按鈕時執行，並負責將 DataList 傳回其預先編輯狀態。</span><span class="sxs-lookup"><span data-stu-id="32967-266">Start by creating the `CancelCommand` event handler, which will execute when the edited product s Cancel button is clicked and it tasked with returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="32967-267">若要讓 DataList 以唯讀模式呈現其所有專案，我們必須：</span><span class="sxs-lookup"><span data-stu-id="32967-267">To have the DataList render all of its items in the read-only mode, we need to:</span></span>

1. <span data-ttu-id="32967-268">將 DataList s [`EditItemIndex` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)設定為不存在之 `DataListItem` 索引的索引。</span><span class="sxs-lookup"><span data-stu-id="32967-268">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="32967-269">`-1` 是一種安全的選擇，因為 `DataListItem` 索引會從 `0`開始。</span><span class="sxs-lookup"><span data-stu-id="32967-269">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
2. <span data-ttu-id="32967-270">將資料重新系結至 DataList。</span><span class="sxs-lookup"><span data-stu-id="32967-270">Rebind the data to the DataList.</span></span> <span data-ttu-id="32967-271">因為沒有任何 `DataListItem` `ItemIndex` es 對應至 DataList s `EditItemIndex`，所以整個 DataList 會以唯讀模式呈現。</span><span class="sxs-lookup"><span data-stu-id="32967-271">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="32967-272">您可以使用下列事件處理常式程式碼來完成這些步驟：</span><span class="sxs-lookup"><span data-stu-id="32967-272">These steps can be accomplished with the following event handler code:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample5.vb)]

<span data-ttu-id="32967-273">在這種新增的情況下，按一下 [取消] 按鈕會將 DataList 傳回其預先編輯狀態。</span><span class="sxs-lookup"><span data-stu-id="32967-273">With this addition, clicking the Cancel button returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="32967-274">我們需要完成的最後一個事件處理常式是 `UpdateCommand` 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="32967-274">The last event handler we need to complete is the `UpdateCommand` event handler.</span></span> <span data-ttu-id="32967-275">這個事件處理常式必須：</span><span class="sxs-lookup"><span data-stu-id="32967-275">This event handler needs to:</span></span>

1. <span data-ttu-id="32967-276">以程式設計方式存取使用者輸入的產品名稱和價格，以及已編輯的產品 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="32967-276">Programmatically access the user-entered product name and price as well as the edited product s `ProductID`.</span></span>
2. <span data-ttu-id="32967-277">藉由在 `ProductsBLL` 類別中呼叫適當的 `UpdateProduct` 多載，起始更新程式。</span><span class="sxs-lookup"><span data-stu-id="32967-277">Initiate the update process by calling the appropriate `UpdateProduct` overload in the `ProductsBLL` class.</span></span>
3. <span data-ttu-id="32967-278">將 DataList s [`EditItemIndex` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)設定為不存在之 `DataListItem` 索引的索引。</span><span class="sxs-lookup"><span data-stu-id="32967-278">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="32967-279">`-1` 是一種安全的選擇，因為 `DataListItem` 索引會從 `0`開始。</span><span class="sxs-lookup"><span data-stu-id="32967-279">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
4. <span data-ttu-id="32967-280">將資料重新系結至 DataList。</span><span class="sxs-lookup"><span data-stu-id="32967-280">Rebind the data to the DataList.</span></span> <span data-ttu-id="32967-281">因為沒有任何 `DataListItem` `ItemIndex` es 對應至 DataList s `EditItemIndex`，所以整個 DataList 會以唯讀模式呈現。</span><span class="sxs-lookup"><span data-stu-id="32967-281">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="32967-282">步驟1和2負責儲存使用者的變更;步驟3和4會在儲存變更之後，將 DataList 回到其預先編輯狀態，而且與 `CancelCommand` 事件處理常式中執行的步驟完全相同。</span><span class="sxs-lookup"><span data-stu-id="32967-282">Steps 1 and 2 are responsible for saving the user s changes; steps 3 and 4 return the DataList to its pre-editing state after the changes have been saved and are identical to the steps performed in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="32967-283">若要取得更新的產品名稱和價格，我們必須使用 `FindControl` 方法，以程式設計方式參考 `EditItemTemplate`內的 TextBox Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="32967-283">To get the updated product name and price, we need to use the `FindControl` method to programmatically reference the TextBox Web controls within the `EditItemTemplate`.</span></span> <span data-ttu-id="32967-284">我們也需要取得已編輯的產品 `ProductID` 值。</span><span class="sxs-lookup"><span data-stu-id="32967-284">We also need to get the edited product s `ProductID` value.</span></span> <span data-ttu-id="32967-285">當我們一開始將 ObjectDataSource 系結至 DataList 時，Visual Studio 將 DataList s `DataKeyField` 屬性指派給資料來源中的主要索引鍵值（`ProductID`）。</span><span class="sxs-lookup"><span data-stu-id="32967-285">When we initially bound the ObjectDataSource to the DataList, Visual Studio assigned the DataList s `DataKeyField` property to the primary key value from the data source (`ProductID`).</span></span> <span data-ttu-id="32967-286">然後，您可以從 DataList s `DataKeys` 集合中抓取此值。</span><span class="sxs-lookup"><span data-stu-id="32967-286">This value can then be retrieved from the DataList s `DataKeys` collection.</span></span> <span data-ttu-id="32967-287">請花點時間確定 `DataKeyField` 屬性確實設定為 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="32967-287">Take a moment to ensure that the `DataKeyField` property is indeed set to `ProductID`.</span></span>

<span data-ttu-id="32967-288">下列程式碼會實行四個步驟：</span><span class="sxs-lookup"><span data-stu-id="32967-288">The following code implements the four steps:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample6.vb)]

<span data-ttu-id="32967-289">事件處理常式會從 `DataKeys` 集合中讀取已編輯的產品 s `ProductID` 開始。</span><span class="sxs-lookup"><span data-stu-id="32967-289">The event handler starts by reading in the edited product s `ProductID` from the `DataKeys` collection.</span></span> <span data-ttu-id="32967-290">接下來，會參考 `EditItemTemplate` 中的兩個文字方塊，而其 `Text` 屬性會儲存在本機變數中，`productNameValue` 和 `unitPriceValue`。</span><span class="sxs-lookup"><span data-stu-id="32967-290">Next, the two TextBoxes in the `EditItemTemplate` are referenced and their `Text` properties stored in local variables, `productNameValue` and `unitPriceValue`.</span></span> <span data-ttu-id="32967-291">我們使用 `Decimal.Parse()` 方法來讀取 [`UnitPrice`] 文字方塊中的值，如此一來，如果輸入的值有貨幣符號，仍然可以正確地轉換成 `Decimal` 值。</span><span class="sxs-lookup"><span data-stu-id="32967-291">We use the `Decimal.Parse()` method to read the value from the `UnitPrice` TextBox so that if the value entered has a currency symbol, it can still be correctly converted into a `Decimal` value.</span></span>

> [!NOTE]
> <span data-ttu-id="32967-292">[`ProductName`] 和 [`UnitPrice`] 文字方塊中的值只會指派給 productNameValue 和 unitPriceValue 變數（如果文字方塊的文字屬性具有指定的值）。</span><span class="sxs-lookup"><span data-stu-id="32967-292">The values from the `ProductName` and `UnitPrice` TextBoxes are only assigned to the productNameValue and unitPriceValue variables if the TextBoxes Text properties have a value specified.</span></span> <span data-ttu-id="32967-293">否則，會將 `Nothing` 的值用於變數，這會影響以資料庫 `NULL` 值來更新資料。</span><span class="sxs-lookup"><span data-stu-id="32967-293">Otherwise, a value of `Nothing` is used for the variables, which has the effect of updating the data with a database `NULL` value.</span></span> <span data-ttu-id="32967-294">也就是說，我們的程式碼會將空字串轉換為資料庫 `NULL` 值，這是 GridView、DetailsView 和 FormView 控制項中編輯介面的預設行為。</span><span class="sxs-lookup"><span data-stu-id="32967-294">That is, our code treats converts empty strings to database `NULL` values, which is the default behavior of the editing interface in the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="32967-295">讀取值之後，會呼叫 `ProductsBLL` 類別的 `UpdateProduct` 方法，並傳入產品的名稱、價格和 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="32967-295">After reading the values, the `ProductsBLL` class s `UpdateProduct` method is called, passing in the product s name, price, and `ProductID`.</span></span> <span data-ttu-id="32967-296">事件處理常式會藉由使用與 `CancelCommand` 事件處理常式中完全相同的邏輯，將 DataList 傳回其預先編輯狀態來完成。</span><span class="sxs-lookup"><span data-stu-id="32967-296">The event handler completes by returning the DataList to its pre-editing state using the exact same logic as in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="32967-297">在 `EditCommand`、`CancelCommand`和 `UpdateCommand` 事件處理常式完成後，訪客可以編輯產品的名稱和價格。</span><span class="sxs-lookup"><span data-stu-id="32967-297">With the `EditCommand`, `CancelCommand`, and `UpdateCommand` event handlers complete, a visitor can edit the name and price of a product.</span></span> <span data-ttu-id="32967-298">[圖 14-16] 顯示此編輯工作流程的作用中。</span><span class="sxs-lookup"><span data-stu-id="32967-298">Figures 14-16 show this editing workflow in action.</span></span>

<span data-ttu-id="32967-299">[![第一次造訪網頁時，所有產品都處於唯讀模式](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="32967-299">[![When First Visiting the Page, All Products are in Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image34.png)</span></span>

<span data-ttu-id="32967-300">**圖 14**：第一次造訪網頁時，所有產品都處於唯讀模式（[按一下以觀看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-300">**Figure 14**: When First Visiting the Page, All Products are in Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image36.png))</span></span>

<span data-ttu-id="32967-301">[![若要更新產品的名稱或價格，請按一下 [編輯] 按鈕](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="32967-301">[![To Update a Product s Name or Price, Click the Edit Button](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image37.png)</span></span>

<span data-ttu-id="32967-302">**圖 15**：若要更新產品的名稱或價格，請按一下 [編輯] 按鈕（[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-302">**Figure 15**: To Update a Product s Name or Price, Click the Edit Button ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image39.png))</span></span>

<span data-ttu-id="32967-303">[![變更值之後，請按一下 [更新] 回到唯讀模式](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="32967-303">[![After Changing the Value, Click Update to Return to the Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image40.png)</span></span>

<span data-ttu-id="32967-304">**圖 16**：變更值之後，請按一下 [更新] 回到唯讀模式（[按一下以查看完整大小的影像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="32967-304">**Figure 16**: After Changing the Value, Click Update to Return to the Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image42.png))</span></span>

## <a name="step-7-adding-delete-capabilities"></a><span data-ttu-id="32967-305">步驟7：新增刪除功能</span><span class="sxs-lookup"><span data-stu-id="32967-305">Step 7: Adding Delete Capabilities</span></span>

<span data-ttu-id="32967-306">將刪除功能新增至 DataList 的步驟類似于新增編輯功能。</span><span class="sxs-lookup"><span data-stu-id="32967-306">The steps for adding delete capabilities to a DataList are similar to those for adding editing capabilities.</span></span> <span data-ttu-id="32967-307">簡單地說，我們必須在按一下時，將 [刪除] 按鈕新增至 `ItemTemplate`：</span><span class="sxs-lookup"><span data-stu-id="32967-307">In short, we need to add a Delete button to the `ItemTemplate` that, when clicked:</span></span>

1. <span data-ttu-id="32967-308">透過 `DataKeys` 集合，讀取對應產品的 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="32967-308">Reads in the corresponding product s `ProductID` via the `DataKeys` collection.</span></span>
2. <span data-ttu-id="32967-309">藉由呼叫 `ProductsBLL` 類別 s `DeleteProduct` 方法來執行刪除。</span><span class="sxs-lookup"><span data-stu-id="32967-309">Performs the delete by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>
3. <span data-ttu-id="32967-310">將資料重新系結至 DataList。</span><span class="sxs-lookup"><span data-stu-id="32967-310">Rebinds the data to the DataList.</span></span>

<span data-ttu-id="32967-311">首先，將 [刪除] 按鈕新增至 [`ItemTemplate`]。</span><span class="sxs-lookup"><span data-stu-id="32967-311">Let s start by adding a Delete button to the `ItemTemplate`.</span></span>

<span data-ttu-id="32967-312">按一下時，`CommandName` 為 [編輯]、[更新] 或 [取消] 的按鈕會引發 DataList s `ItemCommand` 事件以及額外的事件（例如，使用 [編輯] 時，也會引發 `EditCommand` 事件）。</span><span class="sxs-lookup"><span data-stu-id="32967-312">When clicked, a Button whose `CommandName` is Edit, Update, or Cancel raises the DataList s `ItemCommand` event along with an additional event (for example, when using Edit the `EditCommand` event is raised as well).</span></span> <span data-ttu-id="32967-313">同樣地，DataList 中其 `CommandName` 屬性設為 Delete 的任何按鈕、LinkButton 或 ImageButton，都會引發 `DeleteCommand` 事件（以及 `ItemCommand`）。</span><span class="sxs-lookup"><span data-stu-id="32967-313">Similarly, any Button, LinkButton, or ImageButton in the DataList whose `CommandName` property is set to Delete causes the `DeleteCommand` event to fire (along with `ItemCommand`).</span></span>

<span data-ttu-id="32967-314">在 `ItemTemplate`中的 [編輯] 按鈕旁新增 [刪除] 按鈕，並將其 `CommandName` 屬性設定為 [刪除]。</span><span class="sxs-lookup"><span data-stu-id="32967-314">Add a Delete button next to the Edit button in the `ItemTemplate`, setting its `CommandName` property to Delete.</span></span> <span data-ttu-id="32967-315">新增此按鈕控制項之後，您的 DataList `ItemTemplate` 宣告式語法應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="32967-315">After adding this Button control your DataList s `ItemTemplate` declarative syntax should look like:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample7.aspx)]

<span data-ttu-id="32967-316">接下來，使用下列程式碼建立 DataList s `DeleteCommand` 事件的事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="32967-316">Next, create an event handler for the DataList s `DeleteCommand` event, using the following code:</span></span>

[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample8.vb)]

<span data-ttu-id="32967-317">按一下 [刪除] 按鈕會導致回傳，並引發 DataList s `DeleteCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="32967-317">Clicking the Delete button causes a postback and fires the DataList s `DeleteCommand` event.</span></span> <span data-ttu-id="32967-318">在事件處理常式中，按下的 product s `ProductID` 值會從 `DataKeys` 集合存取。</span><span class="sxs-lookup"><span data-stu-id="32967-318">In the event handler, the clicked product s `ProductID` value is accessed from the `DataKeys` collection.</span></span> <span data-ttu-id="32967-319">接下來，藉由呼叫 `ProductsBLL` 類別 s `DeleteProduct` 方法來刪除產品。</span><span class="sxs-lookup"><span data-stu-id="32967-319">Next, the product is deleted by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>

<span data-ttu-id="32967-320">刪除產品之後，請務必將資料重新系結至 DataList （`DataList1.DataBind()`），否則 DataList 會繼續顯示剛刪除的產品。</span><span class="sxs-lookup"><span data-stu-id="32967-320">After deleting the product, it s important that we rebind the data to the DataList (`DataList1.DataBind()`), otherwise the DataList will continue to show the product that was just deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="32967-321">總結</span><span class="sxs-lookup"><span data-stu-id="32967-321">Summary</span></span>

<span data-ttu-id="32967-322">雖然 DataList 缺少點，並按一下 [編輯] 和 [刪除 GridView 滿意的支援]，但有一個簡單的程式碼可加以增強，以包含這些功能。</span><span class="sxs-lookup"><span data-stu-id="32967-322">While the DataList lacks the point and click editing and deleting support enjoyed by the GridView, with a short bit of code it can be enhanced to include these features.</span></span> <span data-ttu-id="32967-323">在本教學課程中，我們已瞭解如何建立可刪除的兩欄式產品清單，並可編輯其名稱和價格。</span><span class="sxs-lookup"><span data-stu-id="32967-323">In this tutorial we saw how to create a two-column listing of products that could be deleted and whose name and price could be edited.</span></span> <span data-ttu-id="32967-324">新增編輯和刪除支援的方式，是將適當的 Web 控制項包含在 `ItemTemplate` 和 `EditItemTemplate`中、建立對應的事件處理常式、讀取使用者輸入的和主要金鑰值，以及與商務邏輯層互動。</span><span class="sxs-lookup"><span data-stu-id="32967-324">Adding editing and deleting support is a matter of including the appropriate Web controls in the `ItemTemplate` and `EditItemTemplate`, creating the corresponding event handlers, reading the user-entered and primary key values, and interfacing with the Business Logic Layer.</span></span>

<span data-ttu-id="32967-325">雖然我們已在 DataList 中新增基本的編輯和刪除功能，但它缺乏更多的先進功能。</span><span class="sxs-lookup"><span data-stu-id="32967-325">While we have added basic editing and deleting capabilities to the DataList, it lacks more advanced features.</span></span> <span data-ttu-id="32967-326">例如，沒有輸入欄位驗證-如果使用者輸入太昂貴的價格，當嘗試將太昂貴的資源轉換成 `Decimal`時，`Decimal.Parse` 會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="32967-326">For example, there is no input field validation - if a user enters a price of Too expensive, an exception will be thrown by `Decimal.Parse` when attempting to convert Too expensive into a `Decimal`.</span></span> <span data-ttu-id="32967-327">同樣地，如果在商務邏輯或資料存取層更新資料時發生問題，使用者將會看到標準錯誤畫面。</span><span class="sxs-lookup"><span data-stu-id="32967-327">Similarly, if there is a problem in updating the data at the Business Logic or Data Access Layers the user will be presented with the standard error screen.</span></span> <span data-ttu-id="32967-328">若未在 [刪除] 按鈕上進行任何確認，則不小心刪除產品會很有可能。</span><span class="sxs-lookup"><span data-stu-id="32967-328">Without any sort of confirmation on the Delete button, accidentally deleting a product is all too likely.</span></span>

<span data-ttu-id="32967-329">在未來的教學課程中，我們將瞭解如何改善編輯使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="32967-329">In future tutorials we'll see how to improve the editing user experience.</span></span>

<span data-ttu-id="32967-330">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="32967-330">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="32967-331">關於作者</span><span class="sxs-lookup"><span data-stu-id="32967-331">About the Author</span></span>

<span data-ttu-id="32967-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="32967-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="32967-333">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="32967-333">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="32967-334">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="32967-334">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="32967-335">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="32967-335">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="32967-336">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="32967-336">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="32967-337">特別感謝</span><span class="sxs-lookup"><span data-stu-id="32967-337">Special Thanks To</span></span>

<span data-ttu-id="32967-338">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="32967-338">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="32967-339">本教學課程的領導審查者為 Zack，Pespisa 和 Randy Schmidt。</span><span class="sxs-lookup"><span data-stu-id="32967-339">Lead reviewers for this tutorial were Zack Jones, Ken Pespisa, and Randy Schmidt.</span></span> <span data-ttu-id="32967-340">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="32967-340">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="32967-341">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="32967-341">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="32967-342">[上一頁](customizing-the-datalist-s-editing-interface-cs.md)
> [下一頁](performing-batch-updates-vb.md)</span><span class="sxs-lookup"><span data-stu-id="32967-342">[Previous](customizing-the-datalist-s-editing-interface-cs.md)
[Next](performing-batch-updates-vb.md)</span></span>
