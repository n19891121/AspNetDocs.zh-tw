---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/adding-validation-controls-to-the-datalist-s-editing-interface-cs
title: 將驗證控制項新增至 DataList 的編輯介面（C#） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將瞭解如何輕鬆地將驗證控制項新增至 DataList 的 EditItemTemplate，以便提供更可靠的編輯使用者 int 。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 3ecc21c5-da0e-40ab-abb4-fac1e47398ad
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/adding-validation-controls-to-the-datalist-s-editing-interface-cs
msc.type: authoredcontent
ms.openlocfilehash: e3c14b7098da832bd28f57026e81dcb7f7ba7130
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78594483"
---
# <a name="adding-validation-controls-to-the-datalists-editing-interface-c"></a><span data-ttu-id="43598-103">將驗證控制項新增至 DataList 的編輯介面 (C#)</span><span class="sxs-lookup"><span data-stu-id="43598-103">Adding Validation Controls to the DataList's Editing Interface (C#)</span></span>

<span data-ttu-id="43598-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="43598-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="43598-105">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_39_CS.exe)或[下載 PDF](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/datatutorial39cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="43598-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_39_CS.exe) or [Download PDF](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/datatutorial39cs1.pdf)</span></span>

> <span data-ttu-id="43598-106">在本教學課程中，我們將瞭解如何輕鬆地將驗證控制項新增至 DataList 的 EditItemTemplate，以提供更可靠的編輯使用者介面。</span><span class="sxs-lookup"><span data-stu-id="43598-106">In this tutorial we'll see how easy it is to add validation controls to the DataList's EditItemTemplate in order to provide a more foolproof editing user interface.</span></span>

## <a name="introduction"></a><span data-ttu-id="43598-107">簡介</span><span class="sxs-lookup"><span data-stu-id="43598-107">Introduction</span></span>

<span data-ttu-id="43598-108">到目前為止，在 DataList 編輯教學課程中，DataLists 編輯介面尚未包含任何主動式使用者輸入驗證，即使不正確使用者輸入（例如遺失的產品名稱或負價）也會造成例外狀況。</span><span class="sxs-lookup"><span data-stu-id="43598-108">In the DataList editing tutorials thus far, the DataLists editing interfaces have not included any proactive user input validation even though invalid user input such as a missing product name or negative price results in an exception.</span></span> <span data-ttu-id="43598-109">在[先前的教學](handling-bll-and-dal-level-exceptions-cs.md)課程中，我們已檢查如何將例外狀況處理常式代碼加入至 DataList s `UpdateCommand` 事件處理常式，以攔截並妥善顯示任何引發之例外狀況的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="43598-109">In the [preceding tutorial](handling-bll-and-dal-level-exceptions-cs.md) we examined how to add exception handling code to the DataList s `UpdateCommand` event handler in order to catch and gracefully display information about any exceptions that were raised.</span></span> <span data-ttu-id="43598-110">不過，在理想的情況下，編輯介面會包含驗證控制項，以防止使用者在一開始就輸入這類不正確資料。</span><span class="sxs-lookup"><span data-stu-id="43598-110">Ideally, however, the editing interface would include validation controls to prevent a user from entering such invalid data in the first place.</span></span>

<span data-ttu-id="43598-111">在本教學課程中，我們將瞭解如何輕鬆地將驗證控制項新增至 DataList s `EditItemTemplate`，以便提供更可靠的編輯使用者介面。</span><span class="sxs-lookup"><span data-stu-id="43598-111">In this tutorial we'll see how easy it is to add validation controls to the DataList s `EditItemTemplate` in order to provide a more foolproof editing user interface.</span></span> <span data-ttu-id="43598-112">具體來說，本教學課程會採用在上一個教學課程中建立的範例，並增強編輯介面以包含適當的驗證。</span><span class="sxs-lookup"><span data-stu-id="43598-112">Specifically, this tutorial takes the example created in the preceding tutorial and augments the editing interface to include appropriate validation.</span></span>

## <a name="step-1-replicating-the-example-fromhandling-bll--and-dal-level-exceptions"></a><span data-ttu-id="43598-113">步驟1：從[處理 BLL 和 DAL 層級的例外](handling-bll-and-dal-level-exceptions-cs.md)狀況複寫範例</span><span class="sxs-lookup"><span data-stu-id="43598-113">Step 1: Replicating the Example from[Handling BLL- and DAL-Level Exceptions](handling-bll-and-dal-level-exceptions-cs.md)</span></span>

<span data-ttu-id="43598-114">在[處理 BLL 和 DAL 層級的例外](handling-bll-and-dal-level-exceptions-cs.md)狀況教學課程中，我們建立了一個頁面，其中列出了兩個數據行、可編輯 DataList 中產品的名稱和價格。</span><span class="sxs-lookup"><span data-stu-id="43598-114">In the [Handling BLL- and DAL-Level Exceptions](handling-bll-and-dal-level-exceptions-cs.md) tutorial we created a page that listed the names and prices of the products in a two-column, editable DataList.</span></span> <span data-ttu-id="43598-115">本教學課程的目標是要增加 DataList 的編輯介面，以包含驗證控制項。</span><span class="sxs-lookup"><span data-stu-id="43598-115">Our goal for this tutorial is to augment the DataList s editing interface to include validation controls.</span></span> <span data-ttu-id="43598-116">特別是，我們的驗證邏輯將會：</span><span class="sxs-lookup"><span data-stu-id="43598-116">In particular, our validation logic will:</span></span>

- <span data-ttu-id="43598-117">需要提供產品的名稱</span><span class="sxs-lookup"><span data-stu-id="43598-117">Require that the product s name be provided</span></span>
- <span data-ttu-id="43598-118">請確定為價格輸入的值是有效的貨幣格式</span><span class="sxs-lookup"><span data-stu-id="43598-118">Ensure that the value entered for the price is a valid currency format</span></span>
- <span data-ttu-id="43598-119">請確定輸入的價格值大於或等於零，因為負值的 `UnitPrice` 值不合法</span><span class="sxs-lookup"><span data-stu-id="43598-119">Ensure that the value entered for the price is greater than or equal to zero, since a negative `UnitPrice` value is illegal</span></span>

<span data-ttu-id="43598-120">我們必須先從 [`EditDeleteDataList`] 資料夾中的 [`ErrorHandling.aspx`] 頁面，將範例複製到本教學課程 `UIValidation.aspx`的頁面，然後才能查看如何擴充先前的範例以包含驗證。</span><span class="sxs-lookup"><span data-stu-id="43598-120">Before we can look at augmenting the previous example to include validation, we first need to replicate the example from the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder to the page for this tutorial, `UIValidation.aspx`.</span></span> <span data-ttu-id="43598-121">為了達到此目的，我們必須同時複製 `ErrorHandling.aspx` 頁面的宣告式標記和其原始程式碼。</span><span class="sxs-lookup"><span data-stu-id="43598-121">To achieve this we need to copy over both the `ErrorHandling.aspx` page s declarative markup and its source code.</span></span> <span data-ttu-id="43598-122">請執行下列步驟，先複製宣告式標記：</span><span class="sxs-lookup"><span data-stu-id="43598-122">First copy over the declarative markup by performing the following steps:</span></span>

1. <span data-ttu-id="43598-123">在 Visual Studio 中開啟 [`ErrorHandling.aspx`] 頁面</span><span class="sxs-lookup"><span data-stu-id="43598-123">Open the `ErrorHandling.aspx` page in Visual Studio</span></span>
2. <span data-ttu-id="43598-124">移至頁面的宣告式標記（按一下頁面底部的 [來源] 按鈕）</span><span class="sxs-lookup"><span data-stu-id="43598-124">Go to the page s declarative markup (click on the Source button at the bottom of the page)</span></span>
3. <span data-ttu-id="43598-125">複製 `<asp:Content>` 內的文字，然後 `</asp:Content>` 標記（第3行到32），如 [圖 1] 所示。</span><span class="sxs-lookup"><span data-stu-id="43598-125">Copy the text within the `<asp:Content>` and `</asp:Content>` tags (lines 3 through 32), as shown in Figure 1.</span></span>

<span data-ttu-id="43598-126">[![複製 &lt;asp： Content&gt; 控制項內的文字](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image2.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="43598-126">[![Copy the Text Within the &lt;asp:Content&gt; Control](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image2.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image1.png)</span></span>

<span data-ttu-id="43598-127">**圖 1**：複製 `<asp:Content>` 控制項內的文字（[按一下以查看完整大小的影像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="43598-127">**Figure 1**: Copy the Text Within the `<asp:Content>` Control ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image3.png))</span></span>

1. <span data-ttu-id="43598-128">開啟 [`UIValidation.aspx`] 頁面</span><span class="sxs-lookup"><span data-stu-id="43598-128">Open the `UIValidation.aspx` page</span></span>
2. <span data-ttu-id="43598-129">移至頁面的宣告式標記</span><span class="sxs-lookup"><span data-stu-id="43598-129">Go to the page s declarative markup</span></span>
3. <span data-ttu-id="43598-130">貼上 `<asp:Content>` 控制項內的文字。</span><span class="sxs-lookup"><span data-stu-id="43598-130">Paste the text within the `<asp:Content>` control.</span></span>

<span data-ttu-id="43598-131">若要複製原始碼，請開啟 [`ErrorHandling.aspx.vb`] 頁面，並只複製 `EditDeleteDataList_ErrorHandling` 類別*中*的文字。</span><span class="sxs-lookup"><span data-stu-id="43598-131">To copy over the source code, open the `ErrorHandling.aspx.vb` page and copy just the text *within* the `EditDeleteDataList_ErrorHandling` class.</span></span> <span data-ttu-id="43598-132">將三個事件處理常式（`Products_EditCommand`、`Products_CancelCommand`和 `Products_UpdateCommand`）連同 `DisplayExceptionDetails` 方法**一起複製，但不要複製類別**宣告或 `using` 語句。</span><span class="sxs-lookup"><span data-stu-id="43598-132">Copy the three event handlers (`Products_EditCommand`, `Products_CancelCommand`, and `Products_UpdateCommand`) along with the `DisplayExceptionDetails` method, but do **not** copy the class declaration or `using` statements.</span></span> <span data-ttu-id="43598-133">將複製的文字貼入 `UIValidation.aspx.vb`的 `EditDeleteDataList_UIValidation`*類別中。*</span><span class="sxs-lookup"><span data-stu-id="43598-133">Paste the copied text *within* the `EditDeleteDataList_UIValidation` class in `UIValidation.aspx.vb`.</span></span>

<span data-ttu-id="43598-134">將內容和程式碼從 `ErrorHandling.aspx` 移至 `UIValidation.aspx`之後，請花點時間在瀏覽器中測試頁面。</span><span class="sxs-lookup"><span data-stu-id="43598-134">After moving over the content and code from `ErrorHandling.aspx` to `UIValidation.aspx`, take a moment to test out the pages in a browser.</span></span> <span data-ttu-id="43598-135">您應該會看到相同的輸出，並在這兩個頁面中體驗相同的功能（請參閱 [圖 2]）。</span><span class="sxs-lookup"><span data-stu-id="43598-135">You should see the same output and experience the same functionality in each of these two pages (see Figure 2).</span></span>

<span data-ttu-id="43598-136">[![UIValidation ErrorHandling 中的功能。](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image5.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="43598-136">[![The UIValidation.aspx Page Mimics the Functionality in ErrorHandling.aspx](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image5.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image4.png)</span></span>

<span data-ttu-id="43598-137">**圖 2**： [`UIValidation.aspx`] 頁面會模擬 `ErrorHandling.aspx` 中的功能（[按一下以觀看完整大小的影像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="43598-137">**Figure 2**: The `UIValidation.aspx` Page Mimics the Functionality in `ErrorHandling.aspx` ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image6.png))</span></span>

## <a name="step-2-adding-the-validation-controls-to-the-datalist-s-edititemtemplate"></a><span data-ttu-id="43598-138">步驟2：將驗證控制項新增至 DataList s EditItemTemplate</span><span class="sxs-lookup"><span data-stu-id="43598-138">Step 2: Adding the Validation Controls to the DataList s EditItemTemplate</span></span>

<span data-ttu-id="43598-139">在建立資料輸入表單時，使用者必須輸入任何必要的欄位，而且其提供的所有輸入都是合法的正確格式值。</span><span class="sxs-lookup"><span data-stu-id="43598-139">When constructing data entry forms, it is important that users enter any required fields and that all their provided inputs are legal, properly-formatted values.</span></span> <span data-ttu-id="43598-140">為了協助確保使用者的輸入有效，ASP.NET 提供五個內建的驗證控制項，其設計目的是要驗證單一輸入 Web 控制項的值：</span><span class="sxs-lookup"><span data-stu-id="43598-140">To help ensure that a user s inputs are valid, ASP.NET provides five built-in validation controls that are designed to validate the value of a single input Web control:</span></span>

- <span data-ttu-id="43598-141">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx)可確保已提供值</span><span class="sxs-lookup"><span data-stu-id="43598-141">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx) ensures that a value has been provided</span></span>
- <span data-ttu-id="43598-142">[CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx)會根據另一個 Web 控制值或常數值來驗證值，或確保值 s 格式對於指定的資料類型是合法的</span><span class="sxs-lookup"><span data-stu-id="43598-142">[CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx) validates a value against another Web control value or a constant value, or ensures that the value s format is legal for a specified data type</span></span>
- <span data-ttu-id="43598-143">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx)可確保值在值的範圍內</span><span class="sxs-lookup"><span data-stu-id="43598-143">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx) ensures that a value is within a range of values</span></span>
- <span data-ttu-id="43598-144">[RegularExpressionValidator](https://msdn.microsoft.com/library/eahwtc9e.aspx)會根據[正則運算式](http://en.wikipedia.org/wiki/Regular_expression)來驗證值</span><span class="sxs-lookup"><span data-stu-id="43598-144">[RegularExpressionValidator](https://msdn.microsoft.com/library/eahwtc9e.aspx) validates a value against a [regular expression](http://en.wikipedia.org/wiki/Regular_expression)</span></span>
- <span data-ttu-id="43598-145">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx)會根據自訂的使用者定義方法來驗證值</span><span class="sxs-lookup"><span data-stu-id="43598-145">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx) validates a value against a custom, user-defined method</span></span>

<span data-ttu-id="43598-146">如需這五個控制項的詳細資訊，請參閱將[驗證控制項新增至編輯和插入介面](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)教學課程或查看[ASP.NET 快速入門教學](https://quickstarts.asp.net)課程的[驗證控制項一節](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/validation/default.aspx)。</span><span class="sxs-lookup"><span data-stu-id="43598-146">For more information on these five controls refer back to the [Adding Validation Controls to the Editing and Inserting Interfaces](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md) tutorial or check out the [Validation Controls section](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/validation/default.aspx) of the [ASP.NET Quickstart Tutorials](https://quickstarts.asp.net).</span></span>

<span data-ttu-id="43598-147">在本教學課程中，我們必須使用 RequiredFieldValidator 來確保已提供產品名稱的值和 CompareValidator，以確保輸入的價格具有大於或等於0的值，並以有效的貨幣格式呈現。</span><span class="sxs-lookup"><span data-stu-id="43598-147">For our tutorial we'll need to use a RequiredFieldValidator to ensure that a value for the product name has been supplied and a CompareValidator to ensure that the entered price has a value greater than or equal to 0 and is presented in a valid currency format.</span></span>

> [!NOTE]
> <span data-ttu-id="43598-148">雖然 ASP.NET 1.x 具有這五個相同的驗證控制項，但 ASP.NET 2.0 已新增一些改良功能，主要兩個都是除了 Internet Explorer 之外，也是用戶端腳本支援的瀏覽器，而且能夠將頁面上的驗證控制項分割成驗證群組。</span><span class="sxs-lookup"><span data-stu-id="43598-148">While ASP.NET 1.x had these same five validation controls, ASP.NET 2.0 has added a number of improvements, the main two being client-side script support for browsers in addition to Internet Explorer and the ability to partition validation controls on a page into validation groups.</span></span> <span data-ttu-id="43598-149">如需2.0 中新驗證控制功能的詳細資訊，請參閱[剖析 the ASP.NET 2.0 中的驗證控制項](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="43598-149">For more information on the new validation control features in 2.0, refer to [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx).</span></span>

<span data-ttu-id="43598-150">首先，將必要的驗證控制項新增至 DataList s `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="43598-150">Let s start by adding the necessary validation controls to the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="43598-151">這項工作可以透過設計工具執行，方法是按一下 DataList s 智慧標籤中的 [編輯範本] 連結，或透過宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="43598-151">This task can be performed through the Designer by clicking on the Edit Templates link from the DataList s smart tag, or through the declarative syntax.</span></span> <span data-ttu-id="43598-152">讓我們使用 設計檢視中的 編輯範本 選項來逐步執行進程。</span><span class="sxs-lookup"><span data-stu-id="43598-152">Let s step through the process using the Edit Templates option from the Design view.</span></span> <span data-ttu-id="43598-153">選擇編輯 DataList s `EditItemTemplate`之後，請將它從 [工具箱] 拖曳到範本編輯介面，然後將它放在 [`ProductName`] 文字方塊後面，以加入 RequiredFieldValidator。</span><span class="sxs-lookup"><span data-stu-id="43598-153">After choosing to edit the DataList s `EditItemTemplate`, add a RequiredFieldValidator by dragging it from the Toolbox into the template editing interface, placing it after the `ProductName` TextBox.</span></span>

<span data-ttu-id="43598-154">[![在 [ProductName] 文字方塊之後將 RequiredFieldValidator 新增至 EditItemTemplate](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image8.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="43598-154">[![Add a RequiredFieldValidator to the EditItemTemplate After the ProductName TextBox](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image8.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image7.png)</span></span>

<span data-ttu-id="43598-155">**圖 3**：將 RequiredFieldValidator 新增至 [`ProductName`] 文字方塊 `EditItemTemplate After` （[按一下以查看完整大小的影像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="43598-155">**Figure 3**: Add a RequiredFieldValidator to the `EditItemTemplate After` the `ProductName` TextBox ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image9.png))</span></span>

<span data-ttu-id="43598-156">所有驗證控制項都可以藉由驗證單一 ASP.NET Web 控制項的輸入來執行。</span><span class="sxs-lookup"><span data-stu-id="43598-156">All validation controls work by validating the input of a single ASP.NET Web control.</span></span> <span data-ttu-id="43598-157">因此，我們必須指出剛才新增的 RequiredFieldValidator 應該根據 `ProductName` TextBox 進行驗證;做法是將 [驗證控制] [`ControlToValidate` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx)設定為適當 Web 控制項（在此例中為`ProductName`）的 `ID`。</span><span class="sxs-lookup"><span data-stu-id="43598-157">Therefore, we need to indicate that the RequiredFieldValidator we just added should validate against the `ProductName` TextBox; this is done by setting the validation control s [`ControlToValidate` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx) to the `ID` of the appropriate Web control (`ProductName`, in this instance).</span></span> <span data-ttu-id="43598-158">接下來，將[`ErrorMessage` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx)設定為，您必須將產品的名稱和[`Text` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx)提供給 \*。</span><span class="sxs-lookup"><span data-stu-id="43598-158">Next, set the [`ErrorMessage` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx) to You must provide the product s name and the [`Text` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx) to \*.</span></span> <span data-ttu-id="43598-159">如果有提供 `Text` 屬性值，就是驗證控制項在驗證失敗時所顯示的文字。</span><span class="sxs-lookup"><span data-stu-id="43598-159">The `Text` property value, if provided, is the text that is displayed by the validation control if the validation fails.</span></span> <span data-ttu-id="43598-160">ValidationSummary 控制項會使用所需的 `ErrorMessage` 屬性值;如果省略 `Text` 屬性值，驗證控制項就會在不正確輸入上顯示 `ErrorMessage` 屬性值。</span><span class="sxs-lookup"><span data-stu-id="43598-160">The `ErrorMessage` property value, which is required, is used by the ValidationSummary control; if the `Text` property value is omitted, the `ErrorMessage` property value is displayed by the validation control on invalid input.</span></span>

<span data-ttu-id="43598-161">設定 RequiredFieldValidator 的這三個屬性之後，您的畫面看起來應該像 [圖 4]。</span><span class="sxs-lookup"><span data-stu-id="43598-161">After setting these three properties of the RequiredFieldValidator, your screen should look similar to Figure 4.</span></span>

<span data-ttu-id="43598-162">[![設定 RequiredFieldValidator s ControlToValidate、ErrorMessage 和 Text 屬性](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image11.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="43598-162">[![Set the RequiredFieldValidator s ControlToValidate, ErrorMessage, and Text Properties](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image11.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image10.png)</span></span>

<span data-ttu-id="43598-163">**圖 4**：設定 RequiredFieldValidator 的 `ControlToValidate`、`ErrorMessage`和 `Text` 屬性（[按一下以查看完整大小的影像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="43598-163">**Figure 4**: Set the RequiredFieldValidator s `ControlToValidate`, `ErrorMessage`, and `Text` Properties ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image12.png))</span></span>

<span data-ttu-id="43598-164">將 RequiredFieldValidator 新增至 `EditItemTemplate`之後，剩下的工作就是為 [產品的價格] 文字方塊新增必要的驗證。</span><span class="sxs-lookup"><span data-stu-id="43598-164">With the RequiredFieldValidator added to the `EditItemTemplate`, all that remains is to add the necessary validation for the product s price TextBox.</span></span> <span data-ttu-id="43598-165">因為在編輯記錄時，`UnitPrice` 是選擇性的，所以我們不需要新增 RequiredFieldValidator。</span><span class="sxs-lookup"><span data-stu-id="43598-165">Since the `UnitPrice` is optional when editing a record, we don t need to add a RequiredFieldValidator.</span></span> <span data-ttu-id="43598-166">不過，我們需要新增 CompareValidator，以確保 `UnitPrice`（如有提供）會正確地格式化為貨幣且大於或等於0。</span><span class="sxs-lookup"><span data-stu-id="43598-166">We do, however, need to add a CompareValidator to ensure that the `UnitPrice`, if supplied, is properly formatted as a currency and is greater than or equal to 0.</span></span>

<span data-ttu-id="43598-167">將 CompareValidator 新增至 `EditItemTemplate`，並將其 [`ControlToValidate`] 屬性設定為 [`UnitPrice`]，其 [`ErrorMessage`] 屬性必須大於或等於零，而且不能包含貨幣符號和其 [`Text`] 屬性為 [\*]。</span><span class="sxs-lookup"><span data-stu-id="43598-167">Add the CompareValidator into the `EditItemTemplate` and set its `ControlToValidate` property to `UnitPrice`, its `ErrorMessage` property to The price must be greater than or equal to zero and cannot include the currency symbol, and its `Text` property to \*.</span></span> <span data-ttu-id="43598-168">若要指出 `UnitPrice` 值必須大於或等於0，請將 CompareValidator s [`Operator` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx)設定為 `GreaterThanEqual`、將其[`ValueToCompare` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx)設為0，並將其[`Type` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx)設定為 `Currency`。</span><span class="sxs-lookup"><span data-stu-id="43598-168">To indicate that the `UnitPrice` value must be greater than or equal to 0, set the CompareValidator s [`Operator` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx) to `GreaterThanEqual`, its [`ValueToCompare` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx) to 0, and its [`Type` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx) to `Currency`.</span></span>

<span data-ttu-id="43598-169">加入這兩個驗證控制項之後，DataList s `EditItemTemplate` 的宣告式語法看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="43598-169">After adding these two validation controls, the DataList s `EditItemTemplate` s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-datalist-s-editing-interface-cs/samples/sample1.aspx)]

<span data-ttu-id="43598-170">進行這些變更之後，請在瀏覽器中開啟頁面。</span><span class="sxs-lookup"><span data-stu-id="43598-170">After making these changes, open the page in a browser.</span></span> <span data-ttu-id="43598-171">如果您嘗試在編輯產品時省略名稱或輸入不正確價格值，則文字方塊旁會出現星號。</span><span class="sxs-lookup"><span data-stu-id="43598-171">If you attempt to omit the name or enter an invalid price value when editing a product, an asterisk appears next to the textbox.</span></span> <span data-ttu-id="43598-172">如 [圖 5] 所示，包含貨幣符號（例如 $19.95）的價格值會被視為無效。</span><span class="sxs-lookup"><span data-stu-id="43598-172">As Figure 5 shows, a price value that includes the currency symbol such as $19.95 is considered invalid.</span></span> <span data-ttu-id="43598-173">CompareValidator s `Currency` `Type` 允許數位分隔符號（例如逗號或句號，視文化特性設定而定）和前置加號或負號，但*不允許貨幣*符號。</span><span class="sxs-lookup"><span data-stu-id="43598-173">The CompareValidator s `Currency` `Type` allows for digit separators (such as commas or periods, depending on the culture settings) and a leading plus or minus sign, but does *not* permit a currency symbol.</span></span> <span data-ttu-id="43598-174">這種行為可能會 perplex 使用者，因為編輯介面目前使用貨幣格式呈現 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="43598-174">This behavior may perplex users as the editing interface currently renders the `UnitPrice` using the currency format.</span></span>

<span data-ttu-id="43598-175">[![星號會出現在具有無效輸入的文字方塊旁邊](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image14.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="43598-175">[![An Asterisk Appears Next to the Textboxes with Invalid Input](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image14.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image13.png)</span></span>

<span data-ttu-id="43598-176">**圖 5**：具有無效輸入的文字方塊旁邊會出現星號（[按一下以查看完整大小的影像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="43598-176">**Figure 5**: An Asterisk Appears Next to the Textboxes with Invalid Input ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image15.png))</span></span>

<span data-ttu-id="43598-177">雖然驗證的運作方式不盡相同，但在編輯記錄時，使用者必須手動移除貨幣符號，這是無法接受的。</span><span class="sxs-lookup"><span data-stu-id="43598-177">While the validation works as-is, the user has to manually remove the currency symbol when editing a record, which is not acceptable.</span></span> <span data-ttu-id="43598-178">此外，如果在編輯介面中有不正確輸入，當您按一下時，[更新] 或 [取消] 按鈕都不會叫用回傳。</span><span class="sxs-lookup"><span data-stu-id="43598-178">Moreover, if there are invalid inputs in the editing interface neither the Update nor Cancel buttons, when clicked, will invoke a postback.</span></span> <span data-ttu-id="43598-179">在理想的情況下，[取消] 按鈕會將 DataList 傳回其預先編輯狀態，而不論使用者的輸入是否有效。</span><span class="sxs-lookup"><span data-stu-id="43598-179">Ideally, the Cancel button would return the DataList to its pre-editing state regardless of the validity of the user s inputs.</span></span> <span data-ttu-id="43598-180">此外，我們必須先確定頁面的資料有效，再更新 DataList s `UpdateCommand` 事件處理常式中的產品資訊，因為瀏覽器不支援 JavaScript 或停用其支援的使用者可能會略過驗證控制項用戶端邏輯。</span><span class="sxs-lookup"><span data-stu-id="43598-180">Also, we need to ensure that the page s data is valid before updating the product information in the DataList s `UpdateCommand` event handler, as the validation controls client-side logic can be bypassed by users whose browsers either don t support JavaScript or have its support disabled.</span></span>

## <a name="removing-the-currency-symbol-from-the-edititemtemplate-s-unitprice-textbox"></a><span data-ttu-id="43598-181">從 [EditItemTemplate] 的 [單價] 文字方塊移除貨幣符號</span><span class="sxs-lookup"><span data-stu-id="43598-181">Removing the Currency Symbol from the EditItemTemplate s UnitPrice TextBox</span></span>

<span data-ttu-id="43598-182">使用 CompareValidator `Currency``Type`時，所驗證的輸入不能包含任何貨幣符號。</span><span class="sxs-lookup"><span data-stu-id="43598-182">When using the CompareValidator s `Currency``Type`, the input being validated must not include any currency symbols.</span></span> <span data-ttu-id="43598-183">這類符號的存在會導致 CompareValidator 將輸入標記為無效。</span><span class="sxs-lookup"><span data-stu-id="43598-183">The presence of such symbols causes the CompareValidator to mark the input as invalid.</span></span> <span data-ttu-id="43598-184">不過，我們的編輯介面目前在 [`UnitPrice`] 文字方塊中包含貨幣符號，這表示使用者必須明確地移除貨幣符號，才能儲存其變更。</span><span class="sxs-lookup"><span data-stu-id="43598-184">However, our editing interface currently includes a currency symbol in the `UnitPrice` TextBox, meaning the user must explicitly remove the currency symbol before saving their changes.</span></span> <span data-ttu-id="43598-185">若要解決這個問題，我們有三個選項：</span><span class="sxs-lookup"><span data-stu-id="43598-185">To remedy this we have three options:</span></span>

1. <span data-ttu-id="43598-186">設定 `EditItemTemplate`，讓 `UnitPrice` TextBox 值不會格式化為貨幣。</span><span class="sxs-lookup"><span data-stu-id="43598-186">Configure the `EditItemTemplate` so that the `UnitPrice` TextBox value is not formatted as a currency.</span></span>
2. <span data-ttu-id="43598-187">允許使用者藉由移除 CompareValidator 並以檢查正確格式貨幣值的 RegularExpressionValidator 取代它，來輸入貨幣符號。</span><span class="sxs-lookup"><span data-stu-id="43598-187">Allow the user to enter a currency symbol by removing the CompareValidator and replacing it with a RegularExpressionValidator that checks for a properly formatted currency value.</span></span> <span data-ttu-id="43598-188">這裡的挑戰在於，驗證貨幣值的正則運算式並不像 CompareValidator，而且如果我們想要納入文化特性設定，就需要撰寫程式碼。</span><span class="sxs-lookup"><span data-stu-id="43598-188">The challenge here is that the regular expression to validate a currency value is not as straightforward as the CompareValidator and would require writing code if we wanted to incorporate culture settings.</span></span>
3. <span data-ttu-id="43598-189">完全移除驗證控制項，並依賴 GridView s `RowUpdating` 事件處理常式中的自訂伺服器端驗證邏輯。</span><span class="sxs-lookup"><span data-stu-id="43598-189">Remove the validation control altogether and rely on custom server-side validation logic in the GridView s `RowUpdating` event handler.</span></span>

<span data-ttu-id="43598-190">讓我們在本教學課程中使用選項1。</span><span class="sxs-lookup"><span data-stu-id="43598-190">Let s go with option 1 for this tutorial.</span></span> <span data-ttu-id="43598-191">目前 `UnitPrice` 的格式為貨幣值，因為 `EditItemTemplate`中 TextBox 的資料系結運算式： `<%# Eval("UnitPrice", "{0:c}") %>`。</span><span class="sxs-lookup"><span data-stu-id="43598-191">Currently the `UnitPrice` is formatted as a currency value due to the databinding expression for the TextBox in the `EditItemTemplate`: `<%# Eval("UnitPrice", "{0:c}") %>`.</span></span> <span data-ttu-id="43598-192">將 `Eval` 語句變更為 `Eval("UnitPrice", "{0:n2}")`，將結果格式化為具有兩位數精確度的數位。</span><span class="sxs-lookup"><span data-stu-id="43598-192">Change the `Eval` statement to `Eval("UnitPrice", "{0:n2}")`, which formats the result as a number with two digits of precision.</span></span> <span data-ttu-id="43598-193">這可以直接透過宣告式語法，或從 DataList s `EditItemTemplate`的 [`UnitPrice`] 文字方塊中，按一下 [編輯系結] 連結來完成。</span><span class="sxs-lookup"><span data-stu-id="43598-193">This can be done directly through the declarative syntax or by clicking on the Edit DataBindings link from the `UnitPrice` TextBox in the DataList s `EditItemTemplate`.</span></span>

<span data-ttu-id="43598-194">透過這項變更，編輯介面中的格式化價格包括逗號做為群組分隔符號，並將句點當做小數分隔符號，但會保留貨幣符號。</span><span class="sxs-lookup"><span data-stu-id="43598-194">With this change, the formatted price in the editing interface includes commas as the group separator and a period as the decimal separator, but leaves off the currency symbol.</span></span>

> [!NOTE]
> <span data-ttu-id="43598-195">從可編輯的介面中移除貨幣格式時，我發現將貨幣符號放在文字方塊外的文字會很有説明。</span><span class="sxs-lookup"><span data-stu-id="43598-195">When removing the currency format from the editable interface, I find it helpful to put the currency symbol as text outside the TextBox.</span></span> <span data-ttu-id="43598-196">這是使用者不需要提供貨幣符號的提示。</span><span class="sxs-lookup"><span data-stu-id="43598-196">This serves as a hint to the user that they do not need to provide the currency symbol.</span></span>

## <a name="fixing-the-cancel-button"></a><span data-ttu-id="43598-197">修正 [取消] 按鈕</span><span class="sxs-lookup"><span data-stu-id="43598-197">Fixing the Cancel Button</span></span>

<span data-ttu-id="43598-198">根據預設，驗證 Web 控制項會發出 JavaScript，以在用戶端上執行驗證。</span><span class="sxs-lookup"><span data-stu-id="43598-198">By default, the validation Web controls emit JavaScript to perform validation on the client-side.</span></span> <span data-ttu-id="43598-199">按一下按鈕、LinkButton 或 ImageButton 時，會先在用戶端上檢查頁面上的驗證控制項，再進行回傳。</span><span class="sxs-lookup"><span data-stu-id="43598-199">When a Button, LinkButton, or ImageButton is clicked, the validation controls on the page are checked on the client-side before the postback occurs.</span></span> <span data-ttu-id="43598-200">如果有任何不正確資料，就會取消回傳。</span><span class="sxs-lookup"><span data-stu-id="43598-200">If there is any invalid data, the postback is cancelled.</span></span> <span data-ttu-id="43598-201">不過，對於某些按鈕而言，資料的有效性可能會並不重要;在這種情況下，由於不正確資料而取消回傳是一項干擾。</span><span class="sxs-lookup"><span data-stu-id="43598-201">For certain Buttons, though, the validity of the data might be immaterial; in such a case, having the postback cancelled due to invalid data is a nuisance.</span></span>

<span data-ttu-id="43598-202">[取消] 按鈕就是範例。</span><span class="sxs-lookup"><span data-stu-id="43598-202">The Cancel button is such an example.</span></span> <span data-ttu-id="43598-203">假設使用者輸入不正確資料（例如，省略產品的名稱），然後決定不想要在全部儲存產品後，再按 [取消] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="43598-203">Imagine that a user enters invalid data, such as omitting the product s name, and then decides she doesn t want to save the product after all and hits the Cancel button.</span></span> <span data-ttu-id="43598-204">目前，[取消] 按鈕會觸發頁面上的驗證控制項，這會報告產品名稱遺失，並導致無法回傳。</span><span class="sxs-lookup"><span data-stu-id="43598-204">Currently, the Cancel button triggers the validation controls on the page, which report that the product name is missing and prevent the postback.</span></span> <span data-ttu-id="43598-205">我們的使用者必須在 [`ProductName`] 文字方塊中輸入一些文字，才能取消編輯進程。</span><span class="sxs-lookup"><span data-stu-id="43598-205">Our user has to type some text into the `ProductName` TextBox just to cancel out of the editing process.</span></span>

<span data-ttu-id="43598-206">幸運的是，按鈕、LinkButton 和 ImageButton 都有一個[`CausesValidation` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.button.causesvalidation.aspx)，可指出按一下按鈕是否應起始驗證邏輯（預設為 `True`）。</span><span class="sxs-lookup"><span data-stu-id="43598-206">Fortunately, the Button, LinkButton, and ImageButton have a [`CausesValidation` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.button.causesvalidation.aspx) that can indicate whether or not clicking the Button should initiate the validation logic (defaults to `True`).</span></span> <span data-ttu-id="43598-207">將 [取消] 按鈕的 `CausesValidation` 屬性設定為 `False`。</span><span class="sxs-lookup"><span data-stu-id="43598-207">Set the Cancel Button s `CausesValidation` property to `False`.</span></span>

## <a name="ensuring-the-inputs-are-valid-in-the-updatecommand-event-handler"></a><span data-ttu-id="43598-208">確保輸入在 UpdateCommand 事件處理常式中有效</span><span class="sxs-lookup"><span data-stu-id="43598-208">Ensuring the Inputs are Valid in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="43598-209">由於驗證控制項發出的用戶端腳本，如果使用者輸入不正確輸入，驗證控制項會取消 `CausesValidation` 屬性 `True` （預設值）的 Button、LinkButton 或 ImageButton 控制項所起始的任何回傳。</span><span class="sxs-lookup"><span data-stu-id="43598-209">Due to the client-side script emitted by the validation controls, if a user enters invalid input the validation controls cancel any postbacks initiated by Button, LinkButton, or ImageButton controls whose `CausesValidation` properties are `True` (the default).</span></span> <span data-ttu-id="43598-210">不過，如果使用者造訪的是 antiquated 瀏覽器，或已停用其 JavaScript 支援的使用者，則不會執行用戶端驗證檢查。</span><span class="sxs-lookup"><span data-stu-id="43598-210">However, if a user is visiting with an antiquated browser or one whose JavaScript support has been disabled, the client-side validation checks will not execute.</span></span>

<span data-ttu-id="43598-211">所有的 ASP.NET 驗證控制項都會在回傳時立即重複其驗證邏輯，並透過[`Page.IsValid` 屬性](https://msdn.microsoft.com/library/system.web.ui.page.isvalid.aspx)報告網頁 s 輸入的整體有效性。</span><span class="sxs-lookup"><span data-stu-id="43598-211">All of the ASP.NET validation controls repeat their validation logic immediately upon postback and report the overall validity of the page s inputs via the [`Page.IsValid` property](https://msdn.microsoft.com/library/system.web.ui.page.isvalid.aspx).</span></span> <span data-ttu-id="43598-212">不過，根據 `Page.IsValid`的值，頁面流程不會以任何方式中斷或停止。</span><span class="sxs-lookup"><span data-stu-id="43598-212">However, the page flow is not interrupted or stopped in any way based on the value of `Page.IsValid`.</span></span> <span data-ttu-id="43598-213">身為開發人員，我們負責確保 `Page.IsValid` 屬性具有 `True` 的值，然後再繼續採用採用有效輸入資料的程式碼。</span><span class="sxs-lookup"><span data-stu-id="43598-213">As developers, it is our responsibility to ensure that the `Page.IsValid` property has a value of `True` before proceeding with code that assumes valid input data.</span></span>

<span data-ttu-id="43598-214">如果使用者已停用 JavaScript，請造訪我們的頁面、編輯產品、輸入太昂貴的價格值，然後按一下 [更新] 按鈕，就會略過用戶端驗證，而且會控制發生回傳。</span><span class="sxs-lookup"><span data-stu-id="43598-214">If a user has JavaScript disabled, visits our page, edits a product, enters a price value of Too expensive, and clicks the Update button, the client-side validation will be bypassed and a postback will ensue.</span></span> <span data-ttu-id="43598-215">在回傳時，ASP.NET page s `UpdateCommand` 事件處理常式會執行，而當嘗試剖析的 `Decimal`太昂貴時，就會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="43598-215">On postback, the ASP.NET page s `UpdateCommand` event handler executes and an exception is raised when attempting to parse Too expensive to a `Decimal`.</span></span> <span data-ttu-id="43598-216">因為我們有例外狀況處理，所以會正常處理這類例外狀況，但如果 `Page.IsValid` 的值為 `True`，則我們可以防止不正確資料在第一個位置 `UpdateCommand` 繼續進行。</span><span class="sxs-lookup"><span data-stu-id="43598-216">Since we have exception handling, such an exception will be handled gracefully, but we could prevent the invalid data from slipping through in the first place by only proceeding with the `UpdateCommand` event handler if `Page.IsValid` has a value of `True`.</span></span>

<span data-ttu-id="43598-217">將下列程式碼新增至 `UpdateCommand` 事件處理常式的開頭，緊接在 `Try` 區塊之前：</span><span class="sxs-lookup"><span data-stu-id="43598-217">Add the following code to the start of the `UpdateCommand` event handler, immediately before the `Try` block:</span></span>

[!code-csharp[Main](adding-validation-controls-to-the-datalist-s-editing-interface-cs/samples/sample2.cs)]

<span data-ttu-id="43598-218">透過這種新增，只有當提交的資料有效時，產品才會嘗試更新。</span><span class="sxs-lookup"><span data-stu-id="43598-218">With this addition, the product will attempt to be updated only if the submitted data is valid.</span></span> <span data-ttu-id="43598-219">大部分的使用者因為驗證控制項用戶端腳本而無法回傳不正確資料，但瀏覽器不支援 JavaScript 或已停用 JavaScript 支援的使用者，可以略過用戶端檢查並提交不正確資料。</span><span class="sxs-lookup"><span data-stu-id="43598-219">Most users won't be able to postback invalid data due to the validation controls client-side scripts, but users whose browsers don t support JavaScript or that have JavaScript support disabled, can bypass the client-side checks and submit invalid data.</span></span>

> [!NOTE]
> <span data-ttu-id="43598-220">精明讀取器會回想一下，當使用 GridView 更新資料時，我們不需要在頁面的程式碼後置類別中明確檢查 `Page.IsValid` 屬性。</span><span class="sxs-lookup"><span data-stu-id="43598-220">The astute reader will recall that when updating data with the GridView, we didn't need to explicitly check the `Page.IsValid` property in our page s code-behind class.</span></span> <span data-ttu-id="43598-221">這是因為 GridView 會為我們查閱 `Page.IsValid` 屬性，只有在傳回 `True`的值時，才會繼續進行更新。</span><span class="sxs-lookup"><span data-stu-id="43598-221">This is because the GridView consults the `Page.IsValid` property for us and only proceeds with the update only if it returns a value of `True`.</span></span>

## <a name="step-3-summarizing-data-entry-problems"></a><span data-ttu-id="43598-222">步驟3：摘要資料輸入問題</span><span class="sxs-lookup"><span data-stu-id="43598-222">Step 3: Summarizing Data Entry Problems</span></span>

<span data-ttu-id="43598-223">除了五個驗證控制項以外，ASP.NET 還包含[ValidationSummary 控制項](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx)，它會顯示偵測到無效資料之驗證控制項的 `ErrorMessage`。</span><span class="sxs-lookup"><span data-stu-id="43598-223">In addition to the five validation controls, ASP.NET includes the [ValidationSummary control](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx), which displays the `ErrorMessage` s of those validation controls that detected invalid data.</span></span> <span data-ttu-id="43598-224">此摘要資料可顯示為網頁上的文字，或透過強制回應的用戶端 messagebox。</span><span class="sxs-lookup"><span data-stu-id="43598-224">This summary data can be displayed as text on the web page or through a modal, client-side messagebox.</span></span> <span data-ttu-id="43598-225">讓我們增強此教學課程，以包含用戶端 messagebox，以摘要說明任何驗證問題。</span><span class="sxs-lookup"><span data-stu-id="43598-225">Let s enhance this tutorial to include a client-side messagebox summarizing any validation problems.</span></span>

<span data-ttu-id="43598-226">若要完成此動作，請將 ValidationSummary 控制項從 [工具箱] 拖曳至設計工具。</span><span class="sxs-lookup"><span data-stu-id="43598-226">To accomplish this, drag a ValidationSummary control from the Toolbox onto the Designer.</span></span> <span data-ttu-id="43598-227">ValidationSummary 控制項的位置並不重要，因為我們會將它設定為只將摘要顯示為 messagebox。</span><span class="sxs-lookup"><span data-stu-id="43598-227">The location of the ValidationSummary control doesn t really matter, since we re going to configure it to only display the summary as a messagebox.</span></span> <span data-ttu-id="43598-228">加入控制項之後，將其 [ [`ShowSummary`] 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx)設為 [`False`]，並將其[`ShowMessageBox` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx)設定為 [`True`]。</span><span class="sxs-lookup"><span data-stu-id="43598-228">After adding the control, set its [`ShowSummary` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx) to `False` and its [`ShowMessageBox` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx) to `True`.</span></span> <span data-ttu-id="43598-229">透過這項新增功能，任何驗證錯誤都會在用戶端 messagebox 中匯總（請參閱 [圖 6]）。</span><span class="sxs-lookup"><span data-stu-id="43598-229">With this addition, any validation errors are summarized in a client-side messagebox (see Figure 6).</span></span>

<span data-ttu-id="43598-230">[在用戶端 Messagebox 中，會摘要說明驗證錯誤 ![](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image17.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="43598-230">[![The Validation Errors are Summarized in a Client-Side Messagebox](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image17.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image16.png)</span></span>

<span data-ttu-id="43598-231">**圖 6**：用戶端 Messagebox 中的驗證錯誤摘要（[按一下以觀看完整大小的影像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="43598-231">**Figure 6**: The Validation Errors are Summarized in a Client-Side Messagebox ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image18.png))</span></span>

## <a name="summary"></a><span data-ttu-id="43598-232">總結</span><span class="sxs-lookup"><span data-stu-id="43598-232">Summary</span></span>

<span data-ttu-id="43598-233">在本教學課程中，我們已瞭解如何使用驗證控制項主動確保使用者輸入有效，然後再嘗試在更新工作流程中使用它們，以降低例外狀況的可能性。</span><span class="sxs-lookup"><span data-stu-id="43598-233">In this tutorial we saw how to reduce the likelihood of exceptions by using validation controls to proactively ensure that our users inputs are valid before attempting to use them in the updating workflow.</span></span> <span data-ttu-id="43598-234">ASP.NET 提供五個驗證 Web 控制項，設計用來檢查特定的 Web 控制項 s 輸入，並回報輸入的有效性。</span><span class="sxs-lookup"><span data-stu-id="43598-234">ASP.NET provides five validation Web controls that are designed to inspect a particular Web control s input and report back on the input s validity.</span></span> <span data-ttu-id="43598-235">在本教學課程中，我們使用這五個控制項的其中兩個來控制 RequiredFieldValidator 和 CompareValidator，以確保產品的名稱是已提供，而且價格的貨幣格式值大於或等於零。</span><span class="sxs-lookup"><span data-stu-id="43598-235">In this tutorial we used two of those five controls the RequiredFieldValidator and the CompareValidator to ensure that the product s name was supplied and that the price had a currency format with a value greater than or equal to zero.</span></span>

<span data-ttu-id="43598-236">將驗證控制項新增至 DataList s 編輯介面就像從 [工具箱] 拖曳至 [`EditItemTemplate`]，然後設定幾個屬性一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="43598-236">Adding validation controls to the DataList s editing interface is as simple as dragging them onto the `EditItemTemplate` from the Toolbox and setting a handful of properties.</span></span> <span data-ttu-id="43598-237">根據預設，驗證控制項會自動發出用戶端驗證腳本;它們也會在回傳時提供伺服器端驗證，並將累計結果儲存在 `Page.IsValid` 屬性中。</span><span class="sxs-lookup"><span data-stu-id="43598-237">By default, the validation controls automatically emit client-side validation script; they also provide server-side validation on postback, storing the cumulative result in the `Page.IsValid` property.</span></span> <span data-ttu-id="43598-238">若要在按下按鈕、LinkButton 或 ImageButton 時略過用戶端驗證，請將按鈕的 `CausesValidation` 屬性設定為 [`False`]。</span><span class="sxs-lookup"><span data-stu-id="43598-238">To bypass the client-side validation when a Button, LinkButton, or ImageButton is clicked, set the button s `CausesValidation` property to `False`.</span></span> <span data-ttu-id="43598-239">此外，在使用回傳提交的資料執行任何工作之前，請確定 `Page.IsValid` 屬性會傳回 `True`。</span><span class="sxs-lookup"><span data-stu-id="43598-239">Also, before performing any tasks with the data submitted on postback, ensure that the `Page.IsValid` property returns `True`.</span></span>

<span data-ttu-id="43598-240">到目前為止，我們已檢查過的所有 DataList 編輯教學課程，都有非常簡單的編輯介面，也就是產品名稱的 TextBox，另一個則是價格。</span><span class="sxs-lookup"><span data-stu-id="43598-240">All of the DataList editing tutorials we ve examined so far have had very simple editing interfaces a TextBox for the product s name and another for the price.</span></span> <span data-ttu-id="43598-241">不過，編輯介面可以混合不同的 Web 控制項，例如 Dropdownlist 進行、行事曆、選項按鈕、核取方塊等等。</span><span class="sxs-lookup"><span data-stu-id="43598-241">The editing interface, however, can contain a mix of different Web controls, such as DropDownLists, Calendars, RadioButtons, CheckBoxes, and so on.</span></span> <span data-ttu-id="43598-242">在下一個教學課程中，我們將探討如何建立使用各種 Web 控制項的介面。</span><span class="sxs-lookup"><span data-stu-id="43598-242">In our next tutorial we'll look at building an interface that uses a variety of Web controls.</span></span>

<span data-ttu-id="43598-243">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="43598-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="43598-244">關於作者</span><span class="sxs-lookup"><span data-stu-id="43598-244">About the Author</span></span>

<span data-ttu-id="43598-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="43598-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="43598-246">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="43598-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="43598-247">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="43598-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="43598-248">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="43598-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="43598-249">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="43598-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="43598-250">特別感謝</span><span class="sxs-lookup"><span data-stu-id="43598-250">Special Thanks To</span></span>

<span data-ttu-id="43598-251">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="43598-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="43598-252">本教學課程的領導審查者為 Dennis Patterson、Ken Pespisa 和 Liz Shulok。</span><span class="sxs-lookup"><span data-stu-id="43598-252">Lead reviewers for this tutorial were Dennis Patterson, Ken Pespisa, and Liz Shulok.</span></span> <span data-ttu-id="43598-253">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="43598-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="43598-254">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="43598-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="43598-255">[上一頁](handling-bll-and-dal-level-exceptions-cs.md)
> [下一頁](customizing-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="43598-255">[Previous](handling-bll-and-dal-level-exceptions-cs.md)
[Next](customizing-the-datalist-s-editing-interface-cs.md)</span></span>
