---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
title: 在資料 Web 控制項中顯示二進位資料（VB） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將探討在網頁上顯示二進位資料的選項，包括影像檔的顯示和布建的「下載」連結 。
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 9201656a-e1c2-4020-824b-18fb632d2925
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
msc.type: authoredcontent
ms.openlocfilehash: 27c901af092aa990f557750dc5d2c42ba2644c02
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74640716"
---
# <a name="displaying-binary-data-in-the-data-web-controls-vb"></a><span data-ttu-id="dde3c-103">以資料 Web 控制項顯示二進位資料 (VB)</span><span class="sxs-lookup"><span data-stu-id="dde3c-103">Displaying Binary Data in the Data Web Controls (VB)</span></span>

<span data-ttu-id="dde3c-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="dde3c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="dde3c-105">[下載範例應用程式](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe)或[下載 PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="dde3c-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span></span>

> <span data-ttu-id="dde3c-106">在本教學課程中，我們將探討在網頁上顯示二進位資料的選項，包括影像檔的顯示，以及 PDF 檔案的「下載」連結。</span><span class="sxs-lookup"><span data-stu-id="dde3c-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>

## <a name="introduction"></a><span data-ttu-id="dde3c-107">簡介</span><span class="sxs-lookup"><span data-stu-id="dde3c-107">Introduction</span></span>

<span data-ttu-id="dde3c-108">在先前的教學課程中，我們探討了兩種將二進位資料與應用程式基礎資料模型產生關聯的技巧，並使用 FileUpload 控制項將檔案從瀏覽器上傳至 web 伺服器的檔案系統。</span><span class="sxs-lookup"><span data-stu-id="dde3c-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="dde3c-109">我們還不知道如何將上傳的二進位資料與資料模型產生關聯。</span><span class="sxs-lookup"><span data-stu-id="dde3c-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="dde3c-110">也就是說，在檔案上傳並儲存到檔案系統之後，檔案的路徑必須儲存在適當的資料庫記錄中。</span><span class="sxs-lookup"><span data-stu-id="dde3c-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="dde3c-111">如果資料是直接儲存在資料庫中，則上傳的二進位資料不需要儲存到檔案系統，但必須插入資料庫中。</span><span class="sxs-lookup"><span data-stu-id="dde3c-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="dde3c-112">不過，在我們探討如何將資料與資料模型產生關聯之前，先來看一下如何將二進位資料提供給終端使用者。</span><span class="sxs-lookup"><span data-stu-id="dde3c-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="dde3c-113">呈現文字資料很簡單，但要如何呈現二進位資料呢？</span><span class="sxs-lookup"><span data-stu-id="dde3c-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="dde3c-114">當然，這也取決於二進位資料的類型。</span><span class="sxs-lookup"><span data-stu-id="dde3c-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="dde3c-115">針對影像，我們可能會想要顯示影像;針對 Pdf、Microsoft Word 檔、ZIP 檔案和其他類型的二進位資料，提供下載連結可能比較合適。</span><span class="sxs-lookup"><span data-stu-id="dde3c-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="dde3c-116">在本教學課程中，我們將探討如何使用資料 Web 控制項（如 GridView 和 DetailsView），將二進位資料連同其相關聯的文字資料一起呈現。</span><span class="sxs-lookup"><span data-stu-id="dde3c-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="dde3c-117">在下一個教學課程中，我們將重點放在將上傳的檔案與資料庫產生關聯。</span><span class="sxs-lookup"><span data-stu-id="dde3c-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="dde3c-118">步驟1：提供`BrochurePath`值</span><span class="sxs-lookup"><span data-stu-id="dde3c-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="dde3c-119">`Categories` 資料表中的 `Picture` 資料行已經包含各種類別目錄影像的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="dde3c-120">具體而言，每筆記錄的 `Picture` 資料行都包含有顆粒狀、低品質、16色點陣圖影像的二進位內容。</span><span class="sxs-lookup"><span data-stu-id="dde3c-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="dde3c-121">每個類別影像都是172圖元寬和120圖元高，而且會耗用大約 11 KB。</span><span class="sxs-lookup"><span data-stu-id="dde3c-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="dde3c-122">此外，`Picture` 資料行中的二進位內容包含78位元組的[OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)標頭，必須先將其移除，才能顯示影像。</span><span class="sxs-lookup"><span data-stu-id="dde3c-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="dde3c-123">此標頭資訊存在，因為 Northwind 資料庫在 Microsoft Access 中具有其根目錄。</span><span class="sxs-lookup"><span data-stu-id="dde3c-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="dde3c-124">在 Access 中，會使用 OLE 物件資料類型來儲存二進位資料，而此資料類型會添加到在此標頭上。</span><span class="sxs-lookup"><span data-stu-id="dde3c-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="dde3c-125">現在，我們將瞭解如何從這些低品質影像中去除標頭，以顯示圖片。</span><span class="sxs-lookup"><span data-stu-id="dde3c-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="dde3c-126">在未來的教學課程中，我們將建立一個介面來更新 category `Picture` 資料行，並將使用 OLE 標頭的這些點陣圖影像取代為對等的 JPG 影像，而不需要不必要的 OLE 標頭。</span><span class="sxs-lookup"><span data-stu-id="dde3c-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="dde3c-127">在先前的教學課程中，我們看到了如何使用 FileUpload 控制項。</span><span class="sxs-lookup"><span data-stu-id="dde3c-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="dde3c-128">因此，您可以將手冊檔案加入至 web 伺服器 s 檔案系統。</span><span class="sxs-lookup"><span data-stu-id="dde3c-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="dde3c-129">不過，這樣做並不會更新 `Categories` 資料表中的 `BrochurePath` 資料行。</span><span class="sxs-lookup"><span data-stu-id="dde3c-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="dde3c-130">在下一個教學課程中，我們將瞭解如何完成這項工作，但現在我們需要手動提供此資料行的值。</span><span class="sxs-lookup"><span data-stu-id="dde3c-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="dde3c-131">在本教學課程中，您可以在 [`~/Brochures`] 資料夾中找到七個 PDF 手冊檔案，其中每個類別都有 [海鮮] 除外。</span><span class="sxs-lookup"><span data-stu-id="dde3c-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="dde3c-132">我特意省略了新增海鮮手冊，以說明如何處理並非所有記錄都有相關聯的二進位資料的案例。</span><span class="sxs-lookup"><span data-stu-id="dde3c-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="dde3c-133">若要使用這些值來更新 `Categories` 資料表，請以滑鼠右鍵按一下伺服器總管的 [`Categories`] 節點，然後選擇 [顯示資料表資料]。</span><span class="sxs-lookup"><span data-stu-id="dde3c-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="dde3c-134">然後，針對每個具有手冊的類別輸入手冊檔案的虛擬路徑，如 [圖 1] 所示。</span><span class="sxs-lookup"><span data-stu-id="dde3c-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="dde3c-135">由於 [海鮮] 分類沒有任何手冊，請將其 `BrochurePath` 的 [資料行] 值保留為 [`NULL`]。</span><span class="sxs-lookup"><span data-stu-id="dde3c-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>

<span data-ttu-id="dde3c-136">[![手動輸入 category Table s BrochurePath 資料行的值](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span></span>

<span data-ttu-id="dde3c-137">**圖 1**：手動輸入 `Categories` 資料表 s `BrochurePath` 資料行的值（[按一下以查看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png))</span></span>

## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="dde3c-138">步驟2：在 GridView 中提供摺頁冊的下載連結</span><span class="sxs-lookup"><span data-stu-id="dde3c-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="dde3c-139">針對 `Categories` 資料表提供的 `BrochurePath` 值，我們已準備好建立 GridView，其中列出每個類別，以及下載類別目錄手冊的連結。</span><span class="sxs-lookup"><span data-stu-id="dde3c-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="dde3c-140">在步驟4中，我們將擴充此 GridView，以同時顯示類別目錄的影像。</span><span class="sxs-lookup"><span data-stu-id="dde3c-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="dde3c-141">首先，從 [工具箱] 將 GridView 拖曳至 [`BinaryData`] 資料夾中 [`DisplayOrDownloadData.aspx`] 頁面的設計工具。</span><span class="sxs-lookup"><span data-stu-id="dde3c-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="dde3c-142">將 GridView 的 `ID` 設定為 `Categories`，並透過 GridView 的智慧標籤，選擇將其系結至新的資料來源。</span><span class="sxs-lookup"><span data-stu-id="dde3c-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="dde3c-143">具體而言，請將它系結至名為 `CategoriesDataSource` 的 ObjectDataSource，以使用 `CategoriesBLL` 物件 s `GetCategories()` 方法來抓取資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>

<span data-ttu-id="dde3c-144">[![建立名為 CategoriesDataSource 的新 ObjectDataSource](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span></span>

<span data-ttu-id="dde3c-145">**圖 2**：建立名為 `CategoriesDataSource` 的新 ObjectDataSource （[按一下以查看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png))</span></span>

<span data-ttu-id="dde3c-146">[![將 ObjectDataSource 設定為使用 CategoriesBLL 類別](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span></span>

<span data-ttu-id="dde3c-147">**圖 3**：設定 ObjectDataSource 使用 `CategoriesBLL` 類別（[按一下以查看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png))</span></span>

<span data-ttu-id="dde3c-148">[![使用 GetCategories （）方法來抓取分類清單](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span></span>

<span data-ttu-id="dde3c-149">**圖 4**：使用 `GetCategories()` 方法抓取分類清單（[按一下以查看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png))</span></span>

<span data-ttu-id="dde3c-150">完成 [設定資料來源] wizard 之後，Visual Studio 會自動將 BoundField 新增至 `CategoryID`、`CategoryName`、`Description`、`NumberOfProducts`和 `BrochurePath` `DataColumn` s 的 `Categories` GridView。</span><span class="sxs-lookup"><span data-stu-id="dde3c-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="dde3c-151">請繼續並移除 `NumberOfProducts` BoundField，因為 `GetCategories()` 方法 s 查詢不會抓取這則資訊。</span><span class="sxs-lookup"><span data-stu-id="dde3c-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="dde3c-152">同時移除 `CategoryID` BoundField，並將 `CategoryName` 和 `BrochurePath` BoundFields `HeaderText` 屬性分別重新命名為 Category 和手冊。</span><span class="sxs-lookup"><span data-stu-id="dde3c-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="dde3c-153">進行這些變更之後，GridView 和 ObjectDataSource 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="dde3c-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample1.aspx)]

<span data-ttu-id="dde3c-154">透過瀏覽器觀看此頁面（請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="dde3c-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="dde3c-155">列出八個類別中的每一個。</span><span class="sxs-lookup"><span data-stu-id="dde3c-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="dde3c-156">具有 `BrochurePath` 值的七個分類會在個別 BoundField 中顯示 `BrochurePath` 值。</span><span class="sxs-lookup"><span data-stu-id="dde3c-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="dde3c-157">具有 `BrochurePath`之 `NULL` 值的海鮮，會顯示空的資料格。</span><span class="sxs-lookup"><span data-stu-id="dde3c-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>

<span data-ttu-id="dde3c-158">[![列出每個類別目錄的名稱、描述和 BrochurePath 值](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span></span>

<span data-ttu-id="dde3c-159">**圖 5**：每個分類的名稱、描述和 `BrochurePath` 值都會列出（[按一下以觀看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png))</span></span>

<span data-ttu-id="dde3c-160">我們想要建立手冊的連結，而不是顯示 `BrochurePath` 資料行的文字。</span><span class="sxs-lookup"><span data-stu-id="dde3c-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="dde3c-161">若要完成此動作，請移除 `BrochurePath` BoundField，並將它取代為 HyperLinkField。</span><span class="sxs-lookup"><span data-stu-id="dde3c-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="dde3c-162">將 [新的 HyperLinkField] `HeaderText` 屬性設定為 [手冊]、將 [`Text`] 屬性設為 [摺頁冊]，並將其 `DataNavigateUrlFields` 屬性設定為 `BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="dde3c-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>

![新增 BrochurePath 的 HyperLinkField](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.gif)

<span data-ttu-id="dde3c-164">**圖 6**：新增 HyperLinkField 以 `BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="dde3c-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>

<span data-ttu-id="dde3c-165">這會加入 GridView 連結的資料行，如 [圖 7] 所示。</span><span class="sxs-lookup"><span data-stu-id="dde3c-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="dde3c-166">按一下 [View 宣傳冊] 連結會在瀏覽器中直接顯示 PDF，或提示使用者下載檔案，視是否已安裝 PDF 閱讀程式和瀏覽器的設定而定。</span><span class="sxs-lookup"><span data-stu-id="dde3c-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>

<span data-ttu-id="dde3c-167">[按一下 [View 摺頁冊] 連結，即可觀看 ![的分類手冊](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span></span>

<span data-ttu-id="dde3c-168">**圖 7**：您可以按一下 [view 摺頁冊] 連結（[按一下以觀看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png)）來查看類別目錄</span><span class="sxs-lookup"><span data-stu-id="dde3c-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png))</span></span>

<span data-ttu-id="dde3c-169">[![會顯示類別目錄手冊的 PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span></span>

<span data-ttu-id="dde3c-170">**圖 8**：顯示的是分類的手冊 PDF （[按一下以觀看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png))</span></span>

## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="dde3c-171">隱藏沒有手冊之類別的 View 手冊文字</span><span class="sxs-lookup"><span data-stu-id="dde3c-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="dde3c-172">如 [圖 7] 所示，不論是否有 `BrochurePath`的非`NULL` 值，`BrochurePath` HyperLinkField 都會顯示所有記錄的 `Text` 屬性值（View 宣傳冊）。</span><span class="sxs-lookup"><span data-stu-id="dde3c-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="dde3c-173">當然，如果 `NULL``BrochurePath`，則連結只會顯示為文字，如同 [海鮮] 分類的情況（請參閱 [圖 7]）。</span><span class="sxs-lookup"><span data-stu-id="dde3c-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="dde3c-174">不顯示文字視圖手冊，如果沒有 `BrochurePath` 值會顯示一些替代文字（例如沒有可用的手冊），則可能會很不錯。</span><span class="sxs-lookup"><span data-stu-id="dde3c-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="dde3c-175">為了提供這種行為，我們必須使用 TemplateField，其內容是透過呼叫頁面方法所產生的，該方法會根據 `BrochurePath` 值發出適當的輸出。</span><span class="sxs-lookup"><span data-stu-id="dde3c-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="dde3c-176">我們先在 GridView 控制項教學課程中[使用 TemplateFields](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md)探索此格式化技巧。</span><span class="sxs-lookup"><span data-stu-id="dde3c-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md) tutorial.</span></span>

<span data-ttu-id="dde3c-177">藉由選取 [`BrochurePath`] HyperLinkField，然後按一下 [編輯資料行] 對話方塊中的 [將此欄位轉換成 TemplateField] 連結，將 HyperLinkField 轉換為 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="dde3c-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>

![將 HyperLinkField 轉換成 TemplateField](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.gif)

<span data-ttu-id="dde3c-179">**圖 9**：將 HyperLinkField 轉換成 TemplateField</span><span class="sxs-lookup"><span data-stu-id="dde3c-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>

<span data-ttu-id="dde3c-180">這會建立具有 `ItemTemplate` 的 TemplateField，其中包含超連結 Web 控制項，其 `NavigateUrl` 屬性系結至 `BrochurePath` 值。</span><span class="sxs-lookup"><span data-stu-id="dde3c-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="dde3c-181">使用方法的呼叫來取代此標記 `GenerateBrochureLink`，傳入 `BrochurePath`的值：</span><span class="sxs-lookup"><span data-stu-id="dde3c-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample2.aspx)]

<span data-ttu-id="dde3c-182">接下來，在 ASP.NET 網頁的程式碼後置類別中，建立名為 `GenerateBrochureLink` 的 `Protected` 方法，其會傳回 `String` 並接受 `Object` 做為輸入參數。</span><span class="sxs-lookup"><span data-stu-id="dde3c-182">Next, create a `Protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `String` and accepts an `Object` as an input parameter.</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample3.vb)]

<span data-ttu-id="dde3c-183">這個方法會判斷傳入的 `Object` 值是否為資料庫 `NULL`，如果是的話，則會傳回訊息，指出類別缺少手冊。</span><span class="sxs-lookup"><span data-stu-id="dde3c-183">This method determines if the passed-in `Object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="dde3c-184">否則，如果有 `BrochurePath` 值，它就會顯示在超連結中。</span><span class="sxs-lookup"><span data-stu-id="dde3c-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="dde3c-185">請注意，如果 `BrochurePath` 值存在，它就會傳遞至[`ResolveUrl(url)` 方法](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx)。</span><span class="sxs-lookup"><span data-stu-id="dde3c-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="dde3c-186">這個方法會解析傳入的*url*，以適當的虛擬路徑取代 `~` 字元。</span><span class="sxs-lookup"><span data-stu-id="dde3c-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="dde3c-187">例如，如果應用程式的根目錄為 `/Tutorial55`，`ResolveUrl("~/Brochures/Meats.pdf")` 會傳回 `/Tutorial55/Brochures/Meat.pdf`。</span><span class="sxs-lookup"><span data-stu-id="dde3c-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="dde3c-188">[圖 10] 顯示套用這些變更後的頁面。</span><span class="sxs-lookup"><span data-stu-id="dde3c-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="dde3c-189">請注意，[海鮮] 分類的 [`BrochurePath`] 欄位現在會顯示 [沒有可用的手冊] 文字。</span><span class="sxs-lookup"><span data-stu-id="dde3c-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>

<span data-ttu-id="dde3c-190">[![不含手冊的那些類別顯示 [沒有可用的手冊] 文字](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span></span>

<span data-ttu-id="dde3c-191">**圖 10**：不含手冊的類別會顯示不提供任何手冊的文字（[按一下以觀看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png))</span></span>

## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="dde3c-192">步驟3：新增網頁以顯示分類的圖片</span><span class="sxs-lookup"><span data-stu-id="dde3c-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="dde3c-193">當使用者造訪 ASP.NET 網頁時，他們會收到 ASP.NET 網頁的 HTML。</span><span class="sxs-lookup"><span data-stu-id="dde3c-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="dde3c-194">收到的 HTML 只是文字，不包含任何二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="dde3c-195">任何其他的二進位資料（例如影像、音效檔、Macromedia Flash 應用程式、內嵌的 Windows 媒體播放機影片等等）都會以個別的資源形式存在於 web 伺服器上。</span><span class="sxs-lookup"><span data-stu-id="dde3c-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="dde3c-196">HTML 包含這些檔案的參考，但不包含檔案的實際內容。</span><span class="sxs-lookup"><span data-stu-id="dde3c-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="dde3c-197">例如，在 HTML 中，`<img>` 專案是用來參考圖片，其中 `src` 屬性會指向影像檔，如下所示：</span><span class="sxs-lookup"><span data-stu-id="dde3c-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>

[!code-html[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample4.html)]

<span data-ttu-id="dde3c-198">當瀏覽器收到此 HTML 時，會向網頁伺服器提出另一項要求，以抓取影像檔案的二進位內容，然後在瀏覽器中顯示該檔案。</span><span class="sxs-lookup"><span data-stu-id="dde3c-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="dde3c-199">相同的概念也適用于任何二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="dde3c-200">在步驟2中，手冊不會傳送至瀏覽器，做為網頁 s HTML 標籤的一部分。</span><span class="sxs-lookup"><span data-stu-id="dde3c-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="dde3c-201">相反地，所呈現的 HTML 提供的超連結，會在按一下時導致瀏覽器直接要求 PDF 檔。</span><span class="sxs-lookup"><span data-stu-id="dde3c-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="dde3c-202">若要顯示或允許使用者下載位於資料庫內的二進位資料，我們必須建立會傳回資料的個別網頁。</span><span class="sxs-lookup"><span data-stu-id="dde3c-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="dde3c-203">在我們的應用程式中，只有一個二進位資料欄位直接儲存在資料庫中，即類別目錄的圖片。</span><span class="sxs-lookup"><span data-stu-id="dde3c-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="dde3c-204">因此，我們需要一個頁面，當呼叫它時，會傳回特定分類的影像資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="dde3c-205">將新的 ASP.NET 網頁新增至名為 `DisplayCategoryPicture.aspx`的 `BinaryData` 資料夾。</span><span class="sxs-lookup"><span data-stu-id="dde3c-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="dde3c-206">執行此動作時，請將 [選取主版頁面] 核取方塊保持未選取狀態。</span><span class="sxs-lookup"><span data-stu-id="dde3c-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="dde3c-207">此頁面需要 querystring 中的 `CategoryID` 值，並傳回該分類的 `Picture` 資料行的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="dde3c-208">由於此頁面會傳回二進位資料，而不會傳回任何其他內容，因此在 HTML 區段中不需要任何標記。</span><span class="sxs-lookup"><span data-stu-id="dde3c-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="dde3c-209">因此，請按一下左下角的 [來源] 索引標籤，並移除 [`<%@ Page %>`] 指示詞以外的所有 page s 標記。</span><span class="sxs-lookup"><span data-stu-id="dde3c-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="dde3c-210">也就是說，`DisplayCategoryPicture.aspx` s 宣告式標記應該包含一行：</span><span class="sxs-lookup"><span data-stu-id="dde3c-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample5.aspx)]

<span data-ttu-id="dde3c-211">如果您在 `<%@ Page %>` 指示詞中看到 `MasterPageFile` 屬性，請將它移除。</span><span class="sxs-lookup"><span data-stu-id="dde3c-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="dde3c-212">在 [程式碼後置] 類別中，將下列程式碼加入 `Page_Load` 事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="dde3c-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample6.vb)]

<span data-ttu-id="dde3c-213">此程式碼一開始會將 `CategoryID` querystring 值讀入名為 `categoryID`的變數中。</span><span class="sxs-lookup"><span data-stu-id="dde3c-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="dde3c-214">接下來，會透過呼叫 `CategoriesBLL` 類別的 `GetCategoryWithBinaryDataByCategoryID(categoryID)` 方法來抓取圖片資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="dde3c-215">這項資料會使用 `Response.BinaryWrite(data)` 方法傳回給用戶端，但在呼叫這個資料之前，必須先移除 `Picture` 資料行值 s OLE 標頭。</span><span class="sxs-lookup"><span data-stu-id="dde3c-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="dde3c-216">這是藉由建立名為 `strippedImageData` 的 `Byte` 陣列來完成，其會保留比 `Picture` 資料行中精確的78個字元。</span><span class="sxs-lookup"><span data-stu-id="dde3c-216">This is accomplished by creating a `Byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="dde3c-217">[`Array.Copy` 方法](https://msdn.microsoft.com/library/z50k9bft.aspx)是用來將從位置78開始 `category.Picture` 的資料複製到 `strippedImageData`。</span><span class="sxs-lookup"><span data-stu-id="dde3c-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="dde3c-218">`Response.ContentType` 屬性會指定要傳回之內容的[MIME 類型](http://en.wikipedia.org/wiki/MIME)，讓瀏覽器知道如何呈現它。</span><span class="sxs-lookup"><span data-stu-id="dde3c-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="dde3c-219">由於 `Categories` 資料表的 `Picture` 資料行是點陣圖影像，因此會在這裡使用 bitmap MIME 類型（image/bmp）。</span><span class="sxs-lookup"><span data-stu-id="dde3c-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="dde3c-220">如果您省略 MIME 類型，大部分的瀏覽器仍然會正確顯示影像，因為它們可以根據影像檔案的二進位資料內容來推斷類型。</span><span class="sxs-lookup"><span data-stu-id="dde3c-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="dde3c-221">不過，盡可能包含 MIME 類型是非常謹慎的。</span><span class="sxs-lookup"><span data-stu-id="dde3c-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="dde3c-222">如需[MIME 媒體類型](http://www.iana.org/assignments/media-types/)的完整清單，請參閱[網際網路指派的數位授權單位網站](http://www.iana.org/)。</span><span class="sxs-lookup"><span data-stu-id="dde3c-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="dde3c-223">建立此頁面之後，您可以造訪 `DisplayCategoryPicture.aspx?CategoryID=categoryID`來查看特定的類別圖片。</span><span class="sxs-lookup"><span data-stu-id="dde3c-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="dde3c-224">[圖 11] 顯示飲料類別目錄的圖片，可以從 `DisplayCategoryPicture.aspx?CategoryID=1`查看。</span><span class="sxs-lookup"><span data-stu-id="dde3c-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>

<span data-ttu-id="dde3c-225">[會顯示 [飲料] 類別的圖片 ![](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span></span>

<span data-ttu-id="dde3c-226">**圖 11**：顯示飲料類別的圖片（[按一下以觀看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png))</span></span>

<span data-ttu-id="dde3c-227">當造訪 `DisplayCategoryPicture.aspx?CategoryID=categoryID`時，您會收到例外狀況，指出無法將 ' System.object ' 類型的物件轉換成類型 ' system.string [] '，這可能會造成這種情況。</span><span class="sxs-lookup"><span data-stu-id="dde3c-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="dde3c-228">首先，`Categories` table s `Picture` 資料行確實允許 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="dde3c-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="dde3c-229">不過，[`DisplayCategoryPicture.aspx`] 頁面會假設有一個非`NULL` 值存在。</span><span class="sxs-lookup"><span data-stu-id="dde3c-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="dde3c-230">如果具有 `NULL` 值，則無法直接存取 `CategoriesDataTable` 的 `Picture` 屬性。</span><span class="sxs-lookup"><span data-stu-id="dde3c-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="dde3c-231">如果您想要允許 `NULL` `Picture` 資料行的值，您應該要包含下列條件：</span><span class="sxs-lookup"><span data-stu-id="dde3c-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample7.vb)]

<span data-ttu-id="dde3c-232">上述程式碼假設在 `Images` 資料夾中，有一個名為 `NoPictureAvailable.gif` 的影像檔案，而您想要在沒有圖片的情況下顯示這些類別。</span><span class="sxs-lookup"><span data-stu-id="dde3c-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="dde3c-233">如果 `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` 方法 s `SELECT` 語句還原回主要查詢的資料行清單，可能會發生這個例外狀況，這可能是因為您使用臨機操作 SQL 語句，而且您已針對 TableAdapter s 主要查詢重新執行 wizard。</span><span class="sxs-lookup"><span data-stu-id="dde3c-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="dde3c-234">檢查以確定 `GetCategoryWithBinaryDataByCategoryID` 方法的 `SELECT` 語句仍然包含 `Picture` 的資料行。</span><span class="sxs-lookup"><span data-stu-id="dde3c-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="dde3c-235">每次造訪 `DisplayCategoryPicture.aspx` 時，就會存取資料庫並傳回指定的分類圖片資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="dde3c-236">不過，如果類別的圖片自從使用者上次觀看後並未變更，這就是浪費精力。</span><span class="sxs-lookup"><span data-stu-id="dde3c-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="dde3c-237">幸好，HTTP 允許*條件式取得*。</span><span class="sxs-lookup"><span data-stu-id="dde3c-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="dde3c-238">透過條件式取得，提出 HTTP 要求的用戶端會沿著[`If-Modified-Since` HTTP 標頭](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)傳送，以提供用戶端上次從 web 伺服器抓取此資源的日期和時間。</span><span class="sxs-lookup"><span data-stu-id="dde3c-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="dde3c-239">如果在指定的日期後內容尚未變更，web 伺服器可能會以[未修改的狀態碼（304）](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)回應，並放棄傳回要求的資源內容。</span><span class="sxs-lookup"><span data-stu-id="dde3c-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="dde3c-240">簡單地說，這項技術讓網頁伺服器不需要傳送回資源的內容（如果它在用戶端上次存取之後未曾修改過）。</span><span class="sxs-lookup"><span data-stu-id="dde3c-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>

<span data-ttu-id="dde3c-241">不過，若要執行這種行為，您必須將 `PictureLastModified` 資料行加入至 `Categories` 資料表，以便在上次更新 `Picture` 資料行時進行捕捉，以及檢查 `If-Modified-Since` 標頭的程式碼。</span><span class="sxs-lookup"><span data-stu-id="dde3c-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="dde3c-242">如需有關 `If-Modified-Since` 標頭和條件式取得工作流程的詳細資訊，請參閱[RSS 駭客的 HTTP 條件式取得](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers)，以及[深入瞭解如何在 ASP.NET 網頁中執行 HTTP 要求](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="dde3c-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="dde3c-243">步驟4：在 GridView 中顯示類別圖片</span><span class="sxs-lookup"><span data-stu-id="dde3c-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="dde3c-244">既然我們已經有一個網頁來顯示特定的分類圖片，我們可以使用[影像 web 控制項](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx)或指向 `DisplayCategoryPicture.aspx?CategoryID=categoryID`的 HTML `<img>` 元素來顯示它。</span><span class="sxs-lookup"><span data-stu-id="dde3c-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="dde3c-245">其 URL 是由資料庫資料決定的影像，可以使用 ImageField 在 GridView 或 DetailsView 中顯示。</span><span class="sxs-lookup"><span data-stu-id="dde3c-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="dde3c-246">ImageField 包含 `DataImageUrlField` 和 `DataImageUrlFormatString` 屬性，其作用類似 HyperLinkField s `DataNavigateUrlFields` 和 `DataNavigateUrlFormatString` 屬性。</span><span class="sxs-lookup"><span data-stu-id="dde3c-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="dde3c-247">藉由新增 ImageField 以顯示每個類別目錄的圖片，讓擴充 `DisplayOrDownloadData.aspx` 中的 `Categories` GridView。</span><span class="sxs-lookup"><span data-stu-id="dde3c-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="dde3c-248">只需新增 ImageField，並將其 `DataImageUrlField` 和 `DataImageUrlFormatString` 屬性分別設定為 `CategoryID` 和 `DisplayCategoryPicture.aspx?CategoryID={0}`。</span><span class="sxs-lookup"><span data-stu-id="dde3c-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="dde3c-249">這會建立 GridView 資料行，以轉譯 `src` 屬性參考 `DisplayCategoryPicture.aspx?CategoryID={0}`的 `<img>` 專案，其中 {0} 會以 GridView 資料列 s `CategoryID` 值來取代。</span><span class="sxs-lookup"><span data-stu-id="dde3c-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>

![將 ImageField 新增至 GridView](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.gif)

<span data-ttu-id="dde3c-251">**圖 12**：將 ImageField 新增至 GridView</span><span class="sxs-lookup"><span data-stu-id="dde3c-251">**Figure 12**: Add an ImageField to the GridView</span></span>

<span data-ttu-id="dde3c-252">加入 ImageField 之後，GridView 的宣告式語法看起來應該如下 soothe：</span><span class="sxs-lookup"><span data-stu-id="dde3c-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample8.aspx)]

<span data-ttu-id="dde3c-253">請花點時間透過瀏覽器觀看此頁面。</span><span class="sxs-lookup"><span data-stu-id="dde3c-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="dde3c-254">請注意，每一筆記錄現在如何包含類別的圖片。</span><span class="sxs-lookup"><span data-stu-id="dde3c-254">Note how each record now includes a picture for the category.</span></span>

<span data-ttu-id="dde3c-255">[![顯示每個資料列的類別目錄圖片](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="dde3c-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span></span>

<span data-ttu-id="dde3c-256">**圖 13**：每個資料列都會顯示類別目錄的圖片（[按一下以觀看完整大小的影像](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="dde3c-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png))</span></span>

## <a name="summary"></a><span data-ttu-id="dde3c-257">總結</span><span class="sxs-lookup"><span data-stu-id="dde3c-257">Summary</span></span>

<span data-ttu-id="dde3c-258">在本教學課程中，我們已檢查如何呈現二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="dde3c-259">資料的呈現方式取決於資料類型。</span><span class="sxs-lookup"><span data-stu-id="dde3c-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="dde3c-260">針對 PDF 摺頁冊檔案，我們提供使用者一個 View 宣傳冊連結，當您按下該按鈕時，會將使用者直接帶到 PDF 檔案。</span><span class="sxs-lookup"><span data-stu-id="dde3c-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="dde3c-261">針對類別目錄的圖片，我們先建立一個頁面來抓取和傳回資料庫的二進位資料，然後使用該頁面來顯示 GridView 中的每個類別目錄。</span><span class="sxs-lookup"><span data-stu-id="dde3c-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="dde3c-262">既然我們已經討論過如何顯示二進位資料，我們已經準備好檢查如何對資料庫執行插入、更新和刪除，以及二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="dde3c-263">在下一個教學課程中，我們將探討如何將上傳的檔案與其對應的資料庫記錄產生關聯。</span><span class="sxs-lookup"><span data-stu-id="dde3c-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="dde3c-264">在本教學課程中，我們將瞭解如何更新現有的二進位資料，以及如何在移除其相關聯的記錄時刪除二進位資料。</span><span class="sxs-lookup"><span data-stu-id="dde3c-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="dde3c-265">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="dde3c-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="dde3c-266">關於作者</span><span class="sxs-lookup"><span data-stu-id="dde3c-266">About the Author</span></span>

<span data-ttu-id="dde3c-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="dde3c-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="dde3c-268">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="dde3c-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="dde3c-269">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="dde3c-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="dde3c-270">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="dde3c-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="dde3c-271">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="dde3c-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="dde3c-272">特別感謝</span><span class="sxs-lookup"><span data-stu-id="dde3c-272">Special Thanks To</span></span>

<span data-ttu-id="dde3c-273">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="dde3c-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="dde3c-274">本教學課程的領導審查者為 Teresa Murphy 和 Dave Gardner。</span><span class="sxs-lookup"><span data-stu-id="dde3c-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="dde3c-275">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="dde3c-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="dde3c-276">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="dde3c-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="dde3c-277">[上一頁](uploading-files-vb.md)
> [下一頁](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span><span class="sxs-lookup"><span data-stu-id="dde3c-277">[Previous](uploading-files-vb.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span></span>
