---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
title: 上傳檔案 (C#) |Microsoft Docs
author: rick-anderson
description: 您的網站，可能會將它們儲存在伺服器的檔案系統的位置，了解如何允許使用者上傳二進位檔 （例如 Word 或 PDF 文件）...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: b381b1da-feb3-4776-bc1b-75db53eb90ab
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
msc.type: authoredcontent
ms.openlocfilehash: 8849f8f279dde883a71fb3ba1678a589f2e321eb
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/01/2019
ms.locfileid: "57038845"
---
<a name="uploading-files-c"></a><span data-ttu-id="48e8b-103">上傳檔案 (C#)</span><span class="sxs-lookup"><span data-stu-id="48e8b-103">Uploading Files (C#)</span></span>
====================
<span data-ttu-id="48e8b-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="48e8b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="48e8b-105">[下載範例應用程式](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe)或[下載 PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="48e8b-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) or [Download PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span></span>

> <span data-ttu-id="48e8b-106">您的網站，可能會將它們儲存在伺服器的檔案系統或資料庫的位置，了解如何允許使用者上傳二進位檔 （例如 Word 或 PDF 文件）。</span><span class="sxs-lookup"><span data-stu-id="48e8b-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="48e8b-107">簡介</span><span class="sxs-lookup"><span data-stu-id="48e8b-107">Introduction</span></span>

<span data-ttu-id="48e8b-108">所有教學課程，我們已檢查到目前為止已以獨佔方式使用文字資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="48e8b-109">不過，許多應用程式必須擷取文字和二進位資料的資料模型。</span><span class="sxs-lookup"><span data-stu-id="48e8b-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="48e8b-110">Online dating 網站可能會允許使用者上傳其設定檔相關聯的圖片。</span><span class="sxs-lookup"><span data-stu-id="48e8b-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="48e8b-111">徵才及用人的網站可能會讓使用者上傳其繼續為 Microsoft Word 或 PDF 文件。</span><span class="sxs-lookup"><span data-stu-id="48e8b-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="48e8b-112">使用二進位資料會加入一組新的挑戰。</span><span class="sxs-lookup"><span data-stu-id="48e8b-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="48e8b-113">我們必須決定應用程式中儲存二進位資料的方式。</span><span class="sxs-lookup"><span data-stu-id="48e8b-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="48e8b-114">用於插入新記錄的介面已更新，以允許使用者從他們的電腦將檔案上傳，必須採取額外的步驟，來顯示或提供一種方式下載記錄 s 相關聯的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="48e8b-115">在本教學課程和下一步 的第三，我們將探討如何障礙這些挑戰。</span><span class="sxs-lookup"><span data-stu-id="48e8b-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="48e8b-116">這些教學課程的結尾我們會建立功能完整的應用程式與每個類別目錄產生關聯的圖片和 PDF 小冊子。</span><span class="sxs-lookup"><span data-stu-id="48e8b-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="48e8b-117">在這個特定的教學課程中我們將看看不同的技術，用於存放二進位資料，並探討如何讓使用者能夠從他們的電腦將檔案上傳，並已儲存在 web 伺服器檔案系統上。</span><span class="sxs-lookup"><span data-stu-id="48e8b-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="48e8b-118">二進位資料的應用程式的資料模型的一部分，有時稱為[BLOB](http://en.wikipedia.org/wiki/Binary_large_object)，二進位大型物件的首字母縮寫。</span><span class="sxs-lookup"><span data-stu-id="48e8b-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="48e8b-119">在這些教學課程中我選擇使用術語的二進位資料，雖然 BLOB 是同義詞彙。</span><span class="sxs-lookup"><span data-stu-id="48e8b-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>


## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="48e8b-120">步驟 1：使用二進位資料 Web 頁面建立工作</span><span class="sxs-lookup"><span data-stu-id="48e8b-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="48e8b-121">我們開始探索新增支援二進位資料的相關挑戰之前，可讓 s 先花點時間，我們需要針對本教學課程和下列三個我們網站專案中建立 ASP.NET 網頁。</span><span class="sxs-lookup"><span data-stu-id="48e8b-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="48e8b-122">藉由新增新的資料夾，名為啟動`BinaryData`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="48e8b-123">接下來，新增到該資料夾，並確認其關聯與每個頁面的 下列 ASP.NET 網頁`Site.master`主版頁面：</span><span class="sxs-lookup"><span data-stu-id="48e8b-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`


![加入 ASP.NET 網頁的二進位資料相關教學課程](uploading-files-cs/_static/image1.gif)

<span data-ttu-id="48e8b-125">**圖 1**:加入 ASP.NET 網頁的二進位資料相關教學課程</span><span class="sxs-lookup"><span data-stu-id="48e8b-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>


<span data-ttu-id="48e8b-126">在其他資料夾，例如`Default.aspx`在`BinaryData`資料夾會列出其一節中的教學課程。</span><span class="sxs-lookup"><span data-stu-id="48e8b-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="48e8b-127">請記得，`SectionLevelTutorialListing.ascx`使用者控制項提供這項功能。</span><span class="sxs-lookup"><span data-stu-id="48e8b-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="48e8b-128">因此，新增此使用者控制項`Default.aspx`從拖曳到頁面的設計 檢視中的 方案總管 中拖曳。</span><span class="sxs-lookup"><span data-stu-id="48e8b-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>


<span data-ttu-id="48e8b-129">[![將 SectionLevelTutorialListing.ascx 使用者控制項新增至 Default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span></span>

<span data-ttu-id="48e8b-130">**圖 2**:新增`SectionLevelTutorialListing.ascx`使用者控制項`Default.aspx`([按一下以檢視完整大小的影像](uploading-files-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-cs/_static/image2.png))</span></span>


<span data-ttu-id="48e8b-131">最後，將這些頁面新增項目為`Web.sitemap`檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="48e8b-132">具體來說，強化之後新增下列標記 GridView `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="48e8b-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>


[!code-xml[Main](uploading-files-cs/samples/sample1.xml)]

<span data-ttu-id="48e8b-133">在更新之後`Web.sitemap`，花點時間檢視教學課程網站，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="48e8b-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="48e8b-134">在左側功能表現在包含二進位資料的教學課程使用的項目。</span><span class="sxs-lookup"><span data-stu-id="48e8b-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>


![網站導覽現在包含二進位資料的教學課程使用的項目](uploading-files-cs/_static/image3.gif)

<span data-ttu-id="48e8b-136">**圖 3**:網站導覽現在包含二進位資料的教學課程使用的項目</span><span class="sxs-lookup"><span data-stu-id="48e8b-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>


## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="48e8b-137">步驟 2：決定儲存二進位資料的位置</span><span class="sxs-lookup"><span data-stu-id="48e8b-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="48e8b-138">應用程式的資料模型與相關聯的二進位資料可以儲存在兩個地方的其中一個： 在 web 伺服器檔案系統的參考儲存在資料庫中的檔案或直接在資料庫本身內 （請參閱 圖 4）。</span><span class="sxs-lookup"><span data-stu-id="48e8b-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="48e8b-139">每一種方法都有它自己組的優缺點，並需要更詳細的討論。</span><span class="sxs-lookup"><span data-stu-id="48e8b-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>


<span data-ttu-id="48e8b-140">[![二進位資料可以儲存在檔案系統上，或直接在資料庫中](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span></span>

<span data-ttu-id="48e8b-141">**圖 4**:二進位資料可以儲存在檔案系統上，或直接在資料庫中 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-cs/_static/image4.png))</span></span>


<span data-ttu-id="48e8b-142">假設我們想要擴充 Northwind 資料庫建立關聯與每個產品的圖片。</span><span class="sxs-lookup"><span data-stu-id="48e8b-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="48e8b-143">其中一個選項是儲存在 web 伺服器檔案系統上的這些映像檔案，並記錄中的路徑`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="48e8b-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="48e8b-144">使用此方法時，我們的 d 新增`ImagePath`資料行`Products`型別的資料表`varchar(200)`，也或許是。</span><span class="sxs-lookup"><span data-stu-id="48e8b-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="48e8b-145">時為 Chai 使用者上傳的圖片，可能會在 web 伺服器檔案系統上儲存該圖片`~/Images/Tea.jpg`，其中`~`代表應用程式 s 的實體路徑。</span><span class="sxs-lookup"><span data-stu-id="48e8b-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="48e8b-146">也就是說，如果網站根目錄的實體路徑`C:\Websites\Northwind\`，`~/Images/Tea.jpg`相當於`C:\Websites\Northwind\Images\Tea.jpg`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="48e8b-147">上傳映像檔之後, 我們 d 更新 Chai 中的記錄`Products`資料表，讓其`ImagePath`參考新的映像的路徑資料行。</span><span class="sxs-lookup"><span data-stu-id="48e8b-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="48e8b-148">我們可以使用`~/Images/Tea.jpg`或簡稱`Tea.jpg`如果我們決定要將所有的產品映像會置於應用程式的`Images`資料夾。</span><span class="sxs-lookup"><span data-stu-id="48e8b-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="48e8b-149">在 檔案系統上儲存的二進位資料的主要優點如下：</span><span class="sxs-lookup"><span data-stu-id="48e8b-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="48e8b-150">**實作簡單**儲存和擷取直接在資料庫中儲存的二進位資料如我們所見，牽涉到更多程式碼的程式時使用透過檔案系統的資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="48e8b-151">此外，若要檢視或下載的二進位資料的使用者必須向他們該資料的 URL。</span><span class="sxs-lookup"><span data-stu-id="48e8b-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="48e8b-152">如果資料位於 web 伺服器檔案系統上，則 URL 會是簡單。</span><span class="sxs-lookup"><span data-stu-id="48e8b-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="48e8b-153">如果資料儲存在資料庫中，不過，網頁必須建立，會擷取，並從資料庫傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="48e8b-154">**更多的存取權的二進位資料**二進位資料可能需要存取其他服務或應用程式，是無法提取資料庫中的資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="48e8b-155">例如，每個產品相關聯的映像可能也需要可供使用者透過[FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol)，d 我們想要在此情況下將二進位資料儲存在檔案系統上。</span><span class="sxs-lookup"><span data-stu-id="48e8b-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="48e8b-156">**效能**二進位資料會儲存在檔案系統中，如果資料庫伺服器和 web 伺服器之間的需求和網路壅塞會少於如果直接在資料庫內儲存的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="48e8b-157">將二進位資料儲存在檔案系統上的主要缺點是，它減少了資料庫中的資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="48e8b-158">如果記錄遭到刪除從`Products`資料表相關聯的檔案，在 web 伺服器檔案系統上不會自動刪除。</span><span class="sxs-lookup"><span data-stu-id="48e8b-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="48e8b-159">我們必須撰寫額外的程式碼，若要刪除檔案或檔案系統將會變得雜亂無章未使用、 被遺棄的檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="48e8b-160">此外，當備份資料庫，我們必須確定對檔案系統，以及相關聯的二進位資料的備份。</span><span class="sxs-lookup"><span data-stu-id="48e8b-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="48e8b-161">將資料庫移到另一個網站或伺服器帶來類似的挑戰。</span><span class="sxs-lookup"><span data-stu-id="48e8b-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="48e8b-162">藉由建立類型的資料行，或者，可以直接在 Microsoft SQL Server 2005 資料庫中預存的二進位資料`varbinary`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="48e8b-163">像其他可變長度資料類型，您可以在此資料行中指定的二進位資料，可以保留最大長度。</span><span class="sxs-lookup"><span data-stu-id="48e8b-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="48e8b-164">例如，若要保留最多 5,000 個位元組使用`varbinary(5000)`;`varbinary(MAX)`允許儲存體大小上限，約 2GB。</span><span class="sxs-lookup"><span data-stu-id="48e8b-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="48e8b-165">直接在資料庫中儲存二進位資料的主要優點是二進位資料和資料庫記錄之間緊密的關聯性。</span><span class="sxs-lookup"><span data-stu-id="48e8b-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="48e8b-166">這可大幅簡化資料庫管理工作，例如備份或將資料庫移至不同的網站或伺服器。</span><span class="sxs-lookup"><span data-stu-id="48e8b-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="48e8b-167">此外，自動刪除記錄會刪除相對應的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="48e8b-168">另外還有其他難以察覺的優點，在資料庫中儲存二進位資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="48e8b-169">請參閱[儲存二進位檔案直接在資料庫使用 ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx)如更深入的討論。</span><span class="sxs-lookup"><span data-stu-id="48e8b-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="48e8b-170">在 Microsoft SQL Server 2000 和舊版中，`varbinary`資料型別有最大限制為 8000 個位元組。</span><span class="sxs-lookup"><span data-stu-id="48e8b-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="48e8b-171">若要儲存最多 2 GB 的二進位資料[`image`資料型別](https://msdn.microsoft.com/library/ms187993.aspx)必須改為使用。</span><span class="sxs-lookup"><span data-stu-id="48e8b-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="48e8b-172">加上`MAX`在 SQL Server 2005，不過，`image`資料型別已被取代。</span><span class="sxs-lookup"><span data-stu-id="48e8b-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="48e8b-173">它 s 仍支援回溯相容性，但是 Microsoft 已經宣布， `image` SQL Server 的未來版本將移除的資料型別。</span><span class="sxs-lookup"><span data-stu-id="48e8b-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>


<span data-ttu-id="48e8b-174">如果您正在使用較舊的資料模型可能會看到`image`資料型別。</span><span class="sxs-lookup"><span data-stu-id="48e8b-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="48e8b-175">Northwind 資料庫 s`Categories`資料表有`Picture`可以用來儲存影像檔的分類的二進位資料的資料行。</span><span class="sxs-lookup"><span data-stu-id="48e8b-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="48e8b-176">因為 Northwind 資料庫都有自己的根目錄，在 Microsoft Access 和舊版的 SQL Server 中，這個資料行是型別的`image`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="48e8b-177">如需本教學課程和下列三個，我們將使用這兩種方法。</span><span class="sxs-lookup"><span data-stu-id="48e8b-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="48e8b-178">`Categories`資料表已經有`Picture`來儲存二進位映像內容的類別目錄的資料行。</span><span class="sxs-lookup"><span data-stu-id="48e8b-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="48e8b-179">我們將新增額外的資料行`BrochurePath`，可用來提供列印品質、 亮眼的概觀，類別目錄的 web 伺服器檔案系統上儲存成 PDF 的路徑。</span><span class="sxs-lookup"><span data-stu-id="48e8b-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="48e8b-180">步驟 3：新增`BrochurePath`資料行`Categories`資料表</span><span class="sxs-lookup"><span data-stu-id="48e8b-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="48e8b-181">Categories 資料表目前有只有四個資料行： `CategoryID`， `CategoryName`， `Description`，和`Picture`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="48e8b-182">除了這些欄位中，我們需要加入新的檔案 （如果有的話），將會指向類別 s 摺頁冊。</span><span class="sxs-lookup"><span data-stu-id="48e8b-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="48e8b-183">若要將此資料行，請移至 伺服器總管 中，向下切入至資料表，以滑鼠右鍵按一下`Categories`資料表，然後選擇 開啟資料表定義 （請參閱 圖 5）。</span><span class="sxs-lookup"><span data-stu-id="48e8b-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="48e8b-184">如果看不到 [伺服器總管] 中，從 [檢視] 功能表中，選取 [伺服器總管] 選項開啟它，或按 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="48e8b-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="48e8b-185">加入新`varchar(200)`資料行`Categories`名為資料表`BrochurePath`，並允許`NULL`s，並按一下 [儲存] 圖示 （或按 Ctrl + S）。</span><span class="sxs-lookup"><span data-stu-id="48e8b-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>


<span data-ttu-id="48e8b-186">[![將 BrochurePath 資料行新增至 Categories 資料表](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span></span>

<span data-ttu-id="48e8b-187">**圖 5**:新增`BrochurePath`資料行`Categories`資料表 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-cs/_static/image6.png))</span></span>


## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="48e8b-188">步驟 4：更新架構以使用`Picture`和`BrochurePath`資料行</span><span class="sxs-lookup"><span data-stu-id="48e8b-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="48e8b-189">`CategoriesDataTable`資料存取層 (DAL) 中目前有四個`DataColumn`定義： `CategoryID`， `CategoryName`， `Description`，和`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="48e8b-190">當我們原本是設計在此 DataTable[建立資料存取層](../introduction/creating-a-data-access-layer-cs.md)教學課程中，`CategoriesDataTable`只有前三個資料行;`NumberOfProducts`資料行已加入[主要/詳細資料使用的項目符號具有詳細資料 DataList 的主要記錄的份](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="48e8b-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial.</span></span>

<span data-ttu-id="48e8b-191">中所述*建立資料存取層*，Datatable 中具類型資料集組成商務物件。</span><span class="sxs-lookup"><span data-stu-id="48e8b-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="48e8b-192">Tableadapter 負責與資料庫通訊，並填入商務物件，含有查詢結果。</span><span class="sxs-lookup"><span data-stu-id="48e8b-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="48e8b-193">`CategoriesDataTable`會填入`CategoriesTableAdapter`，其中包含三個資料擷取方法：</span><span class="sxs-lookup"><span data-stu-id="48e8b-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="48e8b-194">`GetCategories()` 執行 TableAdapter s 主查詢並傳回`CategoryID`， `CategoryName`，並`Description`欄位中的所有記錄的`Categories`資料表。</span><span class="sxs-lookup"><span data-stu-id="48e8b-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="48e8b-195">主要的查詢是什麼由自動產生`Insert`和`Update`方法。</span><span class="sxs-lookup"><span data-stu-id="48e8b-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="48e8b-196">`GetCategoryByCategoryID(categoryID)` 會傳回`CategoryID`， `CategoryName`，並`Description`欄位類別目錄的其`CategoryID`等於*categoryID*。</span><span class="sxs-lookup"><span data-stu-id="48e8b-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="48e8b-197">`GetCategoriesAndNumberOfProducts()` -傳回`CategoryID`， `CategoryName`，並`Description`欄位中的所有記錄`Categories`資料表。</span><span class="sxs-lookup"><span data-stu-id="48e8b-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="48e8b-198">也會使用子查詢傳回的每個類別目錄相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="48e8b-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="48e8b-199">請注意，其中一個項目查詢會傳回`Categories`資料表 s`Picture`或是`BrochurePath`資料行; 也不`CategoriesDataTable`提供`DataColumn`的這些欄位。</span><span class="sxs-lookup"><span data-stu-id="48e8b-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="48e8b-200">若要使用的圖片及`BrochurePath`屬性，我們需要先將它們加入`CategoriesDataTable`，然後再更新`CategoriesTableAdapter`類別，以傳回這些資料行。</span><span class="sxs-lookup"><span data-stu-id="48e8b-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="48e8b-201">新增`Picture`和`BrochurePath``DataColumn`s</span><span class="sxs-lookup"><span data-stu-id="48e8b-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="48e8b-202">藉由加入這些兩個資料行，來啟動`CategoriesDataTable`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="48e8b-203">以滑鼠右鍵按一下`CategoriesDataTable`s 標頭中，從內容功能表中選取 新增，然後選擇 資料行選項。</span><span class="sxs-lookup"><span data-stu-id="48e8b-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="48e8b-204">這會建立新`DataColumn`名為 DataTable 中`Column1`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="48e8b-205">重新命名此資料行`Picture`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="48e8b-206">從 [屬性] 視窗中，設定`DataColumn`s`DataType`屬性設`System.Byte[]`（這不是下拉式清單中的選項; 您需要在輸入時）。</span><span class="sxs-lookup"><span data-stu-id="48e8b-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>


<span data-ttu-id="48e8b-207">[![建立 DataColumn 名為圖片的資料類型是 System.Byte](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span></span>

<span data-ttu-id="48e8b-208">**圖 6**:建立`DataColumn`具名`Picture`其`DataType`是`System.Byte[]`([按一下以檢視完整大小的影像](uploading-files-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-cs/_static/image8.png))</span></span>


<span data-ttu-id="48e8b-209">新增另一個`DataColumn`至 DataTable，將它命名為`BrochurePath`使用預設`DataType`值 (`System.String`)。</span><span class="sxs-lookup"><span data-stu-id="48e8b-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="48e8b-210">傳回`Picture`和`BrochurePath`TableAdapter 中的值</span><span class="sxs-lookup"><span data-stu-id="48e8b-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="48e8b-211">使用這兩個`DataColumn`加入至`CategoriesDataTable`，我們準備好更新`CategoriesTableAdapter`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="48e8b-212">我們可能會有這兩個主要的 TableAdapter 查詢中傳回這些資料行值，但這會帶回二進位資料，每次`GetCategories()`已叫用方法。</span><span class="sxs-lookup"><span data-stu-id="48e8b-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="48e8b-213">相反地，可讓 s 更新主要的 TableAdapter 查詢，以恢復`BrochurePath`並建立額外的資料擷取方法會傳回特定類別的`Picture`資料行。</span><span class="sxs-lookup"><span data-stu-id="48e8b-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="48e8b-214">若要更新主要的 TableAdapter 查詢，以滑鼠右鍵按一下`CategoriesTableAdapter`s 標頭，然後選擇 從內容功能表的 設定選項。</span><span class="sxs-lookup"><span data-stu-id="48e8b-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="48e8b-215">這會帶出資料表配接器組態精靈 」，這點我們發生了許多過去的教學課程所示。</span><span class="sxs-lookup"><span data-stu-id="48e8b-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="48e8b-216">更新查詢，以帶回`BrochurePath`按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="48e8b-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>


<span data-ttu-id="48e8b-217">[![更新資料行清單中 SELECT 陳述式也會傳回 BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span></span>

<span data-ttu-id="48e8b-218">**圖 7**:更新中的資料行清單`SELECT`陳述式，也會傳回`BrochurePath`([按一下以檢視完整大小的影像](uploading-files-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-cs/_static/image10.png))</span></span>


<span data-ttu-id="48e8b-219">當使用 TableAdapter 的特定 SQL 陳述式，更新主查詢中的資料行清單的所有更新的資料行清單`SELECT`查詢中的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="48e8b-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="48e8b-220">這表示`GetCategoryByCategoryID(categoryID)`方法來傳回已更新`BrochurePath`資料行，這可能是我們想要的結果。</span><span class="sxs-lookup"><span data-stu-id="48e8b-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="48e8b-221">不過，它也更新中的資料行清單`GetCategoriesAndNumberOfProducts()`方法，移除子查詢傳回的每個類別目錄的產品數目 ！</span><span class="sxs-lookup"><span data-stu-id="48e8b-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="48e8b-222">因此，我們需要更新此方法的`SELECT`查詢。</span><span class="sxs-lookup"><span data-stu-id="48e8b-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="48e8b-223">以滑鼠右鍵按一下`GetCategoriesAndNumberOfProducts()`方法中，選擇 [設定]，並還原`SELECT`回到其原始值的查詢：</span><span class="sxs-lookup"><span data-stu-id="48e8b-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>


[!code-sql[Main](uploading-files-cs/samples/sample2.sql)]

<span data-ttu-id="48e8b-224">接下來，建立新的 TableAdapter 方法會傳回特定類別的`Picture`資料行的值。</span><span class="sxs-lookup"><span data-stu-id="48e8b-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="48e8b-225">以滑鼠右鍵按一下`CategoriesTableAdapter`s 標頭，然後選擇 加入查詢選項，以啟動 TableAdapter 查詢組態精靈。</span><span class="sxs-lookup"><span data-stu-id="48e8b-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="48e8b-226">此精靈的第一個步驟會要求我們是否我們想要使用特定 SQL 陳述式的查詢資料時，新的預存程序或現有的帳戶。</span><span class="sxs-lookup"><span data-stu-id="48e8b-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="48e8b-227">選取 使用 SQL 陳述式，然後按一下 下一步。</span><span class="sxs-lookup"><span data-stu-id="48e8b-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="48e8b-228">因為我們將會傳回一個資料列，選擇 SELECT 會傳回第二個步驟中的資料列的選項。</span><span class="sxs-lookup"><span data-stu-id="48e8b-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>


<span data-ttu-id="48e8b-229">[![選取 使用 SQL 陳述式選項](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-229">[![Select the Use SQL statements Option](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span></span>

<span data-ttu-id="48e8b-230">**圖 8**:選取 使用 SQL 陳述式選項 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-cs/_static/image12.png))</span></span>


<span data-ttu-id="48e8b-231">[![因為查詢會傳回一筆記錄，從 Categories 資料表，選擇選取 傳回資料列](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span></span>

<span data-ttu-id="48e8b-232">**圖 9**:因為查詢會傳回一筆記錄，從 Categories 資料表中，選擇 選取會傳回資料列 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-cs/_static/image14.png))</span></span>


<span data-ttu-id="48e8b-233">在第三個步驟中，輸入下列 SQL 查詢，然後按一下 [下一步]:</span><span class="sxs-lookup"><span data-stu-id="48e8b-233">In the third step, enter the following SQL query and click Next:</span></span>


[!code-sql[Main](uploading-files-cs/samples/sample3.sql)]

<span data-ttu-id="48e8b-234">最後一個步驟是選擇新方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="48e8b-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="48e8b-235">使用`FillCategoryWithBinaryDataByCategoryID`和`GetCategoryWithBinaryDataByCategoryID`填滿的 DataTable 和傳回 DataTable 模式，分別。</span><span class="sxs-lookup"><span data-stu-id="48e8b-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="48e8b-236">按一下 完成 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="48e8b-236">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="48e8b-237">[![選擇 TableAdapter 的方法的名稱](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span></span>

<span data-ttu-id="48e8b-238">**圖 10**:選擇 tableadapter 方法的名稱 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-cs/_static/image16.png))</span></span>


> [!NOTE]
> <span data-ttu-id="48e8b-239">資料表配接器查詢組態精靈完成後，您可能會看到對話方塊，通知您新命令文字傳回資料，包含結構描述上的主查詢的結構描述不同。</span><span class="sxs-lookup"><span data-stu-id="48e8b-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="48e8b-240">簡單地說，精靈會注意的是，TableAdapter s 主查詢`GetCategories()`傳回不同的結構描述比我們剛剛建立的一個。</span><span class="sxs-lookup"><span data-stu-id="48e8b-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="48e8b-241">但是，這是我們想，因此您可以忽略此訊息。</span><span class="sxs-lookup"><span data-stu-id="48e8b-241">But this is what we want, so you can disregard this message.</span></span>


<span data-ttu-id="48e8b-242">此外，請記住，如果您使用特定 SQL 陳述式，並使用精靈來變更 TableAdapter s 主查詢，在稍後的時間，它會修改`GetCategoryWithBinaryDataByCategoryID`方法的`SELECT`陳述式 s 資料行清單中包含的資料行主要的查詢 (也就是它會移除`Picture`來自查詢的資料行)。</span><span class="sxs-lookup"><span data-stu-id="48e8b-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="48e8b-243">您必須手動更新傳回的資料行清單`Picture`資料行，類似於我們與`GetCategoriesAndNumberOfProducts()`稍早在此步驟中的方法。</span><span class="sxs-lookup"><span data-stu-id="48e8b-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="48e8b-244">新增兩個後`DataColumn`s`CategoriesDataTable`而`GetCategoryWithBinaryDataByCategoryID`方法，以`CategoriesTableAdapter`，這些型別 DataSet 設計工具中的類別應該看起來像 [圖 11] 中的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="48e8b-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>


![DataSet 設計工具包括新的資料行和方法](uploading-files-cs/_static/image11.gif)

<span data-ttu-id="48e8b-246">**圖 11**:DataSet 設計工具包括新的資料行和方法</span><span class="sxs-lookup"><span data-stu-id="48e8b-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>


## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="48e8b-247">正在更新商務邏輯層 (BLL)</span><span class="sxs-lookup"><span data-stu-id="48e8b-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="48e8b-248">使用更新的 DAL，剩下的就是以增強的 「 商務邏輯層 (BLL) 」，以納入新的方法`CategoriesTableAdapter`方法。</span><span class="sxs-lookup"><span data-stu-id="48e8b-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="48e8b-249">將下列方法加入`CategoriesBLL`類別：</span><span class="sxs-lookup"><span data-stu-id="48e8b-249">Add the following method to the `CategoriesBLL` class:</span></span>


[!code-csharp[Main](uploading-files-cs/samples/sample4.cs)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="48e8b-250">步驟 5：上傳至 Web 伺服器從用戶端檔案</span><span class="sxs-lookup"><span data-stu-id="48e8b-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="48e8b-251">收集二進位資料時，通常這項資料是由使用者所提供。</span><span class="sxs-lookup"><span data-stu-id="48e8b-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="48e8b-252">若要擷取這項資訊，使用者必須能夠從他們的電腦到 web 伺服器將檔案上傳。</span><span class="sxs-lookup"><span data-stu-id="48e8b-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="48e8b-253">然後上傳的資料必須與資料模型中，這可能表示將檔案儲存至 web 伺服器檔案系統並將路徑新增至資料庫中的檔案或二進位內容直接寫入資料庫的整合。</span><span class="sxs-lookup"><span data-stu-id="48e8b-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="48e8b-254">在此步驟中我們將探討如何讓使用者從他們的電腦與伺服器的檔案上傳。</span><span class="sxs-lookup"><span data-stu-id="48e8b-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="48e8b-255">在下一個教學課程中我們將把焦點轉到整合資料模型中的上傳的檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="48e8b-256">ASP.NET 2.0 的新[FileUpload Web 控制項](https://msdn.microsoft.com/library/ms227677(VS.80).aspx)提供一個機制，將檔案從他們的電腦傳送到 web 伺服器的使用者。</span><span class="sxs-lookup"><span data-stu-id="48e8b-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="48e8b-257">FileUpload 控制項轉譯成`<input>`項目其`type`屬性設為瀏覽 按鈕與文字方塊的瀏覽器顯示的檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="48e8b-258">按一下 [瀏覽] 按鈕會顯示的對話方塊，使用者可以從中選取檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="48e8b-259">當表單回傳時，所選的檔案的內容與回傳一起傳送。</span><span class="sxs-lookup"><span data-stu-id="48e8b-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="48e8b-260">伺服器端上傳檔案的相關資訊是透過 FileUpload 控制項的內容存取。</span><span class="sxs-lookup"><span data-stu-id="48e8b-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="48e8b-261">若要示範如何將檔案上傳，開啟`FileUpload.aspx`頁面中`BinaryData`資料夾中，將 FileUpload 控制項從工具箱拖曳至設計工具中，並將控制項 s`ID`屬性設`UploadTest`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="48e8b-262">接下來，新增按鈕 Web 控制項設定其`ID`並`Text`屬性，以`UploadButton`並分別上傳選取的檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="48e8b-263">最後，清除中放置標籤 Web 控制項下方的按鈕，其`Text`屬性並設定其`ID`屬性設`UploadDetails`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>


<span data-ttu-id="48e8b-264">[![FileUpload 控制項加入 ASP.NET 網頁](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span></span>

<span data-ttu-id="48e8b-265">**圖 12**:FileUpload 控制項加入 ASP.NET 網頁 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-cs/_static/image18.png))</span></span>


<span data-ttu-id="48e8b-266">[圖 13] 顯示此頁面上，當透過瀏覽器檢視。</span><span class="sxs-lookup"><span data-stu-id="48e8b-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="48e8b-267">請注意，按一下 [瀏覽] 按鈕會開啟檔案選取對話方塊中，可讓使用者能夠選取的檔案，從他們的電腦。</span><span class="sxs-lookup"><span data-stu-id="48e8b-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="48e8b-268">選取的檔案，按一下 [上傳選取的檔案] 按鈕後，將選取的檔案二進位內容傳送至 web 伺服器回傳。</span><span class="sxs-lookup"><span data-stu-id="48e8b-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>


<span data-ttu-id="48e8b-269">[![使用者可以選取要從他們的電腦上傳到伺服器的檔案](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span></span>

<span data-ttu-id="48e8b-270">**圖 13**:使用者可以選取要上傳檔案從伺服器電腦 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-cs/_static/image20.png))</span></span>


<span data-ttu-id="48e8b-271">在回傳時，請上傳的檔案可以儲存至檔案系統，或可以直接透過 Stream 使用過其二進位資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="48e8b-272">此範例中，讓建立`~/Brochures`資料夾，並將儲存並上傳的檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="48e8b-273">首先新增`Brochures`至網站根目錄的子資料夾的資料夾。</span><span class="sxs-lookup"><span data-stu-id="48e8b-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="48e8b-274">接下來，建立的事件處理常式`UploadButton`s`Click`事件，並新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="48e8b-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>


[!code-csharp[Main](uploading-files-cs/samples/sample5.cs)]

<span data-ttu-id="48e8b-275">FileUpload 控制項提供各種不同的使用上傳資料的屬性。</span><span class="sxs-lookup"><span data-stu-id="48e8b-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="48e8b-276">比方說， [ `HasFile`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx)指出檔案是否已上傳的使用者，雖然[`FileBytes`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx)為位元組陣列提供已上傳二進位資料的存取權。</span><span class="sxs-lookup"><span data-stu-id="48e8b-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="48e8b-277">`Click`事件處理常式一開始會確保已上傳檔案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="48e8b-278">如果已上傳檔案，則標籤會顯示上傳的檔案，以位元組為單位，其大小和其內容類型的名稱。</span><span class="sxs-lookup"><span data-stu-id="48e8b-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="48e8b-279">若要確保在使用者上傳的檔案，您可以檢查`HasFile`屬性，並顯示一則警告，如果它 s `false`，或您可以使用[RequiredFieldValidator 控制項](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx)改為。</span><span class="sxs-lookup"><span data-stu-id="48e8b-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `false`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>


<span data-ttu-id="48e8b-280">S FileUpload`SaveAs(filePath)`將上傳的檔案儲存至指定*filePath*。</span><span class="sxs-lookup"><span data-stu-id="48e8b-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="48e8b-281">*filePath*必須是*實體路徑*(`C:\Websites\Brochures\SomeFile.pdf`) 而非*虛擬\*\*路徑*(`/Brochures/SomeFile.pdf`)。</span><span class="sxs-lookup"><span data-stu-id="48e8b-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="48e8b-282">[ `Server.MapPath(virtPath)`方法](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx)虛擬路徑，並傳回其對應的實體路徑。</span><span class="sxs-lookup"><span data-stu-id="48e8b-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="48e8b-283">這裡的虛擬路徑是`~/Brochures/fileName`，其中*fileName*是上傳的檔案名稱。</span><span class="sxs-lookup"><span data-stu-id="48e8b-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="48e8b-284">請參閱[使用 Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml)如需有關虛擬和實體路徑，並使用`Server.MapPath`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="48e8b-285">完成之後`Click`事件處理常式，請花一點時間瀏覽器中測試。</span><span class="sxs-lookup"><span data-stu-id="48e8b-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="48e8b-286">按一下 瀏覽按鈕並選取您的硬碟中的檔案，然後按一下 上傳選取的檔案 按鈕。</span><span class="sxs-lookup"><span data-stu-id="48e8b-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="48e8b-287">回傳會將所選檔案的內容傳送至 web 伺服器，然後將會顯示檔案的相關資訊，再將它儲存為`~/Brochures`資料夾。</span><span class="sxs-lookup"><span data-stu-id="48e8b-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="48e8b-288">上傳檔案之後, 返回 Visual Studio，然後按一下 方案總管 中的重新整理 按鈕。</span><span class="sxs-lookup"><span data-stu-id="48e8b-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="48e8b-289">您應該會看到您剛才上傳 ~/Brochures 資料夾中的檔案 ！</span><span class="sxs-lookup"><span data-stu-id="48e8b-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>


<span data-ttu-id="48e8b-290">[![檔案 EvolutionValley.jpg 已上傳至 Web 伺服器](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="48e8b-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span></span>

<span data-ttu-id="48e8b-291">**圖 14**:檔案`EvolutionValley.jpg`已上傳至 Web 伺服器 ([按一下以檢視完整大小的影像](uploading-files-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="48e8b-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-cs/_static/image22.png))</span></span>


![EvolutionValley.jpg 已儲存至 ~/Brochures 資料夾](uploading-files-cs/_static/image15.gif)

<span data-ttu-id="48e8b-293">**圖 15**:`EvolutionValley.jpg` 已儲存至`~/Brochures`資料夾</span><span class="sxs-lookup"><span data-stu-id="48e8b-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>


## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="48e8b-294">上傳的檔案儲存至檔案系統的微妙之處</span><span class="sxs-lookup"><span data-stu-id="48e8b-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="48e8b-295">有數種微妙之處，儲存檔案上傳至 web 伺服器檔案系統時必須加以解決。</span><span class="sxs-lookup"><span data-stu-id="48e8b-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="48e8b-296">首先，那里安全性問題。</span><span class="sxs-lookup"><span data-stu-id="48e8b-296">First, there s the issue of security.</span></span> <span data-ttu-id="48e8b-297">若要將檔案儲存至檔案系統中，執行 ASP.NET 網頁的安全性內容必須具有寫入權限。</span><span class="sxs-lookup"><span data-stu-id="48e8b-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="48e8b-298">在目前的使用者帳戶的內容下執行 ASP.NET Development Web Server。</span><span class="sxs-lookup"><span data-stu-id="48e8b-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="48e8b-299">如果您使用 Microsoft 的 Internet Information Services (IIS) 做為 web 伺服器，安全性內容取決於 IIS 和其組態的版本。</span><span class="sxs-lookup"><span data-stu-id="48e8b-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="48e8b-300">將檔案儲存至檔案系統的另一項挑戰的檔案命名為中心。</span><span class="sxs-lookup"><span data-stu-id="48e8b-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="48e8b-301">目前，我們的頁面便會儲存所有上傳的檔案，以`~/Brochures`為 s 的用戶端電腦上的檔案使用相同名稱的目錄。</span><span class="sxs-lookup"><span data-stu-id="48e8b-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="48e8b-302">如果使用者的上傳同名摺頁冊`Brochure.pdf`，檔案會儲存為`~/Brochure/Brochure.pdf`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="48e8b-303">但如果一段時間的更新版本的使用者 B 將檔案上傳不同的手冊，剛好有相同的檔案名稱 (`Brochure.pdf`)？</span><span class="sxs-lookup"><span data-stu-id="48e8b-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="48e8b-304">使用程式碼現在有，s 檔案將會覆寫與使用者 B s 上傳的使用者。</span><span class="sxs-lookup"><span data-stu-id="48e8b-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="48e8b-305">有幾個方法來解析檔案名稱衝突。</span><span class="sxs-lookup"><span data-stu-id="48e8b-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="48e8b-306">其中一個選項是禁止上傳檔案，如果已存在具有相同名稱的其中一個。</span><span class="sxs-lookup"><span data-stu-id="48e8b-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="48e8b-307">使用此方法，當使用者 B 嘗試上傳檔案，名為`Brochure.pdf`，系統不會儲存其檔案，並不會改為顯示訊息，通知使用者 B 重新命名檔案，再試一次。</span><span class="sxs-lookup"><span data-stu-id="48e8b-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="48e8b-308">另一個方法是使用唯一的檔案名稱，這可能是儲存檔案[全域唯一識別碼 (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)或從對應的資料庫記錄的 s 主索引鍵資料行的值 (假設上傳相關聯特定資料列的資料模型中）。</span><span class="sxs-lookup"><span data-stu-id="48e8b-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="48e8b-309">在下一個教學課程中，我們將探討這些選項的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="48e8b-310">涉及極大量的二進位資料的挑戰</span><span class="sxs-lookup"><span data-stu-id="48e8b-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="48e8b-311">這些教學課程會假設擷取二進位資料是在大小太大。</span><span class="sxs-lookup"><span data-stu-id="48e8b-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="48e8b-312">使用非常大量的二進位資料檔案，則數 mb 或更大導入了新的挑戰，討論這些教學課程的範圍內。</span><span class="sxs-lookup"><span data-stu-id="48e8b-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="48e8b-313">例如，根據預設 ASP.NET 會拒絕上的傳超過 4 mb，雖然這可以透過設定[`<httpRuntime>`項目](https://msdn.microsoft.com/library/e1f13641.aspx)在`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="48e8b-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="48e8b-314">IIS 會為它自己的檔案上傳大小的限制，過。</span><span class="sxs-lookup"><span data-stu-id="48e8b-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="48e8b-315">請參閱[IIS 上傳的檔案大小](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html)如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="48e8b-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="48e8b-316">此外上, 傳大型檔案所花費的時間可能會要求將會等到 ASP.NET 110 秒超過預設值。</span><span class="sxs-lookup"><span data-stu-id="48e8b-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="48e8b-317">也有使用大型檔案時所發生的記憶體和效能問題。</span><span class="sxs-lookup"><span data-stu-id="48e8b-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="48e8b-318">FileUpload 控制項是不切實際的大型檔案上傳。</span><span class="sxs-lookup"><span data-stu-id="48e8b-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="48e8b-319">因為檔案的內容張貼至伺服器，終端使用者必須耐心等待而不需要任何其上傳正在進行的確認。</span><span class="sxs-lookup"><span data-stu-id="48e8b-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="48e8b-320">處理較小的檔案可上傳在幾秒鐘，但可以處理較大可能需要分鐘的時間才能上傳的檔案時，會發生問題時，這是不這麼多的問題。</span><span class="sxs-lookup"><span data-stu-id="48e8b-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="48e8b-321">有各種不同的第三方檔案上傳控制項更適合處理大上傳，許多這些廠商提供進度指標和 ActiveX 上傳管理員，可提供更完備的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="48e8b-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="48e8b-322">如果您的應用程式需要處理大型檔案，您必須仔細調查所面臨的挑戰，並針對您特定的需求尋找適當的解決方案。</span><span class="sxs-lookup"><span data-stu-id="48e8b-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="48e8b-323">總結</span><span class="sxs-lookup"><span data-stu-id="48e8b-323">Summary</span></span>

<span data-ttu-id="48e8b-324">建置的應用程式必須擷取二進位資料導入了幾項挑戰。</span><span class="sxs-lookup"><span data-stu-id="48e8b-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="48e8b-325">在本教學課程中，我們探討前兩個： 決定儲存二進位資料的位置，並讓使用者透過網頁的二進位內容上傳。</span><span class="sxs-lookup"><span data-stu-id="48e8b-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="48e8b-326">透過接下來三個教學課程中，我們會看到如何上傳的資料關聯的資料庫中的記錄，以及如何顯示其文字資料欄位旁邊的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="48e8b-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="48e8b-327">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="48e8b-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="48e8b-328">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="48e8b-328">Further Reading</span></span>

<span data-ttu-id="48e8b-329">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="48e8b-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="48e8b-330">使用大數值資料類型</span><span class="sxs-lookup"><span data-stu-id="48e8b-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="48e8b-331">FileUpload 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="48e8b-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="48e8b-332">ASP.NET 2.0 FileUpload 伺服器控制項</span><span class="sxs-lookup"><span data-stu-id="48e8b-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="48e8b-333">深色的側邊的檔案上傳</span><span class="sxs-lookup"><span data-stu-id="48e8b-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="48e8b-334">關於作者</span><span class="sxs-lookup"><span data-stu-id="48e8b-334">About the Author</span></span>

<span data-ttu-id="48e8b-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="48e8b-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="48e8b-336">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="48e8b-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="48e8b-337">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="48e8b-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="48e8b-338">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="48e8b-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="48e8b-339">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="48e8b-339">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="48e8b-340">特別感謝</span><span class="sxs-lookup"><span data-stu-id="48e8b-340">Special Thanks To</span></span>

<span data-ttu-id="48e8b-341">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="48e8b-341">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="48e8b-342">本教學課程中的潛在客戶檢閱者已 Teresa Murphy 和 Bernadette Leigh。</span><span class="sxs-lookup"><span data-stu-id="48e8b-342">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="48e8b-343">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="48e8b-343">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="48e8b-344">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="48e8b-344">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="48e8b-345">下一步</span><span class="sxs-lookup"><span data-stu-id="48e8b-345">Next</span></span>](displaying-binary-data-in-the-data-web-controls-cs.md)
