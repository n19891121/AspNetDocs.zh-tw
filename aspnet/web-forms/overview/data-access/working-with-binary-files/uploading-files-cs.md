---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
title: 正在上傳C#檔案（） |Microsoft Docs
author: rick-anderson
description: 瞭解如何允許使用者將二進位檔案（例如 Word 或 PDF 檔）上傳至您的網站，而這些檔案可能會儲存在伺服器的檔案系統中 。
ms.author: riande
ms.date: 03/27/2007
ms.assetid: b381b1da-feb3-4776-bc1b-75db53eb90ab
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
msc.type: authoredcontent
ms.openlocfilehash: 4e3e32a829de386a681504c8d5d61dd258b8b2e6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74581637"
---
# <a name="uploading-files-c"></a><span data-ttu-id="e8329-103">上傳檔案 (C#)</span><span class="sxs-lookup"><span data-stu-id="e8329-103">Uploading Files (C#)</span></span>

<span data-ttu-id="e8329-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e8329-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e8329-105">[下載範例應用程式](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe)或[下載 PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e8329-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) or [Download PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span></span>

> <span data-ttu-id="e8329-106">瞭解如何允許使用者將二進位檔案（例如 Word 或 PDF 檔）上傳至您的網站，這些檔案可以儲存在伺服器的檔案系統或資料庫中。</span><span class="sxs-lookup"><span data-stu-id="e8329-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="e8329-107">簡介</span><span class="sxs-lookup"><span data-stu-id="e8329-107">Introduction</span></span>

<span data-ttu-id="e8329-108">目前為止我們檢查過的所有教學課程，都是以獨佔方式處理文字資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="e8329-109">不過，許多應用程式都有可同時捕捉文字和二進位資料的資料模型。</span><span class="sxs-lookup"><span data-stu-id="e8329-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="e8329-110">線上可追溯網站可以讓使用者上傳圖片，使其與設定檔產生關聯。</span><span class="sxs-lookup"><span data-stu-id="e8329-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="e8329-111">招聘網站可能會讓使用者將其繼續上傳為 Microsoft Word 或 PDF 檔。</span><span class="sxs-lookup"><span data-stu-id="e8329-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="e8329-112">使用二進位資料會增加一組新的挑戰。</span><span class="sxs-lookup"><span data-stu-id="e8329-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="e8329-113">我們必須決定二進位資料儲存在應用程式中的方式。</span><span class="sxs-lookup"><span data-stu-id="e8329-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="e8329-114">用來插入新記錄的介面必須更新，才能讓使用者從其電腦上傳檔案，而且必須採取額外的步驟，才能顯示或提供下載記錄相關二進位資料的方法。</span><span class="sxs-lookup"><span data-stu-id="e8329-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="e8329-115">在本教學課程和接下來的三個中，我們將探討如何解決這些挑戰。</span><span class="sxs-lookup"><span data-stu-id="e8329-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="e8329-116">在這些教學課程的結尾，我們將建立一個功能完整的應用程式，讓圖片與 PDF 手冊與每個類別產生關聯。</span><span class="sxs-lookup"><span data-stu-id="e8329-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="e8329-117">在本教學課程中，我們將探討儲存二進位資料的不同技術，並探索如何讓使用者從電腦上傳檔案，並將它儲存在 web 伺服器 s 檔案系統上。</span><span class="sxs-lookup"><span data-stu-id="e8329-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="e8329-118">屬於應用程式資料模型一部分的二進位資料有時稱為「 [BLOB](http://en.wikipedia.org/wiki/Binary_large_object)」（二進位大型物件的縮寫）。</span><span class="sxs-lookup"><span data-stu-id="e8329-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="e8329-119">在這些教學課程中，我選擇使用「二進位」這兩個術語，雖然「BLOB」一詞是同義。</span><span class="sxs-lookup"><span data-stu-id="e8329-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>

## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="e8329-120">步驟1：建立使用二進位資料網頁</span><span class="sxs-lookup"><span data-stu-id="e8329-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="e8329-121">開始探索與新增二進位資料支援相關的挑戰之前，讓我們先花點時間在我們的網站專案中建立 ASP.NET 網頁，我們將在本教學課程和接下來的三個網頁中使用。</span><span class="sxs-lookup"><span data-stu-id="e8329-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="e8329-122">從新增名為 `BinaryData`的資料夾開始。</span><span class="sxs-lookup"><span data-stu-id="e8329-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="e8329-123">接下來，將下列 ASP.NET 網頁新增至該資料夾，並確定每個頁面都與 `Site.master` 主版頁面相關聯：</span><span class="sxs-lookup"><span data-stu-id="e8329-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`

![加入二進位資料相關教學課程的 ASP.NET 網頁](uploading-files-cs/_static/image1.gif)

<span data-ttu-id="e8329-125">**圖 1**：加入二進位資料相關教學課程的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="e8329-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>

<span data-ttu-id="e8329-126">如同在其他資料夾中，[`BinaryData`] 資料夾中的 `Default.aspx` 會在其區段中列出教學課程。</span><span class="sxs-lookup"><span data-stu-id="e8329-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="e8329-127">回想一下，`SectionLevelTutorialListing.ascx` 的使用者控制項會提供這種功能。</span><span class="sxs-lookup"><span data-stu-id="e8329-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="e8329-128">因此，請將這個使用者控制項加入至 `Default.aspx`，方法是將它從方案總管拖曳至頁面 s 設計檢視。</span><span class="sxs-lookup"><span data-stu-id="e8329-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="e8329-129">[![將 SectionLevelTutorialListing 的 .ascx 使用者控制項新增至 default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span></span>

<span data-ttu-id="e8329-130">**圖 2**：將 `SectionLevelTutorialListing.ascx` 使用者控制項加入 `Default.aspx` （[按一下以查看完整大小的影像](uploading-files-cs/_static/image2.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-cs/_static/image2.png))</span></span>

<span data-ttu-id="e8329-131">最後，將這些頁面新增為 `Web.sitemap` 檔案的專案。</span><span class="sxs-lookup"><span data-stu-id="e8329-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="e8329-132">具體而言，在增強 GridView `<siteMapNode>`之後，加入下列標記：</span><span class="sxs-lookup"><span data-stu-id="e8329-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>

[!code-xml[Main](uploading-files-cs/samples/sample1.xml)]

<span data-ttu-id="e8329-133">更新 `Web.sitemap`之後，請花一點時間透過瀏覽器來觀看教學課程網站。</span><span class="sxs-lookup"><span data-stu-id="e8329-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="e8329-134">左側功能表現在包含使用二進位資料教學課程的專案。</span><span class="sxs-lookup"><span data-stu-id="e8329-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>

![網站地圖現在包含使用二進位資料教學課程的專案](uploading-files-cs/_static/image3.gif)

<span data-ttu-id="e8329-136">**圖 3**：網站地圖現在包含使用二進位資料教學課程的專案</span><span class="sxs-lookup"><span data-stu-id="e8329-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>

## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="e8329-137">步驟2：決定二進位資料的儲存位置</span><span class="sxs-lookup"><span data-stu-id="e8329-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="e8329-138">與應用程式資料模型相關聯的二進位資料可以儲存在下列兩個位置的其中一個： web 伺服器 s 檔案系統上具有儲存在資料庫中之檔案的參考;或直接在資料庫本身內（請參閱 [圖 4]）。</span><span class="sxs-lookup"><span data-stu-id="e8329-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="e8329-139">每種方法都有一組自己的優缺點，並獲得更詳細的討論。</span><span class="sxs-lookup"><span data-stu-id="e8329-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>

<span data-ttu-id="e8329-140">[![二進位資料可以儲存在檔案系統上，或是直接存放在資料庫中。](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span></span>

<span data-ttu-id="e8329-141">**圖 4**：二進位資料可以儲存在檔案系統上，或直接存放在資料庫中（[按一下以查看完整大小的影像](uploading-files-cs/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-cs/_static/image4.png))</span></span>

<span data-ttu-id="e8329-142">假設我們想要擴充 Northwind 資料庫，讓圖片與每個產品產生關聯。</span><span class="sxs-lookup"><span data-stu-id="e8329-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="e8329-143">其中一個選項是將這些影像檔案儲存在 web 伺服器的檔案系統上，並將路徑記錄在 `Products` 表中。</span><span class="sxs-lookup"><span data-stu-id="e8329-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="e8329-144">使用這種方法時，我們會將 `ImagePath` 資料行新增至類型 `varchar(200)`的 `Products` 資料表中，也許是。</span><span class="sxs-lookup"><span data-stu-id="e8329-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="e8329-145">當使用者上傳 Chai 的圖片時，該圖片可能會儲存在 web 伺服器 s 檔案系統的 `~/Images/Tea.jpg`，其中 `~` 代表應用程式的實體路徑。</span><span class="sxs-lookup"><span data-stu-id="e8329-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="e8329-146">也就是說，如果網站的根目錄是實體路徑 `C:\Websites\Northwind\`，`~/Images/Tea.jpg` 就相當於 `C:\Websites\Northwind\Images\Tea.jpg`。</span><span class="sxs-lookup"><span data-stu-id="e8329-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="e8329-147">上傳影像檔案之後，我們會更新 `Products` 資料表中的 Chai 記錄，使其 `ImagePath` 的資料行參考新影像的路徑。</span><span class="sxs-lookup"><span data-stu-id="e8329-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="e8329-148">我們可以使用 `~/Images/Tea.jpg` 或只在我們決定將所有產品映射放在應用程式的 `Images` 資料夾中時 `Tea.jpg`。</span><span class="sxs-lookup"><span data-stu-id="e8329-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="e8329-149">將二進位資料儲存在檔案系統上的主要優點如下：</span><span class="sxs-lookup"><span data-stu-id="e8329-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="e8329-150">如我們稍後所見，**輕鬆執行**，儲存和抓取直接儲存在資料庫中的二進位資料，比透過檔案系統處理資料還需要更多的程式碼。</span><span class="sxs-lookup"><span data-stu-id="e8329-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="e8329-151">此外，為了讓使用者能夠查看或下載二進位資料，必須以該資料的 URL 呈現。</span><span class="sxs-lookup"><span data-stu-id="e8329-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="e8329-152">如果資料位於 web 伺服器的檔案系統上，則 URL 十分簡單。</span><span class="sxs-lookup"><span data-stu-id="e8329-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="e8329-153">不過，如果資料儲存在資料庫中，就必須建立網頁，以從資料庫中抓取和傳回資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="e8329-154">若要**更廣泛存取二進位資料**，可能需要其他服務或應用程式才能存取二進位資料，而不能從資料庫提取資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="e8329-155">例如，與每個產品相關聯的映射可能也必須透過[FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol)提供給使用者，在此情況下，我們會想要將二進位資料儲存在檔案系統上。</span><span class="sxs-lookup"><span data-stu-id="e8329-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="e8329-156">**效能**如果二進位資料儲存在檔案系統上，則資料庫伺服器與 web 伺服器之間的需求和網路擁塞將會小於二進位資料直接儲存在資料庫中的情況。</span><span class="sxs-lookup"><span data-stu-id="e8329-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="e8329-157">將二進位資料儲存在檔案系統上的主要缺點是，它會將資料與資料庫分離。</span><span class="sxs-lookup"><span data-stu-id="e8329-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="e8329-158">如果從 `Products` 資料表中刪除記錄，則不會自動刪除 web 伺服器 s 檔案系統上的相關聯檔案。</span><span class="sxs-lookup"><span data-stu-id="e8329-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="e8329-159">我們必須撰寫額外的程式碼來刪除檔案，否則檔案系統將會與未使用的孤立檔案變得雜亂。</span><span class="sxs-lookup"><span data-stu-id="e8329-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="e8329-160">此外，在備份資料庫時，我們也必須務必在檔案系統上建立相關聯二進位資料的備份。</span><span class="sxs-lookup"><span data-stu-id="e8329-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="e8329-161">將資料庫移到另一個網站或伺服器會造成類似的挑戰。</span><span class="sxs-lookup"><span data-stu-id="e8329-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="e8329-162">或者，您也可以藉由建立 `varbinary`類型的資料行，將二進位資料直接儲存在 Microsoft SQL Server 2005 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="e8329-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="e8329-163">如同其他可變長度的資料類型，您可以指定可保留在此資料行中的二進位資料長度上限。</span><span class="sxs-lookup"><span data-stu-id="e8329-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="e8329-164">例如，若要保留最多5000個位元組，請使用 `varbinary(5000)`;`varbinary(MAX)` 允許儲存體大小上限，約 2 GB。</span><span class="sxs-lookup"><span data-stu-id="e8329-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="e8329-165">直接在資料庫中儲存二進位資料的主要優點是二進位資料與資料庫記錄之間的緊密結合。</span><span class="sxs-lookup"><span data-stu-id="e8329-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="e8329-166">這樣可大幅簡化資料庫管理工作，例如備份或將資料庫移至不同的網站或伺服器。</span><span class="sxs-lookup"><span data-stu-id="e8329-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="e8329-167">此外，刪除記錄時，會自動刪除對應的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="e8329-168">將二進位資料儲存在資料庫中也有更細微的好處。</span><span class="sxs-lookup"><span data-stu-id="e8329-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="e8329-169">如需更深入的討論，請參閱[使用 ASP.NET 2.0 直接將二進位檔案儲存在資料庫中](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e8329-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="e8329-170">在 Microsoft SQL Server 2000 和更早版本中，`varbinary` 資料類型的最大限制為8000個位元組。</span><span class="sxs-lookup"><span data-stu-id="e8329-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="e8329-171">若要儲存多達 2 GB 的二進位資料，必須改為使用[`image` 資料類型](https://msdn.microsoft.com/library/ms187993.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e8329-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="e8329-172">不過，在 SQL Server 2005 中加入 `MAX`，`image` 資料類型已被取代。</span><span class="sxs-lookup"><span data-stu-id="e8329-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="e8329-173">它仍然支援回溯相容性，但 Microsoft 宣佈 `image` 資料類型將會在 SQL Server 的未來版本中移除。</span><span class="sxs-lookup"><span data-stu-id="e8329-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>

<span data-ttu-id="e8329-174">如果您使用較舊的資料模型，您可能會看到 `image` 的資料類型。</span><span class="sxs-lookup"><span data-stu-id="e8329-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="e8329-175">Northwind 資料庫的 `Categories` 資料表具有 `Picture` 資料行，可用來儲存分類之影像檔案的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="e8329-176">由於 Northwind 資料庫在 Microsoft Access 和舊版的 SQL Server 中具有其根目錄，因此這個資料行的類型 `image`。</span><span class="sxs-lookup"><span data-stu-id="e8329-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="e8329-177">在本教學課程和接下來的三個中，我們將使用這兩種方法。</span><span class="sxs-lookup"><span data-stu-id="e8329-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="e8329-178">`Categories` 資料表已經有 `Picture` 的資料行，可用於儲存分類之影像的二進位內容。</span><span class="sxs-lookup"><span data-stu-id="e8329-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="e8329-179">我們會新增額外的資料行 `BrochurePath`，以在 web 伺服器 s 檔案系統上儲存 PDF 的路徑，可用來提供列印品質、精美的類別目錄。</span><span class="sxs-lookup"><span data-stu-id="e8329-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="e8329-180">步驟3：將`BrochurePath`資料行加入至`Categories`資料表</span><span class="sxs-lookup"><span data-stu-id="e8329-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="e8329-181">目前類別目錄資料表只有四個數據行： `CategoryID`、`CategoryName`、`Description`和 `Picture`。</span><span class="sxs-lookup"><span data-stu-id="e8329-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="e8329-182">除了這些欄位以外，我們還需要加入一個新的，以指向類別目錄的手冊（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="e8329-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="e8329-183">若要加入此資料行，請移至 [伺服器總管]，向下切入到資料表，以滑鼠右鍵按一下 [`Categories`] 資料表，然後選擇 [開啟資料表定義] （請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="e8329-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="e8329-184">如果您看不到伺服器總管，請從 [View] 功能表選取 [伺服器總管] 選項，或按 Ctrl + Alt + S 來啟動它。</span><span class="sxs-lookup"><span data-stu-id="e8329-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="e8329-185">將新的 `varchar(200)` 資料行加入至名為 `BrochurePath` 的 `Categories` 資料表，並允許 `NULL`，然後按一下 [儲存] 圖示（或按 Ctrl + S）。</span><span class="sxs-lookup"><span data-stu-id="e8329-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>

<span data-ttu-id="e8329-186">[![將 BrochurePath 資料行加入至分類資料表](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span></span>

<span data-ttu-id="e8329-187">**圖 5**：將 `BrochurePath` 資料行加入 `Categories` 資料表（[按一下以查看完整大小的影像](uploading-files-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-cs/_static/image6.png))</span></span>

## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="e8329-188">步驟4：更新架構以使用`Picture`和`BrochurePath`資料行</span><span class="sxs-lookup"><span data-stu-id="e8329-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="e8329-189">資料存取層（DAL）中的 `CategoriesDataTable` 目前已定義四個 `DataColumn`： `CategoryID`、`CategoryName`、`Description`和 `NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="e8329-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="e8329-190">當我們最初是在[建立資料存取層](../introduction/creating-a-data-access-layer-cs.md)教學課程中設計此 DataTable 時，`CategoriesDataTable` 只有前三個數據行;[`NumberOfProducts`] 資料行是[使用具有詳細資料 DataList 教學課程的主要記錄項目符號清單，在主要/細節](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)中加入。</span><span class="sxs-lookup"><span data-stu-id="e8329-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial.</span></span>

<span data-ttu-id="e8329-191">如*建立資料存取層*中所述，具類型資料集中的 datatable 組成商務物件。</span><span class="sxs-lookup"><span data-stu-id="e8329-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="e8329-192">Tableadapter 會負責與資料庫通訊，並以查詢結果填入商務物件。</span><span class="sxs-lookup"><span data-stu-id="e8329-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="e8329-193">`CategoriesDataTable` 由 `CategoriesTableAdapter`填入，其中包含三個數據抓取方法：</span><span class="sxs-lookup"><span data-stu-id="e8329-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="e8329-194">`GetCategories()` 執行 TableAdapter s main 查詢，並傳回 `Categories` 資料表中所有記錄的 `CategoryID`、`CategoryName`和 `Description` 欄位。</span><span class="sxs-lookup"><span data-stu-id="e8329-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="e8329-195">主要查詢是自動產生的 `Insert` 和 `Update` 方法所使用的。</span><span class="sxs-lookup"><span data-stu-id="e8329-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="e8329-196">`GetCategoryByCategoryID(categoryID)` 會傳回分類的 `CategoryID`、`CategoryName`和 `Description` 欄位，其 *`CategoryID` 等於「類別目錄*」。</span><span class="sxs-lookup"><span data-stu-id="e8329-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="e8329-197">`GetCategoriesAndNumberOfProducts()`-傳回 `Categories` 資料表中所有記錄的 `CategoryID`、`CategoryName`和 `Description` 欄位。</span><span class="sxs-lookup"><span data-stu-id="e8329-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="e8329-198">也會使用子查詢來傳回與每個類別目錄相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="e8329-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="e8329-199">請注意，這些查詢都不會傳回 `Categories` 資料表 s `Picture` 或 `BrochurePath` 資料行;`CategoriesDataTable` 也不會為這些欄位提供 `DataColumn`。</span><span class="sxs-lookup"><span data-stu-id="e8329-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="e8329-200">若要使用 [圖片] 和 [`BrochurePath`] 屬性，我們必須先將其加入 `CategoriesDataTable`，然後更新 `CategoriesTableAdapter` 類別以傳回這些資料行。</span><span class="sxs-lookup"><span data-stu-id="e8329-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="e8329-201">新增`Picture`和`BrochurePath``DataColumn` s</span><span class="sxs-lookup"><span data-stu-id="e8329-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="e8329-202">首先，將這兩個數據行加入至 `CategoriesDataTable`。</span><span class="sxs-lookup"><span data-stu-id="e8329-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="e8329-203">以滑鼠右鍵按一下 [`CategoriesDataTable` s] 標頭，從內容功能表中選取 [新增]，然後選擇 [資料行] 選項。</span><span class="sxs-lookup"><span data-stu-id="e8329-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="e8329-204">這會在名為 `Column1`的 DataTable 中建立新的 `DataColumn`。</span><span class="sxs-lookup"><span data-stu-id="e8329-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="e8329-205">將此資料行重新命名為 `Picture`。</span><span class="sxs-lookup"><span data-stu-id="e8329-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="e8329-206">從屬性視窗將 `DataColumn` s `DataType` 屬性設定為 [`System.Byte[]`] （這不是下拉式清單中的選項，您必須在中輸入）。</span><span class="sxs-lookup"><span data-stu-id="e8329-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>

<span data-ttu-id="e8329-207">[![建立名為 Picture 的 DataColumn，其資料類型為 System.object []](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span></span>

<span data-ttu-id="e8329-208">**圖 6**：建立名為 `Picture` 的 `DataColumn`，其 `DataType` 為 `System.Byte[]` （[按一下以查看完整大小的影像](uploading-files-cs/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-cs/_static/image8.png))</span></span>

<span data-ttu-id="e8329-209">將另一個 `DataColumn` 新增至 DataTable，使用預設 `DataType` 值（`System.String`）將它命名 `BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="e8329-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="e8329-210">從 TableAdapter 傳回`Picture`和`BrochurePath`值</span><span class="sxs-lookup"><span data-stu-id="e8329-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="e8329-211">在 `CategoriesDataTable`中加入這兩個 `DataColumn` 之後，我們就可以開始更新 `CategoriesTableAdapter`。</span><span class="sxs-lookup"><span data-stu-id="e8329-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="e8329-212">我們可以在主要的 TableAdapter 查詢中傳回這兩個數據行值，但這會在每次叫用 `GetCategories()` 方法時帶回二進位資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="e8329-213">相反地，讓 s 更新主要的 TableAdapter 查詢以帶回 `BrochurePath`，並建立一個會傳回特定分類 `Picture` 資料行的額外資料抓取方法。</span><span class="sxs-lookup"><span data-stu-id="e8329-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="e8329-214">若要更新主要的 TableAdapter 查詢，請以滑鼠右鍵按一下 [`CategoriesTableAdapter` s] 標頭，然後從內容功能表中選擇 [設定] 選項。</span><span class="sxs-lookup"><span data-stu-id="e8329-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="e8329-215">這會顯示 [表格介面卡設定向導]，我們已在一些過去的教學課程中看到。</span><span class="sxs-lookup"><span data-stu-id="e8329-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="e8329-216">更新查詢以取回 `BrochurePath`，然後按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="e8329-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>

<span data-ttu-id="e8329-217">[![更新 SELECT 語句中的資料行清單，以同時傳回 BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span></span>

<span data-ttu-id="e8329-218">**圖 7**：更新 `SELECT` 語句中的資料行清單，使其也傳回 `BrochurePath` （[按一下以觀看完整大小的影像](uploading-files-cs/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-cs/_static/image10.png))</span></span>

<span data-ttu-id="e8329-219">使用 TableAdapter 的臨機操作 SQL 語句時，更新主查詢中的資料行清單會更新 TableAdapter 中所有 `SELECT` 查詢方法的資料行清單。</span><span class="sxs-lookup"><span data-stu-id="e8329-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="e8329-220">這表示 `GetCategoryByCategoryID(categoryID)` 方法已更新，以傳回 `BrochurePath` 的資料行，這可能是我們所預期的。</span><span class="sxs-lookup"><span data-stu-id="e8329-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="e8329-221">不過，它也會更新 `GetCategoriesAndNumberOfProducts()` 方法中的資料行清單，移除傳回每個類別目錄之產品數目的子查詢！</span><span class="sxs-lookup"><span data-stu-id="e8329-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="e8329-222">因此，我們需要更新 `SELECT` 查詢的這個方法。</span><span class="sxs-lookup"><span data-stu-id="e8329-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="e8329-223">以滑鼠右鍵按一下 [`GetCategoriesAndNumberOfProducts()`] 方法，選擇 [設定]，然後將 `SELECT` 查詢還原回其原始值：</span><span class="sxs-lookup"><span data-stu-id="e8329-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample2.sql)]

<span data-ttu-id="e8329-224">接下來，建立新的 TableAdapter 方法，以傳回特定分類的 `Picture` 資料行值。</span><span class="sxs-lookup"><span data-stu-id="e8329-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="e8329-225">以滑鼠右鍵按一下 [`CategoriesTableAdapter` s] 標頭，然後選擇 [加入查詢] 選項以啟動 [TableAdapter 查詢設定向導]。</span><span class="sxs-lookup"><span data-stu-id="e8329-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="e8329-226">此 wizard 的第一個步驟會詢問我們是否要使用臨機操作 SQL 語句、新的預存程式或現有的程式來查詢資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="e8329-227">選取 [使用 SQL 語句]，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="e8329-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="e8329-228">因為我們將傳回資料列，請選擇第二個步驟中的 [選取傳回資料列] 選項。</span><span class="sxs-lookup"><span data-stu-id="e8329-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>

<span data-ttu-id="e8329-229">[![選取 [使用 SQL 語句] 選項](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-229">[![Select the Use SQL statements Option](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span></span>

<span data-ttu-id="e8329-230">**圖 8**：選取 [使用 SQL 語句] 選項（[按一下以查看完整大小的影像](uploading-files-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-cs/_static/image12.png))</span></span>

<span data-ttu-id="e8329-231">[![，因為查詢將傳回 category 資料表中的記錄，請選擇 [選取] 以傳回資料列](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span></span>

<span data-ttu-id="e8329-232">**圖 9**：因為查詢將從 category 資料表傳回記錄，請選擇 [選取] 以傳回資料列（[按一下以查看完整大小的影像](uploading-files-cs/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-cs/_static/image14.png))</span></span>

<span data-ttu-id="e8329-233">在第三個步驟中，輸入下列 SQL 查詢，然後按 [下一步]：</span><span class="sxs-lookup"><span data-stu-id="e8329-233">In the third step, enter the following SQL query and click Next:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample3.sql)]

<span data-ttu-id="e8329-234">最後一個步驟是選擇新方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="e8329-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="e8329-235">使用 `FillCategoryWithBinaryDataByCategoryID` 和 `GetCategoryWithBinaryDataByCategoryID` 來填入 DataTable，並分別傳回 DataTable 模式。</span><span class="sxs-lookup"><span data-stu-id="e8329-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="e8329-236">按一下 [完成] 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="e8329-236">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="e8329-237">[![選擇 TableAdapter s 方法的名稱](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span></span>

<span data-ttu-id="e8329-238">**圖 10**：選擇 TableAdapter s 方法的名稱（[按一下以查看完整大小的影像](uploading-files-cs/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-cs/_static/image16.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e8329-239">完成 [資料表介面卡查詢設定] 嚮導之後，您可能會看到一個對話方塊，通知您新的命令文字傳回的資料與主查詢的架構不同。</span><span class="sxs-lookup"><span data-stu-id="e8329-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="e8329-240">簡單地說，嚮導會注意到 TableAdapter 的主查詢 `GetCategories()` 傳回的架構與我們剛才建立的不同。</span><span class="sxs-lookup"><span data-stu-id="e8329-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="e8329-241">但這就是我們想要的，因此您可以忽略這則訊息。</span><span class="sxs-lookup"><span data-stu-id="e8329-241">But this is what we want, so you can disregard this message.</span></span>

<span data-ttu-id="e8329-242">此外，請記住，如果您使用臨機操作 SQL 語句，並在稍後的時間點使用此嚮導來變更 TableAdapter s 主查詢，它會將 `GetCategoryWithBinaryDataByCategoryID` 方法 s `SELECT` 語句的資料行清單修改成隻包含主要查詢中的資料行（亦即，它會從查詢中移除 `Picture` 的資料行）。</span><span class="sxs-lookup"><span data-stu-id="e8329-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="e8329-243">您必須手動更新資料行清單，以傳回 `Picture` 資料行，與我們稍早在此步驟中的 `GetCategoriesAndNumberOfProducts()` 方法所做的類似。</span><span class="sxs-lookup"><span data-stu-id="e8329-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="e8329-244">將兩個 `DataColumn` s 新增至 `CategoriesDataTable`，並將 `GetCategoryWithBinaryDataByCategoryID` 方法加入至 `CategoriesTableAdapter`之後，具類型資料集設計工具中的這些類別看起來應該像 [圖 11] 中的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="e8329-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>

![DataSet 設計工具組含新的資料行和方法](uploading-files-cs/_static/image11.gif)

<span data-ttu-id="e8329-246">**圖 11**： DataSet 設計工具組含新的資料行和方法</span><span class="sxs-lookup"><span data-stu-id="e8329-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>

## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="e8329-247">更新商務邏輯層（BLL）</span><span class="sxs-lookup"><span data-stu-id="e8329-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="e8329-248">在 DAL 更新之後，剩下的工作就是擴大商務邏輯層（BLL）以包含新 `CategoriesTableAdapter` 方法的方法。</span><span class="sxs-lookup"><span data-stu-id="e8329-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="e8329-249">將下列方法新增至 `CategoriesBLL` 類別：</span><span class="sxs-lookup"><span data-stu-id="e8329-249">Add the following method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample4.cs)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="e8329-250">步驟5：從用戶端將檔案上傳到 Web 服務器</span><span class="sxs-lookup"><span data-stu-id="e8329-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="e8329-251">收集二進位資料時，通常會由使用者提供這項資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="e8329-252">若要捕捉此資訊，使用者必須能夠從他們的電腦上傳檔案到 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="e8329-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="e8329-253">上傳的資料必須與資料模型整合，這可能表示將檔案儲存至 web 伺服器的檔案系統，並將路徑新增至資料庫中的檔案，或將二進位內容直接寫入資料庫中。</span><span class="sxs-lookup"><span data-stu-id="e8329-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="e8329-254">在此步驟中，我們將探討如何允許使用者將檔案從他們的電腦上傳到伺服器。</span><span class="sxs-lookup"><span data-stu-id="e8329-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="e8329-255">在下一個教學課程中，我們會將您的注意力轉換成將上傳的檔案與資料模型整合。</span><span class="sxs-lookup"><span data-stu-id="e8329-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="e8329-256">ASP.NET 2.0 s new [FileUpload web 控制項](https://msdn.microsoft.com/library/ms227677(VS.80).aspx)提供一種機制，讓使用者能夠從他們的電腦傳送檔案到 Web 服務器。</span><span class="sxs-lookup"><span data-stu-id="e8329-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="e8329-257">FileUpload 控制項會轉譯為 `<input>` 專案，其 `type` 屬性設定為 [檔案]，而瀏覽器會顯示為具有 [流覽] 按鈕的文字方塊。</span><span class="sxs-lookup"><span data-stu-id="e8329-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="e8329-258">按一下 [流覽] 按鈕會顯示對話方塊，使用者可以從中選取檔案。</span><span class="sxs-lookup"><span data-stu-id="e8329-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="e8329-259">當表單回傳時，選取的檔案的內容會連同回傳一起傳送。</span><span class="sxs-lookup"><span data-stu-id="e8329-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="e8329-260">在伺服器端上，可以透過 FileUpload 控制項的屬性存取上傳檔案的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="e8329-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="e8329-261">若要示範上傳檔案，請開啟 [`BinaryData`] 資料夾中的 [`FileUpload.aspx`] 頁面，將 [FileUpload] 控制項從 [工具箱] 拖曳至設計工具上，然後將 [控制項] `ID` 屬性設定為 [`UploadTest`]。</span><span class="sxs-lookup"><span data-stu-id="e8329-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="e8329-262">接下來，新增按鈕 Web 控制項設定其 `ID` 並 `Text` 屬性，分別 `UploadButton` 和上傳選取的檔案。</span><span class="sxs-lookup"><span data-stu-id="e8329-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="e8329-263">最後，將標籤 Web 控制項放在按鈕下方，清除其 `Text` 屬性，並將其 `ID` 屬性設定為 [`UploadDetails`]。</span><span class="sxs-lookup"><span data-stu-id="e8329-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>

<span data-ttu-id="e8329-264">[![將 FileUpload 控制項新增至 [ASP.NET] 頁面](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span></span>

<span data-ttu-id="e8329-265">**圖 12**：將 FileUpload 控制項新增至 [ASP.NET] 頁面（[按一下以查看完整大小的影像](uploading-files-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-cs/_static/image18.png))</span></span>

<span data-ttu-id="e8329-266">[圖 13] 顯示透過瀏覽器觀看的此頁面。</span><span class="sxs-lookup"><span data-stu-id="e8329-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="e8329-267">請注意，按一下 [流覽] 按鈕會顯示 [檔案選取] 對話方塊，讓使用者從他們的電腦挑選檔案。</span><span class="sxs-lookup"><span data-stu-id="e8329-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="e8329-268">一旦選取檔案之後，按一下 [上傳選取的檔案] 按鈕會導致回傳，將選取的檔案二進位內容傳送至 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="e8329-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>

<span data-ttu-id="e8329-269">[![使用者可以選取要從電腦上傳到伺服器的檔案](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span></span>

<span data-ttu-id="e8329-270">**圖 13**：使用者可以選取要從電腦上傳到伺服器的檔案（[按一下以查看完整大小的影像](uploading-files-cs/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-cs/_static/image20.png))</span></span>

<span data-ttu-id="e8329-271">在回傳時，上傳的檔案可以儲存至檔案系統，或其二進位資料可以透過資料流程直接處理。</span><span class="sxs-lookup"><span data-stu-id="e8329-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="e8329-272">在此範例中，讓我們建立一個 `~/Brochures` 資料夾，並將上傳的檔案儲存在該處。</span><span class="sxs-lookup"><span data-stu-id="e8329-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="e8329-273">首先，將 `Brochures` 資料夾新增至網站，做為根目錄的子資料夾。</span><span class="sxs-lookup"><span data-stu-id="e8329-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="e8329-274">接下來，建立 `UploadButton` s `Click` 事件的事件處理常式，並新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="e8329-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample5.cs)]

<span data-ttu-id="e8329-275">FileUpload 控制項提供各種不同的屬性來處理上傳的資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="e8329-276">例如， [`HasFile` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx)會指出使用者是否已上傳檔案，而[`FileBytes` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx)則是以位元組陣列的形式提供上傳二進位資料的存取權。</span><span class="sxs-lookup"><span data-stu-id="e8329-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="e8329-277">`Click` 事件處理常式會藉由確保檔案已上傳來啟動。</span><span class="sxs-lookup"><span data-stu-id="e8329-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="e8329-278">如果檔案已上傳，則標籤會顯示已上傳檔案的名稱、其大小（以位元組為單位）及其內容類型。</span><span class="sxs-lookup"><span data-stu-id="e8329-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="e8329-279">若要確保使用者上傳檔案，您可以檢查 [`HasFile`] 屬性，並在 `false`時顯示警告，或者您也可以改用[RequiredFieldValidator 控制項](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e8329-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `false`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>

<span data-ttu-id="e8329-280">FileUpload s `SaveAs(filePath)` 會將上傳的檔案儲存至指定的*filePath*。</span><span class="sxs-lookup"><span data-stu-id="e8329-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="e8329-281">*filePath*必須是*實體路徑*（`C:\Websites\Brochures\SomeFile.pdf`），而不是*虛擬* *路徑*（`/Brochures/SomeFile.pdf`）。</span><span class="sxs-lookup"><span data-stu-id="e8329-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="e8329-282">[`Server.MapPath(virtPath)` 方法](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx)會採用虛擬路徑，並傳回其對應的實體路徑。</span><span class="sxs-lookup"><span data-stu-id="e8329-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="e8329-283">在這裡，虛擬路徑為 `~/Brochures/fileName`，其中*fileName*是上傳檔案的名稱。</span><span class="sxs-lookup"><span data-stu-id="e8329-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="e8329-284">如需虛擬和實體路徑及使用 `Server.MapPath`的詳細資訊，請參閱[使用 Server. MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) 。</span><span class="sxs-lookup"><span data-stu-id="e8329-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="e8329-285">完成 `Click` 事件處理常式之後，請花點時間在瀏覽器中測試頁面。</span><span class="sxs-lookup"><span data-stu-id="e8329-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="e8329-286">按一下 [流覽] 按鈕並從硬碟中選取檔案，然後按一下 [上傳選取的檔案] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="e8329-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="e8329-287">回傳會將所選檔案的內容傳送至 web 伺服器，然後在將檔案儲存到 `~/Brochures` 資料夾之前，先顯示該檔案的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="e8329-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="e8329-288">上傳檔案之後，請返回 Visual Studio，然後按一下方案總管中的 [重新整理] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="e8329-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="e8329-289">您應該會在 ~/Brochures 資料夾中看到您剛才上傳的檔案！</span><span class="sxs-lookup"><span data-stu-id="e8329-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>

<span data-ttu-id="e8329-290">[![檔案 EvolutionValley 已上傳至 Web 服務器](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="e8329-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span></span>

<span data-ttu-id="e8329-291">**圖 14**：檔案 `EvolutionValley.jpg` 已上傳至 Web 服務器（[按一下以觀看完整大小的影像](uploading-files-cs/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="e8329-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-cs/_static/image22.png))</span></span>

![EvolutionValley 已儲存至 ~/Brochures 資料夾](uploading-files-cs/_static/image15.gif)

<span data-ttu-id="e8329-293">**圖 15**： `EvolutionValley.jpg` 已儲存到 `~/Brochures` 資料夾</span><span class="sxs-lookup"><span data-stu-id="e8329-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>

## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="e8329-294">將已上傳的檔案儲存到檔案系統的微妙差異</span><span class="sxs-lookup"><span data-stu-id="e8329-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="e8329-295">將上傳檔案儲存至 web 伺服器的檔案系統時，必須處理數個微妙差異。</span><span class="sxs-lookup"><span data-stu-id="e8329-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="e8329-296">首先，安全性的問題。</span><span class="sxs-lookup"><span data-stu-id="e8329-296">First, there s the issue of security.</span></span> <span data-ttu-id="e8329-297">若要將檔案儲存至檔案系統，ASP.NET 網頁執行所在的安全性內容必須具有寫入權限。</span><span class="sxs-lookup"><span data-stu-id="e8329-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="e8329-298">ASP.NET 開發 Web 服務器會在您目前使用者帳戶的內容下執行。</span><span class="sxs-lookup"><span data-stu-id="e8329-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="e8329-299">如果您使用 Microsoft s Internet Information Services （IIS）做為 web 伺服器，則安全性內容取決於 IIS 的版本及其設定。</span><span class="sxs-lookup"><span data-stu-id="e8329-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="e8329-300">將檔案儲存至檔案系統的另一項挑戰，就是將檔案命名為。</span><span class="sxs-lookup"><span data-stu-id="e8329-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="e8329-301">目前，我們的頁面會使用與用戶端電腦上的檔案相同的名稱，將所有上傳的檔案儲存到 `~/Brochures` 目錄。</span><span class="sxs-lookup"><span data-stu-id="e8329-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="e8329-302">如果使用者上傳名稱為 `Brochure.pdf`的手冊，檔案將會儲存為 `~/Brochure/Brochure.pdf`。</span><span class="sxs-lookup"><span data-stu-id="e8329-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="e8329-303">但是，如果稍後使用者 B 上傳不同的摺頁冊檔案，而該檔案剛好有相同的檔案名（`Brochure.pdf`）呢？</span><span class="sxs-lookup"><span data-stu-id="e8329-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="e8329-304">有了現在的程式碼，使用者 B 的上傳會覆寫使用者 A 的檔案。</span><span class="sxs-lookup"><span data-stu-id="e8329-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="e8329-305">有數種方法可解決檔案名衝突。</span><span class="sxs-lookup"><span data-stu-id="e8329-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="e8329-306">其中一個選項是禁止上傳檔案（如果已經有相同名稱的檔案的話）。</span><span class="sxs-lookup"><span data-stu-id="e8329-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="e8329-307">使用此方法時，當使用者 B 嘗試上傳名為 `Brochure.pdf`的檔案時，系統不會儲存其檔案，而是會顯示訊息，通知使用者 B 重新命名檔案，然後再試一次。</span><span class="sxs-lookup"><span data-stu-id="e8329-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="e8329-308">另一種方法是使用唯一的檔案名儲存檔案，這可能是[全域唯一識別碼（GUID）](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)或對應資料庫記錄 s 主鍵資料行中的值（假設上傳與資料模型中的特定資料列相關聯）。</span><span class="sxs-lookup"><span data-stu-id="e8329-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="e8329-309">在下一個教學課程中，我們將更詳細地探索這些選項。</span><span class="sxs-lookup"><span data-stu-id="e8329-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="e8329-310">大量二進位資料的相關挑戰</span><span class="sxs-lookup"><span data-stu-id="e8329-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="e8329-311">這些教學課程假設所捕獲的二進位資料大小適中。</span><span class="sxs-lookup"><span data-stu-id="e8329-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="e8329-312">使用非常大量的二進位資料檔案，這些檔案有數 mb 或更大的容量，引進了這些教學課程範圍以外的新挑戰。</span><span class="sxs-lookup"><span data-stu-id="e8329-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="e8329-313">例如，根據預設，ASP.NET 會拒絕超過 4 MB 的上傳，不過這可以透過 `Web.config`中的[`<httpRuntime>` 元素](https://msdn.microsoft.com/library/e1f13641.aspx)來設定。</span><span class="sxs-lookup"><span data-stu-id="e8329-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="e8329-314">IIS 也會強加自己的檔案上傳大小限制。</span><span class="sxs-lookup"><span data-stu-id="e8329-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="e8329-315">如需詳細資訊，請參閱[IIS 上傳檔案大小](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html)。</span><span class="sxs-lookup"><span data-stu-id="e8329-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="e8329-316">此外，上傳大型檔案所花費的時間可能會超過預設的110秒，ASP.NET 會等待要求。</span><span class="sxs-lookup"><span data-stu-id="e8329-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="e8329-317">在處理大型檔案時，也會發生記憶體和效能問題。</span><span class="sxs-lookup"><span data-stu-id="e8329-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="e8329-318">FileUpload 控制項對於大型檔案上傳而言不切實際。</span><span class="sxs-lookup"><span data-stu-id="e8329-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="e8329-319">當檔案的內容張貼到伺服器時，使用者必須耐心等待，而不需要確認其上傳進度。</span><span class="sxs-lookup"><span data-stu-id="e8329-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="e8329-320">在處理較小的檔案時，這並不是個問題，但在處理較大的檔案（可能需要幾分鐘的時間才能上傳）時可能會有問題。</span><span class="sxs-lookup"><span data-stu-id="e8329-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="e8329-321">有各種協力廠商檔案上傳控制項，較適合用來處理大量上傳，而其中有許多廠商提供進度指標和 ActiveX 上傳管理員，呈現更豐富的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="e8329-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="e8329-322">如果您的應用程式需要處理大型檔案，您必須仔細調查挑戰，並針對您的特定需求尋找適合的解決方案。</span><span class="sxs-lookup"><span data-stu-id="e8329-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="e8329-323">總結</span><span class="sxs-lookup"><span data-stu-id="e8329-323">Summary</span></span>

<span data-ttu-id="e8329-324">建立需要用來捕獲二進位資料的應用程式會帶來許多挑戰。</span><span class="sxs-lookup"><span data-stu-id="e8329-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="e8329-325">在本教學課程中，我們探討了前兩個：決定要儲存二進位資料的位置，並允許使用者透過網頁上傳二進位內容。</span><span class="sxs-lookup"><span data-stu-id="e8329-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="e8329-326">在接下來的三個教學課程中，我們將瞭解如何將上傳的資料與資料庫中的記錄產生關聯，以及如何在其文字資料欄位旁顯示二進位資料。</span><span class="sxs-lookup"><span data-stu-id="e8329-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="e8329-327">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="e8329-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="e8329-328">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="e8329-328">Further Reading</span></span>

<span data-ttu-id="e8329-329">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="e8329-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="e8329-330">使用大數值資料類型</span><span class="sxs-lookup"><span data-stu-id="e8329-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="e8329-331">FileUpload 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="e8329-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="e8329-332">ASP.NET 2.0 FileUpload 伺服器控制項</span><span class="sxs-lookup"><span data-stu-id="e8329-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="e8329-333">檔案上傳的暗邊</span><span class="sxs-lookup"><span data-stu-id="e8329-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="e8329-334">關於作者</span><span class="sxs-lookup"><span data-stu-id="e8329-334">About the Author</span></span>

<span data-ttu-id="e8329-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="e8329-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e8329-336">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="e8329-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e8329-337">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="e8329-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e8329-338">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e8329-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e8329-339">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="e8329-339">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e8329-340">特別感謝</span><span class="sxs-lookup"><span data-stu-id="e8329-340">Special Thanks To</span></span>

<span data-ttu-id="e8329-341">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="e8329-341">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e8329-342">本教學課程的領導審查者為 Teresa Murphy 和 Bernadette Leigh。</span><span class="sxs-lookup"><span data-stu-id="e8329-342">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="e8329-343">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="e8329-343">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e8329-344">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e8329-344">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="e8329-345">下一步</span><span class="sxs-lookup"><span data-stu-id="e8329-345">Next</span></span>](displaying-binary-data-in-the-data-web-controls-cs.md)
