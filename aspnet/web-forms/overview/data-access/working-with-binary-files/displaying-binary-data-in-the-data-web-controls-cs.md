---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
title: 二進位資料顯示在資料 Web 控制項 (C#) |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們看看要呈現在網頁上，包括影像檔的顯示和 [下載] 連結 f 的佈建的二進位資料的選項...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 5cbeb9f8-5f92-4ba8-87ae-0b4d460ae6d4
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
msc.type: authoredcontent
ms.openlocfilehash: c6c41ba5b5414da689e63ef521f1cf22e0b55701
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59404282"
---
# <a name="displaying-binary-data-in-the-data-web-controls-c"></a><span data-ttu-id="40cd5-103">以資料 Web 控制項顯示二進位資料 (C#)</span><span class="sxs-lookup"><span data-stu-id="40cd5-103">Displaying Binary Data in the Data Web Controls (C#)</span></span>

<span data-ttu-id="40cd5-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="40cd5-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="40cd5-105">[下載範例應用程式](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe)或[下載 PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="40cd5-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span></span>

> <span data-ttu-id="40cd5-106">在本教學課程，我們看看要呈現在網頁上，包括影像檔的顯示和佈建的 [下載] 連結，PDF 檔案的二進位資料的選項。</span><span class="sxs-lookup"><span data-stu-id="40cd5-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>


## <a name="introduction"></a><span data-ttu-id="40cd5-107">簡介</span><span class="sxs-lookup"><span data-stu-id="40cd5-107">Introduction</span></span>

<span data-ttu-id="40cd5-108">在先前的教學課程中我們探討兩種技術，來將關聯的應用程式 s 基礎資料模型中的二進位資料，並使用 FileUpload 控制項從瀏覽器到 web 伺服器檔案系統中的檔案上傳。</span><span class="sxs-lookup"><span data-stu-id="40cd5-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="40cd5-109">我們尚未以了解如何上傳的二進位資料相關聯的資料模型發生。</span><span class="sxs-lookup"><span data-stu-id="40cd5-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="40cd5-110">也就是說，檔案已上傳並儲存至檔案系統之後，檔案的路徑必須儲存於適當的資料庫記錄。</span><span class="sxs-lookup"><span data-stu-id="40cd5-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="40cd5-111">如果直接在資料庫中儲存資料上, 傳的二進位資料就不需要儲存至檔案系統中，檔案，但必須插入資料庫中。</span><span class="sxs-lookup"><span data-stu-id="40cd5-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="40cd5-112">我們查看關聯的資料模型中的資料之前，不過，可讓 s 先看看如何為使用者提供的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="40cd5-113">呈現的文字資料是相當簡單，但應該如何二進位資料呈現？</span><span class="sxs-lookup"><span data-stu-id="40cd5-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="40cd5-114">其類型而定，當然，二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="40cd5-115">針對映像，我們可能想要顯示影像，Pdf、 Microsoft Word 文件、 ZIP 檔和其他類型的二進位資料，將下載連結提供對於可能會比較適合。</span><span class="sxs-lookup"><span data-stu-id="40cd5-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="40cd5-116">在本教學課程，我們將探討如何呈現及使用資料及其相關聯的文字資料的二進位資料 Web 控制項 GridView 和 DetailsView 等。</span><span class="sxs-lookup"><span data-stu-id="40cd5-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="40cd5-117">在下一個教學課程中我們將把焦點轉到將上傳的檔案與資料庫產生關聯。</span><span class="sxs-lookup"><span data-stu-id="40cd5-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="40cd5-118">步驟 1：提供`BrochurePath`值</span><span class="sxs-lookup"><span data-stu-id="40cd5-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="40cd5-119">`Picture`中的資料行`Categories`資料表已包含各種類別目錄映像的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="40cd5-120">具體來說，`Picture`每一筆記錄的資料行具有有顆粒狀、 低品質、 16 色點陣圖影像的二進位內容。</span><span class="sxs-lookup"><span data-stu-id="40cd5-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="40cd5-121">每個類別目錄影像為 172 個像素寬和 120 像素，高度，並取用大約 11 KB。</span><span class="sxs-lookup"><span data-stu-id="40cd5-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="40cd5-122">更多哪些 s 中的二進位內容`Picture`資料行包含 78 位元組[OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)必須顯示映像前移除的標頭。</span><span class="sxs-lookup"><span data-stu-id="40cd5-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="40cd5-123">此標頭資訊會出現，因為 Northwind 資料庫在 Microsoft Access 有自己的根目錄。</span><span class="sxs-lookup"><span data-stu-id="40cd5-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="40cd5-124">在 Access 中，是使用 OLE 物件的資料類型，此標頭會添加到儲存二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="40cd5-125">現在，我們會看到如何移除這些低品質影像中的標頭，以顯示圖片。</span><span class="sxs-lookup"><span data-stu-id="40cd5-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="40cd5-126">在未來的教學課程中，我們會建置用於更新類別目錄的介面`Picture`資料行，並取代這些對等的 JPG 影像，而不需要的不必要的 OLE 標頭搭配使用 OLE 標頭的點陣圖影像。</span><span class="sxs-lookup"><span data-stu-id="40cd5-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="40cd5-127">在先前的教學課程中，我們了解如何使用 FileUpload 控制項的內容。</span><span class="sxs-lookup"><span data-stu-id="40cd5-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="40cd5-128">因此，您可以繼續，並將摺頁冊檔案新增至 web 伺服器檔案系統。</span><span class="sxs-lookup"><span data-stu-id="40cd5-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="40cd5-129">這種方式，不過，不會更新`BrochurePath`中的資料行`Categories`資料表。</span><span class="sxs-lookup"><span data-stu-id="40cd5-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="40cd5-130">在下一個教學課程中，我們將看到如何達成此目的，但現在我們需要以手動方式提供值，這個資料行。</span><span class="sxs-lookup"><span data-stu-id="40cd5-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="40cd5-131">在此教學課程的下載中，您會發現在七個 PDF 摺頁冊檔案`~/Brochures`資料夾中，各個 Seafood 以外的類別。</span><span class="sxs-lookup"><span data-stu-id="40cd5-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="40cd5-132">我故意省略新增 Seafood 摺頁冊，說明如何處理不是所有記錄具有相關都聯的二進位資料的案例。</span><span class="sxs-lookup"><span data-stu-id="40cd5-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="40cd5-133">若要更新`Categories`資料表包含下列的值，以滑鼠右鍵按一下`Categories`從伺服器總管] 節點，然後選擇 [顯示資料表資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="40cd5-134">然後，輸入每個類別目錄具有摺頁冊，如 圖 1 所示摺頁冊檔案虛擬路徑。</span><span class="sxs-lookup"><span data-stu-id="40cd5-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="40cd5-135">因為沒有任何手冊 Seafood 分類，保留其`BrochurePath`做為資料行的值`NULL`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>


<span data-ttu-id="40cd5-136">[![以手動方式輸入類別目錄資料表的 BrochurePath 資料行的值](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span></span>

<span data-ttu-id="40cd5-137">**圖 1**:手動輸入的值`Categories`表格 s`BrochurePath`資料行 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))</span></span>


## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="40cd5-138">步驟 2：將下載連結提供如 GridView 中本小手冊</span><span class="sxs-lookup"><span data-stu-id="40cd5-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="40cd5-139">具有`BrochurePath`值提供給`Categories`資料表中，我們準備好要建立的 GridView 會列出每個類別，以及下載類別目錄的手冊的連結。</span><span class="sxs-lookup"><span data-stu-id="40cd5-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="40cd5-140">在步驟 4 中，我們會擴大此 GridView，以也會顯示類別 s 的映像。</span><span class="sxs-lookup"><span data-stu-id="40cd5-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="40cd5-141">開始從工具箱拖曳至設計工具的拖曳的 GridView`DisplayOrDownloadData.aspx`頁面中`BinaryData`資料夾。</span><span class="sxs-lookup"><span data-stu-id="40cd5-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="40cd5-142">設定 GridView s`ID`至`Categories`透過 GridView s 智慧標籤，選擇 繫結至新的資料來源。</span><span class="sxs-lookup"><span data-stu-id="40cd5-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="40cd5-143">具體而言，將它繫結至名為 ObjectDataSource `CategoriesDataSource` ，它會擷取使用資料`CategoriesBLL`物件的`GetCategories()`方法。</span><span class="sxs-lookup"><span data-stu-id="40cd5-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>


<span data-ttu-id="40cd5-144">[![建立名為 CategoriesDataSource 新 ObjectDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span></span>

<span data-ttu-id="40cd5-145">**圖 2**:建立新的 ObjectDataSource 具名`CategoriesDataSource`([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))</span></span>


<span data-ttu-id="40cd5-146">[![設定使用 CategoriesBLL 類別 ObjectDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span></span>

<span data-ttu-id="40cd5-147">**圖 3**:設定要使用 ObjectDataSource`CategoriesBLL`類別 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))</span></span>


<span data-ttu-id="40cd5-148">[![擷取使用 GetCategories() 方法的類別目錄的清單](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span></span>

<span data-ttu-id="40cd5-149">**圖 4**:擷取清單的類別使用`GetCategories()`方法 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))</span></span>


<span data-ttu-id="40cd5-150">完成設定資料來源精靈之後，Visual Studio 會自動加入至 BoundField`Categories`如 GridView `CategoryID`， `CategoryName`， `Description`， `NumberOfProducts`，和`BrochurePath` `DataColumn` s。</span><span class="sxs-lookup"><span data-stu-id="40cd5-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="40cd5-151">請繼續並移除`NumberOfProducts`自 BoundField`GetCategories()`方法的查詢不會擷取這項資訊。</span><span class="sxs-lookup"><span data-stu-id="40cd5-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="40cd5-152">也會移除`CategoryID`BoundField 和重新命名`CategoryName`並`BrochurePath`BoundFields`HeaderText`屬性類別目錄] 和 [摺頁冊，分別。</span><span class="sxs-lookup"><span data-stu-id="40cd5-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="40cd5-153">進行這些變更之後，您的 GridView 和 ObjectDataSource s 宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="40cd5-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample1.aspx)]

<span data-ttu-id="40cd5-154">檢視此頁面，透過瀏覽器 （請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="40cd5-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="40cd5-155">每個八個類別目錄會列出。</span><span class="sxs-lookup"><span data-stu-id="40cd5-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="40cd5-156">有七個類別`BrochurePath`值有`BrochurePath`個別 BoundField 中顯示的值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="40cd5-157">Seafood，其具有`NULL`值及其`BrochurePath`，會顯示空白儲存格。</span><span class="sxs-lookup"><span data-stu-id="40cd5-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>


<span data-ttu-id="40cd5-158">[![列出每個類別的名稱、 描述和 BrochurePath 值](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span></span>

<span data-ttu-id="40cd5-159">**圖 5**:每個類別 s 的名稱，描述，並`BrochurePath`值都會列 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))</span></span>


<span data-ttu-id="40cd5-160">而不是顯示的文字`BrochurePath` 欄中，我們想要建立手冊的連結。</span><span class="sxs-lookup"><span data-stu-id="40cd5-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="40cd5-161">若要這麼做，請移除`BrochurePath`BoundField 和 HyperLinkField 取代它。</span><span class="sxs-lookup"><span data-stu-id="40cd5-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="40cd5-162">設定新的 HyperLinkField s`HeaderText`屬性來摺頁冊，其`Text`屬性，以檢視摺頁冊，並將其`DataNavigateUrlFields`屬性設`BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>


![新增 BrochurePath HyperLinkField](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.gif)

<span data-ttu-id="40cd5-164">**圖 6**:新增針對 HyperLinkField `BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="40cd5-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>


<span data-ttu-id="40cd5-165">如 [圖 7] 所示，這會新增至 GridView，連結的資料行。</span><span class="sxs-lookup"><span data-stu-id="40cd5-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="40cd5-166">按一下檢視摺頁冊連結將直接在瀏覽器中顯示的 PDF 或提示使用者下載檔案，取決於是否已安裝 PDF 閱讀程式和瀏覽器的設定。</span><span class="sxs-lookup"><span data-stu-id="40cd5-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>


<span data-ttu-id="40cd5-167">[![按一下 [檢視] 摺頁冊連結也可以檢視類別的手冊](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span></span>

<span data-ttu-id="40cd5-168">**圖 7**:依序按一下 [檢視摺頁冊] 連結可檢視摺頁冊的類別 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))</span></span>


<span data-ttu-id="40cd5-169">[![隨即出現類別目錄 s 摺頁冊 PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span></span>

<span data-ttu-id="40cd5-170">**圖 8**:隨即出現類別目錄 s 摺頁冊 PDF ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))</span></span>


## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="40cd5-171">隱藏檢視摺頁冊文字不摺頁冊類別</span><span class="sxs-lookup"><span data-stu-id="40cd5-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="40cd5-172">如 [圖 7] 所示， `BrochurePath` HyperLinkField 顯示其`Text`屬性值 （檢視摺頁冊） 的所有記錄，不論是否那里 s 非`NULL`值`BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="40cd5-173">當然，如果`BrochurePath`是`NULL`，連結會顯示為文字，然後在此情況下，與 Seafood 分類 （請參閱上一步 圖 7）。</span><span class="sxs-lookup"><span data-stu-id="40cd5-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="40cd5-174">而不是顯示的文字檢視摺頁冊，可能是很好有這些類別，而不需要`BrochurePath`顯示一些替代的文字，例如無摺頁冊可用的值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="40cd5-175">若要提供這種行為，我們要使用其內容會透過根據適當的輸出就會發出的頁面方法的呼叫產生 TemplateField`BrochurePath`值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="40cd5-176">我們先探討這格式化技術年代[使用 GridView 控制項中的 TemplateFields](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="40cd5-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) tutorial.</span></span>

<span data-ttu-id="40cd5-177">選取將 HyperLinkField 變成 TemplateField `BrochurePath` HyperLinkField，然後按一下 轉換此欄位為 TemplateField 到 編輯資料行 對話方塊中的連結。</span><span class="sxs-lookup"><span data-stu-id="40cd5-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>


![HyperLinkField 轉換為 TemplateField](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.gif)

<span data-ttu-id="40cd5-179">**圖 9**:HyperLinkField 轉換為 TemplateField</span><span class="sxs-lookup"><span data-stu-id="40cd5-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>


<span data-ttu-id="40cd5-180">這會建立使用 TemplateField`ItemTemplate`包含超連結 Web 控制項`NavigateUrl`屬性的繫結至`BrochurePath`值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="40cd5-181">將此標記方法的呼叫取代`GenerateBrochureLink`，並傳入的值`BrochurePath`:</span><span class="sxs-lookup"><span data-stu-id="40cd5-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample2.aspx)]

<span data-ttu-id="40cd5-182">接下來，建立`protected`方法在 asp.net 頁面上名為 s 程式碼後置類別`GenerateBrochureLink`會傳回`string`並接受`object`做為輸入參數。</span><span class="sxs-lookup"><span data-stu-id="40cd5-182">Next, create a `protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `string` and accepts an `object` as an input parameter.</span></span>


[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample3.cs)]

<span data-ttu-id="40cd5-183">這個方法會判斷傳入`object`值是資料庫`NULL`而且，如果是的話，會傳回訊息，指出類別缺少摺頁冊。</span><span class="sxs-lookup"><span data-stu-id="40cd5-183">This method determines if the passed-in `object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="40cd5-184">否則，如果沒有`BrochurePath`值，它顯示超連結。</span><span class="sxs-lookup"><span data-stu-id="40cd5-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="40cd5-185">請注意，如果`BrochurePath`值是呈現 s 傳入[`ResolveUrl(url)`方法](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx)。</span><span class="sxs-lookup"><span data-stu-id="40cd5-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="40cd5-186">這個方法會解析傳入*url*，並將`~`字元搭配適當的虛擬路徑。</span><span class="sxs-lookup"><span data-stu-id="40cd5-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="40cd5-187">例如，如果應用程式根目錄`/Tutorial55`，`ResolveUrl("~/Brochures/Meats.pdf")`會傳回`/Tutorial55/Brochures/Meat.pdf`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="40cd5-188">套用這些變更之後，圖 10 顯示頁面。</span><span class="sxs-lookup"><span data-stu-id="40cd5-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="40cd5-189">請注意，Seafood 類別的`BrochurePath`欄位現在會顯示沒有手冊提供的文字。</span><span class="sxs-lookup"><span data-stu-id="40cd5-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>


<span data-ttu-id="40cd5-190">[![文字不摺頁冊提供顯示這些類別不摺頁冊](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span></span>

<span data-ttu-id="40cd5-191">**圖 10**:文字不摺頁冊提供顯示這些類別不摺頁冊 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))</span></span>


## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="40cd5-192">步驟 3：新增網頁來顯示類別的圖片</span><span class="sxs-lookup"><span data-stu-id="40cd5-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="40cd5-193">當使用者造訪 ASP.NET 網頁時，他們會收到 ASP.NET 頁面的 HTML。</span><span class="sxs-lookup"><span data-stu-id="40cd5-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="40cd5-194">收到的 HTML 也只是文字，而且不包含任何二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="40cd5-195">任何其他的二進位資料，例如影像、 音效檔、 Macromedia Flash 應用程式、 內嵌 Windows Media Player 的視訊，等等，web 伺服器上的個別資源的形式存在。</span><span class="sxs-lookup"><span data-stu-id="40cd5-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="40cd5-196">HTML 會包含這些檔案中，參考，但不包含檔案的實際內容。</span><span class="sxs-lookup"><span data-stu-id="40cd5-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="40cd5-197">例如，在 HTML`<img>`元素用來參考一張圖片，`src`指向影像檔的屬性就像這樣：</span><span class="sxs-lookup"><span data-stu-id="40cd5-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>


[!code-html[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample4.html)]

<span data-ttu-id="40cd5-198">當瀏覽器收到此 HTML 時，它會發出另一個要求至 web 伺服器，以擷取該影像檔，接著會顯示在瀏覽器中的二進位內容。</span><span class="sxs-lookup"><span data-stu-id="40cd5-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="40cd5-199">相同的概念適用於任何二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="40cd5-200">在步驟 2 中，摺頁冊未向下傳送至瀏覽器頁面的 HTML 標記的一部分。</span><span class="sxs-lookup"><span data-stu-id="40cd5-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="40cd5-201">相反地，轉譯的 HTML 時，提供超連結，按一下，造成瀏覽器直接要求 PDF 文件。</span><span class="sxs-lookup"><span data-stu-id="40cd5-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="40cd5-202">若要顯示或允許使用者下載位於資料庫中的二進位資料，我們需要建立個別的網頁傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="40cd5-203">我們的應用程式，那裡 s 直接儲存在資料庫類別的圖只有一個二進位資料欄位。</span><span class="sxs-lookup"><span data-stu-id="40cd5-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="40cd5-204">因此，我們需要一個頁面時，呼叫時，會傳回特定類別的影像資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="40cd5-205">加入新的 ASP.NET 頁面，以便`BinaryData`名為資料夾`DisplayCategoryPicture.aspx`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="40cd5-206">當這種方式，將選取的主版頁面核取方塊未核取。</span><span class="sxs-lookup"><span data-stu-id="40cd5-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="40cd5-207">此頁面所預期`CategoryID`中的查詢字串並傳回該類別 s 的二進位資料值`Picture`資料行。</span><span class="sxs-lookup"><span data-stu-id="40cd5-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="40cd5-208">此頁面會傳回二進位資料，並且沒有其他項目，所以不需要任何 HTML 一節中的標記。</span><span class="sxs-lookup"><span data-stu-id="40cd5-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="40cd5-209">因此，按一下左下角的 [來源] 索引標籤上，並移除所有的頁面的標記以外的`<%@ Page %>`指示詞。</span><span class="sxs-lookup"><span data-stu-id="40cd5-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="40cd5-210">也就是`DisplayCategoryPicture.aspx`s 宣告式標記應該包含單一行：</span><span class="sxs-lookup"><span data-stu-id="40cd5-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample5.aspx)]

<span data-ttu-id="40cd5-211">如果您看到`MasterPageFile`屬性中`<%@ Page %>`指示詞，將它移除。</span><span class="sxs-lookup"><span data-stu-id="40cd5-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="40cd5-212">在頁面 s 程式碼後置類別中加入下列程式碼`Page_Load`事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="40cd5-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>


[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample6.cs)]

<span data-ttu-id="40cd5-213">此程式碼開始讀取`CategoryID`查詢字串值放入變數，名為`categoryID`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="40cd5-214">接下來，將圖片會擷取資料，透過對呼叫`CategoriesBLL`類別的`GetCategoryWithBinaryDataByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="40cd5-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="40cd5-215">這項資料時，會傳回至用戶端上，使用`Response.BinaryWrite(data)`方法，但這在呼叫之前，`Picture`必須移除資料行值的 OLE 標頭。</span><span class="sxs-lookup"><span data-stu-id="40cd5-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="40cd5-216">這透過建立`byte`名為陣列`strippedImageData`將保留精確 78 字元小於功能的`Picture`資料行。</span><span class="sxs-lookup"><span data-stu-id="40cd5-216">This is accomplished by creating a `byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="40cd5-217">[ `Array.Copy`方法](https://msdn.microsoft.com/library/z50k9bft.aspx)用來將資料從複製`category.Picture`位置 78 從頭開始來`strippedImageData`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="40cd5-218">`Response.ContentType`屬性會指定[MIME 類型](http://en.wikipedia.org/wiki/MIME)，讓瀏覽器知道如何呈現它所傳回的內容。</span><span class="sxs-lookup"><span data-stu-id="40cd5-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="40cd5-219">由於`Categories`表格的`Picture`資料行的點陣圖影像，點陣圖 MIME 型別使用這裡 (image/bmp)。</span><span class="sxs-lookup"><span data-stu-id="40cd5-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="40cd5-220">如果您省略的 MIME 類型，大部分的瀏覽器仍會顯示映像正確因為它們可以推斷為基礎的映像檔案 s 的二進位資料內容的型別。</span><span class="sxs-lookup"><span data-stu-id="40cd5-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="40cd5-221">不過，它包含 MIME 容錯度加倍 s 輸入，可能的話。</span><span class="sxs-lookup"><span data-stu-id="40cd5-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="40cd5-222">請參閱[Internet Assigned Numbers Authority 的網站](http://www.iana.org/)如需完整的清單[MIME 媒體類型](http://www.iana.org/assignments/media-types/)。</span><span class="sxs-lookup"><span data-stu-id="40cd5-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="40cd5-223">建立此頁面上，使用特定類別的圖片可以檢視瀏覽`DisplayCategoryPicture.aspx?CategoryID=categoryID`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="40cd5-224">[圖 11] 顯示飲料類別的圖片，您可以從檢視`DisplayCategoryPicture.aspx?CategoryID=1`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>


<span data-ttu-id="40cd5-225">[![圖片顯示 s 的飲料類別目錄](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span></span>

<span data-ttu-id="40cd5-226">**圖 11**:圖片顯示的 s 的飲料類別目錄 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))</span></span>


<span data-ttu-id="40cd5-227">如果瀏覽時`DisplayCategoryPicture.aspx?CategoryID=categoryID`，您會將型別的物件轉換為類型 'System.Byte []' 的 ' System.DBNull' 讀取無法發生例外狀況，有可能會造成這兩件事。</span><span class="sxs-lookup"><span data-stu-id="40cd5-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="40cd5-228">首先，`Categories`表格 s`Picture`資料行允許`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="40cd5-229">`DisplayCategoryPicture.aspx`  頁面上，不過，假設沒有非`NULL`目前的值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="40cd5-230">`Picture`的屬性`CategoriesDataTable`無法直接存取其`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="40cd5-231">如果您想要允許`NULL`值`Picture`d 您想要包含下列條件的資料行：</span><span class="sxs-lookup"><span data-stu-id="40cd5-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>


[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample7.cs)]

<span data-ttu-id="40cd5-232">上述程式碼假設一些映像名為的檔案，就 s`NoPictureAvailable.gif`在`Images`您想要顯示這些類別，而不需要一張圖片的資料夾。</span><span class="sxs-lookup"><span data-stu-id="40cd5-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="40cd5-233">如果，可能也會造成這個例外狀況`CategoriesTableAdapter`s`GetCategoryWithBinaryDataByCategoryID`方法的`SELECT`陳述式已還原回到主查詢 s 資料行清單，如果您使用特定 SQL 陳述式，而且您已重新執行精靈，供使用的 TableAdapter 秒就會發生主要的查詢。</span><span class="sxs-lookup"><span data-stu-id="40cd5-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="40cd5-234">檢查，確定`GetCategoryWithBinaryDataByCategoryID`方法 s`SELECT`陳述式仍包含`Picture`資料行。</span><span class="sxs-lookup"><span data-stu-id="40cd5-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="40cd5-235">每次`DisplayCategoryPicture.aspx`是瀏覽、 存取資料庫，並傳回指定的分類的圖片資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="40cd5-236">如果類別的圖片沒有變更，因為使用者上次檢視過它，不過，這會是浪費的精力。</span><span class="sxs-lookup"><span data-stu-id="40cd5-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="40cd5-237">幸運的是，HTTP 是用來*條件式取得*。</span><span class="sxs-lookup"><span data-stu-id="40cd5-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="40cd5-238">使用條件式 GET，提出 HTTP 要求的用戶端會傳送沿著[ `If-Modified-Since` HTTP 標頭](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)所提供的日期和上次從 web 伺服器擷取這項資源的用戶端的時間。</span><span class="sxs-lookup"><span data-stu-id="40cd5-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="40cd5-239">如果內容尚未變更，因為這會指定日期，web 伺服器可能回應[不會修改 (304) 的狀態碼](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)並放棄傳送回要求的資源的內容。</span><span class="sxs-lookup"><span data-stu-id="40cd5-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="40cd5-240">簡單地說，這項技術會減輕不必傳送資源的內容，如果它尚未修改用戶端上次存取後的 web 伺服器。</span><span class="sxs-lookup"><span data-stu-id="40cd5-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>


<span data-ttu-id="40cd5-241">若要實作此行為，不過，會要求您新增`PictureLastModified`資料行`Categories`資料表擷取時`Picture`用以檢查程式碼以及上次更新資料行`If-Modified-Since`標頭。</span><span class="sxs-lookup"><span data-stu-id="40cd5-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="40cd5-242">如需詳細資訊`If-Modified-Since`標頭 」 和 「 條件式 GET 工作流程，請參閱[HTTP 條件式 GET RSS 駭客](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers)並[更深入了解 ASP.NET 網頁中執行 HTTP 要求](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="40cd5-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="40cd5-243">步驟 4：在 GridView 中顯示類別目錄的圖片</span><span class="sxs-lookup"><span data-stu-id="40cd5-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="40cd5-244">既然我們已經以顯示特定分類的圖片的網頁時，我們可以將它顯示使用[映像的 Web 控制項](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx)或 HTML`<img>`指向的項目`DisplayCategoryPicture.aspx?CategoryID=categoryID`。</span><span class="sxs-lookup"><span data-stu-id="40cd5-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="40cd5-245">GridView 或使用 ImageField DetailsView 中，可以顯示其 URL 取決於資料庫資料的映像。</span><span class="sxs-lookup"><span data-stu-id="40cd5-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="40cd5-246">包含 ImageField`DataImageUrlField`及`DataImageUrlFormatString`HyperLinkField s 類似的屬性`DataNavigateUrlFields`和`DataNavigateUrlFormatString`屬性。</span><span class="sxs-lookup"><span data-stu-id="40cd5-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="40cd5-247">讓 s 擴大`Categories`GridView 中的`DisplayOrDownloadData.aspx`加 ImageField 來顯示每個類別目錄的圖片。</span><span class="sxs-lookup"><span data-stu-id="40cd5-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="40cd5-248">只需新增 ImageField，設定其`DataImageUrlField`並`DataImageUrlFormatString`屬性，以`CategoryID`和`DisplayCategoryPicture.aspx?CategoryID={0}`分別。</span><span class="sxs-lookup"><span data-stu-id="40cd5-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="40cd5-249">這會建立 GridView 資料行，會呈現`<img>`項目其`src`屬性參考`DisplayCategoryPicture.aspx?CategoryID={0}`，其中{0}GridView 資料列 s 取代`CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="40cd5-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>


![新增 ImageField 至 GridView](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.gif)

<span data-ttu-id="40cd5-251">**圖 12**:新增 ImageField 至 GridView</span><span class="sxs-lookup"><span data-stu-id="40cd5-251">**Figure 12**: Add an ImageField to the GridView</span></span>


<span data-ttu-id="40cd5-252">在新增之後 ImageField，GridView s 的宣告式語法看起來應該像 soothe 下列：</span><span class="sxs-lookup"><span data-stu-id="40cd5-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample8.aspx)]

<span data-ttu-id="40cd5-253">請花一點時間才能檢視此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="40cd5-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="40cd5-254">請注意如何每一筆記錄現在包含類別目錄的圖片。</span><span class="sxs-lookup"><span data-stu-id="40cd5-254">Note how each record now includes a picture for the category.</span></span>


<span data-ttu-id="40cd5-255">[![類別的圖片會顯示每個資料列](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="40cd5-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span></span>

<span data-ttu-id="40cd5-256">**圖 13**:類別的圖片會顯示每個資料列 ([按一下以檢視完整大小的影像](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="40cd5-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))</span></span>


## <a name="summary"></a><span data-ttu-id="40cd5-257">總結</span><span class="sxs-lookup"><span data-stu-id="40cd5-257">Summary</span></span>

<span data-ttu-id="40cd5-258">在本教學課程中，我們檢查如何將二進位資料呈現。</span><span class="sxs-lookup"><span data-stu-id="40cd5-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="40cd5-259">呈現資料的方式取決於資料的型別。</span><span class="sxs-lookup"><span data-stu-id="40cd5-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="40cd5-260">針對 PDF 小冊子檔案中，我們提供使用者檢視摺頁冊連結，按一下時，直接將使用者用以 PDF 檔案。</span><span class="sxs-lookup"><span data-stu-id="40cd5-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="40cd5-261">為類別 s 的圖片，我們將第一次建立頁面，即可擷取，並從資料庫傳回二進位資料，然後該頁面中用來顯示每個類別的圖片 GridView。</span><span class="sxs-lookup"><span data-stu-id="40cd5-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="40cd5-262">現在我們已討論過如何顯示二進位資料，我們準備好要檢查如何執行插入、 更新和刪除針對資料庫使用的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="40cd5-263">在下一個教學課程中我們將探討如何關聯其對應的資料庫記錄上傳的檔案。</span><span class="sxs-lookup"><span data-stu-id="40cd5-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="40cd5-264">在本教學課程之後，我們會看到如何更新現有的二進位資料，以及如何移除其相關聯的記錄時，刪除的二進位資料。</span><span class="sxs-lookup"><span data-stu-id="40cd5-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="40cd5-265">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="40cd5-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="40cd5-266">關於作者</span><span class="sxs-lookup"><span data-stu-id="40cd5-266">About the Author</span></span>

<span data-ttu-id="40cd5-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="40cd5-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="40cd5-268">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="40cd5-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="40cd5-269">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="40cd5-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="40cd5-270">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="40cd5-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="40cd5-271">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="40cd5-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="40cd5-272">特別感謝</span><span class="sxs-lookup"><span data-stu-id="40cd5-272">Special Thanks To</span></span>

<span data-ttu-id="40cd5-273">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="40cd5-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="40cd5-274">本教學課程中的潛在客戶檢閱者已 Teresa Murphy 和 Dave Gardner。</span><span class="sxs-lookup"><span data-stu-id="40cd5-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="40cd5-275">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="40cd5-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="40cd5-276">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="40cd5-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="40cd5-277">[上一頁](uploading-files-cs.md)
> [下一頁](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span><span class="sxs-lookup"><span data-stu-id="40cd5-277">[Previous](uploading-files-cs.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span></span>
