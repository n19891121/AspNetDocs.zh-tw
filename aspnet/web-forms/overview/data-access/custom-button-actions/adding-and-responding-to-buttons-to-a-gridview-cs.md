---
uid: web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
title: 新增和回應 GridView 的按鈕（C#） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將探討如何將自訂按鈕新增至範本以及 GridView 或 DetailsView 控制項的欄位。 特別是，我們將建置 。
ms.author: riande
ms.date: 09/13/2006
ms.assetid: 128fdb5f-4c5e-42b5-b485-f3aee90a8e38
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
msc.type: authoredcontent
ms.openlocfilehash: 5c87386e4fe2c53b39162071689f2522dcc6c7ac
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74602768"
---
# <a name="adding-and-responding-to-buttons-to-a-gridview-c"></a><span data-ttu-id="9872b-104">新增與回應 GridView 的按鈕 (C#)</span><span class="sxs-lookup"><span data-stu-id="9872b-104">Adding and Responding to Buttons to a GridView (C#)</span></span>

<span data-ttu-id="9872b-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9872b-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9872b-106">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe)或[下載 PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9872b-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe) or [Download PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span></span>

> <span data-ttu-id="9872b-107">在本教學課程中，我們將探討如何將自訂按鈕新增至範本以及 GridView 或 DetailsView 控制項的欄位。</span><span class="sxs-lookup"><span data-stu-id="9872b-107">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="9872b-108">特別是，我們將建立一個具有 FormView 的介面，讓使用者可以逐頁流覽供應商。</span><span class="sxs-lookup"><span data-stu-id="9872b-108">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span>

## <a name="introduction"></a><span data-ttu-id="9872b-109">簡介</span><span class="sxs-lookup"><span data-stu-id="9872b-109">Introduction</span></span>

<span data-ttu-id="9872b-110">雖然許多報表案例都包含報表資料的唯讀存取權，但報表並不是很罕見的，因為它會根據所顯示的資料來包含執行動作的能力。</span><span class="sxs-lookup"><span data-stu-id="9872b-110">While many reporting scenarios involve read-only access to the report data, it's not uncommon for reports to include the ability to perform actions based upon the data displayed.</span></span> <span data-ttu-id="9872b-111">通常這牽涉到在報表中顯示的每筆記錄加上一個按鈕、LinkButton 或 ImageButton Web 控制項，按一下時，會導致回傳並叫用一些伺服器端程式碼。</span><span class="sxs-lookup"><span data-stu-id="9872b-111">Typically this involved adding a Button, LinkButton, or ImageButton Web control with each record displayed in the report that, when clicked, causes a postback and invokes some server-side code.</span></span> <span data-ttu-id="9872b-112">逐記錄編輯和刪除資料是最常見的範例。</span><span class="sxs-lookup"><span data-stu-id="9872b-112">Editing and deleting the data on a record-by-record basis is the most common example.</span></span> <span data-ttu-id="9872b-113">事實上，如同從[插入、更新和刪除資料](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教學課程的總覽開始介紹，編輯和刪除是很常見的，GridView、DetailsView 和 FormView 控制項都可以支援這類功能，而不需要撰寫任何一行程式碼。</span><span class="sxs-lookup"><span data-stu-id="9872b-113">In fact, as we saw starting with the [Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, editing and deleting is so common that the GridView, DetailsView, and FormView controls can support such functionality without the need for writing a single line of code.</span></span>

<span data-ttu-id="9872b-114">除了 [編輯] 和 [刪除] 按鈕之外，GridView、DetailsView 和 FormView 控制項也可以包含按鈕、LinkButtons 或 ImageButtons，當按下時，就會執行一些自訂的伺服器端邏輯。</span><span class="sxs-lookup"><span data-stu-id="9872b-114">In addition to Edit and Delete buttons, the GridView, DetailsView, and FormView controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="9872b-115">在本教學課程中，我們將探討如何將自訂按鈕新增至範本以及 GridView 或 DetailsView 控制項的欄位。</span><span class="sxs-lookup"><span data-stu-id="9872b-115">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="9872b-116">特別是，我們將建立一個具有 FormView 的介面，讓使用者可以逐頁流覽供應商。</span><span class="sxs-lookup"><span data-stu-id="9872b-116">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span> <span data-ttu-id="9872b-117">針對指定的供應商，FormView 會顯示供應商的相關資訊，以及一個按鈕 Web 控制項，如果按一下，就會將其所有相關聯的產品標示為已中止。</span><span class="sxs-lookup"><span data-stu-id="9872b-117">For a given supplier, the FormView will show information about the supplier along with a Button Web control that, if clicked, will mark all of their associated products as discontinued.</span></span> <span data-ttu-id="9872b-118">此外，GridView 會列出所選供應商所提供的產品，其中每個資料列都包含 [增加價格和折扣價] 按鈕，如果按下，則會提高或降低產品的 `UnitPrice` 10% （請參閱 [圖 1]）。</span><span class="sxs-lookup"><span data-stu-id="9872b-118">Additionally, a GridView lists those products provided by the selected supplier, with each row containing Increase Price and Discount Price Buttons that, if clicked, raise or reduce the product's `UnitPrice` by 10% (see Figure 1).</span></span>

<span data-ttu-id="9872b-119">[![FormView 和 GridView 包含執行自訂動作的按鈕](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-119">[![Both the FormView and GridView Contain Buttons That Perform Custom Actions](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span></span>

<span data-ttu-id="9872b-120">**圖 1**： FormView 和 GridView 都包含執行自訂動作的按鈕（[按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-120">**Figure 1**: Both the FormView and GridView Contain Buttons That Perform Custom Actions ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png))</span></span>

## <a name="step-1-adding-the-button-tutorial-web-pages"></a><span data-ttu-id="9872b-121">步驟1：新增按鈕教學課程網頁</span><span class="sxs-lookup"><span data-stu-id="9872b-121">Step 1: Adding the Button Tutorial Web Pages</span></span>

<span data-ttu-id="9872b-122">在查看如何新增自訂按鈕之前，讓我們先花點時間在我們的網站專案中建立 ASP.NET 網頁，我們將在本教學課程中使用。</span><span class="sxs-lookup"><span data-stu-id="9872b-122">Before we look at how to add a custom buttons, let's first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="9872b-123">從新增名為 `CustomButtons`的資料夾開始。</span><span class="sxs-lookup"><span data-stu-id="9872b-123">Start by adding a new folder named `CustomButtons`.</span></span> <span data-ttu-id="9872b-124">接下來，將下列兩個 ASP.NET 網頁新增至該資料夾，並確定每個頁面都與 `Site.master` 主版頁面相關聯：</span><span class="sxs-lookup"><span data-stu-id="9872b-124">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`

![新增自訂按鈕相關教學課程的 ASP.NET 網頁](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image4.png)

<span data-ttu-id="9872b-126">**圖 2**：新增自訂按鈕相關教學課程的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="9872b-126">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>

<span data-ttu-id="9872b-127">如同在其他資料夾中，[`CustomButtons`] 資料夾中的 `Default.aspx` 會在其區段中列出教學課程。</span><span class="sxs-lookup"><span data-stu-id="9872b-127">Like in the other folders, `Default.aspx` in the `CustomButtons` folder will list the tutorials in its section.</span></span> <span data-ttu-id="9872b-128">回想一下，`SectionLevelTutorialListing.ascx` 的使用者控制項會提供這種功能。</span><span class="sxs-lookup"><span data-stu-id="9872b-128">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="9872b-129">因此，請將此使用者控制項從方案總管拖曳至頁面的設計檢視，以將其新增至 `Default.aspx`。</span><span class="sxs-lookup"><span data-stu-id="9872b-129">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page's Design view.</span></span>

<span data-ttu-id="9872b-130">[![將 SectionLevelTutorialListing 的 .ascx 使用者控制項新增至 default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-130">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span></span>

<span data-ttu-id="9872b-131">**圖 3**：將 `SectionLevelTutorialListing.ascx` 使用者控制項加入 `Default.aspx` （[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-131">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png))</span></span>

<span data-ttu-id="9872b-132">最後，將頁面新增為 `Web.sitemap` 檔案的專案。</span><span class="sxs-lookup"><span data-stu-id="9872b-132">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="9872b-133">具體而言，在分頁和排序 `<siteMapNode>`之後加入下列標記：</span><span class="sxs-lookup"><span data-stu-id="9872b-133">Specifically, add the following markup after the Paging and Sorting `<siteMapNode>`:</span></span>

[!code-xml[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample1.xml)]

<span data-ttu-id="9872b-134">更新 `Web.sitemap`之後，請花一點時間透過瀏覽器來觀看教學課程網站。</span><span class="sxs-lookup"><span data-stu-id="9872b-134">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="9872b-135">左側功能表現在包含用於編輯、插入及刪除教學課程的專案。</span><span class="sxs-lookup"><span data-stu-id="9872b-135">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![網站地圖現在包含自訂按鈕教學課程的專案](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image8.png)

<span data-ttu-id="9872b-137">[**圖 4**]：網站地圖現在包含自訂按鈕教學課程的專案</span><span class="sxs-lookup"><span data-stu-id="9872b-137">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>

## <a name="step-2-adding-a-formview-that-lists-the-suppliers"></a><span data-ttu-id="9872b-138">步驟2：加入可列出供應商的 FormView</span><span class="sxs-lookup"><span data-stu-id="9872b-138">Step 2: Adding a FormView that Lists the Suppliers</span></span>

<span data-ttu-id="9872b-139">讓我們藉由新增可列出供應商的 FormView 來開始使用本教學課程。</span><span class="sxs-lookup"><span data-stu-id="9872b-139">Let's get started with this tutorial by adding the FormView that lists the suppliers.</span></span> <span data-ttu-id="9872b-140">如簡介中所述，此 FormView 可讓使用者逐頁流覽供應商，並在 GridView 中顯示供應商所提供的產品。</span><span class="sxs-lookup"><span data-stu-id="9872b-140">As discussed in the Introduction, this FormView will allow the user to page through the suppliers, showing the products provided by the supplier in a GridView.</span></span> <span data-ttu-id="9872b-141">此外，此 FormView 會包含一個按鈕，當您按一下時，會將供應商的所有產品標示為已中止。</span><span class="sxs-lookup"><span data-stu-id="9872b-141">Additionally, this FormView will include a Button that, when clicked, will mark all of the supplier's products as discontinued.</span></span> <span data-ttu-id="9872b-142">在我們考慮如何將自訂按鈕加入至 FormView 之前，讓我們先建立 FormView，使其顯示供應商資訊。</span><span class="sxs-lookup"><span data-stu-id="9872b-142">Before we concern ourselves with adding the custom button to the FormView, let's first just create the FormView so that it displays the supplier information.</span></span>

<span data-ttu-id="9872b-143">從開啟 [`CustomButtons`] 資料夾中的 [`CustomButtons.aspx`] 頁面開始。</span><span class="sxs-lookup"><span data-stu-id="9872b-143">Start by opening the `CustomButtons.aspx` page in the `CustomButtons` folder.</span></span> <span data-ttu-id="9872b-144">將 FormView 從 [工具箱] 拖曳至設計工具，並將其 [`ID`] 屬性設為 [`Suppliers`]，將它加入頁面中。</span><span class="sxs-lookup"><span data-stu-id="9872b-144">Add a FormView to the page by dragging it from the Toolbox onto the Designer and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="9872b-145">從 FormView 的智慧標籤中，選擇建立名為 `SuppliersDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="9872b-145">From the FormView's smart tag, opt to create a new ObjectDataSource named `SuppliersDataSource`.</span></span>

<span data-ttu-id="9872b-146">[![建立名為 SuppliersDataSource 的新 ObjectDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-146">[![Create a New ObjectDataSource Named SuppliersDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span></span>

<span data-ttu-id="9872b-147">**圖 5**：建立名為 `SuppliersDataSource` 的新 ObjectDataSource （[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-147">**Figure 5**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png))</span></span>

<span data-ttu-id="9872b-148">設定這個新的 ObjectDataSource，讓它從 `SuppliersBLL` 類別的 `GetSuppliers()` 方法進行查詢（請參閱 [圖 6]）。</span><span class="sxs-lookup"><span data-stu-id="9872b-148">Configure this new ObjectDataSource such that it queries from the `SuppliersBLL` class's `GetSuppliers()` method (see Figure 6).</span></span> <span data-ttu-id="9872b-149">由於此 FormView 並未提供更新供應商資訊的介面，因此請從 [更新] 索引標籤的下拉式清單中選取 [（無）] 選項。</span><span class="sxs-lookup"><span data-stu-id="9872b-149">Since this FormView does not provide an interface for updating the supplier information, select the (None) option from the drop-down list in the UPDATE tab.</span></span>

<span data-ttu-id="9872b-150">[![將資料來源設定為使用 SuppliersBLL 類別 s GetSuppliers （）方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-150">[![Configure the Data Source to use the SuppliersBLL Class s GetSuppliers() Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span></span>

<span data-ttu-id="9872b-151">**圖 6**：將資料來源設定為使用 `SuppliersBLL` 類別的 `GetSuppliers()` 方法（[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-151">**Figure 6**: Configure the Data Source to use the `SuppliersBLL` Class's `GetSuppliers()` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png))</span></span>

<span data-ttu-id="9872b-152">設定 ObjectDataSource 之後，Visual Studio 將會產生 FormView 的 `InsertItemTemplate`、`EditItemTemplate`和 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="9872b-152">After configuring the ObjectDataSource, Visual Studio will generate an `InsertItemTemplate`, `EditItemTemplate`, and `ItemTemplate` for the FormView.</span></span> <span data-ttu-id="9872b-153">移除 `InsertItemTemplate` 並 `EditItemTemplate` 並修改 `ItemTemplate`，使其只顯示供應商的公司名稱和電話號碼。</span><span class="sxs-lookup"><span data-stu-id="9872b-153">Remove the `InsertItemTemplate` and `EditItemTemplate` and modify the `ItemTemplate` so that it displays just the supplier's company name and phone number.</span></span> <span data-ttu-id="9872b-154">最後，藉由勾選智慧標籤的 [啟用分頁] 核取方塊（或將其 [`AllowPaging`] 屬性設定為 [`True`]）來開啟 FormView 的分頁支援。</span><span class="sxs-lookup"><span data-stu-id="9872b-154">Finally, turn on paging support for the FormView by checking the Enable Paging checkbox from its smart tag (or by setting its `AllowPaging` property to `True`).</span></span> <span data-ttu-id="9872b-155">這些變更之後，您頁面的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="9872b-155">After these changes your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample2.aspx)]

<span data-ttu-id="9872b-156">[圖 7] 顯示透過瀏覽器觀看時的 CustomButtons 頁面。</span><span class="sxs-lookup"><span data-stu-id="9872b-156">Figure 7 shows the CustomButtons.aspx page when viewed through a browser.</span></span>

<span data-ttu-id="9872b-157">[![FormView 會列出目前所選供應商的 [公司名稱] 和 [電話] 欄位](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-157">[![The FormView Lists the CompanyName and Phone Fields from the Currently Selected Supplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span></span>

<span data-ttu-id="9872b-158">**圖 7**： FormView 會列出目前所選供應商的 `CompanyName` 和 `Phone` 欄位（[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-158">**Figure 7**: The FormView Lists the `CompanyName` and `Phone` Fields from the Currently Selected Supplier ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png))</span></span>

## <a name="step-3-adding-a-gridview-that-lists-the-selected-suppliers-products"></a><span data-ttu-id="9872b-159">步驟3：加入一個 GridView，其中列出所選供應商的產品</span><span class="sxs-lookup"><span data-stu-id="9872b-159">Step 3: Adding a GridView that Lists the Selected Supplier's Products</span></span>

<span data-ttu-id="9872b-160">在我們將 [停止所有產品] 按鈕新增至 FormView 的範本之前，讓我們先在 FormView 底下新增 GridView，其中會列出所選供應商所提供的產品。</span><span class="sxs-lookup"><span data-stu-id="9872b-160">Before we add the Discontinue All Products Button to the FormView's template, let's first add a GridView beneath the FormView that lists the products provided by the selected supplier.</span></span> <span data-ttu-id="9872b-161">若要完成此動作，請在頁面中新增 GridView、將其 `ID` 屬性設為 `SuppliersProducts`，然後新增名為 `SuppliersProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="9872b-161">To accomplish this, add a GridView to the page, set its `ID` property to `SuppliersProducts`, and add a new ObjectDataSource named `SuppliersProductsDataSource`.</span></span>

<span data-ttu-id="9872b-162">[![建立名為 SuppliersProductsDataSource 的新 ObjectDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-162">[![Create a New ObjectDataSource Named SuppliersProductsDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span></span>

<span data-ttu-id="9872b-163">**圖 8**：建立名為 `SuppliersProductsDataSource` 的新 ObjectDataSource （[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-163">**Figure 8**: Create a New ObjectDataSource Named `SuppliersProductsDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png))</span></span>

<span data-ttu-id="9872b-164">將此 ObjectDataSource 設定為使用 ProductsBLL 類別的 `GetProductsBySupplierID(supplierID)` 方法（請參閱 [圖 9]）。</span><span class="sxs-lookup"><span data-stu-id="9872b-164">Configure this ObjectDataSource to use the ProductsBLL class's `GetProductsBySupplierID(supplierID)` method (see Figure 9).</span></span> <span data-ttu-id="9872b-165">雖然此 GridView 會允許產品的價格調整，但它不會使用 GridView 的內建編輯或刪除功能。</span><span class="sxs-lookup"><span data-stu-id="9872b-165">While this GridView will allow for a product's price to be adjusted, it won't be using the built-in editing or deleting features from the GridView.</span></span> <span data-ttu-id="9872b-166">因此，我們可以針對 ObjectDataSource 的 [更新]、[插入] 和 [刪除] 索引標籤，將下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="9872b-166">Therefore, we can set the drop-down list to (None) for the ObjectDataSource's UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="9872b-167">[![將資料來源設定為使用 ProductsBLL 類別 s GetProductsBySupplierID （已加入供應商）方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-167">[![Configure the Data Source to use the ProductsBLL Class s GetProductsBySupplierID(supplierID) Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span></span>

<span data-ttu-id="9872b-168">**圖 9**：將資料來源設定為使用 `ProductsBLL` 類別的 `GetProductsBySupplierID(supplierID)` 方法（[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-168">**Figure 9**: Configure the Data Source to use the `ProductsBLL` Class's `GetProductsBySupplierID(supplierID)` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png))</span></span>

<span data-ttu-id="9872b-169">由於 `GetProductsBySupplierID(supplierID)` 方法會接受輸入參數，因此 ObjectDataSource wizard 會提示我們提供此參數值的來源。</span><span class="sxs-lookup"><span data-stu-id="9872b-169">Since the `GetProductsBySupplierID(supplierID)` method accepts an input parameter, the ObjectDataSource wizard prompts us for the source of this parameter value.</span></span> <span data-ttu-id="9872b-170">若要傳入 FormView 的 `SupplierID` 值，請將 參數來源 下拉式清單設定為 控制，並將 ControlID 下拉式清單設為 `Suppliers` （在步驟2中建立之 FormView 的識別碼）。</span><span class="sxs-lookup"><span data-stu-id="9872b-170">To pass in the `SupplierID` value from the FormView, set the Parameter source drop-down list to Control and the ControlID drop-down list to `Suppliers` (the ID of the FormView created in Step 2).</span></span>

<span data-ttu-id="9872b-171">[![指出 [供應商] 參數應來自 [供應商 FormView] 控制項](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-171">[![Indicate that the supplierID Parameter Should Come from the Suppliers FormView Control](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span></span>

<span data-ttu-id="9872b-172">**圖 10**：指出 *`supplierID`* 參數應該來自 `Suppliers` 的 FormView 控制項（[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-172">**Figure 10**: Indicate that the *`supplierID`* Parameter Should Come from the `Suppliers` FormView Control ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png))</span></span>

<span data-ttu-id="9872b-173">完成 ObjectDataSource wizard 之後，GridView 會針對每個產品的資料欄位包含 BoundField 或 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="9872b-173">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product's data fields.</span></span> <span data-ttu-id="9872b-174">讓我們修剪一下，只顯示 `ProductName` 和 `UnitPrice` BoundFields，以及 `Discontinued` 的 CheckBoxField;此外，讓我們將 `UnitPrice` BoundField 格式化，使其文字格式化為貨幣。</span><span class="sxs-lookup"><span data-stu-id="9872b-174">Let's trim this down to show just the `ProductName` and `UnitPrice` BoundFields along with the `Discontinued` CheckBoxField; furthermore, let's format the `UnitPrice` BoundField such that its text is formatted as a currency.</span></span> <span data-ttu-id="9872b-175">您的 GridView 和 `SuppliersProductsDataSource` ObjectDataSource 的宣告式標記看起來應該類似下列標記：</span><span class="sxs-lookup"><span data-stu-id="9872b-175">Your GridView and `SuppliersProductsDataSource` ObjectDataSource's declarative markup should look similar to the following markup:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample3.aspx)]

<span data-ttu-id="9872b-176">此時，我們的教學課程會顯示主版/詳細資料包告，讓使用者可以從最上方的 FormView 挑選供應商，並透過底部的 GridView 查看該供應商提供的產品。</span><span class="sxs-lookup"><span data-stu-id="9872b-176">At this point our tutorial displays a master/details report, allowing the user to pick a supplier from the FormView at the top and to view the products provided by that supplier through the GridView at the bottom.</span></span> <span data-ttu-id="9872b-177">[圖 11] 顯示從 FormView 選取東京貿易供應商時，此頁面的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="9872b-177">Figure 11 shows a screen shot of this page when selecting the Tokyo Traders supplier from the FormView.</span></span>

<span data-ttu-id="9872b-178">[![選取的供應商產品會顯示在 GridView 中](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-178">[![The Selected Supplier s Products are Displayed in the GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span></span>

<span data-ttu-id="9872b-179">**圖 11**：選取的供應商產品會顯示在 GridView 中（[按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-179">**Figure 11**: The Selected Supplier's Products are Displayed in the GridView ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png))</span></span>

## <a name="step-4-creating-dal-and-bll-methods-to-discontinue-all-products-for-a-supplier"></a><span data-ttu-id="9872b-180">步驟4：建立 DAL 和 BLL 方法，以停止供應商的所有產品</span><span class="sxs-lookup"><span data-stu-id="9872b-180">Step 4: Creating DAL and BLL Methods to Discontinue All Products for a Supplier</span></span>

<span data-ttu-id="9872b-181">在我們可以將按鈕加入至 FormView 之後，當您按一下時，會停止所有供應商的產品，我們必須先將方法新增至執行此動作的 DAL 和 BLL。</span><span class="sxs-lookup"><span data-stu-id="9872b-181">Before we can add a Button to the FormView that, when clicked, discontinues all of the supplier's products, we first need to add a method to both the DAL and BLL that performs this action.</span></span> <span data-ttu-id="9872b-182">特別的是，這個方法會命名為 `DiscontinueAllProductsForSupplier(supplierID)`。</span><span class="sxs-lookup"><span data-stu-id="9872b-182">In particular, this method will be named `DiscontinueAllProductsForSupplier(supplierID)`.</span></span> <span data-ttu-id="9872b-183">按一下 FormView 的按鈕時，我們會在商務邏輯層叫用此方法，並傳入所選供應商的 `SupplierID`;然後，BLL 會向下呼叫對應的資料存取層方法，這將會發出 `UPDATE` 語句給資料庫，使其無法中止指定的供應商產品。</span><span class="sxs-lookup"><span data-stu-id="9872b-183">When the FormView's Button is clicked, we'll invoke this method in the Business Logic Layer, passing in the selected supplier's `SupplierID`; the BLL will then call down to the corresponding Data Access Layer method, which will issue an `UPDATE` statement to the database that discontinues the specified supplier's products.</span></span>

<span data-ttu-id="9872b-184">如同我們在先前的教學課程中所做的，我們將使用最新的方法，一開始先建立 DAL 方法，然後是 BLL 方法，最後在 [ASP.NET] 頁面中執行功能。</span><span class="sxs-lookup"><span data-stu-id="9872b-184">As we have done in our previous tutorials, we'll use a bottom-up approach, starting with creating the DAL method, then the BLL method, and finally implementing the functionality in the ASP.NET page.</span></span> <span data-ttu-id="9872b-185">在 [`App_Code/DAL`] 資料夾中開啟 `Northwind.xsd` 類型資料集，並將新的方法加入 `ProductsTableAdapter` （以滑鼠右鍵按一下 `ProductsTableAdapter`，然後選擇 [加入查詢]）。</span><span class="sxs-lookup"><span data-stu-id="9872b-185">Open the `Northwind.xsd` Typed DataSet in the `App_Code/DAL` folder and add a new method to the `ProductsTableAdapter` (right-click on the `ProductsTableAdapter` and choose Add Query).</span></span> <span data-ttu-id="9872b-186">這麼做會顯示 [TableAdapter 查詢設定] wizard，讓我們逐步完成新增方法的程式。</span><span class="sxs-lookup"><span data-stu-id="9872b-186">Doing so will bring up the TableAdapter Query Configuration wizard, which walks us through the process of adding the new method.</span></span> <span data-ttu-id="9872b-187">一開始請先指出我們的 DAL 方法將使用臨機操作 SQL 語句。</span><span class="sxs-lookup"><span data-stu-id="9872b-187">Start by indicating that our DAL method will use an ad-hoc SQL statement.</span></span>

<span data-ttu-id="9872b-188">[![使用特定 SQL 語句建立 DAL 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-188">[![Create the DAL Method Using an Ad-Hoc SQL Statement](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span></span>

<span data-ttu-id="9872b-189">**圖 12**：使用臨機操作 SQL 語句建立 DAL 方法（[按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-189">**Figure 12**: Create the DAL Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png))</span></span>

<span data-ttu-id="9872b-190">接下來，嚮導會提示我們輸入要建立的查詢類型。</span><span class="sxs-lookup"><span data-stu-id="9872b-190">Next, the wizard prompts us as to what type of query to create.</span></span> <span data-ttu-id="9872b-191">由於 `DiscontinueAllProductsForSupplier(supplierID)` 方法將需要更新 `Products` 資料庫資料表，針對指定 *`supplierID`* 所提供的所有產品，將 `Discontinued` 欄位設定為1，因此我們必須建立可更新資料的查詢。</span><span class="sxs-lookup"><span data-stu-id="9872b-191">Since the `DiscontinueAllProductsForSupplier(supplierID)` method will need to update the `Products` database table, setting the `Discontinued` field to 1 for all products provided by the specified *`supplierID`*, we need to create a query that updates data.</span></span>

<span data-ttu-id="9872b-192">[![選擇更新查詢類型](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-192">[![Choose the UPDATE Query Type](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span></span>

<span data-ttu-id="9872b-193">**圖 13**：選擇更新查詢類型（[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-193">**Figure 13**: Choose the UPDATE Query Type ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png))</span></span>

<span data-ttu-id="9872b-194">下一個 wizard 畫面會提供 TableAdapter 的現有 `UPDATE` 語句，以更新 `Products` DataTable 中定義的每個欄位。</span><span class="sxs-lookup"><span data-stu-id="9872b-194">The next wizard screen provides the TableAdapter's existing `UPDATE` statement, which updates each of the fields defined in the `Products` DataTable.</span></span> <span data-ttu-id="9872b-195">將此查詢文字取代為下列語句：</span><span class="sxs-lookup"><span data-stu-id="9872b-195">Replace this query text with the following statement:</span></span>

[!code-sql[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample4.sql)]

<span data-ttu-id="9872b-196">輸入此查詢並按 [下一步] 之後，最後一個 wizard 畫面會要求使用 `DiscontinueAllProductsForSupplier`的新方法名稱。</span><span class="sxs-lookup"><span data-stu-id="9872b-196">After entering this query and clicking Next, the last wizard screen asks for the new method's name use `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="9872b-197">按一下 [完成] 按鈕以完成嚮導。</span><span class="sxs-lookup"><span data-stu-id="9872b-197">Complete the wizard by clicking the Finish button.</span></span> <span data-ttu-id="9872b-198">返回 DataSet 設計工具時，您應該會在名為 `DiscontinueAllProductsForSupplier(@SupplierID)`的 `ProductsTableAdapter` 中看到新的方法。</span><span class="sxs-lookup"><span data-stu-id="9872b-198">Upon returning to the DataSet Designer you should see a new method in the `ProductsTableAdapter` named `DiscontinueAllProductsForSupplier(@SupplierID)`.</span></span>

<span data-ttu-id="9872b-199">[![命名新的 DAL 方法 DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-199">[![Name the New DAL Method DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span></span>

<span data-ttu-id="9872b-200">**圖 14**：將新的 DAL 方法命名 `DiscontinueAllProductsForSupplier` （[按一下以查看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-200">**Figure 14**: Name the New DAL Method `DiscontinueAllProductsForSupplier` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png))</span></span>

<span data-ttu-id="9872b-201">在資料存取層中建立 `DiscontinueAllProductsForSupplier(supplierID)` 方法之後，下一項工作是在商務邏輯層中建立 `DiscontinueAllProductsForSupplier(supplierID)` 方法。</span><span class="sxs-lookup"><span data-stu-id="9872b-201">With the `DiscontinueAllProductsForSupplier(supplierID)` method created in the Data Access Layer, our next task is to create the `DiscontinueAllProductsForSupplier(supplierID)` method in the Business Logic Layer.</span></span> <span data-ttu-id="9872b-202">若要完成此動作，請開啟 `ProductsBLL` 類別檔案，並新增下列內容：</span><span class="sxs-lookup"><span data-stu-id="9872b-202">To accomplish this, open the `ProductsBLL` class file and add the following:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample5.cs)]

<span data-ttu-id="9872b-203">這個方法只會向下呼叫 DAL 中的 `DiscontinueAllProductsForSupplier(supplierID)` 方法，並沿著提供的 *`supplierID`* 參數值傳遞。</span><span class="sxs-lookup"><span data-stu-id="9872b-203">This method simply calls down to the `DiscontinueAllProductsForSupplier(supplierID)` method in the DAL, passing along the provided *`supplierID`* parameter value.</span></span> <span data-ttu-id="9872b-204">如果有任何商務規則只允許供應商的產品在某些情況下停止，這些規則應該在此實作為 BLL。</span><span class="sxs-lookup"><span data-stu-id="9872b-204">If there were any business rules that only allowed a supplier's products to be discontinued under certain circumstances, those rules should be implemented here, in the BLL.</span></span>

> [!NOTE]
> <span data-ttu-id="9872b-205">不同于 `ProductsBLL` 類別中的 `UpdateProduct` 多載，`DiscontinueAllProductsForSupplier(supplierID)` 方法簽章不包含 `DataObjectMethodAttribute` 屬性（`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`）。</span><span class="sxs-lookup"><span data-stu-id="9872b-205">Unlike the `UpdateProduct` overloads in the `ProductsBLL` class, the `DiscontinueAllProductsForSupplier(supplierID)` method signature does not include the `DataObjectMethodAttribute` attribute (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`).</span></span> <span data-ttu-id="9872b-206">這會在 [更新] 索引標籤中，從 ObjectDataSource 的 [設定資料來源] wizard 下拉式清單中排除 `DiscontinueAllProductsForSupplier(supplierID)` 方法。我省略了這個屬性，因為我們會直接從 ASP.NET 網頁中的事件處理常式呼叫 `DiscontinueAllProductsForSupplier(supplierID)` 方法。</span><span class="sxs-lookup"><span data-stu-id="9872b-206">This precludes the `DiscontinueAllProductsForSupplier(supplierID)` method from the ObjectDataSource's Configure Data Source wizard's drop-down list in the UPDATE tab. I ve omitted this attribute because we'll be calling the `DiscontinueAllProductsForSupplier(supplierID)` method directly from an event handler in our ASP.NET page.</span></span>

## <a name="step-5-adding-a-discontinue-all-products-button-to-the-formview"></a><span data-ttu-id="9872b-207">步驟5：將 [停止所有產品] 按鈕新增至 FormView</span><span class="sxs-lookup"><span data-stu-id="9872b-207">Step 5: Adding a Discontinue All Products Button to the FormView</span></span>

<span data-ttu-id="9872b-208">當 BLL 和 DAL 中的 `DiscontinueAllProductsForSupplier(supplierID)` 方法完成時，新增可中斷所選供應商所有產品之能力的最後一個步驟，就是將按鈕 Web 控制項新增至 FormView 的 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="9872b-208">With the `DiscontinueAllProductsForSupplier(supplierID)` method in the BLL and DAL complete, the final step for adding the ability to discontinue all products for the selected supplier is to add a Button Web control to the FormView's `ItemTemplate`.</span></span> <span data-ttu-id="9872b-209">讓我們在供應商的電話號碼底下加上按鈕文字、[停止所有產品] 和 [`ID`] 屬性值為 [`DiscontinueAllProductsForSupplier`]。</span><span class="sxs-lookup"><span data-stu-id="9872b-209">Let's add such a Button below the supplier's phone number with the button text, Discontinue All Products and an `ID` property value of `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="9872b-210">您可以透過設計工具加入此按鈕 Web 控制項，方法是按一下 FormView 的智慧標籤中的 [編輯範本] 連結（請參閱 [圖 15]），或直接透過宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="9872b-210">You can add this Button Web control through the Designer by clicking on the Edit Templates link in the FormView's smart tag (see Figure 15), or directly through the declarative syntax.</span></span>

<span data-ttu-id="9872b-211">[![將 [停止所有產品] 按鈕 Web 控制項新增至 FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-211">[![Add a Discontinue All Products Button Web Control to the FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span></span>

<span data-ttu-id="9872b-212">**圖 15**：將 [停止所有產品] 按鈕 Web 控制項新增至 FormView 的 `ItemTemplate` （[按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-212">**Figure 15**: Add a Discontinue All Products Button Web Control to the FormView's `ItemTemplate` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png))</span></span>

<span data-ttu-id="9872b-213">當流覽頁面的使用者按一下按鈕時，就會引發回傳接踵而來和 FormView 的[`ItemCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="9872b-213">When the Button is clicked by a user visiting the page, a postback ensues and the FormView's [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx) fires.</span></span> <span data-ttu-id="9872b-214">若要執行自訂程式碼來回應按一下這個按鈕，我們可以建立這個事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="9872b-214">To execute custom code in response to this Button being clicked, we can create an event handler for this event.</span></span> <span data-ttu-id="9872b-215">不過，請瞭解，每當在 FormView 內按一下*任何*按鈕、LinkButton 或 ImageButton Web 控制項時，就會引發 `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="9872b-215">Understand, though, that the `ItemCommand` event fires whenever *any* Button, LinkButton, or ImageButton Web control is clicked within the FormView.</span></span> <span data-ttu-id="9872b-216">這表示當使用者在 FormView 中從一頁移到另一個頁面時，就會引發 `ItemCommand` 事件;當使用者在支援插入、更新或刪除的 FormView 中按一下 [新增]、[編輯] 或 [刪除] 時，也是一樣。</span><span class="sxs-lookup"><span data-stu-id="9872b-216">That means that when the user moves from one page to another in the FormView, the `ItemCommand` event fires; same thing when the user clicks New, Edit, or Delete in a FormView that supports inserting, updating, or deleting.</span></span>

<span data-ttu-id="9872b-217">由於 `ItemCommand` 不論按一下哪個按鈕而引發，因此，在事件處理常式中，我們需要一種方法來判斷是否已按下 [停止所有產品] 按鈕，或者是否為其他按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-217">Since the `ItemCommand` fires regardless of what button is clicked, in the event handler we need a way to determine if the Discontinue All Products Button was clicked or if it was some other button.</span></span> <span data-ttu-id="9872b-218">為了達成此目的，我們可以將按鈕 Web 控制項的 `CommandName` 屬性設定為一些識別值。</span><span class="sxs-lookup"><span data-stu-id="9872b-218">To accomplish this, we can set the Button Web control's `CommandName` property to some identifying value.</span></span> <span data-ttu-id="9872b-219">按一下按鈕時，這個 `CommandName` 值會傳遞至 `ItemCommand` 事件處理常式，讓我們判斷是否已按下 [停止所有產品] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-219">When the Button is clicked, this `CommandName` value is passed into the `ItemCommand` event handler, enabling us to determine whether the Discontinue All Products Button was the button clicked.</span></span> <span data-ttu-id="9872b-220">將 [中止所有產品] 按鈕的 `CommandName` 屬性設定為 DiscontinueProducts。</span><span class="sxs-lookup"><span data-stu-id="9872b-220">Set the Discontinue All Products Button's `CommandName` property to DiscontinueProducts .</span></span>

<span data-ttu-id="9872b-221">最後，讓我們使用 [用戶端確認] 對話方塊，確保使用者真的想要停止所選供應商的產品。</span><span class="sxs-lookup"><span data-stu-id="9872b-221">Finally, let's use a client-side confirm dialog box to ensure that the user really wants to discontinue the selected supplier's products.</span></span> <span data-ttu-id="9872b-222">如在刪除教學課程[時新增用戶端確認](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md)中所見，您可以使用一些 JavaScript 來完成這項作業。</span><span class="sxs-lookup"><span data-stu-id="9872b-222">As we saw in the [Adding Client-Side Confirmation When Deleting](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md) tutorial, this can be accomplished with a bit of JavaScript.</span></span> <span data-ttu-id="9872b-223">特別的是，將按鈕 Web 控制項的 OnClientClick 屬性設定為 `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span><span class="sxs-lookup"><span data-stu-id="9872b-223">In particular, set the Button Web control's OnClientClick property to `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span></span>

<span data-ttu-id="9872b-224">進行這些變更之後，FormView 的宣告式語法看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="9872b-224">After making these changes, the FormView's declarative syntax should look like the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample6.aspx)]

<span data-ttu-id="9872b-225">接下來，建立 FormView 的 `ItemCommand` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="9872b-225">Next, create an event handler for the FormView's `ItemCommand` event.</span></span> <span data-ttu-id="9872b-226">在此事件處理常式中，我們必須先判斷是否已按下 [停止所有產品] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-226">In this event handler we need to first determine whether the Discontinue All Products Button was clicked.</span></span> <span data-ttu-id="9872b-227">若是如此，我們想要建立 `ProductsBLL` 類別的實例，並叫用它的 `DiscontinueAllProductsForSupplier(supplierID)` 方法，並傳入所選 FormView 的 `SupplierID`：</span><span class="sxs-lookup"><span data-stu-id="9872b-227">If so, we want to create an instance of the `ProductsBLL` class and invoke its `DiscontinueAllProductsForSupplier(supplierID)` method, passing in the `SupplierID` of the selected FormView:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample7.cs)]

<span data-ttu-id="9872b-228">請注意，您可以使用 FormView 的[`SelectedValue` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx)來存取 formview 中目前選取之供應商的 `SupplierID`。</span><span class="sxs-lookup"><span data-stu-id="9872b-228">Note that the `SupplierID` of the current selected supplier in the FormView can be accessed using the FormView's [`SelectedValue` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx).</span></span> <span data-ttu-id="9872b-229">`SelectedValue` 屬性會傳回要在 FormView 中顯示之記錄的第一個資料索引鍵值。</span><span class="sxs-lookup"><span data-stu-id="9872b-229">The `SelectedValue` property returns the first data key value for the record being displayed in the FormView.</span></span> <span data-ttu-id="9872b-230">FormView 的[`DataKeyNames` 屬性](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx)（表示從中提取資料索引鍵值的資料欄位），會在將 ObjectDataSource 系結至步驟2中的 FormView 時，自動設定為 `SupplierID` Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="9872b-230">The FormView's [`DataKeyNames` property](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx), which indicates the data fields from which the data key values are pulled from, was automatically set to `SupplierID` by Visual Studio when binding the ObjectDataSource to the FormView back in Step 2.</span></span>

<span data-ttu-id="9872b-231">建立 `ItemCommand` 事件處理常式之後，請花點時間測試頁面。</span><span class="sxs-lookup"><span data-stu-id="9872b-231">With the `ItemCommand` event handler created, take a moment to test out the page.</span></span> <span data-ttu-id="9872b-232">流覽至 Cooperativa de Quesos ' 內華達 Cabras ' 供應商（這是 FormView for me 中的第五個供應商）。</span><span class="sxs-lookup"><span data-stu-id="9872b-232">Browse to the Cooperativa de Quesos 'Las Cabras' supplier (it's the fifth supplier in the FormView for me).</span></span> <span data-ttu-id="9872b-233">此供應商提供兩個產品： Queso Cabrales 和 Queso Manchego La Pastora，這兩者都*不*會中止。</span><span class="sxs-lookup"><span data-stu-id="9872b-233">This supplier provides two products, Queso Cabrales and Queso Manchego La Pastora, both of which are *not* discontinued.</span></span>

<span data-ttu-id="9872b-234">假設 Cooperativa de Quesos ' 內華達 Cabras ' 已用盡企業，因此其產品即將淘汰。</span><span class="sxs-lookup"><span data-stu-id="9872b-234">Imagine that Cooperativa de Quesos 'Las Cabras' has gone out of business and therefore its products are to be discontinued.</span></span> <span data-ttu-id="9872b-235">按一下 [停止所有產品] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-235">Click the Discontinue All Products Button.</span></span> <span data-ttu-id="9872b-236">這會顯示 [用戶端確認] 對話方塊（請參閱 [圖 16]）。</span><span class="sxs-lookup"><span data-stu-id="9872b-236">This will display the client-side confirm dialog box (see Figure 16).</span></span>

<span data-ttu-id="9872b-237">[![Cooperativa de Quesos 內華達 Cabras 提供兩個有效的產品](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-237">[![Cooperativa de Quesos Las Cabras Supplies Two Active Products](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span></span>

<span data-ttu-id="9872b-238">**圖 16**： Cooperativa De Quesos 內華達 Cabras 提供兩個使用[中的產品（按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-238">**Figure 16**: Cooperativa de Quesos Las Cabras Supplies Two Active Products ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png))</span></span>

<span data-ttu-id="9872b-239">如果您在 [用戶端確認] 對話方塊中按一下 [確定]，就會繼續提交表單，而導致會引發 FormView 的 `ItemCommand` 事件的回傳。</span><span class="sxs-lookup"><span data-stu-id="9872b-239">If you click OK in the client-side confirm dialog box, the form submission will proceed, causing a postback in which the FormView's `ItemCommand` event will fire.</span></span> <span data-ttu-id="9872b-240">然後，我們建立的事件處理常式會執行，叫用 `DiscontinueAllProductsForSupplier(supplierID)` 方法，並同時停 Queso Cabrales 和 Queso Manchego La Pastora 產品。</span><span class="sxs-lookup"><span data-stu-id="9872b-240">The event handler we created will then execute, invoking the `DiscontinueAllProductsForSupplier(supplierID)` method and discontinuing both the Queso Cabrales and Queso Manchego La Pastora products.</span></span>

<span data-ttu-id="9872b-241">如果您已停用 GridView 的 view 狀態，GridView 會在每次回傳時重新系結至基礎資料存放區，因此會立即更新以反映這兩項產品現在已停止（請參閱 [圖 17]）。</span><span class="sxs-lookup"><span data-stu-id="9872b-241">If you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect that these two products are now discontinued (see Figure 17).</span></span> <span data-ttu-id="9872b-242">不過，如果您在 GridView 中未停用 view 狀態，則在進行這項變更之後，您必須手動將資料重新系結至 GridView。</span><span class="sxs-lookup"><span data-stu-id="9872b-242">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="9872b-243">若要完成此動作，只需在叫用 `DiscontinueAllProductsForSupplier(supplierID)` 方法之後，立即呼叫 GridView 的 `DataBind()` 方法。</span><span class="sxs-lookup"><span data-stu-id="9872b-243">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `DiscontinueAllProductsForSupplier(supplierID)` method.</span></span>

<span data-ttu-id="9872b-244">[![按一下 [中止所有產品] 按鈕之後，供應商的產品會據以更新](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-244">[![After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span></span>

<span data-ttu-id="9872b-245">**圖 17**：按一下 [停止所有產品] 按鈕之後，供應商的產品會隨之更新（[按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-245">**Figure 17**: After Clicking the Discontinue All Products Button, the Supplier's Products are Updated Accordingly ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png))</span></span>

## <a name="step-6-creating-an-updateproduct-overload-in-the-business-logic-layer-for-adjusting-a-products-price"></a><span data-ttu-id="9872b-246">步驟6：在商務邏輯層中建立 UpdateProduct 多載以調整產品的價格</span><span class="sxs-lookup"><span data-stu-id="9872b-246">Step 6: Creating an UpdateProduct Overload in the Business Logic Layer for Adjusting a Product's Price</span></span>

<span data-ttu-id="9872b-247">與 FormView 中的 [停止所有產品] 按鈕相同，為了增加和減少 GridView 中產品的價格，我們必須先新增適當的資料存取層和商務邏輯層方法。</span><span class="sxs-lookup"><span data-stu-id="9872b-247">Like with the Discontinue All Products Button in the FormView, in order to add buttons for increasing and decreasing the price for a product in the GridView we need to first add the appropriate Data Access Layer and Business Logic Layer methods.</span></span> <span data-ttu-id="9872b-248">因為我們已經有更新 DAL 中單一產品資料列的方法，所以我們可以藉由為 BLL 中的 `UpdateProduct` 方法建立新的多載，提供這類功能。</span><span class="sxs-lookup"><span data-stu-id="9872b-248">Since we already have a method that updates a single product row in the DAL, we can provide such functionality by creating a new overload for the `UpdateProduct` method in the BLL.</span></span>

<span data-ttu-id="9872b-249">過去的 `UpdateProduct` 多載已將產品欄位的某種組合納入純量輸入值，然後只針對指定的產品更新這些欄位。</span><span class="sxs-lookup"><span data-stu-id="9872b-249">Our past `UpdateProduct` overloads have taken in some combination of product fields as scalar input values and have then updated just those fields for the specified product.</span></span> <span data-ttu-id="9872b-250">針對此多載，我們將會與此標準略有不同，並改為傳入產品的 `ProductID` 以及調整 `UnitPrice` 的百分比（而不是傳入新的、已調整的 `UnitPrice` 本身）。</span><span class="sxs-lookup"><span data-stu-id="9872b-250">For this overload we'll vary slightly from this standard and instead pass in the product's `ProductID` and the percentage by which to adjust the `UnitPrice` (as opposed to passing in the new, adjusted `UnitPrice` itself).</span></span> <span data-ttu-id="9872b-251">這種方法可以簡化我們需要在 ASP.NET 網頁程式碼後置類別中撰寫的程式碼，因為我們不需要擔心如何判斷目前產品的 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="9872b-251">This approach will simplify the code we need to write in the ASP.NET page code-behind class, since we don't have to bother with determining the current product's `UnitPrice`.</span></span>

<span data-ttu-id="9872b-252">本教學課程的 `UpdateProduct` 多載如下所示：</span><span class="sxs-lookup"><span data-stu-id="9872b-252">The `UpdateProduct` overload for this tutorial is shown below:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample8.cs)]

<span data-ttu-id="9872b-253">這個多載會透過 DAL 的 `GetProductByProductID(productID)` 方法，抓取所指定產品的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="9872b-253">This overload retrieves information about the specified product through the DAL's `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="9872b-254">然後，它會檢查是否已為產品的 `UnitPrice` 指派 `NULL` 值的資料庫。</span><span class="sxs-lookup"><span data-stu-id="9872b-254">It then checks to see whether the product's `UnitPrice` is assigned a database `NULL` value.</span></span> <span data-ttu-id="9872b-255">如果是，價格會原封不動地保留。</span><span class="sxs-lookup"><span data-stu-id="9872b-255">If it is, the price is left unaltered.</span></span> <span data-ttu-id="9872b-256">不過，如果有非`NULL` 的 `UnitPrice` 值，方法就會依照指定的百分比（`unitPriceAdjustmentPercent`）來更新產品的 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="9872b-256">If, however, there is a non-`NULL` `UnitPrice` value, the method updates the product's `UnitPrice` by the specified percent (`unitPriceAdjustmentPercent`).</span></span>

## <a name="step-7-adding-the-increase-and-decrease-buttons-to-the-gridview"></a><span data-ttu-id="9872b-257">步驟7：將 [增加] 和 [減少] 按鈕新增至 GridView</span><span class="sxs-lookup"><span data-stu-id="9872b-257">Step 7: Adding the Increase and Decrease Buttons to the GridView</span></span>

<span data-ttu-id="9872b-258">GridView （和 DetailsView）都是由欄位集合所組成。</span><span class="sxs-lookup"><span data-stu-id="9872b-258">The GridView (and DetailsView) are both made up of a collection of fields.</span></span> <span data-ttu-id="9872b-259">除了 BoundFields、CheckBoxFields 和 TemplateFields，ASP.NET 還包含 ButtonField，其名稱暗示，會轉譯為每個資料列具有按鈕、LinkButton 或 ImageButton 的資料行。</span><span class="sxs-lookup"><span data-stu-id="9872b-259">In addition to BoundFields, CheckBoxFields, and TemplateFields, ASP.NET includes the ButtonField, which, as its name implies, renders as a column with a Button, LinkButton, or ImageButton for each row.</span></span> <span data-ttu-id="9872b-260">類似于 FormView，按一下 GridView 分頁按鈕、[編輯] 或 [刪除] 按鈕、[排序按鈕] 等專案中的*任何*按鈕，都會導致回傳並引發 GridView 的[`RowCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="9872b-260">Similar to the FormView, clicking *any* button within the GridView paging buttons, Edit or Delete buttons, sorting buttons, and so on causes a postback and raises the GridView's [`RowCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx).</span></span>

<span data-ttu-id="9872b-261">ButtonField 具有 `CommandName` 屬性，可將指定的值指派給其每個按鈕 `CommandName` 屬性。</span><span class="sxs-lookup"><span data-stu-id="9872b-261">The ButtonField has a `CommandName` property that assigns the specified value to each of its Buttons `CommandName` properties.</span></span> <span data-ttu-id="9872b-262">就像 FormView 一樣，`RowCommand` 事件處理常式會使用 `CommandName` 值來判斷所按的按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-262">Like with the FormView, the `CommandName` value is used by the `RowCommand` event handler to determine which button was clicked.</span></span>

<span data-ttu-id="9872b-263">讓我們將兩個新的 ButtonFields 新增至 GridView，一個具有按鈕文字價格 + 10%，另一個具有文字價格-10%。</span><span class="sxs-lookup"><span data-stu-id="9872b-263">Let's add two new ButtonFields to the GridView, one with a button text Price +10% and the other with the text Price -10%.</span></span> <span data-ttu-id="9872b-264">若要加入這些 ButtonFields，請按一下 GridView 智慧標籤中的 [編輯資料行] 連結，從左上方的清單中選取 [ButtonField] 欄位類型，然後按一下 [新增] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-264">To add these ButtonFields, click on the Edit Columns link from the GridView's smart tag, select the ButtonField field type from the list in the upper left and click the Add button.</span></span>

![將兩個 ButtonFields 新增至 GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image48.png)

<span data-ttu-id="9872b-266">**圖 18**：將兩個 ButtonFields 新增至 GridView</span><span class="sxs-lookup"><span data-stu-id="9872b-266">**Figure 18**: Add Two ButtonFields to the GridView</span></span>

<span data-ttu-id="9872b-267">移動兩個 ButtonFields，使其顯示為前兩個 GridView 欄位。</span><span class="sxs-lookup"><span data-stu-id="9872b-267">Move the two ButtonFields so that they appear as the first two GridView fields.</span></span> <span data-ttu-id="9872b-268">接下來，將這兩個 ButtonFields 的 [`Text` 屬性] 設定為 [價格 + 10%] 和 [價格-10%]，並將 `CommandName` 屬性分別設為 IncreasePrice 和 DecreasePrice。</span><span class="sxs-lookup"><span data-stu-id="9872b-268">Next, set the `Text` properties of these two ButtonFields to Price +10% and Price -10% and the `CommandName` properties to IncreasePrice and DecreasePrice, respectively.</span></span> <span data-ttu-id="9872b-269">根據預設，ButtonField 會將其按鈕的資料行呈現為 LinkButtons。</span><span class="sxs-lookup"><span data-stu-id="9872b-269">By default, a ButtonField renders its column of buttons as LinkButtons.</span></span> <span data-ttu-id="9872b-270">不過，這可以透過 ButtonField 的[`ButtonType` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx)來變更。</span><span class="sxs-lookup"><span data-stu-id="9872b-270">This can be changed, however, through the ButtonField's [`ButtonType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx).</span></span> <span data-ttu-id="9872b-271">讓我們將這兩個 ButtonFields 轉譯為一般的 push 按鈕;因此，請將 `ButtonType` 屬性設為 `Button`。</span><span class="sxs-lookup"><span data-stu-id="9872b-271">Let's have these two ButtonFields rendered as regular push buttons; therefore, set the `ButtonType` property to `Button`.</span></span> <span data-ttu-id="9872b-272">[圖 19] 顯示在進行這些變更之後的 [欄位] 對話方塊;之後是 GridView 的宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="9872b-272">Figure 19 shows the Fields dialog box after these changes have been made; following that is the GridView's declarative markup.</span></span>

![設定 ButtonFields Text、CommandName 和 ButtonType 屬性](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image49.png)

<span data-ttu-id="9872b-274">**圖 19**：設定 ButtonFields `Text`、`CommandName`和 `ButtonType` 屬性</span><span class="sxs-lookup"><span data-stu-id="9872b-274">**Figure 19**: Configure the ButtonFields `Text`, `CommandName`, and `ButtonType` Properties</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample9.aspx)]

<span data-ttu-id="9872b-275">建立這些 ButtonFields 之後，最後一個步驟是建立 GridView `RowCommand` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="9872b-275">With these ButtonFields created, the final step is to create an event handler for the GridView's `RowCommand` event.</span></span> <span data-ttu-id="9872b-276">這個事件處理常式（如果因為已按下 [價格 + 10%] 或 [價格-10%] 按鈕而引發）需要判斷已按一下按鈕之資料列的 `ProductID`，然後叫用 `ProductsBLL` 類別的 `UpdateProduct` 方法，連同 `ProductID`傳遞適當的 `UnitPrice` 百分比調整。</span><span class="sxs-lookup"><span data-stu-id="9872b-276">This event handler, if fired because either the Price +10% or Price -10% buttons were clicked, needs to determine the `ProductID` for the row whose button was clicked and then invoke the `ProductsBLL` class's `UpdateProduct` method, passing in the appropriate `UnitPrice` percentage adjustment along with the `ProductID`.</span></span> <span data-ttu-id="9872b-277">下列程式碼會執行這些工作：</span><span class="sxs-lookup"><span data-stu-id="9872b-277">The following code performs these tasks:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample10.cs)]

<span data-ttu-id="9872b-278">為了判斷已按下 [價格 + 10%] 或 [Price-10%] 按鈕的資料列 `ProductID`，我們需要查閱 GridView 的 `DataKeys` 集合。</span><span class="sxs-lookup"><span data-stu-id="9872b-278">In order to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we need to consult the GridView's `DataKeys` collection.</span></span> <span data-ttu-id="9872b-279">這個集合會保存每個 GridView 資料列的 `DataKeyNames` 屬性中所指定的欄位值。</span><span class="sxs-lookup"><span data-stu-id="9872b-279">This collection holds the values of the fields specified in the `DataKeyNames` property for each GridView row.</span></span> <span data-ttu-id="9872b-280">由於 GridView 的 `DataKeyNames` 屬性是在將 ObjectDataSource 系結至 GridView 時 Visual Studio 設定為 ProductID，因此 `DataKeys(rowIndex).Value` 會為指定的*rowIndex*提供 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="9872b-280">Since the GridView's `DataKeyNames` property was set to ProductID by Visual Studio when binding the ObjectDataSource to the GridView, `DataKeys(rowIndex).Value` provides the `ProductID` for the specified *rowIndex*.</span></span>

<span data-ttu-id="9872b-281">ButtonField 會自動傳入資料列的*rowIndex* ，其按鈕已透過 `e.CommandArgument` 參數按一下。</span><span class="sxs-lookup"><span data-stu-id="9872b-281">The ButtonField automatically passes in the *rowIndex* of the row whose button was clicked through the `e.CommandArgument` parameter.</span></span> <span data-ttu-id="9872b-282">因此，若要判斷已按下價格 + 10% 或 Price-10% 按鈕的資料列 `ProductID`，我們使用： `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`。</span><span class="sxs-lookup"><span data-stu-id="9872b-282">Therefore, to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we use: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`.</span></span>

<span data-ttu-id="9872b-283">如同 [中斷所有產品] 按鈕，如果您已停用 GridView 的檢視狀態，GridView 就會在每次回傳時重新系結至基礎資料存放區，因此會立即更新以反映按一下時發生的價格變更其中一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-283">As with the Discontinue All Products button, if you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect a price change that occurs from clicking either of the buttons.</span></span> <span data-ttu-id="9872b-284">不過，如果您在 GridView 中未停用 view 狀態，則在進行這項變更之後，您必須手動將資料重新系結至 GridView。</span><span class="sxs-lookup"><span data-stu-id="9872b-284">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="9872b-285">若要完成此動作，只需在叫用 `UpdateProduct` 方法之後，立即呼叫 GridView 的 `DataBind()` 方法。</span><span class="sxs-lookup"><span data-stu-id="9872b-285">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `UpdateProduct` method.</span></span>

<span data-ttu-id="9872b-286">[圖 20] 顯示起來啦阿嬤凱利的 Homestead 所提供的產品時的頁面。</span><span class="sxs-lookup"><span data-stu-id="9872b-286">Figure 20 shows the page when viewing the products provided by Grandma Kelly's Homestead.</span></span> <span data-ttu-id="9872b-287">[圖 21] 顯示在起來啦阿嬤的 Boysenberry 散佈後按兩次 [價格 + 10%] 按鈕時的結果，以及 Northwoods Cranberry Sauce 的 [價格-10%] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="9872b-287">Figure 21 shows the results after the Price +10% button has been clicked twice for Grandma's Boysenberry Spread and the Price -10% button once for Northwoods Cranberry Sauce.</span></span>

<span data-ttu-id="9872b-288">[![GridView 包含價格 + 10% 和價格-10% 按鈕](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-288">[![The GridView Includes Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span></span>

<span data-ttu-id="9872b-289">**圖 20**： GridView 包含價格 + 10% 和 price-10% 按鈕（[按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-289">**Figure 20**: The GridView Includes Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png))</span></span>

<span data-ttu-id="9872b-290">[![第一個和第三個產品的價格已透過價格 + 10% 和價格-10% 按鈕更新](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="9872b-290">[![The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span></span>

<span data-ttu-id="9872b-291">**圖 21**：第一個和第三個產品的價格已透過價格 + 10% 和價格-10% 按鈕更新（[按一下以觀看完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png)）</span><span class="sxs-lookup"><span data-stu-id="9872b-291">**Figure 21**: The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9872b-292">GridView （和 DetailsView）也可以將按鈕、LinkButtons 或 ImageButtons 新增至其 TemplateFields。</span><span class="sxs-lookup"><span data-stu-id="9872b-292">The GridView (and DetailsView) can also have Buttons, LinkButtons, or ImageButtons added to their TemplateFields.</span></span> <span data-ttu-id="9872b-293">如同 BoundField，當您按下這些按鈕時，將會引發回傳，並引發 GridView 的 `RowCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="9872b-293">As with the BoundField, these Buttons, when clicked, will induce a postback, raising the GridView's `RowCommand` event.</span></span> <span data-ttu-id="9872b-294">不過，在 TemplateField 中加入按鈕時，按鈕的 `CommandArgument` 不會自動設定為數據列的索引，如同使用 ButtonFields 時一樣。</span><span class="sxs-lookup"><span data-stu-id="9872b-294">When adding buttons in a TemplateField, however, the Button's `CommandArgument` is not automatically set to the index of the row as it is when using ButtonFields.</span></span> <span data-ttu-id="9872b-295">如果您需要決定在 `RowCommand` 事件處理常式中按下按鈕的資料列索引，您將需要使用類似下列的程式碼，以手動方式在 TemplateField 內的宣告式語法中設定按鈕的 `CommandArgument` 屬性：</span><span class="sxs-lookup"><span data-stu-id="9872b-295">If you need to determine the row index of the button that was clicked within the `RowCommand` event handler, you'll need to manually set the Button's `CommandArgument` property in its declarative syntax within the TemplateField, using code like:</span></span>  
> <span data-ttu-id="9872b-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`。</span><span class="sxs-lookup"><span data-stu-id="9872b-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`.</span></span>

## <a name="summary"></a><span data-ttu-id="9872b-297">總結</span><span class="sxs-lookup"><span data-stu-id="9872b-297">Summary</span></span>

<span data-ttu-id="9872b-298">GridView、DetailsView 和 FormView 控制項全都可以包含按鈕、LinkButtons 或 ImageButtons。</span><span class="sxs-lookup"><span data-stu-id="9872b-298">The GridView, DetailsView, and FormView controls all can include Buttons, LinkButtons, or ImageButtons.</span></span> <span data-ttu-id="9872b-299">按一下這類按鈕時，會導致回傳，並引發 [FormView] 和 [DetailsView] 控制項中的 `ItemCommand` 事件和 GridView 中的 [`RowCommand`] 事件。</span><span class="sxs-lookup"><span data-stu-id="9872b-299">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event in the FormView and DetailsView controls and the `RowCommand` event in the GridView.</span></span> <span data-ttu-id="9872b-300">這些資料 Web 控制項具有內建功能，可處理常見的命令相關動作，例如刪除或編輯記錄。</span><span class="sxs-lookup"><span data-stu-id="9872b-300">These data Web controls have built-in functionality to handle common command-related actions, such as deleting or editing records.</span></span> <span data-ttu-id="9872b-301">不過，我們也可以使用按下的按鈕，以回應執行我們自己的自訂程式碼。</span><span class="sxs-lookup"><span data-stu-id="9872b-301">However, we can also use buttons that, when clicked, respond with executing our own custom code.</span></span>

<span data-ttu-id="9872b-302">若要完成此動作，我們必須建立 `ItemCommand` 或 `RowCommand` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="9872b-302">To accomplish this, we need to create an event handler for the `ItemCommand` or `RowCommand` event.</span></span> <span data-ttu-id="9872b-303">在此事件處理常式中，我們會先檢查傳入的 `CommandName` 值，以判斷已按下的按鈕，然後採取適當的自訂動作。</span><span class="sxs-lookup"><span data-stu-id="9872b-303">In this event handler we first check the incoming `CommandName` value to determine which button was clicked and then take appropriate custom action.</span></span> <span data-ttu-id="9872b-304">在本教學課程中，我們已瞭解如何使用按鈕和 ButtonFields 來終止指定供應商的所有產品，或將特定產品的價格增加或減少10%。</span><span class="sxs-lookup"><span data-stu-id="9872b-304">In this tutorial we saw how to use buttons and ButtonFields to discontinue all products for a specified supplier or to increase or decrease the price of a particular product by 10%.</span></span>

<span data-ttu-id="9872b-305">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="9872b-305">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9872b-306">關於作者</span><span class="sxs-lookup"><span data-stu-id="9872b-306">About the Author</span></span>

<span data-ttu-id="9872b-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="9872b-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9872b-308">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="9872b-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9872b-309">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="9872b-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9872b-310">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9872b-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9872b-311">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="9872b-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="9872b-312">下一步</span><span class="sxs-lookup"><span data-stu-id="9872b-312">Next</span></span>](adding-and-responding-to-buttons-to-a-gridview-vb.md)
