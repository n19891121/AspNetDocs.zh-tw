---
uid: web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
title: 新增與回應 GridView (C#) 的按鈕 |Microsoft Docs
author: rick-anderson
description: 在本教學課程中我們將探討如何將自訂按鈕，新增至範本和 GridView 或 DetailsView 控制項的欄位。 特別是，我們將建置...
ms.author: riande
ms.date: 09/13/2006
ms.assetid: 128fdb5f-4c5e-42b5-b485-f3aee90a8e38
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
msc.type: authoredcontent
ms.openlocfilehash: fd646dede766dd91156f8cd2763dd1989f090f1f
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131746"
---
# <a name="adding-and-responding-to-buttons-to-a-gridview-c"></a><span data-ttu-id="e232a-104">新增與回應 GridView 的按鈕 (C#)</span><span class="sxs-lookup"><span data-stu-id="e232a-104">Adding and Responding to Buttons to a GridView (C#)</span></span>

<span data-ttu-id="e232a-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e232a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e232a-106">[下載範例應用程式](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe)或[下載 PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e232a-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe) or [Download PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span></span>

> <span data-ttu-id="e232a-107">在本教學課程中我們將探討如何將自訂按鈕，新增至範本和 GridView 或 DetailsView 控制項的欄位。</span><span class="sxs-lookup"><span data-stu-id="e232a-107">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="e232a-108">特別是，我們將建置具有可讓使用者逐頁瀏覽供應商 FormView 的介面。</span><span class="sxs-lookup"><span data-stu-id="e232a-108">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span>

## <a name="introduction"></a><span data-ttu-id="e232a-109">簡介</span><span class="sxs-lookup"><span data-stu-id="e232a-109">Introduction</span></span>

<span data-ttu-id="e232a-110">雖然許多報表案例牽涉到對報表資料的唯讀存取，就經常包括可執行動作顯示的資料為基礎的報表。</span><span class="sxs-lookup"><span data-stu-id="e232a-110">While many reporting scenarios involve read-only access to the report data, it's not uncommon for reports to include the ability to perform actions based upon the data displayed.</span></span> <span data-ttu-id="e232a-111">通常這牽涉到將按鈕、 LinkButton 或 ImageButton Web 控制項與顯示在報表中每個記錄，按一下時，會導致回傳，並叫用一些伺服器端程式碼。</span><span class="sxs-lookup"><span data-stu-id="e232a-111">Typically this involved adding a Button, LinkButton, or ImageButton Web control with each record displayed in the report that, when clicked, causes a postback and invokes some server-side code.</span></span> <span data-ttu-id="e232a-112">編輯和刪除記錄的記錄為基礎的資料是最常見的範例。</span><span class="sxs-lookup"><span data-stu-id="e232a-112">Editing and deleting the data on a record-by-record basis is the most common example.</span></span> <span data-ttu-id="e232a-113">事實上，如我們所見開頭[概觀的插入、 更新和刪除資料](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教學課程中，編輯和刪除它是陳腔 GridView、 DetailsView 和 FormView 控制項可支援這類功能，而不用需要撰寫任何一行程式碼。</span><span class="sxs-lookup"><span data-stu-id="e232a-113">In fact, as we saw starting with the [Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, editing and deleting is so common that the GridView, DetailsView, and FormView controls can support such functionality without the need for writing a single line of code.</span></span>

<span data-ttu-id="e232a-114">除了編輯和刪除按鈕、 GridView、 DetailsView 和 FormView 控制項也可以包含按鈕、 Linkbutton 或 ImageButtons，按一下時，執行一些自訂的伺服器端邏輯。</span><span class="sxs-lookup"><span data-stu-id="e232a-114">In addition to Edit and Delete buttons, the GridView, DetailsView, and FormView controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="e232a-115">在本教學課程中我們將探討如何將自訂按鈕，新增至範本和 GridView 或 DetailsView 控制項的欄位。</span><span class="sxs-lookup"><span data-stu-id="e232a-115">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="e232a-116">特別是，我們將建置具有可讓使用者逐頁瀏覽供應商 FormView 的介面。</span><span class="sxs-lookup"><span data-stu-id="e232a-116">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span> <span data-ttu-id="e232a-117">對於給定的供應商、 FormView 會顯示的按鈕 Web 控制項，如果按下，會標記其相關聯的產品的所有停用以及供應商的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="e232a-117">For a given supplier, the FormView will show information about the supplier along with a Button Web control that, if clicked, will mark all of their associated products as discontinued.</span></span> <span data-ttu-id="e232a-118">此外，GridView 會列出所選取的供應商，包含增加的價格與折扣價格的按鈕，如果按下，會引發，或減少產品的每個資料列提供這些產品`UnitPrice`（請參閱 圖 1） 的 10%。</span><span class="sxs-lookup"><span data-stu-id="e232a-118">Additionally, a GridView lists those products provided by the selected supplier, with each row containing Increase Price and Discount Price Buttons that, if clicked, raise or reduce the product's `UnitPrice` by 10% (see Figure 1).</span></span>

<span data-ttu-id="e232a-119">[![FormView 和 GridView 包含執行自訂動作的按鈕](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-119">[![Both the FormView and GridView Contain Buttons That Perform Custom Actions](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span></span>

<span data-ttu-id="e232a-120">**圖 1**:在 FormView 和 GridView 包含按鈕，執行自訂動作 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-120">**Figure 1**: Both the FormView and GridView Contain Buttons That Perform Custom Actions ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png))</span></span>

## <a name="step-1-adding-the-button-tutorial-web-pages"></a><span data-ttu-id="e232a-121">步驟 1：新增按鈕教學課程的 Web 網頁</span><span class="sxs-lookup"><span data-stu-id="e232a-121">Step 1: Adding the Button Tutorial Web Pages</span></span>

<span data-ttu-id="e232a-122">之前我們看看如何新增自訂按鈕，讓我們先花點時間在網站專案中，我們需要在此教學課程中建立 ASP.NET 網頁。</span><span class="sxs-lookup"><span data-stu-id="e232a-122">Before we look at how to add a custom buttons, let's first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="e232a-123">藉由新增新的資料夾，名為啟動`CustomButtons`。</span><span class="sxs-lookup"><span data-stu-id="e232a-123">Start by adding a new folder named `CustomButtons`.</span></span> <span data-ttu-id="e232a-124">接下來，新增到該資料夾，並確認其關聯與每個頁面的下列兩個 ASP.NET 頁面`Site.master`主版頁面：</span><span class="sxs-lookup"><span data-stu-id="e232a-124">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`

![加入 ASP.NET 網頁的自訂按鈕相關教學課程](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image4.png)

<span data-ttu-id="e232a-126">**圖 2**:加入 ASP.NET 網頁的自訂按鈕相關教學課程</span><span class="sxs-lookup"><span data-stu-id="e232a-126">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>

<span data-ttu-id="e232a-127">在其他資料夾，例如`Default.aspx`在`CustomButtons`資料夾會列出其一節中的教學課程。</span><span class="sxs-lookup"><span data-stu-id="e232a-127">Like in the other folders, `Default.aspx` in the `CustomButtons` folder will list the tutorials in its section.</span></span> <span data-ttu-id="e232a-128">請記得，`SectionLevelTutorialListing.ascx`使用者控制項提供這項功能。</span><span class="sxs-lookup"><span data-stu-id="e232a-128">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="e232a-129">因此，新增此使用者控制項`Default.aspx`藉由將它拖曳到頁面的 [設計] 檢視上的 [方案總管] 中。</span><span class="sxs-lookup"><span data-stu-id="e232a-129">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page's Design view.</span></span>

<span data-ttu-id="e232a-130">[![將 SectionLevelTutorialListing.ascx 使用者控制項新增至 Default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-130">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span></span>

<span data-ttu-id="e232a-131">**圖 3**:新增`SectionLevelTutorialListing.ascx`使用者控制項`Default.aspx`([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-131">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png))</span></span>

<span data-ttu-id="e232a-132">最後，將頁面新增項目，以作為`Web.sitemap`檔案。</span><span class="sxs-lookup"><span data-stu-id="e232a-132">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="e232a-133">具體來說，在分頁和排序之後新增下列標記`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="e232a-133">Specifically, add the following markup after the Paging and Sorting `<siteMapNode>`:</span></span>

[!code-xml[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample1.xml)]

<span data-ttu-id="e232a-134">在更新之後`Web.sitemap`，花點時間檢視教學課程網站，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="e232a-134">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="e232a-135">在左側功能表現在包含編輯、 插入及刪除教學課程的項目。</span><span class="sxs-lookup"><span data-stu-id="e232a-135">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![網站導覽現在包含項目自訂按鈕教學課程](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image8.png)

<span data-ttu-id="e232a-137">**圖 4**:網站導覽現在包含項目自訂按鈕教學課程</span><span class="sxs-lookup"><span data-stu-id="e232a-137">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>

## <a name="step-2-adding-a-formview-that-lists-the-suppliers"></a><span data-ttu-id="e232a-138">步驟 2：加入列出的供應商 FormView</span><span class="sxs-lookup"><span data-stu-id="e232a-138">Step 2: Adding a FormView that Lists the Suppliers</span></span>

<span data-ttu-id="e232a-139">讓我們開始進行本教學課程中加上列出的供應商 FormView。</span><span class="sxs-lookup"><span data-stu-id="e232a-139">Let's get started with this tutorial by adding the FormView that lists the suppliers.</span></span> <span data-ttu-id="e232a-140">如簡介中所述，此 FormView 可讓使用者逐頁檢視供應商，顯示 GridView 中供應商所提供的產品。</span><span class="sxs-lookup"><span data-stu-id="e232a-140">As discussed in the Introduction, this FormView will allow the user to page through the suppliers, showing the products provided by the supplier in a GridView.</span></span> <span data-ttu-id="e232a-141">此外，此 FormView 會包含一個按鈕，按一下時，會將標記所有的供應商的產品為停用。</span><span class="sxs-lookup"><span data-stu-id="e232a-141">Additionally, this FormView will include a Button that, when clicked, will mark all of the supplier's products as discontinued.</span></span> <span data-ttu-id="e232a-142">我們考慮自行加入 FormView 的自訂按鈕之前，讓我們第一次只建立 FormView，讓它顯示供應商資訊。</span><span class="sxs-lookup"><span data-stu-id="e232a-142">Before we concern ourselves with adding the custom button to the FormView, let's first just create the FormView so that it displays the supplier information.</span></span>

<span data-ttu-id="e232a-143">首先開啟`CustomButtons.aspx`頁面中`CustomButtons`資料夾。</span><span class="sxs-lookup"><span data-stu-id="e232a-143">Start by opening the `CustomButtons.aspx` page in the `CustomButtons` folder.</span></span> <span data-ttu-id="e232a-144">加入頁面中的 FormView，藉由拖曳從工具箱拖曳至設計工具和設定其`ID`屬性設`Suppliers`。</span><span class="sxs-lookup"><span data-stu-id="e232a-144">Add a FormView to the page by dragging it from the Toolbox onto the Designer and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="e232a-145">從 FormView 的智慧標籤上，選擇建立新的 ObjectDataSource 名為`SuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="e232a-145">From the FormView's smart tag, opt to create a new ObjectDataSource named `SuppliersDataSource`.</span></span>

<span data-ttu-id="e232a-146">[![建立名為 SuppliersDataSource 新 ObjectDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-146">[![Create a New ObjectDataSource Named SuppliersDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span></span>

<span data-ttu-id="e232a-147">**圖 5**:建立新的 ObjectDataSource 具名`SuppliersDataSource`([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-147">**Figure 5**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png))</span></span>

<span data-ttu-id="e232a-148">它會從查詢，請設定這個新的 ObjectDataSource`SuppliersBLL`類別的`GetSuppliers()`方法 （請參閱 圖 6）。</span><span class="sxs-lookup"><span data-stu-id="e232a-148">Configure this new ObjectDataSource such that it queries from the `SuppliersBLL` class's `GetSuppliers()` method (see Figure 6).</span></span> <span data-ttu-id="e232a-149">由於此 FormView 不更新供應商資訊，選取 （無） 選項從下拉式清單中，在 更新 索引標籤中提供的介面。</span><span class="sxs-lookup"><span data-stu-id="e232a-149">Since this FormView does not provide an interface for updating the supplier information, select the (None) option from the drop-down list in the UPDATE tab.</span></span>

<span data-ttu-id="e232a-150">[![資料來源設定為使用 SuppliersBLL 類別的 GetSuppliers() 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-150">[![Configure the Data Source to use the SuppliersBLL Class s GetSuppliers() Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span></span>

<span data-ttu-id="e232a-151">**圖 6**:設定要使用的資料來源`SuppliersBLL`類別的`GetSuppliers()`方法 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-151">**Figure 6**: Configure the Data Source to use the `SuppliersBLL` Class's `GetSuppliers()` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png))</span></span>

<span data-ttu-id="e232a-152">Visual Studio 會產生之後設定 ObjectDataSource `InsertItemTemplate`， `EditItemTemplate`，和`ItemTemplate`FormView 的。</span><span class="sxs-lookup"><span data-stu-id="e232a-152">After configuring the ObjectDataSource, Visual Studio will generate an `InsertItemTemplate`, `EditItemTemplate`, and `ItemTemplate` for the FormView.</span></span> <span data-ttu-id="e232a-153">移除`InsertItemTemplate`並`EditItemTemplate`，並修改`ItemTemplate`，讓它顯示只是供應商的公司名稱和電話號碼。</span><span class="sxs-lookup"><span data-stu-id="e232a-153">Remove the `InsertItemTemplate` and `EditItemTemplate` and modify the `ItemTemplate` so that it displays just the supplier's company name and phone number.</span></span> <span data-ttu-id="e232a-154">最後，開啟 FormView 的分頁支援，藉由檢查它的智慧標籤啟用分頁 核取方塊 (或藉由設定其`AllowPaging`屬性設`True`)。</span><span class="sxs-lookup"><span data-stu-id="e232a-154">Finally, turn on paging support for the FormView by checking the Enable Paging checkbox from its smart tag (or by setting its `AllowPaging` property to `True`).</span></span> <span data-ttu-id="e232a-155">在這些變更之後您頁面的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="e232a-155">After these changes your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample2.aspx)]

<span data-ttu-id="e232a-156">[圖 7] 顯示 CustomButtons.aspx 頁面上，當透過瀏覽器檢視。</span><span class="sxs-lookup"><span data-stu-id="e232a-156">Figure 7 shows the CustomButtons.aspx page when viewed through a browser.</span></span>

<span data-ttu-id="e232a-157">[![FormView 列出 [CompanyName] 和 [從目前選取的供應商的電話欄位](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-157">[![The FormView Lists the CompanyName and Phone Fields from the Currently Selected Supplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span></span>

<span data-ttu-id="e232a-158">**圖 7**:FormView 列出`CompanyName`並`Phone`從目前選取的供應商的欄位 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-158">**Figure 7**: The FormView Lists the `CompanyName` and `Phone` Fields from the Currently Selected Supplier ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png))</span></span>

## <a name="step-3-adding-a-gridview-that-lists-the-selected-suppliers-products"></a><span data-ttu-id="e232a-159">步驟 3：新增的 GridView 會列出選取的供應商產品</span><span class="sxs-lookup"><span data-stu-id="e232a-159">Step 3: Adding a GridView that Lists the Selected Supplier's Products</span></span>

<span data-ttu-id="e232a-160">我們將停止所有的產品 按鈕加入至 FormView 的範本之前，讓我們先將下方會列出所選取的供應商提供的產品 FormView GridView。</span><span class="sxs-lookup"><span data-stu-id="e232a-160">Before we add the Discontinue All Products Button to the FormView's template, let's first add a GridView beneath the FormView that lists the products provided by the selected supplier.</span></span> <span data-ttu-id="e232a-161">若要達成此目的，將 GridView 加入頁面中，設定其`ID`屬性，以`SuppliersProducts`，並新增名為新 ObjectDataSource `SuppliersProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="e232a-161">To accomplish this, add a GridView to the page, set its `ID` property to `SuppliersProducts`, and add a new ObjectDataSource named `SuppliersProductsDataSource`.</span></span>

<span data-ttu-id="e232a-162">[![建立名為 SuppliersProductsDataSource 新 ObjectDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-162">[![Create a New ObjectDataSource Named SuppliersProductsDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span></span>

<span data-ttu-id="e232a-163">**圖 8**:建立新的 ObjectDataSource 具名`SuppliersProductsDataSource`([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-163">**Figure 8**: Create a New ObjectDataSource Named `SuppliersProductsDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png))</span></span>

<span data-ttu-id="e232a-164">設定要使用 ProductsBLL 類別的這個 ObjectDataSource`GetProductsBySupplierID(supplierID)`方法 （請參閱 圖 9）。</span><span class="sxs-lookup"><span data-stu-id="e232a-164">Configure this ObjectDataSource to use the ProductsBLL class's `GetProductsBySupplierID(supplierID)` method (see Figure 9).</span></span> <span data-ttu-id="e232a-165">雖然此 GridView 可調整的產品的價格，它將不會使用內建編輯或刪除從 GridView 的功能。</span><span class="sxs-lookup"><span data-stu-id="e232a-165">While this GridView will allow for a product's price to be adjusted, it won't be using the built-in editing or deleting features from the GridView.</span></span> <span data-ttu-id="e232a-166">因此，我們可以設定為 （無） 下拉式清單，ObjectDataSource 的更新、 插入和刪除索引標籤。</span><span class="sxs-lookup"><span data-stu-id="e232a-166">Therefore, we can set the drop-down list to (None) for the ObjectDataSource's UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="e232a-167">[![資料來源設定為使用 ProductsBLL 類別的 GetProductsBySupplierID(supplierID) 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-167">[![Configure the Data Source to use the ProductsBLL Class s GetProductsBySupplierID(supplierID) Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span></span>

<span data-ttu-id="e232a-168">**圖 9**:設定要使用的資料來源`ProductsBLL`類別的`GetProductsBySupplierID(supplierID)`方法 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-168">**Figure 9**: Configure the Data Source to use the `ProductsBLL` Class's `GetProductsBySupplierID(supplierID)` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png))</span></span>

<span data-ttu-id="e232a-169">因為`GetProductsBySupplierID(supplierID)`方法會接受輸入的參數、 ObjectDataSource 精靈會提示我們輸入這個參數值的來源。</span><span class="sxs-lookup"><span data-stu-id="e232a-169">Since the `GetProductsBySupplierID(supplierID)` method accepts an input parameter, the ObjectDataSource wizard prompts us for the source of this parameter value.</span></span> <span data-ttu-id="e232a-170">傳入`SupplierID`FormView 值、 控制項和 ControlID 下拉式清單中的，若要設定參數來源下拉式清單`Suppliers`（在步驟 2 中建立的 FormView 識別碼）。</span><span class="sxs-lookup"><span data-stu-id="e232a-170">To pass in the `SupplierID` value from the FormView, set the Parameter source drop-down list to Control and the ControlID drop-down list to `Suppliers` (the ID of the FormView created in Step 2).</span></span>

<span data-ttu-id="e232a-171">[![表示讓 supplierID 參數應該都來自供應商 FormView 控制項](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-171">[![Indicate that the supplierID Parameter Should Come from the Suppliers FormView Control](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span></span>

<span data-ttu-id="e232a-172">**圖 10**:表示*`supplierID`* 參數應該來自於`Suppliers`FormView 控制項 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-172">**Figure 10**: Indicate that the *`supplierID`* Parameter Should Come from the `Suppliers` FormView Control ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png))</span></span>

<span data-ttu-id="e232a-173">完成 ObjectDataSource 精靈之後，GridView 會包含 BoundField 或 CheckBoxField 每個產品的資料欄位。</span><span class="sxs-lookup"><span data-stu-id="e232a-173">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product's data fields.</span></span> <span data-ttu-id="e232a-174">讓我們來精簡這顯示只`ProductName`並`UnitPrice`連同 BoundFields `Discontinued` CheckBoxField; 此外，讓我們格式化`UnitPrice`BoundField 使其文字格式化為貨幣。</span><span class="sxs-lookup"><span data-stu-id="e232a-174">Let's trim this down to show just the `ProductName` and `UnitPrice` BoundFields along with the `Discontinued` CheckBoxField; furthermore, let's format the `UnitPrice` BoundField such that its text is formatted as a currency.</span></span> <span data-ttu-id="e232a-175">您的 GridView 和`SuppliersProductsDataSource`ObjectDataSource 的宣告式標記看起來應該類似下列標記：</span><span class="sxs-lookup"><span data-stu-id="e232a-175">Your GridView and `SuppliersProductsDataSource` ObjectDataSource's declarative markup should look similar to the following markup:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample3.aspx)]

<span data-ttu-id="e232a-176">此時在教學課程中會顯示主版/詳細資料報表，讓使用者從頂端 FormView 挑選供應商，並檢視底部 GridView 透過該供應商所提供的產品。</span><span class="sxs-lookup"><span data-stu-id="e232a-176">At this point our tutorial displays a master/details report, allowing the user to pick a supplier from the FormView at the top and to view the products provided by that supplier through the GridView at the bottom.</span></span> <span data-ttu-id="e232a-177">[圖 11] 顯示此頁面的螢幕擷取畫面從 FormView 選取東京 Traders 供應商時。</span><span class="sxs-lookup"><span data-stu-id="e232a-177">Figure 11 shows a screen shot of this page when selecting the Tokyo Traders supplier from the FormView.</span></span>

<span data-ttu-id="e232a-178">[![選取的供應商產品會顯示在 GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-178">[![The Selected Supplier s Products are Displayed in the GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span></span>

<span data-ttu-id="e232a-179">**圖 11**:選取供應商產品都會顯示在 GridView ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-179">**Figure 11**: The Selected Supplier's Products are Displayed in the GridView ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png))</span></span>

## <a name="step-4-creating-dal-and-bll-methods-to-discontinue-all-products-for-a-supplier"></a><span data-ttu-id="e232a-180">步驟 4：建立 DAL 和 BLL 方法，以停止所有產品的供應商</span><span class="sxs-lookup"><span data-stu-id="e232a-180">Step 4: Creating DAL and BLL Methods to Discontinue All Products for a Supplier</span></span>

<span data-ttu-id="e232a-181">我們可在 FormView 上加入按鈕之前，按一下時，會中止所有供應商的產品，我們必須先將方法加入的 DAL 」 和 「 不會執行此動作的 BLL。</span><span class="sxs-lookup"><span data-stu-id="e232a-181">Before we can add a Button to the FormView that, when clicked, discontinues all of the supplier's products, we first need to add a method to both the DAL and BLL that performs this action.</span></span> <span data-ttu-id="e232a-182">特別是，這個方法將會命名為`DiscontinueAllProductsForSupplier(supplierID)`。</span><span class="sxs-lookup"><span data-stu-id="e232a-182">In particular, this method will be named `DiscontinueAllProductsForSupplier(supplierID)`.</span></span> <span data-ttu-id="e232a-183">按一下 FormView 的按鈕時，我們將會叫用這個方法在商務邏輯層中，傳遞中選取的供應商`SupplierID`; BLL 會接著呼叫向下對應的資料存取層方法會發出`UPDATE`陳述式若要停止指定的供應商產品的資料庫。</span><span class="sxs-lookup"><span data-stu-id="e232a-183">When the FormView's Button is clicked, we'll invoke this method in the Business Logic Layer, passing in the selected supplier's `SupplierID`; the BLL will then call down to the corresponding Data Access Layer method, which will issue an `UPDATE` statement to the database that discontinues the specified supplier's products.</span></span>

<span data-ttu-id="e232a-184">我們已完成之後，我們先前的教學課程中，我們將使用由下往上的方法，開始建立 DAL 方法，然後 BLL 方法，和最後 ASP.NET 網頁中實作的功能。</span><span class="sxs-lookup"><span data-stu-id="e232a-184">As we have done in our previous tutorials, we'll use a bottom-up approach, starting with creating the DAL method, then the BLL method, and finally implementing the functionality in the ASP.NET page.</span></span> <span data-ttu-id="e232a-185">開啟`Northwind.xsd`型別中的資料集`App_Code/DAL`資料夾，並新增新的方法來`ProductsTableAdapter`(以滑鼠右鍵按一下`ProductsTableAdapter`，然後選擇 新增查詢)。</span><span class="sxs-lookup"><span data-stu-id="e232a-185">Open the `Northwind.xsd` Typed DataSet in the `App_Code/DAL` folder and add a new method to the `ProductsTableAdapter` (right-click on the `ProductsTableAdapter` and choose Add Query).</span></span> <span data-ttu-id="e232a-186">這樣會帶出 TableAdapter 查詢組態精靈，它將帶領我們新增新方法的程序。</span><span class="sxs-lookup"><span data-stu-id="e232a-186">Doing so will bring up the TableAdapter Query Configuration wizard, which walks us through the process of adding the new method.</span></span> <span data-ttu-id="e232a-187">指出我們的 DAL 方法會使用特定 SQL 陳述式開始。</span><span class="sxs-lookup"><span data-stu-id="e232a-187">Start by indicating that our DAL method will use an ad-hoc SQL statement.</span></span>

<span data-ttu-id="e232a-188">[![建立使用特定 SQL 陳述式的 DAL 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-188">[![Create the DAL Method Using an Ad-Hoc SQL Statement](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span></span>

<span data-ttu-id="e232a-189">**圖 12**:建立 DAL 方法使用特定 SQL 陳述式 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-189">**Figure 12**: Create the DAL Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png))</span></span>

<span data-ttu-id="e232a-190">接下來，精靈會提示我們輸入有關何種查詢來建立。</span><span class="sxs-lookup"><span data-stu-id="e232a-190">Next, the wizard prompts us as to what type of query to create.</span></span> <span data-ttu-id="e232a-191">由於`DiscontinueAllProductsForSupplier(supplierID)`方法將需要更新`Products`資料庫資料表中，設定`Discontinued`欄位設為 1，指定所提供的所有產品 *`supplierID`* ，我們需要建立可更新資料的查詢。</span><span class="sxs-lookup"><span data-stu-id="e232a-191">Since the `DiscontinueAllProductsForSupplier(supplierID)` method will need to update the `Products` database table, setting the `Discontinued` field to 1 for all products provided by the specified *`supplierID`*, we need to create a query that updates data.</span></span>

<span data-ttu-id="e232a-192">[![選擇更新查詢類型](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-192">[![Choose the UPDATE Query Type](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span></span>

<span data-ttu-id="e232a-193">**圖 13**:選擇更新查詢類型 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-193">**Figure 13**: Choose the UPDATE Query Type ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png))</span></span>

<span data-ttu-id="e232a-194">精靈的下一個畫面會提供現有 TableAdapter`UPDATE`陳述式，這會更新每個欄位中定義`Products`DataTable。</span><span class="sxs-lookup"><span data-stu-id="e232a-194">The next wizard screen provides the TableAdapter's existing `UPDATE` statement, which updates each of the fields defined in the `Products` DataTable.</span></span> <span data-ttu-id="e232a-195">此查詢的文字取代為下列陳述式：</span><span class="sxs-lookup"><span data-stu-id="e232a-195">Replace this query text with the following statement:</span></span>

[!code-sql[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample4.sql)]

<span data-ttu-id="e232a-196">之後輸入這項查詢，並按一下 [下一步]，精靈的最後一個畫面會要求新的方法名稱，請使用`DiscontinueAllProductsForSupplier`。</span><span class="sxs-lookup"><span data-stu-id="e232a-196">After entering this query and clicking Next, the last wizard screen asks for the new method's name use `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="e232a-197">按一下 [完成] 按鈕，以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="e232a-197">Complete the wizard by clicking the Finish button.</span></span> <span data-ttu-id="e232a-198">返回 DataSet 設計工具中，您應該看到中的新方法`ProductsTableAdapter`名為`DiscontinueAllProductsForSupplier(@SupplierID)`。</span><span class="sxs-lookup"><span data-stu-id="e232a-198">Upon returning to the DataSet Designer you should see a new method in the `ProductsTableAdapter` named `DiscontinueAllProductsForSupplier(@SupplierID)`.</span></span>

<span data-ttu-id="e232a-199">[![命名新的 DAL 方法 DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-199">[![Name the New DAL Method DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span></span>

<span data-ttu-id="e232a-200">**圖 14**:將新的 DAL 方法`DiscontinueAllProductsForSupplier`([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-200">**Figure 14**: Name the New DAL Method `DiscontinueAllProductsForSupplier` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png))</span></span>

<span data-ttu-id="e232a-201">具有`DiscontinueAllProductsForSupplier(supplierID)`在資料存取層中建立的方法下, 一步是建立`DiscontinueAllProductsForSupplier(supplierID)`商業邏輯層中的方法。</span><span class="sxs-lookup"><span data-stu-id="e232a-201">With the `DiscontinueAllProductsForSupplier(supplierID)` method created in the Data Access Layer, our next task is to create the `DiscontinueAllProductsForSupplier(supplierID)` method in the Business Logic Layer.</span></span> <span data-ttu-id="e232a-202">若要這麼做，開啟`ProductsBLL`類別檔案，並新增下列：</span><span class="sxs-lookup"><span data-stu-id="e232a-202">To accomplish this, open the `ProductsBLL` class file and add the following:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample5.cs)]

<span data-ttu-id="e232a-203">這個方法只會呼叫下`DiscontinueAllProductsForSupplier(supplierID)`方法中傳遞所提供的 DAL *`supplierID`* 參數值。</span><span class="sxs-lookup"><span data-stu-id="e232a-203">This method simply calls down to the `DiscontinueAllProductsForSupplier(supplierID)` method in the DAL, passing along the provided *`supplierID`* parameter value.</span></span> <span data-ttu-id="e232a-204">如果有任何商務規則，只允許在某些情況下停止供應商的產品，這些規則應該在這裡，在實作 BLL。</span><span class="sxs-lookup"><span data-stu-id="e232a-204">If there were any business rules that only allowed a supplier's products to be discontinued under certain circumstances, those rules should be implemented here, in the BLL.</span></span>

> [!NOTE]
> <span data-ttu-id="e232a-205">不同於`UpdateProduct`中的多載`ProductsBLL`類別`DiscontinueAllProductsForSupplier(supplierID)`方法簽章不包含`DataObjectMethodAttribute`屬性 (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`)。</span><span class="sxs-lookup"><span data-stu-id="e232a-205">Unlike the `UpdateProduct` overloads in the `ProductsBLL` class, the `DiscontinueAllProductsForSupplier(supplierID)` method signature does not include the `DataObjectMethodAttribute` attribute (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`).</span></span> <span data-ttu-id="e232a-206">這會防止`DiscontinueAllProductsForSupplier(supplierID)`從 ObjectDataSource 的設定資料來源精靈 的下拉式清單中 更新 索引標籤的方法。我已省略此屬性，因為我們將會呼叫`DiscontinueAllProductsForSupplier(supplierID)`直接從我們的 ASP.NET 網頁中的事件處理常式的方法。</span><span class="sxs-lookup"><span data-stu-id="e232a-206">This precludes the `DiscontinueAllProductsForSupplier(supplierID)` method from the ObjectDataSource's Configure Data Source wizard's drop-down list in the UPDATE tab. I ve omitted this attribute because we'll be calling the `DiscontinueAllProductsForSupplier(supplierID)` method directly from an event handler in our ASP.NET page.</span></span>

## <a name="step-5-adding-a-discontinue-all-products-button-to-the-formview"></a><span data-ttu-id="e232a-207">步驟 5：將停止所有的產品按鈕，以 FormView</span><span class="sxs-lookup"><span data-stu-id="e232a-207">Step 5: Adding a Discontinue All Products Button to the FormView</span></span>

<span data-ttu-id="e232a-208">具有`DiscontinueAllProductsForSupplier(supplierID)`方法中 BLL 和 DAL 完成，加入選取的供應商停止所有產品的能力的最後一個步驟是將 Button Web 控制項新增至 FormView 的`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="e232a-208">With the `DiscontinueAllProductsForSupplier(supplierID)` method in the BLL and DAL complete, the final step for adding the ability to discontinue all products for the selected supplier is to add a Button Web control to the FormView's `ItemTemplate`.</span></span> <span data-ttu-id="e232a-209">讓我們加入這類按鈕下方按鈕文字時，停止所有產品的供應商的電話號碼和`ID`屬性值為`DiscontinueAllProductsForSupplier`。</span><span class="sxs-lookup"><span data-stu-id="e232a-209">Let's add such a Button below the supplier's phone number with the button text, Discontinue All Products and an `ID` property value of `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="e232a-210">您可以將此按鈕 Web 控制項透過設計工具中 FormView 的智慧標籤的 編輯範本 連結上即可 （請參閱 圖 15），或直接透過宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="e232a-210">You can add this Button Web control through the Designer by clicking on the Edit Templates link in the FormView's smart tag (see Figure 15), or directly through the declarative syntax.</span></span>

<span data-ttu-id="e232a-211">[![將停止所有產品按鈕 Web 控制項，以 FormView 的 ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-211">[![Add a Discontinue All Products Button Web Control to the FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span></span>

<span data-ttu-id="e232a-212">**圖 15**:停止所有產品按鈕 Web 控制項都加入 FormView `ItemTemplate` ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-212">**Figure 15**: Add a Discontinue All Products Button Web Control to the FormView's `ItemTemplate` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png))</span></span>

<span data-ttu-id="e232a-213">當使用者瀏覽 頁面上，回傳是兩邊彼此乾瞪眼和 FormView 的按一下按鈕[`ItemCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx)引發。</span><span class="sxs-lookup"><span data-stu-id="e232a-213">When the Button is clicked by a user visiting the page, a postback ensues and the FormView's [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx) fires.</span></span> <span data-ttu-id="e232a-214">若要執行自訂程式碼以回應所按下此按鈕，我們可以建立此事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="e232a-214">To execute custom code in response to this Button being clicked, we can create an event handler for this event.</span></span> <span data-ttu-id="e232a-215">了解，不過`ItemCommand`就會引發事件時*任何*FormView 內按下按鈕、 LinkButton 或 ImageButton Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="e232a-215">Understand, though, that the `ItemCommand` event fires whenever *any* Button, LinkButton, or ImageButton Web control is clicked within the FormView.</span></span> <span data-ttu-id="e232a-216">這表示當使用者從一頁移到另一個在 FormView，`ItemCommand`事件引發; 相同的動作，當使用者按一下 [新增]，[編輯]，或在支援插入、 更新或刪除的 FormView 中刪除。</span><span class="sxs-lookup"><span data-stu-id="e232a-216">That means that when the user moves from one page to another in the FormView, the `ItemCommand` event fires; same thing when the user clicks New, Edit, or Delete in a FormView that supports inserting, updating, or deleting.</span></span>

<span data-ttu-id="e232a-217">因為`ItemCommand`引發不論按一下按鈕時，在事件處理常式我們需要方法來判斷是否按下 [停止所有的產品] 按鈕，或如果是其他的按鈕。</span><span class="sxs-lookup"><span data-stu-id="e232a-217">Since the `ItemCommand` fires regardless of what button is clicked, in the event handler we need a way to determine if the Discontinue All Products Button was clicked or if it was some other button.</span></span> <span data-ttu-id="e232a-218">若要這麼做，我們可以設定按鈕 Web 控制項的`CommandName`某些識別值的屬性。</span><span class="sxs-lookup"><span data-stu-id="e232a-218">To accomplish this, we can set the Button Web control's `CommandName` property to some identifying value.</span></span> <span data-ttu-id="e232a-219">當按一下按鈕時，這`CommandName`值會傳遞至`ItemCommand`事件處理常式，讓我們可以判斷是否停止所有的產品 按鈕已按下按鈕。</span><span class="sxs-lookup"><span data-stu-id="e232a-219">When the Button is clicked, this `CommandName` value is passed into the `ItemCommand` event handler, enabling us to determine whether the Discontinue All Products Button was the button clicked.</span></span> <span data-ttu-id="e232a-220">將停止所有產品按鈕的`CommandName`DiscontinueProducts 的屬性。</span><span class="sxs-lookup"><span data-stu-id="e232a-220">Set the Discontinue All Products Button's `CommandName` property to DiscontinueProducts .</span></span>

<span data-ttu-id="e232a-221">最後，讓我們使用用戶端確認對話方塊中以確保使用者真正想要停止選取的供應商產品。</span><span class="sxs-lookup"><span data-stu-id="e232a-221">Finally, let's use a client-side confirm dialog box to ensure that the user really wants to discontinue the selected supplier's products.</span></span> <span data-ttu-id="e232a-222">如我們在中所見[正在刪除時新增用戶端確認](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md)教學課程中，這可以使用一些 JavaScript 來完成。</span><span class="sxs-lookup"><span data-stu-id="e232a-222">As we saw in the [Adding Client-Side Confirmation When Deleting](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md) tutorial, this can be accomplished with a bit of JavaScript.</span></span> <span data-ttu-id="e232a-223">特別是，將 Button Web 控制項的 OnClientClick 屬性設定為 `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span><span class="sxs-lookup"><span data-stu-id="e232a-223">In particular, set the Button Web control's OnClientClick property to `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span></span>

<span data-ttu-id="e232a-224">進行這些變更之後，FormView 的宣告式語法看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="e232a-224">After making these changes, the FormView's declarative syntax should look like the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample6.aspx)]

<span data-ttu-id="e232a-225">接下來，建立事件處理常式，如 FormView 的`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="e232a-225">Next, create an event handler for the FormView's `ItemCommand` event.</span></span> <span data-ttu-id="e232a-226">這個事件處理常式中，我們需要先判斷是否已按下 [停止所有的產品] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="e232a-226">In this event handler we need to first determine whether the Discontinue All Products Button was clicked.</span></span> <span data-ttu-id="e232a-227">如果我們想要建立的執行個體的的話`ProductsBLL`類別，並叫用其`DiscontinueAllProductsForSupplier(supplierID)`方法並傳入`SupplierID`選取 FormView 的：</span><span class="sxs-lookup"><span data-stu-id="e232a-227">If so, we want to create an instance of the `ProductsBLL` class and invoke its `DiscontinueAllProductsForSupplier(supplierID)` method, passing in the `SupplierID` of the selected FormView:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample7.cs)]

<span data-ttu-id="e232a-228">請注意， `SupplierID` FormView 中目前選取的供應商可以存取使用 FormView [ `SelectedValue`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e232a-228">Note that the `SupplierID` of the current selected supplier in the FormView can be accessed using the FormView's [`SelectedValue` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx).</span></span> <span data-ttu-id="e232a-229">`SelectedValue`屬性會傳回第一個資料機碼顯示在 FormView 中之資料錄的值。</span><span class="sxs-lookup"><span data-stu-id="e232a-229">The `SelectedValue` property returns the first data key value for the record being displayed in the FormView.</span></span> <span data-ttu-id="e232a-230">FormView [ `DataKeyNames`屬性](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx)，表示的資料欄位的資料索引鍵值取自，自動設定為`SupplierID`時繫結至 FormView 的 ObjectDataSource 的 Visual studio在 [步驟 2。</span><span class="sxs-lookup"><span data-stu-id="e232a-230">The FormView's [`DataKeyNames` property](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx), which indicates the data fields from which the data key values are pulled from, was automatically set to `SupplierID` by Visual Studio when binding the ObjectDataSource to the FormView back in Step 2.</span></span>

<span data-ttu-id="e232a-231">使用`ItemCommand`事件處理常式建立，請花一點時間測試頁面。</span><span class="sxs-lookup"><span data-stu-id="e232a-231">With the `ItemCommand` event handler created, take a moment to test out the page.</span></span> <span data-ttu-id="e232a-232">瀏覽至 Cooperativa de Quesos ' Las Cabras' 供應商 （它是在我 FormView 的第五個供應商）。</span><span class="sxs-lookup"><span data-stu-id="e232a-232">Browse to the Cooperativa de Quesos 'Las Cabras' supplier (it's the fifth supplier in the FormView for me).</span></span> <span data-ttu-id="e232a-233">此供應商提供兩項產品，Queso Cabrales 和 Queso Manchego La Pastora，這兩者都是*不*停用。</span><span class="sxs-lookup"><span data-stu-id="e232a-233">This supplier provides two products, Queso Cabrales and Queso Manchego La Pastora, both of which are *not* discontinued.</span></span>

<span data-ttu-id="e232a-234">假設 Cooperativa de Quesos ' Las Cabras' 已離開公司，因此其產品會停止。</span><span class="sxs-lookup"><span data-stu-id="e232a-234">Imagine that Cooperativa de Quesos 'Las Cabras' has gone out of business and therefore its products are to be discontinued.</span></span> <span data-ttu-id="e232a-235">按一下 [停止所有產品] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="e232a-235">Click the Discontinue All Products Button.</span></span> <span data-ttu-id="e232a-236">這會顯示用戶端確認對話方塊 （請參閱 圖 16）。</span><span class="sxs-lookup"><span data-stu-id="e232a-236">This will display the client-side confirm dialog box (see Figure 16).</span></span>

<span data-ttu-id="e232a-237">[![Cooperativa de Quesos Las Cabras 提供兩個使用中的產品](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-237">[![Cooperativa de Quesos Las Cabras Supplies Two Active Products](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span></span>

<span data-ttu-id="e232a-238">**圖 16**:Cooperativa de Quesos Las Cabras 提供兩個使用中的產品 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-238">**Figure 16**: Cooperativa de Quesos Las Cabras Supplies Two Active Products ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png))</span></span>

<span data-ttu-id="e232a-239">如果您按一下 [確定]，在用戶端確認對話方塊中，表單送出將會繼續，在其中造成回傳 FormView 的`ItemCommand`事件就會引發。</span><span class="sxs-lookup"><span data-stu-id="e232a-239">If you click OK in the client-side confirm dialog box, the form submission will proceed, causing a postback in which the FormView's `ItemCommand` event will fire.</span></span> <span data-ttu-id="e232a-240">我們建立的事件處理常式接著會執行，請叫用`DiscontinueAllProductsForSupplier(supplierID)`方法，並停用的 Queso Cabrales 」 和 「 Queso Manchego La Pastora 產品。</span><span class="sxs-lookup"><span data-stu-id="e232a-240">The event handler we created will then execute, invoking the `DiscontinueAllProductsForSupplier(supplierID)` method and discontinuing both the Queso Cabrales and Queso Manchego La Pastora products.</span></span>

<span data-ttu-id="e232a-241">如果您已停用 GridView 的檢視狀態，GridView 會被重新繫結至基礎資料存放區在每次回傳中，並因此將立即更新以反映，這兩項產品現已停用 （請參閱 圖 17）。</span><span class="sxs-lookup"><span data-stu-id="e232a-241">If you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect that these two products are now discontinued (see Figure 17).</span></span> <span data-ttu-id="e232a-242">如果，不過，您不停用檢視狀態，在 gridview 裡，您必須以手動方式將重新繫結至 GridView 資料之後進行這項變更。</span><span class="sxs-lookup"><span data-stu-id="e232a-242">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="e232a-243">若要這麼做，只對進行呼叫 GridView`DataBind()`方法叫用後，立即`DiscontinueAllProductsForSupplier(supplierID)`方法。</span><span class="sxs-lookup"><span data-stu-id="e232a-243">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `DiscontinueAllProductsForSupplier(supplierID)` method.</span></span>

<span data-ttu-id="e232a-244">[![按一下 停止所有產品按鈕後，供應商的產品是據以更新](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-244">[![After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span></span>

<span data-ttu-id="e232a-245">**圖 17**:按一下 停止所有產品按鈕後，供應商的產品是據此更新 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-245">**Figure 17**: After Clicking the Discontinue All Products Button, the Supplier's Products are Updated Accordingly ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png))</span></span>

## <a name="step-6-creating-an-updateproduct-overload-in-the-business-logic-layer-for-adjusting-a-products-price"></a><span data-ttu-id="e232a-246">步驟 6：建立 UpdateProduct 多載中調整產品的價格的商務邏輯層</span><span class="sxs-lookup"><span data-stu-id="e232a-246">Step 6: Creating an UpdateProduct Overload in the Business Logic Layer for Adjusting a Product's Price</span></span>

<span data-ttu-id="e232a-247">像是停止所有產品中的按鈕 FormView，若要加入按鈕的增加和減少 GridView 裡的產品的價格我們都需要先將新增適當的資料存取層和商務邏輯層方法。</span><span class="sxs-lookup"><span data-stu-id="e232a-247">Like with the Discontinue All Products Button in the FormView, in order to add buttons for increasing and decreasing the price for a product in the GridView we need to first add the appropriate Data Access Layer and Business Logic Layer methods.</span></span> <span data-ttu-id="e232a-248">由於我們已經有更新單一產品中的資料列的 DAL 的方法，我們可以建立的新多載來提供這類功能`UpdateProduct`到 BLL 中的方法。</span><span class="sxs-lookup"><span data-stu-id="e232a-248">Since we already have a method that updates a single product row in the DAL, we can provide such functionality by creating a new overload for the `UpdateProduct` method in the BLL.</span></span>

<span data-ttu-id="e232a-249">我們過去`UpdateProduct`多載已在產品欄位的一些組合，做為純量輸入的值，然後更新的欄位指定的產品。</span><span class="sxs-lookup"><span data-stu-id="e232a-249">Our past `UpdateProduct` overloads have taken in some combination of product fields as scalar input values and have then updated just those fields for the specified product.</span></span> <span data-ttu-id="e232a-250">這個多載而言，我們會稍有不同這項標準，改為傳入的產品`ProductID`以及用來調整百分比`UnitPrice`(而不是在新的傳遞，調整`UnitPrice`本身)。</span><span class="sxs-lookup"><span data-stu-id="e232a-250">For this overload we'll vary slightly from this standard and instead pass in the product's `ProductID` and the percentage by which to adjust the `UnitPrice` (as opposed to passing in the new, adjusted `UnitPrice` itself).</span></span> <span data-ttu-id="e232a-251">這種方法會簡化程式碼，我們必須撰寫在 ASP.NET 網頁程式碼後置類別中，因為我們不需要判斷目前的產品，又何必`UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="e232a-251">This approach will simplify the code we need to write in the ASP.NET page code-behind class, since we don't have to bother with determining the current product's `UnitPrice`.</span></span>

<span data-ttu-id="e232a-252">`UpdateProduct`多載，如本教學課程中所示：</span><span class="sxs-lookup"><span data-stu-id="e232a-252">The `UpdateProduct` overload for this tutorial is shown below:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample8.cs)]

<span data-ttu-id="e232a-253">這個多載擷取指定的產品透過 DAL 的相關資訊`GetProductByProductID(productID)`方法。</span><span class="sxs-lookup"><span data-stu-id="e232a-253">This overload retrieves information about the specified product through the DAL's `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="e232a-254">然後它會檢查以查看是否的產品`UnitPrice`指派資料庫`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="e232a-254">It then checks to see whether the product's `UnitPrice` is assigned a database `NULL` value.</span></span> <span data-ttu-id="e232a-255">如果是，價格會保持不變。</span><span class="sxs-lookup"><span data-stu-id="e232a-255">If it is, the price is left unaltered.</span></span> <span data-ttu-id="e232a-256">如果，不過，有非`NULL``UnitPrice`值，這個方法會更新產品`UnitPrice`所指定的百分比 (`unitPriceAdjustmentPercent`)。</span><span class="sxs-lookup"><span data-stu-id="e232a-256">If, however, there is a non-`NULL` `UnitPrice` value, the method updates the product's `UnitPrice` by the specified percent (`unitPriceAdjustmentPercent`).</span></span>

## <a name="step-7-adding-the-increase-and-decrease-buttons-to-the-gridview"></a><span data-ttu-id="e232a-257">步驟 7：GridView 中加入增加和減少按鈕</span><span class="sxs-lookup"><span data-stu-id="e232a-257">Step 7: Adding the Increase and Decrease Buttons to the GridView</span></span>

<span data-ttu-id="e232a-258">GridView （和 DetailsView） 是兩組成欄位的集合。</span><span class="sxs-lookup"><span data-stu-id="e232a-258">The GridView (and DetailsView) are both made up of a collection of fields.</span></span> <span data-ttu-id="e232a-259">除了 BoundFields、 CheckBoxFields 和 TemplateFields，ASP.NET 會包含 ButtonField，其中，正如其名，會轉譯成與按鈕、 LinkButton 或 ImageButton 的資料行，每個資料列。</span><span class="sxs-lookup"><span data-stu-id="e232a-259">In addition to BoundFields, CheckBoxFields, and TemplateFields, ASP.NET includes the ButtonField, which, as its name implies, renders as a column with a Button, LinkButton, or ImageButton for each row.</span></span> <span data-ttu-id="e232a-260">類似於 FormView，按一下*任何*內 GridView 分頁按鈕、 編輯或刪除按鈕，排序按鈕和等等的按鈕會導致回傳，並引發 GridView [ `RowCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e232a-260">Similar to the FormView, clicking *any* button within the GridView paging buttons, Edit or Delete buttons, sorting buttons, and so on causes a postback and raises the GridView's [`RowCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx).</span></span>

<span data-ttu-id="e232a-261">具有 ButtonField`CommandName`屬性，將指定的值指派給每個其按鈕`CommandName`屬性。</span><span class="sxs-lookup"><span data-stu-id="e232a-261">The ButtonField has a `CommandName` property that assigns the specified value to each of its Buttons `CommandName` properties.</span></span> <span data-ttu-id="e232a-262">使用 FormView`CommandName`會使用值`RowCommand`事件處理常式，來判斷所按的按鈕。</span><span class="sxs-lookup"><span data-stu-id="e232a-262">Like with the FormView, the `CommandName` value is used by the `RowCommand` event handler to determine which button was clicked.</span></span>

<span data-ttu-id="e232a-263">讓我們加入兩個新 ButtonFields gridview 裡，有一個按鈕文字價格 + 10%，而另一個文字價格-10%。</span><span class="sxs-lookup"><span data-stu-id="e232a-263">Let's add two new ButtonFields to the GridView, one with a button text Price +10% and the other with the text Price -10%.</span></span> <span data-ttu-id="e232a-264">若要新增這些 ButtonFields，按一下 從 GridView 的智慧標籤的 編輯資料行 連結選取 ButtonField 欄位類型的清單中的左上方，按一下 新增 按鈕。</span><span class="sxs-lookup"><span data-stu-id="e232a-264">To add these ButtonFields, click on the Edit Columns link from the GridView's smart tag, select the ButtonField field type from the list in the upper left and click the Add button.</span></span>

![新增兩個 ButtonFields 至 GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image48.png)

<span data-ttu-id="e232a-266">**圖 18**:新增兩個 ButtonFields 至 GridView</span><span class="sxs-lookup"><span data-stu-id="e232a-266">**Figure 18**: Add Two ButtonFields to the GridView</span></span>

<span data-ttu-id="e232a-267">移動兩個 ButtonFields，使它們顯示為前兩個 GridView 欄位。</span><span class="sxs-lookup"><span data-stu-id="e232a-267">Move the two ButtonFields so that they appear as the first two GridView fields.</span></span> <span data-ttu-id="e232a-268">接下來，設定`Text`屬性，這些兩個 ButtonFields 價格 + 10%的價格介於-10%，`CommandName`屬性給 IncreasePrice 和 DecreasePrice，分別。</span><span class="sxs-lookup"><span data-stu-id="e232a-268">Next, set the `Text` properties of these two ButtonFields to Price +10% and Price -10% and the `CommandName` properties to IncreasePrice and DecreasePrice, respectively.</span></span> <span data-ttu-id="e232a-269">根據預設，ButtonField 會將其資料行的按鈕呈現為 Linkbutton。</span><span class="sxs-lookup"><span data-stu-id="e232a-269">By default, a ButtonField renders its column of buttons as LinkButtons.</span></span> <span data-ttu-id="e232a-270">這可以變更，不過，透過 ButtonField [ `ButtonType`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e232a-270">This can be changed, however, through the ButtonField's [`ButtonType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx).</span></span> <span data-ttu-id="e232a-271">讓我們以一般的推播按鈕; 呈現這些兩個 ButtonFields因此，設定`ButtonType`屬性設`Button`。</span><span class="sxs-lookup"><span data-stu-id="e232a-271">Let's have these two ButtonFields rendered as regular push buttons; therefore, set the `ButtonType` property to `Button`.</span></span> <span data-ttu-id="e232a-272">圖 19 顯示欄位 對話方塊中進行這些變更; 之後接著是 GridView 的宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="e232a-272">Figure 19 shows the Fields dialog box after these changes have been made; following that is the GridView's declarative markup.</span></span>

![設定 ButtonFields 文字、 CommandName、 和 ButtonType 屬性](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image49.png)

<span data-ttu-id="e232a-274">**圖 19**:設定 ButtonFields `Text`， `CommandName`，和`ButtonType`屬性</span><span class="sxs-lookup"><span data-stu-id="e232a-274">**Figure 19**: Configure the ButtonFields `Text`, `CommandName`, and `ButtonType` Properties</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample9.aspx)]

<span data-ttu-id="e232a-275">建立這些 ButtonFields，最後一個步驟是建立事件處理常式，如 GridView 的`RowCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="e232a-275">With these ButtonFields created, the final step is to create an event handler for the GridView's `RowCommand` event.</span></span> <span data-ttu-id="e232a-276">這個事件處理常式中引發，因為如果任一個價格 + 10%或價格-10%按鈕已按下，需求，來決定`ProductID`其按鈕已按下，然後叫用之資料列`ProductsBLL`類別的`UpdateProduct`方法並傳入適當`UnitPrice`連同百分比調整`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="e232a-276">This event handler, if fired because either the Price +10% or Price -10% buttons were clicked, needs to determine the `ProductID` for the row whose button was clicked and then invoke the `ProductsBLL` class's `UpdateProduct` method, passing in the appropriate `UnitPrice` percentage adjustment along with the `ProductID`.</span></span> <span data-ttu-id="e232a-277">下列程式碼會執行下列工作：</span><span class="sxs-lookup"><span data-stu-id="e232a-277">The following code performs these tasks:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample10.cs)]

<span data-ttu-id="e232a-278">若要判斷`ProductID`資料列的價格 + 10%或價格-10% 按鈕已按下，我們需要參考 GridView 的`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="e232a-278">In order to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we need to consult the GridView's `DataKeys` collection.</span></span> <span data-ttu-id="e232a-279">這個集合會保存欄位中指定的值`DataKeyNames`每個 GridView 資料列的屬性。</span><span class="sxs-lookup"><span data-stu-id="e232a-279">This collection holds the values of the fields specified in the `DataKeyNames` property for each GridView row.</span></span> <span data-ttu-id="e232a-280">因為 GridView`DataKeyNames`屬性設定為 ProductID 由 Visual Studio 時繫結至 GridView 的 ObjectDataSource`DataKeys(rowIndex).Value`提供`ProductID`指定*rowIndex*。</span><span class="sxs-lookup"><span data-stu-id="e232a-280">Since the GridView's `DataKeyNames` property was set to ProductID by Visual Studio when binding the ObjectDataSource to the GridView, `DataKeys(rowIndex).Value` provides the `ProductID` for the specified *rowIndex*.</span></span>

<span data-ttu-id="e232a-281">在自動傳遞 ButtonField *rowIndex*其按鈕已按下透過資料列的`e.CommandArgument`參數。</span><span class="sxs-lookup"><span data-stu-id="e232a-281">The ButtonField automatically passes in the *rowIndex* of the row whose button was clicked through the `e.CommandArgument` parameter.</span></span> <span data-ttu-id="e232a-282">因此，若要判斷`ProductID`資料列的價格 + 10%或價格-10% 按鈕已按下，我們使用： `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`。</span><span class="sxs-lookup"><span data-stu-id="e232a-282">Therefore, to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we use: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`.</span></span>

<span data-ttu-id="e232a-283">做為 [停止所有產品] 按鈕，如果您已停用 GridView 的檢視狀態，GridView 是正在重新繫結至基礎資料存放區在每次回傳中，與因此將立即更新以反映從按一下，就會發生的價格變更其中一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="e232a-283">As with the Discontinue All Products button, if you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect a price change that occurs from clicking either of the buttons.</span></span> <span data-ttu-id="e232a-284">如果，不過，您不停用檢視狀態，在 gridview 裡，您必須以手動方式將重新繫結至 GridView 資料之後進行這項變更。</span><span class="sxs-lookup"><span data-stu-id="e232a-284">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="e232a-285">若要這麼做，只對進行呼叫 GridView`DataBind()`方法叫用後，立即`UpdateProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="e232a-285">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `UpdateProduct` method.</span></span>

<span data-ttu-id="e232a-286">[圖 20] 顯示頁面檢視祖母 Kelly Homestead 所提供的產品時。</span><span class="sxs-lookup"><span data-stu-id="e232a-286">Figure 20 shows the page when viewing the products provided by Grandma Kelly's Homestead.</span></span> <span data-ttu-id="e232a-287">圖 21 顯示的結果之後價格 + 10%按鈕被按兩次的祖母的 Boysenberry 散佈和價格-10%按鈕一次的 Northwoods Cranberry 醬。</span><span class="sxs-lookup"><span data-stu-id="e232a-287">Figure 21 shows the results after the Price +10% button has been clicked twice for Grandma's Boysenberry Spread and the Price -10% button once for Northwoods Cranberry Sauce.</span></span>

<span data-ttu-id="e232a-288">[![GridView 包含價格 + 10%和價格-10%按鈕](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-288">[![The GridView Includes Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span></span>

<span data-ttu-id="e232a-289">**圖 20**:GridView 包含價格 + 10%和價格-10%按鈕 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-289">**Figure 20**: The GridView Includes Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png))</span></span>

<span data-ttu-id="e232a-290">[![已更新的第一個和第三個產品的價格透過價格 + 10%和價格-10%按鈕](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="e232a-290">[![The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span></span>

<span data-ttu-id="e232a-291">**圖 21**:第一個和第三個產品都已經透過價格 + 10 的價格 %和價格-10%按鈕 ([按一下以檢視完整大小的影像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="e232a-291">**Figure 21**: The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e232a-292">按鈕、 Linkbutton 或新增至其 TemplateFields ImageButtons，也可以有 GridView （和 DetailsView）。</span><span class="sxs-lookup"><span data-stu-id="e232a-292">The GridView (and DetailsView) can also have Buttons, LinkButtons, or ImageButtons added to their TemplateFields.</span></span> <span data-ttu-id="e232a-293">因為 BoundField 與這些按鈕，按一下時，會引發回傳，引發 GridView 的`RowCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="e232a-293">As with the BoundField, these Buttons, when clicked, will induce a postback, raising the GridView's `RowCommand` event.</span></span> <span data-ttu-id="e232a-294">當新增按鈕為 TemplateField，不過，按鈕的`CommandArgument`不會自動設定資料列的索引，即使用 ButtonFields 時。</span><span class="sxs-lookup"><span data-stu-id="e232a-294">When adding buttons in a TemplateField, however, the Button's `CommandArgument` is not automatically set to the index of the row as it is when using ButtonFields.</span></span> <span data-ttu-id="e232a-295">如果您需要決定內按下按鈕的資料列索引`RowCommand`事件處理常式，您必須以手動方式將按鈕的`CommandArgument`TemplateField，類似的程式碼中宣告式語法中的屬性：</span><span class="sxs-lookup"><span data-stu-id="e232a-295">If you need to determine the row index of the button that was clicked within the `RowCommand` event handler, you'll need to manually set the Button's `CommandArgument` property in its declarative syntax within the TemplateField, using code like:</span></span>  
> <span data-ttu-id="e232a-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`.</span><span class="sxs-lookup"><span data-stu-id="e232a-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`.</span></span>

## <a name="summary"></a><span data-ttu-id="e232a-297">總結</span><span class="sxs-lookup"><span data-stu-id="e232a-297">Summary</span></span>

<span data-ttu-id="e232a-298">所有的 GridView、 DetailsView 和 FormView 控制項可以包含按鈕、 Linkbutton 或 ImageButtons。</span><span class="sxs-lookup"><span data-stu-id="e232a-298">The GridView, DetailsView, and FormView controls all can include Buttons, LinkButtons, or ImageButtons.</span></span> <span data-ttu-id="e232a-299">這類的按鈕，按一下時，會造成回傳並引發`ItemCommand`FormView 和 DetailsView 控制項中的事件和`RowCommand`GridView 內的事件。</span><span class="sxs-lookup"><span data-stu-id="e232a-299">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event in the FormView and DetailsView controls and the `RowCommand` event in the GridView.</span></span> <span data-ttu-id="e232a-300">這些資料 Web 控制項有內建的功能，以處理一般與命令相關的動作，例如刪除或編輯記錄。</span><span class="sxs-lookup"><span data-stu-id="e232a-300">These data Web controls have built-in functionality to handle common command-related actions, such as deleting or editing records.</span></span> <span data-ttu-id="e232a-301">不過，我們也可以在使用按鈕，按下時，回應與執行自己的自訂程式碼。</span><span class="sxs-lookup"><span data-stu-id="e232a-301">However, we can also use buttons that, when clicked, respond with executing our own custom code.</span></span>

<span data-ttu-id="e232a-302">若要達成此目的，我們需要建立的事件處理常式`ItemCommand`或`RowCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="e232a-302">To accomplish this, we need to create an event handler for the `ItemCommand` or `RowCommand` event.</span></span> <span data-ttu-id="e232a-303">這個事件處理常式中，我們先檢查傳入`CommandName`判斷所按的按鈕，然後再採取適當的自訂動作的值。</span><span class="sxs-lookup"><span data-stu-id="e232a-303">In this event handler we first check the incoming `CommandName` value to determine which button was clicked and then take appropriate custom action.</span></span> <span data-ttu-id="e232a-304">在本教學課程中，我們看到如何使用按鈕和 ButtonFields 停止指定的供應商的所有產品，或以增加或減少 10%的特定產品的價格。</span><span class="sxs-lookup"><span data-stu-id="e232a-304">In this tutorial we saw how to use buttons and ButtonFields to discontinue all products for a specified supplier or to increase or decrease the price of a particular product by 10%.</span></span>

<span data-ttu-id="e232a-305">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="e232a-305">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e232a-306">關於作者</span><span class="sxs-lookup"><span data-stu-id="e232a-306">About the Author</span></span>

<span data-ttu-id="e232a-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="e232a-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e232a-308">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="e232a-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e232a-309">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="e232a-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e232a-310">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e232a-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e232a-311">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="e232a-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="e232a-312">下一步</span><span class="sxs-lookup"><span data-stu-id="e232a-312">Next</span></span>](adding-and-responding-to-buttons-to-a-gridview-vb.md)
