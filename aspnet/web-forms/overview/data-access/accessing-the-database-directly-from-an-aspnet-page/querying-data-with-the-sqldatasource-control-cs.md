---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-cs
title: 使用 SqlDataSource 控制項 (C#) 來查詢資料 |Microsoft Docs
author: rick-anderson
description: 在先前的教學課程中，我們會使用 ObjectDataSource 控制項將完全分開的資料存取層中的展示層。 開始此的老師...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 60512d6a-b572-4b7a-beb3-3e44b4d2020c
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-cs
msc.type: authoredcontent
ms.openlocfilehash: de0ad77967af2b1b7d6cca08a0c13df81a278091
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/06/2019
ms.locfileid: "65115009"
---
# <a name="querying-data-with-the-sqldatasource-control-c"></a><span data-ttu-id="42c86-104">使用 SqlDataSource 控制項查詢資料 (C#)</span><span class="sxs-lookup"><span data-stu-id="42c86-104">Querying Data with the SqlDataSource Control (C#)</span></span>

<span data-ttu-id="42c86-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="42c86-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="42c86-106">[下載範例應用程式](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_CS.exe)或[下載 PDF](querying-data-with-the-sqldatasource-control-cs/_static/datatutorial47cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="42c86-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_CS.exe) or [Download PDF](querying-data-with-the-sqldatasource-control-cs/_static/datatutorial47cs1.pdf)</span></span>

> <span data-ttu-id="42c86-107">在先前的教學課程中，我們會使用 ObjectDataSource 控制項將完全分開的資料存取層中的展示層。</span><span class="sxs-lookup"><span data-stu-id="42c86-107">In the preceding tutorials we used the ObjectDataSource control to fully separate the presentation layer from the Data Access layer.</span></span> <span data-ttu-id="42c86-108">我們開始本教學課程，了解，SqlDataSource 控制項如何用於簡單的應用程式不需要這類嚴格的分隔的簡報和資料存取。</span><span class="sxs-lookup"><span data-stu-id="42c86-108">Starting with this tutorial, we learn how the SqlDataSource control can be used for simple applications that do not require such a strict separation of presentation and data access.</span></span>

## <a name="introduction"></a><span data-ttu-id="42c86-109">簡介</span><span class="sxs-lookup"><span data-stu-id="42c86-109">Introduction</span></span>

<span data-ttu-id="42c86-110">所有教學課程，我們檢查到目前為止已使用簡報、 商務邏輯和資料存取層級所組成的階層式的架構。</span><span class="sxs-lookup"><span data-stu-id="42c86-110">All of the tutorials we ve examined so far have used a tiered architecture consisting of presentation, Business Logic, and Data Access layers.</span></span> <span data-ttu-id="42c86-111">在第一個教學課程中所製作的資料存取層 (DAL) ([建立資料存取層](../introduction/creating-a-data-access-layer-cs.md)) 和商務邏輯層，在第二個 ([建立商業邏輯層](../introduction/creating-a-business-logic-layer-cs.md))。</span><span class="sxs-lookup"><span data-stu-id="42c86-111">The Data Access Layer (DAL) was crafted in the first tutorial ([Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md)) and the Business Logic Layer in the second ([Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md)).</span></span> <span data-ttu-id="42c86-112">開頭[顯示的資料與 ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md)教學課程中，我們了解如何使用 ASP.NET 2.0 s 新 ObjectDataSource 控制項以宣告方式與從展示層架構的介面。</span><span class="sxs-lookup"><span data-stu-id="42c86-112">Starting with the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) tutorial, we saw how to use ASP.NET 2.0 s new ObjectDataSource control to declaratively interface with the architecture from the presentation layer.</span></span>

<span data-ttu-id="42c86-113">所有教學課程到目前為止已使用架構來處理資料，而它也可存取、 插入、 更新和刪除資料庫的資料直接從 ASP.NET 頁面，並略過架構。</span><span class="sxs-lookup"><span data-stu-id="42c86-113">While all of the tutorials so far have used the architecture to work with data, it is also possible to access, insert, update, and delete database data directly from an ASP.NET page, bypassing the architecture.</span></span> <span data-ttu-id="42c86-114">這樣會將特定的資料庫查詢和商務邏輯放直接在網頁中。</span><span class="sxs-lookup"><span data-stu-id="42c86-114">Doing so places the specific database queries and business logic directly in the web page.</span></span> <span data-ttu-id="42c86-115">夠大型或複雜的應用程式，設計、 實作和使用階層式的架構是非常重要的成功、 可更新性和可維護性應用程式。</span><span class="sxs-lookup"><span data-stu-id="42c86-115">For sufficiently large or complex applications, designing, implementing, and using a tiered architecture is vitally important for the success, updatability, and maintainability of the application.</span></span> <span data-ttu-id="42c86-116">開發強固的架構，不過，可能就不需要建立非常簡單的一次性應用程式時。</span><span class="sxs-lookup"><span data-stu-id="42c86-116">Developing a robust architecture, however, may be unnecessary when creating exceedingly simple, one-off applications.</span></span>

<span data-ttu-id="42c86-117">ASP.NET 2.0 提供五個內建的資料來源控制項[SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx)， [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx)， [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx)， [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx)，並[SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx)。</span><span class="sxs-lookup"><span data-stu-id="42c86-117">ASP.NET 2.0 provides five built-in data source controls [SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx), [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx), [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx), and [SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx).</span></span> <span data-ttu-id="42c86-118">SqlDataSource 可用來存取和修改資料直接從關聯式資料庫，包括 Microsoft SQL Server、 Microsoft Access、 Oracle、 MySQL 和其他項目。</span><span class="sxs-lookup"><span data-stu-id="42c86-118">The SqlDataSource can be used to access and modify data directly from a relational database, including Microsoft SQL Server, Microsoft Access, Oracle, MySQL, and others.</span></span> <span data-ttu-id="42c86-119">在本教學課程 和 下一步 的第三，我們將檢驗如何使用 SqlDataSource 控制項時，探索如何查詢和篩選資料庫資料，以及如何使用以 SqlDataSource 插入、 更新和刪除資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-119">In this tutorial and the next three, we'll examine how to work with the SqlDataSource control, exploring how to query and filter database data, as well as how to use the SqlDataSource to insert, update, and delete data.</span></span>

![ASP.NET 2.0 包含五個內建的資料來源控制項](querying-data-with-the-sqldatasource-control-cs/_static/image1.gif)

<span data-ttu-id="42c86-121">**圖 1**:ASP.NET 2.0 包含五個內建的資料來源控制項</span><span class="sxs-lookup"><span data-stu-id="42c86-121">**Figure 1**: ASP.NET 2.0 Includes Five Built-In Data Source Controls</span></span>

## <a name="comparing-the-objectdatasource-and-sqldatasource"></a><span data-ttu-id="42c86-122">比較 ObjectDataSource 和 SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="42c86-122">Comparing the ObjectDataSource and SqlDataSource</span></span>

<span data-ttu-id="42c86-123">就概念而言，ObjectDataSource 和 SqlDataSource 控制項都只是資料的 proxy。</span><span class="sxs-lookup"><span data-stu-id="42c86-123">Conceptually, both the ObjectDataSource and SqlDataSource controls are simply proxies to data.</span></span> <span data-ttu-id="42c86-124">中所述[顯示的資料與 ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md)教學課程中，ObjectDataSource 的屬性會指出物件類型，提供資料和方法來叫用來選取、 插入、 更新和刪除資料從基礎的物件型別。</span><span class="sxs-lookup"><span data-stu-id="42c86-124">As discussed in the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) tutorial, the ObjectDataSource has properties that indicate the object type that provides the data and the methods to invoke to select, insert, update, and delete data from the underlying object type.</span></span> <span data-ttu-id="42c86-125">資料 Web 控制項，例如 GridView、 DetailsView 或 DataList ObjectDataSource 的屬性已設定之後，可以繫結至控制項，使用 ObjectDataSource s `Select()`， `Insert()`， `Delete()`，和`Update()`方法如果需要互動的基礎架構。</span><span class="sxs-lookup"><span data-stu-id="42c86-125">Once the ObjectDataSource s properties have been configured, a data Web control such as a GridView, DetailsView, or DataList can be bound to the control, using the ObjectDataSource s `Select()`, `Insert()`, `Delete()`, and `Update()` methods to interact with the underlying architecture.</span></span>

<span data-ttu-id="42c86-126">SqlDataSource 提供相同的功能，但運作對關聯式資料庫，而不是物件程式庫。</span><span class="sxs-lookup"><span data-stu-id="42c86-126">The SqlDataSource provides the same functionality, but operates against a relational database rather than an object library.</span></span> <span data-ttu-id="42c86-127">使用 SqlDataSource，我們將必須指定資料庫連接字串和特定 SQL 查詢或預存程序，執行插入、 更新、 刪除和擷取資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-127">With the SqlDataSource, we must specify the database connection string and the ad-hoc SQL queries or stored procedures to execute to insert, update, delete, and retrieve data.</span></span> <span data-ttu-id="42c86-128">SqlDataSource s `Select()`， `Insert()`， `Update()`，和`Delete()`方法，叫用時，連接到指定的資料庫，並發出適當的 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="42c86-128">The SqlDataSource s `Select()`, `Insert()`, `Update()`, and `Delete()` methods, when invoked, connect to the specified database and issue the appropriate SQL query.</span></span> <span data-ttu-id="42c86-129">下圖所示，這些方法進行的連接至資料庫、 發出查詢，並傳回結果。</span><span class="sxs-lookup"><span data-stu-id="42c86-129">As the following diagram illustrates, the these methods do the grunt work of connecting to a database, issuing a query, and returning the results.</span></span>

![SqlDataSource 做為資料庫的 Proxy](querying-data-with-the-sqldatasource-control-cs/_static/image2.gif)

<span data-ttu-id="42c86-131">**圖 2**:SqlDataSource 做為資料庫的 Proxy</span><span class="sxs-lookup"><span data-stu-id="42c86-131">**Figure 2**: The SqlDataSource Serves as a Proxy to the Database</span></span>

> [!NOTE]
> <span data-ttu-id="42c86-132">在本教學課程中我們將焦點放在從資料庫擷取資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-132">In this tutorial we'll focus on retrieving data from the database.</span></span> <span data-ttu-id="42c86-133">在 [插入、 更新和刪除的資料，使用 SqlDataSource 控制項](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)教學課程中，我們會看到如何設定支援插入、 更新和刪除 SqlDataSource。</span><span class="sxs-lookup"><span data-stu-id="42c86-133">In the [Inserting, Updating, and Deleting Data with the SqlDataSource Control](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md) tutorial, we'll see how to configure the SqlDataSource to support inserting, updating, and deleting.</span></span>

## <a name="the-sqldatasource-and-accessdatasource-controls"></a><span data-ttu-id="42c86-134">SqlDataSource 和 AccessDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="42c86-134">The SqlDataSource and AccessDataSource Controls</span></span>

<span data-ttu-id="42c86-135">除了 SqlDataSource 控制項，ASP.NET 2.0 也包含 AccessDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="42c86-135">In addition to the SqlDataSource control, ASP.NET 2.0 also includes an AccessDataSource control.</span></span> <span data-ttu-id="42c86-136">這兩個不同控制項會導致許多開發人員為有疑問 AccessDataSource 控制項是以獨佔方式使用 Microsoft Access 使用 SqlDataSource 控制項以獨佔方式使用 Microsoft SQL Server 設計的 ASP.NET 2.0 新。</span><span class="sxs-lookup"><span data-stu-id="42c86-136">These two different controls lead many developers new to ASP.NET 2.0 to suspect that the AccessDataSource control is designed to work exclusively with Microsoft Access with the SqlDataSource control designed to work exclusively with Microsoft SQL Server.</span></span> <span data-ttu-id="42c86-137">雖然 AccessDataSource 設計來搭配 Microsoft Access 中，使用適用於 SqlDataSource 控制項*任何*關聯式資料庫，您可以透過.NET。</span><span class="sxs-lookup"><span data-stu-id="42c86-137">While the AccessDataSource is designed to work specifically with Microsoft Access, the SqlDataSource control works with *any* relational database that can be accessed through .NET.</span></span> <span data-ttu-id="42c86-138">這包括任何 OleDb 或 ODBC 相容資料存放區，例如 Microsoft SQL Server、 Microsoft Access、 Oracle、 Informix、 MySQL 和 PostgreSQL，還有其他更多。</span><span class="sxs-lookup"><span data-stu-id="42c86-138">This includes any OleDb- or ODBC-compliant data stores, such as Microsoft SQL Server, Microsoft Access, Oracle, Informix, MySQL, and PostgreSQL, among many others.</span></span>

<span data-ttu-id="42c86-139">AccessDataSource 和 SqlDataSource 控制項之間的唯一差異是指定的資料庫連線資訊的方式。</span><span class="sxs-lookup"><span data-stu-id="42c86-139">The sole difference between the AccessDataSource and SqlDataSource controls is how the database connection information is specified.</span></span> <span data-ttu-id="42c86-140">AccessDataSource 控制項必須只 Access 資料庫檔案的檔案路徑。</span><span class="sxs-lookup"><span data-stu-id="42c86-140">The AccessDataSource control needs just the file path to the Access database file.</span></span> <span data-ttu-id="42c86-141">SqlDataSource，相反地，需要完整的連接字串。</span><span class="sxs-lookup"><span data-stu-id="42c86-141">The SqlDataSource, on the other hand, requires a complete connection string.</span></span>

## <a name="step-1-creating-the-sqldatasource-web-pages"></a><span data-ttu-id="42c86-142">步驟 1：建立 SqlDataSource 網頁</span><span class="sxs-lookup"><span data-stu-id="42c86-142">Step 1: Creating the SqlDataSource Web Pages</span></span>

<span data-ttu-id="42c86-143">我們開始探索如何直接與資料庫資料使用 SqlDataSource 控制項之前，讓先花點時間，我們需要針對本教學課程和下列三個我們網站專案中建立 ASP.NET 網頁的 s。</span><span class="sxs-lookup"><span data-stu-id="42c86-143">Before we start exploring how to work directly with database data using the SqlDataSource control, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="42c86-144">藉由新增新的資料夾，名為啟動`SqlDataSource`。</span><span class="sxs-lookup"><span data-stu-id="42c86-144">Start by adding a new folder named `SqlDataSource`.</span></span> <span data-ttu-id="42c86-145">接下來，新增到該資料夾，並確認其關聯與每個頁面的 下列 ASP.NET 網頁`Site.master`主版頁面：</span><span class="sxs-lookup"><span data-stu-id="42c86-145">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Querying.aspx`
- `ParameterizedQueries.aspx`
- `InsertUpdateDelete.aspx`
- `OptimisticConcurrency.aspx`

![加入 ASP.NET 網頁，如 SqlDataSource 與相關的教學課程](querying-data-with-the-sqldatasource-control-cs/_static/image3.gif)

<span data-ttu-id="42c86-147">**圖 3**:加入 ASP.NET 網頁，如 SqlDataSource 與相關的教學課程</span><span class="sxs-lookup"><span data-stu-id="42c86-147">**Figure 3**: Add the ASP.NET Pages for the SqlDataSource-Related Tutorials</span></span>

<span data-ttu-id="42c86-148">在其他資料夾，例如`Default.aspx`在`SqlDataSource`資料夾會列出其一節中的教學課程。</span><span class="sxs-lookup"><span data-stu-id="42c86-148">Like in the other folders, `Default.aspx` in the `SqlDataSource` folder will list the tutorials in its section.</span></span> <span data-ttu-id="42c86-149">請記得，`SectionLevelTutorialListing.ascx`使用者控制項提供這項功能。</span><span class="sxs-lookup"><span data-stu-id="42c86-149">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="42c86-150">因此，新增此使用者控制項`Default.aspx`從拖曳到頁面的設計 檢視中的 方案總管 中拖曳。</span><span class="sxs-lookup"><span data-stu-id="42c86-150">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="42c86-151">[![將 SectionLevelTutorialListing.ascx 使用者控制項新增至 Default.aspx](querying-data-with-the-sqldatasource-control-cs/_static/image5.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image4.gif)</span><span class="sxs-lookup"><span data-stu-id="42c86-151">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](querying-data-with-the-sqldatasource-control-cs/_static/image5.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image4.gif)</span></span>

<span data-ttu-id="42c86-152">**圖 4**:新增`SectionLevelTutorialListing.ascx`使用者控制項`Default.aspx`([按一下以檢視完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image6.gif))</span><span class="sxs-lookup"><span data-stu-id="42c86-152">**Figure 4**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image6.gif))</span></span>

<span data-ttu-id="42c86-153">最後，將這些四個頁面新增項目為`Web.sitemap`檔案。</span><span class="sxs-lookup"><span data-stu-id="42c86-153">Lastly, add these four pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="42c86-154">具體來說，加入下列標記之後新增自訂按鈕 DataList 與重複項`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="42c86-154">Specifically, add the following markup after the Adding Custom Buttons to the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample1.sql)]

<span data-ttu-id="42c86-155">在更新之後`Web.sitemap`，花點時間檢視教學課程網站，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="42c86-155">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="42c86-156">在左側功能表現在包含編輯、 插入及刪除教學課程的項目。</span><span class="sxs-lookup"><span data-stu-id="42c86-156">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![網站導覽現在包含項目，如 SqlDataSource 教學課程](querying-data-with-the-sqldatasource-control-cs/_static/image7.gif)

<span data-ttu-id="42c86-158">**圖 5**:網站導覽現在包含項目，如 SqlDataSource 教學課程</span><span class="sxs-lookup"><span data-stu-id="42c86-158">**Figure 5**: The Site Map Now Includes Entries for the SqlDataSource Tutorials</span></span>

## <a name="step-2-adding-and-configuring-the-sqldatasource-control"></a><span data-ttu-id="42c86-159">步驟 2：加入和設定 SqlDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="42c86-159">Step 2: Adding and Configuring the SqlDataSource Control</span></span>

<span data-ttu-id="42c86-160">首先開啟`Querying.aspx`頁面中`SqlDataSource`資料夾，然後切換到設計檢視。</span><span class="sxs-lookup"><span data-stu-id="42c86-160">Start by opening the `Querying.aspx` page in the `SqlDataSource` folder and switch to Design view.</span></span> <span data-ttu-id="42c86-161">將 SqlDataSource 控制項從工具箱拖曳至設計工具和設定其`ID`至`ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="42c86-161">Drag a SqlDataSource control from the Toolbox onto the Designer and set its `ID` to `ProductsDataSource`.</span></span> <span data-ttu-id="42c86-162">如同 ObjectDataSource、 SqlDataSource 不會產生任何呈現的輸出，並因此會顯示為設計介面上的灰色方塊。</span><span class="sxs-lookup"><span data-stu-id="42c86-162">As with the ObjectDataSource, the SqlDataSource does not produce any rendered output and therefore appears as a gray box on the design surface.</span></span> <span data-ttu-id="42c86-163">若要設定 SqlDataSource，按一下 從 SqlDataSource s 智慧標籤的 設定資料來源 連結。</span><span class="sxs-lookup"><span data-stu-id="42c86-163">To configure the SqlDataSource, click on the Configure Data Source link from the SqlDataSource s smart tag.</span></span>

![按一下 設定從 SqlDataSource s 智慧標籤的資料來源連結](querying-data-with-the-sqldatasource-control-cs/_static/image8.gif)

<span data-ttu-id="42c86-165">**圖 6**:按一下 設定從 SqlDataSource s 智慧標籤的資料來源連結</span><span class="sxs-lookup"><span data-stu-id="42c86-165">**Figure 6**: Click on the Configure Data Source Link from the SqlDataSource s Smart Tag</span></span>

<span data-ttu-id="42c86-166">這會顯示 [SqlDataSource 控制項 s 設定資料來源精靈]。</span><span class="sxs-lookup"><span data-stu-id="42c86-166">This brings up the SqlDataSource control s Configure Data Source wizard.</span></span> <span data-ttu-id="42c86-167">雖然精靈 s 中的步驟有不同從 ObjectDataSource 控制項 s，但最終目的是相同，以提供有關如何擷取、 插入、 更新和刪除資料來源中的資料的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-167">While the wizard s steps differ from the ObjectDataSource control s, the end goal is the same to provide the details on how to retrieve, insert, update, and delete data through the data source.</span></span> <span data-ttu-id="42c86-168">如 SqlDataSource 這需要指定要使用的基礎資料庫，並提供特定 SQL 陳述式或預存程序。</span><span class="sxs-lookup"><span data-stu-id="42c86-168">For the SqlDataSource this entails specifying the underlying database to use and providing the ad-hoc SQL statements or stored procedures.</span></span>

<span data-ttu-id="42c86-169">第一個步驟中，精靈會提示我們輸入的資料庫。</span><span class="sxs-lookup"><span data-stu-id="42c86-169">The first wizard step prompts us for the database.</span></span> <span data-ttu-id="42c86-170">下拉式清單包含在 s 中的 web 應用程式中找到這些資料庫`App_Data`資料夾以及已加入至伺服器總管 中的 資料連線 節點。</span><span class="sxs-lookup"><span data-stu-id="42c86-170">The drop-down list includes those databases found in the web application s `App_Data` folder and those that have been added to the Data Connections node in the Server Explorer.</span></span> <span data-ttu-id="42c86-171">因為我們已已經新增的連接字串`NORTHWIND.MDF`資料庫中`App_Data`s 專案的資料夾`Web.config`檔案，下拉式清單包含該連接字串中，參考`NORTHWINDConnectionString`。</span><span class="sxs-lookup"><span data-stu-id="42c86-171">Since we ve already added a connection string for the `NORTHWIND.MDF` database in the `App_Data` folder to our project s `Web.config` file, the drop-down list includes a reference to that connection string, `NORTHWINDConnectionString`.</span></span> <span data-ttu-id="42c86-172">從下拉式清單中選擇此項目，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="42c86-172">Choose this item from the drop-down list and click Next.</span></span>

![從下拉式清單中選擇 NORTHWINDConnectionString](querying-data-with-the-sqldatasource-control-cs/_static/image9.gif)

<span data-ttu-id="42c86-174">**圖 7**:選擇`NORTHWINDConnectionString`從下拉式清單</span><span class="sxs-lookup"><span data-stu-id="42c86-174">**Figure 7**: Choose the `NORTHWINDConnectionString` from the Drop-Down List</span></span>

<span data-ttu-id="42c86-175">選擇之後的資料庫，精靈會要求查詢傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-175">After choosing the database, the wizard asks for the query to return data.</span></span> <span data-ttu-id="42c86-176">我們可以指定資料表或檢視，以傳回，或可以輸入自訂的 SQL 陳述式或指定預存程序的資料行。</span><span class="sxs-lookup"><span data-stu-id="42c86-176">We can either specify the columns of a table or view to return or can enter a custom SQL statement or specify a stored procedure.</span></span> <span data-ttu-id="42c86-177">您可以切換到 指定此選項，自訂的 SQL 陳述式或預存程序和資料表中的指定資料行，或檢視的選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="42c86-177">You can toggle between this choice through the Specify a custom SQL statement or stored procedure and Specify columns from a table or view radio buttons.</span></span>

> [!NOTE]
> <span data-ttu-id="42c86-178">這個範例來說，可讓使用資料表或檢視表選項指定的資料行的 s。</span><span class="sxs-lookup"><span data-stu-id="42c86-178">For this first example, let s use the Specify columns from a table or view option.</span></span> <span data-ttu-id="42c86-179">我們將會回到精靈，稍後在本教學課程，並探索指定的自訂 SQL 陳述式或預存程序選項。</span><span class="sxs-lookup"><span data-stu-id="42c86-179">We'll return to the wizard later in this tutorial and explore the Specify a custom SQL statement or stored procedure option.</span></span>

<span data-ttu-id="42c86-180">圖 8 顯示 設定 Select 陳述式螢幕時指定的資料行從資料表或檢視表選項按鈕已選取。</span><span class="sxs-lookup"><span data-stu-id="42c86-180">Figure 8 shows the Configure the Select Statement screen when the Specify columns from a table or view radio button is selected.</span></span> <span data-ttu-id="42c86-181">下拉式清單包含資料表和檢視表，在 Northwind 資料庫中，使用選取的資料表或檢視表 s 資料行下方的核取方塊清單中顯示的集合。</span><span class="sxs-lookup"><span data-stu-id="42c86-181">The drop-down list contains the set of tables and views in the Northwind database, with the selected table or view s columns displayed in the checkbox list below.</span></span> <span data-ttu-id="42c86-182">對於此範例中，可讓 s 會傳回`ProductID`， `ProductName`，並`UnitPrice`中的資料行`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="42c86-182">For this example, let s return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table.</span></span> <span data-ttu-id="42c86-183">如 [圖 8 所示，讓這些選取項目精靈] 會顯示產生的 SQL 陳述式之後`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`。</span><span class="sxs-lookup"><span data-stu-id="42c86-183">As Figure 8 shows, after making these selections the wizard shows the resulting SQL statement `SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`.</span></span>

![從 Products 資料表傳回資料](querying-data-with-the-sqldatasource-control-cs/_static/image10.gif)

<span data-ttu-id="42c86-185">**圖 8**:傳回資料來源`Products`資料表</span><span class="sxs-lookup"><span data-stu-id="42c86-185">**Figure 8**: Return Data from the `Products` Table</span></span>

<span data-ttu-id="42c86-186">一旦您已設定要傳回精靈`ProductID`， `ProductName`，並`UnitPrice`中的資料行`Products`資料表中，按一下 [下一步] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="42c86-186">Once you have configured the wizard to return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table, click the Next button.</span></span> <span data-ttu-id="42c86-187">此最後一個畫面會提供要檢查的上一個步驟所設定的查詢結果的機會。</span><span class="sxs-lookup"><span data-stu-id="42c86-187">This final screen provides an opportunity to examine the results of the query configured from the previous step.</span></span> <span data-ttu-id="42c86-188">按一下 [測試查詢] 按鈕執行設定`SELECT`陳述式，並顯示在方格中的結果。</span><span class="sxs-lookup"><span data-stu-id="42c86-188">Clicking the Test Query button executes the configured `SELECT` statement and displays the results in a grid.</span></span>

![按一下 [測試查詢] 按鈕，檢閱您選取的查詢](querying-data-with-the-sqldatasource-control-cs/_static/image11.gif)

<span data-ttu-id="42c86-190">**圖 9**:按一下 測試查詢 按鈕，檢閱您`SELECT`查詢</span><span class="sxs-lookup"><span data-stu-id="42c86-190">**Figure 9**: Click the Test Query Button to Review Your `SELECT` Query</span></span>

<span data-ttu-id="42c86-191">若要完成精靈，按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="42c86-191">To complete the wizard, click Finish.</span></span>

<span data-ttu-id="42c86-192">使用 ObjectDataSource、 SqlDataSource 的精靈只是將值指派給控制項 s 的屬性，也就是像[ `ConnectionString` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx)並[ `SelectCommand` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx)屬性。</span><span class="sxs-lookup"><span data-stu-id="42c86-192">Like with the ObjectDataSource, the SqlDataSource s wizard merely assigns values to the control s properties, namely the [`ConnectionString`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx) and [`SelectCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx) properties.</span></span> <span data-ttu-id="42c86-193">完成精靈之後，您 SqlDataSource 控制項 s 宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="42c86-193">After completing the wizard, your SqlDataSource control s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample2.aspx)]

<span data-ttu-id="42c86-194">`ConnectionString`屬性會提供有關如何連接到資料庫的資訊。</span><span class="sxs-lookup"><span data-stu-id="42c86-194">The `ConnectionString` property provides information on how to connect to the database.</span></span> <span data-ttu-id="42c86-195">此屬性指派或可以是完整的硬式編碼的連接字串值中的連接字串可以指向`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="42c86-195">This property can be assigned a complete, hard-coded connection string value or can point to a connection string in `Web.config`.</span></span> <span data-ttu-id="42c86-196">若要參考的 Web.config 中的連接字串值，請使用語法`<%$ expressionPrefix:expressionValue %>`。</span><span class="sxs-lookup"><span data-stu-id="42c86-196">To reference a connection string value in Web.config, use the syntax `<%$ expressionPrefix:expressionValue %>`.</span></span> <span data-ttu-id="42c86-197">通常*expressionPrefix*是 ConnectionStrings 並*expressionValue*中的連接字串的名稱`Web.config` [ `<connectionStrings>`區段](https://msdn.microsoft.com/library/bf7sd233.aspx)。</span><span class="sxs-lookup"><span data-stu-id="42c86-197">Typically, *expressionPrefix* is ConnectionStrings and *expressionValue* is the name of the connect string in the `Web.config` [`<connectionStrings>` section](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="42c86-198">不過，可以使用語法來參考`<appSettings>`項目或從資源檔的內容。</span><span class="sxs-lookup"><span data-stu-id="42c86-198">However, the syntax can be used to reference `<appSettings>` elements or content from resource files.</span></span> <span data-ttu-id="42c86-199">請參閱[ASP.NET 運算式概觀](https://msdn.microsoft.com/library/d5bd1tad.aspx)如需此語法的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="42c86-199">See [ASP.NET Expressions Overview](https://msdn.microsoft.com/library/d5bd1tad.aspx) for more on this syntax.</span></span>

<span data-ttu-id="42c86-200">`SelectCommand`屬性會指定特定 SQL 陳述式或預存程序會一直執行到傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-200">The `SelectCommand` property specifies the ad-hoc SQL statement or stored procedure to execute to return the data.</span></span>

## <a name="step-3-adding-a-data-web-control-and-binding-it-to-the-sqldatasource"></a><span data-ttu-id="42c86-201">步驟 3：加入資料 Web 控制項和繫結至 SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="42c86-201">Step 3: Adding a Data Web Control and Binding it to the SqlDataSource</span></span>

<span data-ttu-id="42c86-202">設定 SqlDataSource 之後, 可以繫結至資料 Web 控制項，例如 GridView 或 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="42c86-202">Once the SqlDataSource has been configured, it can be bound to a data Web control, such as a GridView or DetailsView.</span></span> <span data-ttu-id="42c86-203">本教學課程中，可讓 s GridView 中顯示的資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-203">For this tutorial, let s display the data in a GridView.</span></span> <span data-ttu-id="42c86-204">從 工具箱 拖曳到頁面的 GridView，並繫結至`ProductsDataSource`SqlDataSource 資料來源清單中選擇下拉式清單中的 GridView s 智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="42c86-204">From the Toolbox, drag a GridView onto the page and bind it to the `ProductsDataSource` SqlDataSource by choosing the data source from the drop-down list in the GridView s smart tag.</span></span>

<span data-ttu-id="42c86-205">[![新增 GridView，並將它繫結至 SqlDataSource 控制項](querying-data-with-the-sqldatasource-control-cs/_static/image13.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image12.gif)</span><span class="sxs-lookup"><span data-stu-id="42c86-205">[![Add a GridView and Bind it to the SqlDataSource Control](querying-data-with-the-sqldatasource-control-cs/_static/image13.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image12.gif)</span></span>

<span data-ttu-id="42c86-206">**圖 10**:新增 GridView，並將它繫結至 SqlDataSource 控制項 ([按一下以檢視完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image14.gif))</span><span class="sxs-lookup"><span data-stu-id="42c86-206">**Figure 10**: Add a GridView and Bind it to the SqlDataSource Control ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image14.gif))</span></span>

<span data-ttu-id="42c86-207">一旦您已選取 SqlDataSource 控制項，從下拉式清單中的 GridView s 智慧標籤，Visual Studio 會自動加入 BoundField 或 CheckBoxField 至 GridView 針對每個資料來源控制項所傳回的資料行。</span><span class="sxs-lookup"><span data-stu-id="42c86-207">Once you ve selected the SqlDataSource control from the drop-down list in the GridView s smart tag, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the columns returned by the data source control.</span></span> <span data-ttu-id="42c86-208">由於 SqlDataSource 會傳回三個資料庫資料行`ProductID`， `ProductName`，和`UnitPrice`GridView 裡有三個欄位。</span><span class="sxs-lookup"><span data-stu-id="42c86-208">Since the SqlDataSource returns three database columns `ProductID`, `ProductName`, and `UnitPrice` there are three fields in the GridView.</span></span>

<span data-ttu-id="42c86-209">請花一點時間設定 GridView 三 BoundFields。</span><span class="sxs-lookup"><span data-stu-id="42c86-209">Take a moment to configure the GridView s three BoundFields.</span></span> <span data-ttu-id="42c86-210">變更`ProductName`欄位 s`HeaderText`產品名稱的屬性和`UnitPrice`價格欄位 s。</span><span class="sxs-lookup"><span data-stu-id="42c86-210">Change the `ProductName` field s `HeaderText` property to Product Name and the `UnitPrice` field s to Price.</span></span> <span data-ttu-id="42c86-211">也會格式化`UnitPrice`欄位做為貨幣。</span><span class="sxs-lookup"><span data-stu-id="42c86-211">Also format the `UnitPrice` field as a currency.</span></span> <span data-ttu-id="42c86-212">進行這些修改之後, 您 GridView s 宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="42c86-212">After making these modifications, your GridView s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample3.aspx)]

<span data-ttu-id="42c86-213">請瀏覽此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="42c86-213">Visit this page through a browser.</span></span> <span data-ttu-id="42c86-214">GridView 如 [圖 11] 所示，列出每項產品 s `ProductID`， `ProductName`，和`UnitPrice`值。</span><span class="sxs-lookup"><span data-stu-id="42c86-214">As Figure 11 shows, the GridView lists each product s `ProductID`, `ProductName`, and `UnitPrice` values.</span></span>

<span data-ttu-id="42c86-215">[![GridView 會顯示每個產品的 ProductID、 ProductName、 以及 UnitPrice 值](querying-data-with-the-sqldatasource-control-cs/_static/image16.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="42c86-215">[![The GridView Displays Each Product s ProductID, ProductName, and UnitPrice Values](querying-data-with-the-sqldatasource-control-cs/_static/image16.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image15.gif)</span></span>

<span data-ttu-id="42c86-216">**圖 11**:GridView 會顯示每個產品 s `ProductID`， `ProductName`，並`UnitPrice`值 ([按一下以檢視完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="42c86-216">**Figure 11**: The GridView Displays Each Product s `ProductID`, `ProductName`, and `UnitPrice` Values ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image17.gif))</span></span>

<span data-ttu-id="42c86-217">當瀏覽的頁面 GridView 會叫用其資料來源控制項的`Select()`方法。</span><span class="sxs-lookup"><span data-stu-id="42c86-217">When the page is visited the GridView invokes its data source control s `Select()` method.</span></span> <span data-ttu-id="42c86-218">當我們使用 ObjectDataSource 控制項時，這叫做`ProductsBLL`類別的`GetProducts()`方法。</span><span class="sxs-lookup"><span data-stu-id="42c86-218">When we were using the ObjectDataSource control, this called the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="42c86-219">使用 SqlDataSource，不過，`Select()`方法會連線到指定的資料庫和問題`SelectCommand`(`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`，在此範例中)。</span><span class="sxs-lookup"><span data-stu-id="42c86-219">With the SqlDataSource, however, the `Select()` method establishes a connection to the specified database and issues the `SelectCommand` (`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`, in this example).</span></span> <span data-ttu-id="42c86-220">SqlDataSource 傳回它 GridView 然後列舉，傳回每個資料庫記錄的 GridView 裡建立一個資料列的結果。</span><span class="sxs-lookup"><span data-stu-id="42c86-220">The SqlDataSource returns its results which the GridView then enumerates, creating a row in the GridView for each database record returned.</span></span>

## <a name="the-built-in-data-web-control-features-and-the-sqldatasource-control"></a><span data-ttu-id="42c86-221">內建資料 Web 控制項功能和 SqlDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="42c86-221">The Built-In Data Web Control Features and the SqlDataSource Control</span></span>

<span data-ttu-id="42c86-222">一般而言，資料 Web 控制項分頁、 排序、 編輯、 固有的功能刪除、 插入及等等特有資料 Web 控制項，並不依賴使用資料來源控制項。</span><span class="sxs-lookup"><span data-stu-id="42c86-222">In general, the features inherent to the data Web controls paging, sorting, editing, deleting, inserting, and so on are specific to the data Web control and are not dependent on the data source control used.</span></span> <span data-ttu-id="42c86-223">也就是 GridView 可以利用內建的分頁、 排序、 編輯和刪除是否 ObjectDataSource 或 SqlDataSource 繫結。</span><span class="sxs-lookup"><span data-stu-id="42c86-223">That is, the GridView can utilize its built-in paging, sorting, editing, and deleting whether it is bound to an ObjectDataSource or a SqlDataSource.</span></span> <span data-ttu-id="42c86-224">不過，某些資料 Web 控制項的功能是敏感性資料來源控制項所使用或資料來源控制項的組態。</span><span class="sxs-lookup"><span data-stu-id="42c86-224">However, certain data Web control features are sensitive to the data source control being used or to the data source control s configuration.</span></span>

<span data-ttu-id="42c86-225">例如，在[有效率地透過大型數量的資料分頁](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)我們討論過，根據預設，分頁邏輯資料 Web 控制項如何這個傳回的教學課程*所有*記錄的基礎資料來源，並接著會顯示指定目前的頁面索引和每頁顯示的記錄數目的記錄中的適當子集合。</span><span class="sxs-lookup"><span data-stu-id="42c86-225">For example, in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial we discussed how, by default, the paging logic for the data Web controls naively returns *all* records from the underlying data source and then displays only the appropriate subset of records given the current page index and the number of records to display per page.</span></span> <span data-ttu-id="42c86-226">逐頁查看夠大的結果集時，此模型的效率。</span><span class="sxs-lookup"><span data-stu-id="42c86-226">This model is highly inefficient when paging through sufficiently large result sets.</span></span> <span data-ttu-id="42c86-227">幸運的是，ObjectDataSource 可以設定為支援自訂分頁時，它會傳回只顯示記錄的精確子集。</span><span class="sxs-lookup"><span data-stu-id="42c86-227">Fortunately, the ObjectDataSource can be configured to support custom paging, which returns only the precise subset of records to display.</span></span> <span data-ttu-id="42c86-228">SqlDataSource 控制項，不過，不會實作自訂分頁的屬性。</span><span class="sxs-lookup"><span data-stu-id="42c86-228">The SqlDataSource control, however, lacks the properties for implementing custom paging.</span></span>

<span data-ttu-id="42c86-229">使用 SqlDataSource，就會發生另一個微妙的地方使用分頁和排序。</span><span class="sxs-lookup"><span data-stu-id="42c86-229">Another subtlety with paging and sorting arises with the SqlDataSource.</span></span> <span data-ttu-id="42c86-230">根據預設，可以是分頁或排序 GridView 透過從 SqlDataSource 傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-230">By default, the data returned from a SqlDataSource can be paged or sorted through the GridView.</span></span> <span data-ttu-id="42c86-231">若要示範這種情況，請檢查在 GridView 的 s 智慧標籤中啟用分頁，並啟用排序選項`Querying.aspx`並確認其運作如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="42c86-231">To demonstrate this, check the Enable Paging and Enable Sorting options in the GridView s smart tag in `Querying.aspx` and verify that this works as expected.</span></span>

<span data-ttu-id="42c86-232">排序和分頁作用，因為 SqlDataSource 至鬆散型別資料集擷取的資料庫資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-232">Sorting and paging works because the SqlDataSource retrieves the database data into a loosely-typed DataSet.</span></span> <span data-ttu-id="42c86-233">從資料集，可以確定查詢所傳回的一個關鍵要素，以實作分頁的記錄總數。</span><span class="sxs-lookup"><span data-stu-id="42c86-233">The total number of records returned by the query an essential aspect to implementing paging can be ascertained from the DataSet.</span></span> <span data-ttu-id="42c86-234">此外，資料集的結果可以透過 DataView 進行排序。</span><span class="sxs-lookup"><span data-stu-id="42c86-234">Additionally, the DataSet s results can be sorted through a DataView.</span></span> <span data-ttu-id="42c86-235">這些功能會自動使用 SqlDataSource GridView 要求分頁或排序資料時。</span><span class="sxs-lookup"><span data-stu-id="42c86-235">These capabilities are automatically used by the SqlDataSource when the GridView requests paged or sorted data.</span></span>

<span data-ttu-id="42c86-236">可以設定 SqlDataSource 傳回 DataReader 而不是資料集，藉由變更其[`DataSourceMode`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx)從`DataSet`（預設值） 到`DataReader`。</span><span class="sxs-lookup"><span data-stu-id="42c86-236">The SqlDataSource can be configured to return a DataReader instead of a DataSet by changing its [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx) from `DataSet` (the default) to `DataReader`.</span></span> <span data-ttu-id="42c86-237">使用 DataReader 可能會偏好的情況下將 SqlDataSource 的結果傳遞至預期 DataReader 的現有程式碼時。</span><span class="sxs-lookup"><span data-stu-id="42c86-237">Using a DataReader might be preferred in situations when passing the SqlDataSource s results to existing code that expects a DataReader.</span></span> <span data-ttu-id="42c86-238">此外，由於 DataReaders 是相當簡單的物件與資料集，其可提供較佳的效能。</span><span class="sxs-lookup"><span data-stu-id="42c86-238">Furthermore, since DataReaders are considerably simpler objects than DataSets, they offer better performance.</span></span> <span data-ttu-id="42c86-239">如果您進行這項變更，不過，都可以排序資料 Web 控制項，也因為 SqlDataSource 無法確定查詢中，傳回多少筆記錄，也不會 DataReader 的頁面會提供任何技術來排序傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-239">If you make this change, however, the data Web control can neither sort nor page since the SqlDataSource cannot ascertain how many records are returned by the query, nor does the DataReader offer any techniques for sorting the returned data.</span></span>

## <a name="step-4-using-a-custom-sql-statement-or-stored-procedure"></a><span data-ttu-id="42c86-240">步驟 4：使用自訂 SQL 陳述式或預存程序</span><span class="sxs-lookup"><span data-stu-id="42c86-240">Step 4: Using a Custom SQL Statement or Stored Procedure</span></span>

<span data-ttu-id="42c86-241">當設定 SqlDataSource 控制項，用來傳回資料的查詢可以指定兩種方法之一，為自訂的 SQL 陳述式或預存程序，或從現有的資料表或檢視的資料行。</span><span class="sxs-lookup"><span data-stu-id="42c86-241">When configuring the SqlDataSource control, the query used to return data can be specified in one of two approaches as a custom SQL statement or stored procedure, or as columns from an existing table or view.</span></span> <span data-ttu-id="42c86-242">在步驟 2 中，我們檢查選取的資料行`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="42c86-242">In Step 2 we examined selecting columns from the `Products` table.</span></span> <span data-ttu-id="42c86-243">可讓 s 探討使用自訂的 SQL 陳述式。</span><span class="sxs-lookup"><span data-stu-id="42c86-243">Let s look at using a custom SQL statement.</span></span>

<span data-ttu-id="42c86-244">新增另一個 GridView 控制項`Querying.aspx`頁面上，然後選擇 建立新的資料來源，從下拉式清單中的智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="42c86-244">Add another GridView control to the `Querying.aspx` page and choose to create a new data source from the drop-down list in the smart tag.</span></span> <span data-ttu-id="42c86-245">接下來，表示該資料就會提取從資料庫這會建立新的 SqlDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="42c86-245">Next, indicate that the data will be pulled from a database this will create a new SqlDataSource control.</span></span> <span data-ttu-id="42c86-246">將控制項`ProductsWithCategoryInfoDataSource`。</span><span class="sxs-lookup"><span data-stu-id="42c86-246">Name the control `ProductsWithCategoryInfoDataSource`.</span></span>

![建立新的 SqlDataSource 控制項，名為 ProductsWithCategoryInfoDataSource](querying-data-with-the-sqldatasource-control-cs/_static/image18.gif)

<span data-ttu-id="42c86-248">**圖 12**:建立新的 SqlDataSource 控制項，名為 `ProductsWithCategoryInfoDataSource`</span><span class="sxs-lookup"><span data-stu-id="42c86-248">**Figure 12**: Create a New SqlDataSource Control Named `ProductsWithCategoryInfoDataSource`</span></span>

<span data-ttu-id="42c86-249">下一個畫面會要求我們指定的資料庫。</span><span class="sxs-lookup"><span data-stu-id="42c86-249">The next screen asks us to specify the database.</span></span> <span data-ttu-id="42c86-250">我們在上一步圖 7 中選取`NORTHWINDConnectionString`從下拉式清單，然後按一下 下一步。</span><span class="sxs-lookup"><span data-stu-id="42c86-250">As we did back in Figure 7, select the `NORTHWINDConnectionString` from the drop-down list and click Next.</span></span> <span data-ttu-id="42c86-251">在 [設定 Select 陳述式] 畫面中，選擇指定自訂 SQL 陳述式或預存程序選項按鈕，按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="42c86-251">In the Configure the Select Statement screen, choose the Specify a custom SQL statement or stored procedure radio button and click Next.</span></span> <span data-ttu-id="42c86-252">這會顯示定義自訂陳述式或預存程序 」 畫面，可提供標示為 SELECT、 UPDATE、 INSERT 和 DELETE 的索引標籤。</span><span class="sxs-lookup"><span data-stu-id="42c86-252">This will bring up the Define Custom Statements or Stored Procedures screen, which offers tabs labeled SELECT, UPDATE, INSERT, and DELETE.</span></span> <span data-ttu-id="42c86-253">在每個索引標籤中，您可以在文字方塊中輸入自訂的 SQL 陳述式或從下拉式清單中選擇 預存程序。</span><span class="sxs-lookup"><span data-stu-id="42c86-253">In each tab you can enter a custom SQL statement into the textbox or choose a stored procedure from the drop-down list.</span></span> <span data-ttu-id="42c86-254">在本教學課程會探討輸入自訂的 SQL 陳述式：下一個教學課程包含使用預存程序的範例。</span><span class="sxs-lookup"><span data-stu-id="42c86-254">In this tutorial we will look at entering a custom SQL statement; the next tutorial includes an example that uses a stored procedure.</span></span>

![輸入自訂的 SQL 陳述式，或選取 預存程序](querying-data-with-the-sqldatasource-control-cs/_static/image19.gif)

<span data-ttu-id="42c86-256">**圖 13**:輸入自訂的 SQL 陳述式，或選取 預存程序</span><span class="sxs-lookup"><span data-stu-id="42c86-256">**Figure 13**: Enter a Custom SQL Statement or Pick a Stored Procedure</span></span>

<span data-ttu-id="42c86-257">自訂 SQL 陳述式可以是以手動方式在 textbox 輸入，或可以按一下 [查詢產生器] 按鈕以圖形方式建構。</span><span class="sxs-lookup"><span data-stu-id="42c86-257">The custom SQL statement can be entered by hand into the textbox or can be constructed graphically by clicking the Query Builder button.</span></span> <span data-ttu-id="42c86-258">從 查詢產生器或文字方塊中，使用下列查詢來傳回`ProductID`並`ProductName`欄位從`Products`資料表使用`JOIN`擷取產品 s`CategoryName`從`Categories`資料表：</span><span class="sxs-lookup"><span data-stu-id="42c86-258">From either the Query Builder or the textbox, use the following query to return the `ProductID` and `ProductName` fields from the `Products` table using a `JOIN` to retrieve the product s `CategoryName` from the `Categories` table:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample4.sql)]

![您可以以圖形方式建構查詢使用 查詢產生器](querying-data-with-the-sqldatasource-control-cs/_static/image20.gif)

<span data-ttu-id="42c86-260">**圖 14**:您可以以圖形方式建構查詢使用 查詢產生器</span><span class="sxs-lookup"><span data-stu-id="42c86-260">**Figure 14**: You can Graphically Construct the Query Using the Query Builder</span></span>

<span data-ttu-id="42c86-261">指定查詢之後, 按一下 [下一步] 繼續進行測試查詢畫面。</span><span class="sxs-lookup"><span data-stu-id="42c86-261">After specifying the query, click Next to proceed to the Test Query screen.</span></span> <span data-ttu-id="42c86-262">按一下 完成 以完成 SqlDataSource 精靈。</span><span class="sxs-lookup"><span data-stu-id="42c86-262">Click Finish to complete the SqlDataSource wizard.</span></span>

<span data-ttu-id="42c86-263">完成精靈之後，GridView 必須加入至顯示它的三個 BoundFields `ProductID`， `ProductName`，和`CategoryName`查詢所傳回的並導致下列的宣告式標記的資料行：</span><span class="sxs-lookup"><span data-stu-id="42c86-263">After completing the wizard, the GridView will have three BoundFields added to it displaying the `ProductID`, `ProductName`, and `CategoryName` columns returned from the query and resulting in the following declarative markup:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample5.aspx)]

<span data-ttu-id="42c86-264">[![GridView 會顯示每個產品的識別碼、 名稱和相關聯的類別名稱](querying-data-with-the-sqldatasource-control-cs/_static/image22.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="42c86-264">[![The GridView Shows Each Product s ID, Name, and Associated Category Name](querying-data-with-the-sqldatasource-control-cs/_static/image22.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image21.gif)</span></span>

<span data-ttu-id="42c86-265">**圖 15**:GridView 會顯示每個產品識別碼、 名稱和相關聯的類別名稱 ([按一下以檢視完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="42c86-265">**Figure 15**: The GridView Shows Each Product s ID, Name, and Associated Category Name ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image23.gif))</span></span>

## <a name="summary"></a><span data-ttu-id="42c86-266">總結</span><span class="sxs-lookup"><span data-stu-id="42c86-266">Summary</span></span>

<span data-ttu-id="42c86-267">在本教學課程中，我們了解如何查詢，並使用 SqlDataSource 控制項顯示資料的內容。</span><span class="sxs-lookup"><span data-stu-id="42c86-267">In this tutorial we saw how to query and display data using the SqlDataSource control.</span></span> <span data-ttu-id="42c86-268">ObjectDataSource，例如 SqlDataSource 可做為 proxy、 提供宣告式的方法，用來存取資料。</span><span class="sxs-lookup"><span data-stu-id="42c86-268">Like the ObjectDataSource, the SqlDataSource serves as a proxy, providing a declarative approach to accessing data.</span></span> <span data-ttu-id="42c86-269">其屬性會指定要連接到資料庫和 SQL`SELECT`執行查詢，透過 [屬性] 視窗，或使用 [設定資料來源精靈] 可以指定它們。</span><span class="sxs-lookup"><span data-stu-id="42c86-269">Its properties specify the database to connect to and the SQL `SELECT` query to execute; they can be specified through the Properties window or by using the Configure DataSource wizard.</span></span>

<span data-ttu-id="42c86-270">`SELECT`在本教學課程中，我們檢查的查詢範例則會從指定的查詢傳回的所有記錄。</span><span class="sxs-lookup"><span data-stu-id="42c86-270">The `SELECT` query examples we examined in this tutorial returned all of the records from the specified query.</span></span> <span data-ttu-id="42c86-271">SqlDataSource 控制項，不過，可以包含`WHERE`具有參數的值會指派以程式設計方式或自動提取指定之來源子句。</span><span class="sxs-lookup"><span data-stu-id="42c86-271">The SqlDataSource control, however, can include a `WHERE` clause with parameters whose values are assigned programmatically or are automatically pulled from a specified source.</span></span> <span data-ttu-id="42c86-272">我們將檢驗如何建立，並在下一個教學課程中使用參數化的查詢 ！</span><span class="sxs-lookup"><span data-stu-id="42c86-272">We'll examine how to create and use parameterized queries in the next tutorial!</span></span>

<span data-ttu-id="42c86-273">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="42c86-273">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="42c86-274">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="42c86-274">Further Reading</span></span>

<span data-ttu-id="42c86-275">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="42c86-275">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="42c86-276">存取關聯式資料庫資料</span><span class="sxs-lookup"><span data-stu-id="42c86-276">Accessing Relational Database Data</span></span>](http://aspnet.4guysfromrolla.com/articles/022206-1.aspx)
- [<span data-ttu-id="42c86-277">SqlDataSource 控制項概觀</span><span class="sxs-lookup"><span data-stu-id="42c86-277">SqlDataSource Control Overview</span></span>](https://msdn.microsoft.com/library/dz12d98w.aspx)
- [<span data-ttu-id="42c86-278">ASP.NET 快速入門教學課程：SqlDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="42c86-278">ASP.NET Quickstart Tutorials: The SqlDataSource Control</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/sqldatasource.aspx)
- [<span data-ttu-id="42c86-279">Web.config`<connectionStrings>`項目</span><span class="sxs-lookup"><span data-stu-id="42c86-279">The Web.config `<connectionStrings>` Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)
- [<span data-ttu-id="42c86-280">資料庫連接字串參考</span><span class="sxs-lookup"><span data-stu-id="42c86-280">Database Connection String Reference</span></span>](http://www.connectionstrings.com/)

## <a name="about-the-author"></a><span data-ttu-id="42c86-281">關於作者</span><span class="sxs-lookup"><span data-stu-id="42c86-281">About the Author</span></span>

<span data-ttu-id="42c86-282">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="42c86-282">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="42c86-283">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="42c86-283">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="42c86-284">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="42c86-284">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="42c86-285">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="42c86-285">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="42c86-286">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="42c86-286">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="42c86-287">特別感謝</span><span class="sxs-lookup"><span data-stu-id="42c86-287">Special Thanks To</span></span>

<span data-ttu-id="42c86-288">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="42c86-288">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="42c86-289">本教學課程中的潛在客戶檢閱者已 Susan Connery、 Bernadette Leigh 和 David Suru。</span><span class="sxs-lookup"><span data-stu-id="42c86-289">Lead reviewers for this tutorial were Susan Connery, Bernadette Leigh, and David Suru.</span></span> <span data-ttu-id="42c86-290">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="42c86-290">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="42c86-291">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="42c86-291">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="42c86-292">下一步</span><span class="sxs-lookup"><span data-stu-id="42c86-292">Next</span></span>](using-parameterized-queries-with-the-sqldatasource-cs.md)
