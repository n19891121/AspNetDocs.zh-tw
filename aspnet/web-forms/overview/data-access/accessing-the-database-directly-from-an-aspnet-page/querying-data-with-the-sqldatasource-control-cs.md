---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-cs
title: 使用 SqlDataSource 控制項查詢資料（C#） |Microsoft Docs
author: rick-anderson
description: 在先前的教學課程中，我們使用了 ObjectDataSource 控制項，將展示層與資料存取層完全分開。 從這個輔導開始 。
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 60512d6a-b572-4b7a-beb3-3e44b4d2020c
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-cs
msc.type: authoredcontent
ms.openlocfilehash: 5bda42965f7d1db71b207c0b76e251b8fff64e31
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74606180"
---
# <a name="querying-data-with-the-sqldatasource-control-c"></a><span data-ttu-id="7bbdb-104">使用 SqlDataSource 控制項查詢資料 (C#)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-104">Querying Data with the SqlDataSource Control (C#)</span></span>

<span data-ttu-id="7bbdb-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7bbdb-106">[下載範例應用程式](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_CS.exe)或[下載 PDF](querying-data-with-the-sqldatasource-control-cs/_static/datatutorial47cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_CS.exe) or [Download PDF](querying-data-with-the-sqldatasource-control-cs/_static/datatutorial47cs1.pdf)</span></span>

> <span data-ttu-id="7bbdb-107">在先前的教學課程中，我們使用了 ObjectDataSource 控制項，將展示層與資料存取層完全分開。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-107">In the preceding tutorials we used the ObjectDataSource control to fully separate the presentation layer from the Data Access layer.</span></span> <span data-ttu-id="7bbdb-108">從本教學課程開始，我們將瞭解如何將 SqlDataSource 控制項用於不需要嚴格區分簡報和資料存取的簡單應用程式。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-108">Starting with this tutorial, we learn how the SqlDataSource control can be used for simple applications that do not require such a strict separation of presentation and data access.</span></span>

## <a name="introduction"></a><span data-ttu-id="7bbdb-109">簡介</span><span class="sxs-lookup"><span data-stu-id="7bbdb-109">Introduction</span></span>

<span data-ttu-id="7bbdb-110">目前為止我們檢查過的所有教學課程都使用了一套分層式架構，其中包含了簡報、商務邏輯和資料存取層。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-110">All of the tutorials we ve examined so far have used a tiered architecture consisting of presentation, Business Logic, and Data Access layers.</span></span> <span data-ttu-id="7bbdb-111">資料存取層（DAL）是在第一個教學課程（[建立資料存取層](../introduction/creating-a-data-access-layer-cs.md)）和第二個商務邏輯層（[建立商務邏輯層](../introduction/creating-a-business-logic-layer-cs.md)）中製作的。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-111">The Data Access Layer (DAL) was crafted in the first tutorial ([Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md)) and the Business Logic Layer in the second ([Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md)).</span></span> <span data-ttu-id="7bbdb-112">從使用[ObjectDataSource 顯示資料](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md)教學課程開始，我們已瞭解如何使用 ASP.NET 2.0 s new ObjectDataSource 控制項，以宣告方式與展示層中的架構進行介面。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-112">Starting with the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) tutorial, we saw how to use ASP.NET 2.0 s new ObjectDataSource control to declaratively interface with the architecture from the presentation layer.</span></span>

<span data-ttu-id="7bbdb-113">雖然到目前為止的所有教學課程都已使用架構來處理資料，但也可以直接從 ASP.NET 網頁存取、插入、更新和刪除資料庫資料，略過架構。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-113">While all of the tutorials so far have used the architecture to work with data, it is also possible to access, insert, update, and delete database data directly from an ASP.NET page, bypassing the architecture.</span></span> <span data-ttu-id="7bbdb-114">這麼做會將特定的資料庫查詢和商務邏輯直接放置在網頁中。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-114">Doing so places the specific database queries and business logic directly in the web page.</span></span> <span data-ttu-id="7bbdb-115">對於大型或複雜的應用程式，設計、執行和使用階層式架構，對於應用程式的成功、可更新性和可維護性而言極為重要。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-115">For sufficiently large or complex applications, designing, implementing, and using a tiered architecture is vitally important for the success, updatability, and maintainability of the application.</span></span> <span data-ttu-id="7bbdb-116">不過，在建立非常簡單的一次性應用程式時，可能不需要開發健全的架構。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-116">Developing a robust architecture, however, may be unnecessary when creating exceedingly simple, one-off applications.</span></span>

<span data-ttu-id="7bbdb-117">ASP.NET 2.0 提供五個內建的資料來源控制項[SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx)、 [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx)、 [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx)、 [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx)和[SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-117">ASP.NET 2.0 provides five built-in data source controls [SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx), [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx), [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx), and [SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx).</span></span> <span data-ttu-id="7bbdb-118">SqlDataSource 可以用來直接從關係資料庫存取和修改資料，包括 Microsoft SQL Server、Microsoft Access、Oracle、MySQL 等。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-118">The SqlDataSource can be used to access and modify data directly from a relational database, including Microsoft SQL Server, Microsoft Access, Oracle, MySQL, and others.</span></span> <span data-ttu-id="7bbdb-119">在本教學課程和接下來的三個中，我們將探討如何使用 SqlDataSource 控制項、探索如何查詢和篩選資料庫資料，以及如何使用 SqlDataSource 來插入、更新和刪除資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-119">In this tutorial and the next three, we'll examine how to work with the SqlDataSource control, exploring how to query and filter database data, as well as how to use the SqlDataSource to insert, update, and delete data.</span></span>

![ASP.NET 2.0 包含五個內建的資料來源控制項](querying-data-with-the-sqldatasource-control-cs/_static/image1.gif)

<span data-ttu-id="7bbdb-121">**圖 1**： ASP.NET 2.0 包含五個內建的資料來源控制項</span><span class="sxs-lookup"><span data-stu-id="7bbdb-121">**Figure 1**: ASP.NET 2.0 Includes Five Built-In Data Source Controls</span></span>

## <a name="comparing-the-objectdatasource-and-sqldatasource"></a><span data-ttu-id="7bbdb-122">比較 ObjectDataSource 和 SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="7bbdb-122">Comparing the ObjectDataSource and SqlDataSource</span></span>

<span data-ttu-id="7bbdb-123">就概念而言，ObjectDataSource 和 SqlDataSource 控制項只是資料的 proxy。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-123">Conceptually, both the ObjectDataSource and SqlDataSource controls are simply proxies to data.</span></span> <span data-ttu-id="7bbdb-124">如[使用 ObjectDataSource 顯示資料](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md)教學課程中所述，ObjectDataSource 的屬性會指出提供資料的物件類型，以及要叫用的方法，以便選取、插入、更新及刪除基礎物件類型中的資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-124">As discussed in the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-cs.md) tutorial, the ObjectDataSource has properties that indicate the object type that provides the data and the methods to invoke to select, insert, update, and delete data from the underlying object type.</span></span> <span data-ttu-id="7bbdb-125">一旦設定了 ObjectDataSource 的屬性，就可以使用 ObjectDataSource s `Select()`、`Insert()`、`Delete()`和 `Update()` 方法，將資料 Web 控制項（例如 GridView、DetailsView 或 DataList）系結至控制項，以與基礎結構互動。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-125">Once the ObjectDataSource s properties have been configured, a data Web control such as a GridView, DetailsView, or DataList can be bound to the control, using the ObjectDataSource s `Select()`, `Insert()`, `Delete()`, and `Update()` methods to interact with the underlying architecture.</span></span>

<span data-ttu-id="7bbdb-126">SqlDataSource 會提供相同的功能，但會對關係資料庫（而非物件程式庫）進行操作。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-126">The SqlDataSource provides the same functionality, but operates against a relational database rather than an object library.</span></span> <span data-ttu-id="7bbdb-127">在 SqlDataSource 中，我們必須指定資料庫連接字串，以及要執行以插入、更新、刪除和抓取資料的臨機操作 SQL 查詢或預存程式。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-127">With the SqlDataSource, we must specify the database connection string and the ad-hoc SQL queries or stored procedures to execute to insert, update, delete, and retrieve data.</span></span> <span data-ttu-id="7bbdb-128">SqlDataSource s `Select()`、`Insert()`、`Update()`和 `Delete()` 方法在叫用時，會連接到指定的資料庫，併發出適當的 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-128">The SqlDataSource s `Select()`, `Insert()`, `Update()`, and `Delete()` methods, when invoked, connect to the specified database and issue the appropriate SQL query.</span></span> <span data-ttu-id="7bbdb-129">如下圖所示，這些方法會執行連接至資料庫、發出查詢和傳回結果的 grunt 工作。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-129">As the following diagram illustrates, the these methods do the grunt work of connecting to a database, issuing a query, and returning the results.</span></span>

![SqlDataSource 可做為資料庫的 Proxy](querying-data-with-the-sqldatasource-control-cs/_static/image2.gif)

<span data-ttu-id="7bbdb-131">**圖 2**： SqlDataSource 做為資料庫的 Proxy</span><span class="sxs-lookup"><span data-stu-id="7bbdb-131">**Figure 2**: The SqlDataSource Serves as a Proxy to the Database</span></span>

> [!NOTE]
> <span data-ttu-id="7bbdb-132">在本教學課程中，我們將焦點放在從資料庫中抓取資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-132">In this tutorial we'll focus on retrieving data from the database.</span></span> <span data-ttu-id="7bbdb-133">在[使用 SqlDataSource 控制項來插入、更新和刪除資料](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md)教學課程中，我們將瞭解如何設定 SqlDataSource 以支援插入、更新和刪除。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-133">In the [Inserting, Updating, and Deleting Data with the SqlDataSource Control](inserting-updating-and-deleting-data-with-the-sqldatasource-cs.md) tutorial, we'll see how to configure the SqlDataSource to support inserting, updating, and deleting.</span></span>

## <a name="the-sqldatasource-and-accessdatasource-controls"></a><span data-ttu-id="7bbdb-134">SqlDataSource 和 AccessDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="7bbdb-134">The SqlDataSource and AccessDataSource Controls</span></span>

<span data-ttu-id="7bbdb-135">除了 SqlDataSource 控制項以外，ASP.NET 2.0 也包含 AccessDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-135">In addition to the SqlDataSource control, ASP.NET 2.0 also includes an AccessDataSource control.</span></span> <span data-ttu-id="7bbdb-136">這兩個不同的控制項領導許多開發人員 ASP.NET 2.0，懷疑 AccessDataSource 控制項的設計是要專門與 Microsoft Access 搭配使用，其 SqlDataSource 控制項專門用於 Microsoft SQL Server。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-136">These two different controls lead many developers new to ASP.NET 2.0 to suspect that the AccessDataSource control is designed to work exclusively with Microsoft Access with the SqlDataSource control designed to work exclusively with Microsoft SQL Server.</span></span> <span data-ttu-id="7bbdb-137">雖然 AccessDataSource 是專為使用 Microsoft Access 而設計，但 SqlDataSource 控制項適用于可透過 .NET 存取的*任何*關係資料庫。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-137">While the AccessDataSource is designed to work specifically with Microsoft Access, the SqlDataSource control works with *any* relational database that can be accessed through .NET.</span></span> <span data-ttu-id="7bbdb-138">這包括任何 OleDb 或 ODBC 相容的資料存放區，例如 Microsoft SQL Server、Microsoft Access、Oracle、Informix、MySQL 及于 postgresql 等等。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-138">This includes any OleDb- or ODBC-compliant data stores, such as Microsoft SQL Server, Microsoft Access, Oracle, Informix, MySQL, and PostgreSQL, among many others.</span></span>

<span data-ttu-id="7bbdb-139">AccessDataSource 和 SqlDataSource 控制項的唯一差異在於資料庫連接資訊的指定方式。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-139">The sole difference between the AccessDataSource and SqlDataSource controls is how the database connection information is specified.</span></span> <span data-ttu-id="7bbdb-140">AccessDataSource 控制項只需要 Access 資料庫檔案的檔案路徑。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-140">The AccessDataSource control needs just the file path to the Access database file.</span></span> <span data-ttu-id="7bbdb-141">另一方面，SqlDataSource 需要完整的連接字串。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-141">The SqlDataSource, on the other hand, requires a complete connection string.</span></span>

## <a name="step-1-creating-the-sqldatasource-web-pages"></a><span data-ttu-id="7bbdb-142">步驟1：建立 SqlDataSource 網頁</span><span class="sxs-lookup"><span data-stu-id="7bbdb-142">Step 1: Creating the SqlDataSource Web Pages</span></span>

<span data-ttu-id="7bbdb-143">在我們開始探索如何使用 SqlDataSource 控制項直接處理資料庫資料之前，先花點時間在我們的網站專案中建立 ASP.NET 網頁，我們將在本教學課程和接下來的三篇中提供。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-143">Before we start exploring how to work directly with database data using the SqlDataSource control, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="7bbdb-144">從新增名為 `SqlDataSource`的資料夾開始。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-144">Start by adding a new folder named `SqlDataSource`.</span></span> <span data-ttu-id="7bbdb-145">接下來，將下列 ASP.NET 網頁新增至該資料夾，並確定每個頁面都與 `Site.master` 主版頁面相關聯：</span><span class="sxs-lookup"><span data-stu-id="7bbdb-145">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Querying.aspx`
- `ParameterizedQueries.aspx`
- `InsertUpdateDelete.aspx`
- `OptimisticConcurrency.aspx`

![新增 SqlDataSource 相關教學課程的 ASP.NET 網頁](querying-data-with-the-sqldatasource-control-cs/_static/image3.gif)

<span data-ttu-id="7bbdb-147">**圖 3**：新增 SqlDataSource 相關教學課程的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="7bbdb-147">**Figure 3**: Add the ASP.NET Pages for the SqlDataSource-Related Tutorials</span></span>

<span data-ttu-id="7bbdb-148">如同在其他資料夾中，[`SqlDataSource`] 資料夾中的 `Default.aspx` 會在其區段中列出教學課程。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-148">Like in the other folders, `Default.aspx` in the `SqlDataSource` folder will list the tutorials in its section.</span></span> <span data-ttu-id="7bbdb-149">回想一下，`SectionLevelTutorialListing.ascx` 的使用者控制項會提供這種功能。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-149">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="7bbdb-150">因此，請將這個使用者控制項加入至 `Default.aspx`，方法是將它從方案總管拖曳至頁面 s 設計檢視。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-150">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="7bbdb-151">[![將 SectionLevelTutorialListing 的 .ascx 使用者控制項新增至 default.aspx](querying-data-with-the-sqldatasource-control-cs/_static/image5.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image4.gif)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-151">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](querying-data-with-the-sqldatasource-control-cs/_static/image5.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image4.gif)</span></span>

<span data-ttu-id="7bbdb-152">**圖 4**：將 `SectionLevelTutorialListing.ascx` 使用者控制項加入 `Default.aspx` （[按一下以查看完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image6.gif)）</span><span class="sxs-lookup"><span data-stu-id="7bbdb-152">**Figure 4**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image6.gif))</span></span>

<span data-ttu-id="7bbdb-153">最後，將這四個頁面新增為 `Web.sitemap` 檔案的專案。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-153">Lastly, add these four pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="7bbdb-154">具體而言，在將自訂按鈕新增至 DataList 和中繼器 `<siteMapNode>`之後，新增下列標記：</span><span class="sxs-lookup"><span data-stu-id="7bbdb-154">Specifically, add the following markup after the Adding Custom Buttons to the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample1.sql)]

<span data-ttu-id="7bbdb-155">更新 `Web.sitemap`之後，請花一點時間透過瀏覽器來觀看教學課程網站。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-155">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="7bbdb-156">左側功能表現在包含用於編輯、插入及刪除教學課程的專案。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-156">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![網站地圖現在包含 SqlDataSource 教學課程的專案](querying-data-with-the-sqldatasource-control-cs/_static/image7.gif)

<span data-ttu-id="7bbdb-158">[**圖 5**]：網站地圖現在包含 SqlDataSource 教學課程的專案</span><span class="sxs-lookup"><span data-stu-id="7bbdb-158">**Figure 5**: The Site Map Now Includes Entries for the SqlDataSource Tutorials</span></span>

## <a name="step-2-adding-and-configuring-the-sqldatasource-control"></a><span data-ttu-id="7bbdb-159">步驟2：新增和設定 SqlDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="7bbdb-159">Step 2: Adding and Configuring the SqlDataSource Control</span></span>

<span data-ttu-id="7bbdb-160">一開始先開啟 [`SqlDataSource`] 資料夾中的 [`Querying.aspx`] 頁面，然後切換至 [設計檢視]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-160">Start by opening the `Querying.aspx` page in the `SqlDataSource` folder and switch to Design view.</span></span> <span data-ttu-id="7bbdb-161">將 [SqlDataSource] 控制項從 [工具箱] 拖曳至設計工具，並將其 `ID` 設定為 [`ProductsDataSource`]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-161">Drag a SqlDataSource control from the Toolbox onto the Designer and set its `ID` to `ProductsDataSource`.</span></span> <span data-ttu-id="7bbdb-162">就像 ObjectDataSource 一樣，SqlDataSource 不會產生任何轉譯的輸出，因此在設計介面上會顯示為灰色方塊。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-162">As with the ObjectDataSource, the SqlDataSource does not produce any rendered output and therefore appears as a gray box on the design surface.</span></span> <span data-ttu-id="7bbdb-163">若要設定 SqlDataSource，請按一下 SqlDataSource s 智慧標籤中的 [設定資料來源] 連結。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-163">To configure the SqlDataSource, click on the Configure Data Source link from the SqlDataSource s smart tag.</span></span>

![按一下 SqlDataSource s 智慧標籤中的 [設定資料來源] 連結](querying-data-with-the-sqldatasource-control-cs/_static/image8.gif)

<span data-ttu-id="7bbdb-165">**圖 6**：按一下 SqlDataSource s 智慧標籤的 [設定資料來源] 連結</span><span class="sxs-lookup"><span data-stu-id="7bbdb-165">**Figure 6**: Click on the Configure Data Source Link from the SqlDataSource s Smart Tag</span></span>

<span data-ttu-id="7bbdb-166">這會顯示 [SqlDataSource 控制項] [設定資料來源]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-166">This brings up the SqlDataSource control s Configure Data Source wizard.</span></span> <span data-ttu-id="7bbdb-167">雖然 wizard 的步驟與 ObjectDataSource 控制項不同，但最終目標與提供如何透過資料來源抓取、插入、更新及刪除資料的詳細資訊相同。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-167">While the wizard s steps differ from the ObjectDataSource control s, the end goal is the same to provide the details on how to retrieve, insert, update, and delete data through the data source.</span></span> <span data-ttu-id="7bbdb-168">針對 SqlDataSource，這牽涉到指定要使用的基礎資料庫，並提供臨機操作 SQL 語句或預存程式。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-168">For the SqlDataSource this entails specifying the underlying database to use and providing the ad-hoc SQL statements or stored procedures.</span></span>

<span data-ttu-id="7bbdb-169">第一個 wizard 步驟會提示我們輸入資料庫。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-169">The first wizard step prompts us for the database.</span></span> <span data-ttu-id="7bbdb-170">下拉式清單中會包含在 web 應用程式 `App_Data` 資料夾中找到的資料庫，以及已加入伺服器總管中 [資料連線] 節點的資料庫。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-170">The drop-down list includes those databases found in the web application s `App_Data` folder and those that have been added to the Data Connections node in the Server Explorer.</span></span> <span data-ttu-id="7bbdb-171">因為我們已經將 `App_Data` 資料夾中 `NORTHWIND.MDF` 資料庫的連接字串加入到專案的 `Web.config` 檔案中，所以下拉式清單會包含該連接字串的參考，`NORTHWINDConnectionString`。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-171">Since we ve already added a connection string for the `NORTHWIND.MDF` database in the `App_Data` folder to our project s `Web.config` file, the drop-down list includes a reference to that connection string, `NORTHWINDConnectionString`.</span></span> <span data-ttu-id="7bbdb-172">從下拉式清單中選擇此專案，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-172">Choose this item from the drop-down list and click Next.</span></span>

![從下拉式清單中選擇 [NORTHWINDConnectionString]](querying-data-with-the-sqldatasource-control-cs/_static/image9.gif)

<span data-ttu-id="7bbdb-174">**圖 7**：從下拉式清單中選擇 [`NORTHWINDConnectionString`]</span><span class="sxs-lookup"><span data-stu-id="7bbdb-174">**Figure 7**: Choose the `NORTHWINDConnectionString` from the Drop-Down List</span></span>

<span data-ttu-id="7bbdb-175">選擇資料庫之後，嚮導會要求查詢傳回資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-175">After choosing the database, the wizard asks for the query to return data.</span></span> <span data-ttu-id="7bbdb-176">我們可以指定要傳回之資料表或視圖的資料行，也可以輸入自訂 SQL 語句或指定預存程式。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-176">We can either specify the columns of a table or view to return or can enter a custom SQL statement or specify a stored procedure.</span></span> <span data-ttu-id="7bbdb-177">您可以透過 [指定自訂 SQL 語句或預存程式]，並從 [資料表] 或 [視圖] 選項按鈕指定資料行，在此選項之間切換。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-177">You can toggle between this choice through the Specify a custom SQL statement or stored procedure and Specify columns from a table or view radio buttons.</span></span>

> [!NOTE]
> <span data-ttu-id="7bbdb-178">在第一個範例中，讓我們使用 [從資料表或視圖指定資料行] 選項。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-178">For this first example, let s use the Specify columns from a table or view option.</span></span> <span data-ttu-id="7bbdb-179">我們稍後會在本教學課程中返回嚮導，並探索 [指定自訂 SQL 語句或預存程式] 選項。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-179">We'll return to the wizard later in this tutorial and explore the Specify a custom SQL statement or stored procedure option.</span></span>

<span data-ttu-id="7bbdb-180">[圖 8] 顯示選取了 [從資料表或視圖指定資料行] 選項按鈕時的 [設定 Select 語句] 畫面。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-180">Figure 8 shows the Configure the Select Statement screen when the Specify columns from a table or view radio button is selected.</span></span> <span data-ttu-id="7bbdb-181">下拉式清單包含 Northwind 資料庫中的一組資料表和 views，並在下面的核取方塊清單中顯示選取的資料表或 view s 資料行。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-181">The drop-down list contains the set of tables and views in the Northwind database, with the selected table or view s columns displayed in the checkbox list below.</span></span> <span data-ttu-id="7bbdb-182">在此範例中，讓 s 從 `Products` 資料表傳回 `ProductID`、`ProductName`和 `UnitPrice` 資料行。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-182">For this example, let s return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table.</span></span> <span data-ttu-id="7bbdb-183">如 [圖 8] 所示，在進行這些選擇之後，嚮導會顯示所產生的 SQL 語句 `SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-183">As Figure 8 shows, after making these selections the wizard shows the resulting SQL statement `SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`.</span></span>

![從 Products 資料表傳回資料](querying-data-with-the-sqldatasource-control-cs/_static/image10.gif)

<span data-ttu-id="7bbdb-185">**圖 8**：從 `Products` 資料表傳回資料</span><span class="sxs-lookup"><span data-stu-id="7bbdb-185">**Figure 8**: Return Data from the `Products` Table</span></span>

<span data-ttu-id="7bbdb-186">當您設定 wizard 從 `Products` 資料表傳回 `ProductID`、`ProductName`和 `UnitPrice` 資料行之後，請按 [下一步] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-186">Once you have configured the wizard to return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table, click the Next button.</span></span> <span data-ttu-id="7bbdb-187">最後一個畫面可讓您檢查上一個步驟所設定之查詢的結果。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-187">This final screen provides an opportunity to examine the results of the query configured from the previous step.</span></span> <span data-ttu-id="7bbdb-188">按一下 [測試查詢] 按鈕會執行已設定的 `SELECT` 語句，並在方格中顯示結果。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-188">Clicking the Test Query button executes the configured `SELECT` statement and displays the results in a grid.</span></span>

![按一下 [測試查詢] 按鈕，以檢查您的 SELECT 查詢](querying-data-with-the-sqldatasource-control-cs/_static/image11.gif)

<span data-ttu-id="7bbdb-190">**圖 9**：按一下 [測試查詢] 按鈕，以檢查您的 `SELECT` 查詢</span><span class="sxs-lookup"><span data-stu-id="7bbdb-190">**Figure 9**: Click the Test Query Button to Review Your `SELECT` Query</span></span>

<span data-ttu-id="7bbdb-191">若要完成精靈，請按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-191">To complete the wizard, click Finish.</span></span>

<span data-ttu-id="7bbdb-192">和 ObjectDataSource 一樣，SqlDataSource s wizard 只會將值指派給控制項的屬性，亦即[`ConnectionString`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx)和[`SelectCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx)屬性。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-192">Like with the ObjectDataSource, the SqlDataSource s wizard merely assigns values to the control s properties, namely the [`ConnectionString`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx) and [`SelectCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx) properties.</span></span> <span data-ttu-id="7bbdb-193">完成 wizard 之後，您的 SqlDataSource 控制項的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="7bbdb-193">After completing the wizard, your SqlDataSource control s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample2.aspx)]

<span data-ttu-id="7bbdb-194">`ConnectionString` 屬性提供如何連接到資料庫的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-194">The `ConnectionString` property provides information on how to connect to the database.</span></span> <span data-ttu-id="7bbdb-195">這個屬性可以指派為完整的硬式編碼連接字串值，或可指向 `Web.config`中的連接字串。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-195">This property can be assigned a complete, hard-coded connection string value or can point to a connection string in `Web.config`.</span></span> <span data-ttu-id="7bbdb-196">若要參考 Web.config 中的連接字串值，請使用 `<%$ expressionPrefix:expressionValue %>`的語法。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-196">To reference a connection string value in Web.config, use the syntax `<%$ expressionPrefix:expressionValue %>`.</span></span> <span data-ttu-id="7bbdb-197">一般來說， *expressionPrefix*是 ConnectionStrings，而*expressionValue*是 `Web.config` [`<connectionStrings>` 區段](https://msdn.microsoft.com/library/bf7sd233.aspx)中的連接字串名稱。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-197">Typically, *expressionPrefix* is ConnectionStrings and *expressionValue* is the name of the connect string in the `Web.config` [`<connectionStrings>` section](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="7bbdb-198">不過，語法可以用來參考資源檔中 `<appSettings>` 元素或內容。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-198">However, the syntax can be used to reference `<appSettings>` elements or content from resource files.</span></span> <span data-ttu-id="7bbdb-199">如需此語法的詳細資訊，請參閱[ASP.NET 運算式總覽](https://msdn.microsoft.com/library/d5bd1tad.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-199">See [ASP.NET Expressions Overview](https://msdn.microsoft.com/library/d5bd1tad.aspx) for more on this syntax.</span></span>

<span data-ttu-id="7bbdb-200">`SelectCommand` 屬性會指定要執行的臨機操作 SQL 語句或預存程式，以傳回資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-200">The `SelectCommand` property specifies the ad-hoc SQL statement or stored procedure to execute to return the data.</span></span>

## <a name="step-3-adding-a-data-web-control-and-binding-it-to-the-sqldatasource"></a><span data-ttu-id="7bbdb-201">步驟3：加入資料 Web 控制項並將它系結至 SqlDataSource</span><span class="sxs-lookup"><span data-stu-id="7bbdb-201">Step 3: Adding a Data Web Control and Binding it to the SqlDataSource</span></span>

<span data-ttu-id="7bbdb-202">一旦設定 SqlDataSource 之後，就可以系結至資料 Web 控制項，例如 GridView 或 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-202">Once the SqlDataSource has been configured, it can be bound to a data Web control, such as a GridView or DetailsView.</span></span> <span data-ttu-id="7bbdb-203">在本教學課程中，我們會在 GridView 中顯示資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-203">For this tutorial, let s display the data in a GridView.</span></span> <span data-ttu-id="7bbdb-204">從 [工具箱] 將 GridView 拖曳至頁面上，然後從 [GridView] 智慧標籤的下拉式清單中選擇資料來源，將它系結至 [`ProductsDataSource` SqlDataSource]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-204">From the Toolbox, drag a GridView onto the page and bind it to the `ProductsDataSource` SqlDataSource by choosing the data source from the drop-down list in the GridView s smart tag.</span></span>

<span data-ttu-id="7bbdb-205">[![加入 GridView 並將它系結至 SqlDataSource 控制項](querying-data-with-the-sqldatasource-control-cs/_static/image13.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image12.gif)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-205">[![Add a GridView and Bind it to the SqlDataSource Control](querying-data-with-the-sqldatasource-control-cs/_static/image13.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image12.gif)</span></span>

<span data-ttu-id="7bbdb-206">**圖 10**：加入 GridView 並將它系結至 SqlDataSource 控制項（[按一下以查看完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image14.gif)）</span><span class="sxs-lookup"><span data-stu-id="7bbdb-206">**Figure 10**: Add a GridView and Bind it to the SqlDataSource Control ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image14.gif))</span></span>

<span data-ttu-id="7bbdb-207">當您從 GridView 的智慧標籤的下拉式清單中選取 SqlDataSource 控制項之後，Visual Studio 將會針對資料來源控制項所傳回的每個資料行，自動加入 GridView 的 BoundField 或 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-207">Once you ve selected the SqlDataSource control from the drop-down list in the GridView s smart tag, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the columns returned by the data source control.</span></span> <span data-ttu-id="7bbdb-208">由於 SqlDataSource 會傳回三個資料庫資料行 `ProductID`、`ProductName`和 `UnitPrice` GridView 中有三個欄位。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-208">Since the SqlDataSource returns three database columns `ProductID`, `ProductName`, and `UnitPrice` there are three fields in the GridView.</span></span>

<span data-ttu-id="7bbdb-209">請花點時間設定 GridView 的三 BoundFields。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-209">Take a moment to configure the GridView s three BoundFields.</span></span> <span data-ttu-id="7bbdb-210">將 [`ProductName`] 欄位 `HeaderText` 屬性變更為 [產品名稱]，並將 [`UnitPrice`] 欄位變更為 [價格]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-210">Change the `ProductName` field s `HeaderText` property to Product Name and the `UnitPrice` field s to Price.</span></span> <span data-ttu-id="7bbdb-211">同時將 `UnitPrice` 欄位格式化為貨幣。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-211">Also format the `UnitPrice` field as a currency.</span></span> <span data-ttu-id="7bbdb-212">進行這些修改之後，GridView 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="7bbdb-212">After making these modifications, your GridView s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample3.aspx)]

<span data-ttu-id="7bbdb-213">透過瀏覽器造訪此頁面。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-213">Visit this page through a browser.</span></span> <span data-ttu-id="7bbdb-214">如 [圖 11] 所示，GridView 會列出每個產品的 `ProductID`、`ProductName`和 `UnitPrice` 值。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-214">As Figure 11 shows, the GridView lists each product s `ProductID`, `ProductName`, and `UnitPrice` values.</span></span>

<span data-ttu-id="7bbdb-215">[![GridView 會顯示每個產品的 ProductID、ProductName 和單價值](querying-data-with-the-sqldatasource-control-cs/_static/image16.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-215">[![The GridView Displays Each Product s ProductID, ProductName, and UnitPrice Values](querying-data-with-the-sqldatasource-control-cs/_static/image16.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image15.gif)</span></span>

<span data-ttu-id="7bbdb-216">**圖 11**： GridView 會顯示每個產品的 `ProductID`、`ProductName`和 `UnitPrice` 值（[按一下以查看完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image17.gif)）</span><span class="sxs-lookup"><span data-stu-id="7bbdb-216">**Figure 11**: The GridView Displays Each Product s `ProductID`, `ProductName`, and `UnitPrice` Values ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image17.gif))</span></span>

<span data-ttu-id="7bbdb-217">流覽頁面時，GridView 會叫用它的資料來源控制項 `Select()` 方法。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-217">When the page is visited the GridView invokes its data source control s `Select()` method.</span></span> <span data-ttu-id="7bbdb-218">當我們使用 ObjectDataSource 控制項時，這稱為 `ProductsBLL` 類別 s `GetProducts()` 方法。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-218">When we were using the ObjectDataSource control, this called the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="7bbdb-219">不過，使用 SqlDataSource 時，`Select()` 方法會建立與指定之資料庫的連接，併發出 `SelectCommand` （在此範例中為`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`）。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-219">With the SqlDataSource, however, the `Select()` method establishes a connection to the specified database and issues the `SelectCommand` (`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`, in this example).</span></span> <span data-ttu-id="7bbdb-220">此 SqlDataSource 會傳回它的結果，接著 GridView 會列舉，並在 GridView 中針對每個傳回的資料庫記錄建立一個資料列。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-220">The SqlDataSource returns its results which the GridView then enumerates, creating a row in the GridView for each database record returned.</span></span>

## <a name="the-built-in-data-web-control-features-and-the-sqldatasource-control"></a><span data-ttu-id="7bbdb-221">內建的資料 Web 控制項功能和 SqlDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="7bbdb-221">The Built-In Data Web Control Features and the SqlDataSource Control</span></span>

<span data-ttu-id="7bbdb-222">一般而言，資料 Web 控制項分頁、排序、編輯、刪除、插入等功能，都是資料 Web 控制項特有的，而且不會相依于所使用的資料來源控制項。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-222">In general, the features inherent to the data Web controls paging, sorting, editing, deleting, inserting, and so on are specific to the data Web control and are not dependent on the data source control used.</span></span> <span data-ttu-id="7bbdb-223">也就是說，GridView 可以利用內建的分頁、排序、編輯和刪除它是否系結至 ObjectDataSource 或 SqlDataSource。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-223">That is, the GridView can utilize its built-in paging, sorting, editing, and deleting whether it is bound to an ObjectDataSource or a SqlDataSource.</span></span> <span data-ttu-id="7bbdb-224">不過，某些資料 Web 控制項功能對所使用的資料來源控制項或資料來源控制設定而言是敏感的。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-224">However, certain data Web control features are sensitive to the data source control being used or to the data source control s configuration.</span></span>

<span data-ttu-id="7bbdb-225">例如，在[有效率地逐一查看大量資料的](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)教學課程中，我們討論了資料 Web 控制項輕鬆自在管理的分頁邏輯如何傳回基礎資料來源中的*所有*記錄，然後根據目前的頁面索引和每頁要顯示的記錄數目，只顯示適當的記錄子集。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-225">For example, in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial we discussed how, by default, the paging logic for the data Web controls naively returns *all* records from the underlying data source and then displays only the appropriate subset of records given the current page index and the number of records to display per page.</span></span> <span data-ttu-id="7bbdb-226">當分頁通過夠大的結果集時，此模型的效率非常低。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-226">This model is highly inefficient when paging through sufficiently large result sets.</span></span> <span data-ttu-id="7bbdb-227">幸好，可以將 ObjectDataSource 設定為支援自訂分頁，這只會傳回要顯示的精確記錄子集。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-227">Fortunately, the ObjectDataSource can be configured to support custom paging, which returns only the precise subset of records to display.</span></span> <span data-ttu-id="7bbdb-228">不過，SqlDataSource 控制項缺少用來執行自訂分頁的屬性。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-228">The SqlDataSource control, however, lacks the properties for implementing custom paging.</span></span>

<span data-ttu-id="7bbdb-229">具有分頁和排序的另一個奧妙會出現在 SqlDataSource 中。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-229">Another subtlety with paging and sorting arises with the SqlDataSource.</span></span> <span data-ttu-id="7bbdb-230">根據預設，從 SqlDataSource 傳回的資料可以透過 GridView 分頁或進行排序。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-230">By default, the data returned from a SqlDataSource can be paged or sorted through the GridView.</span></span> <span data-ttu-id="7bbdb-231">若要示範這一點，請檢查 `Querying.aspx` 中 GridView s 智慧標籤的 [啟用分頁] 和 [啟用排序] 選項，並確認此功能如預期般運作。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-231">To demonstrate this, check the Enable Paging and Enable Sorting options in the GridView s smart tag in `Querying.aspx` and verify that this works as expected.</span></span>

<span data-ttu-id="7bbdb-232">排序和分頁會運作，因為 SqlDataSource 會將資料庫資料捕獲到鬆散類型的資料集。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-232">Sorting and paging works because the SqlDataSource retrieves the database data into a loosely-typed DataSet.</span></span> <span data-ttu-id="7bbdb-233">查詢所傳回的記錄總數是執行分頁的重要層面，可以從資料集確認。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-233">The total number of records returned by the query an essential aspect to implementing paging can be ascertained from the DataSet.</span></span> <span data-ttu-id="7bbdb-234">此外，資料集的結果可以透過 DataView 排序。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-234">Additionally, the DataSet s results can be sorted through a DataView.</span></span> <span data-ttu-id="7bbdb-235">當 GridView 要求分頁或已排序的資料時，SqlDataSource 會自動使用這些功能。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-235">These capabilities are automatically used by the SqlDataSource when the GridView requests paged or sorted data.</span></span>

<span data-ttu-id="7bbdb-236">SqlDataSource 可以設定為傳回 DataReader，而不是資料集，方法是將其[`DataSourceMode` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx)從 `DataSet` （預設值）變更為 `DataReader`。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-236">The SqlDataSource can be configured to return a DataReader instead of a DataSet by changing its [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx) from `DataSet` (the default) to `DataReader`.</span></span> <span data-ttu-id="7bbdb-237">將 SqlDataSource 的結果傳遞至預期 DataReader 的現有程式碼時，可能會偏好使用 DataReader。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-237">Using a DataReader might be preferred in situations when passing the SqlDataSource s results to existing code that expects a DataReader.</span></span> <span data-ttu-id="7bbdb-238">此外，由於 Datareader 是比資料集更簡單的物件，因此它們會提供較佳的效能。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-238">Furthermore, since DataReaders are considerably simpler objects than DataSets, they offer better performance.</span></span> <span data-ttu-id="7bbdb-239">不過，如果您進行這項變更，資料 Web 控制項就不能進行排序或分頁，因為 SqlDataSource 無法確定查詢傳回多少筆記錄，而且 DataReader 是否提供任何方法來排序傳回的資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-239">If you make this change, however, the data Web control can neither sort nor page since the SqlDataSource cannot ascertain how many records are returned by the query, nor does the DataReader offer any techniques for sorting the returned data.</span></span>

## <a name="step-4-using-a-custom-sql-statement-or-stored-procedure"></a><span data-ttu-id="7bbdb-240">步驟4：使用自訂 SQL 語句或預存程式</span><span class="sxs-lookup"><span data-stu-id="7bbdb-240">Step 4: Using a Custom SQL Statement or Stored Procedure</span></span>

<span data-ttu-id="7bbdb-241">設定 SqlDataSource 控制項時，用來傳回資料的查詢可以用兩種方法之一來指定，做為自訂 SQL 語句或預存程式，或當做現有資料表或視圖的資料行。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-241">When configuring the SqlDataSource control, the query used to return data can be specified in one of two approaches as a custom SQL statement or stored procedure, or as columns from an existing table or view.</span></span> <span data-ttu-id="7bbdb-242">在步驟2中，我們已檢查從 `Products` 資料表中選取資料行。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-242">In Step 2 we examined selecting columns from the `Products` table.</span></span> <span data-ttu-id="7bbdb-243">讓我們看看如何使用自訂的 SQL 語句。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-243">Let s look at using a custom SQL statement.</span></span>

<span data-ttu-id="7bbdb-244">將另一個 GridView 控制項加入至 [`Querying.aspx`] 頁面，然後從智慧標籤的下拉式清單中選擇建立新的資料來源。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-244">Add another GridView control to the `Querying.aspx` page and choose to create a new data source from the drop-down list in the smart tag.</span></span> <span data-ttu-id="7bbdb-245">接下來，指出將從資料庫提取資料，這將會建立新的 SqlDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-245">Next, indicate that the data will be pulled from a database this will create a new SqlDataSource control.</span></span> <span data-ttu-id="7bbdb-246">將控制項命名為 `ProductsWithCategoryInfoDataSource`。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-246">Name the control `ProductsWithCategoryInfoDataSource`.</span></span>

![建立名為 ProductsWithCategoryInfoDataSource 的新 SqlDataSource 控制項](querying-data-with-the-sqldatasource-control-cs/_static/image18.gif)

<span data-ttu-id="7bbdb-248">**圖 12**：建立名為 `ProductsWithCategoryInfoDataSource` 的新 SqlDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="7bbdb-248">**Figure 12**: Create a New SqlDataSource Control Named `ProductsWithCategoryInfoDataSource`</span></span>

<span data-ttu-id="7bbdb-249">下一個畫面會要求我們指定資料庫。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-249">The next screen asks us to specify the database.</span></span> <span data-ttu-id="7bbdb-250">如 [圖 7] 所示，從下拉式清單中選取 [`NORTHWINDConnectionString`]，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-250">As we did back in Figure 7, select the `NORTHWINDConnectionString` from the drop-down list and click Next.</span></span> <span data-ttu-id="7bbdb-251">在 [設定 Select 語句] 畫面中，選擇 [指定自訂 SQL 語句或預存程式] 選項按鈕，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-251">In the Configure the Select Statement screen, choose the Specify a custom SQL statement or stored procedure radio button and click Next.</span></span> <span data-ttu-id="7bbdb-252">這會顯示 [定義自訂語句] 或 [預存程式] 畫面，其中提供標示為 SELECT、UPDATE、INSERT 和 DELETE 的索引標籤。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-252">This will bring up the Define Custom Statements or Stored Procedures screen, which offers tabs labeled SELECT, UPDATE, INSERT, and DELETE.</span></span> <span data-ttu-id="7bbdb-253">在每個索引標籤中，您可以在文字方塊中輸入自訂的 SQL 語句，或從下拉式清單中選擇一個預存程式。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-253">In each tab you can enter a custom SQL statement into the textbox or choose a stored procedure from the drop-down list.</span></span> <span data-ttu-id="7bbdb-254">在本教學課程中，我們將探討如何輸入自訂的 SQL 語句;下一個教學課程包含使用預存程式的範例。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-254">In this tutorial we will look at entering a custom SQL statement; the next tutorial includes an example that uses a stored procedure.</span></span>

![輸入自訂 SQL 語句或挑選預存程式](querying-data-with-the-sqldatasource-control-cs/_static/image19.gif)

<span data-ttu-id="7bbdb-256">**圖 13**：輸入自訂 SQL 語句或挑選預存程式</span><span class="sxs-lookup"><span data-stu-id="7bbdb-256">**Figure 13**: Enter a Custom SQL Statement or Pick a Stored Procedure</span></span>

<span data-ttu-id="7bbdb-257">您可以將自訂 SQL 語句手動輸入文字方塊中，或按一下 [查詢產生器] 按鈕以圖形方式來建立。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-257">The custom SQL statement can be entered by hand into the textbox or can be constructed graphically by clicking the Query Builder button.</span></span> <span data-ttu-id="7bbdb-258">從 [查詢產生器] 或 [] 文字方塊中，使用下列查詢來傳回來自 `Products` 資料表的 `ProductID` 和 `ProductName` 欄位，方法是使用 `JOIN` 從 `CategoryName` 資料表中取出 product s `Categories`：</span><span class="sxs-lookup"><span data-stu-id="7bbdb-258">From either the Query Builder or the textbox, use the following query to return the `ProductID` and `ProductName` fields from the `Products` table using a `JOIN` to retrieve the product s `CategoryName` from the `Categories` table:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample4.sql)]

![您可以使用查詢產生器，以圖形方式建立查詢](querying-data-with-the-sqldatasource-control-cs/_static/image20.gif)

<span data-ttu-id="7bbdb-260">**圖 14**：您可以使用查詢產生器以圖形方式建立查詢</span><span class="sxs-lookup"><span data-stu-id="7bbdb-260">**Figure 14**: You can Graphically Construct the Query Using the Query Builder</span></span>

<span data-ttu-id="7bbdb-261">指定查詢之後，請按 [下一步] 繼續前往 [測試查詢] 畫面。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-261">After specifying the query, click Next to proceed to the Test Query screen.</span></span> <span data-ttu-id="7bbdb-262">按一下 [完成] 以完成 SqlDataSource wizard。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-262">Click Finish to complete the SqlDataSource wizard.</span></span>

<span data-ttu-id="7bbdb-263">完成 wizard 之後，GridView 會加入三個 BoundFields，其中顯示查詢所傳回的 `ProductID`、`ProductName`和 `CategoryName` 資料行，並產生下列宣告式標記：</span><span class="sxs-lookup"><span data-stu-id="7bbdb-263">After completing the wizard, the GridView will have three BoundFields added to it displaying the `ProductID`, `ProductName`, and `CategoryName` columns returned from the query and resulting in the following declarative markup:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-cs/samples/sample5.aspx)]

<span data-ttu-id="7bbdb-264">[![GridView 會顯示每個產品的識別碼、名稱和相關聯的類別名稱](querying-data-with-the-sqldatasource-control-cs/_static/image22.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-264">[![The GridView Shows Each Product s ID, Name, and Associated Category Name](querying-data-with-the-sqldatasource-control-cs/_static/image22.gif)](querying-data-with-the-sqldatasource-control-cs/_static/image21.gif)</span></span>

<span data-ttu-id="7bbdb-265">**圖 15**： GridView 會顯示每個產品的識別碼、名稱和相關聯的類別名稱（[按一下以查看完整大小的影像](querying-data-with-the-sqldatasource-control-cs/_static/image23.gif)）</span><span class="sxs-lookup"><span data-stu-id="7bbdb-265">**Figure 15**: The GridView Shows Each Product s ID, Name, and Associated Category Name ([Click to view full-size image](querying-data-with-the-sqldatasource-control-cs/_static/image23.gif))</span></span>

## <a name="summary"></a><span data-ttu-id="7bbdb-266">總結</span><span class="sxs-lookup"><span data-stu-id="7bbdb-266">Summary</span></span>

<span data-ttu-id="7bbdb-267">在本教學課程中，我們已瞭解如何使用 SqlDataSource 控制項來查詢和顯示資料。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-267">In this tutorial we saw how to query and display data using the SqlDataSource control.</span></span> <span data-ttu-id="7bbdb-268">就像 ObjectDataSource 一樣，SqlDataSource 會當做 proxy，提供存取資料的宣告式方法。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-268">Like the ObjectDataSource, the SqlDataSource serves as a proxy, providing a declarative approach to accessing data.</span></span> <span data-ttu-id="7bbdb-269">其屬性會指定要連接的資料庫，以及要執行的 SQL `SELECT` 查詢;您可以透過屬性視窗或使用 [設定資料來源] wizard 來指定它們。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-269">Its properties specify the database to connect to and the SQL `SELECT` query to execute; they can be specified through the Properties window or by using the Configure DataSource wizard.</span></span>

<span data-ttu-id="7bbdb-270">我們在本教學課程中檢查的 `SELECT` 查詢範例會從指定的查詢傳回所有記錄。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-270">The `SELECT` query examples we examined in this tutorial returned all of the records from the specified query.</span></span> <span data-ttu-id="7bbdb-271">不過，SqlDataSource 控制項可以包含具有參數的 `WHERE` 子句，其值是以程式設計方式指派，或從指定的來源自動提取。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-271">The SqlDataSource control, however, can include a `WHERE` clause with parameters whose values are assigned programmatically or are automatically pulled from a specified source.</span></span> <span data-ttu-id="7bbdb-272">在下一個教學課程中，我們將探討如何建立及使用參數化查詢！</span><span class="sxs-lookup"><span data-stu-id="7bbdb-272">We'll examine how to create and use parameterized queries in the next tutorial!</span></span>

<span data-ttu-id="7bbdb-273">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="7bbdb-273">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="7bbdb-274">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="7bbdb-274">Further Reading</span></span>

<span data-ttu-id="7bbdb-275">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="7bbdb-275">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="7bbdb-276">存取關係資料庫資料</span><span class="sxs-lookup"><span data-stu-id="7bbdb-276">Accessing Relational Database Data</span></span>](http://aspnet.4guysfromrolla.com/articles/022206-1.aspx)
- [<span data-ttu-id="7bbdb-277">SqlDataSource 控制項總覽</span><span class="sxs-lookup"><span data-stu-id="7bbdb-277">SqlDataSource Control Overview</span></span>](https://msdn.microsoft.com/library/dz12d98w.aspx)
- [<span data-ttu-id="7bbdb-278">ASP.NET 快速入門教學課程： SqlDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="7bbdb-278">ASP.NET Quickstart Tutorials: The SqlDataSource Control</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/sqldatasource.aspx)
- [<span data-ttu-id="7bbdb-279">Web.config `<connectionStrings>` 元素</span><span class="sxs-lookup"><span data-stu-id="7bbdb-279">The Web.config `<connectionStrings>` Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)
- [<span data-ttu-id="7bbdb-280">資料庫連接字串參考</span><span class="sxs-lookup"><span data-stu-id="7bbdb-280">Database Connection String Reference</span></span>](http://www.connectionstrings.com/)

## <a name="about-the-author"></a><span data-ttu-id="7bbdb-281">關於作者</span><span class="sxs-lookup"><span data-stu-id="7bbdb-281">About the Author</span></span>

<span data-ttu-id="7bbdb-282">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-282">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7bbdb-283">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-283">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7bbdb-284">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-284">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7bbdb-285">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-285">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7bbdb-286">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-286">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7bbdb-287">特別感謝</span><span class="sxs-lookup"><span data-stu-id="7bbdb-287">Special Thanks To</span></span>

<span data-ttu-id="7bbdb-288">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-288">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7bbdb-289">本教學課程的領導審查者為 Susan Connery、Bernadette Leigh 和 David Suru。</span><span class="sxs-lookup"><span data-stu-id="7bbdb-289">Lead reviewers for this tutorial were Susan Connery, Bernadette Leigh, and David Suru.</span></span> <span data-ttu-id="7bbdb-290">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="7bbdb-290">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7bbdb-291">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7bbdb-291">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="7bbdb-292">下一步</span><span class="sxs-lookup"><span data-stu-id="7bbdb-292">Next</span></span>](using-parameterized-queries-with-the-sqldatasource-cs.md)
