---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
title: 批次更新（VB） |Microsoft Docs
author: rick-anderson
description: 瞭解如何在單一作業中更新多個資料庫記錄。 在使用者介面層中，我們會建立一個 GridView，其中每個資料列都是可編輯的。 在 [資料 ...]
ms.author: riande
ms.date: 06/26/2007
ms.assetid: d191a204-d7ea-458d-b81c-0b9049ecb55f
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
msc.type: authoredcontent
ms.openlocfilehash: f0bb83b17585876dd6d28a5893a223cce15da31d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74590941"
---
# <a name="batch-updating-vb"></a><span data-ttu-id="49aff-105">批次更新 (VB)</span><span class="sxs-lookup"><span data-stu-id="49aff-105">Batch Updating (VB)</span></span>

<span data-ttu-id="49aff-106">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="49aff-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="49aff-107">[下載程式代碼](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip)或[下載 PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="49aff-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip) or [Download PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span></span>

> <span data-ttu-id="49aff-108">瞭解如何在單一作業中更新多個資料庫記錄。</span><span class="sxs-lookup"><span data-stu-id="49aff-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="49aff-109">在使用者介面層中，我們會建立一個 GridView，其中每個資料列都是可編輯的。</span><span class="sxs-lookup"><span data-stu-id="49aff-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="49aff-110">在資料存取層中，我們會將多個更新作業包裝在交易中，以確保所有更新都會成功，或所有更新都會復原。</span><span class="sxs-lookup"><span data-stu-id="49aff-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="49aff-111">簡介</span><span class="sxs-lookup"><span data-stu-id="49aff-111">Introduction</span></span>

<span data-ttu-id="49aff-112">在[先前的教學](wrapping-database-modifications-within-a-transaction-vb.md)課程中，我們已瞭解如何擴充資料存取層，以加入資料庫交易的支援。</span><span class="sxs-lookup"><span data-stu-id="49aff-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="49aff-113">資料庫交易保證會將一系列的資料修改語句視為一個不可部分完成的作業，這可確保所有修改都會失敗，否則全部都會成功。</span><span class="sxs-lookup"><span data-stu-id="49aff-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="49aff-114">使用此低層級 DAL 功能時，我們已準備好將注意力轉換成建立批次資料修改介面。</span><span class="sxs-lookup"><span data-stu-id="49aff-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="49aff-115">在本教學課程中，我們將建立一個 GridView，其中每個資料列都可編輯（請參閱 [圖 1]）</span><span class="sxs-lookup"><span data-stu-id="49aff-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="49aff-116">因為每個資料列都是在其編輯介面中轉譯，所以不需要編輯、更新和取消按鈕的資料行。</span><span class="sxs-lookup"><span data-stu-id="49aff-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="49aff-117">相反地，頁面上有兩個 [更新產品] 按鈕，當您按一下時，會列舉 GridView 資料列並更新資料庫。</span><span class="sxs-lookup"><span data-stu-id="49aff-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="49aff-118">[GridView 中的每個資料列 ![都是可編輯的](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-118">[![Each Row in the GridView is Editable](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span></span>

<span data-ttu-id="49aff-119">**圖 1**： GridView 中的每個資料列都是可編輯的（[按一下以查看完整大小的影像](batch-updating-vb/_static/image2.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-vb/_static/image2.png))</span></span>

<span data-ttu-id="49aff-120">讓我們開始吧！</span><span class="sxs-lookup"><span data-stu-id="49aff-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="49aff-121">在[執行批次更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)教學課程中，我們使用 DataList 控制項來建立批次編輯介面。</span><span class="sxs-lookup"><span data-stu-id="49aff-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="49aff-122">本教學課程與中的上一個版本不同，後者是使用 GridView，而批次更新則是在交易的範圍內執行。</span><span class="sxs-lookup"><span data-stu-id="49aff-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="49aff-123">完成本教學課程之後，建議您回到先前的教學課程，並將其更新為使用上一個教學課程中新增的資料庫交易相關功能。</span><span class="sxs-lookup"><span data-stu-id="49aff-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="49aff-124">檢查將所有 GridView 資料列設為可編輯的步驟</span><span class="sxs-lookup"><span data-stu-id="49aff-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="49aff-125">如如何[插入、更新和刪除資料](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)教學課程中所述，GridView 提供了內建支援，可讓您以每一資料列為基礎來編輯其基礎資料。</span><span class="sxs-lookup"><span data-stu-id="49aff-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="49aff-126">就內部而言，GridView 會透過其[`EditIndex` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx)來說明哪些資料列可供編輯。</span><span class="sxs-lookup"><span data-stu-id="49aff-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="49aff-127">當 GridView 系結到它的資料來源時，它會檢查每個資料列，以查看資料列的索引是否等於 `EditIndex`的值。</span><span class="sxs-lookup"><span data-stu-id="49aff-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="49aff-128">若是如此，則會使用其編輯介面來呈現資料列的欄位。</span><span class="sxs-lookup"><span data-stu-id="49aff-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="49aff-129">針對 BoundFields，編輯介面是一個文字方塊，其 `Text` 屬性會被指派 BoundField s `DataField` 屬性所指定之資料欄位的值。</span><span class="sxs-lookup"><span data-stu-id="49aff-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="49aff-130">若為 TemplateFields，則會使用 `EditItemTemplate` 來取代 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="49aff-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="49aff-131">回想一下，編輯工作流程會在使用者按一下資料列的 [編輯] 按鈕時開始。</span><span class="sxs-lookup"><span data-stu-id="49aff-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="49aff-132">這會導致回傳，將 GridView 的 `EditIndex` 屬性設定為已按下的資料列 s 索引，然後將資料重新系結至方格。</span><span class="sxs-lookup"><span data-stu-id="49aff-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="49aff-133">按一下 [資料列] 的 [取消] 按鈕時，在回傳時，`EditIndex` 會設定為 `-1` 的值，然後再將資料重新系結至方格。</span><span class="sxs-lookup"><span data-stu-id="49aff-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="49aff-134">由於 GridView 的資料列會以零開始編制索引，將 `EditIndex` 設定為 `-1` 會影響以唯讀模式顯示 GridView。</span><span class="sxs-lookup"><span data-stu-id="49aff-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="49aff-135">`EditIndex` 屬性適用于每個資料列編輯，但不是針對批次編輯所設計。</span><span class="sxs-lookup"><span data-stu-id="49aff-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="49aff-136">為了讓整個 GridView 可供編輯，我們必須使用其編輯介面來呈現每個資料列。</span><span class="sxs-lookup"><span data-stu-id="49aff-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="49aff-137">完成這項工作的最簡單方式是建立，其中每個可編輯的欄位會實作為 TemplateField，並在 `ItemTemplate`中定義其編輯介面。</span><span class="sxs-lookup"><span data-stu-id="49aff-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="49aff-138">在接下來的幾個步驟中，我們將建立可完全編輯的 GridView。</span><span class="sxs-lookup"><span data-stu-id="49aff-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="49aff-139">在步驟1中，我們將從建立 GridView 和其 ObjectDataSource 開始，並將其 BoundFields 和 CheckBoxField 轉換成 TemplateFields。</span><span class="sxs-lookup"><span data-stu-id="49aff-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="49aff-140">在步驟2和3中，我們會將編輯介面從 TemplateFields `EditItemTemplate` s 移至其 `ItemTemplate` s。</span><span class="sxs-lookup"><span data-stu-id="49aff-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="49aff-141">步驟1：顯示產品資訊</span><span class="sxs-lookup"><span data-stu-id="49aff-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="49aff-142">在我們擔心建立可編輯資料列的 GridView 之前，讓我們先簡單顯示產品資訊。</span><span class="sxs-lookup"><span data-stu-id="49aff-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="49aff-143">開啟 [`BatchData`] 資料夾中的 [`BatchUpdate.aspx`] 頁面，並將 GridView 從 [工具箱] 拖曳至設計工具。</span><span class="sxs-lookup"><span data-stu-id="49aff-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="49aff-144">將 GridView 的 `ID` 設定為 `ProductsGrid` 並從其智慧標籤，選擇將其系結至名為 `ProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="49aff-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="49aff-145">設定 ObjectDataSource 以從 `ProductsBLL` 類別的 `GetProducts` 方法中取出其資料。</span><span class="sxs-lookup"><span data-stu-id="49aff-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="49aff-146">[![將 ObjectDataSource 設定為使用 ProductsBLL 類別](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span></span>

<span data-ttu-id="49aff-147">**圖 2**：設定 ObjectDataSource 使用 `ProductsBLL` 類別（[按一下以查看完整大小的影像](batch-updating-vb/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image4.png))</span></span>

<span data-ttu-id="49aff-148">[![使用 GetProducts 方法取出產品資料](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span></span>

<span data-ttu-id="49aff-149">**圖 3**：使用 `GetProducts` 方法取出產品資料（[按一下以觀看完整大小的影像](batch-updating-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-vb/_static/image6.png))</span></span>

<span data-ttu-id="49aff-150">就像 GridView 一樣，ObjectDataSource 的修改功能是設計為以每個資料列為基礎來處理。</span><span class="sxs-lookup"><span data-stu-id="49aff-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="49aff-151">若要更新一組記錄，我們必須在 ASP.NET 網頁的程式碼後置類別中撰寫一些程式碼，以批次處理資料並將其傳遞給 BLL。</span><span class="sxs-lookup"><span data-stu-id="49aff-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="49aff-152">因此，請將 [ObjectDataSource s 更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="49aff-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="49aff-153">按一下 [完成] 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="49aff-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="49aff-154">[![將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span></span>

<span data-ttu-id="49aff-155">**圖 4**：將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）] （[按一下以查看完整大小的影像](batch-updating-vb/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image8.png))</span></span>

<span data-ttu-id="49aff-156">完成 [設定資料來源] wizard 之後，ObjectDataSource 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="49aff-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample1.aspx)]

<span data-ttu-id="49aff-157">完成 [設定資料來源] wizard 也會導致 Visual Studio 為 GridView 中的產品資料欄位建立 BoundFields 和 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="49aff-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="49aff-158">在本教學課程中，我們只允許使用者查看和編輯產品的名稱、類別、價格和已停止的狀態。</span><span class="sxs-lookup"><span data-stu-id="49aff-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="49aff-159">移除所有 [`ProductName`]、[`CategoryName`]、[`UnitPrice`] 和 [`Discontinued`] 欄位，然後將前三個欄位的 `HeaderText` 屬性分別重新命名為 [產品]、[類別] 和 [價格]。</span><span class="sxs-lookup"><span data-stu-id="49aff-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="49aff-160">最後，檢查 GridView s 智慧標籤中的 [啟用分頁] 和 [啟用排序] 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="49aff-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="49aff-161">此時，GridView 有三個 BoundFields （`ProductName`、`CategoryName`和 `UnitPrice`）和一個 CheckBoxField （`Discontinued`）。</span><span class="sxs-lookup"><span data-stu-id="49aff-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="49aff-162">我們需要將這四個欄位轉換成 TemplateFields，然後將編輯介面從 TemplateField s `EditItemTemplate` 移到其 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="49aff-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="49aff-163">我們在[自訂資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教學課程中探索到建立和自訂 TemplateFields。</span><span class="sxs-lookup"><span data-stu-id="49aff-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span> <span data-ttu-id="49aff-164">我們會逐步解說將 BoundFields 和 CheckBoxField 轉換為 TemplateFields 的步驟，並在其 `ItemTemplate` 中定義其編輯介面，但如果您停滯或需要重新整理器，請不要回頭參考這個稍早的教學課程。</span><span class="sxs-lookup"><span data-stu-id="49aff-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="49aff-165">從 GridView 的智慧標籤中，按一下 [編輯資料行] 連結以開啟 [欄位] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="49aff-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="49aff-166">接下來，選取每個欄位，然後按一下 [將此欄位轉換成 TemplateField] 連結。</span><span class="sxs-lookup"><span data-stu-id="49aff-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![將現有的 BoundFields 和 CheckBoxField 轉換為 TemplateFields](batch-updating-vb/_static/image5.gif)

<span data-ttu-id="49aff-168">**圖 5**：將現有的 BoundFields 和 CheckBoxField 轉換成 TemplateFields</span><span class="sxs-lookup"><span data-stu-id="49aff-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateFields</span></span>

<span data-ttu-id="49aff-169">由於每個欄位都是 TemplateField，因此我們已準備好將編輯介面從 `EditItemTemplate` 移至 `ItemTemplate` s。</span><span class="sxs-lookup"><span data-stu-id="49aff-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="49aff-170">步驟2：建立`ProductName`、`UnitPrice`和`Discontinued`編輯介面</span><span class="sxs-lookup"><span data-stu-id="49aff-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="49aff-171">建立 `ProductName`、`UnitPrice`和 `Discontinued` 編輯介面是此步驟的主題，而且相當簡單，因為每個介面已在 TemplateField s `EditItemTemplate`中定義。</span><span class="sxs-lookup"><span data-stu-id="49aff-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="49aff-172">建立 `CategoryName` 的編輯介面比較複雜一點，因為我們需要建立適用類別的 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="49aff-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="49aff-173">此 `CategoryName` 編輯介面是在步驟3中破解。</span><span class="sxs-lookup"><span data-stu-id="49aff-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="49aff-174">讓我們從 `ProductName` TemplateField 開始。</span><span class="sxs-lookup"><span data-stu-id="49aff-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="49aff-175">按一下 GridView 的智慧標籤中的 [編輯範本] 連結，並向下切入至 `ProductName` TemplateField s `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="49aff-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="49aff-176">選取文字方塊，將它複製到剪貼簿，然後貼到 `ProductName` TemplateField s `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="49aff-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="49aff-177">將 [TextBox `ID`] 屬性變更為 [`ProductName`]。</span><span class="sxs-lookup"><span data-stu-id="49aff-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="49aff-178">接下來，將 RequiredFieldValidator 新增至 `ItemTemplate`，以確保使用者提供每個產品名稱的值。</span><span class="sxs-lookup"><span data-stu-id="49aff-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="49aff-179">將 [`ControlToValidate`] 屬性設定為 [ProductName]，您必須提供產品名稱的 [`ErrorMessage`] 屬性。</span><span class="sxs-lookup"><span data-stu-id="49aff-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="49aff-180">以及要 \*的 `Text` 屬性。</span><span class="sxs-lookup"><span data-stu-id="49aff-180">and the `Text` property to \*.</span></span> <span data-ttu-id="49aff-181">在 `ItemTemplate`新增這些專案之後，您的畫面看起來應該像 [圖 6]。</span><span class="sxs-lookup"><span data-stu-id="49aff-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="49aff-182">[![ProductName TemplateField 現在包含 TextBox 和 RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span></span>

<span data-ttu-id="49aff-183">**圖 6**： `ProductName` TemplateField 現在包含一個 TextBox 和一個 RequiredFieldValidator （[按一下以觀看完整大小的影像](batch-updating-vb/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-vb/_static/image10.png))</span></span>

<span data-ttu-id="49aff-184">針對 `UnitPrice` 編輯介面，從 `EditItemTemplate` 將 TextBox 複製到 `ItemTemplate`開始。</span><span class="sxs-lookup"><span data-stu-id="49aff-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="49aff-185">接下來，將 $ 放在文字方塊前面，並將其 [`ID`] 屬性設為 [單價]，並將其 [`Columns`] 屬性設定為8。</span><span class="sxs-lookup"><span data-stu-id="49aff-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="49aff-186">此外，也請將 CompareValidator 新增至 `UnitPrice` s `ItemTemplate`，以確保使用者輸入的值是大於或等於 $0.00 的有效貨幣值。</span><span class="sxs-lookup"><span data-stu-id="49aff-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="49aff-187">將驗證程式的 `ControlToValidate` 屬性設定為 [單價]，其 `ErrorMessage` 屬性必須輸入有效的貨幣值。</span><span class="sxs-lookup"><span data-stu-id="49aff-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="49aff-188">請省略任何貨幣符號。、其 `Text` 屬性來 \*、其 `Type` `Currency`屬性設為 [`Operator`]，而其 [`GreaterThanEqual`] 屬性設為0。</span><span class="sxs-lookup"><span data-stu-id="49aff-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="49aff-189">[![新增 CompareValidator，以確保輸入的價格是非負值的貨幣值](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span></span>

<span data-ttu-id="49aff-190">**圖 7**：新增 CompareValidator 以確保輸入的價格是非負值的貨幣值（[按一下以查看完整大小的影像](batch-updating-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-vb/_static/image12.png))</span></span>

<span data-ttu-id="49aff-191">針對 `Discontinued` TemplateField，您可以使用已在 `ItemTemplate`中定義的核取方塊。</span><span class="sxs-lookup"><span data-stu-id="49aff-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="49aff-192">只要將其 `ID` 設定為 已停止，並將其 `Enabled` 屬性設為 `True`。</span><span class="sxs-lookup"><span data-stu-id="49aff-192">Simply set its `ID` to Discontinued and its `Enabled` property to `True`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="49aff-193">步驟3：建立`CategoryName`編輯介面</span><span class="sxs-lookup"><span data-stu-id="49aff-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="49aff-194">[`CategoryName` TemplateField] `EditItemTemplate` 中的編輯介面包含一個文字方塊，其中顯示 `CategoryName` 資料欄位的值。</span><span class="sxs-lookup"><span data-stu-id="49aff-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="49aff-195">我們需要以列出可能分類的 DropDownList 來取代此程式。</span><span class="sxs-lookup"><span data-stu-id="49aff-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="49aff-196">[自訂資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教學課程包含更全面且完整的討論，可將範本自訂成包含 DropDownList，而不是文字方塊。</span><span class="sxs-lookup"><span data-stu-id="49aff-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="49aff-197">雖然這裡的步驟已完成，但會呈現 tersely。</span><span class="sxs-lookup"><span data-stu-id="49aff-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="49aff-198">若要深入瞭解如何建立和設定類別 DropDownList，請回頭參閱[自訂資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="49aff-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span>

<span data-ttu-id="49aff-199">從 [工具箱] 將 [DropDownList] 拖曳至 [`CategoryName`] TemplateField s `ItemTemplate`，將其 `ID` 設定為 [`Categories`]。</span><span class="sxs-lookup"><span data-stu-id="49aff-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="49aff-200">此時，我們通常會透過其智慧標籤定義 Dropdownlist 進行的資料來源，並建立新的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="49aff-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="49aff-201">不過，這會在 `ItemTemplate`內加入 ObjectDataSource，這會導致每個 GridView 資料列建立一個 ObjectDataSource 實例。</span><span class="sxs-lookup"><span data-stu-id="49aff-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="49aff-202">相反地，讓我們在 GridView 的 TemplateFields 外部建立 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="49aff-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="49aff-203">結束範本編輯，並從 [工具箱] 將 [ObjectDataSource] 拖曳至 [`ProductsDataSource` ObjectDataSource] 底下的設計工具。</span><span class="sxs-lookup"><span data-stu-id="49aff-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="49aff-204">將新的 ObjectDataSource 命名為 `CategoriesDataSource`，並將它設定為使用 `CategoriesBLL` 類別 s `GetCategories` 方法。</span><span class="sxs-lookup"><span data-stu-id="49aff-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="49aff-205">[![將 ObjectDataSource 設定為使用 CategoriesBLL 類別](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span></span>

<span data-ttu-id="49aff-206">**圖 8**：設定 ObjectDataSource 使用 `CategoriesBLL` 類別（[按一下以查看完整大小的影像](batch-updating-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image14.png))</span></span>

<span data-ttu-id="49aff-207">[![使用 GetCategories 方法取出類別目錄資料](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span></span>

<span data-ttu-id="49aff-208">**圖 9**：使用 `GetCategories` 方法抓取分類資料（[按一下以查看完整大小的影像](batch-updating-vb/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-vb/_static/image16.png))</span></span>

<span data-ttu-id="49aff-209">由於只會使用此 ObjectDataSource 來抓取資料，因此請將 [更新] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="49aff-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="49aff-210">按一下 [完成] 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="49aff-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="49aff-211">[![將 [更新] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span></span>

<span data-ttu-id="49aff-212">**圖 10**：將 [更新] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）] （[按一下以查看完整大小的影像](batch-updating-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image18.png))</span></span>

<span data-ttu-id="49aff-213">完成 wizard 之後，`CategoriesDataSource` 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="49aff-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample2.aspx)]

<span data-ttu-id="49aff-214">建立並設定 `CategoriesDataSource` 之後，請回到 `CategoryName` TemplateField s `ItemTemplate`，然後從 DropDownList s 智慧標籤，按一下 [選擇資料來源] 連結。</span><span class="sxs-lookup"><span data-stu-id="49aff-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="49aff-215">在 [資料來源設定] 嚮導中，從第一個下拉式清單中選取 [`CategoriesDataSource`] 選項，然後選擇讓 [`CategoryName`] 用來顯示和 `CategoryID` 作為值。</span><span class="sxs-lookup"><span data-stu-id="49aff-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="49aff-216">[![將 DropDownList 系結至 CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span></span>

<span data-ttu-id="49aff-217">**圖 11**：將 DropDownList 系結至 `CategoriesDataSource` （[按一下以查看完整大小的影像](batch-updating-vb/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-vb/_static/image20.png))</span></span>

<span data-ttu-id="49aff-218">此時，`Categories` DropDownList 會列出所有類別，但它還不會針對系結至 GridView 資料列的產品自動選取適當的類別。</span><span class="sxs-lookup"><span data-stu-id="49aff-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="49aff-219">若要完成這件工作，我們必須將 `Categories` DropDownList s `SelectedValue` 設定為 product s `CategoryID` 值。</span><span class="sxs-lookup"><span data-stu-id="49aff-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="49aff-220">按一下 DropDownList s 智慧標籤中的 [編輯資料系結] 連結，並將 [`SelectedValue`] 屬性與 [`CategoryID` 資料] 欄位建立關聯，如 [圖 12] 所示。</span><span class="sxs-lookup"><span data-stu-id="49aff-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![將產品的 [類別 1] 值系結至 DropDownList s SelectedValue 屬性](batch-updating-vb/_static/image12.gif)

<span data-ttu-id="49aff-222">**圖 12**：將產品的 `CategoryID` 值系結至 DropDownList s `SelectedValue` 屬性</span><span class="sxs-lookup"><span data-stu-id="49aff-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="49aff-223">最後一個問題仍然存在：如果產品沒有指定 `CategoryID` 值，則 `SelectedValue` 上的資料系結語句會導致例外狀況。</span><span class="sxs-lookup"><span data-stu-id="49aff-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="49aff-224">這是因為 DropDownList 只會包含類別目錄的專案，而且不會提供具有 `CategoryID`之 `NULL` 資料庫值之產品的選項。</span><span class="sxs-lookup"><span data-stu-id="49aff-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="49aff-225">若要解決這個問題，請將 DropDownList 的 `AppendDataBoundItems` 屬性設定為 `True`，並將新的專案加入至 DropDownList，並從宣告式語法中省略 `Value` 屬性。</span><span class="sxs-lookup"><span data-stu-id="49aff-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `True` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="49aff-226">也就是說，請確定 `Categories` DropDownList 的宣告式語法看起來如下：</span><span class="sxs-lookup"><span data-stu-id="49aff-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample3.aspx)]

<span data-ttu-id="49aff-227">請注意 `<asp:ListItem Value="">`--選取一個--將其 `Value` 屬性明確設定為空字串。</span><span class="sxs-lookup"><span data-stu-id="49aff-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="49aff-228">請回到[自訂資料修改介面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教學課程，以深入瞭解為何需要這個額外的 DropDownList 專案來處理 `NULL` 案例，以及為什麼將 `Value` 屬性指派給空字串是不可或缺的。</span><span class="sxs-lookup"><span data-stu-id="49aff-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="49aff-229">這裡有潛在的效能和擴充性問題，值得一提。</span><span class="sxs-lookup"><span data-stu-id="49aff-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="49aff-230">由於每個資料列都有一個使用 `CategoriesDataSource` 做為其資料來源的 DropDownList，因此每個頁面的 `CategoriesBLL` 類別 s `GetCategories` 方法將會被呼叫*n*次，其中*n*是 GridView 中的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="49aff-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="49aff-231">這些*n*呼叫 `GetCategories` 會導致資料庫的*n*個查詢。</span><span class="sxs-lookup"><span data-stu-id="49aff-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="49aff-232">藉由在每個要求快取中快取傳回的分類，或透過使用 SQL 快取相依性的快取層或非常短的以時間為基礎的到期，可以降低對資料庫的影響。</span><span class="sxs-lookup"><span data-stu-id="49aff-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="49aff-233">如需有關每個要求快取選項的詳細資訊，請參閱[`HttpContext.Items` 每個要求的快取存放區](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="49aff-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="49aff-234">步驟4：完成編輯介面</span><span class="sxs-lookup"><span data-stu-id="49aff-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="49aff-235">我們對 GridView 的範本進行了一些變更，而不需要暫停來觀看我們的進度。</span><span class="sxs-lookup"><span data-stu-id="49aff-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="49aff-236">請花點時間透過瀏覽器來查看進度。</span><span class="sxs-lookup"><span data-stu-id="49aff-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="49aff-237">如 [圖 13] 所示，每個資料列都是使用其 `ItemTemplate`來呈現，其中包含儲存格的編輯介面。</span><span class="sxs-lookup"><span data-stu-id="49aff-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="49aff-238">[![每個 GridView 資料列都是可編輯的](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-238">[![Each GridView Row is Editable](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span></span>

<span data-ttu-id="49aff-239">**圖 13**：每個 GridView 資料列都是可編輯的（[按一下以查看完整大小的影像](batch-updating-vb/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-vb/_static/image22.png))</span></span>

<span data-ttu-id="49aff-240">這裡有幾個次要的格式問題，我們應該要注意。</span><span class="sxs-lookup"><span data-stu-id="49aff-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="49aff-241">首先，請注意，`UnitPrice` 值包含四個小數點。</span><span class="sxs-lookup"><span data-stu-id="49aff-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="49aff-242">若要修正此問題，請回到 `UnitPrice` TemplateField s `ItemTemplate`，然後從 TextBox 的智慧標籤，按一下 [編輯系結] 連結。</span><span class="sxs-lookup"><span data-stu-id="49aff-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="49aff-243">接下來，指定 `Text` 屬性應格式化為數位。</span><span class="sxs-lookup"><span data-stu-id="49aff-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![將文字屬性格式化為數位](batch-updating-vb/_static/image14.gif)

<span data-ttu-id="49aff-245">**圖 14**：將 `Text` 屬性格式化為數位</span><span class="sxs-lookup"><span data-stu-id="49aff-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="49aff-246">第二，讓我們將 [`Discontinued`] 欄中的核取方塊置中（而不是靠左對齊）。</span><span class="sxs-lookup"><span data-stu-id="49aff-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="49aff-247">在 [GridView] 智慧標籤中按一下 [編輯資料行]，然後從左下角的欄位清單中選取 [`Discontinued` TemplateField]。</span><span class="sxs-lookup"><span data-stu-id="49aff-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="49aff-248">向下切入 `ItemStyle`，並將 `HorizontalAlign` 屬性設定為 [中心]，如 [圖 15] 所示。</span><span class="sxs-lookup"><span data-stu-id="49aff-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![停用 [已停止] 核取方塊](batch-updating-vb/_static/image15.gif)

<span data-ttu-id="49aff-250">**圖 15**：將 `Discontinued` 核取方塊置中</span><span class="sxs-lookup"><span data-stu-id="49aff-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="49aff-251">接下來，將 ValidationSummary 控制項新增至頁面，並將其 `ShowMessageBox` 屬性設為 `True`，並將其 `ShowSummary` 屬性設定為 `False`。</span><span class="sxs-lookup"><span data-stu-id="49aff-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="49aff-252">此外，新增按鈕 Web 控制項，按一下之後，將會更新使用者的變更。</span><span class="sxs-lookup"><span data-stu-id="49aff-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="49aff-253">具體來說，請新增兩個按鈕 Web 控制項，一個在 GridView 上方，另一個放在其底下，將兩個控制項設定 `Text` 屬性來更新產品。</span><span class="sxs-lookup"><span data-stu-id="49aff-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="49aff-254">由於 GridView s 編輯介面是在其 TemplateFields `ItemTemplate` s 中定義，因此 `EditItemTemplate` 是多餘的，而且可能會被刪除。</span><span class="sxs-lookup"><span data-stu-id="49aff-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="49aff-255">在上述的格式變更、加入按鈕控制項，以及移除不必要的 `EditItemTemplate` 之後，您的頁面的宣告式語法應如下所示：</span><span class="sxs-lookup"><span data-stu-id="49aff-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample4.aspx)]

<span data-ttu-id="49aff-256">[圖 16] 顯示在新增按鈕 Web 控制項及進行格式變更之後，透過瀏覽器觀看此頁面。</span><span class="sxs-lookup"><span data-stu-id="49aff-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="49aff-257">[![頁面現在包含兩個 [更新產品] 按鈕](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="49aff-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span></span>

<span data-ttu-id="49aff-258">**圖 16**：此頁面現在包含兩個 [更新產品] 按鈕（[按一下以觀看完整大小的影像](batch-updating-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="49aff-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-vb/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="49aff-259">步驟5：更新產品</span><span class="sxs-lookup"><span data-stu-id="49aff-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="49aff-260">當使用者造訪此頁面時，他們會進行修改，然後按一下兩個 [更新產品] 按鈕的其中一個。</span><span class="sxs-lookup"><span data-stu-id="49aff-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="49aff-261">此時，我們必須以某種方式將每個資料列的使用者輸入值儲存到 `ProductsDataTable` 實例中，然後將其傳遞給 BLL 方法，然後將該 `ProductsDataTable` 實例傳遞給 DAL s `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="49aff-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="49aff-262">在[先前的教學](wrapping-database-modifications-within-a-transaction-vb.md)課程中建立的 `UpdateWithTransaction` 方法，可確保變更批次會更新為不可部分完成的作業。</span><span class="sxs-lookup"><span data-stu-id="49aff-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="49aff-263">在 `BatchUpdate.aspx.vb` 中建立名為 `BatchUpdate` 的方法，並新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="49aff-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.vb` and add the following code:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample5.vb)]

<span data-ttu-id="49aff-264">這個方法一開始會透過呼叫 BLL 的 `GetProducts` 方法來取得 `ProductsDataTable` 中的所有產品。</span><span class="sxs-lookup"><span data-stu-id="49aff-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="49aff-265">然後，它會列舉 `ProductGrid` GridView s [`Rows` 集合](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="49aff-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="49aff-266">`Rows` 集合包含 GridView 中顯示之每個資料列的[`GridViewRow` 實例](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx)。</span><span class="sxs-lookup"><span data-stu-id="49aff-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="49aff-267">因為我們在每個頁面上最多顯示10個數據列，所以 GridView 的 `Rows` 集合不會有10個以上的專案。</span><span class="sxs-lookup"><span data-stu-id="49aff-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="49aff-268">針對每個資料列，會從 `DataKeys` 集合中抓取 `ProductID`，並從 `ProductsDataTable`選取適當的 `ProductsRow`。</span><span class="sxs-lookup"><span data-stu-id="49aff-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="49aff-269">四個 TemplateField 輸入控制項會以程式設計方式參考，並將其值指派給 `ProductsRow` 實例的屬性。</span><span class="sxs-lookup"><span data-stu-id="49aff-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="49aff-270">在每個 GridView 資料列的值都已經用來更新 `ProductsDataTable`之後，它就會傳遞給 BLL 的 `UpdateWithTransaction` 方法，如同我們在先前的教學課程中所見，只要向下呼叫 DAL s `UpdateWithTransaction` 方法即可。</span><span class="sxs-lookup"><span data-stu-id="49aff-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="49aff-271">本教學課程所使用的批次更新演算法會更新對應至 GridView 中某個資料列之 `ProductsDataTable` 中的每個資料列，而不論產品的資訊是否已變更。</span><span class="sxs-lookup"><span data-stu-id="49aff-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="49aff-272">雖然這類盲人更新通常不會造成效能問題，但如果您重新審核資料庫資料表的變更，它們可能會導致多餘的記錄。</span><span class="sxs-lookup"><span data-stu-id="49aff-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="49aff-273">回到執行中的[批次更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)教學課程，我們探索了批次更新介面與 DataList，並新增了只會更新使用者實際修改之記錄的程式碼。</span><span class="sxs-lookup"><span data-stu-id="49aff-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="49aff-274">如有需要，您可以隨意使用[執行批次更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)的技術來更新本教學課程中的程式碼。</span><span class="sxs-lookup"><span data-stu-id="49aff-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="49aff-275">透過智慧標籤將資料來源系結至 GridView 時，Visual Studio 會自動將資料來源的主要索引鍵值指派給 GridView 的 `DataKeyNames` 屬性。</span><span class="sxs-lookup"><span data-stu-id="49aff-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="49aff-276">如果您未透過 GridView 的智慧標籤將 ObjectDataSource 系結至 GridView （如步驟1所述），則您必須手動將 GridView 的 `DataKeyNames` 屬性設定為 ProductID，才能透過 `DataKeys` 集合來存取每個資料列的 `ProductID` 值。</span><span class="sxs-lookup"><span data-stu-id="49aff-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="49aff-277">`BatchUpdate` 中使用的程式碼與 BLL `UpdateProduct` 方法中所使用的程式碼相似，主要差異在於，在 `UpdateProduct` 方法中，只有單一 `ProductRow` 實例會從架構中抓取。</span><span class="sxs-lookup"><span data-stu-id="49aff-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="49aff-278">指派 `ProductRow` 屬性的程式碼，在 `BatchUpdate`的 `For Each` 迴圈中的 `UpdateProducts` 方法和程式碼之間是一樣的，如同整體模式一樣。</span><span class="sxs-lookup"><span data-stu-id="49aff-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `For Each` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="49aff-279">若要完成本教學課程，當您按一下 [更新產品] 按鈕時，我們必須叫用 `BatchUpdate` 方法。</span><span class="sxs-lookup"><span data-stu-id="49aff-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="49aff-280">為這兩個按鈕控制項的 `Click` 事件建立事件處理常式，並在事件處理常式中新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="49aff-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample6.vb)]

<span data-ttu-id="49aff-281">首先，對 `BatchUpdate`進行呼叫。</span><span class="sxs-lookup"><span data-stu-id="49aff-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="49aff-282">接下來， [`ClientScript` 屬性](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx)會用來插入 JavaScript，以顯示會讀取已更新產品的 messagebox。</span><span class="sxs-lookup"><span data-stu-id="49aff-282">Next, the [`ClientScript` property](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx) is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="49aff-283">請花幾分鐘的時間來測試此程式碼。</span><span class="sxs-lookup"><span data-stu-id="49aff-283">Take a minute to test out this code.</span></span> <span data-ttu-id="49aff-284">透過瀏覽器造訪 `BatchUpdate.aspx`，編輯一些資料列，然後按一下其中一個 [更新產品] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="49aff-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="49aff-285">假設沒有輸入驗證錯誤，您應該會看到一個讀取已更新產品的 messagebox。</span><span class="sxs-lookup"><span data-stu-id="49aff-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="49aff-286">若要驗證更新的不可部分完成性，請考慮新增隨機的 `CHECK` 條件約束，例如不允許1234.56 值 `UnitPrice` 的限制。</span><span class="sxs-lookup"><span data-stu-id="49aff-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="49aff-287">然後從 `BatchUpdate.aspx`編輯一些記錄，並確定將其中一個產品的 `UnitPrice` 值設定為禁止的值（1234.56）。</span><span class="sxs-lookup"><span data-stu-id="49aff-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="49aff-288">當您按一下 [更新產品] 時，如果將批次作業中的其他變更回復成其原始值，這應該會產生錯誤。</span><span class="sxs-lookup"><span data-stu-id="49aff-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="49aff-289">替代的`BatchUpdate`方法</span><span class="sxs-lookup"><span data-stu-id="49aff-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="49aff-290">我們剛才檢查的 `BatchUpdate` 方法會從 BLL 的 `GetProducts` 方法中抓取*所有*產品，然後只更新出現在 GridView 中的記錄。</span><span class="sxs-lookup"><span data-stu-id="49aff-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="49aff-291">如果 GridView 不使用分頁，這種方法就很理想，但如果有的話，可能會有數百、數千或數萬項產品，但 GridView 中只有10個數據列。</span><span class="sxs-lookup"><span data-stu-id="49aff-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="49aff-292">在這種情況下，從資料庫取得所有產品只是為了修改其中的10個，並不是理想的選擇。</span><span class="sxs-lookup"><span data-stu-id="49aff-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="49aff-293">針對這些類型的情況，請考慮改為使用下列 `BatchUpdateAlternate` 方法：</span><span class="sxs-lookup"><span data-stu-id="49aff-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample7.vb)]

<span data-ttu-id="49aff-294">`BatchMethodAlternate` 從建立名為 `products`的新空 `ProductsDataTable` 開始。</span><span class="sxs-lookup"><span data-stu-id="49aff-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="49aff-295">然後逐步執行 GridView 的 `Rows` 集合，並針對每個資料列使用 BLL 的 `GetProductByProductID(productID)` 方法來取得特定的產品資訊。</span><span class="sxs-lookup"><span data-stu-id="49aff-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="49aff-296">抓取的 `ProductsRow` 實例會以 `BatchUpdate`的相同方式更新其屬性，但在更新資料列之後，它會透過 DataTable [`ImportRow(DataRow)` 方法](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx)匯入至 `products` `ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="49aff-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products` `ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="49aff-297">在 `For Each` 迴圈完成之後，`products` 會針對 GridView 中的每個資料列包含一個 `ProductsRow` 實例。</span><span class="sxs-lookup"><span data-stu-id="49aff-297">After the `For Each` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="49aff-298">由於每個 `ProductsRow` 實例都已加入至 `products` （而不是更新），因此，如果我們盲目地將它傳遞給 `UpdateWithTransaction` 方法，`ProductsTableAdapter` 會嘗試將每個記錄插入資料庫中。</span><span class="sxs-lookup"><span data-stu-id="49aff-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="49aff-299">相反地，我們需要指定每個資料列都已修改（未加入）。</span><span class="sxs-lookup"><span data-stu-id="49aff-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="49aff-300">這可以藉由將新的方法加入至名為 `UpdateProductsWithTransaction`的 BLL 來完成。</span><span class="sxs-lookup"><span data-stu-id="49aff-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="49aff-301">`UpdateProductsWithTransaction`（如下所示）會將 `ProductsDataTable` 中每個 `ProductsRow` 實例的 `RowState` 設定為 `Modified`，然後將 `ProductsDataTable` 傳遞給 DAL s `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="49aff-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample8.vb)]

## <a name="summary"></a><span data-ttu-id="49aff-302">總結</span><span class="sxs-lookup"><span data-stu-id="49aff-302">Summary</span></span>

<span data-ttu-id="49aff-303">GridView 提供內建的每個資料列編輯功能，但缺少建立完全可編輯介面的支援。</span><span class="sxs-lookup"><span data-stu-id="49aff-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="49aff-304">如我們在本教學課程中所見，這類介面是可行的，但需要一些工作。</span><span class="sxs-lookup"><span data-stu-id="49aff-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="49aff-305">若要建立 GridView，其中每個資料列都是可編輯的，我們需要將 GridView 的欄位轉換成 TemplateFields，並在 `ItemTemplate` 內定義編輯介面。</span><span class="sxs-lookup"><span data-stu-id="49aff-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="49aff-306">此外，您必須將 [更新全部類型] 按鈕 Web 控制項加入至該頁面，並與 GridView 分開。</span><span class="sxs-lookup"><span data-stu-id="49aff-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="49aff-307">這些按鈕 `Click` 事件處理常式需要列舉 GridView 的 `Rows` 集合、將變更儲存在 `ProductsDataTable`中，然後將更新的資訊傳遞至適當的 BLL 方法。</span><span class="sxs-lookup"><span data-stu-id="49aff-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="49aff-308">在下一個教學課程中，我們將瞭解如何建立用於批次刪除的介面。</span><span class="sxs-lookup"><span data-stu-id="49aff-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="49aff-309">特別是，每個 GridView 資料列都會包含一個核取方塊，而不是更新全部類型的按鈕，我們將會刪除選取的資料列按鈕。</span><span class="sxs-lookup"><span data-stu-id="49aff-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="49aff-310">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="49aff-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="49aff-311">關於作者</span><span class="sxs-lookup"><span data-stu-id="49aff-311">About the Author</span></span>

<span data-ttu-id="49aff-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="49aff-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="49aff-313">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="49aff-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="49aff-314">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="49aff-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="49aff-315">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="49aff-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="49aff-316">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="49aff-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="49aff-317">特別感謝</span><span class="sxs-lookup"><span data-stu-id="49aff-317">Special Thanks To</span></span>

<span data-ttu-id="49aff-318">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="49aff-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="49aff-319">本教學課程的領導審查者為 Teresa Murphy 和 David Suru。</span><span class="sxs-lookup"><span data-stu-id="49aff-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="49aff-320">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="49aff-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="49aff-321">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="49aff-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="49aff-322">[上一頁](wrapping-database-modifications-within-a-transaction-vb.md)
> [下一頁](batch-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="49aff-322">[Previous](wrapping-database-modifications-within-a-transaction-vb.md)
[Next](batch-deleting-vb.md)</span></span>
