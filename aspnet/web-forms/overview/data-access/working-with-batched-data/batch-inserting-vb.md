---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
title: 批次插入（VB） |Microsoft Docs
author: rick-anderson
description: 瞭解如何在單一作業中插入多個資料庫記錄。 在使用者介面層中，我們延伸了 GridView，讓使用者可以輸入多個 n 。
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 48e2a4ae-77ca-4208-a204-c38c690ffb59
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
msc.type: authoredcontent
ms.openlocfilehash: 413a0e209b1899414eaab70aff07ee0d3223f28f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78618570"
---
# <a name="batch-inserting-vb"></a><span data-ttu-id="3a23e-104">批次插入 (VB)</span><span class="sxs-lookup"><span data-stu-id="3a23e-104">Batch Inserting (VB)</span></span>

<span data-ttu-id="3a23e-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3a23e-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3a23e-106">[下載程式代碼](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip)或[下載 PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="3a23e-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip) or [Download PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span></span>

> <span data-ttu-id="3a23e-107">瞭解如何在單一作業中插入多個資料庫記錄。</span><span class="sxs-lookup"><span data-stu-id="3a23e-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="3a23e-108">在使用者介面層中，我們延伸了 GridView，讓使用者可以輸入多個新記錄。</span><span class="sxs-lookup"><span data-stu-id="3a23e-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="3a23e-109">在資料存取層中，我們會將多個插入作業包裝在交易中，以確保所有插入都成功，或所有插入都已回復。</span><span class="sxs-lookup"><span data-stu-id="3a23e-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="3a23e-110">簡介</span><span class="sxs-lookup"><span data-stu-id="3a23e-110">Introduction</span></span>

<span data-ttu-id="3a23e-111">在[批次更新](batch-updating-vb.md)教學課程中，我們探討了自訂 GridView 控制項來呈現可編輯多筆記錄的介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-111">In the [Batch Updating](batch-updating-vb.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="3a23e-112">流覽頁面的使用者可以進行一系列的變更，然後按一下滑鼠按鍵，執行批次更新。</span><span class="sxs-lookup"><span data-stu-id="3a23e-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="3a23e-113">在使用者經常更新許多筆記錄的情況下，相較于在[插入、更新和刪除資料](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)教學課程的總覽中第一次探索的預設個別列編輯功能，這類介面可以節省無數點按和鍵盤到滑鼠的內容切換。</span><span class="sxs-lookup"><span data-stu-id="3a23e-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial.</span></span>

<span data-ttu-id="3a23e-114">這種概念也可以在加入記錄時套用。</span><span class="sxs-lookup"><span data-stu-id="3a23e-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="3a23e-115">想像一下，在 Northwind 商貿中，我們通常會收到供應商的出貨，其中包含特定類別的多項產品。</span><span class="sxs-lookup"><span data-stu-id="3a23e-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="3a23e-116">例如，我們可能會收到來自東京貿易的六個不同茶和咖啡產品的出貨。</span><span class="sxs-lookup"><span data-stu-id="3a23e-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="3a23e-117">如果使用者透過 DetailsView 控制項一次輸入六個產品，他們就必須再次選擇許多相同的值：他們必須選擇相同的類別（飲料）、相同的供應商（東京貿易）、相同的已中斷值（False）和順序值的相同單位（0）。</span><span class="sxs-lookup"><span data-stu-id="3a23e-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="3a23e-118">這個重複的資料輸入不僅耗時，而且容易發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="3a23e-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="3a23e-119">有了一些工作，我們可以建立一個批次插入介面，讓使用者選擇一次供應商和類別，輸入一系列產品名稱和單位價格，然後按一下按鈕將新產品新增至資料庫（請參閱 [圖 1]）。</span><span class="sxs-lookup"><span data-stu-id="3a23e-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="3a23e-120">隨著每個產品的加入，其 `ProductName` 和 `UnitPrice` 資料欄位都會指派文字方塊中輸入的值，而其 `CategoryID` 和 `SupplierID` 值會從表單頂端的 Dropdownlist 進行中指派值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="3a23e-121">`Discontinued` 和 `UnitsOnOrder` 值會分別設定為 `False` 和0的硬式編碼值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `False` and 0, respectively.</span></span>

<span data-ttu-id="3a23e-122">[![批次插入介面](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-122">[![The Batch Inserting Interface](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span></span>

<span data-ttu-id="3a23e-123">**圖 1**：批次插入介面（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-vb/_static/image3.png))</span></span>

<span data-ttu-id="3a23e-124">在本教學課程中，我們將建立一個頁面，以執行 [圖 1] 所示的批次插入介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="3a23e-125">如同先前的兩個教學課程，我們會將插入內容包裝在交易範圍內，以確保不可部分完成性。</span><span class="sxs-lookup"><span data-stu-id="3a23e-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="3a23e-126">讓我們開始吧！</span><span class="sxs-lookup"><span data-stu-id="3a23e-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="3a23e-127">步驟1：建立顯示介面</span><span class="sxs-lookup"><span data-stu-id="3a23e-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="3a23e-128">本教學課程將包含分成兩個區域的單一頁面：顯示區域和插入區域。</span><span class="sxs-lookup"><span data-stu-id="3a23e-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="3a23e-129">我們將在此步驟中建立的顯示介面會顯示 GridView 中的產品，並包含標題為 [處理產品出貨] 的按鈕。</span><span class="sxs-lookup"><span data-stu-id="3a23e-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="3a23e-130">按一下此按鈕時，會以插入介面取代顯示介面，如 [圖 1] 所示。</span><span class="sxs-lookup"><span data-stu-id="3a23e-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="3a23e-131">當您按一下 [從出貨新增產品] 或 [取消] 按鈕之後，顯示介面就會返回。</span><span class="sxs-lookup"><span data-stu-id="3a23e-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="3a23e-132">我們將在步驟2中建立插入介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="3a23e-133">建立具有兩個介面的頁面時，一次只會顯示其中一個，而每個介面通常會放在[面板 Web 控制項](http://www.w3schools.com/aspnet/control_panel.asp)內，做為其他控制項的容器。</span><span class="sxs-lookup"><span data-stu-id="3a23e-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="3a23e-134">因此，我們的頁面會針對每個介面控制一個面板。</span><span class="sxs-lookup"><span data-stu-id="3a23e-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="3a23e-135">一開始先開啟 [`BatchData`] 資料夾中的 [`BatchInsert.aspx`] 頁面，並將面板從 [工具箱] 拖曳至設計工具（請參閱 [圖 2]）。</span><span class="sxs-lookup"><span data-stu-id="3a23e-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="3a23e-136">將面板的 `ID` 屬性設定為 [`DisplayInterface`]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="3a23e-137">將面板新增至設計工具時，其 [`Height`] 和 [`Width`] 屬性會分別設定為50px 和125px。</span><span class="sxs-lookup"><span data-stu-id="3a23e-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="3a23e-138">清除屬性視窗中的這些屬性值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-138">Clear out these property values from the Properties window.</span></span>

<span data-ttu-id="3a23e-139">[![將面板從 [工具箱] 拖曳至設計工具](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span></span>

<span data-ttu-id="3a23e-140">**圖 2**：將面板從 [工具箱] 拖曳至設計工具（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-vb/_static/image6.png))</span></span>

<span data-ttu-id="3a23e-141">接下來，將 [按鈕] 和 [GridView] 控制項拖曳至面板。</span><span class="sxs-lookup"><span data-stu-id="3a23e-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="3a23e-142">將 [按鈕 `ID`] 屬性設定為 [`ProcessShipment`] 和其 [`Text`] 屬性，以處理產品出貨。</span><span class="sxs-lookup"><span data-stu-id="3a23e-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="3a23e-143">將 GridView 的 `ID` 屬性設定為 `ProductsGrid`，並將其從智慧標籤系結至名為 `ProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="3a23e-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="3a23e-144">設定 ObjectDataSource 以從 `ProductsBLL` 類別的 `GetProducts` 方法提取其資料。</span><span class="sxs-lookup"><span data-stu-id="3a23e-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="3a23e-145">由於此 GridView 僅用於顯示資料，因此請將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="3a23e-146">按一下 [完成] 完成 [設定資料來源嚮導]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-146">Click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="3a23e-147">[![顯示從 ProductsBLL 類別 s GetProducts 方法傳回的資料](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span></span>

<span data-ttu-id="3a23e-148">**圖 3**：顯示從 `ProductsBLL` 類別的 `GetProducts` 方法傳回的資料（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-vb/_static/image9.png))</span></span>

<span data-ttu-id="3a23e-149">[![將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span></span>

<span data-ttu-id="3a23e-150">**圖 4**：將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）] （[按一下以查看完整大小的影像](batch-inserting-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-vb/_static/image12.png))</span></span>

<span data-ttu-id="3a23e-151">完成 ObjectDataSource wizard 之後，Visual Studio 會為產品資料欄位新增 BoundFields 和 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="3a23e-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="3a23e-152">移除除了 [`ProductName`]、[`CategoryName`]、[`SupplierName`]、[`UnitPrice`] 和 [`Discontinued`] 欄位以外的所有</span><span class="sxs-lookup"><span data-stu-id="3a23e-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="3a23e-153">您可以隨意進行任何美觀自訂。</span><span class="sxs-lookup"><span data-stu-id="3a23e-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="3a23e-154">我決定將 `UnitPrice` 欄位格式化為貨幣值、重新排序欄位，並將數個欄位重新命名 `HeaderText` 值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="3a23e-155">此外，請檢查 GridView s 智慧標籤中的 [啟用分頁] 和 [啟用排序] 核取方塊，以將 GridView 設定為包含分頁和排序支援。</span><span class="sxs-lookup"><span data-stu-id="3a23e-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="3a23e-156">加入面板、按鈕、GridView 和 ObjectDataSource 控制項並自訂 GridView 欄位之後，您的頁面宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="3a23e-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](batch-inserting-vb/samples/sample1.aspx)]

<span data-ttu-id="3a23e-157">請注意，按鈕和 GridView 的標記會出現在開頭和結尾 `<asp:Panel>` 標記內。</span><span class="sxs-lookup"><span data-stu-id="3a23e-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="3a23e-158">由於這些控制項位於 `DisplayInterface` 面板中，因此只要將面板的 `Visible` 屬性設定為 [`False`]，就可以隱藏它們。</span><span class="sxs-lookup"><span data-stu-id="3a23e-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `False`.</span></span> <span data-ttu-id="3a23e-159">步驟3查看以程式設計方式變更面板的 `Visible` 屬性，以回應按鈕按一下以顯示一個介面，同時隱藏另一個介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="3a23e-160">請花點時間透過瀏覽器來查看進度。</span><span class="sxs-lookup"><span data-stu-id="3a23e-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="3a23e-161">如 [圖 5] 所示，您應該會在 GridView 上方看到一個 [處理產品出貨] 按鈕，其中列出一次的產品十個。</span><span class="sxs-lookup"><span data-stu-id="3a23e-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>

<span data-ttu-id="3a23e-162">[![GridView 列出產品並提供排序和分頁功能](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span></span>

<span data-ttu-id="3a23e-163">**圖 5**： GridView 會列出產品並提供排序和分頁功能（[按一下以觀看完整大小的影像](batch-inserting-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-vb/_static/image15.png))</span></span>

## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="3a23e-164">步驟2：建立插入介面</span><span class="sxs-lookup"><span data-stu-id="3a23e-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="3a23e-165">顯示介面完成後，我們就可以開始建立插入介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="3a23e-166">在本教學課程中，我們將建立一個插入介面，它會提示您輸入單一供應商和類別目錄值，然後允許使用者輸入最多五個產品名稱和單位價格值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="3a23e-167">在此介面中，使用者可以新增一到五個新產品，全都共用相同的類別和供應商，但擁有唯一的產品名稱和價格。</span><span class="sxs-lookup"><span data-stu-id="3a23e-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="3a23e-168">從 [工具箱] 將面板拖曳到設計工具上，然後將它放在現有的 `DisplayInterface` 面板底下。</span><span class="sxs-lookup"><span data-stu-id="3a23e-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="3a23e-169">將這個新加入之面板的 `ID` 屬性設定為 [`InsertingInterface`]，並將其 [`Visible`] 屬性設定為 [`False`]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `False`.</span></span> <span data-ttu-id="3a23e-170">我們會新增程式碼，將 `InsertingInterface` 面板的 `Visible` 屬性設定為步驟3中的 `True`。</span><span class="sxs-lookup"><span data-stu-id="3a23e-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `True` in Step 3.</span></span> <span data-ttu-id="3a23e-171">也請清除面板的 `Height`，並 `Width` 屬性值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="3a23e-172">接下來，我們需要建立如 [圖 1] 所示的插入介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="3a23e-173">這個介面可以透過各種 HTML 技術來建立，但我們會使用一個相當簡單的方法：四個數據行、七個數據列的資料表。</span><span class="sxs-lookup"><span data-stu-id="3a23e-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="3a23e-174">輸入 HTML `<table>` 元素的標記時，我偏好使用來源視圖。</span><span class="sxs-lookup"><span data-stu-id="3a23e-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="3a23e-175">雖然 Visual Studio 的確有工具可透過設計工具加入 `<table>` 元素，但設計工具似乎都不願意將 `style` 設定的 unasked 插入標記中。</span><span class="sxs-lookup"><span data-stu-id="3a23e-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="3a23e-176">建立 `<table>` 標記之後，我通常會回到設計工具來加入 Web 控制項並設定其屬性。</span><span class="sxs-lookup"><span data-stu-id="3a23e-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="3a23e-177">建立具有預先決定之資料行和資料列的資料表時，我偏好使用靜態 HTML，而不是[資料表 web 控制項](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx)，因為放置在資料表 web 控制項內的任何 Web 控制項只能使用 `FindControl("controlID")` 模式來存取。</span><span class="sxs-lookup"><span data-stu-id="3a23e-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="3a23e-178">不過，我會針對動態大小的資料表（其資料列或資料行是以某些資料庫或使用者指定的準則為基礎）使用資料表 Web 控制項，因為可以用程式設計的方式來構造資料表 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="3a23e-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>

<span data-ttu-id="3a23e-179">在 `InsertingInterface` 面板的 `<asp:Panel>` 標籤內輸入下列標記：</span><span class="sxs-lookup"><span data-stu-id="3a23e-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>

[!code-html[Main](batch-inserting-vb/samples/sample2.html)]

<span data-ttu-id="3a23e-180">此 `<table>` 標記尚未包含任何 Web 控制項，我們會暫時新增這些控制項。</span><span class="sxs-lookup"><span data-stu-id="3a23e-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="3a23e-181">請注意，每個 `<tr>` 元素都包含特定的 CSS 類別設定： `BatchInsertHeaderRow`，供供應商和類別 Dropdownlist 進行的標頭資料列使用;針對頁尾資料列 `BatchInsertFooterRow`，其中 [從出貨] 和 [取消] 按鈕的 [加入產品] 將會執行;以及將包含 [產品] 和 [單價] 文字方塊控制項之資料列的替代 `BatchInsertRow` 和 `BatchInsertAlternatingRow` 值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="3a23e-182">我在 `Styles.css` 檔案中建立了對應的 CSS 類別，讓插入介面的外觀類似于我們在這些教學課程中使用的 GridView 和 DetailsView 控制項。</span><span class="sxs-lookup"><span data-stu-id="3a23e-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="3a23e-183">這些 CSS 類別如下所示。</span><span class="sxs-lookup"><span data-stu-id="3a23e-183">These CSS classes are shown below.</span></span>

[!code-css[Main](batch-inserting-vb/samples/sample3.css)]

<span data-ttu-id="3a23e-184">輸入此標記之後，請返回設計檢視。</span><span class="sxs-lookup"><span data-stu-id="3a23e-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="3a23e-185">此 `<table>` 應該會在設計工具中顯示為四個數據行、七個數據列的資料表，如 [圖 6] 所示。</span><span class="sxs-lookup"><span data-stu-id="3a23e-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>

<span data-ttu-id="3a23e-186">[插入介面 ![包含四個數據行、七個數據列的資料表](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span></span>

<span data-ttu-id="3a23e-187">**圖 6**：插入介面包含四個數據行、七個數據列的資料表（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-vb/_static/image18.png))</span></span>

<span data-ttu-id="3a23e-188">我們現在已準備好將 Web 控制項新增至插入介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="3a23e-189">將兩個 Dropdownlist 進行從 [工具箱] 拖曳到資料表中適用于供應商的適當資料格，而另一個用於類別目錄。</span><span class="sxs-lookup"><span data-stu-id="3a23e-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="3a23e-190">將供應商 DropDownList 的 `ID` 屬性設定為 `Suppliers`，並將它系結至名為 `SuppliersDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="3a23e-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="3a23e-191">設定新的 ObjectDataSource 以從 `SuppliersBLL` 類別的 `GetSuppliers` 方法取出其資料，並將 [更新] 索引標籤 s 下拉式清單設為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="3a23e-192">按一下 [完成] 完成精靈。</span><span class="sxs-lookup"><span data-stu-id="3a23e-192">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="3a23e-193">[![將 ObjectDataSource 設定為使用 SuppliersBLL 類別的 GetSuppliers 方法](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span></span>

<span data-ttu-id="3a23e-194">**圖 7**：設定 ObjectDataSource 使用 `SuppliersBLL` 類別的 `GetSuppliers` 方法（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-vb/_static/image21.png))</span></span>

<span data-ttu-id="3a23e-195">讓 `Suppliers` DropDownList 顯示 [`CompanyName` 資料] 欄位，並使用 [`SupplierID` 資料] 欄位作為其 `ListItem` s 值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>

<span data-ttu-id="3a23e-196">[![顯示 [公司名稱] 欄位，並使用 [供應商] 作為值](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span></span>

<span data-ttu-id="3a23e-197">**圖 8**：顯示 `CompanyName` 資料欄位，並使用 `SupplierID` 作為值（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-vb/_static/image24.png))</span></span>

<span data-ttu-id="3a23e-198">將第二個 DropDownList 命名為 `Categories`，並將它系結至名為 `CategoriesDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="3a23e-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="3a23e-199">將 `CategoriesDataSource` ObjectDataSource 設定為使用 `CategoriesBLL` 類別 s `GetCategories` 方法;將 [更新] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]，然後按一下 [完成] 以完成嚮導。</span><span class="sxs-lookup"><span data-stu-id="3a23e-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="3a23e-200">最後，讓 DropDownList 顯示 `CategoryName` 資料欄位，並使用 `CategoryID` 做為值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="3a23e-201">新增這兩個 Dropdownlist 進行並系結至適當設定的 ObjectDataSources 之後，您的畫面看起來應該像 [圖 9]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>

<span data-ttu-id="3a23e-202">[![標頭資料列現在包含 [供應商和類別] Dropdownlist 進行](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span></span>

<span data-ttu-id="3a23e-203">**圖 9**：標頭資料列現在包含 `Suppliers` 和 `Categories` Dropdownlist 進行（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-vb/_static/image27.png))</span></span>

<span data-ttu-id="3a23e-204">我們現在需要建立文字方塊，以收集每個新產品的名稱和價格。</span><span class="sxs-lookup"><span data-stu-id="3a23e-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="3a23e-205">將 TextBox 控制項從 [工具箱] 拖曳至設計工具中，每個產品名稱和價格資料列各有一個。</span><span class="sxs-lookup"><span data-stu-id="3a23e-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="3a23e-206">將文字方塊的 [`ID` 屬性] 設定為 [`ProductName1`]、[`UnitPrice1`]、[`ProductName2`]、[`UnitPrice2`]、[`ProductName3`] 等等。`UnitPrice3`</span><span class="sxs-lookup"><span data-stu-id="3a23e-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="3a23e-207">在每個 [單價] 文字方塊之後加入 CompareValidator，將 [`ControlToValidate`] 屬性設定為適當的 `ID`。</span><span class="sxs-lookup"><span data-stu-id="3a23e-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="3a23e-208">同時將 `Operator` 屬性設定為 `GreaterThanEqual`、`ValueToCompare` 為 0 和 `Type` 至 `Currency`。</span><span class="sxs-lookup"><span data-stu-id="3a23e-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="3a23e-209">這些設定會指示 CompareValidator 確保輸入的價格是大於或等於零的有效貨幣值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="3a23e-210">將 [`Text`] 屬性設定為 [\*]，`ErrorMessage` [價格] 必須大於或等於零。</span><span class="sxs-lookup"><span data-stu-id="3a23e-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="3a23e-211">此外，請省略任何貨幣符號。</span><span class="sxs-lookup"><span data-stu-id="3a23e-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="3a23e-212">插入介面不會包含任何 RequiredFieldValidator 控制項，即使 `Products` 資料庫資料表中的 `ProductName` 欄位不允許 `NULL` 值也一樣。</span><span class="sxs-lookup"><span data-stu-id="3a23e-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="3a23e-213">這是因為我們想要讓使用者輸入最多五個產品。</span><span class="sxs-lookup"><span data-stu-id="3a23e-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="3a23e-214">例如，如果使用者要提供前三個數據列的產品名稱和單價，將最後兩個數據列保留空白，我們只會將三個新產品新增至系統。</span><span class="sxs-lookup"><span data-stu-id="3a23e-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="3a23e-215">不過，由於 `ProductName` 是必要的，因此我們需要以程式設計方式檢查，以確保在輸入單位價格時，是否已提供對應的產品名稱值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="3a23e-216">我們會在步驟4中解決這項檢查。</span><span class="sxs-lookup"><span data-stu-id="3a23e-216">We'll tackle this check in Step 4.</span></span>

<span data-ttu-id="3a23e-217">驗證使用者的輸入時，如果值包含貨幣符號，CompareValidator 會報告不正確資料。</span><span class="sxs-lookup"><span data-stu-id="3a23e-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="3a23e-218">將每個單價文字方塊前面的 $ 新增為視覺提示，以指示使用者在輸入價格時省略貨幣符號。</span><span class="sxs-lookup"><span data-stu-id="3a23e-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="3a23e-219">最後，在 [`InsertingInterface`] 面板中新增 ValidationSummary 控制項，並將其 `ShowMessageBox` 屬性設定為 `True`，並將其 `ShowSummary` 屬性設為 [`False`]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="3a23e-220">使用這些設定時，如果使用者輸入不正確單位價格值，則會在有問題的 TextBox 控制項旁出現星號，而 ValidationSummary 會顯示用戶端 messagebox，其中顯示我們先前指定的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="3a23e-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="3a23e-221">此時，您的畫面看起來應該像 [圖 10]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-221">At this point, your screen should look similar to Figure 10.</span></span>

<span data-ttu-id="3a23e-222">[![插入介面現在包含產品名稱和價格的文字方塊](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span></span>

<span data-ttu-id="3a23e-223">**圖 10**：插入介面現在包含產品名稱和價格的文字方塊（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-vb/_static/image30.png))</span></span>

<span data-ttu-id="3a23e-224">接下來，我們需要將 [從出貨新增產品] 和 [取消] 按鈕加入頁尾資料列。</span><span class="sxs-lookup"><span data-stu-id="3a23e-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="3a23e-225">將兩個按鈕控制項從 [工具箱] 拖曳至插入介面的頁尾，將 [按鈕] `ID` 屬性設定為 [`AddProducts`] 和 [`CancelButton`] 和 [`Text` 屬性]，分別從 [出貨] 和 [取消] 新增產品。</span><span class="sxs-lookup"><span data-stu-id="3a23e-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="3a23e-226">此外，將 [`CancelButton` 控制項] `CausesValidation` 屬性設定為 [`false`]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="3a23e-227">最後，我們需要新增標籤 Web 控制項，以顯示兩個介面的狀態訊息。</span><span class="sxs-lookup"><span data-stu-id="3a23e-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="3a23e-228">例如，當使用者成功新增產品的新出貨時，我們想要回到顯示介面，並顯示確認訊息。</span><span class="sxs-lookup"><span data-stu-id="3a23e-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="3a23e-229">不過，如果使用者提供新產品的價格，但保留產品名稱，則需要顯示警告訊息，因為 [`ProductName`] 欄位是必要的。</span><span class="sxs-lookup"><span data-stu-id="3a23e-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="3a23e-230">因為我們需要此訊息來顯示這兩個介面，所以請將它放在面板外的頁面頂端。</span><span class="sxs-lookup"><span data-stu-id="3a23e-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="3a23e-231">將 [標籤] Web 控制項從 [工具箱] 拖曳至設計工具中頁面的頂端。</span><span class="sxs-lookup"><span data-stu-id="3a23e-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="3a23e-232">將 [`ID`] 屬性設定為 [`StatusLabel`]，清除 [`Text`] 屬性，然後將 [`Visible`] 和 [`EnableViewState`] 屬性設定為 [`False`]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="3a23e-233">如同在先前的教學課程中所見，將 `EnableViewState` 屬性設定為 `False` 可讓我們以程式設計方式變更標籤的屬性值，並讓它們在後續回傳時，自動回復為預設值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `False` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="3a23e-234">這會簡化顯示狀態訊息的程式碼，以回應後續回傳時消失的某些使用者動作。</span><span class="sxs-lookup"><span data-stu-id="3a23e-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="3a23e-235">最後，將 [`StatusLabel` 控制項] `CssClass` 屬性設定為 [警告]，這是在 `Styles.css` 中定義的 CSS 類別名稱，會以大、斜體、粗體、紅色字型顯示文字。</span><span class="sxs-lookup"><span data-stu-id="3a23e-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="3a23e-236">[圖 11] 顯示新增和設定標籤之後的 Visual Studio 設計工具。</span><span class="sxs-lookup"><span data-stu-id="3a23e-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>

<span data-ttu-id="3a23e-237">[![將 StatusLabel 控制項放在兩個面板控制項的上方](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span></span>

<span data-ttu-id="3a23e-238">**圖 11**：將 `StatusLabel` 控制項放在兩個面板控制項上方（[按一下以觀看完整大小的影像](batch-inserting-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-vb/_static/image33.png))</span></span>

## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="3a23e-239">步驟3：在顯示和插入介面之間切換</span><span class="sxs-lookup"><span data-stu-id="3a23e-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="3a23e-240">此時，我們已完成顯示和插入介面的標記，但仍保留兩個工作：</span><span class="sxs-lookup"><span data-stu-id="3a23e-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="3a23e-241">在顯示和插入介面之間切換</span><span class="sxs-lookup"><span data-stu-id="3a23e-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="3a23e-242">將出貨中的產品加入至資料庫</span><span class="sxs-lookup"><span data-stu-id="3a23e-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="3a23e-243">目前顯示介面可見，但插入介面已隱藏。</span><span class="sxs-lookup"><span data-stu-id="3a23e-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="3a23e-244">這是因為 `DisplayInterface` 面板 `Visible` 屬性會設定為 `True` （預設值），而 `InsertingInterface` 面板 s `Visible` 屬性會設定為 `False`。</span><span class="sxs-lookup"><span data-stu-id="3a23e-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `True` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `False`.</span></span> <span data-ttu-id="3a23e-245">若要在兩個介面之間切換，我們只需要切換每個控制項 `Visible` 屬性值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="3a23e-246">當按一下 [處理產品出貨] 按鈕時，我們想要從顯示介面移至插入介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="3a23e-247">因此，請為這個按鈕的 `Click` 事件建立事件處理常式，其中包含下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="3a23e-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample4.vb)]

<span data-ttu-id="3a23e-248">這段程式碼只會隱藏 [`DisplayInterface`] 面板，並顯示 [`InsertingInterface`] 面板。</span><span class="sxs-lookup"><span data-stu-id="3a23e-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="3a23e-249">接下來，在插入介面中，為 [從出貨新增產品] 和 [取消] 按鈕控制項建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="3a23e-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="3a23e-250">當按一下其中一個按鈕時，我們必須還原回顯示介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="3a23e-251">建立這兩個按鈕控制項的 `Click` 事件處理常式，讓他們呼叫 `ReturnToDisplayInterface`，這是我們將會馬上新增的方法。</span><span class="sxs-lookup"><span data-stu-id="3a23e-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="3a23e-252">除了隱藏 [`InsertingInterface`] 面板和顯示 [`DisplayInterface`] 面板之外，`ReturnToDisplayInterface` 方法還必須將 Web 控制項傳回至其預先編輯狀態。</span><span class="sxs-lookup"><span data-stu-id="3a23e-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="3a23e-253">這牽涉到將 Dropdownlist 進行 `SelectedIndex` 屬性設定為0，並清除 TextBox 控制項的 `Text` 屬性。</span><span class="sxs-lookup"><span data-stu-id="3a23e-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="3a23e-254">如果我們未在回到顯示介面之前將控制項傳回至其預先編輯狀態，請考慮可能會發生的情況。</span><span class="sxs-lookup"><span data-stu-id="3a23e-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="3a23e-255">使用者可以按一下 [處理產品出貨] 按鈕，輸入出貨中的產品，然後按一下 [從出貨新增產品]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="3a23e-256">這會新增產品，並將使用者傳回到顯示介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="3a23e-257">此時，使用者可能會想要新增另一個出貨。</span><span class="sxs-lookup"><span data-stu-id="3a23e-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="3a23e-258">按一下 [處理產品出貨] 按鈕時，他們會回到插入介面，但 DropDownList 選擇和文字方塊值仍會以先前的值填入。</span><span class="sxs-lookup"><span data-stu-id="3a23e-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample5.vb)]

<span data-ttu-id="3a23e-259">`Click` 事件處理常式都只會呼叫 `ReturnToDisplayInterface` 方法，不過我們會回到步驟4中的 [從出貨新增產品] `Click` 事件處理常式，然後加入程式碼以儲存產品。</span><span class="sxs-lookup"><span data-stu-id="3a23e-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="3a23e-260">`ReturnToDisplayInterface` 一開始會將 `Suppliers` 和 `Categories` Dropdownlist 進行傳回至其第一個選項。</span><span class="sxs-lookup"><span data-stu-id="3a23e-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="3a23e-261">兩個常數 `firstControlID` 和 `lastControlID` 會標記插入介面中用來命名 [產品名稱] 和 [單價] 文字方塊的開始和結束控制項索引值，並用於 `For` 迴圈的界限，將 TextBox 控制項的 `Text` 屬性設回空字串。</span><span class="sxs-lookup"><span data-stu-id="3a23e-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `For` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="3a23e-262">最後，面板 `Visible` 屬性會重設，以便隱藏插入介面並顯示顯示介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="3a23e-263">請花點時間在瀏覽器中測試此頁面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="3a23e-264">第一次造訪頁面時，您應該會看到顯示介面，如 [圖 5] 所示。</span><span class="sxs-lookup"><span data-stu-id="3a23e-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="3a23e-265">按一下 [處理產品出貨] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="3a23e-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="3a23e-266">頁面將回傳，您現在應該會看到插入介面，如 [圖 12] 所示。</span><span class="sxs-lookup"><span data-stu-id="3a23e-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="3a23e-267">按一下 [從出貨新增產品] 或 [取消] 按鈕，即可將您返回顯示介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="3a23e-268">在觀看插入介面時，請花點時間測試 [單價] 文字方塊上的 CompareValidators。</span><span class="sxs-lookup"><span data-stu-id="3a23e-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="3a23e-269">當您按一下 [從出貨新增產品] 按鈕時，您應該會看到用戶端 messagebox 警告，其貨幣值或價格值小於零。</span><span class="sxs-lookup"><span data-stu-id="3a23e-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>

<span data-ttu-id="3a23e-270">[按一下 [處理產品出貨] 按鈕之後，會顯示插入介面 ![](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span></span>

<span data-ttu-id="3a23e-271">**圖 12**：按一下 [處理產品出貨] 按鈕之後，即會顯示插入介面（[按一下以查看完整大小的影像](batch-inserting-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-vb/_static/image36.png))</span></span>

## <a name="step-4-adding-the-products"></a><span data-ttu-id="3a23e-272">步驟4：新增產品</span><span class="sxs-lookup"><span data-stu-id="3a23e-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="3a23e-273">本教學課程剩下的工作，就是將產品儲存到資料庫的 [從出貨新增產品] 按鈕 `Click` 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="3a23e-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="3a23e-274">建立 `ProductsDataTable` 並為每個提供的產品名稱加入 `ProductsRow` 實例，即可完成這項作業。</span><span class="sxs-lookup"><span data-stu-id="3a23e-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="3a23e-275">加入這些 `ProductsRow` 之後，我們就會呼叫傳入 `ProductsDataTable`的 `ProductsBLL` 類別 s `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="3a23e-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="3a23e-276">回想一下，在交易教學課程的[包裝資料庫修改](wrapping-database-modifications-within-a-transaction-vb.md)中所建立的 `UpdateWithTransaction` 方法，會將 `ProductsDataTable` 傳遞至 `ProductsTableAdapter`的 `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="3a23e-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter`'s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="3a23e-277">從該處開始，會啟動 ADO.NET 交易，而 TableAdapter 會針對 DataTable 中的每個加入的 `ProductsRow`，將 `INSERT` 語句發出到資料庫。</span><span class="sxs-lookup"><span data-stu-id="3a23e-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="3a23e-278">假設所有產品都已新增而不發生錯誤，則會認可交易，否則會回復。</span><span class="sxs-lookup"><span data-stu-id="3a23e-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="3a23e-279">[從出貨新增產品] 按鈕 `Click` 事件處理常式的程式碼，也必須執行一些錯誤檢查。</span><span class="sxs-lookup"><span data-stu-id="3a23e-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="3a23e-280">由於插入介面中沒有使用 RequiredFieldValidators，因此使用者可以在省略其名稱時輸入產品的價格。</span><span class="sxs-lookup"><span data-stu-id="3a23e-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="3a23e-281">由於產品的名稱是必要的，因此，如果這類條件色彩，我們需要提醒使用者，而不要繼續進行插入。</span><span class="sxs-lookup"><span data-stu-id="3a23e-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="3a23e-282">完整的 `Click` 事件處理常式程式碼如下所示：</span><span class="sxs-lookup"><span data-stu-id="3a23e-282">The complete `Click` event handler code follows:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample6.vb)]

<span data-ttu-id="3a23e-283">事件處理常式一開始會先確保 `Page.IsValid` 屬性會傳回 `True`的值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `True`.</span></span> <span data-ttu-id="3a23e-284">如果它傳回 `False`，則表示有一或多個 CompareValidators 報告了不正確資料;在這種情況下，我們不想要嘗試插入輸入的產品，或是在嘗試將使用者輸入的單位價格值指派給 `ProductsRow` 的 `UnitPrice` 屬性時，最後會發生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="3a23e-284">If it returns `False`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="3a23e-285">接下來，會建立新的 `ProductsDataTable` 實例（`products`）。</span><span class="sxs-lookup"><span data-stu-id="3a23e-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="3a23e-286">`For` 迴圈是用來逐一查看 [產品名稱] 和 [單價] 文字方塊，而 `Text` 屬性會讀入本機變數 `productName` 和 `unitPrice`。</span><span class="sxs-lookup"><span data-stu-id="3a23e-286">A `For` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="3a23e-287">如果使用者已輸入單價的值，而不是對應的產品名稱，則 `StatusLabel` 會在您提供單價時顯示訊息，而您也必須包含產品的名稱，而且事件處理常式會結束。</span><span class="sxs-lookup"><span data-stu-id="3a23e-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="3a23e-288">如果已提供產品名稱，則會使用 `ProductsDataTable` s `NewProductsRow` 方法來建立新的 `ProductsRow` 實例。</span><span class="sxs-lookup"><span data-stu-id="3a23e-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="3a23e-289">這個新的 `ProductsRow` 實例 `ProductName` 屬性會設定為 [目前的產品名稱] 文字方塊，而 `SupplierID` 和 `CategoryID` 屬性則會指派給插入介面 s 標頭中 Dropdownlist 進行的 `SelectedValue` 屬性。</span><span class="sxs-lookup"><span data-stu-id="3a23e-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="3a23e-290">如果使用者輸入產品價格的值，則會將其指派給 `ProductsRow` 實例 `UnitPrice` 屬性;否則，屬性會保留為未指派，這會導致資料庫中 `UnitPrice` 的 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="3a23e-291">最後，`Discontinued` 和 `UnitsOnOrder` 屬性會分別指派給硬式編碼的值 `False` 和0。</span><span class="sxs-lookup"><span data-stu-id="3a23e-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `False` and 0, respectively.</span></span>

<span data-ttu-id="3a23e-292">將屬性指派給 `ProductsRow` 實例之後，就會將其新增至 `ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="3a23e-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="3a23e-293">當 `For` 迴圈完成時，我們會檢查是否已新增任何產品。</span><span class="sxs-lookup"><span data-stu-id="3a23e-293">At the completion of the `For` loop, we check whether any products have been added.</span></span> <span data-ttu-id="3a23e-294">畢竟，使用者可以在輸入任何產品名稱或價格之前，先按一下 [從出貨新增產品]。</span><span class="sxs-lookup"><span data-stu-id="3a23e-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="3a23e-295">如果 `ProductsDataTable`中至少有一個產品，則會呼叫 `ProductsBLL` 類別 s `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="3a23e-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="3a23e-296">接下來，資料會重新系結至 `ProductsGrid` GridView，使新加入的產品會出現在顯示介面中。</span><span class="sxs-lookup"><span data-stu-id="3a23e-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="3a23e-297">`StatusLabel` 會更新以顯示確認訊息，並叫用 `ReturnToDisplayInterface`，隱藏插入介面並顯示顯示介面。</span><span class="sxs-lookup"><span data-stu-id="3a23e-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="3a23e-298">如果未輸入任何產品，插入的介面仍會顯示，但不會新增任何產品的訊息。</span><span class="sxs-lookup"><span data-stu-id="3a23e-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="3a23e-299">請在顯示的文字方塊中輸入產品名稱和單位價格。</span><span class="sxs-lookup"><span data-stu-id="3a23e-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="3a23e-300">圖 s 13、14和15顯示插入和顯示介面的作用中。</span><span class="sxs-lookup"><span data-stu-id="3a23e-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="3a23e-301">在 [圖 13] 中，使用者輸入的單位價格值沒有對應的產品名稱。</span><span class="sxs-lookup"><span data-stu-id="3a23e-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="3a23e-302">[圖 14] 顯示成功新增三個新產品後的顯示介面，而 [圖 15] 顯示 GridView 中新增的兩個產品（第三個是在前一頁）。</span><span class="sxs-lookup"><span data-stu-id="3a23e-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>

<span data-ttu-id="3a23e-303">[輸入單位價格時，需要 ![產品名稱](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span></span>

<span data-ttu-id="3a23e-304">**圖 13**：輸入單位價格時，需要產品名稱（[按一下以觀看完整大小的影像](batch-inserting-vb/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-vb/_static/image39.png))</span></span>

<span data-ttu-id="3a23e-305">[已為供應商 Mayumi 加入 ![三個新 Veggies](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span></span>

<span data-ttu-id="3a23e-306">**圖 14**：已為供應商 Mayumi 新增三個新的 Veggies （[按一下以觀看完整大小的影像](batch-inserting-vb/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-vb/_static/image42.png))</span></span>

<span data-ttu-id="3a23e-307">[![新產品可在 GridView 的最後一頁中找到](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="3a23e-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span></span>

<span data-ttu-id="3a23e-308">**圖 15**：新產品可在 GridView 的最後一頁中找到（[按一下以觀看完整大小的影像](batch-inserting-vb/_static/image45.png)）</span><span class="sxs-lookup"><span data-stu-id="3a23e-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-vb/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="3a23e-309">本教學課程中使用的批次插入邏輯會在交易範圍內包裝插入。</span><span class="sxs-lookup"><span data-stu-id="3a23e-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="3a23e-310">若要確認這一點，特意會引進資料庫層級錯誤。</span><span class="sxs-lookup"><span data-stu-id="3a23e-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="3a23e-311">例如，不是將新的 `ProductsRow` 實例 s `CategoryID` 屬性指派給 `Categories` DropDownList 中選取的值，而是將它指派給 `i * 5`之類的值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="3a23e-312">這裡 `i` 是循環索引器，其值的範圍從1到5。</span><span class="sxs-lookup"><span data-stu-id="3a23e-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="3a23e-313">因此，在批次插入中新增兩個或多個產品時，第一個產品會有有效的 `CategoryID` 值（5），但後續產品的 `CategoryID` 值不符合 `Categories` 資料表中 `CategoryID` 值。</span><span class="sxs-lookup"><span data-stu-id="3a23e-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="3a23e-314">最後的結果是，當第一個 `INSERT` 成功時，後續的工作將會失敗，並出現外鍵條件約束違規。</span><span class="sxs-lookup"><span data-stu-id="3a23e-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="3a23e-315">因為批次插入是不可部分完成的，所以第一個 `INSERT` 將會復原，並在批次插入程式開始之前，將資料庫還原至其狀態。</span><span class="sxs-lookup"><span data-stu-id="3a23e-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>

## <a name="summary"></a><span data-ttu-id="3a23e-316">總結</span><span class="sxs-lookup"><span data-stu-id="3a23e-316">Summary</span></span>

<span data-ttu-id="3a23e-317">在此和前兩個教學課程中，我們已建立可允許更新、刪除和插入批次資料的介面，這些都是使用我們在交易教學課程的[包裝資料庫修改](wrapping-database-modifications-within-a-transaction-vb.md)中新增至資料存取層的交易支援。</span><span class="sxs-lookup"><span data-stu-id="3a23e-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial.</span></span> <span data-ttu-id="3a23e-318">在某些情況下，這類批次處理使用者介面會藉由減少點擊次數、回傳和鍵盤到滑鼠內容切換，同時保有基礎資料的完整性，大幅提升使用者效率。</span><span class="sxs-lookup"><span data-stu-id="3a23e-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="3a23e-319">本教學課程會完成使用批次資料的檢查。</span><span class="sxs-lookup"><span data-stu-id="3a23e-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="3a23e-320">下一組教學課程會探索各種先進的資料存取層案例，包括在 TableAdapter 的方法中使用預存程式、在 DAL 中設定連接和命令層級的設定、加密連接字串等等！</span><span class="sxs-lookup"><span data-stu-id="3a23e-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="3a23e-321">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="3a23e-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="3a23e-322">關於作者</span><span class="sxs-lookup"><span data-stu-id="3a23e-322">About the Author</span></span>

<span data-ttu-id="3a23e-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="3a23e-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3a23e-324">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="3a23e-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3a23e-325">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="3a23e-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="3a23e-326">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3a23e-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="3a23e-327">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="3a23e-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="3a23e-328">特別感謝</span><span class="sxs-lookup"><span data-stu-id="3a23e-328">Special Thanks To</span></span>

<span data-ttu-id="3a23e-329">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="3a23e-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="3a23e-330">本教學課程的領導審查者為 Hilton Giesenow 和 S ren Jacob Lauritsen。</span><span class="sxs-lookup"><span data-stu-id="3a23e-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="3a23e-331">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="3a23e-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="3a23e-332">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3a23e-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="3a23e-333">上一篇</span><span class="sxs-lookup"><span data-stu-id="3a23e-333">Previous</span></span>](batch-deleting-vb.md)
