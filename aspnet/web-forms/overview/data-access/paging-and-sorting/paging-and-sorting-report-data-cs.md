---
uid: web-forms/overview/data-access/paging-and-sorting/paging-and-sorting-report-data-cs
title: 分頁和排序報表資料（C#） |Microsoft Docs
author: rick-anderson
description: 分頁和排序是在線上應用程式中顯示資料時的兩個很常見的功能。 在本教學課程中，我們將先介紹如何新增排序和 。
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 811a6ef2-ec66-4c8e-a089-6f795056e288
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/paging-and-sorting-report-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 2f77040316dadc218b8183e52628dc0cfe3b35a1
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74586835"
---
# <a name="paging-and-sorting-report-data-c"></a><span data-ttu-id="60488-104">分頁和排序報告資料 (C#)</span><span class="sxs-lookup"><span data-stu-id="60488-104">Paging and Sorting Report Data (C#)</span></span>

<span data-ttu-id="60488-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="60488-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="60488-106">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_24_CS.exe)或[下載 PDF](paging-and-sorting-report-data-cs/_static/datatutorial24cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="60488-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_24_CS.exe) or [Download PDF](paging-and-sorting-report-data-cs/_static/datatutorial24cs1.pdf)</span></span>

> <span data-ttu-id="60488-107">分頁和排序是在線上應用程式中顯示資料時的兩個很常見的功能。</span><span class="sxs-lookup"><span data-stu-id="60488-107">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="60488-108">在本教學課程中，我們將先探討如何將排序和分頁新增至我們的報表，我們將在未來的教學課程中建立這些記錄。</span><span class="sxs-lookup"><span data-stu-id="60488-108">In this tutorial we'll take a first look at adding sorting and paging to our reports, which we will then build upon in future tutorials.</span></span>

## <a name="introduction"></a><span data-ttu-id="60488-109">簡介</span><span class="sxs-lookup"><span data-stu-id="60488-109">Introduction</span></span>

<span data-ttu-id="60488-110">分頁和排序是在線上應用程式中顯示資料時的兩個很常見的功能。</span><span class="sxs-lookup"><span data-stu-id="60488-110">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="60488-111">例如，搜尋線上書店的 ASP.NET 書籍時，可能會有數百份這類書籍，但列出搜尋結果的報表只會列出每頁十個相符專案。</span><span class="sxs-lookup"><span data-stu-id="60488-111">For example, when searching for ASP.NET books at an online bookstore, there may be hundreds of such books, but the report listing the search results lists only ten matches per page.</span></span> <span data-ttu-id="60488-112">此外，結果也可以依標題、價格、頁面計數、作者姓名等等排序。</span><span class="sxs-lookup"><span data-stu-id="60488-112">Moreover, the results can be sorted by title, price, page count, author name, and so on.</span></span> <span data-ttu-id="60488-113">雖然過去23個教學課程已檢查如何建立各種報表，包括允許新增、編輯和刪除資料的介面，但我們並未探討如何排序資料，以及我們在 DetailsView 和 FormView 中所見到的唯一分頁範例controls.</span><span class="sxs-lookup"><span data-stu-id="60488-113">While the past 23 tutorials have examined how to build a variety of reports, including interfaces that permit adding, editing, and deleting data, we ve not looked at how to sort data and the only paging examples we ve seen have been with the DetailsView and FormView controls.</span></span>

<span data-ttu-id="60488-114">在本教學課程中，我們將瞭解如何將排序和分頁新增至我們的報表，只要檢查幾個核取方塊即可完成。</span><span class="sxs-lookup"><span data-stu-id="60488-114">In this tutorial we'll see how to add sorting and paging to our reports, which can be accomplished by simply checking a few checkboxes.</span></span> <span data-ttu-id="60488-115">可惜的是，這種簡化的執行有其缺點，排序介面會留下一個需要的一點，而分頁常式則不是設計來有效率地分頁處理大型結果集。</span><span class="sxs-lookup"><span data-stu-id="60488-115">Unfortunately, this simplistic implementation has its drawbacks the sorting interface leaves a bit to be desired and the paging routines are not designed for efficiently paging through large result sets.</span></span> <span data-ttu-id="60488-116">未來的教學課程將探討如何克服現成分頁和排序解決方案的限制。</span><span class="sxs-lookup"><span data-stu-id="60488-116">Future tutorials will explore how to overcome the limitations of the out-of-the-box paging and sorting solutions.</span></span>

## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a><span data-ttu-id="60488-117">步驟1：新增分頁和排序教學課程網頁</span><span class="sxs-lookup"><span data-stu-id="60488-117">Step 1: Adding the Paging and Sorting Tutorial Web Pages</span></span>

<span data-ttu-id="60488-118">開始進行本教學課程之前，先花點時間新增本教學課程所需的 ASP.NET 網頁，以及接下來的三項。</span><span class="sxs-lookup"><span data-stu-id="60488-118">Before we start this tutorial, let s first take a moment to add the ASP.NET pages we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="60488-119">首先，在名為 `PagingAndSorting`的專案中建立新的資料夾。</span><span class="sxs-lookup"><span data-stu-id="60488-119">Start by creating a new folder in the project named `PagingAndSorting`.</span></span> <span data-ttu-id="60488-120">接下來，將下列五個 ASP.NET 網頁新增到此資料夾，並將它們全部設定為使用主版頁面 `Site.master`：</span><span class="sxs-lookup"><span data-stu-id="60488-120">Next, add the following five ASP.NET pages to this folder, having all of them configured to use the master page `Site.master`:</span></span>

- `Default.aspx`
- `SimplePagingSorting.aspx`
- `EfficientPaging.aspx`
- `SortParameter.aspx`
- `CustomSortingUI.aspx`

![建立 PagingAndSorting 資料夾並新增教學課程 ASP.NET 網頁](paging-and-sorting-report-data-cs/_static/image1.png)

<span data-ttu-id="60488-122">**圖 1**：建立 PagingAndSorting 資料夾並新增教學課程 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="60488-122">**Figure 1**: Create a PagingAndSorting Folder and Add the Tutorial ASP.NET Pages</span></span>

<span data-ttu-id="60488-123">接下來，開啟 [`Default.aspx`] 頁面，並將 [`SectionLevelTutorialListing.ascx` 使用者] 控制項從 [`UserControls`] 資料夾拖曳到設計介面上。</span><span class="sxs-lookup"><span data-stu-id="60488-123">Next, open the `Default.aspx` page and drag the `SectionLevelTutorialListing.ascx` User Control from the `UserControls` folder onto the Design surface.</span></span> <span data-ttu-id="60488-124">我們在[主版頁面和網站導覽](../introduction/master-pages-and-site-navigation-cs.md)教學課程中建立的這個使用者控制項，會列舉網站地圖，並在項目符號清單的目前區段中顯示這些教學課程。</span><span class="sxs-lookup"><span data-stu-id="60488-124">This User Control, which we created in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, enumerates the site map and displays those tutorials in the current section in a bulleted list.</span></span>

![將 SectionLevelTutorialListing 的 .ascx 使用者控制項新增至 default.aspx](paging-and-sorting-report-data-cs/_static/image2.png)

<span data-ttu-id="60488-126">**圖 2**：將 SectionLevelTutorialListing 的 .Ascx 使用者控制項新增至 default.aspx</span><span class="sxs-lookup"><span data-stu-id="60488-126">**Figure 2**: Add the SectionLevelTutorialListing.ascx User Control to Default.aspx</span></span>

<span data-ttu-id="60488-127">為了讓項目符號清單顯示我們將建立的分頁和排序教學課程，我們需要將它們新增至網站地圖。</span><span class="sxs-lookup"><span data-stu-id="60488-127">In order to have the bulleted list display the paging and sorting tutorials we'll be creating, we need to add them to the site map.</span></span> <span data-ttu-id="60488-128">開啟 `Web.sitemap` 檔案，並在編輯、插入及刪除網站地圖節點標記之後，新增下列標記：</span><span class="sxs-lookup"><span data-stu-id="60488-128">Open the `Web.sitemap` file and add the following markup after the Editing, Inserting, and Deleting site map node markup:</span></span>

[!code-xml[Main](paging-and-sorting-report-data-cs/samples/sample1.xml)]

![更新網站地圖以包含新的 ASP.NET 網頁](paging-and-sorting-report-data-cs/_static/image3.png)

<span data-ttu-id="60488-130">**圖 3**：更新網站地圖以包含新的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="60488-130">**Figure 3**: Update the Site Map to Include the New ASP.NET Pages</span></span>

## <a name="step-2-displaying-product-information-in-a-gridview"></a><span data-ttu-id="60488-131">步驟2：在 GridView 中顯示產品資訊</span><span class="sxs-lookup"><span data-stu-id="60488-131">Step 2: Displaying Product Information in a GridView</span></span>

<span data-ttu-id="60488-132">在實際實行分頁和排序功能之前，先讓我們先建立一個標準不可排序、不可分頁的 GridView，其中列出產品資訊。</span><span class="sxs-lookup"><span data-stu-id="60488-132">Before we actually implement paging and sorting capabilities, let s first create a standard non-sortable, non-pageable GridView that lists the product information.</span></span> <span data-ttu-id="60488-133">這是我們在整個教學課程系列之前完成過多次的工作，因此應該熟悉這些步驟。</span><span class="sxs-lookup"><span data-stu-id="60488-133">This is a task we ve done many times before throughout this tutorial series so these steps should be familiar.</span></span> <span data-ttu-id="60488-134">一開始先開啟 [`SimplePagingSorting.aspx`] 頁面，並將 GridView 控制項從 [工具箱] 拖曳至設計工具，將其 [`ID`] 屬性設定為 [`Products`]。</span><span class="sxs-lookup"><span data-stu-id="60488-134">Start by opening the `SimplePagingSorting.aspx` page and drag a GridView control from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="60488-135">接下來，建立新的 ObjectDataSource，使用 ProductsBLL 類別 s `GetProducts()` 方法來傳回所有產品資訊。</span><span class="sxs-lookup"><span data-stu-id="60488-135">Next, create a new ObjectDataSource that uses the ProductsBLL class s `GetProducts()` method to return all of the product information.</span></span>

![使用 GetProducts （）方法取出所有產品的相關資訊](paging-and-sorting-report-data-cs/_static/image4.png)

<span data-ttu-id="60488-137">**圖 4**：使用 GetProducts （）方法取出所有產品的相關資訊</span><span class="sxs-lookup"><span data-stu-id="60488-137">**Figure 4**: Retrieve Information About All of the Products Using the GetProducts() Method</span></span>

<span data-ttu-id="60488-138">因為這份報表是唯讀報表，所以不需要將 ObjectDataSource s `Insert()`、`Update()`或 `Delete()` 方法對應到對應的 `ProductsBLL` 方法。因此，請從 [更新]、[插入] 和 [刪除] 索引標籤的下拉式清單中選擇 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="60488-138">Since this report is a read-only report, there s no need to map the ObjectDataSource s `Insert()`, `Update()`, or `Delete()` methods to corresponding `ProductsBLL` methods; therefore, choose (None) from the drop-down list for the UPDATE, INSERT, and DELETE tabs.</span></span>

![在 [更新]、[插入] 和 [刪除] 索引標籤的下拉式清單中，選擇 [（無）] 選項](paging-and-sorting-report-data-cs/_static/image5.png)

<span data-ttu-id="60488-140">[**圖 5**]：在 [更新]、[插入] 和 [刪除] 索引標籤的下拉式清單中，選擇 [（無）] 選項</span><span class="sxs-lookup"><span data-stu-id="60488-140">**Figure 5**: Choose the (None) Option in the Drop-Down List in the UPDATE, INSERT, and DELETE Tabs</span></span>

<span data-ttu-id="60488-141">接下來，讓我們自訂 GridView 的欄位，只顯示產品名稱、供應商、類別、價格和已停止的狀態。</span><span class="sxs-lookup"><span data-stu-id="60488-141">Next, let s customize the GridView s fields so that only the products names, suppliers, categories, prices, and discontinued statuses are displayed.</span></span> <span data-ttu-id="60488-142">此外，您可以隨意進行任何欄位層級的格式變更，例如調整 `HeaderText` 屬性，或將價格格式化為貨幣。</span><span class="sxs-lookup"><span data-stu-id="60488-142">Furthermore, feel free to make any field-level formatting changes, such as adjusting the `HeaderText` properties or formatting the price as a currency.</span></span> <span data-ttu-id="60488-143">這些變更之後，GridView 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="60488-143">After these changes, your GridView s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](paging-and-sorting-report-data-cs/samples/sample2.aspx)]

<span data-ttu-id="60488-144">[圖 6] 顯示透過瀏覽器觀看的進度。</span><span class="sxs-lookup"><span data-stu-id="60488-144">Figure 6 shows our progress thus far when viewed through a browser.</span></span> <span data-ttu-id="60488-145">請注意，此頁面會在單一畫面中列出所有產品，並顯示每個產品的名稱、類別、供應商、價格和已停止狀態。</span><span class="sxs-lookup"><span data-stu-id="60488-145">Note that the page lists all of the products in one screen, showing each product s name, category, supplier, price, and discontinued status.</span></span>

<span data-ttu-id="60488-146">[列出每個產品 ![](paging-and-sorting-report-data-cs/_static/image7.png)](paging-and-sorting-report-data-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="60488-146">[![Each of the Products are Listed](paging-and-sorting-report-data-cs/_static/image7.png)](paging-and-sorting-report-data-cs/_static/image6.png)</span></span>

<span data-ttu-id="60488-147">**圖 6**：列出每項產品（[按一下以觀看完整大小的影像](paging-and-sorting-report-data-cs/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-147">**Figure 6**: Each of the Products are Listed ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image8.png))</span></span>

## <a name="step-3-adding-paging-support"></a><span data-ttu-id="60488-148">步驟3：新增分頁支援</span><span class="sxs-lookup"><span data-stu-id="60488-148">Step 3: Adding Paging Support</span></span>

<span data-ttu-id="60488-149">在一個畫面上列出*所有*產品，可能會導致使用者流覽資料的資訊超載。</span><span class="sxs-lookup"><span data-stu-id="60488-149">Listing *all* of the products on one screen can lead to information overload for the user perusing the data.</span></span> <span data-ttu-id="60488-150">為了讓結果更容易管理，我們可以將資料分解成較小的資料頁，讓使用者一次一頁就能逐步執行資料。</span><span class="sxs-lookup"><span data-stu-id="60488-150">To help make the results more manageable, we can break up the data into smaller pages of data and allow the user to step through the data one page at a time.</span></span> <span data-ttu-id="60488-151">若要完成此動作，只需核取 GridView 的智慧標籤中的 [啟用分頁] 核取方塊（這會將 GridView 的[`AllowPaging` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowpaging.aspx)設定為 `true`）。</span><span class="sxs-lookup"><span data-stu-id="60488-151">To accomplish this simply check the Enable Paging checkbox from the GridView s smart tag (this sets the GridView s [`AllowPaging` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowpaging.aspx) to `true`).</span></span>

<span data-ttu-id="60488-152">[![核取 [啟用分頁] 核取方塊以新增分頁支援](paging-and-sorting-report-data-cs/_static/image10.png)](paging-and-sorting-report-data-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="60488-152">[![Check the Enable Paging Checkbox to Add Paging Support](paging-and-sorting-report-data-cs/_static/image10.png)](paging-and-sorting-report-data-cs/_static/image9.png)</span></span>

<span data-ttu-id="60488-153">**圖 7**：核取 [啟用分頁] 核取方塊以新增分頁支援（[按一下以查看完整大小的影像](paging-and-sorting-report-data-cs/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-153">**Figure 7**: Check the Enable Paging Checkbox to Add Paging Support ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image11.png))</span></span>

<span data-ttu-id="60488-154">啟用分頁會限制每頁顯示的記錄數目，並將*分頁介面*新增至 GridView。</span><span class="sxs-lookup"><span data-stu-id="60488-154">Enabling paging limits the number of records shown per page and adds a *paging interface* to the GridView.</span></span> <span data-ttu-id="60488-155">如 [圖 7] 所示，預設的分頁介面是一系列的頁碼，可讓使用者從一頁數據快速流覽至另一個頁面。</span><span class="sxs-lookup"><span data-stu-id="60488-155">The default paging interface, shown in Figure 7, is a series of page numbers, allowing the user to quickly navigate from one page of data to another.</span></span> <span data-ttu-id="60488-156">此分頁介面看起來應該很熟悉，因為在過去的教學課程中，將分頁支援新增至 DetailsView 和 FormView 控制項時，就會看到這種情況。</span><span class="sxs-lookup"><span data-stu-id="60488-156">This paging interface should look familiar, as we ve seen it when adding paging support to the DetailsView and FormView controls in past tutorials.</span></span>

<span data-ttu-id="60488-157">DetailsView 和 FormView 控制項都只會針對每個頁面顯示一筆記錄。</span><span class="sxs-lookup"><span data-stu-id="60488-157">Both the DetailsView and FormView controls only show a single record per page.</span></span> <span data-ttu-id="60488-158">不過，GridView 會諮詢其[`PageSize` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.pagesize.aspx)，以決定每個頁面顯示的記錄數目（此屬性預設為10的值）。</span><span class="sxs-lookup"><span data-stu-id="60488-158">The GridView, however, consults its [`PageSize` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.pagesize.aspx) to determine how many records to show per page (this property defaults to a value of 10).</span></span>

<span data-ttu-id="60488-159">這個 GridView、DetailsView 和 FormView s 分頁介面可以使用下列屬性自訂：</span><span class="sxs-lookup"><span data-stu-id="60488-159">This GridView, DetailsView, and FormView s paging interface can be customized using the following properties:</span></span>

- <span data-ttu-id="60488-160">`PagerStyle` 表示分頁介面的樣式資訊;可以指定如 `BackColor`、`ForeColor`、`CssClass`、`HorizontalAlign`等設定。</span><span class="sxs-lookup"><span data-stu-id="60488-160">`PagerStyle` indicates the style information for the paging interface; can specify settings like `BackColor`, `ForeColor`, `CssClass`, `HorizontalAlign`, and so on.</span></span>
- <span data-ttu-id="60488-161">`PagerSettings` 包含可自訂分頁介面功能的屬性系列;`PageButtonCount` 指出分頁介面中顯示的最大數值頁數（預設值為10）;[`Mode` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pagersettings.mode.aspx)會指出分頁介面的運作方式，而且可以設定為：</span><span class="sxs-lookup"><span data-stu-id="60488-161">`PagerSettings` contains a bevy of properties that can customize the functionality of the paging interface; `PageButtonCount` indicates the maximum number of numeric page numbers displayed in the paging interface (the default is 10); the [`Mode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pagersettings.mode.aspx) indicates how the paging interface operates and can be set to:</span></span> 

    - <span data-ttu-id="60488-162">`NextPrevious` 顯示 [下一步] 和 [上一個] 按鈕，讓使用者一次向前或向後一頁</span><span class="sxs-lookup"><span data-stu-id="60488-162">`NextPrevious` shows a Next and Previous buttons, allowing the user to step forwards or backwards one page at a time</span></span>
    - <span data-ttu-id="60488-163">除了 [下一步] 和 [上一個] 按鈕以外，還會包含第一個和最後一個按鈕，讓使用者快速移至第一頁或最後一頁的資料。 `NextPreviousFirstLast`</span><span class="sxs-lookup"><span data-stu-id="60488-163">`NextPreviousFirstLast` in addition to Next and Previous buttons, First and Last buttons are also included, allowing the user to quickly move to the first or last page of data</span></span>
    - <span data-ttu-id="60488-164">`Numeric` 顯示一系列的頁碼，讓使用者立即跳到任何頁面</span><span class="sxs-lookup"><span data-stu-id="60488-164">`Numeric` shows a series of page numbers, allowing the user to immediately jump to any page</span></span>
    - <span data-ttu-id="60488-165">除了頁碼以外，`NumericFirstLast` 包含第一個和最後一個按鈕，可讓使用者快速地移至第一頁或最後一頁的資料;只有在無法容納所有數值頁碼的情況下，才會顯示第一個/最後一個按鈕</span><span class="sxs-lookup"><span data-stu-id="60488-165">`NumericFirstLast` in addition to the page numbers, includes First and Last buttons, allowing the user to quickly move to the first or last page of data; the First/Last buttons are only shown if all of the numeric page numbers cannot fit</span></span>

<span data-ttu-id="60488-166">此外，GridView、DetailsView 和 FormView 全都提供 `PageIndex` 和 `PageCount` 屬性，分別指出目前正在查看的頁面和資料的總頁數。</span><span class="sxs-lookup"><span data-stu-id="60488-166">Moreover, the GridView, DetailsView, and FormView all offer the `PageIndex` and `PageCount` properties, which indicate the current page being viewed and the total number of pages of data, respectively.</span></span> <span data-ttu-id="60488-167">`PageIndex` 屬性是從0開始編制索引，這表示當您在查看資料的第一頁時，`PageIndex` 會等於0。</span><span class="sxs-lookup"><span data-stu-id="60488-167">The `PageIndex` property is indexed starting at 0, meaning that when viewing the first page of data `PageIndex` will equal 0.</span></span> <span data-ttu-id="60488-168">另一方面，`PageCount`會從1開始計數，這表示 `PageIndex` 限制為0到 `PageCount - 1`之間的值。</span><span class="sxs-lookup"><span data-stu-id="60488-168">`PageCount`, on the other hand, starts counting at 1, meaning that `PageIndex` is limited to the values between 0 and `PageCount - 1`.</span></span>

<span data-ttu-id="60488-169">讓我們花一點時間來改善 GridView 分頁介面的預設面板。</span><span class="sxs-lookup"><span data-stu-id="60488-169">Let s take a moment to improve the default appearance of our GridView s paging interface.</span></span> <span data-ttu-id="60488-170">具體而言，讓分頁介面靠右對齊淺灰色背景。</span><span class="sxs-lookup"><span data-stu-id="60488-170">Specifically, let s have the paging interface right-aligned with a light gray background.</span></span> <span data-ttu-id="60488-171">我們不會直接透過 GridView 的 `PagerStyle` 屬性來設定這些屬性，而是在名為 `PagerRowStyle` 的 `Styles.css` 中建立 CSS 類別，然後透過我們的主題指派 `PagerStyle` s `CssClass` 屬性。</span><span class="sxs-lookup"><span data-stu-id="60488-171">Rather than setting these properties directly through the GridView s `PagerStyle` property, let s create a CSS class in `Styles.css` named `PagerRowStyle` and then assign the `PagerStyle` s `CssClass` property through our Theme.</span></span> <span data-ttu-id="60488-172">首先，開啟 `Styles.css` 並新增下列 CSS 類別定義：</span><span class="sxs-lookup"><span data-stu-id="60488-172">Start by opening `Styles.css` and adding the following CSS class definition:</span></span>

[!code-css[Main](paging-and-sorting-report-data-cs/samples/sample3.css)]

<span data-ttu-id="60488-173">接下來，在 [`App_Themes`] 資料夾內的 [`DataWebControls`] 資料夾中開啟 `GridView.skin` 檔案。</span><span class="sxs-lookup"><span data-stu-id="60488-173">Next, open the `GridView.skin` file in the `DataWebControls` folder within the `App_Themes` folder.</span></span> <span data-ttu-id="60488-174">如我們在*主版頁面和網站導覽*教學課程中所討論的，您可以使用面板檔案來指定 Web 控制項的預設屬性值。</span><span class="sxs-lookup"><span data-stu-id="60488-174">As we discussed in the *Master Pages and Site Navigation* tutorial, Skin files can be used to specify the default property values for a Web control.</span></span> <span data-ttu-id="60488-175">因此，請擴充現有的設定，以包含將 `PagerStyle` s `CssClass` 屬性設定為 `PagerRowStyle`。</span><span class="sxs-lookup"><span data-stu-id="60488-175">Therefore, augment the existing settings to include setting the `PagerStyle` s `CssClass` property to `PagerRowStyle`.</span></span> <span data-ttu-id="60488-176">同時，讓我們設定分頁介面，使用 `NumericFirstLast` 分頁介面來顯示最多五個數值頁面按鈕。</span><span class="sxs-lookup"><span data-stu-id="60488-176">Also, let s configure the paging interface to show at most five numeric page buttons using the `NumericFirstLast` paging interface.</span></span>

[!code-aspx[Main](paging-and-sorting-report-data-cs/samples/sample4.aspx)]

## <a name="the-paging-user-experience"></a><span data-ttu-id="60488-177">分頁使用者體驗</span><span class="sxs-lookup"><span data-stu-id="60488-177">The Paging User Experience</span></span>

<span data-ttu-id="60488-178">[圖 8] 顯示當 GridView 的 [啟用分頁] 核取方塊已核取，且已透過 `GridView.skin` 檔案進行 `PagerStyle` 和 `PagerSettings` 設定之後，透過瀏覽器造訪的網頁。</span><span class="sxs-lookup"><span data-stu-id="60488-178">Figure 8 shows the web page when visited through a browser after the GridView s Enable Paging checkbox has been checked and the `PagerStyle` and `PagerSettings` configurations have been made through the `GridView.skin` file.</span></span> <span data-ttu-id="60488-179">請注意，只會顯示十筆記錄，而分頁介面則表示我們正在查看資料的第一頁。</span><span class="sxs-lookup"><span data-stu-id="60488-179">Note how only ten records are shown, and the paging interface indicates that we are viewing the first page of data.</span></span>

<span data-ttu-id="60488-180">[已啟用分頁的 ![，一次只會顯示記錄的子集](paging-and-sorting-report-data-cs/_static/image13.png)](paging-and-sorting-report-data-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="60488-180">[![With Paging Enabled, Only a Subset of the Records are Displayed at a Time](paging-and-sorting-report-data-cs/_static/image13.png)](paging-and-sorting-report-data-cs/_static/image12.png)</span></span>

<span data-ttu-id="60488-181">**圖 8**：啟用分頁時，一次只會顯示記錄的子集（[按一下以觀看完整大小的影像](paging-and-sorting-report-data-cs/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-181">**Figure 8**: With Paging Enabled, Only a Subset of the Records are Displayed at a Time ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image14.png))</span></span>

<span data-ttu-id="60488-182">當使用者按一下分頁介面中的其中一個頁碼時，回傳接踵而來和頁面重載會顯示要求的頁面記錄。</span><span class="sxs-lookup"><span data-stu-id="60488-182">When the user clicks on one of the page numbers in the paging interface, a postback ensues and the page reloads showing that requested page s records.</span></span> <span data-ttu-id="60488-183">[圖 9] 顯示選擇觀看最後一頁的資料之後的結果。</span><span class="sxs-lookup"><span data-stu-id="60488-183">Figure 9 shows the results after opting to view the final page of data.</span></span> <span data-ttu-id="60488-184">請注意，最後一頁只有一筆記錄。這是因為總共有81筆記錄，因此每頁有八頁的10筆記錄，再加上一頁含有一筆獨立的記錄。</span><span class="sxs-lookup"><span data-stu-id="60488-184">Notice that the final page only has one record; this is because there are 81 records in total, resulting in eight pages of 10 records per page plus one page with a lone record.</span></span>

<span data-ttu-id="60488-185">[![按一下頁碼會導致回傳，並顯示適當的記錄子集](paging-and-sorting-report-data-cs/_static/image16.png)](paging-and-sorting-report-data-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="60488-185">[![Clicking On a Page Number Causes a Postback and Shows the Appropriate Subset of Records](paging-and-sorting-report-data-cs/_static/image16.png)](paging-and-sorting-report-data-cs/_static/image15.png)</span></span>

<span data-ttu-id="60488-186">**圖 9**：按一下頁碼會導致回傳，並顯示適當的記錄子集（[按一下以查看完整大小的影像](paging-and-sorting-report-data-cs/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-186">**Figure 9**: Clicking On a Page Number Causes a Postback and Shows the Appropriate Subset of Records ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image17.png))</span></span>

## <a name="paging-s-server-side-workflow"></a><span data-ttu-id="60488-187">分頁 s 伺服器端工作流程</span><span class="sxs-lookup"><span data-stu-id="60488-187">Paging s Server-Side Workflow</span></span>

<span data-ttu-id="60488-188">當使用者按一下分頁介面中的按鈕時，回傳接踵而來和下列伺服器端工作流程會開始：</span><span class="sxs-lookup"><span data-stu-id="60488-188">When the end user clicks on a button in the paging interface, a postback ensues and the following server-side workflow begins:</span></span>

1. <span data-ttu-id="60488-189">GridView s （或 DetailsView 或 FormView） `PageIndexChanging` 事件引發</span><span class="sxs-lookup"><span data-stu-id="60488-189">The GridView s (or DetailsView or FormView) `PageIndexChanging` event fires</span></span>
2. <span data-ttu-id="60488-190">ObjectDataSource 會重新要求 BLL 的*所有*資料;GridView 的 `PageIndex` 和 `PageSize` 屬性值是用來決定要在 GridView 中顯示的 BLL 所傳回的記錄</span><span class="sxs-lookup"><span data-stu-id="60488-190">The ObjectDataSource re-requests *all* of the data from the BLL; the GridView s `PageIndex` and `PageSize` property values are used to determine what records returned from the BLL need to be displayed in the GridView</span></span>
3. <span data-ttu-id="60488-191">GridView s `PageIndexChanged` 事件引發</span><span class="sxs-lookup"><span data-stu-id="60488-191">The GridView s `PageIndexChanged` event fires</span></span>

<span data-ttu-id="60488-192">在步驟2中，ObjectDataSource 會重新要求其資料來源中的所有資料。</span><span class="sxs-lookup"><span data-stu-id="60488-192">In Step 2, the ObjectDataSource re-requests all of the data from its data source.</span></span> <span data-ttu-id="60488-193">這種分頁方式通常稱為*預設分頁*，這是將 `AllowPaging` 屬性設定為 `true`時，預設會使用的分頁行為。</span><span class="sxs-lookup"><span data-stu-id="60488-193">This style of paging is commonly referred to as *default paging*, as it s the paging behavior used by default when setting the `AllowPaging` property to `true`.</span></span> <span data-ttu-id="60488-194">使用預設分頁時，資料 Web 控制項輕鬆自在管理會抓取每一頁數據的所有記錄，即使只有部分記錄會實際轉譯為傳送至瀏覽器的 HTML。</span><span class="sxs-lookup"><span data-stu-id="60488-194">With default paging the data Web control naively retrieves all records for each page of data, even though only a subset of records are actually rendered into the HTML that s sent to the browser.</span></span> <span data-ttu-id="60488-195">除非是由 BLL 或 ObjectDataSource 快取資料庫資料，否則預設分頁對於夠大的結果集或具有許多並行使用者的 web 應用程式而言是無法使用的。</span><span class="sxs-lookup"><span data-stu-id="60488-195">Unless the database data is cached by the BLL or ObjectDataSource, default paging is unworkable for sufficiently large result sets or for web applications with many concurrent users.</span></span>

<span data-ttu-id="60488-196">在下一個教學課程中，我們將探討如何執行*自訂分頁*。</span><span class="sxs-lookup"><span data-stu-id="60488-196">In the next tutorial we'll examine how to implement *custom paging*.</span></span> <span data-ttu-id="60488-197">透過自訂分頁，您可以明確地指示 ObjectDataSource 只取得所要求資料頁面所需的一組精確記錄。</span><span class="sxs-lookup"><span data-stu-id="60488-197">With custom paging you can specifically instruct the ObjectDataSource to only retrieve the precise set of records needed for the requested page of data.</span></span> <span data-ttu-id="60488-198">就像您想像的一樣，自訂分頁會大幅提升分頁處理大型結果集的效率。</span><span class="sxs-lookup"><span data-stu-id="60488-198">As you can imagine, custom paging greatly improves the efficiency of paging through large result sets.</span></span>

> [!NOTE]
> <span data-ttu-id="60488-199">雖然預設分頁不適合用來分頁到夠大的結果集或具有許多同時使用者的網站，但請注意，自訂分頁需要更多的變更和工作來執行，而且不像勾選核取方塊一樣簡單（預設為分頁）。</span><span class="sxs-lookup"><span data-stu-id="60488-199">While default paging is not suitable when paging through sufficiently large result sets or for sites with many simultaneous users, realize that custom paging requires more changes and effort to implement and is not as simple as checking a checkbox (as is default paging).</span></span> <span data-ttu-id="60488-200">因此，預設分頁可能是小型、低流量網站的理想選擇，或是透過相對較小的結果集進行分頁時，因為它更容易且更快速地執行。</span><span class="sxs-lookup"><span data-stu-id="60488-200">Therefore, default paging may be the ideal choice for small, low-traffic websites or when paging through relatively small result sets, as it s much easier and quicker to implement.</span></span>

<span data-ttu-id="60488-201">比方說，如果我們知道我們的資料庫永遠不會有超過100的產品，自訂分頁所能獲得的最小效能增益，可能會因執行它所需的工作而位移。</span><span class="sxs-lookup"><span data-stu-id="60488-201">For example, if we know that we'll never have more than 100 products in our database, the minimal performance gain enjoyed by custom paging is likely offset by the effort required to implement it.</span></span> <span data-ttu-id="60488-202">不過，如果我們可能一天有數千或數十個產品，則*不*會執行自訂分頁會大幅阻礙應用程式的擴充性。</span><span class="sxs-lookup"><span data-stu-id="60488-202">If, however, we may one day have thousands or tens of thousands of products, *not* implementing custom paging would greatly hamper the scalability of our application.</span></span>

## <a name="step-4-customizing-the-paging-experience"></a><span data-ttu-id="60488-203">步驟4：自訂分頁體驗</span><span class="sxs-lookup"><span data-stu-id="60488-203">Step 4: Customizing the Paging Experience</span></span>

<span data-ttu-id="60488-204">資料 Web 控制項提供一些屬性，可用於增強使用者的分頁體驗。</span><span class="sxs-lookup"><span data-stu-id="60488-204">The data Web controls provide a number of properties that can be used to enhance the user s paging experience.</span></span> <span data-ttu-id="60488-205">例如，`PageCount` 屬性會指出有多少總頁數，而 `PageIndex` 屬性則表示目前正在流覽的頁面，而且可以設定為將使用者快速移至特定的頁面。</span><span class="sxs-lookup"><span data-stu-id="60488-205">The `PageCount` property, for example, indicates how many total pages there are, while the `PageIndex` property indicates the current page being visited and can be set to quickly move a user to a specific page.</span></span> <span data-ttu-id="60488-206">為了說明如何使用這些屬性來改善使用者的分頁體驗，讓我們將標籤 Web 控制項新增至頁面，通知使用者目前正在造訪的頁面，以及可讓他們快速跳到任何指定頁面的 DropDownList 控制項.</span><span class="sxs-lookup"><span data-stu-id="60488-206">To illustrate how to use these properties to improve upon the user s paging experience, let s add a Label Web control to our page that informs the user what page they re currently visiting, along with a DropDownList control that allows them to quickly jump to any given page.</span></span>

<span data-ttu-id="60488-207">首先，將標籤 Web 控制項新增至您的頁面，將其 `ID` 屬性設定為 `PagingInformation`，並清除其 `Text` 屬性。</span><span class="sxs-lookup"><span data-stu-id="60488-207">First, add a Label Web control to your page, set its `ID` property to `PagingInformation`, and clear out its `Text` property.</span></span> <span data-ttu-id="60488-208">接下來，建立 GridView `DataBound` 事件的事件處理常式，並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="60488-208">Next, create an event handler for the GridView s `DataBound` event and add the following code:</span></span>

[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample5.cs)]

<span data-ttu-id="60488-209">這個事件處理常式會將 `PagingInformation` 標籤 `Text` 屬性指派給訊息，通知使用者目前正在造訪的頁面 `Products.PageIndex + 1` 超出總頁數 `Products.PageCount` （我們會將1加到 `Products.PageIndex` 屬性，因為 `PageIndex` 是從0開始編制索引）。</span><span class="sxs-lookup"><span data-stu-id="60488-209">This event handler assigns the `PagingInformation` Label s `Text` property to a message informing the user the page they are currently visiting `Products.PageIndex + 1` out of how many total pages `Products.PageCount` (we add 1 to the `Products.PageIndex` property because `PageIndex` is indexed starting at 0).</span></span> <span data-ttu-id="60488-210">我選擇 [在 `DataBound` 事件處理常式中指派此標籤 `Text`] 屬性，而不是 `PageIndexChanged` 事件處理常式，因為 `DataBound` 事件會在每次資料系結至 GridView 時引發，而 `PageIndexChanged` 事件處理常式只會在頁面索引變更時引發。</span><span class="sxs-lookup"><span data-stu-id="60488-210">I chose the assign this Label s `Text` property in the `DataBound` event handler as opposed to the `PageIndexChanged` event handler because the `DataBound` event fires every time data is bound to the GridView whereas the `PageIndexChanged` event handler only fires when the page index is changed.</span></span> <span data-ttu-id="60488-211">當 GridView 最初是第一頁上的資料系結時，`PageIndexChanging` 事件不會引發（而 `DataBound` 事件則是）。</span><span class="sxs-lookup"><span data-stu-id="60488-211">When the GridView is initially data bound on the first page visit, the `PageIndexChanging` event doesn t fire (whereas the `DataBound` event does).</span></span>

<span data-ttu-id="60488-212">透過這項新增功能，使用者現在會看到一則訊息，指出他們正在造訪的網頁，以及有多少總數據頁面。</span><span class="sxs-lookup"><span data-stu-id="60488-212">With this addition, the user is now shown a message indicating what page they are visiting and how many total pages of data there are.</span></span>

<span data-ttu-id="60488-213">[![目前的頁碼和總頁面數](paging-and-sorting-report-data-cs/_static/image19.png)](paging-and-sorting-report-data-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="60488-213">[![The Current Page Number and Total Number of Pages are Displayed](paging-and-sorting-report-data-cs/_static/image19.png)](paging-and-sorting-report-data-cs/_static/image18.png)</span></span>

<span data-ttu-id="60488-214">**圖 10**：顯示目前的頁碼和總頁數（[按一下以觀看完整大小的影像](paging-and-sorting-report-data-cs/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-214">**Figure 10**: The Current Page Number and Total Number of Pages are Displayed ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image20.png))</span></span>

<span data-ttu-id="60488-215">除了 [標籤] 控制項以外，讓同時也新增 DropDownList 控制項，其中列出 GridView 中的頁碼，並已選取目前所看到的頁面。</span><span class="sxs-lookup"><span data-stu-id="60488-215">In addition to the Label control, let s also add a DropDownList control that lists the page numbers in the GridView with the currently viewed page selected.</span></span> <span data-ttu-id="60488-216">這裡的想法是，使用者只要從 DropDownList 中選取新的頁面索引，就可以快速地從目前的頁面跳到另一頁。</span><span class="sxs-lookup"><span data-stu-id="60488-216">The idea here is that the user can quickly jump from the current page to another by simply selecting the new page index from the DropDownList.</span></span> <span data-ttu-id="60488-217">首先，將 DropDownList 新增至設計工具，將其 `ID` 屬性設定為 `PageList`，然後從其智慧標籤檢查 Enable AutoPostBack 選項。</span><span class="sxs-lookup"><span data-stu-id="60488-217">Start by adding a DropDownList to the Designer, setting its `ID` property to `PageList` and checking the Enable AutoPostBack option from its smart tag.</span></span>

<span data-ttu-id="60488-218">接下來，返回 `DataBound` 事件處理常式，並新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="60488-218">Next, return to the `DataBound` event handler and add the following code:</span></span>

[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample6.cs)]

<span data-ttu-id="60488-219">此程式碼一開始會清除 `PageList` DropDownList 中的專案。</span><span class="sxs-lookup"><span data-stu-id="60488-219">This code begins by clearing out the items in the `PageList` DropDownList.</span></span> <span data-ttu-id="60488-220">這似乎是多餘的，因為其中一個不會預期要變更的頁數，但其他使用者可能同時使用系統，新增或移除 `Products` 資料表中的記錄。</span><span class="sxs-lookup"><span data-stu-id="60488-220">This may seem superfluous, since one wouldn't expect the number of pages to change, but other users may be using the system simultaneously, adding or removing records from the `Products` table.</span></span> <span data-ttu-id="60488-221">這類插入或刪除可能會改變數據頁的數目。</span><span class="sxs-lookup"><span data-stu-id="60488-221">Such insertions or deletions could alter the number of pages of data.</span></span>

<span data-ttu-id="60488-222">接下來，我們需要再次建立頁碼，並將其對應至目前 GridView `PageIndex` 預設為選取。</span><span class="sxs-lookup"><span data-stu-id="60488-222">Next, we need to create the page numbers again and have the one that maps to the current GridView `PageIndex` selected by default.</span></span> <span data-ttu-id="60488-223">我們使用0到 `PageCount - 1`的迴圈來完成這項操作，在每個反復專案中加入新的 `ListItem`，並在目前的反復專案索引等於 GridView 的 `PageIndex` 屬性時，將其 `Selected` 屬性設定為 true。</span><span class="sxs-lookup"><span data-stu-id="60488-223">We accomplish this with a loop from 0 to `PageCount - 1`, adding a new `ListItem` in each iteration and setting its `Selected` property to true if the current iteration index equals the GridView s `PageIndex` property.</span></span>

<span data-ttu-id="60488-224">最後，我們需要建立 DropDownList s `SelectedIndexChanged` 事件的事件處理常式，這會在使用者每次從清單中挑選不同的專案時引發。</span><span class="sxs-lookup"><span data-stu-id="60488-224">Finally, we need to create an event handler for the DropDownList s `SelectedIndexChanged` event, which fires each time the user pick a different item from the list.</span></span> <span data-ttu-id="60488-225">若要建立這個事件處理常式，只要在設計工具中按兩下 DropDownList，然後加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="60488-225">To create this event handler, simply double-click the DropDownList in the Designer, then add the following code:</span></span>

[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample7.cs)]

<span data-ttu-id="60488-226">如 [圖 11] 所示，只是變更 GridView 的 `PageIndex` 屬性會導致將資料重新系結至 GridView。</span><span class="sxs-lookup"><span data-stu-id="60488-226">As Figure 11 shows, merely changing the GridView s `PageIndex` property causes the data to be rebound to the GridView.</span></span> <span data-ttu-id="60488-227">在 GridView 的 `DataBound` 事件處理常式中，會選取適當的 DropDownList `ListItem`。</span><span class="sxs-lookup"><span data-stu-id="60488-227">In the GridView s `DataBound` event handler, the appropriate DropDownList `ListItem` is selected.</span></span>

<span data-ttu-id="60488-228">[![在選取 [第6頁] 下拉式清單專案時，使用者會自動移至第六頁](paging-and-sorting-report-data-cs/_static/image22.png)](paging-and-sorting-report-data-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="60488-228">[![The User is Automatically Taken to the Sixth Page When Selecting the Page 6 Drop-Down List Item](paging-and-sorting-report-data-cs/_static/image22.png)](paging-and-sorting-report-data-cs/_static/image21.png)</span></span>

<span data-ttu-id="60488-229">**圖 11**：選取 [第6頁] 下拉式清單專案時，使用者會自動移至第六頁（[按一下以查看完整大小的影像](paging-and-sorting-report-data-cs/_static/image23.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-229">**Figure 11**: The User is Automatically Taken to the Sixth Page When Selecting the Page 6 Drop-Down List Item ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image23.png))</span></span>

## <a name="step-5-adding-bi-directional-sorting-support"></a><span data-ttu-id="60488-230">步驟5：加入雙向排序支援</span><span class="sxs-lookup"><span data-stu-id="60488-230">Step 5: Adding Bi-Directional Sorting Support</span></span>

<span data-ttu-id="60488-231">加入雙向排序支援就像加入分頁支援一樣簡單，只要從 GridView 的智慧標籤檢查 [啟用排序] 選項（這會將 GridView 的[`AllowSorting` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowsorting.aspx)設定為 `true`）。</span><span class="sxs-lookup"><span data-stu-id="60488-231">Adding bi-directional sorting support is as simple as adding paging support simply check the Enable Sorting option from the GridView s smart tag (which sets the GridView s [`AllowSorting` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowsorting.aspx) to `true`).</span></span> <span data-ttu-id="60488-232">這會將 GridView 欄位的每一個標頭轉譯為 LinkButtons，當按下時，會導致回傳，並以遞增的順序傳回按下的資料行排序的資料。</span><span class="sxs-lookup"><span data-stu-id="60488-232">This renders each of the headers of the GridView s fields as LinkButtons that, when clicked, cause a postback and return the data sorted by the clicked column in ascending order.</span></span> <span data-ttu-id="60488-233">再次按一下相同的標頭 LinkButton，會以遞減的順序重新排序資料。</span><span class="sxs-lookup"><span data-stu-id="60488-233">Clicking the same header LinkButton again re-sorts the data in descending order.</span></span>

> [!NOTE]
> <span data-ttu-id="60488-234">如果您使用的是自訂資料存取層，而不是具類型資料集，則在 GridView s 智慧標籤中可能不會有 [啟用排序] 選項。</span><span class="sxs-lookup"><span data-stu-id="60488-234">If you are using a custom Data Access Layer rather than a Typed DataSet, you may not have an Enable Sorting option in the GridView s smart tag.</span></span> <span data-ttu-id="60488-235">只有系結至原生支援排序之資料來源的 Gridview，才可使用此核取方塊。</span><span class="sxs-lookup"><span data-stu-id="60488-235">Only GridViews bound to data sources that natively support sorting have this checkbox available.</span></span> <span data-ttu-id="60488-236">具類型的資料集提供現成可用的排序支援，因為 ADO.NET DataTable 提供了 `Sort` 方法，在叫用時，會使用指定的準則來排序 DataTable s Datarow。</span><span class="sxs-lookup"><span data-stu-id="60488-236">The Typed DataSet provides out-of-the-box sorting support since the ADO.NET DataTable provides a `Sort` method that, when invoked, sorts the DataTable s DataRows using the criteria specified.</span></span>

<span data-ttu-id="60488-237">如果您的 DAL 不會傳回原生支援排序的物件，您將需要設定 ObjectDataSource 以將排序資訊傳遞給商務邏輯層，這可以排序資料，或讓資料以 DAL 排序。</span><span class="sxs-lookup"><span data-stu-id="60488-237">If your DAL does not return objects that natively support sorting you will need to configure the ObjectDataSource to pass sorting information to the Business Logic Layer, which can either sort the data or have the data sorted by the DAL.</span></span> <span data-ttu-id="60488-238">在未來的教學課程中，我們將探討如何在商務邏輯和資料存取層排序資料。</span><span class="sxs-lookup"><span data-stu-id="60488-238">We'll explore how to sort data at the Business Logic and Data Access Layers in a future tutorial.</span></span>

<span data-ttu-id="60488-239">排序 LinkButtons 會轉譯為 HTML 超連結，其目前的色彩（藍色代表未流覽的連結，紅色代表造訪的連結）與標頭資料列的背景色彩衝突。</span><span class="sxs-lookup"><span data-stu-id="60488-239">The sorting LinkButtons are rendered as HTML hyperlinks, whose current colors (blue for an unvisited link and a dark red for a visited link) clash with the background color of the header row.</span></span> <span data-ttu-id="60488-240">而是讓所有標頭資料列連結以白色顯示，不論是否已造訪。</span><span class="sxs-lookup"><span data-stu-id="60488-240">Instead, let s have all header row links displayed in white, regardless of whether they ve been visited or not.</span></span> <span data-ttu-id="60488-241">這可以藉由將下列內容新增至 `Styles.css` 類別來完成：</span><span class="sxs-lookup"><span data-stu-id="60488-241">This can be accomplished by adding the following to the `Styles.css` class:</span></span>

[!code-css[Main](paging-and-sorting-report-data-cs/samples/sample8.css)]

<span data-ttu-id="60488-242">此語法表示在使用 HeaderStyle 類別的專案中顯示這些超連結時，使用白色文字。</span><span class="sxs-lookup"><span data-stu-id="60488-242">This syntax indicates to use white text when displaying those hyperlinks within an element that uses the HeaderStyle class.</span></span>

<span data-ttu-id="60488-243">在此 CSS 加入之後，透過瀏覽器造訪頁面時，畫面看起來應該像 [圖 12]。</span><span class="sxs-lookup"><span data-stu-id="60488-243">After this CSS addition, when visiting the page through a browser your screen should look similar to Figure 12.</span></span> <span data-ttu-id="60488-244">特別是，[圖 12] 顯示在按下 Price 欄位的頁首連結之後的結果。</span><span class="sxs-lookup"><span data-stu-id="60488-244">In particular, Figure 12 shows the results after the Price field s header link has been clicked.</span></span>

<span data-ttu-id="60488-245">[![結果已依單價以遞增順序排序](paging-and-sorting-report-data-cs/_static/image25.png)](paging-and-sorting-report-data-cs/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="60488-245">[![The Results Have Been Sorted by the UnitPrice in Ascending Order](paging-and-sorting-report-data-cs/_static/image25.png)](paging-and-sorting-report-data-cs/_static/image24.png)</span></span>

<span data-ttu-id="60488-246">**圖 12**：結果已依單價以遞增順序排序（[按一下以觀看完整大小的影像](paging-and-sorting-report-data-cs/_static/image26.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-246">**Figure 12**: The Results Have Been Sorted by the UnitPrice in Ascending Order ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image26.png))</span></span>

## <a name="examining-the-sorting-workflow"></a><span data-ttu-id="60488-247">檢查排序工作流程</span><span class="sxs-lookup"><span data-stu-id="60488-247">Examining the Sorting Workflow</span></span>

<span data-ttu-id="60488-248">BoundField、CheckBoxField、TemplateField 等所有 GridView 欄位都有一個 `SortExpression` 屬性，它會指出當按下該欄位的排序標頭連結時，應該用來排序資料的運算式。</span><span class="sxs-lookup"><span data-stu-id="60488-248">All GridView fields the BoundField, CheckBoxField, TemplateField, and so on have a `SortExpression` property that indicates the expression that should be used to sort the data when that field s sorting header link is clicked.</span></span> <span data-ttu-id="60488-249">GridView 也具有 `SortExpression` 屬性。</span><span class="sxs-lookup"><span data-stu-id="60488-249">The GridView also has a `SortExpression` property.</span></span> <span data-ttu-id="60488-250">按一下排序標頭 LinkButton 時，GridView 會將該欄位的 `SortExpression` 值指派給它的 `SortExpression` 屬性。</span><span class="sxs-lookup"><span data-stu-id="60488-250">When a sorting header LinkButton is clicked, the GridView assigns that field s `SortExpression` value to its `SortExpression` property.</span></span> <span data-ttu-id="60488-251">接下來，會從 ObjectDataSource 重新抓取資料，並根據 GridView 的 `SortExpression` 屬性進行排序。</span><span class="sxs-lookup"><span data-stu-id="60488-251">Next, the data is re-retrieved from the ObjectDataSource and sorted according to the GridView s `SortExpression` property.</span></span> <span data-ttu-id="60488-252">下列清單詳細說明當使用者在 GridView 中排序資料時，所過大幅簡化的步驟順序：</span><span class="sxs-lookup"><span data-stu-id="60488-252">The following list details the sequence of steps that transpires when an end user sorts the data in a GridView:</span></span>

1. <span data-ttu-id="60488-253">GridView s[排序事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorting(VS.80).aspx)引發</span><span class="sxs-lookup"><span data-stu-id="60488-253">The GridView s [Sorting event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorting(VS.80).aspx) fires</span></span>
2. <span data-ttu-id="60488-254">GridView 的[`SortExpression` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sortexpression.aspx)會設定為按一下排序標頭 LinkButton 之欄位的 `SortExpression`</span><span class="sxs-lookup"><span data-stu-id="60488-254">The GridView s [`SortExpression` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sortexpression.aspx) is set to the `SortExpression` of the field whose sorting header LinkButton was clicked</span></span>
3. <span data-ttu-id="60488-255">ObjectDataSource 會重新抓取 BLL 中的所有資料，然後使用 GridView s 來排序資料 `SortExpression`</span><span class="sxs-lookup"><span data-stu-id="60488-255">The ObjectDataSource re-retrieves all of the data from the BLL and then sorts the data using the GridView s `SortExpression`</span></span>
4. <span data-ttu-id="60488-256">GridView 的 `PageIndex` 屬性會重設為0，這表示當排序使用者時，會傳回資料的第一頁（假設已執行分頁支援）</span><span class="sxs-lookup"><span data-stu-id="60488-256">The GridView s `PageIndex` property is reset to 0, meaning that when sorting the user is returned to the first page of data (assuming paging support has been implemented)</span></span>
5. <span data-ttu-id="60488-257">GridView s [`Sorted` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorted(VS.80).aspx)引發</span><span class="sxs-lookup"><span data-stu-id="60488-257">The GridView s [`Sorted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorted(VS.80).aspx) fires</span></span>

<span data-ttu-id="60488-258">如同預設分頁，預設的排序選項會重新抓取 BLL 中的*所有*記錄。</span><span class="sxs-lookup"><span data-stu-id="60488-258">Like with default paging, the default sorting option re-retrieves *all* of the records from the BLL.</span></span> <span data-ttu-id="60488-259">當不使用分頁或使用預設分頁來排序時，若沒有任何方法可以規避此效能的影響（快取資料庫資料，則不會叫用）。</span><span class="sxs-lookup"><span data-stu-id="60488-259">When using sorting without paging or when using sorting with default paging, there s no way to circumvent this performance hit (short of caching the database data).</span></span> <span data-ttu-id="60488-260">不過，如我們在未來的教學課程中所見，在使用自訂分頁時，可以有效率地排序資料。</span><span class="sxs-lookup"><span data-stu-id="60488-260">However, as we'll see in a future tutorial, it s possible to efficiently sort data when using custom paging.</span></span>

<span data-ttu-id="60488-261">透過 GridView 的智慧標籤中的下拉式清單，將 ObjectDataSource 系結至 GridView 時，每個 GridView 欄位都會自動將其 `SortExpression` 屬性指派給 `ProductsRow` 類別中的資料欄位名稱。</span><span class="sxs-lookup"><span data-stu-id="60488-261">When binding an ObjectDataSource to the GridView through the drop-down list in the GridView s smart tag, each GridView field automatically has its `SortExpression` property assigned to the name of the data field in the `ProductsRow` class.</span></span> <span data-ttu-id="60488-262">例如，`ProductName` BoundField s `SortExpression` 設定為 `ProductName`，如下列宣告式標記所示：</span><span class="sxs-lookup"><span data-stu-id="60488-262">For example, the `ProductName` BoundField s `SortExpression` is set to `ProductName`, as shown in the following declarative markup:</span></span>

[!code-aspx[Main](paging-and-sorting-report-data-cs/samples/sample9.aspx)]

<span data-ttu-id="60488-263">可以設定欄位，使其無法藉由清除其 `SortExpression` 屬性（將它指派給空字串）來進行排序。</span><span class="sxs-lookup"><span data-stu-id="60488-263">A field can be configured so that it s not sortable by clearing out its `SortExpression` property (assigning it to an empty string).</span></span> <span data-ttu-id="60488-264">為了說明這一點，假設我們不想讓客戶依價格排序產品。</span><span class="sxs-lookup"><span data-stu-id="60488-264">To illustrate this, imagine that we didn't want to let our customers sort our products by price.</span></span> <span data-ttu-id="60488-265">您可以從宣告式標記或透過 [欄位] 對話方塊（按一下 [GridView] 智慧標籤中的 [編輯資料行] 連結來存取），將 `UnitPrice` BoundField s `SortExpression` 屬性移除。</span><span class="sxs-lookup"><span data-stu-id="60488-265">The `UnitPrice` BoundField s `SortExpression` property can be removed either from the declarative markup or through the Fields dialog box (which is accessible by clicking on the Edit Columns link in the GridView s smart tag).</span></span>

![結果已依單價以遞增順序排序](paging-and-sorting-report-data-cs/_static/image27.png)

<span data-ttu-id="60488-267">**圖 13**：結果已依單價以遞增順序排序</span><span class="sxs-lookup"><span data-stu-id="60488-267">**Figure 13**: The Results Have Been Sorted by the UnitPrice in Ascending Order</span></span>

<span data-ttu-id="60488-268">移除 `UnitPrice` BoundField 的 `SortExpression` 屬性後，標頭就會轉譯為文字而非連結，藉此防止使用者依價格排序資料。</span><span class="sxs-lookup"><span data-stu-id="60488-268">Once the `SortExpression` property has been removed for the `UnitPrice` BoundField, the header is rendered as text rather than as a link, thereby preventing users from sorting the data by price.</span></span>

<span data-ttu-id="60488-269">[藉由移除 SortExpression 屬性 ![，使用者將無法再依價格排序產品](paging-and-sorting-report-data-cs/_static/image29.png)](paging-and-sorting-report-data-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="60488-269">[![By Removing the SortExpression Property, Users Can No Longer Sort the Products By Price](paging-and-sorting-report-data-cs/_static/image29.png)](paging-and-sorting-report-data-cs/_static/image28.png)</span></span>

<span data-ttu-id="60488-270">**圖 14**：藉由移除 SortExpression 屬性，使用者就無法再依價格排序產品（[按一下以觀看完整大小的影像](paging-and-sorting-report-data-cs/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-270">**Figure 14**: By Removing the SortExpression Property, Users Can No Longer Sort the Products By Price ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image30.png))</span></span>

## <a name="programmatically-sorting-the-gridview"></a><span data-ttu-id="60488-271">以程式設計方式排序 GridView</span><span class="sxs-lookup"><span data-stu-id="60488-271">Programmatically Sorting the GridView</span></span>

<span data-ttu-id="60488-272">您也可以使用 GridView 的[`Sort` 方法](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sort.aspx)，以程式設計方式排序 GridView 的內容。</span><span class="sxs-lookup"><span data-stu-id="60488-272">You can also sort the contents of the GridView programmatically by using the GridView s [`Sort` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sort.aspx).</span></span> <span data-ttu-id="60488-273">只要傳入 `SortExpression` 值來排序，連同[`SortDirection`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sortdirection.aspx) （`Ascending` 或 `Descending`），GridView 的資料就會重新排序。</span><span class="sxs-lookup"><span data-stu-id="60488-273">Simply pass in the `SortExpression` value to sort by along with the [`SortDirection`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sortdirection.aspx) (`Ascending` or `Descending`), and the GridView s data will be re-sorted.</span></span>

<span data-ttu-id="60488-274">假設我們關閉了 `UnitPrice` 的排序，因為我們擔心客戶只購買最低價格的產品。</span><span class="sxs-lookup"><span data-stu-id="60488-274">Imagine that the reason we turned off sorting by the `UnitPrice` was because we were worried that our customers would simply buy only the lowest-priced products.</span></span> <span data-ttu-id="60488-275">不過，我們想要鼓勵他們購買最昂貴的產品，所以我們可以讓他們能夠依價格排序產品，但只能從最昂貴的價格到最低。</span><span class="sxs-lookup"><span data-stu-id="60488-275">However, we want to encourage them to buy the most expensive products, so we d like them to be able to sort the products by price, but only from the most expensive price to the least.</span></span>

<span data-ttu-id="60488-276">若要完成這項操作，請將按鈕 Web 控制項新增至頁面，將其 `ID` 屬性設為 `SortPriceDescending`，並將其 `Text` 屬性設定為依價格排序。</span><span class="sxs-lookup"><span data-stu-id="60488-276">To accomplish this add a Button Web control to the page, set its `ID` property to `SortPriceDescending`, and its `Text` property to Sort by Price.</span></span> <span data-ttu-id="60488-277">接下來，在設計工具中按兩下按鈕控制項，以建立按鈕 s `Click` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="60488-277">Next, create an event handler for the Button s `Click` event by double-clicking the Button control in the Designer.</span></span> <span data-ttu-id="60488-278">將下列程式碼新增至這個事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="60488-278">Add the following code to this event handler:</span></span>

[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample10.cs)]

<span data-ttu-id="60488-279">按一下此按鈕會將使用者傳回至第一頁，其中包含以價格排序的產品，從最昂貴到最低成本（請參閱 [圖 15]）。</span><span class="sxs-lookup"><span data-stu-id="60488-279">Clicking this Button returns the user to the first page with the products sorted by price, from most expensive to least expensive (see Figure 15).</span></span>

<span data-ttu-id="60488-280">[![按一下按鈕，就會將產品的順序從最昂貴到最低](paging-and-sorting-report-data-cs/_static/image32.png)](paging-and-sorting-report-data-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="60488-280">[![Clicking the Button Orders the Products From the Most Expensive to the Least](paging-and-sorting-report-data-cs/_static/image32.png)](paging-and-sorting-report-data-cs/_static/image31.png)</span></span>

<span data-ttu-id="60488-281">**圖 15**：按一下按鈕會將產品從最高成本訂購到最少（[按一下以觀看完整大小的影像](paging-and-sorting-report-data-cs/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="60488-281">**Figure 15**: Clicking the Button Orders the Products From the Most Expensive to the Least ([Click to view full-size image](paging-and-sorting-report-data-cs/_static/image33.png))</span></span>

## <a name="summary"></a><span data-ttu-id="60488-282">總結</span><span class="sxs-lookup"><span data-stu-id="60488-282">Summary</span></span>

<span data-ttu-id="60488-283">在本教學課程中，我們已瞭解如何執行預設分頁和排序功能，這兩者都與勾選核取方塊一樣簡單！</span><span class="sxs-lookup"><span data-stu-id="60488-283">In this tutorial we saw how to implement default paging and sorting capabilities, both of which were as easy as checking a checkbox!</span></span> <span data-ttu-id="60488-284">當使用者透過資料進行排序或分頁時，類似的工作流程色彩：</span><span class="sxs-lookup"><span data-stu-id="60488-284">When a user sorts or pages through data, a similar workflow unfolds:</span></span>

1. <span data-ttu-id="60488-285">回傳接踵而來</span><span class="sxs-lookup"><span data-stu-id="60488-285">A postback ensues</span></span>
2. <span data-ttu-id="60488-286">資料 Web 控制項 s 的前期層級事件引發（`PageIndexChanging` 或 `Sorting`）</span><span class="sxs-lookup"><span data-stu-id="60488-286">The data Web control s pre-level event fires (`PageIndexChanging` or `Sorting`)</span></span>
3. <span data-ttu-id="60488-287">ObjectDataSource 會重新取出所有資料</span><span class="sxs-lookup"><span data-stu-id="60488-287">All of the data is re-retrieved by the ObjectDataSource</span></span>
4. <span data-ttu-id="60488-288">資料 Web 控制項的 post 層級事件引發（`PageIndexChanged` 或 `Sorted`）</span><span class="sxs-lookup"><span data-stu-id="60488-288">The data Web control s post-level event fires (`PageIndexChanged` or `Sorted`)</span></span>

<span data-ttu-id="60488-289">雖然實行基本分頁和排序是一種簡單的作業，但必須行使更多工作，才能利用更有效率的自訂分頁或進一步增強分頁或排序介面。</span><span class="sxs-lookup"><span data-stu-id="60488-289">While implementing basic paging and sorting is a breeze, more effort must be exerted to utilize the more efficient custom paging or to further enhance the paging or sorting interface.</span></span> <span data-ttu-id="60488-290">未來的教學課程將探索這些主題。</span><span class="sxs-lookup"><span data-stu-id="60488-290">Future tutorials will explore these topics.</span></span>

<span data-ttu-id="60488-291">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="60488-291">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="60488-292">關於作者</span><span class="sxs-lookup"><span data-stu-id="60488-292">About the Author</span></span>

<span data-ttu-id="60488-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="60488-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="60488-294">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="60488-294">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="60488-295">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="60488-295">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="60488-296">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="60488-296">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="60488-297">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="60488-297">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="60488-298">下一步</span><span class="sxs-lookup"><span data-stu-id="60488-298">Next</span></span>](efficiently-paging-through-large-amounts-of-data-cs.md)
