---
uid: web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
title: 使用具有詳細資料 DataList 的主要記錄項目符號清單的主要/詳細C#資料（） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們會將上一個教學課程的兩頁主要/詳細資料包表壓縮成單一頁面，並在 [t ...] 上顯示分類名稱的項目符號清單。
ms.author: riande
ms.date: 10/17/2006
ms.assetid: c727bb73-7b59-41a1-8dc3-623c6d69e7c2
msc.legacyurl: /web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 4549ab8e64599b09c300c158bedfd5d85efafc4d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78606278"
---
# <a name="masterdetail-using-a-bulleted-list-of-master-records-with-a-details-datalist-c"></a><span data-ttu-id="251f7-103">使用具有詳細資料 DataList 的主要記錄項目符號清單的主要/詳細資料 (C#)</span><span class="sxs-lookup"><span data-stu-id="251f7-103">Master/Detail Using a Bulleted List of Master Records with a Details DataList (C#)</span></span>

<span data-ttu-id="251f7-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="251f7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="251f7-105">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe)或[下載 PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="251f7-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) or [Download PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span></span>

> <span data-ttu-id="251f7-106">在本教學課程中，我們會將上一個教學課程的兩頁主要/詳細資料包表壓縮成單一頁面，並在畫面的左側顯示分類名稱的項目符號清單，以及螢幕右側所選類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-106">In this tutorial we'll compress the two-page master/detail report of the previous tutorial into a single page, showing a bulleted list of category names on the left side of the screen and the selected category's products on the right of the screen.</span></span>

## <a name="introduction"></a><span data-ttu-id="251f7-107">簡介</span><span class="sxs-lookup"><span data-stu-id="251f7-107">Introduction</span></span>

<span data-ttu-id="251f7-108">在[先前的教學](master-detail-filtering-acess-two-pages-datalist-cs.md)課程中，我們探討了如何跨兩個頁面分隔主要/詳細資料包表。</span><span class="sxs-lookup"><span data-stu-id="251f7-108">In the [preceding tutorial](master-detail-filtering-acess-two-pages-datalist-cs.md) we looked at how to separate a master/detail report across two pages.</span></span> <span data-ttu-id="251f7-109">在主版頁面中，我們使用了重複項控制項來轉譯類別的項目符號清單。</span><span class="sxs-lookup"><span data-stu-id="251f7-109">In the master page we used a Repeater control to render a bulleted list of categories.</span></span> <span data-ttu-id="251f7-110">每個類別目錄名稱都是超連結，當按下時，會將使用者帶到詳細資料頁面，其中，兩欄的 DataList 會顯示屬於所選類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-110">Each category name was a hyperlink that, when clicked, would take the user to the details page, where a two-column DataList showed those products belonging to the selected category.</span></span>

<span data-ttu-id="251f7-111">在本教學課程中，我們會將兩頁教學課程壓縮成單一頁面，在畫面左側顯示類別目錄名稱的項目符號清單，並將每個類別目錄名稱轉譯為 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="251f7-111">In this tutorial we'll compress the two-page tutorial into a single page, showing a bulleted list of category names on the left side of the screen with each category name rendered as a LinkButton.</span></span> <span data-ttu-id="251f7-112">按一下其中一個類別目錄名稱 LinkButtons 會引發回傳，並將選取的類別 s 產品系結至螢幕右邊的兩個數據行 DataList。</span><span class="sxs-lookup"><span data-stu-id="251f7-112">Clicking one of the category name LinkButtons induces a postback and binds the selected category s products to a two-column DataList on the right of the screen.</span></span> <span data-ttu-id="251f7-113">除了顯示每個類別目錄的名稱，左邊的中繼器會顯示指定類別的總產品數（請參閱 [圖 1]）。</span><span class="sxs-lookup"><span data-stu-id="251f7-113">In addition to displaying each category s name, the Repeater on the left shows how many total products there are for a given category (see Figure 1).</span></span>

<span data-ttu-id="251f7-114">[![類別目錄的名稱，以及顯示在左側的產品總數](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-114">[![The Category s Name and Total Number of Products are Displayed on the Left](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span></span>

<span data-ttu-id="251f7-115">**圖 1**：類別目錄的名稱和產品總數會顯示在左邊（[按一下以觀看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-115">**Figure 1**: The Category s Name and Total Number of Products are Displayed on the Left ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span></span>

## <a name="step-1-displaying-a-repeater-in-the-left-portion-of-the-screen"></a><span data-ttu-id="251f7-116">步驟1：在畫面的左邊部分顯示中繼器</span><span class="sxs-lookup"><span data-stu-id="251f7-116">Step 1: Displaying a Repeater in the Left Portion of the Screen</span></span>

<span data-ttu-id="251f7-117">在本教學課程中，我們必須在所選類別目錄的左邊顯示分類的類別目錄清單。</span><span class="sxs-lookup"><span data-stu-id="251f7-117">For this tutorial we need to have the bulleted list of categories appear to the left of the selected category s products.</span></span> <span data-ttu-id="251f7-118">網頁中的內容可以使用標準的 HTML 專案段落標記、不分行空格、`<table>` s，或透過級聯樣式表單（CSS）技術來定位。</span><span class="sxs-lookup"><span data-stu-id="251f7-118">Content within a web page can be positioned using standard HTML elements paragraph tags, non-breaking spaces, `<table>` s, and so on or through cascading stylesheet (CSS) techniques.</span></span> <span data-ttu-id="251f7-119">到目前為止，我們的所有教學課程都使用了 CSS 技術來定位。</span><span class="sxs-lookup"><span data-stu-id="251f7-119">All of our tutorials thus far have used CSS techniques for positioning.</span></span> <span data-ttu-id="251f7-120">當我們在主版頁面[和網站導覽](../introduction/master-pages-and-site-navigation-cs.md)教學課程的主版頁面中建立導覽使用者介面時，我們使用了*絕對位置*，指出導覽清單和主要內容的精確圖元位移。</span><span class="sxs-lookup"><span data-stu-id="251f7-120">When we built the navigation user interface in our master page in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we used *absolute positioning*, indicating the precise pixel offset for the navigation list and the main content.</span></span> <span data-ttu-id="251f7-121">或者，您可以使用 CSS，透過*浮動*將某個元素放在另一個專案的右邊或左邊。</span><span class="sxs-lookup"><span data-stu-id="251f7-121">Alternatively, CSS can be used to position one element to the right or left of another through *floating*.</span></span> <span data-ttu-id="251f7-122">在選取的類別 s 產品的左邊，我們可以將重複項的清單顯示在 [DataList] 左邊，</span><span class="sxs-lookup"><span data-stu-id="251f7-122">We can have the bulleted list of categories appear to the left of the selected category s products by floating the Repeater to the left of the DataList</span></span>

<span data-ttu-id="251f7-123">從 [`DataListRepeaterFiltering`] 資料夾開啟 [`CategoriesAndProducts.aspx`] 頁面，並將 [中繼器] 和 [DataList] 加入至頁面。</span><span class="sxs-lookup"><span data-stu-id="251f7-123">Open the `CategoriesAndProducts.aspx` page from the `DataListRepeaterFiltering` folder and add to the page a Repeater and a DataList.</span></span> <span data-ttu-id="251f7-124">將 中繼器 s `ID` 設定為 `Categories`，並將 DataList 設為 `CategoryProducts`。</span><span class="sxs-lookup"><span data-stu-id="251f7-124">Set the Repeater s `ID` to `Categories` and the DataList s to `CategoryProducts`.</span></span> <span data-ttu-id="251f7-125">移至 [來源] 視圖，並將 [中繼器] 和 [DataList] 控制項放在自己的 `<div>` 元素內。</span><span class="sxs-lookup"><span data-stu-id="251f7-125">Go to the Source view and put the Repeater and DataList controls within their own `<div>` elements.</span></span> <span data-ttu-id="251f7-126">也就是，先將重複項放在 `<div>` 專案中，然後在它自己的 `<div>` 元素中，直接在中繼器後面加上 DataList。</span><span class="sxs-lookup"><span data-stu-id="251f7-126">That is, enclose the Repeater within a `<div>` element first and then the DataList in its own `<div>` element directly after the Repeater.</span></span> <span data-ttu-id="251f7-127">此時您的標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="251f7-127">Your markup at this point should look similar to the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample1.aspx)]

<span data-ttu-id="251f7-128">若要將重複項的浮動加入 DataList 的左邊，我們必須使用 `float` CSS 樣式屬性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="251f7-128">To float the Repeater to the left of the DataList, we need to use the `float` CSS style attribute, like so:</span></span>

[!code-html[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample2.html)]

<span data-ttu-id="251f7-129">`float: left;` 會將第一個 `<div>` 專案浮動到第二個元素的左邊。</span><span class="sxs-lookup"><span data-stu-id="251f7-129">The `float: left;` floats the first `<div>` element to the left of the second one.</span></span> <span data-ttu-id="251f7-130">`width` 和 `padding-right` 設定會指出第一個 `<div>` 的 `width`，以及要在 `<div>` 元素的內容及其右邊界之間加入多少填補。</span><span class="sxs-lookup"><span data-stu-id="251f7-130">The `width` and `padding-right` settings indicate the first `<div>` s `width` and how much padding is added between the `<div>` element s content and its right margin.</span></span> <span data-ttu-id="251f7-131">如需 CSS 中浮動元素的詳細資訊，請參閱[Floatutorial](http://css.maxdesign.com.au/floatutorial/)。</span><span class="sxs-lookup"><span data-stu-id="251f7-131">For more information on floating elements in CSS check out the [Floatutorial](http://css.maxdesign.com.au/floatutorial/).</span></span>

<span data-ttu-id="251f7-132">不是直接透過第一個 `<p>` 元素 `style` 屬性來指定樣式設定，而是改為在名為 `FloatLeft`的 `Styles.css` 中建立新的 CSS 類別：</span><span class="sxs-lookup"><span data-stu-id="251f7-132">Rather than specify the style setting directly through the first `<p>` element s `style` attribute, let s instead create a new CSS class in `Styles.css` named `FloatLeft`:</span></span>

[!code-css[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample3.css)]

<span data-ttu-id="251f7-133">然後，我們可以使用 `<div class="FloatLeft">`來取代 `<div>`。</span><span class="sxs-lookup"><span data-stu-id="251f7-133">Then we can replace the `<div>` with `<div class="FloatLeft">`.</span></span>

<span data-ttu-id="251f7-134">在 [`CategoriesAndProducts.aspx`] 頁面中加入 CSS 類別並設定標記之後，請移至設計工具。</span><span class="sxs-lookup"><span data-stu-id="251f7-134">After adding the CSS class and configuring the markup in the `CategoriesAndProducts.aspx` page, go to the Designer.</span></span> <span data-ttu-id="251f7-135">您應該會看到在 DataList 左邊浮動的中繼器（雖然現在這兩個都只會顯示為灰色方塊，因為我們尚未設定其資料來源或範本）。</span><span class="sxs-lookup"><span data-stu-id="251f7-135">You should see the Repeater floating to the left of the DataList (although right now both just appear as gray boxes since we ve yet to configure their data sources or templates).</span></span>

<span data-ttu-id="251f7-136">[![在 DataList 的左邊浮動中繼器](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-136">[![The Repeater is Floated to the Left of the DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span></span>

<span data-ttu-id="251f7-137">**圖 2**：中繼器會浮動在 DataList 的左邊（[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-137">**Figure 2**: The Repeater is Floated to the Left of the DataList ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span></span>

## <a name="step-2-determining-the-number-of-products-for-each-category"></a><span data-ttu-id="251f7-138">步驟2：判斷每個類別目錄的產品數目</span><span class="sxs-lookup"><span data-stu-id="251f7-138">Step 2: Determining the Number of Products for Each Category</span></span>

<span data-ttu-id="251f7-139">有了重複項標記和 DataList 的周圍標記完成後，我們就準備好將類別目錄資料系結至重複項控制項。</span><span class="sxs-lookup"><span data-stu-id="251f7-139">With the Repeater and DataList s surrounding markup complete, we re ready to bind the category data to the Repeater control.</span></span> <span data-ttu-id="251f7-140">不過，如同 [圖 1] 中的類別目錄清單所示，除了每個類別目錄的名稱之外，我們也需要顯示與類別相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-140">However, as the bulleted list of categories in Figure 1 shows, in addition to each category s name we also need to display the number of products associated with the category.</span></span> <span data-ttu-id="251f7-141">若要存取這項資訊，我們可以執行下列其中一項：</span><span class="sxs-lookup"><span data-stu-id="251f7-141">To access this information we can either:</span></span>

- <span data-ttu-id="251f7-142">**從 ASP.NET 網頁的程式碼後置類別中判斷此資訊。**</span><span class="sxs-lookup"><span data-stu-id="251f7-142">**Determine this information from the ASP.NET page s code-behind class.**</span></span> <span data-ttu-id="251f7-143">假設有特定 *`categoryID`* 我們可以藉由呼叫 `ProductsBLL` 類別 s `GetProductsByCategoryID(categoryID)` 方法來判斷相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-143">Given a particular *`categoryID`* we can determine the number of associated products by calling the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="251f7-144">這個方法會傳回 `ProductsDataTable` 物件，其 `Count` 屬性指出存在多少 `ProductsRow` 秒，也就是指定 *`categoryID`* 的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-144">This method returns a `ProductsDataTable` object whose `Count` property indicates how many `ProductsRow` s exists, which is the number of products for the specified *`categoryID`*.</span></span> <span data-ttu-id="251f7-145">我們可以為中繼器建立 `ItemDataBound` 事件處理常式，每個系結至中繼器的類別都會呼叫 `ProductsBLL` 類別 s `GetProductsByCategoryID(categoryID)` 方法，並將其計數包含在輸出中。</span><span class="sxs-lookup"><span data-stu-id="251f7-145">We can create an `ItemDataBound` event handler for the Repeater that, for each category bound to the Repeater, calls the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and includes its count in the output.</span></span>
- <span data-ttu-id="251f7-146">**更新具類型資料集中的 `CategoriesDataTable`，以包含 `NumberOfProducts` 的資料行。**</span><span class="sxs-lookup"><span data-stu-id="251f7-146">**Update the `CategoriesDataTable` in the Typed DataSet to include a `NumberOfProducts` column.**</span></span> <span data-ttu-id="251f7-147">然後，我們可以更新 `CategoriesDataTable` 中的 `GetCategories()` 方法以包含這項資訊，或者將 `GetCategories()` 保持原狀，並建立稱為 `GetCategoriesAndNumberOfProducts()`的新 `CategoriesDataTable` 方法。</span><span class="sxs-lookup"><span data-stu-id="251f7-147">We can then update the `GetCategories()` method in the `CategoriesDataTable` to include this information or, alternatively, leave `GetCategories()` as-is and create a new `CategoriesDataTable` method called `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="251f7-148">讓我們來探索這兩種技術。</span><span class="sxs-lookup"><span data-stu-id="251f7-148">Let s explore both of these techniques.</span></span> <span data-ttu-id="251f7-149">第一種方法較容易實行，因為我們不需要更新資料存取層;不過，它需要更多與資料庫的通訊。</span><span class="sxs-lookup"><span data-stu-id="251f7-149">The first approach is simpler to implement since we don t need to update the Data Access Layer; however, it requires more communications with the database.</span></span> <span data-ttu-id="251f7-150">在 `ItemDataBound` 事件處理常式中呼叫 `ProductsBLL` 類別 `GetProductsByCategoryID(categoryID)` 方法，會為重複項中顯示的每個類別新增額外的資料庫呼叫。</span><span class="sxs-lookup"><span data-stu-id="251f7-150">The call to the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method in the `ItemDataBound` event handler adds an extra database call for each category displayed in the Repeater.</span></span> <span data-ttu-id="251f7-151">使用這項技術時，會有*n* + 1 個資料庫呼叫，其中*N*是在中繼器中顯示的類別目錄數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-151">With this technique there are *N* + 1 database calls, where *N* is the number of categories displayed in the Repeater.</span></span> <span data-ttu-id="251f7-152">使用第二種方法時，會傳回產品計數，其中包含來自 `CategoriesBLL` 類別 `GetCategories()` （或 `GetCategoriesAndNumberOfProducts()`）方法的每個分類的相關資訊，因此只會產生一次資料庫的往返。</span><span class="sxs-lookup"><span data-stu-id="251f7-152">With the second approach, the product count is returned with information about each category from the `CategoriesBLL` class s `GetCategories()` (or `GetCategoriesAndNumberOfProducts()`) method, thereby resulting in just one trip to the database.</span></span>

## <a name="determining-the-number-of-products-in-the-itemdatabound-event-handler"></a><span data-ttu-id="251f7-153">判斷 ItemDataBound 事件處理常式中的產品數目</span><span class="sxs-lookup"><span data-stu-id="251f7-153">Determining the Number of Products in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="251f7-154">判斷中繼器中每個類別的產品數目 `ItemDataBound` 事件處理常式不需要對現有的資料存取層進行任何修改。</span><span class="sxs-lookup"><span data-stu-id="251f7-154">Determining the number of products for each category in the Repeater s `ItemDataBound` event handler does not require any modifications to our existing Data Access Layer.</span></span> <span data-ttu-id="251f7-155">所有的修改都可以直接在 [`CategoriesAndProducts.aspx`] 頁面中進行。</span><span class="sxs-lookup"><span data-stu-id="251f7-155">All modifications can be made directly within the `CategoriesAndProducts.aspx` page.</span></span> <span data-ttu-id="251f7-156">首先，透過 [中繼器] 智慧標籤，新增名為 `CategoriesDataSource` 的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="251f7-156">Start by adding a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="251f7-157">接下來，設定 `CategoriesDataSource` ObjectDataSource，使其從 `CategoriesBLL` 類別 s `GetCategories()` 方法中抓取其資料。</span><span class="sxs-lookup"><span data-stu-id="251f7-157">Next, configure the `CategoriesDataSource` ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>

<span data-ttu-id="251f7-158">[![將 ObjectDataSource 設定為使用 CategoriesBLL 類別的 GetCategories （）方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-158">[![Configure the ObjectDataSource to Use the CategoriesBLL class s GetCategories() Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span></span>

<span data-ttu-id="251f7-159">**圖 3**：設定 ObjectDataSource 使用 `CategoriesBLL` 類別的 `GetCategories()` 方法（[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-159">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` class s `GetCategories()` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span></span>

<span data-ttu-id="251f7-160">`Categories` 中繼器中的每個專案都必須是可按的，並且在按一下時，會導致 `CategoryProducts` DataList 顯示所選類別的這些產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-160">Each item in the `Categories` Repeater needs to be clickable and, when clicked, cause the `CategoryProducts` DataList to display those products for the selected category.</span></span> <span data-ttu-id="251f7-161">這可以藉由將每個類別設為超連結、連結回到這個相同的頁面（`CategoriesAndProducts.aspx`）來完成，但透過 querystring 傳遞 `CategoryID`，與我們在上一個教學課程中看到的類似。</span><span class="sxs-lookup"><span data-stu-id="251f7-161">This can be accomplished by making each category a hyperlink, linking back to this same page (`CategoriesAndProducts.aspx`), but passing the `CategoryID` through the querystring, much like we saw in the previous tutorial.</span></span> <span data-ttu-id="251f7-162">這種方法的優點是顯示特定類別目錄產品的頁面，可以由搜尋引擎以書簽和編制索引。</span><span class="sxs-lookup"><span data-stu-id="251f7-162">The advantage of this approach is that a page displaying a particular category s products can be bookmarked and indexed by a search engine.</span></span>

<span data-ttu-id="251f7-163">或者，我們可以將每個類別設為 LinkButton，這是我們將在本教學課程中使用的方法。</span><span class="sxs-lookup"><span data-stu-id="251f7-163">Alternatively, we can make each category a LinkButton, which is the approach we'll use for this tutorial.</span></span> <span data-ttu-id="251f7-164">LinkButton 會在使用者的瀏覽器中轉譯為超連結，但是按一下時，會引發回傳。在回傳時，DataList s ObjectDataSource 必須重新整理，才能顯示屬於所選類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-164">The LinkButton renders in the user s browser as a hyperlink but, when clicked, induces a postback; on postback, the DataList s ObjectDataSource needs to be refreshed to display those products belonging to the selected category.</span></span> <span data-ttu-id="251f7-165">在本教學課程中，使用超連結會比使用 LinkButton 更合理。不過，在某些情況下，使用 LinkButton 會更有利。</span><span class="sxs-lookup"><span data-stu-id="251f7-165">For this tutorial, using a hyperlink makes more sense than using a LinkButton; however, there may be other scenarios where using a LinkButton is more advantageous.</span></span> <span data-ttu-id="251f7-166">雖然超連結方法是此範例的理想選擇，但讓我們改為使用 LinkButton 來探索。</span><span class="sxs-lookup"><span data-stu-id="251f7-166">While the hyperlink approach would be ideal for this example, let s instead explore using the LinkButton.</span></span> <span data-ttu-id="251f7-167">如我們所見，使用 LinkButton 會帶來一些因超連結而不會發生的挑戰。</span><span class="sxs-lookup"><span data-stu-id="251f7-167">As we'll see, using a LinkButton introduces some challenges that would not otherwise arise with a hyperlink.</span></span> <span data-ttu-id="251f7-168">因此，在本教學課程中使用 LinkButton 將會反白顯示這些挑戰，並協助為我們想要使用 LinkButton 而非超連結的案例提供解決方案。</span><span class="sxs-lookup"><span data-stu-id="251f7-168">Therefore, using a LinkButton in this tutorial will highlight these challenges and help provide solutions for those scenarios where we may want to use a LinkButton instead of a hyperlink.</span></span>

> [!NOTE]
> <span data-ttu-id="251f7-169">建議您使用超連結控制項或 `<a>` 元素（而不是 LinkButton）來重複本教學課程。</span><span class="sxs-lookup"><span data-stu-id="251f7-169">You are encouraged to repeat this tutorial using a HyperLink control or `<a>` element in lieu of the LinkButton.</span></span>

<span data-ttu-id="251f7-170">下列標記顯示中繼器和 ObjectDataSource 的宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="251f7-170">The following markup shows the declarative syntax for the Repeater and the ObjectDataSource.</span></span> <span data-ttu-id="251f7-171">請注意，[中繼器] 範本會以項目符號清單呈現每個專案的 LinkButton：</span><span class="sxs-lookup"><span data-stu-id="251f7-171">Note that the Repeater s templates render a bulleted list with each item as a LinkButton:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample4.aspx)]

> [!NOTE]
> <span data-ttu-id="251f7-172">在本教學課程中，中繼器必須啟用其 view 狀態（請注意，從中繼器 s 宣告式語法省略 `EnableViewState="False"`）。</span><span class="sxs-lookup"><span data-stu-id="251f7-172">For this tutorial the Repeater must have its view state enabled (note the omission of the `EnableViewState="False"` from the Repeater s declarative syntax).</span></span> <span data-ttu-id="251f7-173">在步驟3中，我們將為 [中繼器] `ItemCommand` 事件建立事件處理常式，我們將在其中更新 DataList s ObjectDataSource `SelectParameters` 集合。</span><span class="sxs-lookup"><span data-stu-id="251f7-173">In step 3 we'll be creating an event handler for the Repeater s `ItemCommand` event in which we'll be updating the DataList s ObjectDataSource s `SelectParameters` collection.</span></span> <span data-ttu-id="251f7-174">不過，如果停用檢視狀態，則不會引發中繼器 `ItemCommand`。</span><span class="sxs-lookup"><span data-stu-id="251f7-174">The Repeater s `ItemCommand`, however, won't fire if view state is disabled.</span></span> <span data-ttu-id="251f7-175">請參閱[ASP.NET 問題](http://scottonwriting.net/sowblog/posts/1263.aspx)和[其解決方案](http://scottonwriting.net/sowBlog/posts/1268.aspx)的 Stumper，以瞭解為什麼必須針對中繼器 `ItemCommand` 事件啟用 view 狀態的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="251f7-175">See [A Stumper of an ASP.NET Question](http://scottonwriting.net/sowblog/posts/1263.aspx) and [its solution](http://scottonwriting.net/sowBlog/posts/1268.aspx) for more information on why view state must be enabled for a Repeater s `ItemCommand` event to fire.</span></span>

<span data-ttu-id="251f7-176">`ID` 屬性值為 `ViewCategory` 的 LinkButton 並未設定其 `Text` 屬性。</span><span class="sxs-lookup"><span data-stu-id="251f7-176">The LinkButton with the `ID` property value of `ViewCategory` does not have its `Text` property set.</span></span> <span data-ttu-id="251f7-177">如果我們只想要顯示類別名稱，我們會透過資料系結語法，以宣告方式設定文字屬性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="251f7-177">If we had just wanted to display the category name, we would have set the Text property declaratively, through databinding syntax, like so:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample5.aspx)]

<span data-ttu-id="251f7-178">不過，我們想要顯示類別目錄的名稱 *，以及*屬於該類別目錄的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-178">However, we want to show both the category s name *and* the number of products belonging to that category.</span></span> <span data-ttu-id="251f7-179">這項資訊可以從中繼器 `ItemDataBound` 事件處理常式中取得，方法是呼叫 `ProductBLL` 類別 s `GetCategoriesByProductID(categoryID)` 方法，並判斷產生的 `ProductsDataTable`中傳回多少筆記錄，如下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="251f7-179">This information can be retrieved from the Repeater s `ItemDataBound` event handler by making a call to the `ProductBLL` class s `GetCategoriesByProductID(categoryID)` method and determining how many records are returned in the resulting `ProductsDataTable`, as the following code illustrates:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="251f7-180">我們一開始先確定我們會使用資料項目（其 `ItemType` `Item` 或 `AlternatingItem`），然後參考剛系結至目前 `RepeaterItem`的 `CategoriesRow` 實例。</span><span class="sxs-lookup"><span data-stu-id="251f7-180">We start out by ensuring that we re working with a data item (one whose `ItemType` is `Item` or `AlternatingItem`) and then reference the `CategoriesRow` instance that has just been bound to the current `RepeaterItem`.</span></span> <span data-ttu-id="251f7-181">接下來，我們會藉由建立 `ProductsBLL` 類別的實例、呼叫其 `GetCategoriesByProductID(categoryID)` 方法，以及使用 `Count` 屬性來判斷傳回的記錄數目，來判斷此類別的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-181">Next, we determine the number of products for this category by creating an instance of the `ProductsBLL` class, calling its `GetCategoriesByProductID(categoryID)` method, and determining the number of records returned using the `Count` property.</span></span> <span data-ttu-id="251f7-182">最後，ItemTemplate 中的 `ViewCategory` LinkButton 是參考，而且它的 `Text` 屬性會設定為 [*類別名稱*（*NumberOfProductsInCategory*）]，其中*NumberOfProductsInCategory*會格式化為零位數的數位。</span><span class="sxs-lookup"><span data-stu-id="251f7-182">Finally, the `ViewCategory` LinkButton in the ItemTemplate is references and its `Text` property is set to *CategoryName* (*NumberOfProductsInCategory*), where *NumberOfProductsInCategory* is formatted as a number with zero decimal places.</span></span>

> [!NOTE]
> <span data-ttu-id="251f7-183">或者，我們也可以將*格式化函數*新增至 ASP.NET 網頁的程式碼後置類別，此類別會接受 category `CategoryName` 並 `CategoryID` 值，並傳回與類別目錄中的產品數目（藉由呼叫 `GetCategoriesByProductID(categoryID)` 方法所決定）串連的 `CategoryName`。</span><span class="sxs-lookup"><span data-stu-id="251f7-183">Alternatively, we could have added a *formatting function* to the ASP.NET page s code-behind class that accepts a category s `CategoryName` and `CategoryID` values and returns the `CategoryName` concatenated with the number of products in the category (as determined by calling the `GetCategoriesByProductID(categoryID)` method).</span></span> <span data-ttu-id="251f7-184">這類格式化函式的結果可以用宣告方式指派給 LinkButton s Text 屬性，以取代 `ItemDataBound` 事件處理常式的需求。</span><span class="sxs-lookup"><span data-stu-id="251f7-184">The results of such a formatting function could be declaratively assigned to the LinkButton s Text property replacing the need for the `ItemDataBound` event handler.</span></span> <span data-ttu-id="251f7-185">如需有關使用格式化函數的詳細資訊，請參閱[GridView 控制項中的 Using TemplateFields](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)或根據資料教學課程來[格式化 DataList 和中繼器](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="251f7-185">Refer to the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) or [Formatting the DataList and Repeater Based Upon Data](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) tutorials for more information on using formatting functions.</span></span>

<span data-ttu-id="251f7-186">加入這個事件處理常式之後，請花一點時間透過瀏覽器來測試頁面。</span><span class="sxs-lookup"><span data-stu-id="251f7-186">After adding this event handler, take a moment to test the page through a browser.</span></span> <span data-ttu-id="251f7-187">請注意每個類別目錄在項目符號清單中的列出方式，其中會顯示類別目錄的名稱，以及與類別目錄相關聯的產品數目（請參閱 [圖 4]）。</span><span class="sxs-lookup"><span data-stu-id="251f7-187">Note how each category is listed in a bulleted list, displaying the category s name and the number of products associated with the category (see Figure 4).</span></span>

<span data-ttu-id="251f7-188">[![顯示每個分類的名稱和產品數目](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-188">[![Each Category s Name and Number of Products are Displayed](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span></span>

<span data-ttu-id="251f7-189">**圖 4**：顯示每個類別目錄的名稱和產品數目（[按一下以觀看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-189">**Figure 4**: Each Category s Name and Number of Products are Displayed ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span></span>

## <a name="updating-thecategoriesdatatableandcategoriestableadapterto-include-the-number-of-products-for-each-category"></a><span data-ttu-id="251f7-190">更新`CategoriesDataTable`和`CategoriesTableAdapter`，以包含每個類別目錄的產品數目</span><span class="sxs-lookup"><span data-stu-id="251f7-190">Updating the`CategoriesDataTable`and`CategoriesTableAdapter`to Include the Number of Products for Each Category</span></span>

<span data-ttu-id="251f7-191">我們可以藉由調整資料存取層中的 `CategoriesDataTable` 和 `CategoriesTableAdapter`，以原生方式包含這項資訊，而不是判斷每個類別的產品數與中繼器系結。</span><span class="sxs-lookup"><span data-stu-id="251f7-191">Rather than determining the number of products for each category as it s bound to the Repeater, we can streamline this process by adjusting the `CategoriesDataTable` and `CategoriesTableAdapter` in the Data Access Layer to include this information natively.</span></span> <span data-ttu-id="251f7-192">若要達到此目的，我們必須將新的資料行新增至 `CategoriesDataTable`，以保存相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-192">To achieve this, we must add a new column to `CategoriesDataTable` to hold the number of associated products.</span></span> <span data-ttu-id="251f7-193">若要將新的資料行加入至 DataTable，請開啟具類型資料集（`App_Code\DAL\Northwind.xsd`），以滑鼠右鍵按一下要修改的 DataTable，然後選擇 [加入/資料行]。</span><span class="sxs-lookup"><span data-stu-id="251f7-193">To add a new column to a DataTable, open the Typed DataSet (`App_Code\DAL\Northwind.xsd`), right-click on the DataTable to modify, and choose Add / Column.</span></span> <span data-ttu-id="251f7-194">將新的資料行加入至 `CategoriesDataTable` （請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="251f7-194">Add a new column to the `CategoriesDataTable` (see Figure 5).</span></span>

<span data-ttu-id="251f7-195">[![在 CategoriesDataSource 中加入新的資料行](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-195">[![Add a New Column to the CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span></span>

<span data-ttu-id="251f7-196">**圖 5**：將新的資料行加入至 `CategoriesDataSource` （[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-196">**Figure 5**: Add a New Column to the `CategoriesDataSource` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span></span>

<span data-ttu-id="251f7-197">這會新增名為 `Column1`的新資料行，您只要輸入不同的名稱就可以變更。</span><span class="sxs-lookup"><span data-stu-id="251f7-197">This will add a new column named `Column1`, which you can change by simply typing in a different name.</span></span> <span data-ttu-id="251f7-198">將這個新的資料行重新命名為 `NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="251f7-198">Rename this new column to `NumberOfProducts`.</span></span> <span data-ttu-id="251f7-199">接下來，我們需要設定這個資料行的屬性。</span><span class="sxs-lookup"><span data-stu-id="251f7-199">Next, we need to configure this column s properties.</span></span> <span data-ttu-id="251f7-200">按一下 [新增] 資料行，然後移至 [屬性視窗]。</span><span class="sxs-lookup"><span data-stu-id="251f7-200">Click on the new column and go to the Properties window.</span></span> <span data-ttu-id="251f7-201">將 [資料行 `DataType`] 屬性從 `System.String` 變更為 [`System.Int32`]，並將 `ReadOnly` 屬性設定為 [`True`]，如 [圖 6] 所示。</span><span class="sxs-lookup"><span data-stu-id="251f7-201">Change the column s `DataType` property from `System.String` to `System.Int32` and set the `ReadOnly` property to `True`, as shown in Figure 6.</span></span>

![設定新資料行的 DataType 和 ReadOnly 屬性](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image16.png)

<span data-ttu-id="251f7-203">**圖 6**：設定新資料行的 `DataType` 和 `ReadOnly` 屬性</span><span class="sxs-lookup"><span data-stu-id="251f7-203">**Figure 6**: Set the `DataType` and `ReadOnly` Properties of the New Column</span></span>

<span data-ttu-id="251f7-204">雖然 `CategoriesDataTable` 現在具有 `NumberOfProducts` 的資料行，但它的值不是由任何對應的 TableAdapter 查詢所設定。</span><span class="sxs-lookup"><span data-stu-id="251f7-204">While the `CategoriesDataTable` now has a `NumberOfProducts` column, its value is not set by any of the corresponding TableAdapter s queries.</span></span> <span data-ttu-id="251f7-205">如果我們想要在每次取得類別資訊時傳回這類資訊，我們可以更新 `GetCategories()` 方法以傳回這份資訊。</span><span class="sxs-lookup"><span data-stu-id="251f7-205">We can update the `GetCategories()` method to return this information if we want such information returned every time category information is retrieved.</span></span> <span data-ttu-id="251f7-206">不過，如果我們只需要抓取罕見實例（例如本教學課程）中類別的相關產品數目，我們可以保持 `GetCategories()`，並建立新的方法來傳回這項資訊。</span><span class="sxs-lookup"><span data-stu-id="251f7-206">If, however, we only need to grab the number of associated products for the categories in rare instances (such as just for this tutorial), then we can leave `GetCategories()` as-is and create a new method that returns this information.</span></span> <span data-ttu-id="251f7-207">讓我們使用這個第二種方法，建立名為 `GetCategoriesAndNumberOfProducts()`的新方法。</span><span class="sxs-lookup"><span data-stu-id="251f7-207">Let s use this latter approach, creating a new method named `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="251f7-208">若要加入這個新的 `GetCategoriesAndNumberOfProducts()` 方法，請在 `CategoriesTableAdapter` 上按一下滑鼠右鍵，然後選擇 [新增查詢]。</span><span class="sxs-lookup"><span data-stu-id="251f7-208">To add this new `GetCategoriesAndNumberOfProducts()` method, right-click on the `CategoriesTableAdapter` and choose New Query.</span></span> <span data-ttu-id="251f7-209">這會顯示 [TableAdapter 查詢設定] Wizard，我們在先前的教學課程中使用了許多次。</span><span class="sxs-lookup"><span data-stu-id="251f7-209">This brings up the TableAdapter Query Configuration Wizard, which we ve used numerous times in previous tutorials.</span></span> <span data-ttu-id="251f7-210">針對這個方法，您可以藉由指示查詢使用會傳回資料列的臨機操作 SQL 語句來啟動精靈。</span><span class="sxs-lookup"><span data-stu-id="251f7-210">For this method, start the wizard by indicating that the query uses an ad-hoc SQL statement that returns rows.</span></span>

<span data-ttu-id="251f7-211">[![使用特定 SQL 語句來建立方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-211">[![Create the Method Using an Ad-Hoc SQL Statement](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span></span>

<span data-ttu-id="251f7-212">**圖 7**：使用臨機操作 SQL 語句建立方法（[按一下以觀看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-212">**Figure 7**: Create the Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span></span>

<span data-ttu-id="251f7-213">[![SQL 語句傳回資料列](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-213">[![The SQL Statement Returns Rows](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span></span>

<span data-ttu-id="251f7-214">**圖 8**： SQL 語句會傳回資料列（[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-214">**Figure 8**: The SQL Statement Returns Rows ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span></span>

<span data-ttu-id="251f7-215">下一個 wizard 畫面會提示我們提供查詢來使用。</span><span class="sxs-lookup"><span data-stu-id="251f7-215">The next wizard screen prompts us for the query to use.</span></span> <span data-ttu-id="251f7-216">若要傳回每個分類 `CategoryID`、`CategoryName`和 `Description` 欄位，以及與類別目錄相關聯的產品數目，請使用下列 `SELECT` 語句：</span><span class="sxs-lookup"><span data-stu-id="251f7-216">To return each category s `CategoryID`, `CategoryName`, and `Description` fields, along with the number of products associated with the category, use the following `SELECT` statement:</span></span>

[!code-sql[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample7.sql)]

<span data-ttu-id="251f7-217">[![指定要使用的查詢](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-217">[![Specify the Query to Use](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span></span>

<span data-ttu-id="251f7-218">**圖 9**：指定要使用的查詢（[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-218">**Figure 9**: Specify the Query to Use ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span></span>

<span data-ttu-id="251f7-219">請注意，計算與類別目錄相關聯之產品數目的子查詢，其別名為 `NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="251f7-219">Note that the subquery that computes the number of products associated with the category is aliased as `NumberOfProducts`.</span></span> <span data-ttu-id="251f7-220">這個命名相符會使這個子查詢所傳回的值與 `CategoriesDataTable` s `NumberOfProducts` 資料行相關聯。</span><span class="sxs-lookup"><span data-stu-id="251f7-220">This naming match causes the value returned by this subquery to be associated with the `CategoriesDataTable` s `NumberOfProducts` column.</span></span>

<span data-ttu-id="251f7-221">輸入此查詢之後，最後一個步驟是選擇新方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="251f7-221">After entering this query, the last step is to choose the name for the new method.</span></span> <span data-ttu-id="251f7-222">使用 `FillWithNumberOfProducts` 和 `GetCategoriesAndNumberOfProducts` 來填入 DataTable，並分別傳回 DataTable 模式。</span><span class="sxs-lookup"><span data-stu-id="251f7-222">Use `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span>

<span data-ttu-id="251f7-223">[![命名新的 TableAdapter s 方法 FillWithNumberOfProducts 和 GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-223">[![Name the New TableAdapter s Methods FillWithNumberOfProducts and GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span></span>

<span data-ttu-id="251f7-224">**圖 10**：命名新的 TableAdapter s 方法 `FillWithNumberOfProducts` 和 `GetCategoriesAndNumberOfProducts` （[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-224">**Figure 10**: Name the New TableAdapter s Methods `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span></span>

<span data-ttu-id="251f7-225">此時，資料存取層已擴充為包含每個類別的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-225">At this point the Data Access Layer has been extended to include the number of products per category.</span></span> <span data-ttu-id="251f7-226">因為我們的所有展示層都會透過不同的商務邏輯層來將所有的呼叫路由傳送給 DAL，所以我們需要將對應的 `GetCategoriesAndNumberOfProducts` 方法新增至 `CategoriesBLL` 類別：</span><span class="sxs-lookup"><span data-stu-id="251f7-226">Since all our presentation layer routes all calls to the DAL through a separate Business Logic Layer we need to add a corresponding `GetCategoriesAndNumberOfProducts` method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="251f7-227">當 DAL 和 BLL 完成後，我們就可以開始將此資料系結至 `CategoriesAndProducts.aspx`中的 `Categories` 中繼器！</span><span class="sxs-lookup"><span data-stu-id="251f7-227">With the DAL and BLL complete, we re ready to bind this data to the `Categories` Repeater in `CategoriesAndProducts.aspx`!</span></span> <span data-ttu-id="251f7-228">如果您已經從判斷 `ItemDataBound` 事件處理常式中的產品數目一節建立了重複項的 ObjectDataSource，請刪除此 ObjectDataSource 並移除重複項 `DataSourceID` 屬性設定;也藉由移除 ASP.NET 程式碼後置類別中的 `Handles Categories.OnItemDataBound` 語法，從事件處理常式中 unwire 重複項的 `ItemDataBound` 事件。</span><span class="sxs-lookup"><span data-stu-id="251f7-228">If you ve already created an ObjectDataSource for the Repeater from the Determining the Number of Products in the `ItemDataBound` Event Handler section, delete this ObjectDataSource and remove the Repeater s `DataSourceID` property setting; also unwire the Repeater s `ItemDataBound` event from the event handler by removing the `Handles Categories.OnItemDataBound` syntax in the ASP.NET code-behind class.</span></span>

<span data-ttu-id="251f7-229">當重複項回到其原始狀態時，透過中繼器 s 智慧標籤新增名為 `CategoriesDataSource` 的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="251f7-229">With the Repeater back in its original state, add a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="251f7-230">將 ObjectDataSource 設定為使用 `CategoriesBLL` 類別，但不要讓它使用 `GetCategories()` 方法，請改為使用 `GetCategoriesAndNumberOfProducts()` （請參閱 [圖 11]）。</span><span class="sxs-lookup"><span data-stu-id="251f7-230">Configure the ObjectDataSource to use the `CategoriesBLL` class, but instead of having it use the `GetCategories()` method, have it use `GetCategoriesAndNumberOfProducts()` instead (see Figure 11).</span></span>

<span data-ttu-id="251f7-231">[![將 ObjectDataSource 設定為使用 GetCategoriesAndNumberOfProducts 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-231">[![Configure the ObjectDataSource to Use the GetCategoriesAndNumberOfProducts Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span></span>

<span data-ttu-id="251f7-232">**圖 11**：設定 ObjectDataSource 以使用 `GetCategoriesAndNumberOfProducts` 方法（[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-232">**Figure 11**: Configure the ObjectDataSource to Use the `GetCategoriesAndNumberOfProducts` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span></span>

<span data-ttu-id="251f7-233">接下來，更新 `ItemTemplate`，以便以宣告方式使用資料系結語法來指派 LinkButton s `Text` 屬性，同時包含 `CategoryName` 和 `NumberOfProducts` 資料欄位。</span><span class="sxs-lookup"><span data-stu-id="251f7-233">Next, update the `ItemTemplate` so that the LinkButton s `Text` property is declaratively assigned using databinding syntax and includes both the `CategoryName` and `NumberOfProducts` data fields.</span></span> <span data-ttu-id="251f7-234">中繼器和 `CategoriesDataSource` ObjectDataSource 的完整宣告式標記如下所示：</span><span class="sxs-lookup"><span data-stu-id="251f7-234">The complete declarative markup for the Repeater and the `CategoriesDataSource` ObjectDataSource follow:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample9.aspx)]

<span data-ttu-id="251f7-235">更新 DAL 以包含 `NumberOfProducts` 資料行時所呈現的輸出，與使用 `ItemDataBound` 事件處理常式方法相同（請參閱 [圖 4]，以查看可顯示類別名稱和產品數目的中繼器螢幕擷取畫面）。</span><span class="sxs-lookup"><span data-stu-id="251f7-235">The output rendered by updating the DAL to include a `NumberOfProducts` column is the same as using the `ItemDataBound` event handler approach (refer back to Figure 4 to see a screen shot of the Repeater showing the category names and number of products).</span></span>

## <a name="step-3-displaying-the-selected-category-s-products"></a><span data-ttu-id="251f7-236">步驟3：顯示選取的類別目錄 s 產品</span><span class="sxs-lookup"><span data-stu-id="251f7-236">Step 3: Displaying the Selected Category s Products</span></span>

<span data-ttu-id="251f7-237">此時，我們有 `Categories` 的重複項會顯示類別目錄清單，以及每個類別目錄中的產品數目。</span><span class="sxs-lookup"><span data-stu-id="251f7-237">At this point we have the `Categories` Repeater displaying the list of categories along with the number of products in each category.</span></span> <span data-ttu-id="251f7-238">中繼器會針對每個分類使用 LinkButton，當按下時，會導致回傳，此時我們需要在 `CategoryProducts` DataList 中針對選取的類別顯示這些產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-238">The Repeater uses a LinkButton for each category that, when clicked, causes a postback, at which point we need to display those products for the selected category in the `CategoryProducts` DataList.</span></span>

<span data-ttu-id="251f7-239">我們有一個挑戰，就是如何讓 DataList 只顯示所選類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-239">One challenge facing us is how to have the DataList display just those products for the selected category.</span></span> <span data-ttu-id="251f7-240">在[主要/詳細資料中使用可選取的主要 GridView 與詳細資料 DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教學課程中，我們瞭解到如何建立可以選取資料列的 GridView，並在相同頁面上的 DetailsView 中顯示選取的資料列詳細資料。</span><span class="sxs-lookup"><span data-stu-id="251f7-240">In the [Master/Detail Using a Selectable Master GridView with a Details DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial we saw how to build a GridView whose rows could be selected, with the selected row s details being displayed in a DetailsView on the same page.</span></span> <span data-ttu-id="251f7-241">GridView 的 ObjectDataSource 會使用 `ProductsBLL` s `GetProducts()` 方法傳回所有產品的相關資訊，而 DetailsView s 則會使用 `GetProductsByProductID(productID)` 方法來抓取所選產品的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="251f7-241">The GridView s ObjectDataSource returned information about all products using the `ProductsBLL` s `GetProducts()` method while the DetailsView s ObjectDataSource retrieved information about the selected product using the `GetProductsByProductID(productID)` method.</span></span> <span data-ttu-id="251f7-242">*`productID`* 參數值是以宣告方式提供，方法是將它與 GridView 的 `SelectedValue` 屬性的值產生關聯。</span><span class="sxs-lookup"><span data-stu-id="251f7-242">The *`productID`* parameter value was provided declaratively by associating it with the value of the GridView s `SelectedValue` property.</span></span> <span data-ttu-id="251f7-243">可惜的是，中繼器沒有 `SelectedValue` 的屬性，而且不能做為參數來源。</span><span class="sxs-lookup"><span data-stu-id="251f7-243">Unfortunately, the Repeater does not have a `SelectedValue` property and cannot serve as a parameter source.</span></span>

> [!NOTE]
> <span data-ttu-id="251f7-244">這是在中繼器中使用 LinkButton 時所出現的挑戰之一。</span><span class="sxs-lookup"><span data-stu-id="251f7-244">This is one of those challenges that appear when using the LinkButton in a Repeater.</span></span> <span data-ttu-id="251f7-245">我們已使用超連結透過 querystring 傳遞 `CategoryID`，我們可以使用該 QueryString 欄位做為參數 s 值的來源。</span><span class="sxs-lookup"><span data-stu-id="251f7-245">Had we used a hyperlink to pass in the `CategoryID` through the querystring instead, we could use that QueryString field as the source for the parameter s value.</span></span>

<span data-ttu-id="251f7-246">不過，在我們擔心會缺少中繼器的 `SelectedValue` 屬性之前，先讓我們先將 DataList 系結至 ObjectDataSource，並指定其 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="251f7-246">Before we worry about the lack of a `SelectedValue` property for the Repeater, though, let s first bind the DataList to an ObjectDataSource and specify its `ItemTemplate`.</span></span>

<span data-ttu-id="251f7-247">從 DataList 的智慧標籤中，加入宣告名為 `CategoryProductsDataSource` 的新 ObjectDataSource，並將其設定為使用 `ProductsBLL` 類別 s `GetProductsByCategoryID(categoryID)` 方法。</span><span class="sxs-lookup"><span data-stu-id="251f7-247">From the DataList s smart tag, opt to add a new ObjectDataSource named `CategoryProductsDataSource` and configure it to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="251f7-248">由於本教學課程中的 DataList 提供唯讀介面，因此您可以隨意將 [插入]、[更新] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="251f7-248">Since the DataList in this tutorial offers a read-only interface, feel free to set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="251f7-249">[![將 ObjectDataSource 設定為使用 ProductsBLL 類別 s GetProductsByCategoryID （類別 Id）方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-249">[![Configure the ObjectDataSource to Use ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span></span>

<span data-ttu-id="251f7-250">**圖 12**：設定 ObjectDataSource 使用 `ProductsBLL` 類別 `GetProductsByCategoryID(categoryID)` 方法（[按一下以觀看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-250">**Figure 12**: Configure the ObjectDataSource to Use `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span></span>

<span data-ttu-id="251f7-251">因為 `GetProductsByCategoryID(categoryID)` 方法需要輸入參數（ *`categoryID`* ），所以 [設定資料來源] wizard 可讓我們指定參數 s 來源。</span><span class="sxs-lookup"><span data-stu-id="251f7-251">Since the `GetProductsByCategoryID(categoryID)` method expects an input parameter (*`categoryID`*), the Configure Data Source wizard allows us to specify the parameter s source.</span></span> <span data-ttu-id="251f7-252">在 GridView 或 DataList 中列出分類之後，我們會將 [參數來源] 下拉式清單設定為 [控制]，並將 ControlID 至資料 Web 控制項的 [`ID`]。</span><span class="sxs-lookup"><span data-stu-id="251f7-252">Had the categories been listed in a GridView or a DataList, we d set the Parameter source drop-down list to Control and the ControlID to the `ID` of the data Web control.</span></span> <span data-ttu-id="251f7-253">不過，因為中繼器缺少 `SelectedValue` 的屬性，所以不能用來做為參數來源。</span><span class="sxs-lookup"><span data-stu-id="251f7-253">However, since the Repeater lacks a `SelectedValue` property it cannot be used as a parameter source.</span></span> <span data-ttu-id="251f7-254">如果您檢查，您會發現 [ControlID] 下拉式清單只包含一個控制項 `ID``CategoryProducts`，也就是 DataList 的 `ID`。</span><span class="sxs-lookup"><span data-stu-id="251f7-254">If you check, you'll find that the ControlID drop-down list only contains one control `ID``CategoryProducts`, the `ID` of the DataList.</span></span>

<span data-ttu-id="251f7-255">現在，請將 [參數來源] 下拉式清單設定為 [無]。</span><span class="sxs-lookup"><span data-stu-id="251f7-255">For now, set the Parameter source drop-down list to None.</span></span> <span data-ttu-id="251f7-256">當您在中繼器中按一下類別 LinkButton 時，最後會以程式設計方式指派此參數值。</span><span class="sxs-lookup"><span data-stu-id="251f7-256">We'll end up programmatically assigning this parameter value when a category LinkButton is clicked in the Repeater.</span></span>

<span data-ttu-id="251f7-257">[![未指定類別 Id 參數的參數來源](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-257">[![Do Not Specify a Parameter Source for the categoryID Parameter](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span></span>

<span data-ttu-id="251f7-258">**圖 13**：請勿指定 *`categoryID`* 參數的參數來源（[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-258">**Figure 13**: Do Not Specify a Parameter Source for the *`categoryID`* Parameter ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span></span>

<span data-ttu-id="251f7-259">完成 [設定資料來源] wizard 之後，Visual Studio 自動產生 DataList s `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="251f7-259">After completing the Configure Data Source wizard, Visual Studio auto-generates the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="251f7-260">以我們在上一個教學課程中使用的範本取代此預設 `ItemTemplate`;此外，將 DataList s `RepeatColumns` 屬性設為2。</span><span class="sxs-lookup"><span data-stu-id="251f7-260">Replace this default `ItemTemplate` with the template we used in the preceding tutorial; also, set the DataList s `RepeatColumns` property to 2.</span></span> <span data-ttu-id="251f7-261">進行這些變更之後，您的 DataList 及其相關聯的 ObjectDataSource 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="251f7-261">After making these changes the declarative markup for your DataList and its associated ObjectDataSource should look like the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample10.aspx)]

<span data-ttu-id="251f7-262">目前永遠不會設定 `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* 參數，因此在流覽頁面時不會顯示任何產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-262">Currently, the `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* parameter is never set, so no products are displayed when viewing the page.</span></span> <span data-ttu-id="251f7-263">我們需要做的是根據中繼器中所按下的類別的 `CategoryID`，設定此參數值。</span><span class="sxs-lookup"><span data-stu-id="251f7-263">What we need to do is have this parameter value set based on the `CategoryID` of the clicked category in the Repeater.</span></span> <span data-ttu-id="251f7-264">這會帶來兩項挑戰：首先，我們要如何判斷 LinkButton 在中繼器 s `ItemTemplate` 中的何時已按下;第二，如何判斷已按下 LinkButton 的對應分類的 `CategoryID`？</span><span class="sxs-lookup"><span data-stu-id="251f7-264">This introduces two challenges: first, how do we determine when a LinkButton in the Repeater s `ItemTemplate` has been clicked; and second, how can we determine the `CategoryID` of the corresponding category whose LinkButton was clicked?</span></span>

<span data-ttu-id="251f7-265">LinkButton （例如按鈕和 ImageButton 控制項）具有 `Click` 事件和[`Command` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx)。</span><span class="sxs-lookup"><span data-stu-id="251f7-265">The LinkButton like the Button and ImageButton controls has a `Click` event and a [`Command` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span></span> <span data-ttu-id="251f7-266">`Click` 事件的設計只是要注意，已按一下 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="251f7-266">The `Click` event is designed to simply note that the LinkButton has been clicked.</span></span> <span data-ttu-id="251f7-267">不過，有時候，除了注意到 LinkButton 已按下，我們也需要將一些額外的資訊傳遞給事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="251f7-267">At times, however, in addition to noting that the LinkButton has been clicked we also need to pass some extra information to the event handler.</span></span> <span data-ttu-id="251f7-268">如果是這種情況，就可以將此額外資訊指派給 LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx)和[`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx)屬性。</span><span class="sxs-lookup"><span data-stu-id="251f7-268">If this is the case, the LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) and [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) properties can be assigned this extra information.</span></span> <span data-ttu-id="251f7-269">然後，當按一下 LinkButton 時，就會引發它的 `Command` 事件（而不是它的 `Click` 事件），而事件處理常式會傳遞 `CommandName` 和 `CommandArgument` 屬性的值。</span><span class="sxs-lookup"><span data-stu-id="251f7-269">Then, when the LinkButton is clicked, its `Command` event fires (instead of its `Click` event) and the event handler is passed the values of the `CommandName` and `CommandArgument` properties.</span></span>

<span data-ttu-id="251f7-270">當從中繼器中的範本內引發 `Command` 事件時，會引發 Repeater 的[`ItemCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx)，並將所按下 LinkButton （或按鈕或 ImageButton）的 `CommandName` 和 `CommandArgument` 值傳遞給它。</span><span class="sxs-lookup"><span data-stu-id="251f7-270">When a `Command` event is raised from within a template in the Repeater, the Repeater s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) fires and is passed the `CommandName` and `CommandArgument` values of the clicked LinkButton (or Button or ImageButton).</span></span> <span data-ttu-id="251f7-271">因此，若要判斷是否已按下中繼器中的類別 LinkButton，我們需要執行下列動作：</span><span class="sxs-lookup"><span data-stu-id="251f7-271">Therefore, to determine when a category LinkButton in the Repeater has been clicked, we need to do the following:</span></span>

1. <span data-ttu-id="251f7-272">將中繼器 `ItemTemplate` 中 LinkButton 的 `CommandName` 屬性設定為某個值（我使用 ListProducts）。</span><span class="sxs-lookup"><span data-stu-id="251f7-272">Set the `CommandName` property of the LinkButton in the Repeater s `ItemTemplate` to some value (I ve used ListProducts ).</span></span> <span data-ttu-id="251f7-273">藉由設定這個 `CommandName` 值，當按一下 LinkButton 時，就會引發 LinkButton s `Command` 事件。</span><span class="sxs-lookup"><span data-stu-id="251f7-273">By setting this `CommandName` value, the LinkButton s `Command` event fires when the LinkButton is clicked.</span></span>
2. <span data-ttu-id="251f7-274">將 LinkButton 的 `CommandArgument` 屬性設定為目前專案的 `CategoryID`的值。</span><span class="sxs-lookup"><span data-stu-id="251f7-274">Set the LinkButton s `CommandArgument` property to the value of the current item s `CategoryID`.</span></span>
3. <span data-ttu-id="251f7-275">建立中繼器 `ItemCommand` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="251f7-275">Create an event handler for the Repeater s `ItemCommand` event.</span></span> <span data-ttu-id="251f7-276">在事件處理常式中，將 `CategoryProductsDataSource` ObjectDataSource s `CategoryID` 參數設定為傳入 `CommandArgument`的值。</span><span class="sxs-lookup"><span data-stu-id="251f7-276">In the event handler, set the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span>

<span data-ttu-id="251f7-277">類別中繼器的下列 `ItemTemplate` 標記會執行步驟1和2。</span><span class="sxs-lookup"><span data-stu-id="251f7-277">The following `ItemTemplate` markup for the Categories Repeater implements steps 1 and 2.</span></span> <span data-ttu-id="251f7-278">請注意，使用資料系結語法，`CommandArgument` 值如何指派 `CategoryID` 資料項目：</span><span class="sxs-lookup"><span data-stu-id="251f7-278">Note how the `CommandArgument` value is assigned the data item s `CategoryID` using databinding syntax:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample11.aspx)]

<span data-ttu-id="251f7-279">每當建立 `ItemCommand` 事件處理常式時，一定要先檢查傳入的 `CommandName` 值，因為中繼器中*任何*按鈕、LinkButton 或 ImageButton 所引發的*任何*`Command` 事件都會導致 `ItemCommand` 事件引發。</span><span class="sxs-lookup"><span data-stu-id="251f7-279">Whenever creating an `ItemCommand` event handler it is prudent to always first check the incoming `CommandName` value because *any* `Command` event raised by *any* Button, LinkButton, or ImageButton within the Repeater will cause the `ItemCommand` event to fire.</span></span> <span data-ttu-id="251f7-280">雖然我們目前只有一個這類 LinkButton，但在未來，我們（或小組中的其他開發人員）可能會將額外的按鈕 Web 控制項新增至重複項，當按下時，會引發相同的 `ItemCommand` 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="251f7-280">While we currently only have one such LinkButton now, in the future we (or another developer on our team) might add additional button Web controls to the Repeater that, when clicked, raises the same `ItemCommand` event handler.</span></span> <span data-ttu-id="251f7-281">因此，最好一律確保您檢查 `CommandName` 屬性，並只在符合預期值時才繼續程式設計邏輯。</span><span class="sxs-lookup"><span data-stu-id="251f7-281">Therefore, it s best to always make sure you check the `CommandName` property and only proceed with your programmatic logic if it matches up to the value expected.</span></span>

<span data-ttu-id="251f7-282">在確認傳入的 `CommandName` 值等於 ListProducts 之後，事件處理常式會將 `CategoryProductsDataSource` ObjectDataSource s `CategoryID` 參數指派給傳入的 `CommandArgument`值。</span><span class="sxs-lookup"><span data-stu-id="251f7-282">After ensuring that the passed-in `CommandName` value equals ListProducts, the event handler then assigns the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span> <span data-ttu-id="251f7-283">這種對 ObjectDataSource 的修改 `SelectParameters` 會自動導致 DataList 將自己重新系結至資料來源，並顯示新選取之類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-283">This modification to the ObjectDataSource s `SelectParameters` automatically causes the DataList to rebind itself to the data source, showing the products for the newly selected category.</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample12.cs)]

<span data-ttu-id="251f7-284">有了這些新增功能，我們的教學課程就完成了！</span><span class="sxs-lookup"><span data-stu-id="251f7-284">With these additions, our tutorial is complete!</span></span> <span data-ttu-id="251f7-285">花點時間在瀏覽器中進行測試。</span><span class="sxs-lookup"><span data-stu-id="251f7-285">Take a moment to test it out in a browser.</span></span> <span data-ttu-id="251f7-286">[圖 14] 顯示第一次造訪網頁時的畫面。</span><span class="sxs-lookup"><span data-stu-id="251f7-286">Figure 14 shows the screen when first visiting the page.</span></span> <span data-ttu-id="251f7-287">因為尚未選取類別，所以不會顯示任何產品。</span><span class="sxs-lookup"><span data-stu-id="251f7-287">Since a category has yet to be selected, no products are displayed.</span></span> <span data-ttu-id="251f7-288">按一下類別，例如 [產生]，會在兩個數據行的視圖中顯示產品類別目錄中的產品（請參閱 [圖 15]）。</span><span class="sxs-lookup"><span data-stu-id="251f7-288">Clicking on a category, such as Produce, displays those products in the Product category in a two-column view (see Figure 15).</span></span>

<span data-ttu-id="251f7-289">[第一次造訪網頁時，不會顯示 ![的產品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-289">[![No Products are Displayed When First Visiting the Page](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span></span>

<span data-ttu-id="251f7-290">**圖 14**：第一次流覽頁面時，不會顯示任何產品（[按一下以觀看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-290">**Figure 14**: No Products are Displayed When First Visiting the Page ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span></span>

<span data-ttu-id="251f7-291">[![按一下 [產生] 類別會列出右側相符的產品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="251f7-291">[![Clicking the Produce Category Lists the Matching Products to the Right](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span></span>

<span data-ttu-id="251f7-292">**圖 15**：按一下 [產生] 類別會列出右側相符的產品（[按一下以查看完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png)）</span><span class="sxs-lookup"><span data-stu-id="251f7-292">**Figure 15**: Clicking the Produce Category Lists the Matching Products to the Right ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span></span>

## <a name="summary"></a><span data-ttu-id="251f7-293">總結</span><span class="sxs-lookup"><span data-stu-id="251f7-293">Summary</span></span>

<span data-ttu-id="251f7-294">如我們在本教學課程中所見，以及前一個，主要/詳細資料包表可以散佈在兩個頁面上，或合併在一頁上。</span><span class="sxs-lookup"><span data-stu-id="251f7-294">As we saw in this tutorial and the preceding one, master/detail reports can be spread out across two pages, or consolidated on one.</span></span> <span data-ttu-id="251f7-295">不過，在單一頁面上顯示主版/詳細資料包表時，會對如何在頁面上配置主要和詳細資料記錄的方式帶來一些挑戰。</span><span class="sxs-lookup"><span data-stu-id="251f7-295">Displaying a master/details report on a single page, however, introduces some challenges on how best to layout the master and details records on the page.</span></span> <span data-ttu-id="251f7-296">在*主要/詳細資料中，使用可選取的主要 GridView 搭配詳細資料 DetailsView*教學課程，我們將詳細資料記錄顯示在主要記錄上方;在本教學課程中，我們使用了 CSS 技術，讓主要記錄在詳細資料的左邊浮動。</span><span class="sxs-lookup"><span data-stu-id="251f7-296">In the *Master/Detail Using a Selectable Master GridView with a Details DetailsView* tutorial we had the details records appear above the master records; in this tutorial we used CSS techniques to have the master records float to the left of the details.</span></span>

<span data-ttu-id="251f7-297">除了顯示主版/詳細資料包告，我們也有機會探索如何抓取與每個類別相關聯的產品數目，以及在從中繼器內按一下 LinkButton （或按鈕或 ImageButton）時，如何執行伺服器端邏輯。</span><span class="sxs-lookup"><span data-stu-id="251f7-297">Along with displaying master/details reports, we also had the opportunity to explore how to retrieve the number of products associated with each category as well as how to perform server-side logic when a LinkButton (or Button or ImageButton) is clicked from within a Repeater.</span></span>

<span data-ttu-id="251f7-298">本教學課程使用 DataList 和中繼器完成主要/詳細資料包告的檢查。</span><span class="sxs-lookup"><span data-stu-id="251f7-298">This tutorial completes our examination of master/detail reports with the DataList and Repeater.</span></span> <span data-ttu-id="251f7-299">我們的下一組教學課程將說明如何將編輯和刪除功能加入至 DataList 控制項。</span><span class="sxs-lookup"><span data-stu-id="251f7-299">Our next set of tutorials will illustrate how to add editing and deleting capabilities to the DataList control.</span></span>

<span data-ttu-id="251f7-300">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="251f7-300">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="251f7-301">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="251f7-301">Further Reading</span></span>

<span data-ttu-id="251f7-302">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="251f7-302">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="251f7-303">使用 CSS [Floatutorial](http://css.maxdesign.com.au/floatutorial/)浮動 css 元素的教學課程</span><span class="sxs-lookup"><span data-stu-id="251f7-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/) a tutorial on floating CSS elements with CSS</span></span>
- <span data-ttu-id="251f7-304">[Css](http://www.brainjar.com/css/positioning/)使用 css 定位元素的詳細資訊</span><span class="sxs-lookup"><span data-stu-id="251f7-304">[CSS Positioning](http://www.brainjar.com/css/positioning/) more information on positioning elements with CSS</span></span>
- <span data-ttu-id="251f7-305">使用 `<table>` s 和其他 HTML 專案進行定位，[以 HTML 配置內容](http://www.w3schools.com/html/html_layout.asp)</span><span class="sxs-lookup"><span data-stu-id="251f7-305">[Laying Out Content with HTML](http://www.w3schools.com/html/html_layout.asp) using `<table>` s and other HTML elements for positioning</span></span>

## <a name="about-the-author"></a><span data-ttu-id="251f7-306">關於作者</span><span class="sxs-lookup"><span data-stu-id="251f7-306">About the Author</span></span>

<span data-ttu-id="251f7-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="251f7-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="251f7-308">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="251f7-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="251f7-309">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="251f7-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="251f7-310">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="251f7-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="251f7-311">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="251f7-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="251f7-312">特別感謝</span><span class="sxs-lookup"><span data-stu-id="251f7-312">Special Thanks To</span></span>

<span data-ttu-id="251f7-313">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="251f7-313">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="251f7-314">本教學課程的領導審查員是 Zack 的。</span><span class="sxs-lookup"><span data-stu-id="251f7-314">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="251f7-315">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="251f7-315">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="251f7-316">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="251f7-316">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="251f7-317">[上一頁](master-detail-filtering-acess-two-pages-datalist-cs.md)
> [下一頁](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span><span class="sxs-lookup"><span data-stu-id="251f7-317">[Previous](master-detail-filtering-acess-two-pages-datalist-cs.md)
[Next](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span></span>
