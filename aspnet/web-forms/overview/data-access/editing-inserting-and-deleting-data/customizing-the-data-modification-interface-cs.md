---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs
title: 自訂資料修改介面（C#） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將探討如何將標準 TextBox 和 CheckBox 控制項取代為 alternati，以自訂可編輯的 GridView 介面。
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 22e99600-8d18-4a94-a20e-a3a62bb63798
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs
msc.type: authoredcontent
ms.openlocfilehash: af68d1a0b744a2c1fd9d21a8bf6165bafa4de683
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74623864"
---
# <a name="customizing-the-data-modification-interface-c"></a><span data-ttu-id="e989a-103">自訂資料修改介面 (C#)</span><span class="sxs-lookup"><span data-stu-id="e989a-103">Customizing the Data Modification Interface (C#)</span></span>

<span data-ttu-id="e989a-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e989a-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e989a-105">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_20_CS.exe)或[下載 PDF](customizing-the-data-modification-interface-cs/_static/datatutorial20cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e989a-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_20_CS.exe) or [Download PDF](customizing-the-data-modification-interface-cs/_static/datatutorial20cs1.pdf)</span></span>

> <span data-ttu-id="e989a-106">在本教學課程中，我們將探討如何將標準 TextBox 和 CheckBox 控制項取代為替代輸入 Web 控制項，以自訂可編輯 GridView 的介面。</span><span class="sxs-lookup"><span data-stu-id="e989a-106">In this tutorial we'll look at how to customize the interface of an editable GridView, by replacing the standard TextBox and CheckBox controls with alternative input Web controls.</span></span>

## <a name="introduction"></a><span data-ttu-id="e989a-107">簡介</span><span class="sxs-lookup"><span data-stu-id="e989a-107">Introduction</span></span>

<span data-ttu-id="e989a-108">GridView 和 DetailsView 控制項所使用的 BoundFields 和 CheckBoxFields，可簡化修改資料的程式，因為它們能夠轉譯唯讀、可編輯和可插入的介面。</span><span class="sxs-lookup"><span data-stu-id="e989a-108">The BoundFields and CheckBoxFields used by the GridView and DetailsView controls simplify the process of modifying data due to their ability to render read-only, editable, and insertable interfaces.</span></span> <span data-ttu-id="e989a-109">這些介面可以轉譯，而不需要加入任何額外的宣告式標記或程式碼。</span><span class="sxs-lookup"><span data-stu-id="e989a-109">These interfaces can be rendered without the need for adding any additional declarative markup or code.</span></span> <span data-ttu-id="e989a-110">不過，BoundField 和 CheckBoxField 的介面缺乏實際案例所需的自訂能力。</span><span class="sxs-lookup"><span data-stu-id="e989a-110">However, the BoundField and CheckBoxField's interfaces lack the customizability often needed in real-world scenarios.</span></span> <span data-ttu-id="e989a-111">為了在 GridView 或 DetailsView 中自訂可編輯或可插入的介面，我們必須改為使用 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="e989a-111">In order to customize the editable or insertable interface in a GridView or DetailsView we need to instead use a TemplateField.</span></span>

<span data-ttu-id="e989a-112">在[先前的教學](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)課程中，我們已瞭解如何藉由新增驗證 Web 控制項來自訂資料修改介面。</span><span class="sxs-lookup"><span data-stu-id="e989a-112">In the [preceding tutorial](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md) we saw how to customize the data modification interfaces by adding validation Web controls.</span></span> <span data-ttu-id="e989a-113">在本教學課程中，我們將探討如何自訂實際的資料收集 Web 控制項，以替代輸入 Web 控制項取代 BoundField 和 CheckBoxField 的標準 TextBox 和 CheckBox 控制項。</span><span class="sxs-lookup"><span data-stu-id="e989a-113">In this tutorial we'll look at how to customize the actual data collection Web controls, replacing the BoundField and CheckBoxField's standard TextBox and CheckBox controls with alternative input Web controls.</span></span> <span data-ttu-id="e989a-114">特別是，我們將建立可編輯的 GridView，讓產品的名稱、類別、供應商和已停止狀態得以更新。</span><span class="sxs-lookup"><span data-stu-id="e989a-114">In particular, we'll build an editable GridView that allows a product's name, category, supplier, and discontinued status to be updated.</span></span> <span data-ttu-id="e989a-115">編輯特定資料列時，[類別目錄] 和 [供應商] 欄位將會轉譯為 Dropdownlist 進行，其中包含可供選擇的一組可用類別和供應商。</span><span class="sxs-lookup"><span data-stu-id="e989a-115">When editing a particular row, the category and supplier fields will render as DropDownLists, containing the set of available categories and suppliers to choose from.</span></span> <span data-ttu-id="e989a-116">此外，我們會將 CheckBoxField 的預設核取方塊取代為提供兩個選項的 RadioButtonList 控制項：「作用中」和「已停止」。</span><span class="sxs-lookup"><span data-stu-id="e989a-116">Furthermore, we'll replace the CheckBoxField's default CheckBox with a RadioButtonList control that offers two options: "Active" and "Discontinued".</span></span>

<span data-ttu-id="e989a-117">[![GridView 的編輯介面包含 Dropdownlist 進行和選項按鈕](customizing-the-data-modification-interface-cs/_static/image2.png)](customizing-the-data-modification-interface-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-117">[![The GridView's Editing Interface Includes DropDownLists and RadioButtons](customizing-the-data-modification-interface-cs/_static/image2.png)](customizing-the-data-modification-interface-cs/_static/image1.png)</span></span>

<span data-ttu-id="e989a-118">**圖 1**： GridView 的編輯介面包含 Dropdownlist 進行和選項按鈕（[按一下以觀看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-118">**Figure 1**: The GridView's Editing Interface Includes DropDownLists and RadioButtons ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image3.png))</span></span>

## <a name="step-1-creating-the-appropriateupdateproductoverload"></a><span data-ttu-id="e989a-119">步驟1：建立適當的`UpdateProduct`多載</span><span class="sxs-lookup"><span data-stu-id="e989a-119">Step 1: Creating the Appropriate`UpdateProduct`Overload</span></span>

<span data-ttu-id="e989a-120">在本教學課程中，我們將建立可編輯的 GridView，允許編輯產品的名稱、類別、供應商和已停止的狀態。</span><span class="sxs-lookup"><span data-stu-id="e989a-120">In this tutorial we will build an editable GridView that permits editing of a product's name, category, supplier, and discontinued status.</span></span> <span data-ttu-id="e989a-121">因此，我們需要可接受五個輸入參數的 `UpdateProduct` 多載，這四個產品值加上 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="e989a-121">Therefore, we need an `UpdateProduct` overload that accepts five input parameters these four product values plus the `ProductID`.</span></span> <span data-ttu-id="e989a-122">如同在先前的多載中，這一項將會：</span><span class="sxs-lookup"><span data-stu-id="e989a-122">Like in our previous overloads, this one will:</span></span>

1. <span data-ttu-id="e989a-123">針對指定的 `ProductID`，從資料庫中取出產品資訊。</span><span class="sxs-lookup"><span data-stu-id="e989a-123">Retrieve the product information from the database for the specified `ProductID`,</span></span>
2. <span data-ttu-id="e989a-124">更新 [`ProductName`]、[`CategoryID`]、[`SupplierID`] 和 [`Discontinued`] 欄位，以及</span><span class="sxs-lookup"><span data-stu-id="e989a-124">Update the `ProductName`, `CategoryID`, `SupplierID`, and `Discontinued` fields, and</span></span>
3. <span data-ttu-id="e989a-125">透過 TableAdapter 的 `Update()` 方法，將更新要求傳送至 DAL。</span><span class="sxs-lookup"><span data-stu-id="e989a-125">Send the update request to the DAL through the TableAdapter's `Update()` method.</span></span>

<span data-ttu-id="e989a-126">為了簡潔起見，針對這個特定的多載，我省略了商務規則檢查，可確保標示為已中止的產品不是其供應商所提供的唯一產品。</span><span class="sxs-lookup"><span data-stu-id="e989a-126">For brevity, for this particular overload I've omitted the business rule check that ensures a product being marked as discontinued isn't the only product offered by its supplier.</span></span> <span data-ttu-id="e989a-127">您可以視需要將它新增到中，或者最好是將邏輯重構成另一個方法。</span><span class="sxs-lookup"><span data-stu-id="e989a-127">Feel free to add it in if you prefer, or, ideally, refactor out the logic to a separate method.</span></span>

<span data-ttu-id="e989a-128">下列程式碼顯示 `ProductsBLL` 類別中的新 `UpdateProduct` 多載：</span><span class="sxs-lookup"><span data-stu-id="e989a-128">The following code shows the new `UpdateProduct` overload in the `ProductsBLL` class:</span></span>

[!code-csharp[Main](customizing-the-data-modification-interface-cs/samples/sample1.cs)]

## <a name="step-2-crafting-the-editable-gridview"></a><span data-ttu-id="e989a-129">步驟2：製作可編輯的 GridView</span><span class="sxs-lookup"><span data-stu-id="e989a-129">Step 2: Crafting the Editable GridView</span></span>

<span data-ttu-id="e989a-130">新增 `UpdateProduct` 多載之後，我們就可以建立可編輯的 GridView。</span><span class="sxs-lookup"><span data-stu-id="e989a-130">With the `UpdateProduct` overload added, we're ready to create our editable GridView.</span></span> <span data-ttu-id="e989a-131">開啟 [`EditInsertDelete`] 資料夾中的 [`CustomizedUI.aspx`] 頁面，並將 GridView 控制項新增至設計工具。</span><span class="sxs-lookup"><span data-stu-id="e989a-131">Open the `CustomizedUI.aspx` page in the `EditInsertDelete` folder and add a GridView control to the Designer.</span></span> <span data-ttu-id="e989a-132">接下來，從 GridView 的智慧標籤建立新的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="e989a-132">Next, create a new ObjectDataSource from the GridView's smart tag.</span></span> <span data-ttu-id="e989a-133">設定 ObjectDataSource 以透過 `ProductBLL` 類別的 `GetProducts()` 方法來抓取產品資訊，並使用我們剛才建立的 `UpdateProduct` 多載來更新產品資料。</span><span class="sxs-lookup"><span data-stu-id="e989a-133">Configure the ObjectDataSource to retrieve product information via the `ProductBLL` class's `GetProducts()` method and to update product data using the `UpdateProduct` overload we just created.</span></span> <span data-ttu-id="e989a-134">從 [插入] 和 [刪除] 索引標籤中，從下拉式清單中選取 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="e989a-134">From the INSERT and DELETE tabs, select (None) from the drop-down lists.</span></span>

<span data-ttu-id="e989a-135">[![將 ObjectDataSource 設定為使用剛建立的 UpdateProduct 多載](customizing-the-data-modification-interface-cs/_static/image5.png)](customizing-the-data-modification-interface-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-135">[![Configure the ObjectDataSource to Use the UpdateProduct Overload Just Created](customizing-the-data-modification-interface-cs/_static/image5.png)](customizing-the-data-modification-interface-cs/_static/image4.png)</span></span>

<span data-ttu-id="e989a-136">**圖 2**：設定 ObjectDataSource 使用剛建立的 `UpdateProduct` 多載（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-136">**Figure 2**: Configure the ObjectDataSource to Use the `UpdateProduct` Overload Just Created ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image6.png))</span></span>

<span data-ttu-id="e989a-137">如我們在資料修改教學課程中所見，Visual Studio 所建立之 ObjectDataSource 的宣告式語法會將 `OldValuesParameterFormatString` 屬性指派給 `original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="e989a-137">As we've seen throughout the data modification tutorials, the declarative syntax for the ObjectDataSource created by Visual Studio assigns the `OldValuesParameterFormatString` property to `original_{0}`.</span></span> <span data-ttu-id="e989a-138">這當然不會與我們的商務邏輯層搭配運作，因為我們的方法不會預期傳入原始 `ProductID` 值。</span><span class="sxs-lookup"><span data-stu-id="e989a-138">This, of course, won't work with our Business Logic Layer since our methods don't expect the original `ProductID` value to be passed in.</span></span> <span data-ttu-id="e989a-139">因此，如同我們在先前的教學課程中所做的，請花一點時間從宣告式語法移除此屬性指派，或改為將這個屬性的值設定為 `{0}`。</span><span class="sxs-lookup"><span data-stu-id="e989a-139">Therefore, as we've done in previous tutorials, take a moment to remove this property assignment from the declarative syntax or, instead, set this property's value to `{0}`.</span></span>

<span data-ttu-id="e989a-140">在這項變更之後，ObjectDataSource 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="e989a-140">After this change, the ObjectDataSource's declarative markup should look like the following:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-cs/samples/sample2.aspx)]

<span data-ttu-id="e989a-141">請注意，`OldValuesParameterFormatString` 屬性已經移除，而且 `UpdateParameters` 集合中的 `UpdateProduct` 多載所預期的每個輸入參數都有 `Parameter`。</span><span class="sxs-lookup"><span data-stu-id="e989a-141">Note that the `OldValuesParameterFormatString` property has been removed and that there is a `Parameter` in the `UpdateParameters` collection for each of the input parameters expected by our `UpdateProduct` overload.</span></span>

<span data-ttu-id="e989a-142">當 ObjectDataSource 設定為只更新產品值的子集時，GridView 目前會顯示*所有*的產品欄位。</span><span class="sxs-lookup"><span data-stu-id="e989a-142">While the ObjectDataSource is configured to update only a subset of product values, the GridView currently shows *all* of the product fields.</span></span> <span data-ttu-id="e989a-143">請花點時間編輯 GridView，讓：</span><span class="sxs-lookup"><span data-stu-id="e989a-143">Take a moment to edit the GridView so that:</span></span>

- <span data-ttu-id="e989a-144">它只包含 `ProductName`、`SupplierName`、`CategoryName` BoundFields 和 `Discontinued` CheckBoxField</span><span class="sxs-lookup"><span data-stu-id="e989a-144">It only includes the `ProductName`, `SupplierName`, `CategoryName` BoundFields and the `Discontinued` CheckBoxField</span></span>
- <span data-ttu-id="e989a-145">要出現在 `Discontinued` CheckBoxField 之前的 `CategoryName` 和 `SupplierName` 欄位（位於左邊）</span><span class="sxs-lookup"><span data-stu-id="e989a-145">The `CategoryName` and `SupplierName` fields to appear before (to the left of) the `Discontinued` CheckBoxField</span></span>
- <span data-ttu-id="e989a-146">`CategoryName` 和 `SupplierName` BoundFields ' `HeaderText` 屬性分別設定為 "Category" 和 "供應商"</span><span class="sxs-lookup"><span data-stu-id="e989a-146">The `CategoryName` and `SupplierName` BoundFields' `HeaderText` property is set to "Category" and "Supplier", respectively</span></span>
- <span data-ttu-id="e989a-147">已啟用編輯支援（勾選 GridView 的智慧標籤中的 [啟用編輯] 核取方塊）</span><span class="sxs-lookup"><span data-stu-id="e989a-147">Editing support is enabled (check the Enable Editing checkbox in the GridView's smart tag)</span></span>

<span data-ttu-id="e989a-148">在這些變更之後，設計工具看起來會像 [圖 3]，其中包含 GridView 的宣告式語法，如下所示。</span><span class="sxs-lookup"><span data-stu-id="e989a-148">After these changes, the Designer will look similar to Figure 3, with the GridView's declarative syntax shown below.</span></span>

<span data-ttu-id="e989a-149">[![從 GridView 移除不必要的欄位](customizing-the-data-modification-interface-cs/_static/image8.png)](customizing-the-data-modification-interface-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-149">[![Remove the Unneeded Fields from the GridView](customizing-the-data-modification-interface-cs/_static/image8.png)](customizing-the-data-modification-interface-cs/_static/image7.png)</span></span>

<span data-ttu-id="e989a-150">**圖 3**：從 GridView 移除不必要的欄位（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-150">**Figure 3**: Remove the Unneeded Fields from the GridView ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image9.png))</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-cs/samples/sample3.aspx)]

<span data-ttu-id="e989a-151">此時，GridView 的唯讀行為已完成。</span><span class="sxs-lookup"><span data-stu-id="e989a-151">At this point the GridView's read-only behavior is complete.</span></span> <span data-ttu-id="e989a-152">當您查看資料時，每個產品都會轉譯為 GridView 中的一個資料列，以顯示產品的名稱、類別、供應商和已停止的狀態。</span><span class="sxs-lookup"><span data-stu-id="e989a-152">When viewing the data, each product is rendered as a row in the GridView, showing the product's name, category, supplier, and discontinued status.</span></span>

<span data-ttu-id="e989a-153">[![GridView 的唯讀介面已完成](customizing-the-data-modification-interface-cs/_static/image11.png)](customizing-the-data-modification-interface-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-153">[![The GridView's Read-Only Interface is Complete](customizing-the-data-modification-interface-cs/_static/image11.png)](customizing-the-data-modification-interface-cs/_static/image10.png)</span></span>

<span data-ttu-id="e989a-154">**圖 4**： GridView 的唯讀介面已完成（[按一下以觀看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-154">**Figure 4**: The GridView's Read-Only Interface is Complete ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image12.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e989a-155">如如何[插入、更新和刪除資料教學](an-overview-of-inserting-updating-and-deleting-data-cs.md)課程中所述，請務必啟用 GridView s 檢視狀態（預設行為）。</span><span class="sxs-lookup"><span data-stu-id="e989a-155">As discussed in [An Overview of Inserting, Updating, and Deleting Data tutorial](an-overview-of-inserting-updating-and-deleting-data-cs.md), it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="e989a-156">如果您將 GridView 的 `EnableViewState` 屬性設定為 `false`，就會面臨並行使用者不小心刪除或編輯記錄的風險。</span><span class="sxs-lookup"><span data-stu-id="e989a-156">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="e989a-157">如需詳細資訊，請參閱[警告： ASP.NET 2.0 gridview/DetailsView/FormViews 的並行問題，其支援編輯及/或刪除，且已停用檢視狀態](http://scottonwriting.net/sowblog/posts/10054.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e989a-157">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>

## <a name="step-3-using-a-dropdownlist-for-the-category-and-supplier-editing-interfaces"></a><span data-ttu-id="e989a-158">步驟3：針對類別目錄和供應商編輯介面使用 DropDownList</span><span class="sxs-lookup"><span data-stu-id="e989a-158">Step 3: Using a DropDownList for the Category and Supplier Editing Interfaces</span></span>

<span data-ttu-id="e989a-159">回想一下，`ProductsRow` 物件包含 `CategoryID`、`CategoryName`、`SupplierID`和 `SupplierName` 屬性，這會在 `Products` 資料庫資料表中提供實際的外鍵識別碼值，以及 `Name` 和 `Categories` 資料表中對應的 `Suppliers` 值。</span><span class="sxs-lookup"><span data-stu-id="e989a-159">Recall that the `ProductsRow` object contains `CategoryID`, `CategoryName`, `SupplierID`, and `SupplierName` properties, which provide the actual foreign-key ID values in the `Products` database table and the corresponding `Name` values in the `Categories` and `Suppliers` tables.</span></span> <span data-ttu-id="e989a-160">`ProductRow`的 `CategoryID` 和 `SupplierID` 都可以讀取和寫入，而 `CategoryName` 和 `SupplierName` 屬性會標示為唯讀。</span><span class="sxs-lookup"><span data-stu-id="e989a-160">The `ProductRow`'s `CategoryID` and `SupplierID` can both be read from and written to, while the `CategoryName` and `SupplierName` properties are marked read-only.</span></span>

<span data-ttu-id="e989a-161">由於 `CategoryName` 和 `SupplierName` 屬性的唯讀狀態，對應的 BoundFields 已將其 `ReadOnly` 屬性設定為 `true`，防止在編輯資料列時修改這些值。</span><span class="sxs-lookup"><span data-stu-id="e989a-161">Due to the read-only status of the `CategoryName` and `SupplierName` properties, the corresponding BoundFields have had their `ReadOnly` property set to `true`, preventing these values from being modified when a row is edited.</span></span> <span data-ttu-id="e989a-162">雖然我們可以將 [`ReadOnly`] 屬性設定為 [`false`]，在編輯期間將 `CategoryName` 和 `SupplierName` BoundFields 轉譯為文字方塊，這種方法會在使用者嘗試更新產品時造成例外狀況，因為 `UpdateProduct` 和 `CategoryName` 輸入中沒有 `SupplierName` 多載。</span><span class="sxs-lookup"><span data-stu-id="e989a-162">While we can set the `ReadOnly` property to `false`, rendering the `CategoryName` and `SupplierName` BoundFields as TextBoxes during editing, such an approach will result in an exception when the user attempts to update the product since there is no `UpdateProduct` overload that takes in `CategoryName` and `SupplierName` inputs.</span></span> <span data-ttu-id="e989a-163">事實上，基於兩個原因，我們不想建立這種多載：</span><span class="sxs-lookup"><span data-stu-id="e989a-163">In fact, we don't want to create such an overload for two reasons:</span></span>

- <span data-ttu-id="e989a-164">`Products` 資料表沒有 `SupplierName` 或 `CategoryName` 欄位，但是 `SupplierID` 和 `CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="e989a-164">The `Products` table doesn't have `SupplierName` or `CategoryName` fields, but `SupplierID` and `CategoryID`.</span></span> <span data-ttu-id="e989a-165">因此，我們想要將這些特定的識別碼值（而非其查閱資料表的值）傳遞給我們的方法。</span><span class="sxs-lookup"><span data-stu-id="e989a-165">Therefore, we want our method to be passed these particular ID values, not their lookup tables' values.</span></span>
- <span data-ttu-id="e989a-166">要求使用者輸入供應商或類別目錄的名稱不是理想的，因為它需要使用者知道可用的類別和供應商及其正確的拼寫。</span><span class="sxs-lookup"><span data-stu-id="e989a-166">Requiring the user to type in the name of the supplier or category is less than ideal, as it requires the user to know the available categories and suppliers and their correct spellings.</span></span>

<span data-ttu-id="e989a-167">[供應商] 和 [類別目錄] 欄位應該會在 [唯讀] 模式（如同現在一樣）中顯示類別目錄和供應商名稱，並在編輯時顯示適用選項的下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="e989a-167">The supplier and category fields should display the category and suppliers' names when in read-only mode (as it does now) and a drop-down list of applicable options when being edited.</span></span> <span data-ttu-id="e989a-168">使用者可以使用下拉式清單快速查看哪些分類和供應商可供選擇，而且可以更輕鬆地進行選取。</span><span class="sxs-lookup"><span data-stu-id="e989a-168">Using a drop-down list, the end user can quickly see what categories and suppliers are available to choose among and can more easily make their selection.</span></span>

<span data-ttu-id="e989a-169">為了提供此行為，我們必須將 `SupplierName` 和 `CategoryName` BoundFields 轉換成 TemplateFields，其 `ItemTemplate` 會發出 `SupplierName` 和 `CategoryName` 值，而其 `EditItemTemplate` 會使用 DropDownList 控制項列出可用的分類和供應商。</span><span class="sxs-lookup"><span data-stu-id="e989a-169">To provide this behavior, we need to convert the `SupplierName` and `CategoryName` BoundFields into TemplateFields whose `ItemTemplate` emits the `SupplierName` and `CategoryName` values and whose `EditItemTemplate` uses a DropDownList control to list the available categories and suppliers.</span></span>

## <a name="adding-thecategoriesandsuppliersdropdownlists"></a><span data-ttu-id="e989a-170">新增`Categories`和`Suppliers`Dropdownlist 進行</span><span class="sxs-lookup"><span data-stu-id="e989a-170">Adding the`Categories`and`Suppliers`DropDownLists</span></span>

<span data-ttu-id="e989a-171">首先，將 `SupplierName` 和 `CategoryName` BoundFields 轉換成 TemplateFields by：按一下 GridView 智慧標籤中的 [編輯資料行] 連結;從左下方的清單中選取 BoundField;然後按一下 [將此欄位轉換成 TemplateField] 連結。</span><span class="sxs-lookup"><span data-stu-id="e989a-171">Start by converting the `SupplierName` and `CategoryName` BoundFields into TemplateFields by: clicking on the Edit Columns link from the GridView's smart tag; selecting the BoundField from the list in the lower left; and clicking the "Convert this field into a TemplateField" link.</span></span> <span data-ttu-id="e989a-172">轉換程式會建立具有 `ItemTemplate` 和 `EditItemTemplate`的 TemplateField，如以下的宣告式語法所示：</span><span class="sxs-lookup"><span data-stu-id="e989a-172">The conversion process will create a TemplateField with both an `ItemTemplate` and an `EditItemTemplate`, as shown in the declarative syntax below:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-cs/samples/sample4.aspx)]

<span data-ttu-id="e989a-173">由於 BoundField 已標示為唯讀，`ItemTemplate` 和 `EditItemTemplate` 都包含一個標籤 Web 控制項，其 `Text` 屬性會系結至適用的資料欄位（在上述語法中為`CategoryName`）。</span><span class="sxs-lookup"><span data-stu-id="e989a-173">Since the BoundField was marked as read-only, both the `ItemTemplate` and `EditItemTemplate` contain a Label Web control whose `Text` property is bound to the applicable data field (`CategoryName`, in the syntax above).</span></span> <span data-ttu-id="e989a-174">我們需要修改 `EditItemTemplate`，以 DropDownList 控制項取代標籤 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="e989a-174">We need to modify the `EditItemTemplate`, replacing the Label Web control with a DropDownList control.</span></span>

<span data-ttu-id="e989a-175">如我們在先前的教學課程中所見，您可以透過設計工具或直接從宣告式語法來編輯範本。</span><span class="sxs-lookup"><span data-stu-id="e989a-175">As we've seen in previous tutorials, the template can be edited through the Designer or directly from the declarative syntax.</span></span> <span data-ttu-id="e989a-176">若要透過設計工具進行編輯，請按一下 GridView 智慧標籤中的 [編輯範本] 連結，然後選擇使用 [類別目錄] 欄位的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="e989a-176">To edit it through the Designer, click on the Edit Templates link from the GridView's smart tag and choose to work with the Category field's `EditItemTemplate`.</span></span> <span data-ttu-id="e989a-177">移除標籤 Web 控制項，並以 DropDownList 控制項取代它，並將 DropDownList 的 ID 屬性設定為 `Categories`。</span><span class="sxs-lookup"><span data-stu-id="e989a-177">Remove the Label Web control and replace it with a DropDownList control, setting the DropDownList's ID property to `Categories`.</span></span>

<span data-ttu-id="e989a-178">[![移除文字方塊，並將 DropDownList 新增至 EditItemTemplate](customizing-the-data-modification-interface-cs/_static/image14.png)](customizing-the-data-modification-interface-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-178">[![Remove the TexBox and Add a DropDownList to the EditItemTemplate](customizing-the-data-modification-interface-cs/_static/image14.png)](customizing-the-data-modification-interface-cs/_static/image13.png)</span></span>

<span data-ttu-id="e989a-179">**圖 5**：移除文字方塊，並將 DropDownList 新增至 `EditItemTemplate` （[按一下以觀看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-179">**Figure 5**: Remove the TexBox and Add a DropDownList to the `EditItemTemplate` ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image15.png))</span></span>

<span data-ttu-id="e989a-180">接下來，我們需要在 DropDownList 中填入可用的類別。</span><span class="sxs-lookup"><span data-stu-id="e989a-180">We next need to populate the DropDownList with the available categories.</span></span> <span data-ttu-id="e989a-181">按一下 DropDownList 的智慧標籤中的 [選擇資料來源] 連結，並選擇建立名為 `CategoriesDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="e989a-181">Click on the Choose Data Source link from the DropDownList's smart tag and opt to create a new ObjectDataSource named `CategoriesDataSource`.</span></span>

<span data-ttu-id="e989a-182">[![建立名為 CategoriesDataSource 的新 ObjectDataSource 控制項](customizing-the-data-modification-interface-cs/_static/image17.png)](customizing-the-data-modification-interface-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-182">[![Create a New ObjectDataSource Control Named CategoriesDataSource](customizing-the-data-modification-interface-cs/_static/image17.png)](customizing-the-data-modification-interface-cs/_static/image16.png)</span></span>

<span data-ttu-id="e989a-183">**圖 6**：建立名為 `CategoriesDataSource` 的新 ObjectDataSource 控制項（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-183">**Figure 6**: Create a New ObjectDataSource Control Named `CategoriesDataSource` ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image18.png))</span></span>

<span data-ttu-id="e989a-184">若要讓這個 ObjectDataSource 傳回所有類別，請將它系結至 `CategoriesBLL` 類別的 `GetCategories()` 方法。</span><span class="sxs-lookup"><span data-stu-id="e989a-184">To have this ObjectDataSource return all of the categories, bind it to the `CategoriesBLL` class's `GetCategories()` method.</span></span>

<span data-ttu-id="e989a-185">[![將 ObjectDataSource 系結至 CategoriesBLL 的 GetCategories （）方法](customizing-the-data-modification-interface-cs/_static/image20.png)](customizing-the-data-modification-interface-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-185">[![Bind the ObjectDataSource to the CategoriesBLL's GetCategories() Method](customizing-the-data-modification-interface-cs/_static/image20.png)](customizing-the-data-modification-interface-cs/_static/image19.png)</span></span>

<span data-ttu-id="e989a-186">**圖 7**：將 ObjectDataSource 系結至 `CategoriesBLL`的 `GetCategories()` 方法（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-186">**Figure 7**: Bind the ObjectDataSource to the `CategoriesBLL`'s `GetCategories()` Method ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image21.png))</span></span>

<span data-ttu-id="e989a-187">最後，設定 DropDownList 的設定，讓 [`CategoryName`] 欄位顯示在每個 DropDownList `ListItem` 中，並使用 `CategoryID` 欄位做為值。</span><span class="sxs-lookup"><span data-stu-id="e989a-187">Finally, configure the DropDownList's settings such that the `CategoryName` field is displayed in each DropDownList `ListItem` with the `CategoryID` field used as the value.</span></span>

<span data-ttu-id="e989a-188">[![顯示 [類別名稱] 欄位，並使用 [類別] 做為值](customizing-the-data-modification-interface-cs/_static/image23.png)](customizing-the-data-modification-interface-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-188">[![Have the CategoryName Field Displayed and the CategoryID Used as the Value](customizing-the-data-modification-interface-cs/_static/image23.png)](customizing-the-data-modification-interface-cs/_static/image22.png)</span></span>

<span data-ttu-id="e989a-189">**圖 8**：顯示 [`CategoryName`] 欄位，並使用 `CategoryID` 做為值（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-189">**Figure 8**: Have the `CategoryName` Field Displayed and the `CategoryID` Used as the Value ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image24.png))</span></span>

<span data-ttu-id="e989a-190">進行這些變更之後，`CategoryName` TemplateField 中的 `EditItemTemplate` 宣告式標記會同時包含 DropDownList 和 ObjectDataSource：</span><span class="sxs-lookup"><span data-stu-id="e989a-190">After making these changes the declarative markup for the `EditItemTemplate` in the `CategoryName` TemplateField will include both a DropDownList and an ObjectDataSource:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-cs/samples/sample5.aspx)]

> [!NOTE]
> <span data-ttu-id="e989a-191">`EditItemTemplate` 中的 DropDownList 必須啟用其檢視狀態。</span><span class="sxs-lookup"><span data-stu-id="e989a-191">The DropDownList in the `EditItemTemplate` must have its view state enabled.</span></span> <span data-ttu-id="e989a-192">我們很快就會將資料系結語法新增至 DropDownList 的宣告式語法，並將資料系結命令（例如 `Eval()`，`Bind()` 只能出現在已啟用檢視狀態的控制項中。</span><span class="sxs-lookup"><span data-stu-id="e989a-192">We will soon add databinding syntax to the DropDownList's declarative syntax and databinding commands like `Eval()` and `Bind()` can only appear in controls whose view state is enabled.</span></span>

<span data-ttu-id="e989a-193">重複這些步驟，將名為 `Suppliers` 的 DropDownList 新增至 `SupplierName` TemplateField 的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="e989a-193">Repeat these steps to add a DropDownList named `Suppliers` to the `SupplierName` TemplateField's `EditItemTemplate`.</span></span> <span data-ttu-id="e989a-194">這牽涉到將 DropDownList 新增至 `EditItemTemplate` 並建立另一個 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="e989a-194">This will involve adding a DropDownList to the `EditItemTemplate` and creating another ObjectDataSource.</span></span> <span data-ttu-id="e989a-195">不過，`Suppliers` DropDownList 的 ObjectDataSource 應該設定為叫用 `SuppliersBLL` 類別的 `GetSuppliers()` 方法。</span><span class="sxs-lookup"><span data-stu-id="e989a-195">The `Suppliers` DropDownList's ObjectDataSource, however, should be configured to invoke the `SuppliersBLL` class's `GetSuppliers()` method.</span></span> <span data-ttu-id="e989a-196">此外，將 `Suppliers` DropDownList 設定為顯示 [`CompanyName`] 欄位，並使用 [`SupplierID`] 欄位作為其 `ListItem` 的值。</span><span class="sxs-lookup"><span data-stu-id="e989a-196">Additionally, configure the `Suppliers` DropDownList to display the `CompanyName` field and use the `SupplierID` field as the value for its `ListItem` s.</span></span>

<span data-ttu-id="e989a-197">將 Dropdownlist 進行新增至兩個 `EditItemTemplate` s 之後，請在瀏覽器中載入頁面，然後按一下 Chef Anton 的 Cajun Seasoning 產品的 [編輯] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="e989a-197">After adding the DropDownLists to the two `EditItemTemplate` s, load the page in a browser and click the Edit button for the Chef Anton's Cajun Seasoning product.</span></span> <span data-ttu-id="e989a-198">如 [圖 9] 所示，產品的 [類別] 和 [供應商] 資料行會呈現為下拉式清單，其中包含可供選擇的可用類別和供應商。</span><span class="sxs-lookup"><span data-stu-id="e989a-198">As Figure 9 shows, the product's category and supplier columns are rendered as drop-down lists containing the available categories and suppliers to choose from.</span></span> <span data-ttu-id="e989a-199">不過，請注意，預設會選取這兩個下拉式清單中的*第一個*專案（類別的飲料，而外來液體為供應商），即使 Chef Anton 的 Cajun Seasoning 是新的奧爾良 Condiment Cajun 所提供的樂趣。</span><span class="sxs-lookup"><span data-stu-id="e989a-199">However, note that the *first* items in both drop-down lists are selected by default (Beverages for the category and Exotic Liquids as the supplier), even though Chef Anton's Cajun Seasoning is a Condiment supplied by New Orleans Cajun Delights.</span></span>

<span data-ttu-id="e989a-200">[![預設會選取下拉式清單中的第一個專案](customizing-the-data-modification-interface-cs/_static/image26.png)](customizing-the-data-modification-interface-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-200">[![The First Item in the Drop-Down Lists is Selected by Default](customizing-the-data-modification-interface-cs/_static/image26.png)](customizing-the-data-modification-interface-cs/_static/image25.png)</span></span>

<span data-ttu-id="e989a-201">**圖 9**：預設會選取下拉式清單中的第一個專案（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-201">**Figure 9**: The First Item in the Drop-Down Lists is Selected by Default ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image27.png))</span></span>

<span data-ttu-id="e989a-202">此外，如果您按一下 [更新]，您會發現產品的 `CategoryID` 和 `SupplierID` 值已設定為 [`NULL`]。</span><span class="sxs-lookup"><span data-stu-id="e989a-202">Furthermore, if you click Update, you'll find that the product's `CategoryID` and `SupplierID` values are set to `NULL`.</span></span> <span data-ttu-id="e989a-203">這兩種不想要的行為都是因為 `EditItemTemplate` s 中的 Dropdownlist 進行並未系結至基礎產品資料中的任何資料欄位所造成。</span><span class="sxs-lookup"><span data-stu-id="e989a-203">Both of these undesired behaviors are caused because the DropDownLists in the `EditItemTemplate` s are not bound to any data fields from the underlying product data.</span></span>

## <a name="binding-the-dropdownlists-to-thecategoryidandsupplieriddata-fields"></a><span data-ttu-id="e989a-204">將 Dropdownlist 進行系結至`CategoryID`並`SupplierID`資料欄位</span><span class="sxs-lookup"><span data-stu-id="e989a-204">Binding the DropDownLists to the`CategoryID`and`SupplierID`Data Fields</span></span>

<span data-ttu-id="e989a-205">為了讓已編輯的產品類別目錄和供應商下拉式清單設定為適當的值，並在按一下 Update 時將這些值傳送回 BLL 的 `UpdateProduct` 方法，我們必須使用雙向資料系結，將 Dropdownlist 進行的 `SelectedValue` 屬性系結至 `CategoryID` 和 `SupplierID` 資料欄位。</span><span class="sxs-lookup"><span data-stu-id="e989a-205">In order to have the edited product's category and supplier drop-down lists set to the appropriate values and to have these values sent back to the BLL's `UpdateProduct` method upon clicking Update, we need to bind the DropDownLists' `SelectedValue` properties to the `CategoryID` and `SupplierID` data fields using two-way databinding.</span></span> <span data-ttu-id="e989a-206">若要使用 `Categories` DropDownList 來完成此動作，您可以將 `SelectedValue='<%# Bind("CategoryID") %>'` 直接加入至宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="e989a-206">To accomplish this with the `Categories` DropDownList, you can add `SelectedValue='<%# Bind("CategoryID") %>'` directly to the declarative syntax.</span></span>

<span data-ttu-id="e989a-207">或者，您也可以透過設計工具編輯範本，然後按一下 DropDownList 的智慧標籤中的 [編輯系結] 連結，來設定 DropDownList 的系結。</span><span class="sxs-lookup"><span data-stu-id="e989a-207">Alternatively, you can set the DropDownList's databindings by editing the template through the Designer and clicking the Edit DataBindings link from the DropDownList's smart tag.</span></span> <span data-ttu-id="e989a-208">接下來，請使用雙向資料系結（請參閱 [圖 10]），指出 `SelectedValue` 屬性應該系結至 `CategoryID` 欄位。</span><span class="sxs-lookup"><span data-stu-id="e989a-208">Next, indicate that the `SelectedValue` property should be bound to the `CategoryID` field using two-way databinding (see Figure 10).</span></span> <span data-ttu-id="e989a-209">重複宣告式或設計工具程式，將 `SupplierID` 資料欄位系結至 `Suppliers` DropDownList。</span><span class="sxs-lookup"><span data-stu-id="e989a-209">Repeat either the declarative or Designer process to bind the `SupplierID` data field to the `Suppliers` DropDownList.</span></span>

<span data-ttu-id="e989a-210">[![使用雙向資料系結將類別系結至 DropDownList 的 SelectedValue 屬性](customizing-the-data-modification-interface-cs/_static/image29.png)](customizing-the-data-modification-interface-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-210">[![Bind the CategoryID to the DropDownList's SelectedValue Property Using Two-Way Databinding](customizing-the-data-modification-interface-cs/_static/image29.png)](customizing-the-data-modification-interface-cs/_static/image28.png)</span></span>

<span data-ttu-id="e989a-211">**圖 10**：使用雙向資料系結，將 `CategoryID` 系結至 DropDownList 的 `SelectedValue` 屬性（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-211">**Figure 10**: Bind the `CategoryID` to the DropDownList's `SelectedValue` Property Using Two-Way Databinding ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image30.png))</span></span>

<span data-ttu-id="e989a-212">一旦將系結套用至這兩個 Dropdownlist 進行的 `SelectedValue` 屬性，編輯後的產品的類別和供應商資料行就會預設為目前的產品值。</span><span class="sxs-lookup"><span data-stu-id="e989a-212">Once the bindings have been applied to the `SelectedValue` properties of the two DropDownLists, the edited product's category and supplier columns will default to the current product's values.</span></span> <span data-ttu-id="e989a-213">按一下 [更新] 之後，所選下拉式清單專案的 `CategoryID` 和 `SupplierID` 值將會傳遞至 `UpdateProduct` 方法。</span><span class="sxs-lookup"><span data-stu-id="e989a-213">Upon clicking Update, the `CategoryID` and `SupplierID` values of the selected drop-down list item will be passed to the `UpdateProduct` method.</span></span> <span data-ttu-id="e989a-214">[圖 11] 顯示在加入資料系結語句之後的教學課程;請注意，針對 Chef Anton 的 Cajun Seasoning 所選取的下拉式清單專案，如何正確 Condiment 和新的奧爾良 Cajun 樂趣。</span><span class="sxs-lookup"><span data-stu-id="e989a-214">Figure 11 shows the tutorial after the databinding statements have been added; note how the selected drop-down list items for Chef Anton's Cajun Seasoning are correctly Condiment and New Orleans Cajun Delights.</span></span>

<span data-ttu-id="e989a-215">[![已編輯的產品目前的類別和供應商的值預設為選取](customizing-the-data-modification-interface-cs/_static/image32.png)](customizing-the-data-modification-interface-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-215">[![The Edited Product's Current Category and Supplier Values are Selected by Default](customizing-the-data-modification-interface-cs/_static/image32.png)](customizing-the-data-modification-interface-cs/_static/image31.png)</span></span>

<span data-ttu-id="e989a-216">**圖 11**：預設會選取已編輯的產品目前的類別和供應商值（[按一下以觀看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-216">**Figure 11**: The Edited Product's Current Category and Supplier Values are Selected by Default ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image33.png))</span></span>

## <a name="handlingnullvalues"></a><span data-ttu-id="e989a-217">處理`NULL`值</span><span class="sxs-lookup"><span data-stu-id="e989a-217">Handling`NULL`Values</span></span>

<span data-ttu-id="e989a-218">`Products` 資料表中的 `CategoryID` 和 `SupplierID` 資料行可以 `NULL`，但 `EditItemTemplate` s 中的 Dropdownlist 進行不會包含清單專案來代表 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="e989a-218">The `CategoryID` and `SupplierID` columns in the `Products` table can be `NULL`, yet the DropDownLists in the `EditItemTemplate` s don't include a list item to represent a `NULL` value.</span></span> <span data-ttu-id="e989a-219">這有兩個結果：</span><span class="sxs-lookup"><span data-stu-id="e989a-219">This has two consequences:</span></span>

- <span data-ttu-id="e989a-220">使用者無法使用我們的介面將產品的類別或供應商從非`NULL` 值變更為 `NULL` 一</span><span class="sxs-lookup"><span data-stu-id="e989a-220">User cannot use our interface to change a product's category or supplier from a non-`NULL` value to a `NULL` one</span></span>
- <span data-ttu-id="e989a-221">如果產品有 `NULL` `CategoryID` 或 `SupplierID`，按一下 [編輯] 按鈕將會導致例外狀況。</span><span class="sxs-lookup"><span data-stu-id="e989a-221">If a product has a `NULL` `CategoryID` or `SupplierID`, clicking the Edit button will result in an exception.</span></span> <span data-ttu-id="e989a-222">這是因為 `Bind()` 語句中 `CategoryID` （或 `SupplierID`）所傳回的 `NULL` 值並未對應到 DropDownList 中的值（當其 `SelectedValue` 屬性設定為*不*在其清單專案集合中的值時，DropDownList 會擲回例外狀況）。</span><span class="sxs-lookup"><span data-stu-id="e989a-222">This is because the `NULL` value returned by `CategoryID` (or `SupplierID`) in the `Bind()` statement does not map to a value in the DropDownList (the DropDownList throws an exception when its `SelectedValue` property is set to a value *not* in its collection of list items).</span></span>

<span data-ttu-id="e989a-223">為了支援 `NULL` `CategoryID` 和 `SupplierID` 值，我們需要將另一個 `ListItem` 新增至每個 DropDownList，以代表 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="e989a-223">In order to support `NULL` `CategoryID` and `SupplierID` values, we need to add another `ListItem` to each DropDownList to represent the `NULL` value.</span></span> <span data-ttu-id="e989a-224">在具有 DropDownList 教學課程的[主要/詳細資料篩選](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md)中，我們已瞭解如何將額外的 `ListItem` 新增至資料系結 DropDownList，這牽涉到將 DropDownList 的 `AppendDataBoundItems` 屬性設定為 `true` 並手動新增其他 `ListItem`。</span><span class="sxs-lookup"><span data-stu-id="e989a-224">In the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) tutorial, we saw how to add an additional `ListItem` to a databound DropDownList, which involved setting the DropDownList's `AppendDataBoundItems` property to `true` and manually adding the additional `ListItem`.</span></span> <span data-ttu-id="e989a-225">不過在先前的教學課程中，我們新增了具有 `Value` `-1`的 `ListItem`。</span><span class="sxs-lookup"><span data-stu-id="e989a-225">In that previous tutorial, however, we added a `ListItem` with a `Value` of `-1`.</span></span> <span data-ttu-id="e989a-226">不過，ASP.NET 中的資料系結邏輯會自動將空白字串轉換成 `NULL` 值，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="e989a-226">The databinding logic in ASP.NET, however, will automatically convert a blank string to a `NULL` value and vice-a-versa.</span></span> <span data-ttu-id="e989a-227">因此，在本教學課程中，我們希望 `ListItem`的 `Value` 是空字串。</span><span class="sxs-lookup"><span data-stu-id="e989a-227">Therefore, for this tutorial we want the `ListItem`'s `Value` to be an empty string.</span></span>

<span data-ttu-id="e989a-228">一開始請將 Dropdownlist 進行的 `AppendDataBoundItems` 屬性設定為 `true`。</span><span class="sxs-lookup"><span data-stu-id="e989a-228">Start by setting both DropDownLists' `AppendDataBoundItems` property to `true`.</span></span> <span data-ttu-id="e989a-229">接下來，將下列 `<asp:ListItem>` 元素新增至每個 DropDownList，以新增 `NULL` `ListItem`，讓宣告式標記看起來像這樣：</span><span class="sxs-lookup"><span data-stu-id="e989a-229">Next, add the `NULL` `ListItem` by adding the following `<asp:ListItem>` element to each DropDownList so that the declarative markup looks like:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-cs/samples/sample6.aspx)]

<span data-ttu-id="e989a-230">我已選擇使用 "（None）" 做為此 `ListItem`的文字值，但如果您想要的話，也可以將它變更為空白字串。</span><span class="sxs-lookup"><span data-stu-id="e989a-230">I've chosen to use "(None)" as the Text value for this `ListItem`, but you can change it to also be a blank string if you'd like.</span></span>

> [!NOTE]
> <span data-ttu-id="e989a-231">如我們在*主要/詳細資料篩選 DropDownList*教學課程中所見，您可以在 屬性視窗中按一下 DropDownList 的 `Items` 屬性（這會顯示 `ListItem` 集合編輯器），透過設計工具將 `ListItem` 新增至 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="e989a-231">As we saw in the *Master/Detail Filtering With a DropDownList* tutorial, `ListItem` s can be added to a DropDownList through the Designer by clicking on the DropDownList's `Items` property in the Properties window (which will display the `ListItem` Collection Editor).</span></span> <span data-ttu-id="e989a-232">不過，請務必透過宣告式語法，為本教學課程新增 `NULL` `ListItem`。</span><span class="sxs-lookup"><span data-stu-id="e989a-232">However, be sure to add the `NULL` `ListItem` for this tutorial through the declarative syntax.</span></span> <span data-ttu-id="e989a-233">如果您使用 [`ListItem` 集合編輯器]，則產生的宣告式語法會在指派空白字串時完全省略 `Value` 設定，並建立如下的宣告式標記： `<asp:ListItem>(None)</asp:ListItem>`。</span><span class="sxs-lookup"><span data-stu-id="e989a-233">If you use the `ListItem` Collection Editor, the generated declarative syntax will omit the `Value` setting altogether when assigned a blank string, creating declarative markup like: `<asp:ListItem>(None)</asp:ListItem>`.</span></span> <span data-ttu-id="e989a-234">雖然這看起來可能無害，但遺漏值會導致 DropDownList 在其位置使用 `Text` 屬性值。</span><span class="sxs-lookup"><span data-stu-id="e989a-234">While this may look harmless, the missing Value causes the DropDownList to use the `Text` property value in its place.</span></span> <span data-ttu-id="e989a-235">這表示如果選取此 `NULL` `ListItem`，則會嘗試將值 "（None）" 指派給 `CategoryID`，這會導致例外狀況。</span><span class="sxs-lookup"><span data-stu-id="e989a-235">That means that if this `NULL` `ListItem` is selected, the value "(None)" will be attempted to be assigned to the `CategoryID`, which will result in an exception.</span></span> <span data-ttu-id="e989a-236">藉由明確地設定 `Value=""`，當選取 `NULL` `ListItem` 時，`NULL` 值會指派給 `CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="e989a-236">By explicitly setting `Value=""`, a `NULL` value will be assigned to `CategoryID` when the `NULL` `ListItem` is selected.</span></span>

<span data-ttu-id="e989a-237">針對供應商 DropDownList 重複這些步驟。</span><span class="sxs-lookup"><span data-stu-id="e989a-237">Repeat these steps for the Suppliers DropDownList.</span></span>

<span data-ttu-id="e989a-238">透過這項額外的 `ListItem`，編輯介面現在可以將 `NULL` 值指派給產品的 `CategoryID` 和 `SupplierID` 欄位，如 [圖 12] 所示。</span><span class="sxs-lookup"><span data-stu-id="e989a-238">With this additional `ListItem`, the editing interface can now assign `NULL` values to a Product's `CategoryID` and `SupplierID` fields, as shown in Figure 12.</span></span>

<span data-ttu-id="e989a-239">[![選擇（無）為產品的類別或供應商指派 Null 值](customizing-the-data-modification-interface-cs/_static/image35.png)](customizing-the-data-modification-interface-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-239">[![Choose (None) to Assign a NULL Value for a Product's Category or Supplier](customizing-the-data-modification-interface-cs/_static/image35.png)](customizing-the-data-modification-interface-cs/_static/image34.png)</span></span>

<span data-ttu-id="e989a-240">**圖 12**：選擇 [（無）] 以指派產品類別或供應商的 `NULL` 值（[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-240">**Figure 12**: Choose (None) to Assign a `NULL` Value for a Product's Category or Supplier ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image36.png))</span></span>

## <a name="step-4-using-radiobuttons-for-the-discontinued-status"></a><span data-ttu-id="e989a-241">步驟4：針對已停止狀態使用「選項按鈕」</span><span class="sxs-lookup"><span data-stu-id="e989a-241">Step 4: Using RadioButtons for the Discontinued Status</span></span>

<span data-ttu-id="e989a-242">目前，產品的 `Discontinued` 資料欄位是使用 CheckBoxField 表示，這會呈現唯讀資料列的已停用核取方塊，以及所編輯資料列的啟用核取方塊。</span><span class="sxs-lookup"><span data-stu-id="e989a-242">Currently the products' `Discontinued` data field is expressed using a CheckBoxField, which renders a disabled checkbox for the read-only rows and an enabled checkbox for the row being edited.</span></span> <span data-ttu-id="e989a-243">雖然此使用者介面通常是合適的，但我們可以在需要時使用 TemplateField 進行自訂。</span><span class="sxs-lookup"><span data-stu-id="e989a-243">While this user interface is often suitable, we can customize it if needed using a TemplateField.</span></span> <span data-ttu-id="e989a-244">在本教學課程中，讓我們將 CheckBoxField 變更為 TemplateField，以使用具有兩個選項「作用中」和「已中止」的 RadioButtonList 控制項，使用者可以在其中指定產品的 `Discontinued` 值。</span><span class="sxs-lookup"><span data-stu-id="e989a-244">For this tutorial, let's change the CheckBoxField into a TemplateField that uses a RadioButtonList control with two options "Active" and "Discontinued" from which the user can specify the product's `Discontinued` value.</span></span>

<span data-ttu-id="e989a-245">首先，將 `Discontinued` CheckBoxField 轉換成 TemplateField，這將會建立具有 `ItemTemplate` 和 `EditItemTemplate`的 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="e989a-245">Start by converting the `Discontinued` CheckBoxField into a TemplateField, which will create a TemplateField with an `ItemTemplate` and `EditItemTemplate`.</span></span> <span data-ttu-id="e989a-246">這兩個範本都包含一個核取方塊，其 `Checked` 屬性系結至 [`Discontinued` 資料] 欄位，兩者之間唯一的差異在於 `ItemTemplate`的核取方塊的 [`Enabled`] 屬性設為 [`false`]。</span><span class="sxs-lookup"><span data-stu-id="e989a-246">Both templates include a CheckBox with its `Checked` property bound to the `Discontinued` data field, the only difference between the two being that the `ItemTemplate`'s CheckBox's `Enabled` property is set to `false`.</span></span>

<span data-ttu-id="e989a-247">以 RadioButtonList 控制項取代 `ItemTemplate` 和 `EditItemTemplate` 中的核取方塊，同時將兩個 RadioButtonLists 的 `ID` 屬性都設定為 `DiscontinuedChoice`。</span><span class="sxs-lookup"><span data-stu-id="e989a-247">Replace the CheckBox in both the `ItemTemplate` and `EditItemTemplate` with a RadioButtonList control, setting both RadioButtonLists' `ID` properties to `DiscontinuedChoice`.</span></span> <span data-ttu-id="e989a-248">接下來，表示每個 RadioButtonLists 都應該包含兩個選項按鈕，一個標記為 "Active"，值為 "False"，另一個標記為 "已停止"，值為 "True"。</span><span class="sxs-lookup"><span data-stu-id="e989a-248">Next, indicate that the RadioButtonLists should each contain two radio buttons, one labeled "Active" with a value of "False" and one labeled "Discontinued" with a value of "True".</span></span> <span data-ttu-id="e989a-249">若要完成這項操作，您可以直接透過宣告式語法輸入中的 `<asp:ListItem>` 元素，或使用設計工具中的 [`ListItem` 集合編輯器]。</span><span class="sxs-lookup"><span data-stu-id="e989a-249">To accomplish this you can either enter the `<asp:ListItem>` elements in directly through the declarative syntax or use the `ListItem` Collection Editor from the Designer.</span></span> <span data-ttu-id="e989a-250">[圖 13] 顯示指定了兩個選項按鈕選項之後的 [`ListItem` 集合編輯器]。</span><span class="sxs-lookup"><span data-stu-id="e989a-250">Figure 13 shows the `ListItem` Collection Editor after the two radio button options have been specified.</span></span>

<span data-ttu-id="e989a-251">[![新增](customizing-the-data-modification-interface-cs/_static/image38.png)](customizing-the-data-modification-interface-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-251">[![Add](customizing-the-data-modification-interface-cs/_static/image38.png)](customizing-the-data-modification-interface-cs/_static/image37.png)</span></span>

<span data-ttu-id="e989a-252">**圖 13**：將「作用中」和「已中止」選項新增至 RadioButtonList （[按一下以查看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-252">**Figure 13**: Add "Active" and "Discontinued" Options to the RadioButtonList ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image39.png))</span></span>

<span data-ttu-id="e989a-253">因為 `ItemTemplate` 中的 RadioButtonList 不應該是可編輯的，請將其 `Enabled` 屬性設定為 [`false`]，讓 `true` 中 RadioButtonList 的 `Enabled` 屬性 `EditItemTemplate`（預設值）。</span><span class="sxs-lookup"><span data-stu-id="e989a-253">Since the RadioButtonList in the `ItemTemplate` shouldn't be editable, set its `Enabled` property to `false`, leaving the `Enabled` property to `true` (the default) for the RadioButtonList in the `EditItemTemplate`.</span></span> <span data-ttu-id="e989a-254">這會使非編輯的資料列中的選項按鈕變成隻讀，但可讓使用者變更編輯過之資料列的按鈕值。</span><span class="sxs-lookup"><span data-stu-id="e989a-254">This will make the radio buttons in the non-edited row as read-only, but will allow the user to change the RadioButton values for the edited row.</span></span>

<span data-ttu-id="e989a-255">我們仍然需要指派 RadioButtonList 控制項的 `SelectedValue` 屬性，以便根據產品的 [`Discontinued` 資料] 欄位選取適當的選項按鈕。</span><span class="sxs-lookup"><span data-stu-id="e989a-255">We still need to assign the RadioButtonList controls' `SelectedValue` properties so that the appropriate radio button is selected based upon the product's `Discontinued` data field.</span></span> <span data-ttu-id="e989a-256">如同本教學課程稍早所述的 Dropdownlist 進行，這個資料系結語法可以直接加入宣告式標記中，或透過 RadioButtonLists 的智慧標籤中的 [編輯資料系結] 連結新增。</span><span class="sxs-lookup"><span data-stu-id="e989a-256">As with the DropDownLists examined earlier in this tutorial, this databinding syntax can either be added directly into the declarative markup or through the Edit DataBindings link in the RadioButtonLists' smart tags.</span></span>

<span data-ttu-id="e989a-257">加入兩個 RadioButtonLists 並加以設定之後，`Discontinued` TemplateField 的宣告式標記看起來應該像這樣：</span><span class="sxs-lookup"><span data-stu-id="e989a-257">After adding the two RadioButtonLists and configuring them, the `Discontinued` TemplateField's declarative markup should look like:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-cs/samples/sample7.aspx)]

<span data-ttu-id="e989a-258">有了這些變更，就會將 [`Discontinued`] 資料行從核取方塊清單轉換為選項按鈕組清單（請參閱 [圖 14]）。</span><span class="sxs-lookup"><span data-stu-id="e989a-258">With these changes, the `Discontinued` column has been transformed from a list of checkboxes to a list of radio button pairs (see Figure 14).</span></span> <span data-ttu-id="e989a-259">編輯產品時，會選取適當的選項按鈕，然後按一下 [其他] 選項按鈕，再按 [更新]，即可更新產品的已停止狀態。</span><span class="sxs-lookup"><span data-stu-id="e989a-259">When editing a product, the appropriate radio button is selected and the product's discontinued status can be updated by selecting the other radio button and clicking Update.</span></span>

<span data-ttu-id="e989a-260">[![已停止的核取方塊已由選項按鈕組取代](customizing-the-data-modification-interface-cs/_static/image41.png)](customizing-the-data-modification-interface-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="e989a-260">[![The Discontinued CheckBoxes Have Been Replaced by Radio Button Pairs](customizing-the-data-modification-interface-cs/_static/image41.png)](customizing-the-data-modification-interface-cs/_static/image40.png)</span></span>

<span data-ttu-id="e989a-261">**圖 14**：已停止的核取方塊已由選項按鈕組取代（[按一下以觀看完整大小的影像](customizing-the-data-modification-interface-cs/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="e989a-261">**Figure 14**: The Discontinued CheckBoxes Have Been Replaced by Radio Button Pairs ([Click to view full-size image](customizing-the-data-modification-interface-cs/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e989a-262">因為 `Products` 資料庫中的 `Discontinued` 資料行不能有 `NULL` 的值，所以我們不需要擔心在介面中捕捉 `NULL` 資訊。</span><span class="sxs-lookup"><span data-stu-id="e989a-262">Since the `Discontinued` column in the `Products` database cannot have `NULL` values, we do not need to worry about capturing `NULL` information in the interface.</span></span> <span data-ttu-id="e989a-263">不過，如果 `Discontinued` 的資料行可以包含 `NULL` 值，我們會想要將第三個選項按鈕加入至清單，並將其 `Value` 設定為空字串（`Value=""`），就像類別目錄和供應商 Dropdownlist 進行一樣。</span><span class="sxs-lookup"><span data-stu-id="e989a-263">If, however, `Discontinued` column could contain `NULL` values we'd want to add a third radio button to the list with its `Value` set to an empty string (`Value=""`), just like with the category and supplier DropDownLists.</span></span>

## <a name="summary"></a><span data-ttu-id="e989a-264">總結</span><span class="sxs-lookup"><span data-stu-id="e989a-264">Summary</span></span>

<span data-ttu-id="e989a-265">雖然 BoundField 和 CheckBoxField 會自動呈現唯讀、編輯和插入介面，但它們缺乏自訂的能力。</span><span class="sxs-lookup"><span data-stu-id="e989a-265">While the BoundField and CheckBoxField automatically render read-only, editing, and inserting interfaces, they lack the ability for customization.</span></span> <span data-ttu-id="e989a-266">不過，通常我們需要自訂編輯或插入介面，也許加入驗證控制項（如先前的教學課程中所見），或是自訂資料收集使用者介面（如本教學課程中所見）。</span><span class="sxs-lookup"><span data-stu-id="e989a-266">Often, though, we'll need to customize the editing or inserting interface, perhaps adding validation controls (as we saw in the preceding tutorial) or by customizing the data collection user interface (as we saw in this tutorial).</span></span> <span data-ttu-id="e989a-267">在下列步驟中，您可以使用 TemplateField 自訂介面：</span><span class="sxs-lookup"><span data-stu-id="e989a-267">Customizing the interface with a TemplateField can be summed up in the following steps:</span></span>

1. <span data-ttu-id="e989a-268">新增 TemplateField，或將現有的 BoundField 或 CheckBoxField 轉換成 TemplateField</span><span class="sxs-lookup"><span data-stu-id="e989a-268">Add a TemplateField or convert an existing BoundField or CheckBoxField into a TemplateField</span></span>
2. <span data-ttu-id="e989a-269">視需要擴充介面</span><span class="sxs-lookup"><span data-stu-id="e989a-269">Augment the interface as needed</span></span>
3. <span data-ttu-id="e989a-270">使用雙向資料系結將適當的資料欄位系結至新加入的 Web 控制項</span><span class="sxs-lookup"><span data-stu-id="e989a-270">Bind the appropriate data fields to the newly added Web controls using two-way databinding</span></span>

<span data-ttu-id="e989a-271">除了使用內建的 ASP.NET Web 控制項以外，您也可以使用自訂、編譯的伺服器控制項和使用者控制項來自訂 TemplateField 的範本。</span><span class="sxs-lookup"><span data-stu-id="e989a-271">In addition to using the built-in ASP.NET Web controls, you can also customize the templates of a TemplateField with custom, compiled server controls and User Controls.</span></span>

<span data-ttu-id="e989a-272">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="e989a-272">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e989a-273">關於作者</span><span class="sxs-lookup"><span data-stu-id="e989a-273">About the Author</span></span>

<span data-ttu-id="e989a-274">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="e989a-274">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e989a-275">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="e989a-275">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e989a-276">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="e989a-276">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e989a-277">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e989a-277">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e989a-278">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="e989a-278">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e989a-279">[上一頁](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)
> [下一頁](implementing-optimistic-concurrency-cs.md)</span><span class="sxs-lookup"><span data-stu-id="e989a-279">[Previous](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)
[Next](implementing-optimistic-concurrency-cs.md)</span></span>
