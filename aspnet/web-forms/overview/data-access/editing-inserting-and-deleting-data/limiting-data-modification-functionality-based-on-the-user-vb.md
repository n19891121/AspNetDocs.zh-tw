---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb
title: 限制資料修改功能以使用者 (VB) |Microsoft Docs
author: rick-anderson
description: 允許使用者編輯資料的 web 應用程式，在不同的使用者帳戶可能有不同的資料編輯權限。 在本教學課程中我們將檢驗如何 t...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 9dc264a6-feb8-474b-8b91-008c50708065
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb
msc.type: authoredcontent
ms.openlocfilehash: 8633d6ba5d82dfa2ebbea6858eb89433573a775f
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/01/2019
ms.locfileid: "57032545"
---
<a name="limiting-data-modification-functionality-based-on-the-user-vb"></a><span data-ttu-id="4e309-104">根據使用者限制資料修改功能 (VB)</span><span class="sxs-lookup"><span data-stu-id="4e309-104">Limiting Data Modification Functionality Based on the User (VB)</span></span>
====================
<span data-ttu-id="4e309-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="4e309-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="4e309-106">[下載範例應用程式](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_23_VB.exe)或[下載 PDF](limiting-data-modification-functionality-based-on-the-user-vb/_static/datatutorial23vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="4e309-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_23_VB.exe) or [Download PDF](limiting-data-modification-functionality-based-on-the-user-vb/_static/datatutorial23vb1.pdf)</span></span>

> <span data-ttu-id="4e309-107">允許使用者編輯資料的 web 應用程式，在不同的使用者帳戶可能有不同的資料編輯權限。</span><span class="sxs-lookup"><span data-stu-id="4e309-107">In a web application that allows users to edit data, different user accounts may have different data-editing privileges.</span></span> <span data-ttu-id="4e309-108">在本教學課程中，我們將檢驗如何動態調整造訪的使用者為基礎的資料修改功能。</span><span class="sxs-lookup"><span data-stu-id="4e309-108">In this tutorial we'll examine how to dynamically adjust the data modification capabilities based on the visiting user.</span></span>


## <a name="introduction"></a><span data-ttu-id="4e309-109">簡介</span><span class="sxs-lookup"><span data-stu-id="4e309-109">Introduction</span></span>

<span data-ttu-id="4e309-110">許多 web 應用程式支援使用者帳戶，並提供不同的選項、 報表和登入的使用者為基礎的功能。</span><span class="sxs-lookup"><span data-stu-id="4e309-110">A number of web applications support user accounts and provide different options, reports, and functionality based on the logged in user.</span></span> <span data-ttu-id="4e309-111">比方說，與我們的教學課程我們可能會想要允許使用者從供應商公司或許-供應商資訊，例如公司名稱，以及站台和更新的一般資訊及其產品，其名稱和數量，每個單位，來登入地址、 連絡人的資訊等等。</span><span class="sxs-lookup"><span data-stu-id="4e309-111">For example, with our tutorials we might want to allow users from the supplier companies to log on to the site and update general information about their products - their name and quantity per unit, perhaps - along with supplier information, such as their company name, address, the contact person s information, and so on.</span></span> <span data-ttu-id="4e309-112">此外，我們也可能會想要從我們的公司的人包含部分使用者帳戶，以便他們可以登入並更新產品資訊，例如股票圖、 單位重新排序層級，等等。</span><span class="sxs-lookup"><span data-stu-id="4e309-112">Furthermore, we might want to include some user accounts for people from our company so that they can log on and update product information like units on stock, reorder level, and so forth.</span></span> <span data-ttu-id="4e309-113">我們的 web 應用程式也可能會允許匿名使用者造訪 （人不登入），但會限制它們只能檢視資料。</span><span class="sxs-lookup"><span data-stu-id="4e309-113">Our web application might also allow anonymous users to visit (people who have not logged on), but would limit them to just viewing data.</span></span> <span data-ttu-id="4e309-114">與這類使用者帳戶系統，我們會想在我們 ASP.NET 網頁中插入、 編輯和刪除功能適用於目前登入的使用者提供的資料 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="4e309-114">With such a user account system in place, we would want the data Web controls in our ASP.NET pages to offer the inserting, editing, and deleting capabilities appropriate for the currently logged on user.</span></span>

<span data-ttu-id="4e309-115">在本教學課程中，我們將檢驗如何動態調整造訪的使用者為基礎的資料修改功能。</span><span class="sxs-lookup"><span data-stu-id="4e309-115">In this tutorial we'll examine how to dynamically adjust the data modification capabilities based on the visiting user.</span></span> <span data-ttu-id="4e309-116">特別是，我們將建立的 GridView 會列出供應商所提供的產品以及編輯 DetailsView 中顯示的供應商資訊的頁面。</span><span class="sxs-lookup"><span data-stu-id="4e309-116">In particular, we'll create a page that displays the suppliers information in an editable DetailsView along with a GridView that lists the products provided by the supplier.</span></span> <span data-ttu-id="4e309-117">如果使用者瀏覽的頁面是從我們的公司，他們可以： 可以檢視任何供應商的資訊;編輯其位址;然後編輯任何供應商所提供的產品資訊。</span><span class="sxs-lookup"><span data-stu-id="4e309-117">If the user visiting the page is from our company, they can: view any supplier s information; edit their address; and edit the information for any product provided by the supplier.</span></span> <span data-ttu-id="4e309-118">如果，不過，使用者是從某家公司，他們可以只檢視和編輯自己的位址資訊和只能編輯他們未標示為已停用的產品。</span><span class="sxs-lookup"><span data-stu-id="4e309-118">If, however, the user is from a particular company, they can only view and edit their own address information and can only edit their products that have not been marked as discontinued.</span></span>


<span data-ttu-id="4e309-119">[![我們公司的使用者可以編輯任何供應商的資訊](limiting-data-modification-functionality-based-on-the-user-vb/_static/image2.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-119">[![A User from Our Company Can Edit Any Supplier s Information](limiting-data-modification-functionality-based-on-the-user-vb/_static/image2.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image1.png)</span></span>

<span data-ttu-id="4e309-120">**圖 1**:我們公司可以編輯任何供應商的資訊的使用者 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-120">**Figure 1**: A User from Our Company Can Edit Any Supplier s Information ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image3.png))</span></span>


<span data-ttu-id="4e309-121">[![從特定的供應商只能檢視和編輯其資訊的使用者](limiting-data-modification-functionality-based-on-the-user-vb/_static/image5.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-121">[![A User from a Particular Supplier Can Only View and Edit their Information](limiting-data-modification-functionality-based-on-the-user-vb/_static/image5.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image4.png)</span></span>

<span data-ttu-id="4e309-122">**圖 2**:從特定供應商可以只檢視和編輯其資訊的使用者 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-122">**Figure 2**: A User from a Particular Supplier Can Only View and Edit their Information ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image6.png))</span></span>


<span data-ttu-id="4e309-123">讓 s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="4e309-123">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="4e309-124">ASP.NET 2.0 成員資格系統提供標準化、 可延伸的平台建立、 管理和驗證使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="4e309-124">ASP.NET 2.0 s membership system provides a standardized, extensible platform for creating, managing, and validating user accounts.</span></span> <span data-ttu-id="4e309-125">由於成員資格系統的檢查是這些教學課程的範圍之外，本教學課程中改為 「 fakes"的成員資格允許匿名的使用者選擇是否是特定供應商，或從我們的公司。</span><span class="sxs-lookup"><span data-stu-id="4e309-125">Since an examination of the membership system is beyond the scope of these tutorials, this tutorial instead "fakes" membership by allowing anonymous visitors to choose whether they are from a particular supplier or from our company.</span></span> <span data-ttu-id="4e309-126">如需成員資格的詳細資訊，請參閱我[檢查 ASP.NET 2.0 s 成員資格、 角色和設定檔](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)系列文章。</span><span class="sxs-lookup"><span data-stu-id="4e309-126">For more on membership, refer to my [Examining ASP.NET 2.0 s Membership, Roles, and Profile](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx) article series.</span></span>


## <a name="step-1-allowing-the-user-to-specify-their-access-rights"></a><span data-ttu-id="4e309-127">步驟 1：允許使用者指定其存取權限</span><span class="sxs-lookup"><span data-stu-id="4e309-127">Step 1: Allowing the User to Specify their Access Rights</span></span>

<span data-ttu-id="4e309-128">在真實世界的 web 應用程式，是否他們工作本公司或特定供應商，以及這項資訊會從我們的 ASP.NET 網頁以程式設計方式存取，使用者已登入站台之後，會包含使用者的帳戶資訊。</span><span class="sxs-lookup"><span data-stu-id="4e309-128">In a real-world web application, a user s account information would include whether they worked for our company or for a particular supplier, and this information would be programmatically accessible from our ASP.NET pages once the user has logged on to the site.</span></span> <span data-ttu-id="4e309-129">透過設定檔的系統，或透過一些自訂方法的使用者層級帳戶資訊，可以透過 ASP.NET 2.0 角色系統，擷取此資訊。</span><span class="sxs-lookup"><span data-stu-id="4e309-129">This information could be captured through ASP.NET 2.0 s roles system, as user-level account information through the profile system, or through some custom means.</span></span>

<span data-ttu-id="4e309-130">因為本教學課程的目的是為了示範調整登入的使用者為基礎的資料修改功能，而不是以 ASP.NET 2.0 的展示 s 成員資格、 角色和設定檔的系統，我們將使用非常簡單的機制來判斷瀏覽頁面-dropdownlist 進行的使用者可以指出是否他們應該能夠檢視及編輯任何供應商資訊，或者哪些使用者的功能也可以檢視和編輯的特定供應商的資訊。</span><span class="sxs-lookup"><span data-stu-id="4e309-130">Since the aim of this tutorial is to demonstrate adjusting the data modification capabilities based on the logged on user, and is not meant to showcase ASP.NET 2.0 s membership, roles, and profile systems, we'll use a very simply mechanism to determine the capabilities for the user visiting the page - a DropDownList from which the user can indicate if they should be able to view and edit any of the suppliers information or, alternatively, what particular supplier s information they can view and edit.</span></span> <span data-ttu-id="4e309-131">如果使用者表示她可以檢視和編輯所有供應商資訊 （預設值），她可以逐頁瀏覽所有供應商、 編輯任何供應商 s 的位址資訊，並編輯所選取的供應商提供的任何產品的每單位的數量與名稱。</span><span class="sxs-lookup"><span data-stu-id="4e309-131">If the user indicates that she can view and edit all supplier information (the default), she can page through all suppliers, edit any supplier s address information, and edit the name and quantity per unit for any product provided by the selected supplier.</span></span> <span data-ttu-id="4e309-132">如果使用者表示，她只可檢視和編輯的特定供應商，不過，她可以只檢視該一家供應商的詳細資訊和產品然後只能更新名稱和每單位這些產品的資訊數量*不*停用。</span><span class="sxs-lookup"><span data-stu-id="4e309-132">If the user indicates that she can only view and edit a particular supplier, however, then she can only view the details and products for that one supplier and can only update the name and quantity per unit information for those products that are *not* discontinued.</span></span>

<span data-ttu-id="4e309-133">在本教學課程中，我們第一個步驟，則要建立此 DropDownList 並填入供應商中系統中。</span><span class="sxs-lookup"><span data-stu-id="4e309-133">Our first step in this tutorial, then, is to create this DropDownList and populate it with the suppliers in the system.</span></span> <span data-ttu-id="4e309-134">開啟`UserLevelAccess.aspx`頁面中`EditInsertDelete`資料夾中，新增 dropdownlist 進行其`ID`屬性設定為`Suppliers`，並將此 DropDownList 繫結至名為新 ObjectDataSource `AllSuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="4e309-134">Open the `UserLevelAccess.aspx` page in the `EditInsertDelete` folder, add a DropDownList whose `ID` property is set to `Suppliers`, and bind this DropDownList to a new ObjectDataSource named `AllSuppliersDataSource`.</span></span>


<span data-ttu-id="4e309-135">[![建立名為 AllSuppliersDataSource 新 ObjectDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image8.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-135">[![Create a New ObjectDataSource Named AllSuppliersDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image8.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image7.png)</span></span>

<span data-ttu-id="4e309-136">**圖 3**:建立新的 ObjectDataSource 具名`AllSuppliersDataSource`([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-136">**Figure 3**: Create a New ObjectDataSource Named `AllSuppliersDataSource` ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image9.png))</span></span>


<span data-ttu-id="4e309-137">因為我們希望此 DropDownList 以包含所有的供應商，設定要叫用 ObjectDataSource`SuppliersBLL`類別的`GetSuppliers()`方法。</span><span class="sxs-lookup"><span data-stu-id="4e309-137">Since we want this DropDownList to include all suppliers, configure the ObjectDataSource to invoke the `SuppliersBLL` class s `GetSuppliers()` method.</span></span> <span data-ttu-id="4e309-138">也請確認 ObjectDataSource s`Update()`方法會對應至`SuppliersBLL`類別的`UpdateSupplierAddress`方法，為這個 ObjectDataSource 會也可供我們將加入在步驟 2 中 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="4e309-138">Also ensure that the ObjectDataSource s `Update()` method is mapped to the `SuppliersBLL` class s `UpdateSupplierAddress` method, as this ObjectDataSource will also be used by the DetailsView we'll be adding in Step 2.</span></span>

<span data-ttu-id="4e309-139">完成 ObjectDataSource 精靈之後，完成設定步驟`Suppliers`DropDownList，它會顯示`CompanyName`資料欄位，以及使用`SupplierID`做為每個值的資料欄位`ListItem`。</span><span class="sxs-lookup"><span data-stu-id="4e309-139">After completing the ObjectDataSource wizard, complete the steps by configuring the `Suppliers` DropDownList such that it shows the `CompanyName` data field and uses the `SupplierID` data field as the value for each `ListItem`.</span></span>


<span data-ttu-id="4e309-140">[![設定供應商 DropDownList 以使用 [CompanyName] 和 SupplierID 資料欄位](limiting-data-modification-functionality-based-on-the-user-vb/_static/image11.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-140">[![Configure the Suppliers DropDownList to Use the CompanyName and SupplierID Data Fields](limiting-data-modification-functionality-based-on-the-user-vb/_static/image11.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image10.png)</span></span>

<span data-ttu-id="4e309-141">**圖 4**:設定`Suppliers`使用 DropDownList`CompanyName`並`SupplierID`資料欄位 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-141">**Figure 4**: Configure the `Suppliers` DropDownList to Use the `CompanyName` and `SupplierID` Data Fields ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image12.png))</span></span>


<span data-ttu-id="4e309-142">此時，DropDownList 列出資料庫中的供應商的公司名稱。</span><span class="sxs-lookup"><span data-stu-id="4e309-142">At this point, the DropDownList lists the company names of the suppliers in the database.</span></span> <span data-ttu-id="4e309-143">不過，我們也必須包含 DropDownList"Show/編輯所有供應商 」 選項。</span><span class="sxs-lookup"><span data-stu-id="4e309-143">However, we also need to include a "Show/Edit ALL Suppliers" option to the DropDownList.</span></span> <span data-ttu-id="4e309-144">若要達成此目的，將`Suppliers`DropDownList s`AppendDataBoundItems`屬性設`true`，然後加入`ListItem`其`Text`屬性是 「 Show/編輯所有供應商 」，而其值為`-1`。</span><span class="sxs-lookup"><span data-stu-id="4e309-144">To accomplish this, set the `Suppliers` DropDownList s `AppendDataBoundItems` property to `true` and then add a `ListItem` whose `Text` property is "Show/Edit ALL Suppliers" and whose value is `-1`.</span></span> <span data-ttu-id="4e309-145">這可以加入直接透過宣告式標記，或透過設計工具移至 [屬性] 視窗，然後按一下省略符號，DropDownList 的`Items`屬性。</span><span class="sxs-lookup"><span data-stu-id="4e309-145">This can be added directly through the declarative markup or through the Designer by going to the Properties window and clicking on the ellipses in the DropDownList s `Items` property.</span></span>

> [!NOTE]
> <span data-ttu-id="4e309-146">回頭[*主版/詳細篩選使用 DropDownList* ](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md)教學課程，如需將所有選取的項目加入資料繫結 DropDownList 的更詳細討論。</span><span class="sxs-lookup"><span data-stu-id="4e309-146">Refer back to the [*Master/Detail Filtering With a DropDownList*](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial for a more detailed discussion on adding a Select All item to a databound DropDownList.</span></span>


<span data-ttu-id="4e309-147">在後`AppendDataBoundItems`屬性已設定和`ListItem`新增，DropDownList s 宣告式標記看起來應該像：</span><span class="sxs-lookup"><span data-stu-id="4e309-147">After the `AppendDataBoundItems` property has been set and the `ListItem` added, the DropDownList s declarative markup should look like:</span></span>


[!code-aspx[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample1.aspx)]

<span data-ttu-id="4e309-148">透過瀏覽器檢視時，圖 5 顯示我們目前的進度的螢幕擷取畫面。</span><span class="sxs-lookup"><span data-stu-id="4e309-148">Figure 5 shows a screen shot of our current progress, when viewed through a browser.</span></span>


<span data-ttu-id="4e309-149">[![供應商 DropDownList 所有清單項目，再加上另一個用於每個供應商，包含顯示](limiting-data-modification-functionality-based-on-the-user-vb/_static/image14.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-149">[![The Suppliers DropDownList Contains a Show ALL ListItem, Plus One for Each Supplier](limiting-data-modification-functionality-based-on-the-user-vb/_static/image14.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image13.png)</span></span>

<span data-ttu-id="4e309-150">**圖 5**:`Suppliers` DropDownList 包含顯示所有`ListItem`，再加上一個每個供應商 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-150">**Figure 5**: The `Suppliers` DropDownList Contains a Show ALL `ListItem`, Plus One for Each Supplier ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image15.png))</span></span>


<span data-ttu-id="4e309-151">因為我們想要使用者已變更其選取項目之後，立即更新的使用者介面，設定`Suppliers`DropDownList s`AutoPostBack`屬性設`true`。</span><span class="sxs-lookup"><span data-stu-id="4e309-151">Since we want to update the user interface immediately after the user has changed their selection, set the `Suppliers` DropDownList s `AutoPostBack` property to `true`.</span></span> <span data-ttu-id="4e309-152">在步驟 2 中，我們將建立會顯示的資訊取決於選擇的 DropDownList supplier(s) DetailsView 控制項。</span><span class="sxs-lookup"><span data-stu-id="4e309-152">In Step 2 we'll create a DetailsView control that will show the information for the supplier(s) based on the DropDownList selection.</span></span> <span data-ttu-id="4e309-153">接著，在步驟 3 中，我們要建立這個 DropDownList s 的事件處理常式`SelectedIndexChanged`事件，在其中我們將新增 DetailsView 所繫結的適當供應商資訊的程式碼會根據選取的供應商。</span><span class="sxs-lookup"><span data-stu-id="4e309-153">Then, in Step 3, we'll create an event handler for this DropDownList s `SelectedIndexChanged` event, in which we'll add code that binds the appropriate supplier information to the DetailsView based upon the selected supplier.</span></span>

## <a name="step-2-adding-a-detailsview-control"></a><span data-ttu-id="4e309-154">步驟 2：加入 DetailsView 控制項</span><span class="sxs-lookup"><span data-stu-id="4e309-154">Step 2: Adding a DetailsView Control</span></span>

<span data-ttu-id="4e309-155">可讓 s 使用 DetailsView 來顯示供應商的資訊。</span><span class="sxs-lookup"><span data-stu-id="4e309-155">Let s use a DetailsView to show supplier information.</span></span> <span data-ttu-id="4e309-156">可以檢視和編輯所有供應商的使用者，DetailsView 會支援分頁，讓使用者能夠一次逐步供應商資訊一筆記錄。</span><span class="sxs-lookup"><span data-stu-id="4e309-156">For the user who can view and edit all suppliers, the DetailsView will support paging, allowing the user to step through the supplier information one record at a time.</span></span> <span data-ttu-id="4e309-157">如果使用者適用於特定的供應商，DetailsView 會顯示該特定供應商的資訊但不會包含分頁介面。</span><span class="sxs-lookup"><span data-stu-id="4e309-157">If the user works for a particular supplier, however, the DetailsView will show only that particular supplier s information and will not include a paging interface.</span></span> <span data-ttu-id="4e309-158">在任一情況下，DetailsView 需要允許使用者編輯供應商的地址、 城市和國家/地區欄位。</span><span class="sxs-lookup"><span data-stu-id="4e309-158">In either case, the DetailsView needs to allow the user to edit the supplier s address, city, and country fields.</span></span>

<span data-ttu-id="4e309-159">加入下方網頁的 DetailsView`Suppliers`下拉式清單中，設定其`ID`屬性設`SupplierDetails`，並將它繫結`AllSuppliersDataSource`上一個步驟中建立的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="4e309-159">Add a DetailsView to the page beneath the `Suppliers` DropDownList, set its `ID` property to `SupplierDetails`, and bind it to the `AllSuppliersDataSource` ObjectDataSource created in the previous step.</span></span> <span data-ttu-id="4e309-160">接下來，核取方塊啟用分頁，以及啟用編輯從 DetailsView s 智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="4e309-160">Next, check the Enable Paging and Enable Editing checkboxes from the DetailsView s smart tag.</span></span>

> [!NOTE]
> <span data-ttu-id="4e309-161">如果您不要看到智慧 DetailsView s 中的 [啟用編輯] 選項加以標記 s 因為未對應的 ObjectDataSource 秒`Update()`方法，以`SuppliersBLL`類別的`UpdateSupplierAddress`方法。</span><span class="sxs-lookup"><span data-stu-id="4e309-161">If you don t see an Enable Editing option in the DetailsView s smart tag it s because you did not map the ObjectDataSource s `Update()` method to the `SuppliersBLL` class s `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="4e309-162">請花一點時間返回再做此變更之後，[啟用編輯] 選項應該會出現在 DetailsView s 智慧標籤的設定。</span><span class="sxs-lookup"><span data-stu-id="4e309-162">Take a moment to go back and make this configuration change, after which the Enable Editing option should appear in the DetailsView s smart tag.</span></span>


<span data-ttu-id="4e309-163">由於`SuppliersBLL`類別 s`UpdateSupplierAddress`方法只會接受四個參數- `supplierID`， `address`， `city`，和`country`-修改 DetailsView 的 BoundFields 以便`CompanyName`和`Phone`BoundFields 處於唯讀狀態。</span><span class="sxs-lookup"><span data-stu-id="4e309-163">Since the `SuppliersBLL` class s `UpdateSupplierAddress` method only accepts four parameters - `supplierID`, `address`, `city`, and `country` - modify the DetailsView s BoundFields so that the `CompanyName` and `Phone` BoundFields are read-only.</span></span> <span data-ttu-id="4e309-164">此外，移除`SupplierID`BoundField 完全。</span><span class="sxs-lookup"><span data-stu-id="4e309-164">Additionally, remove the `SupplierID` BoundField altogether.</span></span> <span data-ttu-id="4e309-165">最後， `AllSuppliersDataSource` ObjectDataSource 目前有其`OldValuesParameterFormatString`屬性設定為`original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="4e309-165">Finally, the `AllSuppliersDataSource` ObjectDataSource currently has its `OldValuesParameterFormatString` property set to `original_{0}`.</span></span> <span data-ttu-id="4e309-166">花點時間從宣告式語法完全移除此屬性設定值，或將它設定為預設值， `{0}`。</span><span class="sxs-lookup"><span data-stu-id="4e309-166">Take a moment to remove this property setting from the declarative syntax altogether, or set it to the default value, `{0}`.</span></span>

<span data-ttu-id="4e309-167">在設定後`SupplierDetails`DetailsView 和`AllSuppliersDataSource`ObjectDataSource，我們會有下列的宣告式標記：</span><span class="sxs-lookup"><span data-stu-id="4e309-167">After configuring the `SupplierDetails` DetailsView and `AllSuppliersDataSource` ObjectDataSource, we will have the following declarative markup:</span></span>


[!code-aspx[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample2.aspx)]

<span data-ttu-id="4e309-168">DetailsView 此時可以透過分頁，而且選取的供應商的位址資訊可以更新，不論所做的選擇`Suppliers`DropDownList （請參閱 圖 6）。</span><span class="sxs-lookup"><span data-stu-id="4e309-168">At this point the DetailsView can be paged through and the selected supplier s address information can be updated, regardless of the selection made in the `Suppliers` DropDownList (see Figure 6).</span></span>


<span data-ttu-id="4e309-169">[![您可以檢視任何供應商資訊，並更新其位址](limiting-data-modification-functionality-based-on-the-user-vb/_static/image17.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-169">[![Any Suppliers Information Can Be Viewed, and Its Address Updated](limiting-data-modification-functionality-based-on-the-user-vb/_static/image17.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image16.png)</span></span>

<span data-ttu-id="4e309-170">**圖 6**:供應商可以檢視資訊，並更新其位址 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-170">**Figure 6**: Any Suppliers Information Can Be Viewed, and Its Address Updated ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image18.png))</span></span>


## <a name="step-3-displaying-only-the-selected-supplier-s-information"></a><span data-ttu-id="4e309-171">步驟 3：顯示只將所選的供應商的資訊</span><span class="sxs-lookup"><span data-stu-id="4e309-171">Step 3: Displaying Only the Selected Supplier s Information</span></span>

<span data-ttu-id="4e309-172">我們的頁面目前顯示的所有供應商，不論是否已從選取的特定供應商資訊`Suppliers`DropDownList。</span><span class="sxs-lookup"><span data-stu-id="4e309-172">Our page currently displays the information for all suppliers regardless of whether a particular supplier has been selected from the `Suppliers` DropDownList.</span></span> <span data-ttu-id="4e309-173">若要顯示供應商資訊所選的供應商我們要將另一個的 ObjectDataSource 新增至我們的頁面上，它會擷取特定的供應商的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="4e309-173">In order to display just the supplier information for the selected supplier we need to add another ObjectDataSource to our page, one that retrieves information about a particular supplier.</span></span>

<span data-ttu-id="4e309-174">加入新的 ObjectDataSource 頁面上，將它命名為`SingleSupplierDataSource`。</span><span class="sxs-lookup"><span data-stu-id="4e309-174">Add a new ObjectDataSource to the page, naming it `SingleSupplierDataSource`.</span></span> <span data-ttu-id="4e309-175">從它的智慧標籤，按一下 設定資料來源連結，讓它使用`SuppliersBLL`類別的`GetSupplierBySupplierID(supplierID)`方法。</span><span class="sxs-lookup"><span data-stu-id="4e309-175">From its smart tag, click the Configure Data Source link and have it use the `SuppliersBLL` class s `GetSupplierBySupplierID(supplierID)` method.</span></span> <span data-ttu-id="4e309-176">如同`AllSuppliersDataSource`ObjectDataSource，具有`SingleSupplierDataSource`ObjectDataSource s`Update()`方法對應至`SuppliersBLL`類別的`UpdateSupplierAddress`方法。</span><span class="sxs-lookup"><span data-stu-id="4e309-176">As with the `AllSuppliersDataSource` ObjectDataSource, have the `SingleSupplierDataSource` ObjectDataSource s `Update()` method mapped to the `SuppliersBLL` class s `UpdateSupplierAddress` method.</span></span>


<span data-ttu-id="4e309-177">[![設定為使用 GetSupplierBySupplierID(supplierID) 方法 SingleSupplierDataSource ObjectDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image20.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-177">[![Configure the SingleSupplierDataSource ObjectDataSource to Use the GetSupplierBySupplierID(supplierID) Method](limiting-data-modification-functionality-based-on-the-user-vb/_static/image20.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image19.png)</span></span>

<span data-ttu-id="4e309-178">**圖 7**:設定`SingleSupplierDataSource`使用 ObjectDataSource`GetSupplierBySupplierID(supplierID)`方法 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-178">**Figure 7**: Configure the `SingleSupplierDataSource` ObjectDataSource to Use the `GetSupplierBySupplierID(supplierID)` Method ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image21.png))</span></span>


<span data-ttu-id="4e309-179">接下來，我們重新提示您指定的參數來源`GetSupplierBySupplierID(supplierID)`方法的`supplierID`輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="4e309-179">Next, we re prompted to specify the parameter source for the `GetSupplierBySupplierID(supplierID)` method s `supplierID` input parameter.</span></span> <span data-ttu-id="4e309-180">因為我們想要顯示的資訊，從下拉式清單中，使用選取的供應商`Suppliers`DropDownList 的`SelectedValue`做為參數來源屬性。</span><span class="sxs-lookup"><span data-stu-id="4e309-180">Since we want to show the information for the supplier selected from the DropDownList, use the `Suppliers` DropDownList s `SelectedValue` property as the parameter source.</span></span>


<span data-ttu-id="4e309-181">[![供應商 DropDownList 做 supplierID 參數來源](limiting-data-modification-functionality-based-on-the-user-vb/_static/image23.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-181">[![Use the Suppliers DropDownList as the supplierID Parameter Source](limiting-data-modification-functionality-based-on-the-user-vb/_static/image23.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image22.png)</span></span>

<span data-ttu-id="4e309-182">**圖 8**:使用`Suppliers`做為 DropDownList`supplierID`參數的來源 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-182">**Figure 8**: Use the `Suppliers` DropDownList as the `supplierID` Parameter Source ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image24.png))</span></span>


<span data-ttu-id="4e309-183">新增第二個 ObjectDataSource，即使有了 DetailsView 控制項目前設定為一律使用`AllSuppliersDataSource`ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="4e309-183">Even with this second ObjectDataSource added, the DetailsView control is currently configured to always use the `AllSuppliersDataSource` ObjectDataSource.</span></span> <span data-ttu-id="4e309-184">我們需要加入邏輯，以調整 DetailsView 取決於所使用的資料來源`Suppliers`選取 DropDownList 項目。</span><span class="sxs-lookup"><span data-stu-id="4e309-184">We need to add logic to adjust the data source used by the DetailsView depending on the `Suppliers` DropDownList item selected.</span></span> <span data-ttu-id="4e309-185">若要達成此目的，建立`SelectedIndexChanged`供應商 DropDownList 的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="4e309-185">To accomplish this, create a `SelectedIndexChanged` event handler for the Suppliers DropDownList.</span></span> <span data-ttu-id="4e309-186">這最容易建立按兩下設計工具中的 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="4e309-186">This can most easily be created by double-clicking the DropDownList in the Designer.</span></span> <span data-ttu-id="4e309-187">這個事件處理常式必須決定要使用哪些資料來源，且必須重新繫結至 DetailsView 資料。</span><span class="sxs-lookup"><span data-stu-id="4e309-187">This event handler needs to determine what data source to use and must rebind the data to the DetailsView.</span></span> <span data-ttu-id="4e309-188">這是由下列程式碼來完成：</span><span class="sxs-lookup"><span data-stu-id="4e309-188">This is accomplished with the following code:</span></span>


[!code-vb[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample3.vb)]

<span data-ttu-id="4e309-189">事件處理常式一開始會判斷是否已選取 "Show/編輯所有供應商 」 選項。</span><span class="sxs-lookup"><span data-stu-id="4e309-189">The event handler begins by determining whether the "Show/Edit ALL Suppliers" option was selected.</span></span> <span data-ttu-id="4e309-190">如果是，它會設定`SupplierDetails`DetailsView s`DataSourceID`要`AllSuppliersDataSource`並傳回給供應商的集合中第一筆記錄的使用者，藉由設定`PageIndex`屬性設為 0。</span><span class="sxs-lookup"><span data-stu-id="4e309-190">If it was, it sets the `SupplierDetails` DetailsView s `DataSourceID` to `AllSuppliersDataSource` and returns the user to the first record in the set of suppliers by setting the `PageIndex` property to 0.</span></span> <span data-ttu-id="4e309-191">如果使用者不過，從下拉式清單中，在 DetailsView s 選取特定的供應商`DataSourceID`指派給`SingleSuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="4e309-191">If, however, the user has selected a particular supplier from the DropDownList, the DetailsView s `DataSourceID` is assigned to `SingleSuppliersDataSource`.</span></span> <span data-ttu-id="4e309-192">無論何種資料來源使用，`SuppliersDetails`模式會還原回唯讀模式，且資料會重新繫結至 DetailsView 藉由呼叫`SuppliersDetails`控制的`DataBind()`方法。</span><span class="sxs-lookup"><span data-stu-id="4e309-192">Regardless of what data source is used, the `SuppliersDetails` mode is reverted back to the read-only mode and the data is rebound to the DetailsView by a call to the `SuppliersDetails` control s `DataBind()` method.</span></span>

<span data-ttu-id="4e309-193">使用就地這個事件處理常式，DetailsView 控制項現在會顯示所選的供應商，除非已選取"Show/編輯所有供應商 」 選項，在此情況下檢視所有的供應商透過分頁介面。</span><span class="sxs-lookup"><span data-stu-id="4e309-193">With this event handler in place, the DetailsView control now shows the selected supplier, unless the "Show/Edit ALL Suppliers" option was selected, in which case all of the suppliers can be viewed through the paging interface.</span></span> <span data-ttu-id="4e309-194">圖 9 顯示的頁面為"Show/編輯所有供應商 」 選項;請注意，分頁介面，讓使用者能夠瀏覽，並更新任何供應商。</span><span class="sxs-lookup"><span data-stu-id="4e309-194">Figure 9 shows the page with the "Show/Edit ALL Suppliers" option selected; note that the paging interface is present, allowing the user to visit and update any supplier.</span></span> <span data-ttu-id="4e309-195">圖 10 顯示頁面選取錦供應商。</span><span class="sxs-lookup"><span data-stu-id="4e309-195">Figure 10 shows the page with the Ma Maison supplier selected.</span></span> <span data-ttu-id="4e309-196">錦的資訊會在此情況下是可檢視和編輯。</span><span class="sxs-lookup"><span data-stu-id="4e309-196">Only Ma Maison s information is viewable and editable in this case.</span></span>


<span data-ttu-id="4e309-197">[![所有的供應商資訊可以檢視和編輯](limiting-data-modification-functionality-based-on-the-user-vb/_static/image26.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-197">[![All of the Suppliers Information Can Be Viewed and Edited](limiting-data-modification-functionality-based-on-the-user-vb/_static/image26.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image25.png)</span></span>

<span data-ttu-id="4e309-198">**圖 9**:所有的供應商資訊檢視和編輯 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-198">**Figure 9**: All of the Suppliers Information Can Be Viewed and Edited ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image27.png))</span></span>


<span data-ttu-id="4e309-199">[![只有選取的供應商的資訊可以檢視和編輯](limiting-data-modification-functionality-based-on-the-user-vb/_static/image29.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-199">[![Only the Selected Supplier s Information Can Be Viewed and Edited](limiting-data-modification-functionality-based-on-the-user-vb/_static/image29.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image28.png)</span></span>

<span data-ttu-id="4e309-200">**圖 10**:只有選取的供應商 s 資訊可以是 Viewed 並編輯 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-200">**Figure 10**: Only the Selected Supplier s Information Can Be Viewed and Edited ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image30.png))</span></span>


> [!NOTE]
> <span data-ttu-id="4e309-201">本教學課程中，在 DropDownList 和 DetailsView 控制項 s`EnableViewState`必須設為`true`（預設值） 因為 DropDownList s`SelectedIndex`和 DetailsView 的`DataSourceID`屬性的變更必須記住在回傳之間。</span><span class="sxs-lookup"><span data-stu-id="4e309-201">For this tutorial, both the DropDownList and DetailsView control s `EnableViewState` must be set to `true` (the default) because the DropDownList s `SelectedIndex` and the DetailsView s `DataSourceID` property s changes must be remembered across postbacks.</span></span>


## <a name="step-4-listing-the-suppliers-products-in-an-editable-gridview"></a><span data-ttu-id="4e309-202">步驟 4：列出供應商產品的可編輯的 GridView</span><span class="sxs-lookup"><span data-stu-id="4e309-202">Step 4: Listing the Suppliers Products in an Editable GridView</span></span>

<span data-ttu-id="4e309-203">完成 DetailsView 中，我們下一步是要包含可編輯的 GridView 會列出所選取的供應商提供這些產品。</span><span class="sxs-lookup"><span data-stu-id="4e309-203">With the DetailsView complete, our next step is to include an editable GridView that lists those products provided by the selected supplier.</span></span> <span data-ttu-id="4e309-204">此 GridView 應該允許編輯為僅限`ProductName`和`QuantityPerUnit`欄位。</span><span class="sxs-lookup"><span data-stu-id="4e309-204">This GridView should allow edits to only the `ProductName` and `QuantityPerUnit` fields.</span></span> <span data-ttu-id="4e309-205">此外，如果使用者瀏覽的頁面是來自特定供應商，它應該只允許這些產品的更新*不*停用。</span><span class="sxs-lookup"><span data-stu-id="4e309-205">Moreover, if the user visiting the page is from a particular supplier, it should only allow updates to those products that are *not* discontinued.</span></span> <span data-ttu-id="4e309-206">若要這麼做我們需要先將新增的多載`ProductsBLL`類別 s`UpdateProducts`採用的方法只`ProductID`， `ProductName`，和`QuantityPerUnit`做為輸入的欄位。</span><span class="sxs-lookup"><span data-stu-id="4e309-206">To accomplish this we'll need to first add an overload of the `ProductsBLL` class s `UpdateProducts` method that takes in just the `ProductID`, `ProductName`, and `QuantityPerUnit` fields as inputs.</span></span> <span data-ttu-id="4e309-207">我們已事先在許多教學課程中，會逐步執行此程序讓 s 不妨看看程式碼，應該會加入到`ProductsBLL`:</span><span class="sxs-lookup"><span data-stu-id="4e309-207">We ve stepped through this process beforehand in numerous tutorials, so let s just look at the code here, which should be added to `ProductsBLL`:</span></span>


[!code-vb[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample4.vb)]

<span data-ttu-id="4e309-208">使用這個多載建立，我們準備好將 GridView 控制項和其相關聯的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="4e309-208">With this overload created, we re ready to add the GridView control and its associated ObjectDataSource.</span></span> <span data-ttu-id="4e309-209">新增至頁面的新 GridView、 設定其`ID`屬性，以`ProductsBySupplier`，並將它設定為使用名為新 ObjectDataSource `ProductsBySupplierDataSource`。</span><span class="sxs-lookup"><span data-stu-id="4e309-209">Add a new GridView to the page, set its `ID` property to `ProductsBySupplier`, and configure it to use a new ObjectDataSource named `ProductsBySupplierDataSource`.</span></span> <span data-ttu-id="4e309-210">因為我們希望此 GridView，以列出所選的供應商提供的這些產品時，使用`ProductsBLL`類別的`GetProductsBySupplierID(supplierID)`方法。</span><span class="sxs-lookup"><span data-stu-id="4e309-210">Since we want this GridView to list those products by the selected supplier, use the `ProductsBLL` class s `GetProductsBySupplierID(supplierID)` method.</span></span> <span data-ttu-id="4e309-211">也將對應`Update()`方法，以新`UpdateProduct`我們剛剛建立的多載。</span><span class="sxs-lookup"><span data-stu-id="4e309-211">Also map the `Update()` method to the new `UpdateProduct` overload we just created.</span></span>


<span data-ttu-id="4e309-212">[![設定要使用剛才建立的 UpdateProduct 多載 ObjectDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image32.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-212">[![Configure the ObjectDataSource to Use the UpdateProduct Overload Just Created](limiting-data-modification-functionality-based-on-the-user-vb/_static/image32.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image31.png)</span></span>

<span data-ttu-id="4e309-213">**圖 11**:設定要使用 ObjectDataSource`UpdateProduct`多載只會建立 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-213">**Figure 11**: Configure the ObjectDataSource to Use the `UpdateProduct` Overload Just Created ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image33.png))</span></span>


<span data-ttu-id="4e309-214">我們重新提示您選取參數的來源`GetProductsBySupplierID(supplierID)`方法的`supplierID`輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="4e309-214">We re prompted to select the parameter source for the `GetProductsBySupplierID(supplierID)` method s `supplierID` input parameter.</span></span> <span data-ttu-id="4e309-215">因為我們想要顯示的產品中使用 DetailsView 選取供應商`SuppliersDetails`DetailsView 控制項的`SelectedValue`做為參數來源屬性。</span><span class="sxs-lookup"><span data-stu-id="4e309-215">Since we want to show the products for the supplier selected in the DetailsView, use the `SuppliersDetails` DetailsView control s `SelectedValue` property as the parameter source.</span></span>


<span data-ttu-id="4e309-216">[![SuppliersDetails DetailsView 的 SelectedValue 屬性做為參數來源](limiting-data-modification-functionality-based-on-the-user-vb/_static/image35.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-216">[![Use the SuppliersDetails DetailsView s SelectedValue Property as the Parameter Source](limiting-data-modification-functionality-based-on-the-user-vb/_static/image35.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image34.png)</span></span>

<span data-ttu-id="4e309-217">**圖 12**:使用`SuppliersDetails`DetailsView s`SelectedValue`做為參數來源屬性 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-217">**Figure 12**: Use the `SuppliersDetails` DetailsView s `SelectedValue` Property as the Parameter Source ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image36.png))</span></span>


<span data-ttu-id="4e309-218">傳回至 GridView，移除所有的 GridView 欄位除外`ProductName`， `QuantityPerUnit`，並`Discontinued`標記、 `Discontinued` CheckBoxField 以唯讀模式。</span><span class="sxs-lookup"><span data-stu-id="4e309-218">Returning to the GridView, remove all of the GridView fields except for `ProductName`, `QuantityPerUnit`, and `Discontinued`, marking the `Discontinued` CheckBoxField as read-only.</span></span> <span data-ttu-id="4e309-219">此外，檢查 GridView s 智慧標籤的 啟用編輯選項。</span><span class="sxs-lookup"><span data-stu-id="4e309-219">Also, check the Enable Editing option from the GridView s smart tag.</span></span> <span data-ttu-id="4e309-220">在進行這些變更之後，GridView 和 ObjectDataSource 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="4e309-220">After these changes have been made, the declarative markup for the GridView and ObjectDataSource should look similar to the following:</span></span>


[!code-aspx[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample5.aspx)]

<span data-ttu-id="4e309-221">如同我們先前的 ObjectDataSources，此一 s`OldValuesParameterFormatString`屬性設定為`original_{0}`，當您嘗試更新產品的名稱或每個單位的數量時，這樣將會造成問題。</span><span class="sxs-lookup"><span data-stu-id="4e309-221">As with our previous ObjectDataSources, this one s `OldValuesParameterFormatString` property is set to `original_{0}`, which will cause problems when attempting to update a product s name or quantity per unit.</span></span> <span data-ttu-id="4e309-222">從宣告式語法中完全移除此屬性，或將它設定為其預設`{0}`。</span><span class="sxs-lookup"><span data-stu-id="4e309-222">Remove this property from the declarative syntax altogether or set it to its default, `{0}`.</span></span>

<span data-ttu-id="4e309-223">此設定完成後，我們的頁面現在會列出在 GridView 中選取的供應商所提供的產品 （請參閱 圖 13）。</span><span class="sxs-lookup"><span data-stu-id="4e309-223">With this configuration complete, our page now lists the products provided by the supplier selected in the GridView (see Figure 13).</span></span> <span data-ttu-id="4e309-224">目前*任何*可以更新產品的名稱或每個單位的數量。</span><span class="sxs-lookup"><span data-stu-id="4e309-224">Currently *any* product s name or quantity per unit can be updated.</span></span> <span data-ttu-id="4e309-225">不過，我們需要更新我們的網頁邏輯，使這類功能禁止使用的特定供應商相關聯的使用者不再生產的產品。</span><span class="sxs-lookup"><span data-stu-id="4e309-225">However, we need to update our page logic so that such functionality is prohibited for discontinued products for users associated with a particular supplier.</span></span> <span data-ttu-id="4e309-226">我們將會處理在步驟 5 中的這個最後一個片段。</span><span class="sxs-lookup"><span data-stu-id="4e309-226">We'll tackle this final piece in Step 5.</span></span>


<span data-ttu-id="4e309-227">[![顯示所選取的供應商提供的產品](limiting-data-modification-functionality-based-on-the-user-vb/_static/image38.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-227">[![The Products Provided by the Selected Supplier are Displayed](limiting-data-modification-functionality-based-on-the-user-vb/_static/image38.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image37.png)</span></span>

<span data-ttu-id="4e309-228">**圖 13**:顯示所選取的供應商提供的產品 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-228">**Figure 13**: The Products Provided by the Selected Supplier are Displayed ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image39.png))</span></span>


> [!NOTE]
> <span data-ttu-id="4e309-229">加上此可編輯的 GridView `Suppliers` DropDownList 的`SelectedIndexChanged`應該更新事件處理常式，以恢復 GridView 唯讀狀態。</span><span class="sxs-lookup"><span data-stu-id="4e309-229">With the addition of this editable GridView the `Suppliers` DropDownList s `SelectedIndexChanged` event handler should be updated to return the GridView to a read-only state.</span></span> <span data-ttu-id="4e309-230">否則如果仍執行時編輯產品資訊中選取不同的供應商，則在新的供應商的 GridView 中對應的索引也會可編輯。</span><span class="sxs-lookup"><span data-stu-id="4e309-230">Otherwise, if a different supplier is selected while in the middle of editing product information, the corresponding index in the GridView for the new supplier will also be editable.</span></span> <span data-ttu-id="4e309-231">若要避免這個問題，請設定 GridView s`EditIndex`屬性，以`-1`在`SelectedIndexChanged`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="4e309-231">To prevent this, simply set the GridView s `EditIndex` property to `-1` in the `SelectedIndexChanged` event handler.</span></span>


<span data-ttu-id="4e309-232">此外，您應該記得，是很重要的 GridView 的檢視狀態是已啟用 （預設行為）。</span><span class="sxs-lookup"><span data-stu-id="4e309-232">Also, recall that it is important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="4e309-233">如果您將設定 GridView s`EnableViewState`屬性設`false`，執行並行的使用者不小心刪除或編輯記錄的風險。</span><span class="sxs-lookup"><span data-stu-id="4e309-233">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="4e309-234">請參閱[警告：並行處理問題與 ASP.NET 2.0 Gridview/DetailsView/FormViews 該支援編輯和/或刪除和的檢視狀態已停用](http://scottonwriting.net/sowblog/posts/10054.aspx)如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="4e309-234">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>

## <a name="step-5-disallow-editing-for-discontinued-products-when-showedit-all-suppliers-is-not-selected"></a><span data-ttu-id="4e309-235">步驟 5：不允許編輯，已停止的產品時顯示或編輯所有供應商是未選取</span><span class="sxs-lookup"><span data-stu-id="4e309-235">Step 5: Disallow Editing for Discontinued Products When Show/Edit ALL Suppliers is Not Selected</span></span>

<span data-ttu-id="4e309-236">雖然`ProductsBySupplier`GridView 會正常運作，其目前授與過多存取來自特定供應商的使用者。</span><span class="sxs-lookup"><span data-stu-id="4e309-236">While the `ProductsBySupplier` GridView is fully functional, it currently grants too much access to those users who are from a particular supplier.</span></span> <span data-ttu-id="4e309-237">根據我們的商務規則，這類使用者應該無法更新已停止的產品。</span><span class="sxs-lookup"><span data-stu-id="4e309-237">Per our business rules, such users should not be able to update discontinued products.</span></span> <span data-ttu-id="4e309-238">若要強制這種情況，我們可以隱藏 （或停用） 已停止的產品時所瀏覽頁面時由使用者從供應商的 GridView 資料列的 [編輯] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="4e309-238">To enforce this, we can hide (or disable) the Edit button in those GridView rows with discontinued products when the page is being visited by a user from a supplier.</span></span>

<span data-ttu-id="4e309-239">建立事件處理常式 GridView s`RowDataBound`事件。</span><span class="sxs-lookup"><span data-stu-id="4e309-239">Create an event handler for the GridView s `RowDataBound` event.</span></span> <span data-ttu-id="4e309-240">這個事件處理常式中，我們需要判斷使用者是否為特定的供應商，而這，本教學課程中，可決定藉由檢查供應商 DropDownList s 相關聯`SelectedValue`屬性--如果它是 s 以外的項目-1，則使用者相關聯的特定供應商。</span><span class="sxs-lookup"><span data-stu-id="4e309-240">In this event handler we need to determine whether or not the user is associated with a particular supplier, which, for this tutorial, can be determined by checking the Suppliers DropDownList s `SelectedValue` property - if it s something other than -1, then the user is associated with a particular supplier.</span></span> <span data-ttu-id="4e309-241">這類使用者，我們再需要判斷產品已停止。</span><span class="sxs-lookup"><span data-stu-id="4e309-241">For such users, we then need to determine whether or not the product is discontinued.</span></span> <span data-ttu-id="4e309-242">我們可以擷取參考的實際`ProductRow`執行個體繫結至 GridView 資料列，透過`e.Row.DataItem`屬性中所述[ *GridView s 頁尾顯示摘要資訊*](../custom-formatting/displaying-summary-information-in-the-gridview-s-footer-vb.md)本教學課程。</span><span class="sxs-lookup"><span data-stu-id="4e309-242">We can grab a reference to the actual `ProductRow` instance bound to the GridView row via the `e.Row.DataItem` property, as discussed in the [*Displaying Summary Information in the GridView s Footer*](../custom-formatting/displaying-summary-information-in-the-gridview-s-footer-vb.md) tutorial.</span></span> <span data-ttu-id="4e309-243">如果產品已經停售，我們可以抓取 GridView s CommandField 使用先前的教學課程中討論的技術中的 [編輯] 按鈕的程式設計參考[*新增用戶端確認時刪除*](adding-client-side-confirmation-when-deleting-vb.md).</span><span class="sxs-lookup"><span data-stu-id="4e309-243">If the product is discontinued, we can grab a programmatic reference to the Edit button in the GridView s CommandField using the techniques discussed in the previous tutorial, [*Adding Client-Side Confirmation When Deleting*](adding-client-side-confirmation-when-deleting-vb.md).</span></span> <span data-ttu-id="4e309-244">一旦我們擁有我們再以隱藏或停用按鈕的參考。</span><span class="sxs-lookup"><span data-stu-id="4e309-244">Once we have a reference we can then hide or disable the button.</span></span>


[!code-vb[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample6.vb)]

<span data-ttu-id="4e309-245">與這個事件處理常式的位置，當瀏覽此頁面的使用者身分從特定的供應商已停用這些產品都不是可編輯的為 [編輯] 按鈕會隱藏這些產品。</span><span class="sxs-lookup"><span data-stu-id="4e309-245">With this event handler in place, when visiting this page as a user from a specific supplier those products that are discontinued are not editable, as the Edit button is hidden for these products.</span></span> <span data-ttu-id="4e309-246">比方說，Chef Anton 的 Gumbo 混合是紐奧良印地安 Delights 供應商停產的產品。</span><span class="sxs-lookup"><span data-stu-id="4e309-246">For example, Chef Anton s Gumbo Mix is a discontinued product for the New Orleans Cajun Delights supplier.</span></span> <span data-ttu-id="4e309-247">當這個特定的供應商，瀏覽的頁面，此產品的 編輯 按鈕隱藏看不到 （請參閱 圖 14）。</span><span class="sxs-lookup"><span data-stu-id="4e309-247">When visiting the page for this particular supplier, the Edit button for this product is hidden from sight (see Figure 14).</span></span> <span data-ttu-id="4e309-248">不過，瀏覽時使用 「 顯示或編輯所有供應商 」，編輯 按鈕會是 可用 （請參閱 圖 15）。</span><span class="sxs-lookup"><span data-stu-id="4e309-248">However, when visiting using the "Show/Edit ALL Suppliers," the Edit button is available (see Figure 15).</span></span>


<span data-ttu-id="4e309-249">[![Chef Anton s Gumbo 混用 [編輯] 按鈕會隱藏特定供應商的使用者](limiting-data-modification-functionality-based-on-the-user-vb/_static/image41.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-249">[![For Supplier-Specific Users the Edit Button for Chef Anton s Gumbo Mix is Hidden](limiting-data-modification-functionality-based-on-the-user-vb/_static/image41.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image40.png)</span></span>

<span data-ttu-id="4e309-250">**圖 14**:Chef Anton s Gumbo 混用 [編輯] 按鈕會隱藏特定供應商的使用者 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-250">**Figure 14**: For Supplier-Specific Users the Edit Button for Chef Anton s Gumbo Mix is Hidden ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image42.png))</span></span>


<span data-ttu-id="4e309-251">[![Chef Anton s Gumbo 混用 [編輯] 按鈕會顯示所有供應商使用者顯示或編輯，](limiting-data-modification-functionality-based-on-the-user-vb/_static/image44.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="4e309-251">[![For Show/Edit ALL Suppliers Users, the Edit Button for Chef Anton s Gumbo Mix is Displayed](limiting-data-modification-functionality-based-on-the-user-vb/_static/image44.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image43.png)</span></span>

<span data-ttu-id="4e309-252">**圖 15**:會顯示所有供應商使用者顯示或編輯，Chef Anton s Gumbo 混用 [編輯] 按鈕 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="4e309-252">**Figure 15**: For Show/Edit ALL Suppliers Users, the Edit Button for Chef Anton s Gumbo Mix is Displayed ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image45.png))</span></span>


## <a name="checking-for-access-rights-in-the-business-logic-layer"></a><span data-ttu-id="4e309-253">檢查商務邏輯層中的存取權限</span><span class="sxs-lookup"><span data-stu-id="4e309-253">Checking for Access Rights in the Business Logic Layer</span></span>

<span data-ttu-id="4e309-254">在本教學課程的 ASP.NET 頁面可處理使用者可以看到哪些資訊與所有邏輯，而且他可以更新哪些產品。</span><span class="sxs-lookup"><span data-stu-id="4e309-254">In this tutorial the ASP.NET page handles all logic with regards to what information the user can see and what products he can update.</span></span> <span data-ttu-id="4e309-255">在理想情況下，此邏輯也會出現在商業邏輯層。</span><span class="sxs-lookup"><span data-stu-id="4e309-255">Ideally, this logic would also be present at the Business Logic Layer.</span></span> <span data-ttu-id="4e309-256">例如，`SuppliersBLL`類別 s `GetSuppliers()` （它會傳回所有的供應商） 的方法可能會包含檢查，以確保目前登入的使用者*不*特定供應商相關聯。</span><span class="sxs-lookup"><span data-stu-id="4e309-256">For example, the `SuppliersBLL` class s `GetSuppliers()` method (which returns all suppliers) might include a check to ensure that the currently logged on user is *not* associated with a specific supplier.</span></span> <span data-ttu-id="4e309-257">同樣地，`UpdateSupplierAddress`方法可能包括檢查，以確認目前登入的使用者請本公司合作 （並因此可以更新供應商的所有位址資訊） 或其資料正在更新供應商相關聯。</span><span class="sxs-lookup"><span data-stu-id="4e309-257">Likewise, the `UpdateSupplierAddress` method could include a check to ensure that the currently logged on user either worked for our company (and therefore can update all suppliers address information) or is associated with the supplier whose data is being updated.</span></span>

<span data-ttu-id="4e309-258">因為在本教學課程中的使用者 s 權限取決於在頁面上，BLL 類別無法存取 dropdownlist 進行，所以我不包括這類 BLL 層檢查。</span><span class="sxs-lookup"><span data-stu-id="4e309-258">I did not include such BLL-layer checks here because in our tutorial the user s rights are determined by a DropDownList on the page, which the BLL classes cannot access.</span></span> <span data-ttu-id="4e309-259">使用成員資格系統，或其中一個 （例如 Windows 驗證）、 ASP.NET 所提供的方塊外的驗證配置時，目前登上使用者 s 存取資訊和角色資訊可以從 BLL，因此這類存取權權限檢查可能的簡報和 BLL 層級。</span><span class="sxs-lookup"><span data-stu-id="4e309-259">When using the membership system or one of the out-of-the box authentication schemes provided by ASP.NET (such as Windows authentication), the currently logged on user s information and roles information can be accessed from the BLL, thereby making such access rights checks possible at both the presentation and BLL layers.</span></span>

## <a name="summary"></a><span data-ttu-id="4e309-260">總結</span><span class="sxs-lookup"><span data-stu-id="4e309-260">Summary</span></span>

<span data-ttu-id="4e309-261">大部分的網站提供的使用者帳戶需要自訂資料修改介面，根據登入的使用者。</span><span class="sxs-lookup"><span data-stu-id="4e309-261">Most sites that provide user accounts need to customize the data modification interface based upon the logged in user.</span></span> <span data-ttu-id="4e309-262">系統管理使用者可以刪除和編輯任何記錄，而非系統管理使用者可能會限制為僅更新或刪除自己建立的記錄。</span><span class="sxs-lookup"><span data-stu-id="4e309-262">Administrative users may be able to delete and edit any record, whereas non-administrative users may be limited to only updating or deleting records they created themselves.</span></span> <span data-ttu-id="4e309-263">諸如此類的情節可能是的資料 Web 控制項，ObjectDataSource，且商務邏輯層類別可加以擴充，若要新增或拒絕登入的使用者為基礎的特定功能。</span><span class="sxs-lookup"><span data-stu-id="4e309-263">Whatever the scenario may be, the data Web controls, ObjectDataSource, and Business Logic Layer classes can be extended to add or deny certain functionality based on the logged on user.</span></span> <span data-ttu-id="4e309-264">在本教學課程中，我們看到如何限制根據使用者是否為特定的供應商相關聯，或如果他們工作本公司可檢視和編輯資料。</span><span class="sxs-lookup"><span data-stu-id="4e309-264">In this tutorial we saw how to limit the viewable and editable data depending on whether the user was associated with a particular supplier or if they worked for our company.</span></span>

<span data-ttu-id="4e309-265">本教學課程結束時，我們檢查插入、 更新和刪除使用 GridView、 DetailsView 和 FormView 控制項的資料。</span><span class="sxs-lookup"><span data-stu-id="4e309-265">This tutorial concludes our examination of inserting, updating, and deleting data using the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="4e309-266">從開始下一個教學課程，我們將把焦點轉到新增分頁和排序支援。</span><span class="sxs-lookup"><span data-stu-id="4e309-266">Starting with the next tutorial, we'll turn our attention to adding paging and sorting support.</span></span>

<span data-ttu-id="4e309-267">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="4e309-267">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="4e309-268">關於作者</span><span class="sxs-lookup"><span data-stu-id="4e309-268">About the Author</span></span>

<span data-ttu-id="4e309-269">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="4e309-269">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="4e309-270">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="4e309-270">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="4e309-271">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="4e309-271">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="4e309-272">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="4e309-272">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="4e309-273">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="4e309-273">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="4e309-274">上一步</span><span class="sxs-lookup"><span data-stu-id="4e309-274">Previous</span></span>](adding-client-side-confirmation-when-deleting-vb.md)
