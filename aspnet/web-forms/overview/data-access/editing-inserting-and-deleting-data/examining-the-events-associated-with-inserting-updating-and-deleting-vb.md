---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
title: 檢查與插入、更新和刪除相關聯的事件（VB） |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將使用 ASP.NET 資料 Web 控制項的插入、更新或刪除作業之前、期間和之後所發生的事件進行檢查。 W 。
ms.author: riande
ms.date: 07/17/2006
ms.assetid: c9bd10a7-eff8-4d8c-bec9-963c2aef2d6e
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
msc.type: authoredcontent
ms.openlocfilehash: 35edb3cefc6fe23bb56e667c02d10dc7798f730d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74632678"
---
# <a name="examining-the-events-associated-with-inserting-updating-and-deleting-vb"></a><span data-ttu-id="89d32-104">檢查與插入、更新和刪除建立關聯的事件 (VB)</span><span class="sxs-lookup"><span data-stu-id="89d32-104">Examining the Events Associated with Inserting, Updating, and Deleting (VB)</span></span>

<span data-ttu-id="89d32-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="89d32-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="89d32-106">[下載範例應用程式](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe)或[下載 PDF](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="89d32-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe) or [Download PDF](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span></span>

> <span data-ttu-id="89d32-107">在本教學課程中，我們將使用 ASP.NET 資料 Web 控制項的插入、更新或刪除作業之前、期間和之後所發生的事件進行檢查。</span><span class="sxs-lookup"><span data-stu-id="89d32-107">In this tutorial we'll examine using the events that occur before, during, and after an insert, update, or delete operation of an ASP.NET data Web control.</span></span> <span data-ttu-id="89d32-108">我們也會瞭解如何自訂編輯介面，只更新產品欄位的子集。</span><span class="sxs-lookup"><span data-stu-id="89d32-108">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="introduction"></a><span data-ttu-id="89d32-109">簡介</span><span class="sxs-lookup"><span data-stu-id="89d32-109">Introduction</span></span>

<span data-ttu-id="89d32-110">使用 GridView、DetailsView 或 FormView 控制項的內建插入、編輯或刪除功能時，當使用者完成加入新記錄或更新或刪除現有記錄的程式時，會發生各種不同的步驟。</span><span class="sxs-lookup"><span data-stu-id="89d32-110">When using the built-in inserting, editing, or deleting features of the GridView, DetailsView, or FormView controls, a variety of steps transpire when the end user completes the process of adding a new record or updating or deleting an existing record.</span></span> <span data-ttu-id="89d32-111">如同我們在上一個[教學](an-overview-of-inserting-updating-and-deleting-data-vb.md)課程中所討論，在 GridView 中編輯資料列時，[編輯] 按鈕會取代為 [更新] 和 [取消] 按鈕，而 [BoundFields] 則會變成 [文字方塊]。</span><span class="sxs-lookup"><span data-stu-id="89d32-111">As we discussed in the [previous tutorial](an-overview-of-inserting-updating-and-deleting-data-vb.md), when a row is edited in the GridView the Edit button is replaced by Update and Cancel buttons and the BoundFields turn into TextBoxes.</span></span> <span data-ttu-id="89d32-112">在使用者更新資料並按一下 [更新] 之後，會在回傳時執行下列步驟：</span><span class="sxs-lookup"><span data-stu-id="89d32-112">After the end user updates the data and clicks Update, the following steps are performed on postback:</span></span>

1. <span data-ttu-id="89d32-113">GridView 會以編輯記錄的唯一識別欄位（透過 `DataKeyNames` 屬性）填入其 ObjectDataSource 的 `UpdateParameters`，以及使用者輸入的值。</span><span class="sxs-lookup"><span data-stu-id="89d32-113">The GridView populates its ObjectDataSource's `UpdateParameters` with the edited record's unique identifying field(s) (via the `DataKeyNames` property) along with the values entered by the user</span></span>
2. <span data-ttu-id="89d32-114">GridView 會叫用其 ObjectDataSource 的 `Update()` 方法，而後者會在上一個教學課程中叫用基礎物件（`ProductsDAL.UpdateProduct`中的適當方法）</span><span class="sxs-lookup"><span data-stu-id="89d32-114">The GridView invokes its ObjectDataSource's `Update()` method, which in turn invokes the appropriate method in the underlying object (`ProductsDAL.UpdateProduct`, in our previous tutorial)</span></span>
3. <span data-ttu-id="89d32-115">基礎資料（現在包含已更新的變更）會重新系結至 GridView</span><span class="sxs-lookup"><span data-stu-id="89d32-115">The underlying data, which now includes the updated changes, is rebound to the GridView</span></span>

<span data-ttu-id="89d32-116">在這一系列的步驟期間，會引發一些事件，讓我們建立事件處理常式，以便在需要時新增自訂邏輯。</span><span class="sxs-lookup"><span data-stu-id="89d32-116">During this sequence of steps, a number of events fire, enabling us to create event handlers to add custom logic where needed.</span></span> <span data-ttu-id="89d32-117">例如，在步驟1之前，GridView 的 `RowUpdating` 事件會引發。</span><span class="sxs-lookup"><span data-stu-id="89d32-117">For example, prior to Step 1, the GridView's `RowUpdating` event fires.</span></span> <span data-ttu-id="89d32-118">此時，如果發生驗證錯誤，我們可以取消更新要求。</span><span class="sxs-lookup"><span data-stu-id="89d32-118">We can, at this point, cancel the update request if there is some validation error.</span></span> <span data-ttu-id="89d32-119">叫用 `Update()` 方法時，ObjectDataSource 的 `Updating` 事件會引發，讓您有機會新增或自訂任何 `UpdateParameters`的值。</span><span class="sxs-lookup"><span data-stu-id="89d32-119">When the `Update()` method is invoked, the ObjectDataSource's `Updating` event fires, providing an opportunity to add or customize the values of any of the `UpdateParameters`.</span></span> <span data-ttu-id="89d32-120">在 ObjectDataSource 的基礎物件的方法完成執行之後，會引發 ObjectDataSource 的 `Updated` 事件。</span><span class="sxs-lookup"><span data-stu-id="89d32-120">After the ObjectDataSource's underlying object's method has completed executing, the ObjectDataSource's `Updated` event is raised.</span></span> <span data-ttu-id="89d32-121">`Updated` 事件的事件處理常式可以檢查有關更新作業的詳細資訊，例如有多少資料列受到影響，以及是否發生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89d32-121">An event handler for the `Updated` event can inspect the details about the update operation, such as how many rows were affected and whether or not an exception occurred.</span></span> <span data-ttu-id="89d32-122">最後，在步驟2之後，GridView 的 `RowUpdated` 事件會引發;這個事件的事件處理常式可以檢查剛剛執行之更新作業的其他相關資訊。</span><span class="sxs-lookup"><span data-stu-id="89d32-122">Finally, after Step 2, the GridView's `RowUpdated` event fires; an event handler for this event can examine additional information about the update operation just performed.</span></span>

<span data-ttu-id="89d32-123">[圖 1] 說明更新 GridView 時的這一系列事件和步驟。</span><span class="sxs-lookup"><span data-stu-id="89d32-123">Figure 1 depicts this series of events and steps when updating a GridView.</span></span> <span data-ttu-id="89d32-124">[圖 1] 中的事件模式不是以 GridView 更新的獨特功能。</span><span class="sxs-lookup"><span data-stu-id="89d32-124">The event pattern in Figure 1 is not unique to updating with a GridView.</span></span> <span data-ttu-id="89d32-125">從 GridView、DetailsView 或 FormView 中插入、更新或刪除資料時，會 precipitates 資料 Web 控制項和 ObjectDataSource 的相同前置和後置事件順序。</span><span class="sxs-lookup"><span data-stu-id="89d32-125">Inserting, updating, or deleting data from the GridView, DetailsView, or FormView precipitates the same sequence of pre- and post-level events for both the data Web control and the ObjectDataSource.</span></span>

<span data-ttu-id="89d32-126">[![在 GridView 中更新資料時引發一系列的前置和後置事件](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-126">[![A Series of Pre- and Post-Events Fire When Updating Data in a GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span></span>

<span data-ttu-id="89d32-127">**圖 1**：更新 GridView 中的資料時，一系列的前置和後置事件會引發（[按一下以觀看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-127">**Figure 1**: A Series of Pre- and Post-Events Fire When Updating Data in a GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png))</span></span>

<span data-ttu-id="89d32-128">在本教學課程中，我們將探討如何使用這些事件來擴充 ASP.NET 資料 Web 控制項的內建插入、更新和刪除功能。</span><span class="sxs-lookup"><span data-stu-id="89d32-128">In this tutorial we'll examine using these events to extend the built-in inserting, updating, and deleting capabilities of the ASP.NET data Web controls.</span></span> <span data-ttu-id="89d32-129">我們也會瞭解如何自訂編輯介面，只更新產品欄位的子集。</span><span class="sxs-lookup"><span data-stu-id="89d32-129">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="step-1-updating-a-productsproductnameandunitpricefields"></a><span data-ttu-id="89d32-130">步驟1：更新產品的`ProductName`和`UnitPrice`欄位</span><span class="sxs-lookup"><span data-stu-id="89d32-130">Step 1: Updating a Product's`ProductName`and`UnitPrice`Fields</span></span>

<span data-ttu-id="89d32-131">在上一個教學課程的編輯介面中，必須包含*所有*非唯讀的產品欄位。</span><span class="sxs-lookup"><span data-stu-id="89d32-131">In the editing interfaces from the previous tutorial *all* product fields that were not read-only had to be included.</span></span> <span data-ttu-id="89d32-132">如果我們要移除 GridView 中的欄位（例如 `QuantityPerUnit`-更新資料時，資料 Web 控制項不會將 ObjectDataSource 的 `QuantityPerUnit` `UpdateParameters` 值。</span><span class="sxs-lookup"><span data-stu-id="89d32-132">If we were to remove a field from the GridView - say `QuantityPerUnit` - when updating the data the data Web control would not set the ObjectDataSource's `QuantityPerUnit` `UpdateParameters` value.</span></span> <span data-ttu-id="89d32-133">然後，ObjectDataSource 會將 `Nothing` 的值傳入 `UpdateProduct` 商務邏輯層（BLL）方法，這會將編輯過的資料庫記錄 `QuantityPerUnit` 資料行變更為 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="89d32-133">The ObjectDataSource would then pass in a value of `Nothing` into the `UpdateProduct` Business Logic Layer (BLL) method, which would change the edited database record's `QuantityPerUnit` column to a `NULL` value.</span></span> <span data-ttu-id="89d32-134">同樣地，如果必要欄位（例如 `ProductName`）從編輯介面中移除，則更新會失敗並出現「資料*行 ' ProductName ' 不允許 null*」例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89d32-134">Similarly, if a required field, such as `ProductName`, is removed from the editing interface, the update will fail with a "*Column 'ProductName' does not allow nulls*" exception.</span></span> <span data-ttu-id="89d32-135">此行為的原因是因為 ObjectDataSource 已設定為呼叫 `ProductsBLL` 類別的 `UpdateProduct` 方法，這應該是每個產品欄位的輸入參數。</span><span class="sxs-lookup"><span data-stu-id="89d32-135">The reason for this behavior was because the ObjectDataSource was configured to call the `ProductsBLL` class's `UpdateProduct` method, which expected an input parameter for each of the product fields.</span></span> <span data-ttu-id="89d32-136">因此，ObjectDataSource 的 `UpdateParameters` 集合會包含每個方法的輸入參數的參數。</span><span class="sxs-lookup"><span data-stu-id="89d32-136">Therefore, the ObjectDataSource's `UpdateParameters` collection contained a parameter for each of the method's input parameters.</span></span>

<span data-ttu-id="89d32-137">如果我們想要提供可讓使用者只更新欄位子集的資料 Web 控制項，則需要以程式設計方式在 ObjectDataSource 的 `Updating` 事件處理常式中設定遺漏的 `UpdateParameters` 值，或建立並呼叫只預期欄位子集的 BLL 方法。</span><span class="sxs-lookup"><span data-stu-id="89d32-137">If we want to provide a data Web control that allows the end user to only update a subset of fields, then we need to either programmatically set the missing `UpdateParameters` values in the ObjectDataSource's `Updating` event handler or create and call a BLL method that expects only a subset of the fields.</span></span> <span data-ttu-id="89d32-138">讓我們來探索這一種方法。</span><span class="sxs-lookup"><span data-stu-id="89d32-138">Let's explore this latter approach.</span></span>

<span data-ttu-id="89d32-139">具體而言，我們將建立只顯示 [`ProductName`] 的頁面，並在可編輯的 GridView 中 `UnitPrice` 欄位。</span><span class="sxs-lookup"><span data-stu-id="89d32-139">Specifically, let's create a page that displays just the `ProductName` and `UnitPrice` fields in an editable GridView.</span></span> <span data-ttu-id="89d32-140">這個 GridView 的編輯介面只會允許使用者更新兩個顯示的欄位，`ProductName` 和 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="89d32-140">This GridView's editing interface will only allow the user to update the two displayed fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="89d32-141">因為此編輯介面只提供產品欄位的子集，所以我們需要建立一個使用現有 BLL 之 `UpdateProduct` 方法的 ObjectDataSource，並在其 `Updating` 事件處理常式中以程式設計方式設定遺漏的產品欄位值，或者我們必須建立新的 BLL 方法，只預期 GridView 中定義的欄位子集。</span><span class="sxs-lookup"><span data-stu-id="89d32-141">Since this editing interface only provides a subset of a product's fields, we either need to create an ObjectDataSource that uses the existing BLL's `UpdateProduct` method and has the missing product field values set programmatically in its `Updating` event handler, or we need to create a new BLL method that expects only the subset of fields defined in the GridView.</span></span> <span data-ttu-id="89d32-142">在本教學課程中，我們將使用第二個選項，並建立 `UpdateProduct` 方法的多載，只接受三個輸入參數： `productName`、`unitPrice`和 `productID`：</span><span class="sxs-lookup"><span data-stu-id="89d32-142">For this tutorial, let's use the latter option and create an overload of the `UpdateProduct` method, one that takes in just three input parameters: `productName`, `unitPrice`, and `productID`:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample1.vb)]

<span data-ttu-id="89d32-143">就像原始的 `UpdateProduct` 方法一樣，這個多載會從檢查資料庫中是否有具有指定 `ProductID`的產品開始。</span><span class="sxs-lookup"><span data-stu-id="89d32-143">Like the original `UpdateProduct` method, this overload starts by checking to see if there is a product in the database with the specified `ProductID`.</span></span> <span data-ttu-id="89d32-144">如果不是，則會傳回 `False`，表示更新產品資訊的要求失敗。</span><span class="sxs-lookup"><span data-stu-id="89d32-144">If not, it returns `False`, indicating that the request to update the product information failed.</span></span> <span data-ttu-id="89d32-145">否則，它會據以更新現有產品記錄的 `ProductName` 並 `UnitPrice` 欄位，並藉由呼叫 TableAdapter 的 `Update()` 方法（傳入 `ProductsRow` 實例）來認可更新。</span><span class="sxs-lookup"><span data-stu-id="89d32-145">Otherwise it updates the existing product record's `ProductName` and `UnitPrice` fields accordingly and commits the update by calling the TableAdapter's `Update()` method, passing in the `ProductsRow` instance.</span></span>

<span data-ttu-id="89d32-146">隨著我們 `ProductsBLL` 類別的加入，我們已準備好建立簡化的 GridView 介面。</span><span class="sxs-lookup"><span data-stu-id="89d32-146">With this addition to our `ProductsBLL` class, we're ready to create the simplified GridView interface.</span></span> <span data-ttu-id="89d32-147">開啟 [`EditInsertDelete`] 資料夾中的 `DataModificationEvents.aspx`，並在頁面中新增 GridView。</span><span class="sxs-lookup"><span data-stu-id="89d32-147">Open the `DataModificationEvents.aspx` in the `EditInsertDelete` folder and add a GridView to the page.</span></span> <span data-ttu-id="89d32-148">建立新的 ObjectDataSource，並將其設定為使用 `ProductsBLL` 類別，並將其 `Select()` 方法對應到 `GetProducts`，以及將其 `Update()` 方法對應至只接受 `UpdateProduct`、`productName`和 `unitPrice`輸入參數的 `productID` 多載。</span><span class="sxs-lookup"><span data-stu-id="89d32-148">Create a new ObjectDataSource and configure it to use the `ProductsBLL` class with its `Select()` method mapping to `GetProducts` and its `Update()` method mapping to the `UpdateProduct` overload that takes in only the `productName`, `unitPrice`, and `productID` input parameters.</span></span> <span data-ttu-id="89d32-149">[圖 2] 顯示將 ObjectDataSource 的 `Update()` 方法對應到 `ProductsBLL` 類別的新 `UpdateProduct` 方法多載時，建立資料來源。</span><span class="sxs-lookup"><span data-stu-id="89d32-149">Figure 2 shows the Create Data Source wizard when mapping the ObjectDataSource's `Update()` method to the `ProductsBLL` class's new `UpdateProduct` method overload.</span></span>

<span data-ttu-id="89d32-150">[![將 ObjectDataSource 的 Update （）方法對應到新的 UpdateProduct 多載](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-150">[![Map the ObjectDataSource's Update() Method to the New UpdateProduct Overload](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span></span>

<span data-ttu-id="89d32-151">**圖 2**：將 ObjectDataSource 的 `Update()` 方法對應至新的 `UpdateProduct` 多載（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-151">**Figure 2**: Map the ObjectDataSource's `Update()` Method to the New `UpdateProduct` Overload ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png))</span></span>

<span data-ttu-id="89d32-152">由於我們的範例一開始只需要編輯資料，而不是插入或刪除記錄，因此請花點時間明確地指出 ObjectDataSource 的 `Insert()` 和 `Delete()` 方法不應對應至任何 `ProductsBLL` 類別的方法，方法是前往 [插入] 和 [刪除] 索引標籤，然後從下拉式清單中選擇 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="89d32-152">Since our example will initially just need the ability to edit data, but not to insert or delete records, take a moment to explicitly indicate that the ObjectDataSource's `Insert()` and `Delete()` methods shouldn't be mapped to any of the `ProductsBLL` class's methods by going to the INSERT and DELETE tabs and choosing (None) from the drop-down list.</span></span>

<span data-ttu-id="89d32-153">[![從 [插入] 和 [刪除] 索引標籤的下拉式清單中選擇 [（無）]](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-153">[![Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span></span>

<span data-ttu-id="89d32-154">**圖 3**：從 [插入] 和 [刪除] 索引標籤的下拉式清單中選擇 [（無）] （[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-154">**Figure 3**: Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png))</span></span>

<span data-ttu-id="89d32-155">完成此嚮導之後，請核取 GridView 的智慧標籤中的 [啟用編輯] 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="89d32-155">After completing this wizard check the Enable Editing checkbox from the GridView's smart tag.</span></span>

<span data-ttu-id="89d32-156">完成 [建立資料來源] wizard 並系結至 GridView 之後，Visual Studio 已建立這兩個控制項的宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="89d32-156">With the completion of the Create Data Source wizard and binding that to the GridView, Visual Studio has created the declarative syntax for both controls.</span></span> <span data-ttu-id="89d32-157">前往來源視圖來檢查 ObjectDataSource 的宣告式標記，如下所示：</span><span class="sxs-lookup"><span data-stu-id="89d32-157">Go to the Source view to inspect the ObjectDataSource's declarative markup, which is shown below:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample2.aspx)]

<span data-ttu-id="89d32-158">由於 ObjectDataSource 的 `Insert()` 和 `Delete()` 方法沒有對應，因此沒有 `InsertParameters` 或 `DeleteParameters` 區段。</span><span class="sxs-lookup"><span data-stu-id="89d32-158">Since there are no mappings for the ObjectDataSource's `Insert()` and `Delete()` methods, there are no `InsertParameters` or `DeleteParameters` sections.</span></span> <span data-ttu-id="89d32-159">此外，由於 `Update()` 方法會對應到只接受三個輸入參數的 `UpdateProduct` 方法多載，因此 `UpdateParameters` 區段只有三個 `Parameter` 實例。</span><span class="sxs-lookup"><span data-stu-id="89d32-159">Furthermore, since the `Update()` method is mapped to the `UpdateProduct` method overload that only accepts three input parameters, the `UpdateParameters` section has just three `Parameter` instances.</span></span>

<span data-ttu-id="89d32-160">請注意，ObjectDataSource 的 `OldValuesParameterFormatString` 屬性會設定為 `original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="89d32-160">Note that the ObjectDataSource's `OldValuesParameterFormatString` property is set to `original_{0}`.</span></span> <span data-ttu-id="89d32-161">當您使用 [設定資料來源] 時，Visual Studio 會自動設定此屬性。</span><span class="sxs-lookup"><span data-stu-id="89d32-161">This property is set automatically by Visual Studio when using the Configure Data Source wizard.</span></span> <span data-ttu-id="89d32-162">不過，由於我們的 BLL 方法不會預期傳入原始 `ProductID` 值，因此請從 ObjectDataSource 的宣告式語法中移除此屬性指派。</span><span class="sxs-lookup"><span data-stu-id="89d32-162">However, since our BLL methods don't expect the original `ProductID` value to be passed in, remove this property assignment altogether from the ObjectDataSource's declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="89d32-163">如果您只是從設計檢視中的屬性視窗清除 `OldValuesParameterFormatString` 屬性值，屬性仍然會存在於宣告式語法中，但會設為空字串。</span><span class="sxs-lookup"><span data-stu-id="89d32-163">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but will be set to an empty string.</span></span> <span data-ttu-id="89d32-164">請移除宣告式語法中的屬性，或從屬性視窗將值設定為預設的 `{0}`。</span><span class="sxs-lookup"><span data-stu-id="89d32-164">Either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>

<span data-ttu-id="89d32-165">雖然 ObjectDataSource 只有產品名稱、價格和識別碼的 `UpdateParameters`，但 Visual Studio 已在 GridView 中為每個產品的欄位新增 BoundField 或 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="89d32-165">While the ObjectDataSource only has `UpdateParameters` for the product's name, price, and ID, Visual Studio has added a BoundField or CheckBoxField in the GridView for each of the product's fields.</span></span>

<span data-ttu-id="89d32-166">[![GridView 包含每個產品欄位的 BoundField 或 CheckBoxField](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-166">[![The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span></span>

<span data-ttu-id="89d32-167">**圖 4**： GridView 包含每個產品欄位的 BoundField 或 CheckBoxField （[按一下以觀看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-167">**Figure 4**: The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png))</span></span>

<span data-ttu-id="89d32-168">當使用者編輯產品並按一下其 [更新] 按鈕時，GridView 會列舉不是唯讀的欄位。</span><span class="sxs-lookup"><span data-stu-id="89d32-168">When the end user edits a product and clicks its Update button, the GridView enumerates those fields that were not read-only.</span></span> <span data-ttu-id="89d32-169">然後，它會將 ObjectDataSource 的 `UpdateParameters` 集合中對應的參數值設定為使用者輸入的值。</span><span class="sxs-lookup"><span data-stu-id="89d32-169">It then sets the value of the corresponding parameter in the ObjectDataSource's `UpdateParameters` collection to the value entered by the user.</span></span> <span data-ttu-id="89d32-170">如果沒有對應的參數，GridView 會在集合中加入一個。</span><span class="sxs-lookup"><span data-stu-id="89d32-170">If there is not a corresponding parameter, the GridView adds one to the collection.</span></span> <span data-ttu-id="89d32-171">因此，如果我們的 GridView 包含所有產品欄位的 BoundFields 和 CheckBoxFields，則 ObjectDataSource 最後會叫用採用所有這些參數的 `UpdateProduct` 多載，雖然 ObjectDataSource 的宣告式標記只會指定三個輸入參數（請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="89d32-171">Therefore, if our GridView contains BoundFields and CheckBoxFields for all of the product's fields, the ObjectDataSource will end up invoking the `UpdateProduct` overload that takes in all of these parameters, despite the fact that the ObjectDataSource's declarative markup specifies only three input parameters (see Figure 5).</span></span> <span data-ttu-id="89d32-172">同樣地，如果 GridView 中的非唯讀產品欄位有某種組合未對應至 `UpdateProduct` 多載的輸入參數，則在嘗試更新時，將會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="89d32-172">Similarly, if there is some combination of non-read-only product fields in the GridView that doesn't correspond to the input parameters for a `UpdateProduct` overload, an exception will be raised when attempting to update.</span></span>

<span data-ttu-id="89d32-173">[![GridView 會將參數加入至 ObjectDataSource 的 UpdateParameters 集合](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-173">[![The GridView Will Add Parameters to the ObjectDataSource's UpdateParameters Collection](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span></span>

<span data-ttu-id="89d32-174">**圖 5**： GridView 會將參數加入至 ObjectDataSource 的 `UpdateParameters` 集合（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-174">**Figure 5**: The GridView Will Add Parameters to the ObjectDataSource's `UpdateParameters` Collection ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png))</span></span>

<span data-ttu-id="89d32-175">為了確保 ObjectDataSource 會叫用只採用產品名稱、價格和識別碼的 `UpdateProduct` 多載，我們必須限制 GridView 只讓 `ProductName` 和 `UnitPrice`能夠編輯欄位。</span><span class="sxs-lookup"><span data-stu-id="89d32-175">To ensure that the ObjectDataSource invokes the `UpdateProduct` overload that takes in just the product's name, price, and ID, we need to restrict the GridView to having editable fields for just the `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="89d32-176">這可以藉由移除其他 BoundFields 和 CheckBoxFields 來完成，方法是將其他欄位的 `ReadOnly` 屬性設定為 `True`，或將這兩者的某種組合。</span><span class="sxs-lookup"><span data-stu-id="89d32-176">This can be accomplished by removing the other BoundFields and CheckBoxFields, by setting those other fields' `ReadOnly` property to `True`, or by some combination of the two.</span></span> <span data-ttu-id="89d32-177">在本教學課程中，我們只會移除 `ProductName` 和 `UnitPrice` BoundFields 以外的所有 GridView 欄位，在此之後，GridView 的宣告式標記會如下所示：</span><span class="sxs-lookup"><span data-stu-id="89d32-177">For this tutorial let's simply remove all GridView fields except the `ProductName` and `UnitPrice` BoundFields, after which the GridView's declarative markup will look like:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample3.aspx)]

<span data-ttu-id="89d32-178">雖然 `UpdateProduct` 多載預期會有三個輸入參數，但是在 GridView 中只有兩個 BoundFields。</span><span class="sxs-lookup"><span data-stu-id="89d32-178">Even though the `UpdateProduct` overload expects three input parameters, we only have two BoundFields in our GridView.</span></span> <span data-ttu-id="89d32-179">這是因為 `productID` 輸入參數是主要索引鍵值，並透過已編輯資料列的 `DataKeyNames` 屬性值傳入。</span><span class="sxs-lookup"><span data-stu-id="89d32-179">This is because the `productID` input parameter is a primary key value and passed in through the value of the `DataKeyNames` property for the edited row.</span></span>

<span data-ttu-id="89d32-180">我們的 GridView 連同 `UpdateProduct` 多載，可讓使用者只編輯產品的名稱和價格，而不會遺失任何其他產品欄位。</span><span class="sxs-lookup"><span data-stu-id="89d32-180">Our GridView, along with the `UpdateProduct` overload, allows a user to edit just the name and price of a product without losing any of the other product fields.</span></span>

<span data-ttu-id="89d32-181">[![介面只允許編輯產品的名稱和價格](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-181">[![The Interface Allows Editing Just the Product's Name and Price](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span></span>

<span data-ttu-id="89d32-182">**圖 6**：介面只允許編輯產品的名稱和價格（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-182">**Figure 6**: The Interface Allows Editing Just the Product's Name and Price ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="89d32-183">如前一個教學課程中所討論，GridView s 檢視狀態必須啟用（預設行為），這是非常重要的。</span><span class="sxs-lookup"><span data-stu-id="89d32-183">As discussed in the previous tutorial, it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="89d32-184">如果您將 GridView 的 `EnableViewState` 屬性設定為 `false`，就會面臨並行使用者不小心刪除或編輯記錄的風險。</span><span class="sxs-lookup"><span data-stu-id="89d32-184">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="89d32-185">如需詳細資訊，請參閱[警告： ASP.NET 2.0 gridview/DetailsView/FormViews 的並行問題，其支援編輯及/或刪除，且已停用檢視狀態](http://scottonwriting.net/sowblog/posts/10054.aspx)。</span><span class="sxs-lookup"><span data-stu-id="89d32-185">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>

## <a name="improving-theunitpriceformatting"></a><span data-ttu-id="89d32-186">改善`UnitPrice`格式</span><span class="sxs-lookup"><span data-stu-id="89d32-186">Improving the`UnitPrice`Formatting</span></span>

<span data-ttu-id="89d32-187">雖然 [圖 6] 所示的 GridView 範例運作正常，但 [`UnitPrice`] 欄位完全不會格式化，因而導致價格顯示缺少任何貨幣符號，而且有四個小數位數。</span><span class="sxs-lookup"><span data-stu-id="89d32-187">While the GridView example shown in Figure 6 works, the `UnitPrice` field is not formatted at all, resulting in a price display that lacks any currency symbols and has four decimal places.</span></span> <span data-ttu-id="89d32-188">若要針對不可編輯的資料列套用貨幣格式，只需將 `UnitPrice` BoundField 的 `DataFormatString` 屬性設為 `{0:c}`，並將其 `HtmlEncode` 屬性設定為 [`False`]。</span><span class="sxs-lookup"><span data-stu-id="89d32-188">To apply a currency formatting for the non-editable rows, simply set the `UnitPrice` BoundField's `DataFormatString` property to `{0:c}` and its `HtmlEncode` property to `False`.</span></span>

<span data-ttu-id="89d32-189">[![適當地設定單價的 DataFormatString 和 HtmlEncode 屬性](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-189">[![Set the UnitPrice's DataFormatString and HtmlEncode Properties Accordingly](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span></span>

<span data-ttu-id="89d32-190">**圖 7**：適當地設定 `UnitPrice`的 `DataFormatString` 和 `HtmlEncode` 屬性（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-190">**Figure 7**: Set the `UnitPrice`'s `DataFormatString` and `HtmlEncode` Properties Accordingly ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png))</span></span>

<span data-ttu-id="89d32-191">透過這種變更，不可編輯的資料列會將價格格式化為貨幣;不過，已編輯的資料列仍會顯示值，但不含貨幣符號和四位數。</span><span class="sxs-lookup"><span data-stu-id="89d32-191">With this change, the non-editable rows format the price as a currency; the edited row, however, still displays the value without the currency symbol and with four decimal places.</span></span>

<span data-ttu-id="89d32-192">[![無法編輯的資料列現在會格式化為貨幣值](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-192">[![The Non-Editable Rows are Now Formatted as Currency Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span></span>

<span data-ttu-id="89d32-193">**圖 8**：不可編輯的資料列現在會格式化為貨幣值（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-193">**Figure 8**: The Non-Editable Rows are Now Formatted as Currency Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png))</span></span>

<span data-ttu-id="89d32-194">藉由將 BoundField 的 `ApplyFormatInEditMode` 屬性設定為 `True` （預設值為 `False`），可以將 `DataFormatString` 屬性中指定的格式化指示套用至編輯介面。</span><span class="sxs-lookup"><span data-stu-id="89d32-194">The formatting instructions specified in the `DataFormatString` property can be applied to the editing interface by setting the BoundField's `ApplyFormatInEditMode` property to `True` (the default is `False`).</span></span> <span data-ttu-id="89d32-195">請花點時間將此屬性設定為 `True`。</span><span class="sxs-lookup"><span data-stu-id="89d32-195">Take a moment to set this property to `True`.</span></span>

<span data-ttu-id="89d32-196">[![將單價 BoundField 的 ApplyFormatInEditMode 屬性設定為 True](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-196">[![Set the UnitPrice BoundField's ApplyFormatInEditMode property to True](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span></span>

<span data-ttu-id="89d32-197">**圖 9**：將 `UnitPrice` BoundField 的 `ApplyFormatInEditMode` 屬性設定為 `True` （[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-197">**Figure 9**: Set the `UnitPrice` BoundField's `ApplyFormatInEditMode` property to `True` ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png))</span></span>

<span data-ttu-id="89d32-198">隨著這項變更，在編輯過的資料列中顯示的 `UnitPrice` 值也會格式化為貨幣。</span><span class="sxs-lookup"><span data-stu-id="89d32-198">With this change, the value of the `UnitPrice` displayed in the edited row is also formatted as a currency.</span></span>

<span data-ttu-id="89d32-199">[![編輯過的資料列的 [單價] 值現在已格式化為貨幣](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-199">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span></span>

<span data-ttu-id="89d32-200">**圖 10**：編輯過的資料列的 `UnitPrice` 值現在會格式化為貨幣（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-200">**Figure 10**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png))</span></span>

<span data-ttu-id="89d32-201">不過，使用文字方塊中的貨幣符號來更新產品（例如 $19.00）會擲回 `FormatException`。</span><span class="sxs-lookup"><span data-stu-id="89d32-201">However, updating a product with the currency symbol in the textbox such as $19.00 throws a `FormatException`.</span></span> <span data-ttu-id="89d32-202">當 GridView 嘗試將使用者提供的值指派給 ObjectDataSource 的 `UpdateParameters` 集合時，無法將 `UnitPrice` 字串 "$19.00" 轉換成參數所需的 `Decimal` （請參閱 [圖 11]）。</span><span class="sxs-lookup"><span data-stu-id="89d32-202">When the GridView attempts to assign the user-supplied values to the ObjectDataSource's `UpdateParameters` collection it is unable to convert the `UnitPrice` string "$19.00" into the `Decimal` required by the parameter (see Figure 11).</span></span> <span data-ttu-id="89d32-203">若要解決這個問題，我們可以為 GridView 的 `RowUpdating` 事件建立事件處理常式，並讓它將使用者提供的 `UnitPrice` 剖析成貨幣格式的 `Decimal`。</span><span class="sxs-lookup"><span data-stu-id="89d32-203">To remedy this we can create an event handler for the GridView's `RowUpdating` event and have it parse the user-supplied `UnitPrice` as a currency-formatted `Decimal`.</span></span>

<span data-ttu-id="89d32-204">GridView 的 `RowUpdating` 事件會接受[GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx)類型的物件做為其第二個參數，其中包含做為其中一個屬性的 `NewValues` 字典，其中包含準備好要指派給 ObjectDataSource 的 `UpdateParameters` 集合的使用者提供值。</span><span class="sxs-lookup"><span data-stu-id="89d32-204">The GridView's `RowUpdating` event accepts as its second parameter an object of type [GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), which includes a `NewValues` dictionary as one of its properties that holds the user-supplied values ready to be assigned to the ObjectDataSource's `UpdateParameters` collection.</span></span> <span data-ttu-id="89d32-205">我們可以在 `NewValues` 集合中，使用以貨幣格式剖析的十進位值來覆寫現有的 `UnitPrice` 值，並在 `RowUpdating` 事件處理常式中使用下列程式程式碼：</span><span class="sxs-lookup"><span data-stu-id="89d32-205">We can overwrite the existing `UnitPrice` value in the `NewValues` collection with a decimal value parsed using the currency format with the following lines of code in the `RowUpdating` event handler:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample4.vb)]

<span data-ttu-id="89d32-206">如果使用者已提供 `UnitPrice` 值（例如 "$19.00"），則會使用 Decimal 所計算的十進位值來覆寫這個值[。 Parse](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx)，將值剖析為貨幣。</span><span class="sxs-lookup"><span data-stu-id="89d32-206">If the user has supplied a `UnitPrice` value (such as "$19.00"), this value is overwritten with the decimal value computed by [Decimal.Parse](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx), parsing the value as a currency.</span></span> <span data-ttu-id="89d32-207">這會在任何貨幣符號、逗號、小數點等等的事件中正確地剖析十進位，並在[NumberStyles 列舉](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx)[命名空間](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx)中使用。</span><span class="sxs-lookup"><span data-stu-id="89d32-207">This will correctly parse the decimal in the event of any currency symbols, commas, decimal points, and so on, and uses the [NumberStyles enumeration](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx) in the [System.Globalization](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx) namespace.</span></span>

<span data-ttu-id="89d32-208">[圖 11] 顯示使用者提供的 `UnitPrice`中的貨幣符號所造成的問題，以及 GridView 的 `RowUpdating` 事件處理常式如何利用來正確地剖析這類輸入。</span><span class="sxs-lookup"><span data-stu-id="89d32-208">Figure 11 shows both the problem caused by currency symbols in the user-supplied `UnitPrice`, along with how the GridView's `RowUpdating` event handler can be utilized to correctly parse such input.</span></span>

<span data-ttu-id="89d32-209">[![編輯過的資料列的 [單價] 值現在已格式化為貨幣](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-209">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span></span>

<span data-ttu-id="89d32-210">**圖 11**：已編輯的資料列的 `UnitPrice` 值現在會格式化為貨幣（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-210">**Figure 11**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png))</span></span>

## <a name="step-2-prohibitingnull-unitprices"></a><span data-ttu-id="89d32-211">步驟2：禁止`NULL UnitPrices`</span><span class="sxs-lookup"><span data-stu-id="89d32-211">Step 2: Prohibiting`NULL UnitPrices`</span></span>

<span data-ttu-id="89d32-212">當資料庫設定為允許 `Products` 資料表的 `UnitPrice` 資料行中的 `NULL` 值時，我們可能會想要防止使用者造訪此特定頁面，而不指定 `NULL` `UnitPrice` 值。</span><span class="sxs-lookup"><span data-stu-id="89d32-212">While the database is configured to allow `NULL` values in the `Products` table's `UnitPrice` column, we may want to prevent users visiting this particular page from specifying a `NULL` `UnitPrice` value.</span></span> <span data-ttu-id="89d32-213">也就是說，如果使用者在編輯產品資料列時無法輸入 `UnitPrice` 值，而不是將結果儲存到資料庫，而是要顯示一則訊息，告知使用者，透過此頁面，任何已編輯的產品都必須指定價格。</span><span class="sxs-lookup"><span data-stu-id="89d32-213">That is, if a user fails to enter a `UnitPrice` value when editing a product row, rather than save the results to the database we want to display a message informing the user that, through this page, any edited products must have a price specified.</span></span>

<span data-ttu-id="89d32-214">傳遞至 GridView 的 `RowUpdating` 事件處理常式的 `GridViewUpdateEventArgs` 物件包含 `Cancel` 屬性，如果設定為 `True`，就會終止更新進程。</span><span class="sxs-lookup"><span data-stu-id="89d32-214">The `GridViewUpdateEventArgs` object passed into the GridView's `RowUpdating` event handler contains a `Cancel` property that, if set to `True`, terminates the updating process.</span></span> <span data-ttu-id="89d32-215">讓我們擴充 `RowUpdating` 事件處理常式，將 `e.Cancel` 設定為 `True` 並顯示訊息，說明 `NewValues` 集合中的 `UnitPrice` 值是否有 `Nothing`的值。</span><span class="sxs-lookup"><span data-stu-id="89d32-215">Let's extend the `RowUpdating` event handler to set `e.Cancel` to `True` and display a message explaining why if the `UnitPrice` value in the `NewValues` collection has a value of `Nothing`.</span></span>

<span data-ttu-id="89d32-216">首先，將標籤 Web 控制項新增至名為 `MustProvideUnitPriceMessage`的頁面。</span><span class="sxs-lookup"><span data-stu-id="89d32-216">Start by adding a Label Web control to the page named `MustProvideUnitPriceMessage`.</span></span> <span data-ttu-id="89d32-217">如果使用者在更新產品時無法指定 `UnitPrice` 值，則會顯示此標籤控制項。</span><span class="sxs-lookup"><span data-stu-id="89d32-217">This Label control will be displayed if the user fails to specify a `UnitPrice` value when updating a product.</span></span> <span data-ttu-id="89d32-218">將標籤的 [`Text`] 屬性設為 [您必須提供產品的價格]。</span><span class="sxs-lookup"><span data-stu-id="89d32-218">Set the Label's `Text` property to "You must provide a price for the product."</span></span> <span data-ttu-id="89d32-219">我也在名為 `Warning` 的 `Styles.css` 中，使用下列定義建立了新的 CSS 類別：</span><span class="sxs-lookup"><span data-stu-id="89d32-219">I've also created a new CSS class in `Styles.css` named `Warning` with the following definition:</span></span>

[!code-css[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample5.css)]

<span data-ttu-id="89d32-220">最後，將標籤的 [`CssClass`] 屬性設定為 [`Warning`]。</span><span class="sxs-lookup"><span data-stu-id="89d32-220">Finally, set the Label's `CssClass` property to `Warning`.</span></span> <span data-ttu-id="89d32-221">此時，設計工具應該會在 GridView 上方以紅色、粗體、斜體、超大型字型大小顯示警告訊息，如 [圖 12] 所示。</span><span class="sxs-lookup"><span data-stu-id="89d32-221">At this point the Designer should show the warning message in a red, bold, italic, extra large font size above the GridView, as shown in Figure 12.</span></span>

<span data-ttu-id="89d32-222">[![已在 GridView 上方新增標籤](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-222">[![A Label Has Been Added Above the GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span></span>

<span data-ttu-id="89d32-223">**圖 12**：已在 GridView 上方新增標籤（[按一下以觀看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-223">**Figure 12**: A Label Has Been Added Above the GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png))</span></span>

<span data-ttu-id="89d32-224">根據預設，此標籤應該是隱藏的，因此，請將其 `Visible` 屬性設定為 `Page_Load` 事件處理常式中的 `False`：</span><span class="sxs-lookup"><span data-stu-id="89d32-224">By default, this Label should be hidden, so set its `Visible` property to `False` in the `Page_Load` event handler:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample6.vb)]

<span data-ttu-id="89d32-225">如果使用者嘗試在未指定 `UnitPrice`的情況下更新產品，我們會想要取消更新並顯示警告標籤。</span><span class="sxs-lookup"><span data-stu-id="89d32-225">If the user attempts to update a product without specifying the `UnitPrice`, we want to cancel the update and display the warning label.</span></span> <span data-ttu-id="89d32-226">擴大 GridView 的 `RowUpdating` 事件處理常式，如下所示：</span><span class="sxs-lookup"><span data-stu-id="89d32-226">Augment the GridView's `RowUpdating` event handler as follows:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample7.vb)]

<span data-ttu-id="89d32-227">如果使用者嘗試在未指定價格的情況下儲存產品，則會取消更新並顯示有用的訊息。</span><span class="sxs-lookup"><span data-stu-id="89d32-227">If a user attempts to save a product without specifying a price, the update is cancelled and a helpful message is displayed.</span></span> <span data-ttu-id="89d32-228">當資料庫（和商務邏輯）允許 `NULL` `UnitPrice` s 時，這個特定的 ASP.NET 網頁不會。</span><span class="sxs-lookup"><span data-stu-id="89d32-228">While the database (and business logic) allows for `NULL` `UnitPrice` s, this particular ASP.NET page does not.</span></span>

<span data-ttu-id="89d32-229">[![使用者不能將 [單價] 保留空白](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-229">[![A User Cannot Leave UnitPrice Blank](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span></span>

<span data-ttu-id="89d32-230">**圖 13**：使用者不能將 `UnitPrice` 留白（[按一下以觀看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-230">**Figure 13**: A User Cannot Leave `UnitPrice` Blank ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png))</span></span>

<span data-ttu-id="89d32-231">到目前為止，我們已瞭解如何使用 GridView 的 `RowUpdating` 事件，以程式設計方式改變指派給 ObjectDataSource `UpdateParameters` 集合的參數值，以及如何完全取消更新程式。</span><span class="sxs-lookup"><span data-stu-id="89d32-231">So far we have seen how to use the GridView's `RowUpdating` event to programmatically alter the parameter values assigned to the ObjectDataSource's `UpdateParameters` collection as well as how to cancel the updating process altogether.</span></span> <span data-ttu-id="89d32-232">這些概念會延續到 DetailsView 和 FormView 控制項，也適用于插入和刪除。</span><span class="sxs-lookup"><span data-stu-id="89d32-232">These concepts carry over to the DetailsView and FormView controls and also apply to inserting and deleting.</span></span>

<span data-ttu-id="89d32-233">這些工作也可以透過事件處理常式的 `Inserting`、`Updating`和 `Deleting` 事件，在 ObjectDataSource 層級完成。</span><span class="sxs-lookup"><span data-stu-id="89d32-233">These tasks can also be done at the ObjectDataSource level through event handlers for its `Inserting`, `Updating`, and `Deleting` events.</span></span> <span data-ttu-id="89d32-234">這些事件會在叫用基礎物件的相關聯方法之前引發，並提供最後機會來修改輸入參數集合或直接取消作業。</span><span class="sxs-lookup"><span data-stu-id="89d32-234">These events fire before the associated method of the underlying object is invoked and provide a last-chance opportunity to modify the input parameters collection or cancel the operation outright.</span></span> <span data-ttu-id="89d32-235">這三個事件的事件處理常式會傳遞[ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx)類型的物件，其中包含兩個相關的屬性：</span><span class="sxs-lookup"><span data-stu-id="89d32-235">The event handlers for these three events are passed an object of type [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) that has two properties of interest:</span></span>

- <span data-ttu-id="89d32-236">[[取消](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx)]，如果設定為 [`True`]，則會取消正在執行的作業</span><span class="sxs-lookup"><span data-stu-id="89d32-236">[Cancel](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), which, if set to `True`, cancels the operation being performed</span></span>
- <span data-ttu-id="89d32-237">[輸入參數](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx)，這是 `InsertParameters`、`UpdateParameters`或 `DeleteParameters`的集合，視事件處理常式是針對 `Inserting`、`Updating`還是 `Deleting` 事件而定</span><span class="sxs-lookup"><span data-stu-id="89d32-237">[InputParameters](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), which is the collection of `InsertParameters`, `UpdateParameters`, or `DeleteParameters`, depending on whether the event handler is for the `Inserting`, `Updating`, or `Deleting` event</span></span>

<span data-ttu-id="89d32-238">為了說明如何使用 ObjectDataSource 層級的參數值，讓我們在頁面中包含 DetailsView，以允許使用者新增新的產品。</span><span class="sxs-lookup"><span data-stu-id="89d32-238">To illustrate working with the parameter values at the ObjectDataSource level, let's include a DetailsView in our page that allows the users to add a new product.</span></span> <span data-ttu-id="89d32-239">此 DetailsView 將用來提供介面，以快速將新產品新增至資料庫。</span><span class="sxs-lookup"><span data-stu-id="89d32-239">This DetailsView will be used to provide an interface for quickly adding a new product to the database.</span></span> <span data-ttu-id="89d32-240">若要在加入新產品時保持一致的使用者介面，讓使用者只能輸入 `ProductName` 和 `UnitPrice` 欄位的值。</span><span class="sxs-lookup"><span data-stu-id="89d32-240">To keep a consistent user interface when adding a new product let's allow the user to only enter values for the `ProductName` and `UnitPrice` fields.</span></span> <span data-ttu-id="89d32-241">根據預設，在 DetailsView 的插入介面中未提供的值將會設定為 `NULL` 資料庫值。</span><span class="sxs-lookup"><span data-stu-id="89d32-241">By default, those values that aren't supplied in the DetailsView's inserting interface will be set to a `NULL` database value.</span></span> <span data-ttu-id="89d32-242">不過，我們可以使用 ObjectDataSource 的 `Inserting` 事件插入不同的預設值，如我們稍後所見。</span><span class="sxs-lookup"><span data-stu-id="89d32-242">However, we can use the ObjectDataSource's `Inserting` event to inject different default values, as we'll see shortly.</span></span>

## <a name="step-3-providing-an-interface-to-add-new-products"></a><span data-ttu-id="89d32-243">步驟3：提供介面來新增產品</span><span class="sxs-lookup"><span data-stu-id="89d32-243">Step 3: Providing an Interface to Add New Products</span></span>

<span data-ttu-id="89d32-244">從 [工具箱] 將 [DetailsView] 拖曳至 GridView 上方的設計工具，清除其 `Height` 並 `Width` 屬性，然後將它系結至已存在於頁面上的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="89d32-244">Drag a DetailsView from the Toolbox onto the Designer above the GridView, clear out its `Height` and `Width` properties, and bind it to the ObjectDataSource already present on the page.</span></span> <span data-ttu-id="89d32-245">這會為每個產品的欄位新增 BoundField 或 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="89d32-245">This will add a BoundField or CheckBoxField for each of the product's fields.</span></span> <span data-ttu-id="89d32-246">因為我們想要使用此 DetailsView 來加入新的產品，所以我們需要從智慧標籤中選取 [啟用插入] 選項;不過，沒有這種選擇，因為 ObjectDataSource 的 `Insert()` 方法並未對應到 `ProductsBLL` 類別中的方法（回想一下，在設定資料來源時，我們將此對應設為（無），請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="89d32-246">Since we want to use this DetailsView to add new products, we need to check the Enable Inserting option from the smart tag; however, there's no such option because the ObjectDataSource's `Insert()` method is not mapped to a method in the `ProductsBLL` class (recall that we set this mapping to (None) when configuring the data source see Figure 3).</span></span>

<span data-ttu-id="89d32-247">若要設定 ObjectDataSource，請從其智慧標籤選取 [設定資料來源] 連結，並啟動精靈。</span><span class="sxs-lookup"><span data-stu-id="89d32-247">To configure the ObjectDataSource, select the Configure Data Source link from its smart tag, launching the wizard.</span></span> <span data-ttu-id="89d32-248">第一個畫面可讓您變更 ObjectDataSource 所系結的基礎物件。將它設定為 [`ProductsBLL`]。</span><span class="sxs-lookup"><span data-stu-id="89d32-248">The first screen allows you to change the underlying object the ObjectDataSource is bound to; leave it set to `ProductsBLL`.</span></span> <span data-ttu-id="89d32-249">下一個畫面會列出從 ObjectDataSource 的方法到基礎物件的對應。</span><span class="sxs-lookup"><span data-stu-id="89d32-249">The next screen lists the mappings from the ObjectDataSource's methods to the underlying object's.</span></span> <span data-ttu-id="89d32-250">雖然我們明確指出 `Insert()` 和 `Delete()` 方法不應對應到任何方法，但如果您移至 [插入] 和 [刪除] 索引標籤，您會看到對應在該處。</span><span class="sxs-lookup"><span data-stu-id="89d32-250">Even though we explicitly indicated that the `Insert()` and `Delete()` methods should not be mapped to any methods, if you go to the INSERT and DELETE tabs you'll see that a mapping is there.</span></span> <span data-ttu-id="89d32-251">這是因為 `ProductsBLL`的 `AddProduct` 和 `DeleteProduct` 方法會使用 `DataObjectMethodAttribute` 屬性來表示它們是分別用於 `Insert()` 和 `Delete()`的預設方法。</span><span class="sxs-lookup"><span data-stu-id="89d32-251">This is because the `ProductsBLL`'s `AddProduct` and `DeleteProduct` methods use the `DataObjectMethodAttribute` attribute to indicate that they are the default methods for `Insert()` and `Delete()`, respectively.</span></span> <span data-ttu-id="89d32-252">因此，除非有明確指定的其他值，否則 ObjectDataSource wizard 會在您每次執行嚮導時加以選取。</span><span class="sxs-lookup"><span data-stu-id="89d32-252">Hence, the ObjectDataSource wizard selects these each time you run the wizard unless there's some other value explicitly specified.</span></span>

<span data-ttu-id="89d32-253">將 [`Insert()`] 方法保留指向 [`AddProduct`] 方法，但再次將 [刪除] 索引標籤的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="89d32-253">Leave the `Insert()` method pointing to the `AddProduct` method, but again set the DELETE tab's drop-down list to (None).</span></span>

<span data-ttu-id="89d32-254">[![將 [插入] 索引標籤的下拉式清單設定為 AddProduct 方法](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-254">[![Set the INSERT Tab's Drop-Down List to the AddProduct Method](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span></span>

<span data-ttu-id="89d32-255">**圖 14**：將 [插入] 索引標籤的下拉式清單設定為 [`AddProduct`] 方法（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-255">**Figure 14**: Set the INSERT Tab's Drop-Down List to the `AddProduct` Method ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png))</span></span>

<span data-ttu-id="89d32-256">[![將 [刪除] 索引標籤的下拉式清單設定為 [（無）]](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-256">[![Set the DELETE Tab's Drop-Down List to (None)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span></span>

<span data-ttu-id="89d32-257">**圖 15**：將 [刪除] 索引標籤的下拉式清單設定為 [（無）] （[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-257">**Figure 15**: Set the DELETE Tab's Drop-Down List to (None) ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png))</span></span>

<span data-ttu-id="89d32-258">進行這些變更之後，會展開 ObjectDataSource 的宣告式語法以包含 `InsertParameters` 集合，如下所示：</span><span class="sxs-lookup"><span data-stu-id="89d32-258">After making these changes, the ObjectDataSource's declarative syntax will be expanded to include an `InsertParameters` collection, as shown below:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample8.aspx)]

<span data-ttu-id="89d32-259">重新執行嚮導，並將其加回 [`OldValuesParameterFormatString`] 屬性。</span><span class="sxs-lookup"><span data-stu-id="89d32-259">Rerunning the wizard added back the `OldValuesParameterFormatString` property.</span></span> <span data-ttu-id="89d32-260">請花一些時間來清除此屬性，方法是將它設定為預設值（`{0}`），或將它從宣告式語法完全移除。</span><span class="sxs-lookup"><span data-stu-id="89d32-260">Take a moment to clear this property by setting it to the default value (`{0}`) or removing it altogether from the declarative syntax.</span></span>

<span data-ttu-id="89d32-261">有了提供插入功能的 ObjectDataSource，DetailsView 的智慧標籤現在會包含 [啟用插入] 核取方塊;回到設計工具並核取此選項。</span><span class="sxs-lookup"><span data-stu-id="89d32-261">With the ObjectDataSource providing inserting capabilities, the DetailsView's smart tag will now include the Enable Inserting checkbox; return to the Designer and check this option.</span></span> <span data-ttu-id="89d32-262">接下來，向下削減 DetailsView，使其只有兩個 BoundFields `ProductName` 和 `UnitPrice` 和 CommandField。</span><span class="sxs-lookup"><span data-stu-id="89d32-262">Next, pare down the DetailsView so that it only has two BoundFields - `ProductName` and `UnitPrice` - and the CommandField.</span></span> <span data-ttu-id="89d32-263">此時，DetailsView 的宣告式語法看起來應該像這樣：</span><span class="sxs-lookup"><span data-stu-id="89d32-263">At this point the DetailsView's declarative syntax should look like:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample9.aspx)]

<span data-ttu-id="89d32-264">[圖 16] 顯示此頁面，在此時透過瀏覽器觀看。</span><span class="sxs-lookup"><span data-stu-id="89d32-264">Figure 16 shows this page when viewed through a browser at this point.</span></span> <span data-ttu-id="89d32-265">如您所見，DetailsView 會列出第一項產品的名稱和價格（Chai）。</span><span class="sxs-lookup"><span data-stu-id="89d32-265">As you can see, the DetailsView lists the name and price of the first product (Chai).</span></span> <span data-ttu-id="89d32-266">不過，我們想要的是插入介面，讓使用者可以快速地將新產品新增至資料庫。</span><span class="sxs-lookup"><span data-stu-id="89d32-266">What we want, however, is an inserting interface that provides a means for the user to quickly add a new product to the database.</span></span>

<span data-ttu-id="89d32-267">[![DetailsView 目前以唯讀模式呈現](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-267">[![The DetailsView is Currently Rendered in Read-Only Mode](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span></span>

<span data-ttu-id="89d32-268">**圖 16**： DetailsView 目前以唯讀模式轉譯（[按一下以觀看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-268">**Figure 16**: The DetailsView is Currently Rendered in Read-Only Mode ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png))</span></span>

<span data-ttu-id="89d32-269">為了在其插入模式中顯示 DetailsView，我們需要將 `DefaultMode` 屬性設為 `Inserting`。</span><span class="sxs-lookup"><span data-stu-id="89d32-269">In order to show the DetailsView in its inserting mode we need to set the `DefaultMode` property to `Inserting`.</span></span> <span data-ttu-id="89d32-270">這會在第一次造訪時以插入模式轉譯 DetailsView，並在插入新記錄之後將其保留在該處。</span><span class="sxs-lookup"><span data-stu-id="89d32-270">This renders the DetailsView in insert mode when first visited and keeps it there after inserting a new record.</span></span> <span data-ttu-id="89d32-271">如 [圖 17] 所示，這類 DetailsView 提供快速的介面來加入新的記錄。</span><span class="sxs-lookup"><span data-stu-id="89d32-271">As Figure 17 shows, such a DetailsView provides a quick interface for adding a new record.</span></span>

<span data-ttu-id="89d32-272">[![DetailsView 提供快速新增產品的介面](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-272">[![The DetailsView Provides an Interface for Quickly Adding a New Product](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span></span>

<span data-ttu-id="89d32-273">**圖 17**： DetailsView 提供快速新增產品的介面（[按一下以觀看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-273">**Figure 17**: The DetailsView Provides an Interface for Quickly Adding a New Product ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png))</span></span>

<span data-ttu-id="89d32-274">當使用者輸入產品名稱和價格（例如「Acme 水」和1.99，如 [圖 17] 所示）並按一下 [插入] 時，回傳接踵而來和插入工作流程會在新增至資料庫的新產品記錄中累積。</span><span class="sxs-lookup"><span data-stu-id="89d32-274">When the user enters a product name and price (such as "Acme Water" and 1.99, as in Figure 17) and clicks Insert, a postback ensues and the inserting workflow commences, culminating in a new product record being added to the database.</span></span> <span data-ttu-id="89d32-275">DetailsView 會維護其插入介面，而 GridView 會自動重新系結至其資料來源，以包含新的產品，如 [圖 18] 所示。</span><span class="sxs-lookup"><span data-stu-id="89d32-275">The DetailsView maintains its inserting interface and the GridView is automatically rebound to its data source in order to include the new product, as shown in Figure 18.</span></span>

![產品](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image52.png)

<span data-ttu-id="89d32-277">**圖 18**：產品 "Acme 水" 已新增至資料庫</span><span class="sxs-lookup"><span data-stu-id="89d32-277">**Figure 18**: The Product "Acme Water" Has Been Added to the Database</span></span>

<span data-ttu-id="89d32-278">雖然 [圖 18] 中的 GridView 並未顯示它，但不是來自 DetailsView 介面的產品欄位 `CategoryID`、`SupplierID`、`QuantityPerUnit`等等，都會被指派 `NULL` 資料庫值。</span><span class="sxs-lookup"><span data-stu-id="89d32-278">While the GridView in Figure 18 doesn't show it, the product fields lacking from the DetailsView interface `CategoryID`, `SupplierID`, `QuantityPerUnit`, and so on are assigned `NULL` database values.</span></span> <span data-ttu-id="89d32-279">您可以執行下列步驟來查看這一點：</span><span class="sxs-lookup"><span data-stu-id="89d32-279">You can see this by performing the following steps:</span></span>

1. <span data-ttu-id="89d32-280">前往 Visual Studio 的伺服器總管</span><span class="sxs-lookup"><span data-stu-id="89d32-280">Go to the Server Explorer in Visual Studio</span></span>
2. <span data-ttu-id="89d32-281">展開 `NORTHWND.MDF` 資料庫節點</span><span class="sxs-lookup"><span data-stu-id="89d32-281">Expanding the `NORTHWND.MDF` database node</span></span>
3. <span data-ttu-id="89d32-282">以滑鼠右鍵按一下 [`Products` 資料庫資料表] 節點</span><span class="sxs-lookup"><span data-stu-id="89d32-282">Right-click on the `Products` database table node</span></span>
4. <span data-ttu-id="89d32-283">選取 [顯示資料表資料]</span><span class="sxs-lookup"><span data-stu-id="89d32-283">Select Show Table Data</span></span>

<span data-ttu-id="89d32-284">這會列出 `Products` 資料表中的所有記錄。</span><span class="sxs-lookup"><span data-stu-id="89d32-284">This will list all of the records in the `Products` table.</span></span> <span data-ttu-id="89d32-285">如 [圖 19] 所示，除了 `ProductID`、`ProductName`和 `UnitPrice` 以外的所有新產品資料行都有 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="89d32-285">As Figure 19 shows, all of our new product's columns other than `ProductID`, `ProductName`, and `UnitPrice` have `NULL` values.</span></span>

<span data-ttu-id="89d32-286">[![DetailsView 中未提供的產品欄位會被指派 Null 值](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-286">[![The Product Fields Not Provided in the DetailsView are Assigned NULL Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span></span>

<span data-ttu-id="89d32-287">**圖 19**： DetailsView 中未提供的產品欄位會被指派 `NULL` 值（[按一下以查看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-287">**Figure 19**: The Product Fields Not Provided in the DetailsView are Assigned `NULL` Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png))</span></span>

<span data-ttu-id="89d32-288">我們可能會想要提供一或多個這些資料行值 `NULL` 以外的預設值，因為 `NULL` 不是最佳的預設選項，或資料庫資料行本身不允許 `NULL` s。</span><span class="sxs-lookup"><span data-stu-id="89d32-288">We may want to provide a default value other than `NULL` for one or more of these column values, either because `NULL` isn't the best default option or because the database column itself doesn't allow `NULL` s.</span></span> <span data-ttu-id="89d32-289">若要完成這項操作，我們可以透過程式設計方式設定 DetailsView 之 `InputParameters` 集合的參數值。</span><span class="sxs-lookup"><span data-stu-id="89d32-289">To accomplish this we can programmatically set the values of the parameters of the DetailsView's `InputParameters` collection.</span></span> <span data-ttu-id="89d32-290">這項指派可以在 DetailsView 的 `ItemInserting` 事件或 ObjectDataSource 的 `Inserting` 事件的事件處理常式中完成。</span><span class="sxs-lookup"><span data-stu-id="89d32-290">This assignment can be done either in the event handler for the DetailsView's `ItemInserting` event or the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="89d32-291">既然我們已經討論過在資料 Web 控制項層級使用前置和後置事件，讓我們來探索這次使用 ObjectDataSource 的事件。</span><span class="sxs-lookup"><span data-stu-id="89d32-291">Since we've already looked at using the pre- and post-level events at the data Web control level, let's explore using the ObjectDataSource's events this time.</span></span>

## <a name="step-4-assigning-values-to-thecategoryidandsupplieridparameters"></a><span data-ttu-id="89d32-292">步驟4：將值指派給`CategoryID`和`SupplierID`參數</span><span class="sxs-lookup"><span data-stu-id="89d32-292">Step 4: Assigning Values to the`CategoryID`and`SupplierID`Parameters</span></span>

<span data-ttu-id="89d32-293">在本教學課程中，我們假設在透過這個介面新增新產品時，我們的應用程式應該指派 `CategoryID`，`SupplierID` 值1。</span><span class="sxs-lookup"><span data-stu-id="89d32-293">For this tutorial let's imagine that for our application when adding a new product through this interface it should be assigned a `CategoryID` and `SupplierID` value of 1.</span></span> <span data-ttu-id="89d32-294">如先前所述，ObjectDataSource 具有一對在資料修改程式期間引發的前置和後置層級事件。</span><span class="sxs-lookup"><span data-stu-id="89d32-294">As mentioned earlier, the ObjectDataSource has a pair of pre- and post-level events that fire during the data modification process.</span></span> <span data-ttu-id="89d32-295">叫用其 `Insert()` 方法時，ObjectDataSource 會先引發其 `Inserting` 事件，然後再呼叫其 `Insert()` 方法已對應的方法，最後引發 `Inserted` 事件。</span><span class="sxs-lookup"><span data-stu-id="89d32-295">When its `Insert()` method is invoked, the ObjectDataSource first raises its `Inserting` event, then calls the method that its `Insert()` method has been mapped to, and finally raises the `Inserted` event.</span></span> <span data-ttu-id="89d32-296">`Inserting` 事件處理常式為我們創造了最後一個機會來調整輸入參數，或直接取消作業。</span><span class="sxs-lookup"><span data-stu-id="89d32-296">The `Inserting` event handler affords us one last opportunity to tweak the input parameters or cancel the operation outright.</span></span>

> [!NOTE]
> <span data-ttu-id="89d32-297">在真實世界的應用程式中，您可能會想要讓使用者指定類別和供應商，或根據某些準則或商務邏輯為他們挑選此值（而不是盲目地選取識別碼1）。</span><span class="sxs-lookup"><span data-stu-id="89d32-297">In a real-world application you would likely want to either let the user specify the category and supplier or would pick this value for them based on some criteria or business logic (rather than blindly selecting an ID of 1).</span></span> <span data-ttu-id="89d32-298">不論如何，此範例會示範如何以程式設計方式，從 ObjectDataSource 的預先層級事件設定輸入參數的值。</span><span class="sxs-lookup"><span data-stu-id="89d32-298">Regardless, the example illustrates how to programmatically set the value of an input parameter from the ObjectDataSource's pre-level event.</span></span>

<span data-ttu-id="89d32-299">請花一些時間為 ObjectDataSource 的 `Inserting` 事件建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89d32-299">Take a moment to create an event handler for the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="89d32-300">請注意，事件處理常式的第二個輸入參數是 `ObjectDataSourceMethodEventArgs`類型的物件，它具有可存取參數集合（`InputParameters`）的屬性，以及用來取消作業（`Cancel`）的屬性。</span><span class="sxs-lookup"><span data-stu-id="89d32-300">Notice that the event handler's second input parameter is an object of type `ObjectDataSourceMethodEventArgs`, which has a property to access the parameters collection (`InputParameters`) and a property to cancel the operation (`Cancel`).</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample10.vb)]

<span data-ttu-id="89d32-301">此時，`InputParameters` 屬性會包含 ObjectDataSource 的 `InsertParameters` 集合，其中具有從 DetailsView 指派的值。</span><span class="sxs-lookup"><span data-stu-id="89d32-301">At this point, the `InputParameters` property contains the ObjectDataSource's `InsertParameters` collection with the values assigned from the DetailsView.</span></span> <span data-ttu-id="89d32-302">若要變更其中一個參數的值，只要使用： `e.InputParameters("paramName") = value`即可。</span><span class="sxs-lookup"><span data-stu-id="89d32-302">To change the value of one of these parameters, simply use: `e.InputParameters("paramName") = value`.</span></span> <span data-ttu-id="89d32-303">因此，若要將 `CategoryID` 和 `SupplierID` 設定為1的值，請調整 `Inserting` 事件處理常式，如下所示：</span><span class="sxs-lookup"><span data-stu-id="89d32-303">Therefore, to set the `CategoryID` and `SupplierID` to values of 1, adjust the `Inserting` event handler to look like the following:</span></span>

[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample11.vb)]

<span data-ttu-id="89d32-304">這次加入新產品（例如 Acme Soda）時，新產品的 [`CategoryID`] 和 [`SupplierID`] 資料行會設定為1（請參閱 [圖 20]）。</span><span class="sxs-lookup"><span data-stu-id="89d32-304">This time when adding a new product (such as Acme Soda), the `CategoryID` and `SupplierID` columns of the new product are set to 1 (see Figure 20).</span></span>

<span data-ttu-id="89d32-305">[![新產品現在已將其 [類別 Id] 和 [供應商] 值設定為1](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span><span class="sxs-lookup"><span data-stu-id="89d32-305">[![New Products Now Have Their CategoryID and SupplierID Values Set to 1](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span></span>

<span data-ttu-id="89d32-306">**圖 20**：新產品現在的 `CategoryID` 和 `SupplierID` 值設定為1（[按一下以觀看完整大小的影像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png)）</span><span class="sxs-lookup"><span data-stu-id="89d32-306">**Figure 20**: New Products Now Have Their `CategoryID` and `SupplierID` Values Set to 1 ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png))</span></span>

## <a name="summary"></a><span data-ttu-id="89d32-307">總結</span><span class="sxs-lookup"><span data-stu-id="89d32-307">Summary</span></span>

<span data-ttu-id="89d32-308">在編輯、插入及刪除進程期間，資料 Web 控制項和 ObjectDataSource 都會繼續進行許多前置和後置事件。</span><span class="sxs-lookup"><span data-stu-id="89d32-308">During the editing, inserting, and deleting process, both the data Web control and the ObjectDataSource proceed through a number of pre- and post-level events.</span></span> <span data-ttu-id="89d32-309">在本教學課程中，我們已檢查預先層級的事件，並瞭解如何使用這些事件來自訂輸入參數，或從資料 Web 控制項和 ObjectDataSource 的事件全部取消資料修改作業。</span><span class="sxs-lookup"><span data-stu-id="89d32-309">In this tutorial we examined the pre-level events and saw how to use these to customize the input parameters or cancel the data modification operation altogether both from the data Web control and ObjectDataSource's events.</span></span> <span data-ttu-id="89d32-310">在下一個教學課程中，我們將探討如何建立和使用後置事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89d32-310">In the next tutorial we'll look at creating and using event handlers for the post-level events.</span></span>

<span data-ttu-id="89d32-311">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="89d32-311">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="89d32-312">關於作者</span><span class="sxs-lookup"><span data-stu-id="89d32-312">About the Author</span></span>

<span data-ttu-id="89d32-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="89d32-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="89d32-314">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="89d32-314">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="89d32-315">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="89d32-315">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="89d32-316">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="89d32-316">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="89d32-317">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="89d32-317">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="89d32-318">特別感謝</span><span class="sxs-lookup"><span data-stu-id="89d32-318">Special Thanks To</span></span>

<span data-ttu-id="89d32-319">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="89d32-319">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="89d32-320">本教學課程的領導審查者為 Jackie Goor 和 Liz Shulok。</span><span class="sxs-lookup"><span data-stu-id="89d32-320">Lead reviewers for this tutorial were Jackie Goor and Liz Shulok.</span></span> <span data-ttu-id="89d32-321">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="89d32-321">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="89d32-322">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="89d32-322">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="89d32-323">[上一頁](an-overview-of-inserting-updating-and-deleting-data-vb.md)
> [下一頁](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span><span class="sxs-lookup"><span data-stu-id="89d32-323">[Previous](an-overview-of-inserting-updating-and-deleting-data-vb.md)
[Next](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span></span>
