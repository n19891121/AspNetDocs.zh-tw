---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
title: 新增其他 DataTable 資料行 (C#) |Microsoft Docs
author: rick-anderson
description: 使用 TableAdapter 精靈時建立的具類型資料集，對應的 DataTable 包含主要資料庫查詢所傳回的資料行。 但有...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 615f3361-f21f-4338-8bc1-fce8ae071de9
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
msc.type: authoredcontent
ms.openlocfilehash: 059538d3196aaa1fe3a70d9c02565e4e7af36881
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/01/2019
ms.locfileid: "57063635"
---
<a name="adding-additional-datatable-columns-c"></a><span data-ttu-id="84fba-104">新增其他 DataTable 資料行 (C#)</span><span class="sxs-lookup"><span data-stu-id="84fba-104">Adding Additional DataTable Columns (C#)</span></span>
====================
<span data-ttu-id="84fba-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="84fba-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="84fba-106">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip)或[下載 PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="84fba-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) or [Download PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span></span>

> <span data-ttu-id="84fba-107">使用 TableAdapter 精靈時建立的具類型資料集，對應的 DataTable 包含主要資料庫查詢所傳回的資料行。</span><span class="sxs-lookup"><span data-stu-id="84fba-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="84fba-108">但有些情況下，當 DataTable 需要包含其他資料行。</span><span class="sxs-lookup"><span data-stu-id="84fba-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="84fba-109">在本教學課程中我們了解當我們需要其他 DataTable 資料行時，為何建議預存程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>


## <a name="introduction"></a><span data-ttu-id="84fba-110">簡介</span><span class="sxs-lookup"><span data-stu-id="84fba-110">Introduction</span></span>

<span data-ttu-id="84fba-111">將 TableAdapter 加入時輸入的資料集，會將對應的 DataTable s 結構描述取決 TableAdapter s 主查詢。</span><span class="sxs-lookup"><span data-stu-id="84fba-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="84fba-112">比方說，如果主要的查詢會傳回資料欄位*A*， *B*，並*C*，DataTable 會有三個對應的資料行命名為*A*，*B*，並*C*。除了其主要的查詢，TableAdapter 還可以包含其他傳回，可能是，根據一些參數的資料子集的查詢。</span><span class="sxs-lookup"><span data-stu-id="84fba-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="84fba-113">比方說，在除了要`ProductsTableAdapter`s 主查詢，傳回所有產品的相關資訊，它也包含像是方法`GetProductsByCategoryID(categoryID)`和`GetProductByProductID(productID)`，傳回提供的參數為基礎的特定產品資訊。</span><span class="sxs-lookup"><span data-stu-id="84fba-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="84fba-114">S DataTable 的結構描述已反映 TableAdapter s 主查詢的模型適用於所有 TableAdapter 的方法會傳回相同或較少的資料欄位，比主查詢中所指定。</span><span class="sxs-lookup"><span data-stu-id="84fba-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="84fba-115">如果 TableAdapter 方法需要傳回其他資料欄位，然後我們應該展開 DataTable s 結構描述據以。</span><span class="sxs-lookup"><span data-stu-id="84fba-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="84fba-116">在 [主要/詳細說明使用具有詳細資料 DataList 的主要記錄項目符號清單](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)教學課程中我們會新增方法以`CategoriesTableAdapter`傳回`CategoryID`， `CategoryName`，和`Description`中定義的資料欄位加上的主查詢`NumberOfProducts`，報告的每個類別目錄相關聯的產品數目的其他資料欄位。</span><span class="sxs-lookup"><span data-stu-id="84fba-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="84fba-117">我們以手動方式新增至新的資料行`CategoriesDataTable`才能擷取`NumberOfProducts`資料欄位值從這個新方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="84fba-118">中所述[上傳檔案](../working-with-binary-files/uploading-files-cs.md)教學課程，但必須小心使用 TableAdapters，使用特定 SQL 陳述式，並具有其資料欄位不精確地符合主要查詢的方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-cs.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="84fba-119">如果重新執行 [TableAdapter 組態精靈，它會更新所有 TableAdapter 的方法，使其資料的欄位] 清單中選取符合主要查詢。</span><span class="sxs-lookup"><span data-stu-id="84fba-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="84fba-120">因此，使用自訂資料行清單的任何方法將會還原成主查詢 s 資料行清單，而不會傳回預期的資料。</span><span class="sxs-lookup"><span data-stu-id="84fba-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="84fba-121">使用預存程序時，就不會發生此問題。</span><span class="sxs-lookup"><span data-stu-id="84fba-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="84fba-122">在本教學課程中我們將探討如何擴充為包含其他資料行的 DataTable s 結構描述。</span><span class="sxs-lookup"><span data-stu-id="84fba-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="84fba-123">使用特定 SQL 陳述式時的 tableadapter 之脆弱度，因為在本教學課程中我們將使用預存程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="84fba-124">請參閱[建立新預存程序的輸入資料集 Tableadapter](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)並[使用現有預存程序的輸入資料集 Tableadapter](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs)教學課程，如需詳細資訊設定 TableAdapter 以使用預存程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="84fba-125">步驟 1：新增`PriceQuartile`資料行`ProductsDataTable`</span><span class="sxs-lookup"><span data-stu-id="84fba-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="84fba-126">在 *建立新預存程序的輸入資料集 Tableadapter*教學課程中我們建立名為具類型資料集`NorthwindWithSprocs`。</span><span class="sxs-lookup"><span data-stu-id="84fba-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="84fba-127">此資料集目前包含兩個 Datatable:`ProductsDataTable`和`EmployeesDataTable`。</span><span class="sxs-lookup"><span data-stu-id="84fba-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="84fba-128">`ProductsTableAdapter`具有下列三種方法：</span><span class="sxs-lookup"><span data-stu-id="84fba-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="84fba-129">`GetProducts` -傳回所有記錄的主要查詢`Products`資料表</span><span class="sxs-lookup"><span data-stu-id="84fba-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="84fba-130">`GetProductsByCategoryID(categoryID)` -傳回所有具有指定的產品*categoryID*。</span><span class="sxs-lookup"><span data-stu-id="84fba-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="84fba-131">`GetProductByProductID(productID)` -傳回具有指定的特定產品*productID*。</span><span class="sxs-lookup"><span data-stu-id="84fba-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="84fba-132">所有主要的查詢和兩個額外的方法傳回的資料欄位，也就是所有的資料行相同集`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="84fba-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="84fba-133">有任何相互關聯子查詢或`JOIN`s 提取相關的資料，從`Categories`或`Suppliers`資料表。</span><span class="sxs-lookup"><span data-stu-id="84fba-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="84fba-134">因此，`ProductsDataTable`對應的資料行中每個欄位`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="84fba-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="84fba-135">本教學課程中，可讓 s 將方法加入`ProductsTableAdapter`名為`GetProductsWithPriceQuartile`傳回所有產品。</span><span class="sxs-lookup"><span data-stu-id="84fba-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="84fba-136">除了標準產品資料欄位中，`GetProductsWithPriceQuartile`也會包含`PriceQuartile`資料欄位，指出產品的價格落在哪一個四分位數。</span><span class="sxs-lookup"><span data-stu-id="84fba-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="84fba-137">比方說，這些產品的價格均以最耗費資源的 25%會有`PriceQuartile`值為 1，而這些價格落在下 25%會有的值為 4。</span><span class="sxs-lookup"><span data-stu-id="84fba-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="84fba-138">我們會擔心建立預存程序來傳回這項資訊之前，不過，我們必須先更新`ProductsDataTable`包含的資料行來保存`PriceQuartile`結果時`GetProductsWithPriceQuartile`方法可用。</span><span class="sxs-lookup"><span data-stu-id="84fba-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="84fba-139">開啟`NorthwindWithSprocs`資料集，以滑鼠右鍵按一下`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="84fba-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="84fba-140">從操作功能表選擇 新增，然後選擇 資料行。</span><span class="sxs-lookup"><span data-stu-id="84fba-140">Choose Add from the context-menu and then pick Column.</span></span>


<span data-ttu-id="84fba-141">[![將新的資料行新增至 ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span></span>

<span data-ttu-id="84fba-142">**圖 1**:加入新的資料行，來`ProductsDataTable`([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image3.png))</span></span>


<span data-ttu-id="84fba-143">這會將新的資料行新增至名為 Column1 型別的 DataTable `System.String`。</span><span class="sxs-lookup"><span data-stu-id="84fba-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="84fba-144">我們需要更新此資料行的名稱 PriceQuartile 和其類型`System.Int32`因為它會用來保存 1 到 4 之間的數字。</span><span class="sxs-lookup"><span data-stu-id="84fba-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="84fba-145">選取新加入的資料行，在`ProductsDataTable`，然後從 屬性 視窗中，設定`Name`PriceQuartile 的屬性和`DataType`屬性設`System.Int32`。</span><span class="sxs-lookup"><span data-stu-id="84fba-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>


<span data-ttu-id="84fba-146">[![設定新的資料行的名稱和資料類型屬性](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span></span>

<span data-ttu-id="84fba-147">**圖 2**:設定新的資料行 s`Name`並`DataType`屬性 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image6.png))</span></span>


<span data-ttu-id="84fba-148">如 [圖 2] 所示，有可能被設定，例如資料行的值是否必須是唯一的資料行是否自動遞增資料行的其他屬性，zda bude 資料庫`NULL`值允許，依此類推。</span><span class="sxs-lookup"><span data-stu-id="84fba-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="84fba-149">保留為其預設值設定這些值。</span><span class="sxs-lookup"><span data-stu-id="84fba-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="84fba-150">步驟 2：建立`GetProductsWithPriceQuartile`方法</span><span class="sxs-lookup"><span data-stu-id="84fba-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="84fba-151">既然`ProductsDataTable`已更新為包含`PriceQuartile`資料行中，我們已準備好建立`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="84fba-152">啟動 TableAdapter 上按一下滑鼠右鍵，然後從操作功能表選擇加入查詢。</span><span class="sxs-lookup"><span data-stu-id="84fba-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="84fba-153">這會顯示 TableAdapter 查詢組態精靈，它首先會提示我們輸入有關我們是否想要使用特定 SQL 陳述式或新的或現有的預存程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="84fba-154">因為我們不您尚未建立傳回價格四分位數資料的預存程序，可讓 s 允許我們建立此預存程序的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="84fba-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="84fba-155">選取 建立新的預存程序選項，然後按一下 下一步。</span><span class="sxs-lookup"><span data-stu-id="84fba-155">Select the Create new stored procedure option and click Next.</span></span>


<span data-ttu-id="84fba-156">[![指示 TableAdapter 精靈為我們建立預存程序](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span></span>

<span data-ttu-id="84fba-157">**圖 3**:指示 TableAdapter 精靈以建立預存程序如我們 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image9.png))</span></span>


<span data-ttu-id="84fba-158">在後續畫面中，[圖 4] 所示精靈會詢問我們要加入查詢的類型。</span><span class="sxs-lookup"><span data-stu-id="84fba-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="84fba-159">由於`GetProductsWithPriceQuartile`方法會傳回所有資料行和資料錄從`Products`資料表中，選取 選取會傳回資料列的選項，然後按 下一步。</span><span class="sxs-lookup"><span data-stu-id="84fba-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>


<span data-ttu-id="84fba-160">[![我們的查詢將會在 SELECT 陳述式，傳回多個資料列](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span></span>

<span data-ttu-id="84fba-161">**圖 4**:我們的查詢將會`SELECT`陳述式，傳回多個資料列 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image12.png))</span></span>


<span data-ttu-id="84fba-162">接下來我們會提示輸入`SELECT`查詢。</span><span class="sxs-lookup"><span data-stu-id="84fba-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="84fba-163">在精靈中輸入下列查詢：</span><span class="sxs-lookup"><span data-stu-id="84fba-163">Enter the following query into the wizard:</span></span>


[!code-sql[Main](adding-additional-datatable-columns-cs/samples/sample1.sql)]

<span data-ttu-id="84fba-164">上述查詢會使用 SQL Server 2005 s 新[`NTILE`函式](https://msdn.microsoft.com/library/ms175126.aspx)若要將結果分成四個群組的群組由決定`UnitPrice`以遞減順序排序的值。</span><span class="sxs-lookup"><span data-stu-id="84fba-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="84fba-165">不幸的是，查詢產生器不知道如何剖析`OVER`關鍵字和剖析上述查詢時，會顯示錯誤。</span><span class="sxs-lookup"><span data-stu-id="84fba-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="84fba-166">而不需使用查詢產生器，因此，直接在文字方塊中，在精靈中輸入上述的查詢。</span><span class="sxs-lookup"><span data-stu-id="84fba-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="84fba-167">如需有關 NTILE 和 SQL Server 2005 s 其他排名函式，請參閱[傳回等級結果與 Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml)並[次序函數區段](https://msdn.microsoft.com/library/ms189798.aspx)從[SQLServer 2005 線上叢書 》](https://msdn.microsoft.com/library/ms189798.aspx)。</span><span class="sxs-lookup"><span data-stu-id="84fba-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/library/ms189798.aspx).</span></span>


<span data-ttu-id="84fba-168">輸入後`SELECT`查詢，並按一下 [下一步]，精靈會要求我們提供的名稱，它會建立預存程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="84fba-169">命名新的預存程序`Products_SelectWithPriceQuartile`，按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="84fba-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>


<span data-ttu-id="84fba-170">[![命名預存程序 Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span></span>

<span data-ttu-id="84fba-171">**圖 5**:命名預存程序`Products_SelectWithPriceQuartile`([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image15.png))</span></span>


<span data-ttu-id="84fba-172">最後，我們會提示您命名的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="84fba-173">保留的填滿 DataTable，然後傳回 DataTable 核取方塊已核取和名稱的方法`FillWithPriceQuartile`和`GetProductsWithPriceQuartile`。</span><span class="sxs-lookup"><span data-stu-id="84fba-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>


<span data-ttu-id="84fba-174">[![名稱的 tableadapter 方法，然後按一下 [完成]](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span></span>

<span data-ttu-id="84fba-175">**圖 6**:命名的 TableAdapter 的方法並按一下 [完成] ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image18.png))</span></span>


<span data-ttu-id="84fba-176">使用`SELECT`指定查詢和預存程序和 TableAdapter 方法名稱，按一下 [完成] 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="84fba-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="84fba-177">此時您可能會收到警告，或從精靈指出兩個`OVER`不支援 SQL 建構或陳述式。</span><span class="sxs-lookup"><span data-stu-id="84fba-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="84fba-178">您可以忽略這些警告。</span><span class="sxs-lookup"><span data-stu-id="84fba-178">These warnings can be ignored.</span></span>

<span data-ttu-id="84fba-179">完成精靈之後，應該包含 TableAdapter`FillWithPriceQuartile`並`GetProductsWithPriceQuartile`方法和資料庫應該包含名為預存程序`Products_SelectWithPriceQuartile`。</span><span class="sxs-lookup"><span data-stu-id="84fba-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="84fba-180">請花一點時間確認 TableAdapter 確實包含這個新方法，而且預存程序有已正確加入至資料庫。</span><span class="sxs-lookup"><span data-stu-id="84fba-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="84fba-181">如果您看不到預存程序再以滑鼠右鍵按一下 預存程序 資料夾並選擇 重新整理，請檢查資料庫。</span><span class="sxs-lookup"><span data-stu-id="84fba-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>


![確認新的方法，已加入至 TableAdapter](adding-additional-datatable-columns-cs/_static/image19.png)

<span data-ttu-id="84fba-183">**圖 7**:確認新的方法，已加入至 TableAdapter</span><span class="sxs-lookup"><span data-stu-id="84fba-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>


<span data-ttu-id="84fba-184">[![請確定資料庫包含 Products_SelectWithPriceQuartile 預存程序](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span></span>

<span data-ttu-id="84fba-185">**圖 8**:請確認資料庫包含`Products_SelectWithPriceQuartile`預存程序 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image22.png))</span></span>


> [!NOTE]
> <span data-ttu-id="84fba-186">使用預存程序，而不特定 SQL 陳述式的優點之一是重新執行 TableAdapter 組態精靈將不會修改預存程序資料行清單。</span><span class="sxs-lookup"><span data-stu-id="84fba-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="84fba-187">驗證，TableAdapter 上按一下滑鼠右鍵，選擇 [設定] 選項，從內容功能表啟動精靈，然後按一下 [完成] 來完成它。</span><span class="sxs-lookup"><span data-stu-id="84fba-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="84fba-188">接下來，移至資料庫，然後檢視`Products_SelectWithPriceQuartile`預存程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="84fba-189">請注意，不修改其資料行清單。</span><span class="sxs-lookup"><span data-stu-id="84fba-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="84fba-190">我們一直都使用特定 SQL 陳述式，重新執行 TableAdapter 組態精靈就會還原此查詢 s 資料行清單，以符合主要查詢資料行清單中，藉此將 NTILE 陳述式移除所使用的查詢`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>


<span data-ttu-id="84fba-191">當資料存取層 s`GetProductsWithPriceQuartile`叫用方法時，執行 TableAdapter`Products_SelectWithPriceQuartile`預存程序，並加入資料列來`ProductsDataTable`針對每個傳回資料錄。</span><span class="sxs-lookup"><span data-stu-id="84fba-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="84fba-192">預存程序所傳回的資料欄位會對應至`ProductsDataTable`s 資料行。</span><span class="sxs-lookup"><span data-stu-id="84fba-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="84fba-193">因為沒有`PriceQuartile`資料欄位所傳回的預存程序中，其值會指派給`ProductsDataTable`s`PriceQuartile`資料行。</span><span class="sxs-lookup"><span data-stu-id="84fba-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="84fba-194">其查詢不會傳回這些 TableAdapter 方法`PriceQuartile`資料欄位`PriceQuartile`資料行的值是所指定的值及其`DefaultValue`屬性。</span><span class="sxs-lookup"><span data-stu-id="84fba-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="84fba-195">如 [圖 2] 所示，此值設為`DBNull`，預設值。</span><span class="sxs-lookup"><span data-stu-id="84fba-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="84fba-196">如果您想要不同的預設值，只要將設定`DefaultValue`屬性據此。</span><span class="sxs-lookup"><span data-stu-id="84fba-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="84fba-197">只要確定`DefaultValue`值是有效的指定資料行 s `DataType` (亦即`System.Int32`如`PriceQuartile`資料行)。</span><span class="sxs-lookup"><span data-stu-id="84fba-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="84fba-198">此時，我們可以將額外的資料行加入至 DataTable 執行必要的步驟。</span><span class="sxs-lookup"><span data-stu-id="84fba-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="84fba-199">若要確認此額外的資料行如預期運作，讓建立 ASP.NET 網頁，顯示每個產品名稱、 價格和價格的四分位數。</span><span class="sxs-lookup"><span data-stu-id="84fba-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="84fba-200">這樣做之前，不過，我們必須先更新商務邏輯層，以納入方法呼叫向下到 DAL`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="84fba-201">我們將在步驟 3 中，接下來，更新 BLL，然後再建立在步驟 4 中的 ASP.NET 網頁。</span><span class="sxs-lookup"><span data-stu-id="84fba-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="84fba-202">步驟 3：擴充商業邏輯層</span><span class="sxs-lookup"><span data-stu-id="84fba-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="84fba-203">我們使用新之前`GetProductsWithPriceQuartile`方法從展示層中，我們應該先將對應的方法加入 BLL。</span><span class="sxs-lookup"><span data-stu-id="84fba-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="84fba-204">開啟`ProductsBLLWithSprocs`類別檔案，然後將下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="84fba-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>


[!code-csharp[Main](adding-additional-datatable-columns-cs/samples/sample2.cs)]

<span data-ttu-id="84fba-205">中的其他資料擷取方法一樣`ProductsBLLWithSprocs`，則`GetProductsWithPriceQuartile`方法會直接呼叫 DAL s 對應`GetProductsWithPriceQuartile`方法，並傳回其結果。</span><span class="sxs-lookup"><span data-stu-id="84fba-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="84fba-206">步驟 4：在 ASP.NET 網頁中顯示的價格四分位數資訊</span><span class="sxs-lookup"><span data-stu-id="84fba-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="84fba-207">加上 BLL 完成我們準備好要建立的 ASP.NET 網頁，顯示每項產品的價格四分位數。</span><span class="sxs-lookup"><span data-stu-id="84fba-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="84fba-208">開啟`AddingColumns.aspx`頁面中`AdvancedDAL`資料夾，然後拖曳的 GridView，從 [工具箱] 拖曳至設計工具，設定其`ID`屬性設`Products`。</span><span class="sxs-lookup"><span data-stu-id="84fba-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="84fba-209">從 GridView s 智慧標籤，將它繫結至名為新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="84fba-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="84fba-210">設定要使用 ObjectDataSource`ProductsBLLWithSprocs`類別的`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="84fba-211">因為這會是唯讀的方格，設定下拉式清單中更新、 插入和刪除 （無） 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="84fba-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="84fba-212">[![設定使用 ProductsBLLWithSprocs 類別 ObjectDataSource](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span></span>

<span data-ttu-id="84fba-213">**圖 9**:設定要使用 ObjectDataSource`ProductsBLLWithSprocs`類別 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image25.png))</span></span>


<span data-ttu-id="84fba-214">[![從 GetProductsWithPriceQuartile 方法擷取產品資訊](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span></span>

<span data-ttu-id="84fba-215">**圖 10**:擷取產品資訊`GetProductsWithPriceQuartile`方法 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image28.png))</span></span>


<span data-ttu-id="84fba-216">完成設定資料來源精靈之後，Visual Studio 會自動加入 BoundField 或 CheckBoxField 至 GridView 的每個方法所傳回的資料欄位。</span><span class="sxs-lookup"><span data-stu-id="84fba-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="84fba-217">其中一個資料欄位是`PriceQuartile`，這是我們所新增的資料行`ProductsDataTable`在步驟 1 中。</span><span class="sxs-lookup"><span data-stu-id="84fba-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="84fba-218">編輯移除的 GridView 的欄位以外的所有`ProductName`， `UnitPrice`，和`PriceQuartile`BoundFields。</span><span class="sxs-lookup"><span data-stu-id="84fba-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="84fba-219">設定`UnitPrice`格式化其值為貨幣，並讓 BoundField`UnitPrice`和`PriceQuartile`BoundFields 右邊-和置中對齊，分別。</span><span class="sxs-lookup"><span data-stu-id="84fba-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="84fba-220">最後，更新 剩餘 BoundFields`HeaderText`屬性，以產品、 價格和價格的四分位數，分別。</span><span class="sxs-lookup"><span data-stu-id="84fba-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="84fba-221">而且請檢查啟用排序 核取方塊的 GridView s 智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="84fba-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="84fba-222">這些修改之後, 的 GridView 和 ObjectDataSource s 宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="84fba-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](adding-additional-datatable-columns-cs/samples/sample3.aspx)]

<span data-ttu-id="84fba-223">[圖 11] 顯示當透過瀏覽器瀏覽此頁面。</span><span class="sxs-lookup"><span data-stu-id="84fba-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="84fba-224">請注意，一開始，產品會按照其價格，以遞減順序，指派適當的各項產品的`PriceQuartile`值。</span><span class="sxs-lookup"><span data-stu-id="84fba-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="84fba-225">當然這項資料可依其他準則仍然反映價格方面的產品 s 順位的價格四分位數的資料行值 （請參閱 圖 12）。</span><span class="sxs-lookup"><span data-stu-id="84fba-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>


<span data-ttu-id="84fba-226">[![其價格依排序產品](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span></span>

<span data-ttu-id="84fba-227">**圖 11**:其價格依排序產品 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image31.png))</span></span>


<span data-ttu-id="84fba-228">[![依名稱排序的產品](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="84fba-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span></span>

<span data-ttu-id="84fba-229">**圖 12**:依名稱排序的產品 ([按一下以檢視完整大小的影像](adding-additional-datatable-columns-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="84fba-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image34.png))</span></span>


> [!NOTE]
> <span data-ttu-id="84fba-230">只要幾行程式碼我們可以增強 GridView，因此它不同色彩為基礎的產品資料列及其`PriceQuartile`值。</span><span class="sxs-lookup"><span data-stu-id="84fba-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="84fba-231">我們可能色彩中第一的四分位數淺綠色，第二個四分位數淺黃色中的這些產品等等。</span><span class="sxs-lookup"><span data-stu-id="84fba-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="84fba-232">建議您花點時間，以新增這項功能。</span><span class="sxs-lookup"><span data-stu-id="84fba-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="84fba-233">如果您需要複習一下格式化 GridView，請參閱[自訂格式化時資料](../custom-formatting/custom-formatting-based-upon-data-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="84fba-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-cs.md) tutorial.</span></span>


## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="84fba-234">替代方法-建立另一個的 TableAdapter</span><span class="sxs-lookup"><span data-stu-id="84fba-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="84fba-235">如我們所見在本教學課程中，將方法加入 TableAdapter 傳回以外的資料欄位拼出，主要的查詢時，我們可以加入至 DataTable 的對應資料行。</span><span class="sxs-lookup"><span data-stu-id="84fba-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="84fba-236">這種方式，不過，也只有少數的 TableAdapter 方法會傳回不同的資料欄位，以及這些替代的資料欄位不會改變太多來自主要查詢的運作方式。</span><span class="sxs-lookup"><span data-stu-id="84fba-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="84fba-237">而不是加入至 DataTable 的資料行，您可以改為包含從第一個的 TableAdapter 方法會傳回不同的資料欄位的資料集加入另一個 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="84fba-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="84fba-238">本教學課程中，而不是新增`PriceQuartile`資料行`ProductsDataTable`(其中它僅供`GetProductsWithPriceQuartile`方法)，我們可以加入額外的 TableAdapter 名為資料集`ProductsWithPriceQuartileTableAdapter`使用`Products_SelectWithPriceQuartile`儲存為其主要查詢的程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="84fba-239">若要取得產品資訊價格的四分位數的所需的 ASP.NET 網頁會使用`ProductsWithPriceQuartileTableAdapter`，而不提供支援，可以繼續使用`ProductsTableAdapter`。</span><span class="sxs-lookup"><span data-stu-id="84fba-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="84fba-240">藉由新增新的 TableAdapter，Datatable 保持 untarnished 和其資料行精確地鏡像其 TableAdapter 的方法所傳回的資料欄位。</span><span class="sxs-lookup"><span data-stu-id="84fba-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="84fba-241">不過，重複的工作和功能，可以導入額外的 Tableadapter。</span><span class="sxs-lookup"><span data-stu-id="84fba-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="84fba-242">比方說，如果這些 ASP.NET 頁面顯示`PriceQuartile`資料行也需要提供 insert、 update 和 delete 支援`ProductsWithPriceQuartileTableAdapter`必須要有其`InsertCommand`， `UpdateCommand`，和`DeleteCommand`屬性正確設定。</span><span class="sxs-lookup"><span data-stu-id="84fba-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="84fba-243">雖然這些屬性會反映`ProductsTableAdapter`s，此組態會引進額外的步驟。</span><span class="sxs-lookup"><span data-stu-id="84fba-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="84fba-244">此外，現在有兩種方式可以更新，請刪除，或透過加入至資料庫的產品`ProductsTableAdapter`和`ProductsWithPriceQuartileTableAdapter`類別。</span><span class="sxs-lookup"><span data-stu-id="84fba-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="84fba-245">本教學課程中下載項目包括`ProductsWithPriceQuartileTableAdapter`類別中`NorthwindWithSprocs`說明此替代方法的資料集。</span><span class="sxs-lookup"><span data-stu-id="84fba-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="84fba-246">總結</span><span class="sxs-lookup"><span data-stu-id="84fba-246">Summary</span></span>

<span data-ttu-id="84fba-247">在大部分情況下，所有在 TableAdapter 方法會傳回相同的資料欄位，但有傳回一個額外欄位，有時可能的需要特定的方法或兩個。</span><span class="sxs-lookup"><span data-stu-id="84fba-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="84fba-248">例如，在[主要/詳細說明使用具有詳細資料 DataList 的主要記錄項目符號清單](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)教學課程中我們會新增方法以`CategoriesTableAdapter`，，除了主要查詢的資料欄位，傳回`NumberOfProducts`欄位報告每個類別目錄相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="84fba-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="84fba-249">在本教學課程中我們探討加入方法中的`ProductsTableAdapter`傳回`PriceQuartile`除了主要查詢的資料欄位的欄位。</span><span class="sxs-lookup"><span data-stu-id="84fba-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="84fba-250">若要擷取其他資料欄位所傳回的 TableAdapter 的方法我們要將對應的資料行加入至 DataTable。</span><span class="sxs-lookup"><span data-stu-id="84fba-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="84fba-251">如果您打算以手動方式將資料行加入至 DataTable，建議您使用 TableAdapter 使用預存程序。</span><span class="sxs-lookup"><span data-stu-id="84fba-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="84fba-252">如果 TableAdapter 會使用特定 SQL 陳述式，隨時 TableAdapter 組態精靈會執行的所有資料欄位清單還原為主查詢所傳回的資料欄位的方法。</span><span class="sxs-lookup"><span data-stu-id="84fba-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="84fba-253">這個問題不會延伸預存程序，這也是為什麼它們建議，並在本教學課程所使用。</span><span class="sxs-lookup"><span data-stu-id="84fba-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="84fba-254">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="84fba-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="84fba-255">關於作者</span><span class="sxs-lookup"><span data-stu-id="84fba-255">About the Author</span></span>

<span data-ttu-id="84fba-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="84fba-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="84fba-257">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="84fba-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="84fba-258">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="84fba-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="84fba-259">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="84fba-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="84fba-260">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="84fba-260">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="84fba-261">特別感謝</span><span class="sxs-lookup"><span data-stu-id="84fba-261">Special Thanks To</span></span>

<span data-ttu-id="84fba-262">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="84fba-262">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="84fba-263">本教學課程中的潛在客戶檢閱者已 Randy Schmidt、 Jacky Goor、 Bernadette Leigh 和 Hilton giesenow 將。</span><span class="sxs-lookup"><span data-stu-id="84fba-263">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="84fba-264">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="84fba-264">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="84fba-265">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="84fba-265">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="84fba-266">[上一頁](updating-the-tableadapter-to-use-joins-cs.md)
> [下一頁](working-with-computed-columns-cs.md)</span><span class="sxs-lookup"><span data-stu-id="84fba-266">[Previous](updating-the-tableadapter-to-use-joins-cs.md)
[Next](working-with-computed-columns-cs.md)</span></span>
