---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
title: 設定資料存取層的連接和命令層級設定（VB） |Microsoft Docs
author: rick-anderson
description: 具類型資料集內的 Tableadapter 會自動負責連接到資料庫、發出命令，並以結果填入 DataTable 。
ms.author: riande
ms.date: 08/03/2007
ms.assetid: d57dfa2b-d627-45cb-b5b1-abbf3159d770
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
msc.type: authoredcontent
ms.openlocfilehash: fa2868fc0dd8acd76f600b47d92adb984ce8d105
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78551804"
---
# <a name="configuring-the-data-access-layers-connection--and-command-level-settings-vb"></a><span data-ttu-id="4e04e-103">設定資料存取層的連線和命令層級設定 (VB)</span><span class="sxs-lookup"><span data-stu-id="4e04e-103">Configuring the Data Access Layer's Connection- and Command-Level Settings (VB)</span></span>

<span data-ttu-id="4e04e-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="4e04e-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="4e04e-105">[下載程式代碼](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip)或[下載 PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="4e04e-105">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip) or [Download PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)</span></span>

> <span data-ttu-id="4e04e-106">具類型資料集內的 Tableadapter 會自動負責連接到資料庫、發出命令，以及以結果擴展 DataTable。</span><span class="sxs-lookup"><span data-stu-id="4e04e-106">The TableAdapters within a Typed DataSet automatically take care of connecting to the database, issuing commands, and populating a DataTable with the results.</span></span> <span data-ttu-id="4e04e-107">有時候，我們想要自行處理這些細節，而在本教學課程中，我們將學習如何存取 TableAdapter 中的資料庫連接和命令層級設定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-107">There are occasions however when we want to take care of these details ourselves, and in this tutorial we learn how to access the database connection- and command-level settings in the TableAdapter.</span></span>

## <a name="introduction"></a><span data-ttu-id="4e04e-108">簡介</span><span class="sxs-lookup"><span data-stu-id="4e04e-108">Introduction</span></span>

<span data-ttu-id="4e04e-109">在整個教學課程系列中，我們使用了具類型的資料集來執行分層架構的資料存取層和商務物件。</span><span class="sxs-lookup"><span data-stu-id="4e04e-109">Throughout the tutorial series we have used Typed DataSets to implement the Data Access Layer and business objects of our layered architecture.</span></span> <span data-ttu-id="4e04e-110">如[第一個教學](../introduction/creating-a-data-access-layer-vb.md)課程中所討論，具類型資料集的 datatable 當做資料存放庫，而 tableadapter 則是做為與資料庫進行通訊的包裝函式，以取得和修改基礎資料。</span><span class="sxs-lookup"><span data-stu-id="4e04e-110">As discussed in the [first tutorial](../introduction/creating-a-data-access-layer-vb.md), the Typed DataSet s DataTables serve as repositories of data whereas the TableAdapters act as wrappers to communicate with the database to retrieve and modify the underlying data.</span></span> <span data-ttu-id="4e04e-111">Tableadapter 會封裝使用資料庫所牽涉到的複雜性，並讓我們不必撰寫程式碼來連接到資料庫、發出命令，或將結果填入 DataTable。</span><span class="sxs-lookup"><span data-stu-id="4e04e-111">The TableAdapters encapsulate the complexity involved in working with the database and saves us from having to write code to connect to the database, issue a command, or populate the results into a DataTable.</span></span>

<span data-ttu-id="4e04e-112">不過有時候，當我們需要 burrow 到 TableAdapter 的深度，並撰寫直接與 ADO.NET 物件搭配運作的程式碼時。</span><span class="sxs-lookup"><span data-stu-id="4e04e-112">There are times, however, when we need to burrow into the depths of the TableAdapter and write code that works directly with the ADO.NET objects.</span></span> <span data-ttu-id="4e04e-113">例如，在交易教學課程[中的包裝資料庫修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)中，我們已將方法新增至 TableAdapter，以開始、認可和回復 ADO.NET 交易。</span><span class="sxs-lookup"><span data-stu-id="4e04e-113">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, for example, we added methods to the TableAdapter for beginning, committing, and rolling back ADO.NET transactions.</span></span> <span data-ttu-id="4e04e-114">這些方法會使用已指派給 TableAdapter `SqlCommand` 物件的內部手動建立 `SqlTransaction` 物件。</span><span class="sxs-lookup"><span data-stu-id="4e04e-114">These methods used an internal, manually-created `SqlTransaction` object that was assigned to the TableAdapter s `SqlCommand` objects.</span></span>

<span data-ttu-id="4e04e-115">在本教學課程中，我們將探討如何存取 TableAdapter 中的資料庫連接和命令層級設定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-115">In this tutorial we will examine how to access the database connection- and command-level settings in the TableAdapter.</span></span> <span data-ttu-id="4e04e-116">特別的是，我們會將功能加入至 `ProductsTableAdapter`，以啟用基礎連接字串和命令逾時設定的存取權。</span><span class="sxs-lookup"><span data-stu-id="4e04e-116">In particular, we will add functionality to the `ProductsTableAdapter` that enables access to the underlying connection string and command timeout settings.</span></span>

## <a name="working-with-data-using-adonet"></a><span data-ttu-id="4e04e-117">使用 ADO.NET 處理資料</span><span class="sxs-lookup"><span data-stu-id="4e04e-117">Working with Data Using ADO.NET</span></span>

<span data-ttu-id="4e04e-118">Microsoft .NET Framework 包含專門設計來處理資料的類別眾多。</span><span class="sxs-lookup"><span data-stu-id="4e04e-118">The Microsoft .NET Framework contains a plethora of classes designed specifically to work with data.</span></span> <span data-ttu-id="4e04e-119">這些類別（位於[`System.Data` 命名空間](https://msdn.microsoft.com/library/system.data.aspx)內）稱為*ADO.NET*類別。</span><span class="sxs-lookup"><span data-stu-id="4e04e-119">These classes, found within the [`System.Data` namespace](https://msdn.microsoft.com/library/system.data.aspx), are referred to as the *ADO.NET* classes.</span></span> <span data-ttu-id="4e04e-120">ADO.NET 傘底下的某些類別會系結至特定的*資料提供者*。</span><span class="sxs-lookup"><span data-stu-id="4e04e-120">Some of the classes under the ADO.NET umbrella are tied to a particular *data provider*.</span></span> <span data-ttu-id="4e04e-121">您可以將資料提供者視為通道，讓資訊可以在 ADO.NET 類別與基礎資料存放區之間流動。</span><span class="sxs-lookup"><span data-stu-id="4e04e-121">You can think of a data provider as a communication channel that allows information to flow between the ADO.NET classes and the underlying data store.</span></span> <span data-ttu-id="4e04e-122">有一般化的提供者，例如 OleDb 和 ODBC，以及專為特定資料庫系統設計的提供者。</span><span class="sxs-lookup"><span data-stu-id="4e04e-122">There are generalized providers, like OleDb and ODBC, as well as providers that are specially designed for a particular database system.</span></span> <span data-ttu-id="4e04e-123">例如，雖然您可以使用 OleDb 提供者連接到 Microsoft SQL Server 資料庫，但 SqlClient 提供者會更有效率，因為它是專為 SQL Server 而設計和優化的。</span><span class="sxs-lookup"><span data-stu-id="4e04e-123">For example, while it is possible to connect to a Microsoft SQL Server database using the OleDb provider, the SqlClient provider is much more efficient as it was designed and optimized specifically for SQL Server.</span></span>

<span data-ttu-id="4e04e-124">以程式設計方式存取資料時，通常會使用下列模式：</span><span class="sxs-lookup"><span data-stu-id="4e04e-124">When programmatically accessing data, the following pattern is commonly used:</span></span>

1. <span data-ttu-id="4e04e-125">建立資料庫的連接。</span><span class="sxs-lookup"><span data-stu-id="4e04e-125">Establish a connection to the database.</span></span>
2. <span data-ttu-id="4e04e-126">發出命令。</span><span class="sxs-lookup"><span data-stu-id="4e04e-126">Issue a command.</span></span>
3. <span data-ttu-id="4e04e-127">針對 `SELECT` 查詢，請使用所產生的記錄。</span><span class="sxs-lookup"><span data-stu-id="4e04e-127">For `SELECT` queries, work with the resulting records.</span></span>

<span data-ttu-id="4e04e-128">有個別的 ADO.NET 類別可用於執行上述每個步驟。</span><span class="sxs-lookup"><span data-stu-id="4e04e-128">There are separate ADO.NET classes for performing each of these steps.</span></span> <span data-ttu-id="4e04e-129">例如，若要使用 SqlClient 提供者連接到資料庫，請使用[`SqlConnection` 類別](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="4e04e-129">To connect to a database using the SqlClient provider, for example, use the [`SqlConnection` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx).</span></span> <span data-ttu-id="4e04e-130">若要對資料庫發出 `INSERT`、`UPDATE`、`DELETE`或 `SELECT` 命令，請使用[`SqlCommand` 類別](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4e04e-130">To issue an `INSERT`, `UPDATE`, `DELETE`, or `SELECT` command to the database, use the [`SqlCommand` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx).</span></span>

<span data-ttu-id="4e04e-131">除了交易教學課程[中的包裝資料庫修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)外，我們也不需要自行撰寫任何低層級的 ADO.NET 程式碼，因為 tableadapter 自動產生的程式碼包含連接到資料庫所需的功能、發出命令、抓取資料，並將該資料填入 datatable。</span><span class="sxs-lookup"><span data-stu-id="4e04e-131">Except for the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial, we have not had to write any low-level ADO.NET code ourselves because the TableAdapters auto-generated code includes the functionality needed to connect to the database, issue commands, retrieve data, and populate that data into DataTables.</span></span> <span data-ttu-id="4e04e-132">不過，有時候我們可能需要自訂這些低層級的設定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-132">However, there may be times when we need to customize these low-level settings.</span></span> <span data-ttu-id="4e04e-133">在接下來的幾個步驟中，我們將探討如何利用 Tableadapter 在內部使用的 ADO.NET 物件。</span><span class="sxs-lookup"><span data-stu-id="4e04e-133">Over the next few steps we will examine how to tap into the ADO.NET objects used internally by the TableAdapters.</span></span>

## <a name="step-1-examining-with-the-connection-property"></a><span data-ttu-id="4e04e-134">步驟1：使用連接屬性進行檢查</span><span class="sxs-lookup"><span data-stu-id="4e04e-134">Step 1: Examining with the Connection Property</span></span>

<span data-ttu-id="4e04e-135">每個 TableAdapter 類別都有指定資料庫連接資訊的 `Connection` 屬性。</span><span class="sxs-lookup"><span data-stu-id="4e04e-135">Each TableAdapter class has a `Connection` property that specifies database connection information.</span></span> <span data-ttu-id="4e04e-136">這個屬性的資料類型和 `ConnectionString` 值是由 [TableAdapter 設定] [wizard] 中所做的選擇所決定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-136">This property s data type and `ConnectionString` value are determined by the selections made in the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="4e04e-137">回想一下，當我們第一次將 TableAdapter 加入至具類型的資料集時，此 wizard 會向我們詢問資料庫來源（請參閱 [圖 1]）。</span><span class="sxs-lookup"><span data-stu-id="4e04e-137">Recall that when we first add a TableAdapter to a Typed DataSet this wizard asks us for the database source (see Figure 1).</span></span> <span data-ttu-id="4e04e-138">第一個步驟中的下拉式清單包括設定檔中所指定的資料庫，以及伺服器總管 s 資料連線中的任何其他資料庫。</span><span class="sxs-lookup"><span data-stu-id="4e04e-138">The drop-down list in this first step includes those databases specified in the configuration file as well as any other databases in the Server Explorer s Data Connections.</span></span> <span data-ttu-id="4e04e-139">如果下拉式清單中沒有想要使用的資料庫，您可以按一下 [新增連接] 按鈕，並提供所需的連接資訊來指定新的資料庫連接。</span><span class="sxs-lookup"><span data-stu-id="4e04e-139">If the database we want to use does not exist in the drop-down list, a new database connection can be specified by clicking the New Connection button and providing the needed connection information.</span></span>

<span data-ttu-id="4e04e-140">[![TableAdapter Configuration Wizard 的第一個步驟](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="4e04e-140">[![The First Step of the TableAdapter Configuration Wizard](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)</span></span>

<span data-ttu-id="4e04e-141">**圖 1**： TableAdapter 設定 Wizard 的第一個步驟（[按一下以查看完整大小的影像](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="4e04e-141">**Figure 1**: The First Step of the TableAdapter Configuration Wizard ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))</span></span>

<span data-ttu-id="4e04e-142">讓我們花點時間檢查 TableAdapter `Connection` 屬性的程式碼。</span><span class="sxs-lookup"><span data-stu-id="4e04e-142">Let s take a moment to inspect the code for the TableAdapter s `Connection` property.</span></span> <span data-ttu-id="4e04e-143">如[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)教學課程中所述，我們可以前往 [類別檢視] 視窗來查看自動產生的 TableAdapter 程式碼，向下切入至適當的類別，然後按兩下該成員名稱。</span><span class="sxs-lookup"><span data-stu-id="4e04e-143">As noted in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we can view the auto-generated TableAdapter code by going to the Class View window, drilling down to the appropriate class, and then double-clicking the member name.</span></span>

<span data-ttu-id="4e04e-144">前往 [View] 功能表，然後選擇 [類別檢視] （或輸入 Ctrl + Shift + C），以流覽至 [類別檢視] 視窗。</span><span class="sxs-lookup"><span data-stu-id="4e04e-144">Navigate to the Class View window by going to the View menu and choosing Class View (or by typing Ctrl+Shift+C).</span></span> <span data-ttu-id="4e04e-145">從 [類別檢視] 視窗的上半部，向下切入至 [`NorthwindTableAdapters`] 命名空間，然後選取 [`ProductsTableAdapter`] 類別。</span><span class="sxs-lookup"><span data-stu-id="4e04e-145">From the top half of the Class View window, drill down to the `NorthwindTableAdapters` namespace and select the `ProductsTableAdapter` class.</span></span> <span data-ttu-id="4e04e-146">這會在類別檢視的下半部顯示 `ProductsTableAdapter` s 成員，如 [圖 2] 所示。</span><span class="sxs-lookup"><span data-stu-id="4e04e-146">This will display the `ProductsTableAdapter` s members in the bottom half of the Class View, as shown in Figure 2.</span></span> <span data-ttu-id="4e04e-147">按兩下 [`Connection`] 屬性以查看其程式碼。</span><span class="sxs-lookup"><span data-stu-id="4e04e-147">Double-click the `Connection` property to see its code.</span></span>

![按兩下 類別檢視中的 連接 屬性，以查看其自動產生的程式碼](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image4.png)

<span data-ttu-id="4e04e-149">**圖 2**：按兩下 類別檢視中的連接屬性，以查看其自動產生的程式碼</span><span class="sxs-lookup"><span data-stu-id="4e04e-149">**Figure 2**: Double-Click the Connection Property in the Class View to View Its Auto-Generated Code</span></span>

<span data-ttu-id="4e04e-150">TableAdapter `Connection` 屬性和其他連接相關的程式碼如下所示：</span><span class="sxs-lookup"><span data-stu-id="4e04e-150">The TableAdapter s `Connection` property and other connection-related code follows:</span></span>

[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample1.vb)]

<span data-ttu-id="4e04e-151">當 TableAdapter 類別具現化時，`_connection` 的成員變數等於 `Nothing`。</span><span class="sxs-lookup"><span data-stu-id="4e04e-151">When the TableAdapter class is instantiated, the member variable `_connection` is equal to `Nothing`.</span></span> <span data-ttu-id="4e04e-152">存取 `Connection` 屬性時，會先檢查 `_connection` 的成員變數是否已具現化。</span><span class="sxs-lookup"><span data-stu-id="4e04e-152">When the `Connection` property is accessed, it first checks to see if the `_connection` member variable has been instantiated.</span></span> <span data-ttu-id="4e04e-153">如果沒有，則會叫用 `InitConnection` 方法，它會將 `_connection` 具現化，並將其 `ConnectionString` 屬性設定為從 TableAdapter Configuration wizard 第一個步驟指定的連接字串值。</span><span class="sxs-lookup"><span data-stu-id="4e04e-153">If it has not, the `InitConnection` method is invoked, which instantiates `_connection` and sets its `ConnectionString` property to the connection string value specified from the TableAdapter Configuration wizard s first step.</span></span>

<span data-ttu-id="4e04e-154">`Connection` 屬性也可以指派給 `SqlConnection` 物件。</span><span class="sxs-lookup"><span data-stu-id="4e04e-154">The `Connection` property can also be assigned to a `SqlConnection` object.</span></span> <span data-ttu-id="4e04e-155">這麼做會使新的 `SqlConnection` 物件與每個 TableAdapter `SqlCommand` 物件產生關聯。</span><span class="sxs-lookup"><span data-stu-id="4e04e-155">Doing so associates the new `SqlConnection` object with each of the TableAdapter s `SqlCommand` objects.</span></span>

## <a name="step-2-exposing-connection-level-settings"></a><span data-ttu-id="4e04e-156">步驟2：公開連接層級設定</span><span class="sxs-lookup"><span data-stu-id="4e04e-156">Step 2: Exposing Connection-Level Settings</span></span>

<span data-ttu-id="4e04e-157">連接資訊應該保持封裝在 TableAdapter 內，而應用程式架構中的其他層則無法存取。</span><span class="sxs-lookup"><span data-stu-id="4e04e-157">The connection information should remain encapsulated within the TableAdapter and not be accessible to other layers in the application architecture.</span></span> <span data-ttu-id="4e04e-158">不過，在某些情況下，可能需要為查詢、使用者或 ASP.NET 網頁存取或自訂 TableAdapter 的連接層級資訊。</span><span class="sxs-lookup"><span data-stu-id="4e04e-158">However, there may be scenarios when the TableAdapter s connection-level information needs to be accessible or customizable for a query, user, or ASP.NET page.</span></span>

<span data-ttu-id="4e04e-159">讓 s 擴充 `Northwind` 資料集中的 `ProductsTableAdapter`，使其包含可供商務邏輯層用來讀取或變更 TableAdapter 所使用之連接字串的 `ConnectionString` 屬性。</span><span class="sxs-lookup"><span data-stu-id="4e04e-159">Let s extend the `ProductsTableAdapter` in the `Northwind` DataSet to include a `ConnectionString` property that can be used by the Business Logic Layer to read or change the connection string used by the TableAdapter.</span></span>

> [!NOTE]
> <span data-ttu-id="4e04e-160">*連接字串*是一個字串，用來指定資料庫連接資訊，例如要使用的提供者、資料庫的位置、驗證認證，以及其他與資料庫相關的設定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-160">A *connection string* is a string that specifies database connection information, such as the provider to use, the location of the database, authentication credentials, and other database-related settings.</span></span> <span data-ttu-id="4e04e-161">如需各種資料存放區和提供者所使用的連接字串模式清單，請參閱[ConnectionStrings.com](http://www.connectionstrings.com/)。</span><span class="sxs-lookup"><span data-stu-id="4e04e-161">For a list of connection string patterns used by a variety of data stores and providers, see [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>

<span data-ttu-id="4e04e-162">如[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)教學課程所述，具類型資料集 s 自動產生的類別可以透過使用部分類別來擴充。</span><span class="sxs-lookup"><span data-stu-id="4e04e-162">As discussed in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, the Typed DataSet s auto-generated classes can be extended through the use of partial classes.</span></span> <span data-ttu-id="4e04e-163">首先，在名為 `ConnectionAndCommandSettings` 的專案中，于 [`~/App_Code/DAL`] 資料夾之下建立新的子資料夾。</span><span class="sxs-lookup"><span data-stu-id="4e04e-163">First, create a new subfolder in the project named `ConnectionAndCommandSettings` underneath the `~/App_Code/DAL` folder.</span></span>

![新增名為 ConnectionAndCommandSettings 的子資料夾](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image5.png)

<span data-ttu-id="4e04e-165">**圖 3**：新增名為 `ConnectionAndCommandSettings` 的子資料夾</span><span class="sxs-lookup"><span data-stu-id="4e04e-165">**Figure 3**: Add a Subfolder Named `ConnectionAndCommandSettings`</span></span>

<span data-ttu-id="4e04e-166">新增名為 `ProductsTableAdapter.ConnectionAndCommandSettings.vb` 的類別檔案，並輸入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="4e04e-166">Add a new class file named `ProductsTableAdapter.ConnectionAndCommandSettings.vb` and enter the following code:</span></span>

[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample2.vb)]

<span data-ttu-id="4e04e-167">這個部分類別會將名為 `ConnectionString` 的 `Public` 屬性加入至 `ProductsTableAdapter` 類別，讓任何圖層都可以讀取或更新 TableAdapter s 基礎連接的連接字串。</span><span class="sxs-lookup"><span data-stu-id="4e04e-167">This partial class adds a `Public` property named `ConnectionString` to the `ProductsTableAdapter` class that allows any layer to read or update the connection string for the TableAdapter s underlying connection.</span></span>

<span data-ttu-id="4e04e-168">在建立（並儲存）這個部分類別的情況下，開啟 [`ProductsBLL`] 類別。</span><span class="sxs-lookup"><span data-stu-id="4e04e-168">With this partial class created (and saved), open the `ProductsBLL` class.</span></span> <span data-ttu-id="4e04e-169">移至其中一個現有的方法，並在 `Adapter` 中輸入，然後按 [period] 鍵以顯示 IntelliSense。</span><span class="sxs-lookup"><span data-stu-id="4e04e-169">Go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="4e04e-170">您應該會在 IntelliSense 中看到新的 `ConnectionString` 屬性，這表示您可以透過程式設計方式從 BLL 讀取或調整此值。</span><span class="sxs-lookup"><span data-stu-id="4e04e-170">You should see the new `ConnectionString` property available in IntelliSense, meaning that you can programmatically read or adjust this value from the BLL.</span></span>

## <a name="exposing-the-entire-connection-object"></a><span data-ttu-id="4e04e-171">公開整個連線物件</span><span class="sxs-lookup"><span data-stu-id="4e04e-171">Exposing the Entire Connection Object</span></span>

<span data-ttu-id="4e04e-172">這個部分類別只會公開基礎連線物件的一個屬性： `ConnectionString`。</span><span class="sxs-lookup"><span data-stu-id="4e04e-172">This partial class exposes just one property of the underlying connection object: `ConnectionString`.</span></span> <span data-ttu-id="4e04e-173">如果您想要讓整個連線物件可供 TableAdapter 的範圍外使用，您也可以變更 `Connection` 屬性 s 保護等級。</span><span class="sxs-lookup"><span data-stu-id="4e04e-173">If you want to make the entire connection object available beyond the confines of the TableAdapter, you can alternatively change the `Connection` property s protection level.</span></span> <span data-ttu-id="4e04e-174">我們在步驟1中檢查的自動產生程式碼顯示 TableAdapter s `Connection` 屬性標示為 `Friend`，這表示它只能由相同元件中的類別存取。</span><span class="sxs-lookup"><span data-stu-id="4e04e-174">The auto-generated code we examined in Step 1 showed that the TableAdapter s `Connection` property is marked as `Friend`, meaning that it can only be accessed by classes in the same assembly.</span></span> <span data-ttu-id="4e04e-175">不過，這可以透過 TableAdapter `ConnectionModifier` 屬性來變更。</span><span class="sxs-lookup"><span data-stu-id="4e04e-175">This can be changed, however, via the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="4e04e-176">開啟 `Northwind` 資料集，按一下設計工具中的 `ProductsTableAdapter`，然後流覽至 屬性視窗。</span><span class="sxs-lookup"><span data-stu-id="4e04e-176">Open the `Northwind` DataSet, click on the `ProductsTableAdapter` in the Designer, and navigate to the Properties window.</span></span> <span data-ttu-id="4e04e-177">在這裡，您會看到 `ConnectionModifier` 設為其預設值 `Assembly`。</span><span class="sxs-lookup"><span data-stu-id="4e04e-177">There you will see the `ConnectionModifier` set to its default value, `Assembly`.</span></span> <span data-ttu-id="4e04e-178">若要讓 `Connection` 屬性可在具類型資料集元件的外部使用，請將 `ConnectionModifier` 屬性變更為 [`Public`]。</span><span class="sxs-lookup"><span data-stu-id="4e04e-178">To make the `Connection` property available outside of the Typed DataSet s assembly, change the `ConnectionModifier` property to `Public`.</span></span>

<span data-ttu-id="4e04e-179">[![可以透過 ConnectionModifier 屬性設定連線屬性的存取範圍層級](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="4e04e-179">[![The Connection Property s Accessibility Level Can Be Configured via the ConnectionModifier Property](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)</span></span>

<span data-ttu-id="4e04e-180">**圖 4**： `Connection` 屬性 s 存取範圍層級可以透過 [`ConnectionModifier`] 屬性來設定（[按一下以查看完整大小的影像](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="4e04e-180">**Figure 4**: The `Connection` Property s Accessibility Level Can Be Configured via the `ConnectionModifier` Property ([Click to view full-size image](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))</span></span>

<span data-ttu-id="4e04e-181">儲存資料集，然後返回 `ProductsBLL` 類別。</span><span class="sxs-lookup"><span data-stu-id="4e04e-181">Save the DataSet and then return to the `ProductsBLL` class.</span></span> <span data-ttu-id="4e04e-182">如先前所示，移至其中一個現有的方法，然後在 `Adapter` 中輸入，然後按 [period] 鍵以顯示 IntelliSense。</span><span class="sxs-lookup"><span data-stu-id="4e04e-182">As before, go to one of the existing methods and type in `Adapter` and then hit the period key to bring up IntelliSense.</span></span> <span data-ttu-id="4e04e-183">此清單應包含 `Connection` 屬性，這表示您現在可以程式設計方式從 BLL 讀取或指派任何連線層級的設定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-183">The list should include a `Connection` property, meaning that you can now programmatically read or assign any connection-level settings from the BLL.</span></span>

## <a name="step-3-examining-the-command-related-properties"></a><span data-ttu-id="4e04e-184">步驟3：檢查與命令相關的屬性</span><span class="sxs-lookup"><span data-stu-id="4e04e-184">Step 3: Examining the Command-Related Properties</span></span>

<span data-ttu-id="4e04e-185">TableAdapter 是由主查詢所組成，根據預設，它具有自動產生的 `INSERT`、`UPDATE`和 `DELETE` 語句。</span><span class="sxs-lookup"><span data-stu-id="4e04e-185">A TableAdapter consists of a main query that, by default, has auto-generated `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="4e04e-186">此主要查詢 `INSERT`、`UPDATE`和 `DELETE` 語句會透過 `Adapter` 屬性，實作為 ADO.NET 資料介面卡物件，在 TableAdapter s 程式碼中執行。</span><span class="sxs-lookup"><span data-stu-id="4e04e-186">This main query s `INSERT`, `UPDATE`, and `DELETE` statements are implemented in the TableAdapter s code as an ADO.NET data adapter object via the `Adapter` property.</span></span> <span data-ttu-id="4e04e-187">就像它的 `Connection` 屬性一樣，`Adapter` 屬性 s 資料類型是由所使用的資料提供者所決定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-187">Like with its `Connection` property, the `Adapter` property s data type is determined by the data provider used.</span></span> <span data-ttu-id="4e04e-188">由於這些教學課程會使用 SqlClient 提供者，因此 `Adapter` 屬性的類型[`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="4e04e-188">Since these tutorials use the SqlClient provider, the `Adapter` property is of type [`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx).</span></span>

<span data-ttu-id="4e04e-189">TableAdapter 的 `Adapter` 屬性有三種類型 `SqlCommand` 的屬性，用來發出 `INSERT`、`UPDATE`和 `DELETE` 語句：</span><span class="sxs-lookup"><span data-stu-id="4e04e-189">The TableAdapter s `Adapter` property has three properties of type `SqlCommand` that it uses to issue the `INSERT`, `UPDATE`, and `DELETE` statements:</span></span>

- `InsertCommand`
- `UpdateCommand`
- `DeleteCommand`

<span data-ttu-id="4e04e-190">`SqlCommand` 物件負責將特定查詢傳送至資料庫，而且具有如下的屬性： [`CommandText`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx)，其中包含要執行的臨機操作 SQL 語句或預存程式;和[`Parameters`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx)，這是 `SqlParameter` 物件的集合。</span><span class="sxs-lookup"><span data-stu-id="4e04e-190">A `SqlCommand` object is responsible for sending a particular query to the database and has properties like: [`CommandText`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx), which contains the ad-hoc SQL statement or stored procedure to execute; and [`Parameters`](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx), which is a collection of `SqlParameter` objects.</span></span> <span data-ttu-id="4e04e-191">如我們在[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)教學課程中所見，您可以透過屬性視窗自訂這些命令物件。</span><span class="sxs-lookup"><span data-stu-id="4e04e-191">As we saw back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, these command objects can be customized through the Properties window.</span></span>

<span data-ttu-id="4e04e-192">除了其主要查詢以外，TableAdapter 也可以包含可變數目的方法，當叫用時，會將指定的命令分派給資料庫。</span><span class="sxs-lookup"><span data-stu-id="4e04e-192">In addition to its main query, the TableAdapter can include a variable number of methods that, when invoked, dispatch a specified command to the database.</span></span> <span data-ttu-id="4e04e-193">所有其他方法的主要查詢 s 命令物件和命令物件都儲存在 TableAdapter s `CommandCollection` 屬性中。</span><span class="sxs-lookup"><span data-stu-id="4e04e-193">The main query s command object and the command objects for all additional methods are stored in the TableAdapter s `CommandCollection` property.</span></span>

<span data-ttu-id="4e04e-194">讓我們花一點時間查看 `Northwind` DataSet 中的 `ProductsTableAdapter` 所產生的程式碼，這兩個屬性及其支援的成員變數和 helper 方法如下：</span><span class="sxs-lookup"><span data-stu-id="4e04e-194">Let s take a moment to look at the code generated by the `ProductsTableAdapter` in the `Northwind` DataSet for these two properties and their supporting member variables and helper methods:</span></span>

[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample3.vb)]

<span data-ttu-id="4e04e-195">`Adapter` 和 `CommandCollection` 屬性的程式碼會密切模擬 `Connection` 屬性的。</span><span class="sxs-lookup"><span data-stu-id="4e04e-195">The code for the `Adapter` and `CommandCollection` properties closely mimics that of the `Connection` property.</span></span> <span data-ttu-id="4e04e-196">有些成員變數會保存屬性所使用的物件。</span><span class="sxs-lookup"><span data-stu-id="4e04e-196">There are member variables that hold the objects used by the properties.</span></span> <span data-ttu-id="4e04e-197">`Get` 存取子的屬性一開始會先檢查是否 `Nothing`對應的成員變數。</span><span class="sxs-lookup"><span data-stu-id="4e04e-197">The properties `Get` accessors start by checking to see if the corresponding member variable is `Nothing`.</span></span> <span data-ttu-id="4e04e-198">若是如此，則會呼叫初始化方法，以建立成員變數的實例，並指派與核心命令相關的屬性。</span><span class="sxs-lookup"><span data-stu-id="4e04e-198">If so, an initialization method is called which creates an instance of the member variable and assigns the core command-related properties.</span></span>

## <a name="step-4-exposing-command-level-settings"></a><span data-ttu-id="4e04e-199">步驟4：公開命令層級設定</span><span class="sxs-lookup"><span data-stu-id="4e04e-199">Step 4: Exposing Command-Level Settings</span></span>

<span data-ttu-id="4e04e-200">在理想的情況下，命令層級資訊應保持封裝在資料存取層內。</span><span class="sxs-lookup"><span data-stu-id="4e04e-200">Ideally, the command-level information should remain encapsulated within the Data Access Layer.</span></span> <span data-ttu-id="4e04e-201">如果架構的其他層需要這項資訊，則可以透過部分類別公開，就像使用連接層級設定一樣。</span><span class="sxs-lookup"><span data-stu-id="4e04e-201">Should this information be needed in other layers of the architecture, however, it can be exposed through a partial class, just like with the connection-level settings.</span></span>

<span data-ttu-id="4e04e-202">由於 TableAdapter 只有一個 `Connection` 屬性，因此公開連接層級設定的程式碼相當簡單。</span><span class="sxs-lookup"><span data-stu-id="4e04e-202">Since the TableAdapter only has a single `Connection` property, the code for exposing connection-level settings is fairly straightforward.</span></span> <span data-ttu-id="4e04e-203">修改命令層級設定時，會比較複雜一點，因為 TableAdapter 可以有多個命令物件（`InsertCommand`、`UpdateCommand`和 `DeleteCommand`，以及 `CommandCollection` 屬性中的命令物件數目不定。</span><span class="sxs-lookup"><span data-stu-id="4e04e-203">Things are a bit more complicated when modifying command-level settings because the TableAdapter can have multiple command objects - an `InsertCommand`, `UpdateCommand`, and `DeleteCommand`, along with a variable number of command objects in the `CommandCollection` property.</span></span> <span data-ttu-id="4e04e-204">更新命令層級設定時，必須將這些設定傳播至所有命令物件。</span><span class="sxs-lookup"><span data-stu-id="4e04e-204">When updating command-level settings, these settings will need to be propagated to all of the command objects.</span></span>

<span data-ttu-id="4e04e-205">例如，假設 TableAdapter 中有一些查詢需要花很長的時間來執行。</span><span class="sxs-lookup"><span data-stu-id="4e04e-205">For example, imagine that there were certain queries in the TableAdapter that took an extraordinary long time to execute.</span></span> <span data-ttu-id="4e04e-206">當使用 TableAdapter 來執行其中一個查詢時，我們可能會想要增加 command 物件的[`CommandTimeout` 屬性](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4e04e-206">When using the TableAdapter to execute one of those queries, we might want to increase the command object s [`CommandTimeout` property](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx).</span></span> <span data-ttu-id="4e04e-207">這個屬性會指定等待命令執行的秒數，並將預設值設為30。</span><span class="sxs-lookup"><span data-stu-id="4e04e-207">This property specifies the number of seconds to wait for the command to execute and defaults to 30.</span></span>

<span data-ttu-id="4e04e-208">若要允許 BLL 調整 `CommandTimeout` 屬性，請使用在步驟2（`ProductsTableAdapter.ConnectionAndCommandSettings.vb`）中建立的部分類別檔案，將下列 `Public` 方法新增至 `ProductsDataTable`：</span><span class="sxs-lookup"><span data-stu-id="4e04e-208">To allow the `CommandTimeout` property to be adjusted by the BLL, add the following `Public` method to the `ProductsDataTable` using the partial class file created in Step 2 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):</span></span>

[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample4.vb)]

<span data-ttu-id="4e04e-209">您可以從 BLL 或展示層叫用這個方法，為該 TableAdapter 實例的所有命令設定命令逾時。</span><span class="sxs-lookup"><span data-stu-id="4e04e-209">This method could be invoked from the BLL or Presentation Layer to set the command timeout for all commands issues by that TableAdapter instance.</span></span>

> [!NOTE]
> <span data-ttu-id="4e04e-210">`Adapter` 和 `CommandCollection` 屬性會標示為 `Private`，這表示它們只能從 TableAdapter 內的程式碼存取。</span><span class="sxs-lookup"><span data-stu-id="4e04e-210">The `Adapter` and `CommandCollection` properties are marked as `Private`, meaning they can only be accessed from code within the TableAdapter.</span></span> <span data-ttu-id="4e04e-211">不同于 `Connection` 屬性，無法設定這些存取修飾詞。</span><span class="sxs-lookup"><span data-stu-id="4e04e-211">Unlike the `Connection` property, these access modifiers are not configurable.</span></span> <span data-ttu-id="4e04e-212">因此，如果您需要將命令層級屬性公開給架構中的其他層，您必須使用上述的部分類別方法，提供可讀取或寫入 `Private` 命令物件的 `Public` 方法或屬性。</span><span class="sxs-lookup"><span data-stu-id="4e04e-212">Therefore, if you need to expose command-level properties to other layers in the architecture you must use the partial class approach discussed above to provide a `Public` method or property that reads or writes to the `Private` command objects.</span></span>

## <a name="summary"></a><span data-ttu-id="4e04e-213">總結</span><span class="sxs-lookup"><span data-stu-id="4e04e-213">Summary</span></span>

<span data-ttu-id="4e04e-214">具類型資料集內的 Tableadapter 可封裝資料存取的詳細資訊和複雜度。</span><span class="sxs-lookup"><span data-stu-id="4e04e-214">The TableAdapters within a Typed DataSet serve to encapsulate data access details and complexity.</span></span> <span data-ttu-id="4e04e-215">使用 Tableadapter，我們不需要擔心撰寫 ADO.NET 程式碼來連接到資料庫、發出命令，或將結果填入 DataTable。</span><span class="sxs-lookup"><span data-stu-id="4e04e-215">Using TableAdapters, we do not have to worry about writing ADO.NET code to connect to the database, issue a command, or populate the results into a DataTable.</span></span> <span data-ttu-id="4e04e-216">系統會自動為我們處理。</span><span class="sxs-lookup"><span data-stu-id="4e04e-216">It is all handled automatically for us.</span></span>

<span data-ttu-id="4e04e-217">不過，有時我們需要自訂低層級的 ADO.NET 細節，例如變更連接字串或預設連接或命令逾時值。</span><span class="sxs-lookup"><span data-stu-id="4e04e-217">However, there may be times when we need to customize the low-level ADO.NET specifics, such as changing the connection string or the default connection or command timeout values.</span></span> <span data-ttu-id="4e04e-218">TableAdapter 具有自動產生的 `Connection`、`Adapter`和 `CommandCollection` 屬性，但預設為 `Friend` 或 `Private`。</span><span class="sxs-lookup"><span data-stu-id="4e04e-218">The TableAdapter has auto-generated `Connection`, `Adapter`, and `CommandCollection` properties, but these are either `Friend` or `Private`, by default.</span></span> <span data-ttu-id="4e04e-219">藉由使用部分類別擴充 TableAdapter 以包含 `Public` 方法或屬性，即可公開此內部資訊。</span><span class="sxs-lookup"><span data-stu-id="4e04e-219">This internal information can be exposed by extending the TableAdapter using partial classes to include `Public` methods or properties.</span></span> <span data-ttu-id="4e04e-220">或者，您可以透過 TableAdapter 的 `ConnectionModifier` 屬性來設定 TableAdapter 的 `Connection` 屬性存取修飾詞。</span><span class="sxs-lookup"><span data-stu-id="4e04e-220">Alternatively, the TableAdapter s `Connection` property access modifier can be configured through the TableAdapter s `ConnectionModifier` property.</span></span>

<span data-ttu-id="4e04e-221">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="4e04e-221">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="4e04e-222">關於作者</span><span class="sxs-lookup"><span data-stu-id="4e04e-222">About the Author</span></span>

<span data-ttu-id="4e04e-223">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="4e04e-223">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="4e04e-224">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="4e04e-224">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="4e04e-225">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="4e04e-225">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="4e04e-226">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="4e04e-226">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="4e04e-227">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="4e04e-227">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="4e04e-228">特別感謝</span><span class="sxs-lookup"><span data-stu-id="4e04e-228">Special Thanks To</span></span>

<span data-ttu-id="4e04e-229">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="4e04e-229">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="4e04e-230">本教學課程的領導審查者為 Burnadette Leigh、S ren Jacob Lauritsen、Teresa Murphy 和 Hilton Geisenow。</span><span class="sxs-lookup"><span data-stu-id="4e04e-230">Lead reviewers for this tutorial were Burnadette Leigh, S ren Jacob Lauritsen, Teresa Murphy, and Hilton Geisenow.</span></span> <span data-ttu-id="4e04e-231">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="4e04e-231">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="4e04e-232">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="4e04e-232">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4e04e-233">[上一頁](working-with-computed-columns-vb.md)
> [下一頁](protecting-connection-strings-and-other-configuration-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="4e04e-233">[Previous](working-with-computed-columns-vb.md)
[Next](protecting-connection-strings-and-other-configuration-information-vb.md)</span></span>
