---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
title: 使用現有的預存程序為具類型資料集的 Tableadapter (VB) |Microsoft Docs
author: rick-anderson
description: 在上一個教學課程中，我們了解如何使用 TableAdapter 精靈 產生新的預存程序的內容。 在本教學課程中我們了解如何在相同 TableAdapter...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 2da25f6a-757e-4e7b-a812-1575288d8f7a
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
msc.type: authoredcontent
ms.openlocfilehash: 25e34512abc779bfef2d2bb99a8b62de073e8ed6
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59381480"
---
# <a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-vb"></a><span data-ttu-id="ed264-104">使用具類型資料集 Tableadapter 現有的預存程序 (VB)</span><span class="sxs-lookup"><span data-stu-id="ed264-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (VB)</span></span>

<span data-ttu-id="ed264-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ed264-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ed264-106">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip)或[下載 PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ed264-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span></span>

> <span data-ttu-id="ed264-107">在上一個教學課程中，我們了解如何使用 TableAdapter 精靈 產生新的預存程序的內容。</span><span class="sxs-lookup"><span data-stu-id="ed264-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="ed264-108">在本教學課程中我們了解如何相同 TableAdapter 精靈 可以搭配現有的預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="ed264-109">我們也了解如何以手動方式將新的預存程序新增至我們的資料庫。</span><span class="sxs-lookup"><span data-stu-id="ed264-109">We also learn how to manually add new stored procedures to our database.</span></span>


## <a name="introduction"></a><span data-ttu-id="ed264-110">簡介</span><span class="sxs-lookup"><span data-stu-id="ed264-110">Introduction</span></span>

<span data-ttu-id="ed264-111">在 [前述教學課程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)我們可了解如何 s TableAdapters 的具類型資料集無法設定為使用預存程序，以存取資料，而不是特定 SQL 陳述式。</span><span class="sxs-lookup"><span data-stu-id="ed264-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="ed264-112">特別是，我們會檢查如何讓 TableAdapter 精靈會自動建立這些預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="ed264-113">移植到 ASP.NET 2.0 的舊版應用程式時，或建置現有的資料模型周圍的 ASP.NET 2.0 網站時，有可能是資料庫已包含我們所需要的預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="ed264-114">或者，您也可能會想要建立您的預存程序，以手動方式或透過您的預存程序會自動產生 [Tabaleadapter 精靈] 以外的一些工具。</span><span class="sxs-lookup"><span data-stu-id="ed264-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="ed264-115">在本教學課程中我們將探討如何設定要使用現有的預存程序的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="ed264-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="ed264-116">因為 Northwind 資料庫只有較少的內建的預存程序，我們也將探討手動透過 Visual Studio 環境的資料庫中加入新的預存程序所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="ed264-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="ed264-117">讓 s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="ed264-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="ed264-118">在 [資料庫修改包裝在交易](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)教學課程中我們加入來支援交易的 TableAdapter 方法 (`BeginTransaction`，`CommitTransaction`等等)。</span><span class="sxs-lookup"><span data-stu-id="ed264-118">In the [Wrapping Database Modifications within a Transaction](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="ed264-119">或者，可以完全在不需要對資料存取層的程式碼進行任何修改的預存程序內管理交易。</span><span class="sxs-lookup"><span data-stu-id="ed264-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="ed264-120">在本教學課程中，我們將探討用來執行預存程序 s 陳述式的範圍內的交易的 T-SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="ed264-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>


## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="ed264-121">步驟 1：將預存程序加入至 Northwind 資料庫</span><span class="sxs-lookup"><span data-stu-id="ed264-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="ed264-122">Visual Studio 可讓您輕鬆地將新的預存程序加入至資料庫。</span><span class="sxs-lookup"><span data-stu-id="ed264-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="ed264-123">可讓 s 傳回所有資料行，從 Northwind 資料庫中加入新的預存程序`Products`適用於具有特定資料表`CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="ed264-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="ed264-124">從 [伺服器總管] 視窗中，展開 Northwind 資料庫，使其-資料庫圖表、 資料表、 檢視和等位的資料夾會顯示。</span><span class="sxs-lookup"><span data-stu-id="ed264-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="ed264-125">如我們所見在先前的教學課程中，預存程序 資料夾會包含資料庫 s 現有預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="ed264-126">若要加入新的預存程序，只要以滑鼠右鍵按一下 預存程序 資料夾，並從內容功能表中選擇 加入新的預存程序選項。</span><span class="sxs-lookup"><span data-stu-id="ed264-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>


<span data-ttu-id="ed264-127">[![以滑鼠右鍵按一下 [預存程序] 資料夾，並加入新的預存程序](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span></span>

<span data-ttu-id="ed264-128">**圖 1**:以滑鼠右鍵按一下 [預存程序] 資料夾，並加入新的預存程序 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span></span>


<span data-ttu-id="ed264-129">如 [圖 1] 所示，選取 [加入新的預存程序] 選項會開啟指令碼視窗在 Visual Studio 中建立預存程序所需的 SQL 指令碼的外框。</span><span class="sxs-lookup"><span data-stu-id="ed264-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="ed264-130">它是我們的責任充實這段指令碼，並執行它，此時預存程序會加入至資料庫。</span><span class="sxs-lookup"><span data-stu-id="ed264-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="ed264-131">輸入下列指令碼：</span><span class="sxs-lookup"><span data-stu-id="ed264-131">Enter the following script:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample1.sql)]

<span data-ttu-id="ed264-132">此指令碼，在執行時，會將新的預存程序新增至名為 Northwind 資料庫`Products_SelectByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="ed264-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="ed264-133">這個預存程序會接受單一輸入的參數 (`@CategoryID`，型別的`int`)，則會傳回所有具有相符產品欄位`CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="ed264-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="ed264-134">若要執行這個`CREATE PROCEDURE`指令碼和預存程序新增至資料庫、 按一下工具列中的 [儲存] 圖示或按 Ctrl + S。</span><span class="sxs-lookup"><span data-stu-id="ed264-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="ed264-135">這麼做之後，預存程序的資料夾重新整理，顯示新建立預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="ed264-136">此外，在視窗中的指令碼將變更從一些微妙的差異`CREATE PROCEDURE dbo.Products_SelectProductByCategoryID`要`ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="ed264-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="ed264-137">`CREATE PROCEDURE` 在資料庫中，加入新的預存程序雖然`ALTER PROCEDURE`更新現有的。</span><span class="sxs-lookup"><span data-stu-id="ed264-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="ed264-138">因為指令碼的開頭已變更為`ALTER PROCEDURE`，變更預存程序的輸入參數或 SQL 陳述式，並按一下 [儲存] 圖示將會使用這些變更更新預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="ed264-139">[圖 2] 顯示之後的 Visual Studio`Products_SelectByCategoryID`已儲存預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>


<span data-ttu-id="ed264-140">[![預存程序 Products_SelectByCategoryID 加入資料庫](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span></span>

<span data-ttu-id="ed264-141">**圖 2**:預存程序`Products_SelectByCategoryID`已加入至資料庫 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span></span>


## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="ed264-142">步驟 2：設定要使用現有的預存程序的 TableAdapter</span><span class="sxs-lookup"><span data-stu-id="ed264-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="ed264-143">既然`Products_SelectByCategoryID`預存程序已新增至資料庫，我們可以設定我們的資料存取層，其中一個方法叫用時，請使用此預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can configure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="ed264-144">特別是，我們會新增`GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->`方法，以`ProductsTableAdapter`中`NorthwindWithSprocs`呼叫的輸入資料集`Products_SelectByCategoryID`預存程序，我們剛剛建立。</span><span class="sxs-lookup"><span data-stu-id="ed264-144">In particular, we will add a `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="ed264-145">首先開啟`NorthwindWithSprocs`資料集。</span><span class="sxs-lookup"><span data-stu-id="ed264-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="ed264-146">以滑鼠右鍵按一下`ProductsTableAdapter`，然後選擇 [加入查詢]，啟動 [TableAdapter 查詢組態精靈]。</span><span class="sxs-lookup"><span data-stu-id="ed264-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="ed264-147">在 [前述教學課程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)我們選擇能夠為我們建立新的預存程序的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="ed264-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="ed264-148">本教學課程中，不過，我們想要將新的 TableAdapter 方法傳送至現有`Products_SelectByCategoryID`預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="ed264-149">因此，從精靈 s 第一個步驟中選擇 使用現有的預存程序選項，然後按一下 下一步。</span><span class="sxs-lookup"><span data-stu-id="ed264-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>


<span data-ttu-id="ed264-150">[![選擇 使用現有的預存程序選項](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span></span>

<span data-ttu-id="ed264-151">**圖 3**:選擇 使用現有預存程序選項 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span></span>


<span data-ttu-id="ed264-152">下列畫面會提供下拉式清單中填入資料庫 s 預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="ed264-153">選取預存程序會列出其左邊和右邊傳回 （如果有的話） 的資料欄位的輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="ed264-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="ed264-154">選擇`Products_SelectByCategoryID`預存程序，從清單中，按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="ed264-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>


<span data-ttu-id="ed264-155">[![挑選 Products_SelectByCategoryID 預存程序](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span></span>

<span data-ttu-id="ed264-156">**圖 4**:挑選`Products_SelectByCategoryID`預存程序 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span></span>


<span data-ttu-id="ed264-157">下一個畫面詢問我們的資料類型由預存程序，我們的解答決定 TableAdapter 的方法所傳回的型別。</span><span class="sxs-lookup"><span data-stu-id="ed264-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="ed264-158">例如，如果我們指出會傳回表格式資料，則方法會傳回`ProductsDataTable`填入預存程序所傳回之記錄的執行個體。</span><span class="sxs-lookup"><span data-stu-id="ed264-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="ed264-159">相反地，如果我們指出此預存程序傳回單一值會傳回 TableAdapter`Object`指派預存程序所傳回的第一筆記錄的第一個資料行中的值。</span><span class="sxs-lookup"><span data-stu-id="ed264-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `Object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="ed264-160">因為`Products_SelectByCategoryID`預存程序會傳回所有產品都屬於特定類別，選擇第一個回應-表格式資料集，按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="ed264-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>


<span data-ttu-id="ed264-161">[![指出預存程序會傳回表格式資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span></span>

<span data-ttu-id="ed264-162">**圖 5**:指出預存程序會傳回表格式資料 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span></span>


<span data-ttu-id="ed264-163">所有剩下就是指出哪些方法的模式，以使用後面接著這些方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="ed264-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="ed264-164">DataTable 和傳回 DataTable 選項已核取，但重新命名的方法，讓這兩種填滿`FillByCategoryID`和`GetProductsByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="ed264-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="ed264-165">然後按一下 [下一步] 檢閱精靈即將執行工作的摘要。</span><span class="sxs-lookup"><span data-stu-id="ed264-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="ed264-166">如果一切看起來正確，按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="ed264-166">If everything looks correct, click Finish.</span></span>


<span data-ttu-id="ed264-167">[![名稱方法 FillByCategoryID 和 GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span></span>

<span data-ttu-id="ed264-168">**圖 6**:命名方法`FillByCategoryID`並`GetProductsByCategoryID`([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="ed264-169">我們剛才建立的 TableAdapter 方法`FillByCategoryID`並`GetProductsByCategoryID`，預期類型的輸入的參數`Integer`。</span><span class="sxs-lookup"><span data-stu-id="ed264-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `Integer`.</span></span> <span data-ttu-id="ed264-170">此輸入的參數的值會傳遞至預存程序，透過其`@CategoryID`參數。</span><span class="sxs-lookup"><span data-stu-id="ed264-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="ed264-171">如果您修改`Products_SelectByCategory`預存程序的參數，您必須一併更新這些 TableAdapter 方法的參數。</span><span class="sxs-lookup"><span data-stu-id="ed264-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="ed264-172">中所述[先前的教學課程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)，這可以在下列其中一種： 透過手動新增或移除參數從參數集合，或透過重新執行 [Tabaleadapter 精靈]。</span><span class="sxs-lookup"><span data-stu-id="ed264-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>


## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="ed264-173">步驟 3：新增`GetProductsByCategoryID(categoryID)`BLL 方法</span><span class="sxs-lookup"><span data-stu-id="ed264-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="ed264-174">使用`GetProductsByCategoryID`DAL 方法完成下, 一個步驟是提供商業邏輯層中，這個方法的存取。</span><span class="sxs-lookup"><span data-stu-id="ed264-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="ed264-175">開啟`ProductsBLLWithSprocs`類別檔案，並新增下列方法：</span><span class="sxs-lookup"><span data-stu-id="ed264-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>


[!code-vb[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample2.vb)]

<span data-ttu-id="ed264-176">此 BLL 方法只會傳回`ProductsDataTable`傳回從`ProductsTableAdapter`s`GetProductsByCategoryID`方法。</span><span class="sxs-lookup"><span data-stu-id="ed264-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="ed264-177">`DataObjectMethodAttribute`屬性提供 ObjectDataSource s 設定資料來源精靈 所使用的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="ed264-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="ed264-178">特別的是，這個方法會出現在 [選取] 索引標籤的下拉式清單中。</span><span class="sxs-lookup"><span data-stu-id="ed264-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="ed264-179">步驟 4：依類別顯示產品</span><span class="sxs-lookup"><span data-stu-id="ed264-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="ed264-180">若要測試新加入`Products_SelectByCategoryID`預存程序和對應的 DAL 和 BLL 方法，讓建立 ASP.NET 網頁，其中包含 DropDownList 和 GridView。</span><span class="sxs-lookup"><span data-stu-id="ed264-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="ed264-181">DropDownList 會列出所有資料庫中的類別，而 GridView 會顯示屬於所選分類的產品。</span><span class="sxs-lookup"><span data-stu-id="ed264-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="ed264-182">我們已建立主從式介面在先前的教學課程中使用 dropdownlist 進行。</span><span class="sxs-lookup"><span data-stu-id="ed264-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="ed264-183">如需更深入了解實作這類主版/詳細報告，請參閱[主版/詳細篩選使用 DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="ed264-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial.</span></span>


<span data-ttu-id="ed264-184">開啟`ExistingSprocs.aspx`頁面中`AdvancedDAL`資料夾，然後從 [工具箱] 拖曳至設計工具的 dropdownlist 進行拖曳。</span><span class="sxs-lookup"><span data-stu-id="ed264-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="ed264-185">設定 DropDownList s`ID`屬性，以`Categories`及其`AutoPostBack`屬性設`True`。</span><span class="sxs-lookup"><span data-stu-id="ed264-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `True`.</span></span> <span data-ttu-id="ed264-186">接下來，從它的智慧標籤，將繫結 DropDownList 至名為新 ObjectDataSource `CategoriesDataSource`。</span><span class="sxs-lookup"><span data-stu-id="ed264-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="ed264-187">因此，它會擷取資料的來源設定 ObjectDataSource`CategoriesBLL`類別的`GetCategories`方法。</span><span class="sxs-lookup"><span data-stu-id="ed264-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="ed264-188">設定下拉式清單中更新、 插入和刪除 （無） 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="ed264-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="ed264-189">[![從 CategoriesBLL 類別的 GetCategories 方法擷取資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span></span>

<span data-ttu-id="ed264-190">**圖 7**:從中擷取資料`CategoriesBLL`類別 s`GetCategories`方法 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span></span>


<span data-ttu-id="ed264-191">[![設定下拉式清單中更新、 插入和刪除 （無） 索引標籤](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span></span>

<span data-ttu-id="ed264-192">**圖 8**:設定下拉式清單中更新、 插入和刪除索引標籤為 （無） ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span></span>


<span data-ttu-id="ed264-193">完成 ObjectDataSource 精靈之後，設定要顯示 DropDownList`CategoryName`資料欄位，並將`CategoryID`欄位做為`Value`每個`ListItem`。</span><span class="sxs-lookup"><span data-stu-id="ed264-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="ed264-194">此時，DropDownList 與 ObjectDataSource s 宣告式標記應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="ed264-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>


[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample3.aspx)]

<span data-ttu-id="ed264-195">接下來，拖曳至設計工具中，將它放在 DropDownList 下方的 GridView。</span><span class="sxs-lookup"><span data-stu-id="ed264-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="ed264-196">設定 GridView s`ID`要`ProductsByCategory`和它的智慧標籤，從繫結至名為新 ObjectDataSource `ProductsByCategoryDataSource`。</span><span class="sxs-lookup"><span data-stu-id="ed264-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="ed264-197">設定`ProductsByCategoryDataSource`若要使用的 ObjectDataSource`ProductsBLLWithSprocs`類別，讓它可讓您擷取其資料使用`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="ed264-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="ed264-198">因為此 GridView 只會用來顯示資料，設定下拉式清單中更新、 插入和刪除 （無） 索引標籤以及按一下 下一步。</span><span class="sxs-lookup"><span data-stu-id="ed264-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>


<span data-ttu-id="ed264-199">[![設定使用 ProductsBLLWithSprocs 類別 ObjectDataSource](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span></span>

<span data-ttu-id="ed264-200">**圖 9**:設定要使用 ObjectDataSource`ProductsBLLWithSprocs`類別 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span></span>


<span data-ttu-id="ed264-201">[![從 GetProductsByCategoryID(categoryID) 方法擷取資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span></span>

<span data-ttu-id="ed264-202">**圖 10**:從中擷取資料`GetProductsByCategoryID(categoryID)`方法 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span></span>


<span data-ttu-id="ed264-203">在 [選取] 索引標籤中選擇的方法會預期參數，讓精靈的最後一個步驟會提示我們輸入的參數 s 的來源。</span><span class="sxs-lookup"><span data-stu-id="ed264-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="ed264-204">設定參數來源下拉式清單控制項，然後選擇 `Categories`控制項從 ControlID 下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="ed264-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="ed264-205">按一下 完成 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="ed264-205">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="ed264-206">[![使用分類 DropDownList categoryID 參數的來源](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span></span>

<span data-ttu-id="ed264-207">**圖 11**:使用`Categories`做為來源的 DropDownList`categoryID`參數 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span></span>


<span data-ttu-id="ed264-208">完成後 ObjectDataSource 精靈，Visual Studio 會將 BoundFields 及其每個產品的資料欄位。</span><span class="sxs-lookup"><span data-stu-id="ed264-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="ed264-209">放心地依照您自訂這些欄位。</span><span class="sxs-lookup"><span data-stu-id="ed264-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="ed264-210">瀏覽透過瀏覽器頁面。</span><span class="sxs-lookup"><span data-stu-id="ed264-210">Visit the page through a browser.</span></span> <span data-ttu-id="ed264-211">當瀏覽所選取的飲料類別頁和對應方格中列出的產品。</span><span class="sxs-lookup"><span data-stu-id="ed264-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="ed264-212">將下拉式清單變更為替代的類別，以 圖 12 顯示、 造成回傳並重新載入新選取的類別目錄的產品與格線。</span><span class="sxs-lookup"><span data-stu-id="ed264-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>


<span data-ttu-id="ed264-213">[![顯示產生的類別目錄中的產品](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span></span>

<span data-ttu-id="ed264-214">**圖 12**:顯示產生的類別目錄中的產品 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span></span>


## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="ed264-215">步驟 5：包裝在交易範圍內的預存程序 s 陳述式</span><span class="sxs-lookup"><span data-stu-id="ed264-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="ed264-216">在 [資料庫修改包裝在交易](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)教學課程中我們討論用來執行一系列資料庫修改陳述式的範圍內的交易的技巧。</span><span class="sxs-lookup"><span data-stu-id="ed264-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="ed264-217">修改交易的傘狀下執行的是所有成功的重新叫用 」 或 「 所有失敗，確保不可部分完成性。</span><span class="sxs-lookup"><span data-stu-id="ed264-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="ed264-218">使用交易的相關技巧包括：</span><span class="sxs-lookup"><span data-stu-id="ed264-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="ed264-219">使用中的類別`System.Transactions`命名空間，</span><span class="sxs-lookup"><span data-stu-id="ed264-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="ed264-220">讓資料存取層使用之類的 ADO.NET 類別`SqlTransaction`，及</span><span class="sxs-lookup"><span data-stu-id="ed264-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="ed264-221">新增直接在預存程序內的 T-SQL 交易命令</span><span class="sxs-lookup"><span data-stu-id="ed264-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="ed264-222">*資料庫修改包裝在交易*教學課程中的 DAL 使用 ADO.NET 類別。</span><span class="sxs-lookup"><span data-stu-id="ed264-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="ed264-223">本教學課程的其餘部分將探討如何管理使用 T-SQL 命令從預存程序內的交易。</span><span class="sxs-lookup"><span data-stu-id="ed264-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="ed264-224">三個索引鍵的 SQL 命令為手動啟動、 認可和回復交易`BEGIN TRANSACTION`， `COMMIT TRANSACTION`，和`ROLLBACK TRANSACTION`分別。</span><span class="sxs-lookup"><span data-stu-id="ed264-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="ed264-225">使用預存程序，我們需要套用下列模式中的交易時，使用 ADO.NET 方法時，例如：</span><span class="sxs-lookup"><span data-stu-id="ed264-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="ed264-226">表示開始的交易。</span><span class="sxs-lookup"><span data-stu-id="ed264-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="ed264-227">執行 SQL 陳述式構成交易。</span><span class="sxs-lookup"><span data-stu-id="ed264-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="ed264-228">如果沒有任何一種從步驟 2 中，復原交易的陳述式錯誤。</span><span class="sxs-lookup"><span data-stu-id="ed264-228">If there is an error in any one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="ed264-229">如果所有步驟 2 中的陳述式完成不會發生錯誤時，會認可交易。</span><span class="sxs-lookup"><span data-stu-id="ed264-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="ed264-230">在 T-SQL 語法中使用下列範本，您可以實作此模式：</span><span class="sxs-lookup"><span data-stu-id="ed264-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample4.sql)]

<span data-ttu-id="ed264-231">範本會定義啟動`TRY...CATCH`封鎖，SQL Server 2005 的新建構。</span><span class="sxs-lookup"><span data-stu-id="ed264-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="ed264-232">如同`Try...Catch`在 Visual Basic 中的 SQL 封鎖`TRY...CATCH`區塊都會執行中的陳述式`TRY`區塊。</span><span class="sxs-lookup"><span data-stu-id="ed264-232">Like with `Try...Catch` blocks in Visual Basic, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="ed264-233">如果任何陳述式會引發錯誤，控制權會立即轉移到`CATCH`區塊。</span><span class="sxs-lookup"><span data-stu-id="ed264-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="ed264-234">如果不沒有執行 SQL 陳述式的交易，該結構的任何錯誤`COMMIT TRANSACTION`陳述式認可變更，並完成交易。</span><span class="sxs-lookup"><span data-stu-id="ed264-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="ed264-235">不過，有一個陳述式會導致發生錯誤時，如果`ROLLBACK TRANSACTION`在`CATCH`區塊將使資料庫回到交易啟動之前的狀態。</span><span class="sxs-lookup"><span data-stu-id="ed264-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="ed264-236">預存程序也會引發錯誤，使用[RAISERROR 命令](https://msdn.microsoft.com/library/ms178592.aspx)，會造成`SqlException`在應用程式中引發。</span><span class="sxs-lookup"><span data-stu-id="ed264-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="ed264-237">因為`TRY...CATCH`區塊的新 SQL Server 2005 中，如果您使用舊版的 Microsoft SQL Server，就不適用上述的範本。</span><span class="sxs-lookup"><span data-stu-id="ed264-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="ed264-238">如果您不使用 SQL Server 2005，請參閱[SQL Server 預存程序中的 管理交易](http://www.4guysfromrolla.com/webtech/080305-1.shtml)適用於 SQL Server 的其他版本的範本。</span><span class="sxs-lookup"><span data-stu-id="ed264-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>


<span data-ttu-id="ed264-239">可讓 s 看看一個具體的範例。</span><span class="sxs-lookup"><span data-stu-id="ed264-239">Let s look at a concrete example.</span></span> <span data-ttu-id="ed264-240">之間存在的外部索引鍵條件約束`Categories`並`Products`資料表，這表示，每個`CategoryID`欄位中`Products`資料表必須對應至`CategoryID`中的值`Categories`資料表。</span><span class="sxs-lookup"><span data-stu-id="ed264-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="ed264-241">違反這個條件約束，例如嘗試刪除類別目錄相關聯的產品，任何動作都會導致外部索引鍵條件約束違規。</span><span class="sxs-lookup"><span data-stu-id="ed264-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="ed264-242">若要確認這種情況，重新瀏覽正在更新及刪除現有的二進位資料的範例中使用二進位資料 區段 (`~/BinaryData/UpdatingAndDeleting.aspx`)。</span><span class="sxs-lookup"><span data-stu-id="ed264-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="ed264-243">此頁面會列出每個類別，以及編輯和刪除按鈕 （請參閱 圖 13），系統中，但刪除如果您嘗試刪除相關聯的產品-例如飲料-類別目錄會失敗，因為外部索引鍵條件約束違規情形 （請參閱 圖 14）。</span><span class="sxs-lookup"><span data-stu-id="ed264-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>


<span data-ttu-id="ed264-244">[![每個類別會顯示在 GridView 編輯和刪除按鈕](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span></span>

<span data-ttu-id="ed264-245">**圖 13**:每個類別會顯示在編輯和刪除按鈕與 GridView ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span></span>


<span data-ttu-id="ed264-246">[![您無法刪除有現有的產品類別目錄](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="ed264-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span></span>

<span data-ttu-id="ed264-247">**圖 14**:您無法刪除有現有的產品類別目錄 ([按一下以檢視完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="ed264-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span></span>


<span data-ttu-id="ed264-248">不過，假設我們想要允許刪除不論它們是否有相關的產品類別目錄。</span><span class="sxs-lookup"><span data-stu-id="ed264-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="ed264-249">若刪除與產品類別目錄的資訊，假設我們想要同時刪除其現有的產品 (雖然另一個選項是直接設定其產品`CategoryID`值來`NULL`)。</span><span class="sxs-lookup"><span data-stu-id="ed264-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="ed264-250">這項功能可能會實作透過外部索引鍵條件約束的串聯規則。</span><span class="sxs-lookup"><span data-stu-id="ed264-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="ed264-251">或者，我們可以在其中建立可接受的預存程序`@CategoryID`輸入的參數並叫用時，明確地刪除所有相關聯的產品，然後指定的分類。</span><span class="sxs-lookup"><span data-stu-id="ed264-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="ed264-252">我們在這種預存程序的第一次嘗試可能會如下所示：</span><span class="sxs-lookup"><span data-stu-id="ed264-252">Our first attempt at such a stored procedure might look like the following:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample5.sql)]

<span data-ttu-id="ed264-253">這肯定會刪除相關聯的產品和分類，而它不是在交易的保護傘。</span><span class="sxs-lookup"><span data-stu-id="ed264-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="ed264-254">Imagine 上的某些其他外部索引鍵條件約束`Categories`，則會禁止刪除特定`@CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="ed264-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="ed264-255">問題是，在此情況下的所有產品將會刪除之前我們嘗試刪除類別目錄。</span><span class="sxs-lookup"><span data-stu-id="ed264-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="ed264-256">最後結果就是，這類的類別目錄，此預存程序會移除所有的產品類別目錄保留，因為它仍有相關的其他資料表中的記錄時。</span><span class="sxs-lookup"><span data-stu-id="ed264-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="ed264-257">如果預存程序已包裝範圍內的交易，不過，若要刪除`Products`資料表會面臨無法刪除上回復`Categories`。</span><span class="sxs-lookup"><span data-stu-id="ed264-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="ed264-258">下列的預存程序指令碼會使用交易來確保兩者之間的不可部分完成性`DELETE`陳述式：</span><span class="sxs-lookup"><span data-stu-id="ed264-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>


[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample6.sql)]

<span data-ttu-id="ed264-259">請花一點時間加入`Categories_Delete`預存程序至 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="ed264-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="ed264-260">步驟 1 到回頭參考，如需將預存程序加入資料庫中的指示。</span><span class="sxs-lookup"><span data-stu-id="ed264-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="ed264-261">步驟 6：正在更新`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="ed264-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="ed264-262">雖然我們已新增`Categories_Delete`到資料庫，DAL 的預存程序目前設定為使用特定 SQL 陳述式來執行刪除。</span><span class="sxs-lookup"><span data-stu-id="ed264-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="ed264-263">我們需要更新`CategoriesTableAdapter`，並指示它使用`Categories_Delete`改為預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="ed264-264">稍早在本教學課程中，我們已使用與`NorthwindWithSprocs`資料集。</span><span class="sxs-lookup"><span data-stu-id="ed264-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="ed264-265">但該資料集只能有單一的實體， `ProductsDataTable`，因此需要使用分類。</span><span class="sxs-lookup"><span data-stu-id="ed264-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="ed264-266">因此，對於當我談到的資料存取層 I m 參考本教學課程的其餘部分`Northwind`資料集，我們先建立中的另一個[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="ed264-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial.</span></span>


<span data-ttu-id="ed264-267">開啟 Northwind 資料集選取`CategoriesTableAdapter`，並移至 [屬性] 視窗。</span><span class="sxs-lookup"><span data-stu-id="ed264-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="ed264-268">屬性視窗清單`InsertCommand`， `UpdateCommand`， `DeleteCommand`，和`SelectCommand`使用 TableAdapter，以及其名稱和連接資訊。</span><span class="sxs-lookup"><span data-stu-id="ed264-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="ed264-269">展開`DeleteCommand`屬性，以查看其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="ed264-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="ed264-270">如 [圖 15] 所示， `DeleteCommand` s`CommandType`屬性設定為會指示它傳送的文字的文字`CommandText`為特定 SQL 查詢的屬性。</span><span class="sxs-lookup"><span data-stu-id="ed264-270">As Figure 15 shows, the `DeleteCommand` s `CommandType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>


![在 [屬性] 視窗中檢視其屬性設計工具中選取 CategoriesTableAdapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image43.png)

<span data-ttu-id="ed264-272">**圖 15**:選取`CategoriesTableAdapter`在設計工具中，在 屬性 視窗中檢視其內容</span><span class="sxs-lookup"><span data-stu-id="ed264-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>


<span data-ttu-id="ed264-273">若要變更這些設定，請選取 (DeleteCommand) 文字屬性] 視窗中，從下拉式清單中選擇 [（新增）。</span><span class="sxs-lookup"><span data-stu-id="ed264-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="ed264-274">這會清除的設定`CommandText`， `CommandType`，和`Parameters`屬性。</span><span class="sxs-lookup"><span data-stu-id="ed264-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="ed264-275">接下來，設定`CommandType`屬性，以`StoredProcedure`，然後輸入名稱的預存程序`CommandText`(`dbo.Categories_Delete`)。</span><span class="sxs-lookup"><span data-stu-id="ed264-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="ed264-276">如果您要確定依此順序中的輸入屬性，第一次`CommandType`，然後`CommandText`-Visual Studio 會自動填入參數集合。</span><span class="sxs-lookup"><span data-stu-id="ed264-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="ed264-277">如果您未依此順序輸入這些屬性，您必須手動新增參數的參數集合編輯器。</span><span class="sxs-lookup"><span data-stu-id="ed264-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="ed264-278">在任一情況下，它 s 按一下以確認，正確的參數設定已變更 （請參閱 圖 16） 顯示的參數集合編輯器的 參數 屬性中的省略符號上的容錯度加倍。</span><span class="sxs-lookup"><span data-stu-id="ed264-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="ed264-279">如果看不到任何參數，在對話方塊中，新增`@CategoryID`參數以手動方式 (您不需要新增`@RETURN_VALUE`參數)。</span><span class="sxs-lookup"><span data-stu-id="ed264-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>


![請確定參數設定正確](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image44.png)

<span data-ttu-id="ed264-281">**圖 16**:請確定參數設定正確</span><span class="sxs-lookup"><span data-stu-id="ed264-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>


<span data-ttu-id="ed264-282">DAL 已更新之後，刪除類別目錄會自動刪除所有與其相關聯的產品並進行交易的保護傘。</span><span class="sxs-lookup"><span data-stu-id="ed264-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="ed264-283">若要確認，返回 [更新和刪除現有的二進位資料] 頁面並按一下 [刪除] 按鈕的其中一個類別。</span><span class="sxs-lookup"><span data-stu-id="ed264-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="ed264-284">單一按一下的滑鼠，將刪除類別目錄和所有與其相關聯的產品。</span><span class="sxs-lookup"><span data-stu-id="ed264-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="ed264-285">在測試之前`Categories_Delete`預存程序，這會刪除許多產品，以及選取的類別，可能必須先備份您的資料庫。</span><span class="sxs-lookup"><span data-stu-id="ed264-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="ed264-286">如果您使用`NORTHWND.MDF`資料庫中`App_Data`，只需關閉 Visual Studio，並複製中的 MDF 和 LDF 檔案`App_Data`為其他資料夾。</span><span class="sxs-lookup"><span data-stu-id="ed264-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="ed264-287">之後測試的功能，您可以藉由關閉 Visual Studio 還原資料庫，並取代目前的 MDF 和 LDF 檔案`App_Data`使用備份副本。</span><span class="sxs-lookup"><span data-stu-id="ed264-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>


## <a name="summary"></a><span data-ttu-id="ed264-288">總結</span><span class="sxs-lookup"><span data-stu-id="ed264-288">Summary</span></span>

<span data-ttu-id="ed264-289">雖然 TableAdapter s 精靈 會自動為我們產生預存程序，但是有些的時候，當我們可能已有建立這類預存程序或想要改為建立它們以手動方式或使用其他工具。</span><span class="sxs-lookup"><span data-stu-id="ed264-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="ed264-290">為了滿足這類案例，TableAdapter 也可以設定以指向現有的預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="ed264-291">在本教學課程中我們探討了如何以手動方式將預存程序新增至透過 Visual Studio 環境的資料庫，以及如何將 TableAdapter 的方法傳送至這些預存程序。</span><span class="sxs-lookup"><span data-stu-id="ed264-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="ed264-292">此外，我們也會檢查的 T-SQL 命令和指令碼模式，用於啟動、 認可和回復預存程序內的交易。</span><span class="sxs-lookup"><span data-stu-id="ed264-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="ed264-293">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="ed264-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ed264-294">關於作者</span><span class="sxs-lookup"><span data-stu-id="ed264-294">About the Author</span></span>

<span data-ttu-id="ed264-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="ed264-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ed264-296">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="ed264-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ed264-297">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="ed264-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ed264-298">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ed264-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ed264-299">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="ed264-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ed264-300">特別感謝</span><span class="sxs-lookup"><span data-stu-id="ed264-300">Special Thanks To</span></span>

<span data-ttu-id="ed264-301">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="ed264-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ed264-302">本教學課程中的潛在客戶檢閱者已 Hilton Geisenow、 S ren Jacob Lauritsen 和 Teresa murphy 徹底檢驗了。</span><span class="sxs-lookup"><span data-stu-id="ed264-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="ed264-303">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="ed264-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ed264-304">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ed264-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ed264-305">[上一頁](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
> [下一頁](updating-the-tableadapter-to-use-joins-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ed264-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
[Next](updating-the-tableadapter-to-use-joins-vb.md)</span></span>
