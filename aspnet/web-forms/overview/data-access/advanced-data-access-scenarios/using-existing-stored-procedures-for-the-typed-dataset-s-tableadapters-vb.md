---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
title: 針對具類型資料集的 Tableadapter 使用現有的預存程式（VB） |Microsoft Docs
author: rick-anderson
description: 在上一個教學課程中，我們已瞭解如何使用 TableAdapter Wizard 來產生新的預存程式。 在本教學課程中，我們將瞭解相同的 TableAdapter 。
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 2da25f6a-757e-4e7b-a812-1575288d8f7a
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
msc.type: authoredcontent
ms.openlocfilehash: e35c3d6a98516a07f6119e6cb9dbeb99bc28fe33
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78531798"
---
# <a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-vb"></a><span data-ttu-id="8ca61-104">使用具類型資料集 Tableadapter 現有的預存程序 (VB)</span><span class="sxs-lookup"><span data-stu-id="8ca61-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (VB)</span></span>

<span data-ttu-id="8ca61-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8ca61-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8ca61-106">[下載程式代碼](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip)或[下載 PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8ca61-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span></span>

> <span data-ttu-id="8ca61-107">在上一個教學課程中，我們已瞭解如何使用 TableAdapter Wizard 來產生新的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="8ca61-108">在本教學課程中，我們將瞭解相同的 TableAdapter Wizard 如何使用現有的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="8ca61-109">我們也會學習如何以手動方式將新的預存程式加入至我們的資料庫。</span><span class="sxs-lookup"><span data-stu-id="8ca61-109">We also learn how to manually add new stored procedures to our database.</span></span>

## <a name="introduction"></a><span data-ttu-id="8ca61-110">簡介</span><span class="sxs-lookup"><span data-stu-id="8ca61-110">Introduction</span></span>

<span data-ttu-id="8ca61-111">在[先前的教學](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)課程中，我們已瞭解如何將具類型資料集的 tableadapter 設定為使用預存程式來存取資料，而不是特定的 SQL 語句。</span><span class="sxs-lookup"><span data-stu-id="8ca61-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="8ca61-112">特別是，我們已檢查如何讓 TableAdapter wizard 自動建立這些預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="8ca61-113">將繼承應用程式移植到 ASP.NET 2.0 時，或在現有的資料模型周圍建立 ASP.NET 2.0 網站時，資料庫可能已經包含我們所需的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="8ca61-114">或者，您可能會想要手動建立預存程式，或透過自動產生預存程式的 TableAdapter wizard 以外的某個工具來建立。</span><span class="sxs-lookup"><span data-stu-id="8ca61-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="8ca61-115">在本教學課程中，我們將探討如何設定 TableAdapter 以使用現有的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="8ca61-116">由於 Northwind 資料庫只有一小部分的內建預存程式，因此我們也會探討透過 Visual Studio 環境，手動將新的預存程式加入至資料庫所需的步驟。</span><span class="sxs-lookup"><span data-stu-id="8ca61-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="8ca61-117">讓我們開始吧！</span><span class="sxs-lookup"><span data-stu-id="8ca61-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="8ca61-118">在交易中的[包裝資料庫修改](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)教學課程中，我們已將方法新增至 TableAdapter，以支援交易（`BeginTransaction`、`CommitTransaction`等等）。</span><span class="sxs-lookup"><span data-stu-id="8ca61-118">In the [Wrapping Database Modifications within a Transaction](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="8ca61-119">或者，您可以完全在預存程式內管理交易，而不需要修改資料存取層程式碼。</span><span class="sxs-lookup"><span data-stu-id="8ca61-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="8ca61-120">在本教學課程中，我們將探索用來在交易範圍內執行預存程式 s 語句的 T-sql 命令。</span><span class="sxs-lookup"><span data-stu-id="8ca61-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>

## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="8ca61-121">步驟1：將預存程式加入至 Northwind 資料庫</span><span class="sxs-lookup"><span data-stu-id="8ca61-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="8ca61-122">Visual Studio 可讓您輕鬆地將新的預存程式加入至資料庫。</span><span class="sxs-lookup"><span data-stu-id="8ca61-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="8ca61-123">讓 s 將新的預存程式加入 Northwind 資料庫，以傳回 `Products` 資料表中具有特定 `CategoryID` 值的所有資料行。</span><span class="sxs-lookup"><span data-stu-id="8ca61-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="8ca61-124">從 [伺服器總管] 視窗中，展開 Northwind 資料庫，使其資料夾（資料庫關係圖、資料表、視圖等等）顯示。</span><span class="sxs-lookup"><span data-stu-id="8ca61-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="8ca61-125">如先前的教學課程中所見，[預存程式] 資料夾包含資料庫的現有預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="8ca61-126">若要加入新的預存程式，只要以滑鼠右鍵按一下 [預存程式] 資料夾，然後從內容功能表選擇 [加入新的預存程式] 選項即可。</span><span class="sxs-lookup"><span data-stu-id="8ca61-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>

<span data-ttu-id="8ca61-127">[![以滑鼠右鍵按一下 [預存程式] 資料夾，並加入新的預存程式](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span></span>

<span data-ttu-id="8ca61-128">**圖 1**：以滑鼠右鍵按一下 [預存程式] 資料夾，並加入新的預存程式（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span></span>

<span data-ttu-id="8ca61-129">如 圖 1 所示，選取 加入新的預存程式 選項會在 Visual Studio 中開啟一個腳本視窗，其中包含建立預存程式所需之 SQL 腳本的外框。</span><span class="sxs-lookup"><span data-stu-id="8ca61-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="8ca61-130">我們的工作是要充實此腳本並加以執行，此時將會在資料庫中加入預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="8ca61-131">輸入下列腳本：</span><span class="sxs-lookup"><span data-stu-id="8ca61-131">Enter the following script:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample1.sql)]

<span data-ttu-id="8ca61-132">執行此腳本時，會將新的預存程式加入至名為 `Products_SelectByCategoryID`的 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="8ca61-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="8ca61-133">這個預存程式會接受 `int`類型的單一輸入參數（`@CategoryID`），並傳回具有相符 `CategoryID` 值的所有產品欄位。</span><span class="sxs-lookup"><span data-stu-id="8ca61-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="8ca61-134">若要執行此 `CREATE PROCEDURE` 腳本，並將預存程式加入資料庫，請按一下工具列中的 [儲存] 圖示，或按 Ctrl + S。</span><span class="sxs-lookup"><span data-stu-id="8ca61-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="8ca61-135">這麼做之後，[預存程式] 資料夾會重新整理，並顯示新建立的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="8ca61-136">此外，視窗中的腳本會將奧妙從 `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` 變更為 `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="8ca61-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="8ca61-137">`CREATE PROCEDURE` 會將新的預存程式加入至資料庫，而 `ALTER PROCEDURE` 會更新現有的進程。</span><span class="sxs-lookup"><span data-stu-id="8ca61-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="8ca61-138">由於腳本的開頭已變更為 `ALTER PROCEDURE`，因此，變更預存程式的輸入參數或 SQL 語句，然後按一下 [儲存] 圖示，將會使用這些變更來更新預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="8ca61-139">[圖 2] 顯示儲存 `Products_SelectByCategoryID` 預存程式之後 Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="8ca61-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>

<span data-ttu-id="8ca61-140">[![預存程式 Products_SelectByCategoryID 已加入資料庫中](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span></span>

<span data-ttu-id="8ca61-141">**圖 2**：預存程式 `Products_SelectByCategoryID` 已新增至資料庫（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span></span>

## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="8ca61-142">步驟2：設定 TableAdapter 使用現有的預存程式</span><span class="sxs-lookup"><span data-stu-id="8ca61-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="8ca61-143">既然 `Products_SelectByCategoryID` 預存程式已新增至資料庫，我們就可以在叫用其其中一個方法時，設定資料存取層來使用這個預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can configure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="8ca61-144">特別的是，我們會將 `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` 方法加入至 `NorthwindWithSprocs` 具類型資料集內的 `ProductsTableAdapter`，以呼叫我們剛才建立的 `Products_SelectByCategoryID` 預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-144">In particular, we will add a `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="8ca61-145">從開啟 `NorthwindWithSprocs` 資料集開始。</span><span class="sxs-lookup"><span data-stu-id="8ca61-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="8ca61-146">以滑鼠右鍵按一下 `ProductsTableAdapter`，然後選擇 [加入查詢] 來啟動 [TableAdapter 查詢設定向導]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="8ca61-147">在[先前的教學](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)課程中，我們選擇讓 TableAdapter 為我們建立新的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="8ca61-148">不過，在本教學課程中，我們想要將新的 TableAdapter 方法連接到現有的 `Products_SelectByCategoryID` 預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="8ca61-149">因此，請從 wizard 的第一個步驟中選擇 [使用現有的預存程式] 選項，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>

<span data-ttu-id="8ca61-150">[![選擇 [使用現有的預存程式] 選項](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span></span>

<span data-ttu-id="8ca61-151">**圖 3**：選擇 [使用現有的預存程式] 選項（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span></span>

<span data-ttu-id="8ca61-152">下列畫面提供的下拉式清單會填入資料庫的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="8ca61-153">選取預存程式會在左邊列出其輸入參數，並在右邊傳回資料欄位（如果有的話）。</span><span class="sxs-lookup"><span data-stu-id="8ca61-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="8ca61-154">從清單中選擇 [`Products_SelectByCategoryID` 預存程式]，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>

<span data-ttu-id="8ca61-155">[![挑選 Products_SelectByCategoryID 預存程式](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span></span>

<span data-ttu-id="8ca61-156">**圖 4**：挑選 `Products_SelectByCategoryID` 預存程式（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span></span>

<span data-ttu-id="8ca61-157">下一個畫面會詢問預存程式所傳回的資料種類，而這裡的答案會決定 TableAdapter s 方法所傳回的型別。</span><span class="sxs-lookup"><span data-stu-id="8ca61-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="8ca61-158">例如，如果我們指出會傳回表格式資料，此方法將會傳回一個 `ProductsDataTable` 實例，其中填入了預存程式所傳回的記錄。</span><span class="sxs-lookup"><span data-stu-id="8ca61-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="8ca61-159">相反地，如果我們指出此預存程式會傳回單一值，TableAdapter 會傳回 `Object`，而該值會指派給預存程式所傳回之第一個記錄的第一個資料行中的值。</span><span class="sxs-lookup"><span data-stu-id="8ca61-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `Object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="8ca61-160">因為 `Products_SelectByCategoryID` 預存程式會傳回屬於特定分類的所有產品，請選擇第一個回應-表格式資料-然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>

<span data-ttu-id="8ca61-161">[![表示預存程式會傳回表格式資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span></span>

<span data-ttu-id="8ca61-162">**圖 5**：表示預存程式會傳回表格式資料（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span></span>

<span data-ttu-id="8ca61-163">剩下的就是指出要使用的方法模式，後面接著這些方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="8ca61-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="8ca61-164">將 [填滿 DataTable] 和 [傳回 DataTable 選項] 保持勾選，但將方法重新命名為 `FillByCategoryID` 和 `GetProductsByCategoryID`。</span><span class="sxs-lookup"><span data-stu-id="8ca61-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="8ca61-165">然後按 [下一步]，以查看嚮導將執行之工作的摘要。</span><span class="sxs-lookup"><span data-stu-id="8ca61-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="8ca61-166">如果一切看起來正確，請按一下 [完成]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-166">If everything looks correct, click Finish.</span></span>

<span data-ttu-id="8ca61-167">[![將方法命名為 FillByCategoryID 和 GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span></span>

<span data-ttu-id="8ca61-168">**圖 6**：命名方法 `FillByCategoryID` 和 `GetProductsByCategoryID` （[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="8ca61-169">我們剛才建立、`FillByCategoryID` 和 `GetProductsByCategoryID`的 TableAdapter 方法，預期 `Integer`類型的輸入參數。</span><span class="sxs-lookup"><span data-stu-id="8ca61-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `Integer`.</span></span> <span data-ttu-id="8ca61-170">這個輸入參數值會透過其 `@CategoryID` 參數傳遞至預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="8ca61-171">如果您修改 `Products_SelectByCategory` 預存程式的參數，則也必須更新這些 TableAdapter 方法的參數。</span><span class="sxs-lookup"><span data-stu-id="8ca61-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="8ca61-172">如[前一個教學](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)課程所討論，這可以透過下列兩種方式的其中一種來完成：手動新增或移除參數集合中的參數，或重新執行 TableAdapter wizard。</span><span class="sxs-lookup"><span data-stu-id="8ca61-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>

## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="8ca61-173">步驟3：將`GetProductsByCategoryID(categoryID)`方法新增到 BLL</span><span class="sxs-lookup"><span data-stu-id="8ca61-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="8ca61-174">在 `GetProductsByCategoryID` DAL 方法完成後，下一個步驟是在商務邏輯層中提供此方法的存取權。</span><span class="sxs-lookup"><span data-stu-id="8ca61-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="8ca61-175">開啟 `ProductsBLLWithSprocs` 類別檔案，並新增下列方法：</span><span class="sxs-lookup"><span data-stu-id="8ca61-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>

[!code-vb[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample2.vb)]

<span data-ttu-id="8ca61-176">這個 BLL 方法只會傳回從 `ProductsTableAdapter` s `GetProductsByCategoryID` 方法傳回的 `ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="8ca61-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="8ca61-177">`DataObjectMethodAttribute` 屬性會提供 ObjectDataSource s [設定資料來源] 嚮導所使用的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="8ca61-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="8ca61-178">特別是，此方法會出現在 [選取索引標籤] 下拉式清單中。</span><span class="sxs-lookup"><span data-stu-id="8ca61-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="8ca61-179">步驟4：依類別顯示產品</span><span class="sxs-lookup"><span data-stu-id="8ca61-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="8ca61-180">若要測試新增的 `Products_SelectByCategoryID` 預存程式和對應的 DAL 和 BLL 方法，讓 s 建立一個包含 DropDownList 和 GridView 的 ASP.NET 網頁。</span><span class="sxs-lookup"><span data-stu-id="8ca61-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="8ca61-181">DropDownList 將會列出資料庫中的所有類別，而 GridView 會顯示屬於所選類別目錄的產品。</span><span class="sxs-lookup"><span data-stu-id="8ca61-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="8ca61-182">我們已在先前的教學課程中使用 Dropdownlist 進行建立主要/詳細資料介面。</span><span class="sxs-lookup"><span data-stu-id="8ca61-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="8ca61-183">如需深入瞭解如何執行這類主要/詳細資料包告，請參閱[使用 DropDownList 的主要/詳細資料篩選](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="8ca61-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial.</span></span>

<span data-ttu-id="8ca61-184">開啟 [`AdvancedDAL`] 資料夾中的 [`ExistingSprocs.aspx`] 頁面，並將 DropDownList 從 [工具箱] 拖曳至設計工具。</span><span class="sxs-lookup"><span data-stu-id="8ca61-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="8ca61-185">將 DropDownList s `ID` 屬性設為 `Categories`，並將其 `AutoPostBack` 屬性設定為 `True`。</span><span class="sxs-lookup"><span data-stu-id="8ca61-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `True`.</span></span> <span data-ttu-id="8ca61-186">接下來，從其智慧標籤，將 DropDownList 系結至名為 `CategoriesDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="8ca61-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="8ca61-187">設定 ObjectDataSource，使其從 `CategoriesBLL` 類別的 `GetCategories` 方法中抓取其資料。</span><span class="sxs-lookup"><span data-stu-id="8ca61-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="8ca61-188">將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="8ca61-189">[![從 CategoriesBLL 類別的 GetCategories 方法取出資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span></span>

<span data-ttu-id="8ca61-190">**圖 7**：從 `CategoriesBLL` 類別的 `GetCategories` 方法取出資料（[按一下以觀看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span></span>

<span data-ttu-id="8ca61-191">[![將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span></span>

<span data-ttu-id="8ca61-192">**圖 8**：將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）] （[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span></span>

<span data-ttu-id="8ca61-193">完成 ObjectDataSource wizard 之後，將 DropDownList 設定為顯示 `CategoryName` 資料欄位，並使用 [`CategoryID`] 欄位做為每個 `ListItem`的 `Value`。</span><span class="sxs-lookup"><span data-stu-id="8ca61-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="8ca61-194">此時，DropDownList 和 ObjectDataSource 的宣告式標記應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="8ca61-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>

[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample3.aspx)]

<span data-ttu-id="8ca61-195">接下來，將 GridView 拖曳至設計工具上，並將它放在 DropDownList 之下。</span><span class="sxs-lookup"><span data-stu-id="8ca61-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="8ca61-196">將 GridView 的 `ID` 設定為 `ProductsByCategory` 並從其智慧標籤，將它系結至名為 `ProductsByCategoryDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="8ca61-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="8ca61-197">將 `ProductsByCategoryDataSource` ObjectDataSource 設定為使用 `ProductsBLLWithSprocs` 類別，讓它使用 `GetProductsByCategoryID(categoryID)` 方法來抓取其資料。</span><span class="sxs-lookup"><span data-stu-id="8ca61-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="8ca61-198">由於此 GridView 只會用來顯示資料，請將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>

<span data-ttu-id="8ca61-199">[![將 ObjectDataSource 設定為使用 ProductsBLLWithSprocs 類別](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span></span>

<span data-ttu-id="8ca61-200">**圖 9**：設定 ObjectDataSource 使用 `ProductsBLLWithSprocs` 類別（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span></span>

<span data-ttu-id="8ca61-201">[![從 GetProductsByCategoryID （類別 Id）方法取出資料](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span></span>

<span data-ttu-id="8ca61-202">**圖 10**：從 `GetProductsByCategoryID(categoryID)` 方法取出資料（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span></span>

<span data-ttu-id="8ca61-203">在 [選取] 索引標籤中選擇的方法需要參數，因此 wizard 的最後一個步驟會提示我們輸入參數 s 來源。</span><span class="sxs-lookup"><span data-stu-id="8ca61-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="8ca61-204">將 [參數來源] 下拉式清單設定為 [控制]，然後從 [ControlID] 下拉式清單中選擇 [`Categories`] 控制項。</span><span class="sxs-lookup"><span data-stu-id="8ca61-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="8ca61-205">按一下 [完成] 完成精靈。</span><span class="sxs-lookup"><span data-stu-id="8ca61-205">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="8ca61-206">[![使用分類 DropDownList 做為類別目錄參數的來源](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span></span>

<span data-ttu-id="8ca61-207">**圖 11**：使用 `Categories` DropDownList 做為 `categoryID` 參數的來源（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span></span>

<span data-ttu-id="8ca61-208">完成 ObjectDataSource wizard 之後，Visual Studio 將會為每個產品資料欄位新增 BoundFields 和 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="8ca61-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="8ca61-209">您可以視需要隨意自訂這些欄位。</span><span class="sxs-lookup"><span data-stu-id="8ca61-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="8ca61-210">透過瀏覽器造訪頁面。</span><span class="sxs-lookup"><span data-stu-id="8ca61-210">Visit the page through a browser.</span></span> <span data-ttu-id="8ca61-211">流覽頁面時，會選取 [飲料] 類別，並在方格中列出對應的產品。</span><span class="sxs-lookup"><span data-stu-id="8ca61-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="8ca61-212">將下拉式清單變更為替代類別目錄，如 [圖 12] 所示，會導致回傳，並以新選取之類別的產品重載格線。</span><span class="sxs-lookup"><span data-stu-id="8ca61-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>

<span data-ttu-id="8ca61-213">[隨即顯示 [產生] 分類中的產品 ![](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span></span>

<span data-ttu-id="8ca61-214">**圖 12**：顯示 [產生] 分類中的產品（[按一下以觀看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span></span>

## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="8ca61-215">步驟5：在交易的範圍內包裝預存程式 s 語句</span><span class="sxs-lookup"><span data-stu-id="8ca61-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="8ca61-216">在交易中的[包裝資料庫修改](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)教學課程中，我們討論了在交易範圍內執行一系列資料庫修改語句的技術。</span><span class="sxs-lookup"><span data-stu-id="8ca61-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="8ca61-217">回想一下，在交易的傘之下執行的修改全都成功或全部失敗，以確保不可部分完成性。</span><span class="sxs-lookup"><span data-stu-id="8ca61-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="8ca61-218">使用交易的技巧包括：</span><span class="sxs-lookup"><span data-stu-id="8ca61-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="8ca61-219">使用 `System.Transactions` 命名空間中的類別，</span><span class="sxs-lookup"><span data-stu-id="8ca61-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="8ca61-220">讓資料存取層使用 ADO.NET 類別，例如 `SqlTransaction`，以及</span><span class="sxs-lookup"><span data-stu-id="8ca61-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="8ca61-221">直接在預存程式內加入 T-sql transaction 命令</span><span class="sxs-lookup"><span data-stu-id="8ca61-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="8ca61-222">交易教學課程*中的包裝資料庫修改*使用 DAL 中的 ADO.NET 類別。</span><span class="sxs-lookup"><span data-stu-id="8ca61-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="8ca61-223">本教學課程的其餘部分將探討如何使用預存程式內的 T-sql 命令來管理交易。</span><span class="sxs-lookup"><span data-stu-id="8ca61-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="8ca61-224">用於手動啟動、認可和回復交易的三個關鍵 SQL 命令分別是 `BEGIN TRANSACTION`、`COMMIT TRANSACTION`和 `ROLLBACK TRANSACTION`。</span><span class="sxs-lookup"><span data-stu-id="8ca61-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="8ca61-225">如同使用 ADO.NET 方法，從預存程式內使用交易時，我們必須套用下列模式：</span><span class="sxs-lookup"><span data-stu-id="8ca61-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="8ca61-226">指出交易的開始。</span><span class="sxs-lookup"><span data-stu-id="8ca61-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="8ca61-227">執行組成交易的 SQL 語句。</span><span class="sxs-lookup"><span data-stu-id="8ca61-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="8ca61-228">如果步驟2中的任何一個語句發生錯誤，就會回復交易。</span><span class="sxs-lookup"><span data-stu-id="8ca61-228">If there is an error in any one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="8ca61-229">如果步驟2中的所有語句都完成但沒有發生錯誤，請認可交易。</span><span class="sxs-lookup"><span data-stu-id="8ca61-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="8ca61-230">您可以使用下列範本，在 T-sql 語法中實作為此模式：</span><span class="sxs-lookup"><span data-stu-id="8ca61-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample4.sql)]

<span data-ttu-id="8ca61-231">此範本一開始會定義 `TRY...CATCH` 區塊，這是 SQL Server 2005 的新結構。</span><span class="sxs-lookup"><span data-stu-id="8ca61-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="8ca61-232">如同 Visual Basic 中的 `Try...Catch` 區塊，SQL `TRY...CATCH` 區塊會執行 `TRY` 區塊中的語句。</span><span class="sxs-lookup"><span data-stu-id="8ca61-232">Like with `Try...Catch` blocks in Visual Basic, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="8ca61-233">如果有任何語句引發錯誤，控制權會立即傳送至 `CATCH` 區塊。</span><span class="sxs-lookup"><span data-stu-id="8ca61-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="8ca61-234">如果執行構成交易的 SQL 語句時沒有任何錯誤，`COMMIT TRANSACTION` 語句會認可變更並完成交易。</span><span class="sxs-lookup"><span data-stu-id="8ca61-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="8ca61-235">但是，如果其中一個語句導致錯誤，則 `CATCH` 區塊中的 `ROLLBACK TRANSACTION` 會將資料庫傳回至交易開始之前的狀態。</span><span class="sxs-lookup"><span data-stu-id="8ca61-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="8ca61-236">預存程式也會使用[RAISERROR 命令](https://msdn.microsoft.com/library/ms178592.aspx)引發錯誤，這會導致在應用程式中引發 `SqlException`。</span><span class="sxs-lookup"><span data-stu-id="8ca61-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="8ca61-237">由於 `TRY...CATCH` 區塊是 SQL Server 2005 的新手，因此如果您使用舊版的 Microsoft SQL Server，上述範本將無法使用。</span><span class="sxs-lookup"><span data-stu-id="8ca61-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="8ca61-238">如果您不是使用 SQL Server 2005，請參閱[管理 SQL Server 預存程式中的交易](http://www.4guysfromrolla.com/webtech/080305-1.shtml)，以取得可與其他版本 SQL Server 搭配使用的範本。</span><span class="sxs-lookup"><span data-stu-id="8ca61-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>

<span data-ttu-id="8ca61-239">讓我們看一下具體的範例。</span><span class="sxs-lookup"><span data-stu-id="8ca61-239">Let s look at a concrete example.</span></span> <span data-ttu-id="8ca61-240">`Categories` 和 `Products` 資料表之間存在外鍵條件約束，這表示 `Products` 資料表中的每個 `CategoryID` 欄位都必須對應到 `CategoryID` 資料表中的 `Categories` 值。</span><span class="sxs-lookup"><span data-stu-id="8ca61-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="8ca61-241">任何會違反此條件約束的動作（例如，嘗試刪除具有相關聯產品的類別）都會導致外鍵條件約束違規。</span><span class="sxs-lookup"><span data-stu-id="8ca61-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="8ca61-242">若要確認這一點，請造訪使用二進位資料一節（`~/BinaryData/UpdatingAndDeleting.aspx`）中的更新和刪除現有的二進位資料範例。</span><span class="sxs-lookup"><span data-stu-id="8ca61-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="8ca61-243">此頁面會列出系統中的每個類別，以及 [編輯] 和 [刪除] 按鈕（請參閱 [圖 13]），但如果您嘗試刪除具有相關產品（例如飲料）的類別，則刪除作業會因為外鍵條件約束違規而失敗（請參閱 [圖 14]）。</span><span class="sxs-lookup"><span data-stu-id="8ca61-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>

<span data-ttu-id="8ca61-244">[![每個類別都會顯示在具有 [編輯] 和 [刪除] 按鈕的 GridView 中](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span></span>

<span data-ttu-id="8ca61-245">**圖 13**：每個類別目錄都會顯示在具有 [編輯] 和 [刪除] 按鈕的 GridView 中（[按一下以查看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span></span>

<span data-ttu-id="8ca61-246">[![您無法刪除具有現有產品的類別](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="8ca61-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span></span>

<span data-ttu-id="8ca61-247">**圖 14**：您無法刪除具有現有產品的類別（[按一下以觀看完整大小的影像](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="8ca61-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span></span>

<span data-ttu-id="8ca61-248">不過，假設我們想要允許刪除類別，而不論它們是否有相關聯的產品。</span><span class="sxs-lookup"><span data-stu-id="8ca61-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="8ca61-249">如果您要刪除包含產品的類別，請想像我們也想要刪除其現有的產品（雖然另一個選項是將其產品 `CategoryID` 值設定為 `NULL`）。</span><span class="sxs-lookup"><span data-stu-id="8ca61-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="8ca61-250">這項功能可以透過 foreign key 條件約束的 cascade 規則來執行。</span><span class="sxs-lookup"><span data-stu-id="8ca61-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="8ca61-251">或者，我們可以建立一個可接受 `@CategoryID` 輸入參數的預存程式，並在叫用時明確刪除所有相關聯的產品，然後再將指定的分類。</span><span class="sxs-lookup"><span data-stu-id="8ca61-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="8ca61-252">第一次嘗試這種預存程式時，可能如下所示：</span><span class="sxs-lookup"><span data-stu-id="8ca61-252">Our first attempt at such a stored procedure might look like the following:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample5.sql)]

<span data-ttu-id="8ca61-253">雖然這絕對會刪除相關聯的產品和類別，但它不會在交易的傘下這麼做。</span><span class="sxs-lookup"><span data-stu-id="8ca61-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="8ca61-254">假設 `Categories` 上有一些其他外鍵條件約束會禁止刪除特定的 `@CategoryID` 值。</span><span class="sxs-lookup"><span data-stu-id="8ca61-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="8ca61-255">問題在於，在這種情況下，我們會先刪除所有產品，再嘗試刪除類別。</span><span class="sxs-lookup"><span data-stu-id="8ca61-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="8ca61-256">最後的結果是，對於這類類別而言，這個預存程式會移除其所有產品，而類別會保留，因為它在其他資料表中仍有相關的記錄。</span><span class="sxs-lookup"><span data-stu-id="8ca61-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="8ca61-257">不過，如果預存程式已包裝在交易的範圍內，則會在 `Categories`的刪除失敗時，回復 `Products` 資料表的刪除。</span><span class="sxs-lookup"><span data-stu-id="8ca61-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="8ca61-258">下列預存程式腳本會使用交易來確保兩個 `DELETE` 語句之間的不可部分完成性：</span><span class="sxs-lookup"><span data-stu-id="8ca61-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample6.sql)]

<span data-ttu-id="8ca61-259">請花點時間將 `Categories_Delete` 預存程式加入至 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="8ca61-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="8ca61-260">如需將預存程式加入資料庫的指示，請參閱步驟1。</span><span class="sxs-lookup"><span data-stu-id="8ca61-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="8ca61-261">步驟6：更新`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="8ca61-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="8ca61-262">當我們將 `Categories_Delete` 預存程式新增至資料庫時，DAL 目前已設定為使用臨機操作 SQL 語句來執行刪除。</span><span class="sxs-lookup"><span data-stu-id="8ca61-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="8ca61-263">我們需要更新 `CategoriesTableAdapter`，並指示它改用 `Categories_Delete` 預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="8ca61-264">稍早在本教學課程中，我們使用的是 `NorthwindWithSprocs` 資料集。</span><span class="sxs-lookup"><span data-stu-id="8ca61-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="8ca61-265">但是，該資料集只有單一實體，`ProductsDataTable`，而且我們需要使用類別。</span><span class="sxs-lookup"><span data-stu-id="8ca61-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="8ca61-266">因此，在本教學課程的其餘部分，當我討論資料存取層時，我會參考 `Northwind` 資料集，這是我們在[建立資料存取層](../introduction/creating-a-data-access-layer-vb.md)教學課程中建立的一項。</span><span class="sxs-lookup"><span data-stu-id="8ca61-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial.</span></span>

<span data-ttu-id="8ca61-267">開啟 Northwind 資料集，選取 [`CategoriesTableAdapter`]，然後移至 [屬性視窗]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="8ca61-268">屬性視窗會列出 TableAdapter 所使用的 `InsertCommand`、`UpdateCommand`、`DeleteCommand`和 `SelectCommand`，以及其名稱和連接資訊。</span><span class="sxs-lookup"><span data-stu-id="8ca61-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="8ca61-269">展開 [`DeleteCommand`] 屬性，以查看其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="8ca61-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="8ca61-270">如 [圖 15] 所示，[`DeleteCommand` s `CommandType`] 屬性設為 [文字]，它會指示它將 `CommandText` 屬性中的文字當做臨機操作 SQL 查詢傳送。</span><span class="sxs-lookup"><span data-stu-id="8ca61-270">As Figure 15 shows, the `DeleteCommand` s `CommandType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>

![在設計工具中選取 CategoriesTableAdapter，以在 [屬性] 視窗中查看其屬性](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image43.png)

<span data-ttu-id="8ca61-272">**圖 15**：在設計工具中選取 `CategoriesTableAdapter`，以在 [屬性] 視窗中查看其屬性</span><span class="sxs-lookup"><span data-stu-id="8ca61-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>

<span data-ttu-id="8ca61-273">若要變更這些設定，請選取屬性視窗中的（DeleteCommand）文字，然後從下拉式清單中選擇 [（新增）]。</span><span class="sxs-lookup"><span data-stu-id="8ca61-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="8ca61-274">這會清除 [`CommandText`]、[`CommandType`] 和 [`Parameters`] 屬性的設定。</span><span class="sxs-lookup"><span data-stu-id="8ca61-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="8ca61-275">接下來，將 [`CommandType`] 屬性設定為 [`StoredProcedure`]，然後輸入 `CommandText` 的預存程式名稱（`dbo.Categories_Delete`）。</span><span class="sxs-lookup"><span data-stu-id="8ca61-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="8ca61-276">如果您確定依照此順序輸入屬性-首先是 `CommandType`，然後 `CommandText` Visual Studio 會自動填入參數集合。</span><span class="sxs-lookup"><span data-stu-id="8ca61-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="8ca61-277">如果您未依照此順序輸入這些屬性，就必須透過 [參數集合編輯器] 手動新增參數。</span><span class="sxs-lookup"><span data-stu-id="8ca61-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="8ca61-278">不論是哪一種情況，請務必按一下 [參數] 屬性中的省略號，以顯示 [參數集合編輯器]，以確認已進行正確的參數設定變更（請參閱 [圖 16]）。</span><span class="sxs-lookup"><span data-stu-id="8ca61-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="8ca61-279">如果您在對話方塊中看不到任何參數，請手動加入 `@CategoryID` 參數（您不需要加入 `@RETURN_VALUE` 參數）。</span><span class="sxs-lookup"><span data-stu-id="8ca61-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>

![確定參數設定正確](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image44.png)

<span data-ttu-id="8ca61-281">**圖 16**：確定參數設定是否正確</span><span class="sxs-lookup"><span data-stu-id="8ca61-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>

<span data-ttu-id="8ca61-282">一旦 DAL 已更新，刪除類別目錄就會自動刪除其所有相關聯的產品，並在交易的傘下執行此動作。</span><span class="sxs-lookup"><span data-stu-id="8ca61-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="8ca61-283">若要確認這一點，請回到 [更新和刪除現有的二進位資料] 頁面，然後按一下其中一個類別的 [刪除] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8ca61-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="8ca61-284">只要按一下滑鼠，就會刪除類別及其所有相關聯的產品。</span><span class="sxs-lookup"><span data-stu-id="8ca61-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="8ca61-285">在測試 `Categories_Delete` 預存程式之前，會刪除多個產品以及選取的類別目錄，因此建立資料庫的備份複本可能會很謹慎。</span><span class="sxs-lookup"><span data-stu-id="8ca61-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="8ca61-286">如果您使用 `App_Data`中的 `NORTHWND.MDF` 資料庫，只需關閉 Visual Studio，並將 `App_Data` 中的 MDF 和 LDF 檔案複製到其他資料夾。</span><span class="sxs-lookup"><span data-stu-id="8ca61-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="8ca61-287">測試功能之後，您可以藉由關閉 Visual Studio 來還原資料庫，並以備份複本取代 `App_Data` 中目前的 MDF 和 LDF 檔案。</span><span class="sxs-lookup"><span data-stu-id="8ca61-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>

## <a name="summary"></a><span data-ttu-id="8ca61-288">總結</span><span class="sxs-lookup"><span data-stu-id="8ca61-288">Summary</span></span>

<span data-ttu-id="8ca61-289">雖然 TableAdapter 的 wizard 會為我們自動產生預存程式，但有時候我們可能已經建立了這類預存程式，或想要以手動方式或使用其他工具來建立它們。</span><span class="sxs-lookup"><span data-stu-id="8ca61-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="8ca61-290">為了配合這類案例，TableAdapter 也可以設定為指向現有的預存程式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="8ca61-291">在本教學課程中，我們探討了如何透過 Visual Studio 環境，以手動方式將預存程式新增至資料庫，以及如何將 TableAdapter 的方法與這些預存程式連線。</span><span class="sxs-lookup"><span data-stu-id="8ca61-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="8ca61-292">我們也檢查了用來從預存程式內啟動、認可和回復交易的 T-sql 命令和腳本模式。</span><span class="sxs-lookup"><span data-stu-id="8ca61-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="8ca61-293">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="8ca61-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8ca61-294">關於作者</span><span class="sxs-lookup"><span data-stu-id="8ca61-294">About the Author</span></span>

<span data-ttu-id="8ca61-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="8ca61-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8ca61-296">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="8ca61-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8ca61-297">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="8ca61-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8ca61-298">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8ca61-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8ca61-299">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="8ca61-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8ca61-300">特別感謝</span><span class="sxs-lookup"><span data-stu-id="8ca61-300">Special Thanks To</span></span>

<span data-ttu-id="8ca61-301">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="8ca61-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8ca61-302">本教學課程的領導審查者為 Hilton Geisenow、S ren Jacob Lauritsen 和 Teresa Murphy。</span><span class="sxs-lookup"><span data-stu-id="8ca61-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="8ca61-303">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="8ca61-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8ca61-304">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8ca61-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8ca61-305">[上一頁](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
> [下一頁](updating-the-tableadapter-to-use-joins-vb.md)</span><span class="sxs-lookup"><span data-stu-id="8ca61-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
[Next](updating-the-tableadapter-to-use-joins-vb.md)</span></span>
