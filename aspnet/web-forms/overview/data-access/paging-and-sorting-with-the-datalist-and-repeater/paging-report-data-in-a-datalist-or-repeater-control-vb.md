---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-vb
title: DataList 或 Repeater 控制項 (VB) 中的報表資料分頁 |Microsoft Docs
author: rick-anderson
description: 當收錄 DataList 或 Repeater 的供應項目自動分頁或排序支援，本教學課程會示範如何將分頁支援新增至 DataList 或 Repeater...
ms.author: riande
ms.date: 11/13/2006
ms.assetid: bbd6b7f7-b98a-48b4-93f3-341d6a4f53c0
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-vb
msc.type: authoredcontent
ms.openlocfilehash: 69a6843783dad3d8fcd8a5b93c9d8a31f9bb8ec0
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59383235"
---
# <a name="paging-report-data-in-a-datalist-or-repeater-control-vb"></a><span data-ttu-id="61679-103">DataList 或重複項控制項中的分頁報表資料 (VB)</span><span class="sxs-lookup"><span data-stu-id="61679-103">Paging Report Data in a DataList or Repeater Control (VB)</span></span>

<span data-ttu-id="61679-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="61679-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="61679-105">[下載範例應用程式](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_VB.exe)或[下載 PDF](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/datatutorial44vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="61679-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_VB.exe) or [Download PDF](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/datatutorial44vb1.pdf)</span></span>

> <span data-ttu-id="61679-106">雖然收錄 DataList 或 Repeater 的供應項目自動分頁或排序支援，本教學課程會示範如何將分頁支援新增至 DataList 或 Repeater，允許更有彈性的分頁及資料顯示介面。</span><span class="sxs-lookup"><span data-stu-id="61679-106">While neither the DataList nor Repeater offer automatic paging or sorting support, this tutorial shows how to add paging support to the DataList or Repeater, which allows for much more flexible paging and data display interfaces.</span></span>


## <a name="introduction"></a><span data-ttu-id="61679-107">簡介</span><span class="sxs-lookup"><span data-stu-id="61679-107">Introduction</span></span>

<span data-ttu-id="61679-108">分頁和排序是兩個常見的功能，在線上應用程式中顯示資料。</span><span class="sxs-lookup"><span data-stu-id="61679-108">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="61679-109">比方說，搜尋時在線上書店的 ASP.NET 書籍，可能有數百個這類的書籍，但報告，列出搜尋結果會列出每頁只十個相符項目。</span><span class="sxs-lookup"><span data-stu-id="61679-109">For example, when searching for ASP.NET books at an online bookstore, there may be hundreds of such books, but the report listing the search results lists only ten matches per page.</span></span> <span data-ttu-id="61679-110">此外，結果可以依照標題、 價格、 頁數、 作者名稱等等。</span><span class="sxs-lookup"><span data-stu-id="61679-110">Moreover, the results can be sorted by title, price, page count, author name, and so on.</span></span> <span data-ttu-id="61679-111">如我們所述[分頁和排序報表資料](../paging-and-sorting/paging-and-sorting-report-data-vb.md)教學課程中，所有提供內建的刻度的核取方塊可以啟用的分頁支援的 GridView、 DetailsView 和 FormView 控制項。</span><span class="sxs-lookup"><span data-stu-id="61679-111">As we discussed in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-vb.md) tutorial, the GridView, DetailsView, and FormView controls all provide built-in paging support that can be enabled at the tick of a checkbox.</span></span> <span data-ttu-id="61679-112">GridView 也包含排序支援。</span><span class="sxs-lookup"><span data-stu-id="61679-112">The GridView also includes sorting support.</span></span>

<span data-ttu-id="61679-113">不幸的是，DataList 和 Repeater 都不會提供自動分頁或排序支援。</span><span class="sxs-lookup"><span data-stu-id="61679-113">Unfortunately, neither the DataList nor Repeater offer automatic paging or sorting support.</span></span> <span data-ttu-id="61679-114">在本教學課程中，我們將檢驗如何將分頁支援新增至 DataList 或 Repeater。</span><span class="sxs-lookup"><span data-stu-id="61679-114">In this tutorial we'll examine how to add paging support to the DataList or Repeater.</span></span> <span data-ttu-id="61679-115">我們必須以手動方式建立分頁介面顯示的記錄，以適當的頁面，請記得在回傳間所造訪的頁面。</span><span class="sxs-lookup"><span data-stu-id="61679-115">We must manually create the paging interface, display the appropriate page of records, and remember the page being visited across postbacks.</span></span> <span data-ttu-id="61679-116">雖然這需要更多的時間和程式碼比使用 GridView、 DetailsView 或 FormView，DataList 與重複項允許更有彈性的分頁及資料顯示介面。</span><span class="sxs-lookup"><span data-stu-id="61679-116">While this does take more time and code than with the GridView, DetailsView, or FormView, the DataList and Repeater allow for much more flexible paging and data display interfaces.</span></span>

> [!NOTE]
> <span data-ttu-id="61679-117">本教學課程著重在分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-117">This tutorial focuses exclusively on paging.</span></span> <span data-ttu-id="61679-118">在下一個教學課程中我們將把焦點轉到新增排序功能。</span><span class="sxs-lookup"><span data-stu-id="61679-118">In the next tutorial we'll turn our attention to adding sorting capabilities.</span></span>


## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a><span data-ttu-id="61679-119">步驟 1：新增分頁和排序教學課程的網頁</span><span class="sxs-lookup"><span data-stu-id="61679-119">Step 1: Adding the Paging and Sorting Tutorial Web Pages</span></span>

<span data-ttu-id="61679-120">在開始本教學課程之前，可讓 s 先花點時間，將 ASP.NET 頁面，我們需要針對本教學課程中，另一個。</span><span class="sxs-lookup"><span data-stu-id="61679-120">Before we start this tutorial, let s first take a moment to add the ASP.NET pages we'll need for this tutorial and the next one.</span></span> <span data-ttu-id="61679-121">藉由建立新的資料夾中名為專案啟動`PagingSortingDataListRepeater`。</span><span class="sxs-lookup"><span data-stu-id="61679-121">Start by creating a new folder in the project named `PagingSortingDataListRepeater`.</span></span> <span data-ttu-id="61679-122">接下來，新增到此資料夾，將所有設定成使用主版頁面的 下列五個 ASP.NET 頁面`Site.master`:</span><span class="sxs-lookup"><span data-stu-id="61679-122">Next, add the following five ASP.NET pages to this folder, having all of them configured to use the master page `Site.master`:</span></span>

- `Default.aspx`
- `Paging.aspx`
- `Sorting.aspx`
- `SortingWithDefaultPaging.aspx`
- `SortingWithCustomPaging.aspx`


![建立 PagingSortingDataListRepeater 資料夾，並新增這些教學課程的 ASP.NET 網頁](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image1.png)

<span data-ttu-id="61679-124">**圖 1**:建立`PagingSortingDataListRepeater`資料夾並新增教學課程的 ASP.NET 頁面</span><span class="sxs-lookup"><span data-stu-id="61679-124">**Figure 1**: Create a `PagingSortingDataListRepeater` Folder and Add the Tutorial ASP.NET Pages</span></span>


<span data-ttu-id="61679-125">接下來，開啟`Default.aspx`頁面上，並拖曳`SectionLevelTutorialListing.ascx`從使用者控制`UserControls`拖曳至設計介面上的資料夾。</span><span class="sxs-lookup"><span data-stu-id="61679-125">Next, open the `Default.aspx` page and drag the `SectionLevelTutorialListing.ascx` User Control from the `UserControls` folder onto the Design surface.</span></span> <span data-ttu-id="61679-126">此使用者控制項中，我們在中建立[主版頁面與網站導覽](../introduction/master-pages-and-site-navigation-vb.md)教學課程中，列舉站台對應，並顯示這些教學課程中的項目符號清單中目前的區段。</span><span class="sxs-lookup"><span data-stu-id="61679-126">This User Control, which we created in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-vb.md) tutorial, enumerates the site map and displays those tutorials in the current section in a bulleted list.</span></span>


<span data-ttu-id="61679-127">[![將 SectionLevelTutorialListing.ascx 使用者控制項新增至 Default.aspx](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="61679-127">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image2.png)</span></span>

<span data-ttu-id="61679-128">**圖 2**:新增`SectionLevelTutorialListing.ascx`使用者控制項`Default.aspx`([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="61679-128">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image4.png))</span></span>


<span data-ttu-id="61679-129">若要有項目符號清單顯示分頁和排序我們將建立的教學課程，我們要將它們新增至站台對應。</span><span class="sxs-lookup"><span data-stu-id="61679-129">In order to have the bulleted list display the paging and sorting tutorials we'll be creating, we need to add them to the site map.</span></span> <span data-ttu-id="61679-130">開啟`Web.sitemap`檔案，並在編輯和刪除之後新增下列標記，以 DataList 站台對應節點標記：</span><span class="sxs-lookup"><span data-stu-id="61679-130">Open the `Web.sitemap` file and add the following markup after the Editing and Deleting with the DataList site map node markup:</span></span>


[!code-xml[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample1.xml)]


![更新站台對應，以包含新的 ASP.NET 網頁](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image5.png)

<span data-ttu-id="61679-132">**圖 3**:更新站台對應，以包含新的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="61679-132">**Figure 3**: Update the Site Map to Include the New ASP.NET Pages</span></span>


## <a name="a-review-of-paging"></a><span data-ttu-id="61679-133">分頁的檢閱</span><span class="sxs-lookup"><span data-stu-id="61679-133">A Review of Paging</span></span>

<span data-ttu-id="61679-134">在先前的教學課程中，我們了解如何透過 GridView、 DetailsView 和 FormView 控制項中的資料頁面上的內容。</span><span class="sxs-lookup"><span data-stu-id="61679-134">In previous tutorials we saw how to page through the data in the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="61679-135">這三個控制項提供簡單的呼叫中的分頁*預設分頁*可以實作只要選取 控制項 s 智慧標籤中啟用分頁的選項。</span><span class="sxs-lookup"><span data-stu-id="61679-135">These three controls offer a simple form of paging called *default paging* that can be implemented by simply checking the Enable Paging option in the control s smart tag.</span></span> <span data-ttu-id="61679-136">使用預設分頁時，每次要求的資料頁時的第一頁上瀏覽，或當使用者瀏覽至其他頁面的資料 GridView、 DetailsView 或 FormView 控制項重新要求*所有*的資料ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="61679-136">With default paging, each time a page of data is requested either on the first page visit or when the user navigates to a different page of data the GridView, DetailsView, or FormView control re-requests *all* of the data from the ObjectDataSource.</span></span> <span data-ttu-id="61679-137">它然後剪取時顯示的資料錄的特定集給定要求的頁面索引和每頁顯示的記錄數目。</span><span class="sxs-lookup"><span data-stu-id="61679-137">It then snips out the particular set of records to display given the requested page index and the number of records to display per page.</span></span> <span data-ttu-id="61679-138">我們討論過詳細的預設分頁[分頁和排序報表資料](../paging-and-sorting/paging-and-sorting-report-data-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="61679-138">We discussed default paging in detail in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-vb.md) tutorial.</span></span>

<span data-ttu-id="61679-139">預設的分頁重新要求每個頁面的所有記錄，因為它並不實用時夠大量的資料進行分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-139">Since default paging re-requests all records for each page, it is not practical when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="61679-140">例如，假設透過頁面大小為 10 的 50,000 筆記錄的分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-140">For example, imagine paging through 50,000 records with a page size of 10.</span></span> <span data-ttu-id="61679-141">每當使用者移到新的頁面上，必須擷取從資料庫中，所有的 50,000 筆記錄，即使唯一的十個，其中會顯示。</span><span class="sxs-lookup"><span data-stu-id="61679-141">Each time the user moves to a new page, all 50,000 records must be retrieved from the database, even though only ten of them are displayed.</span></span>

<span data-ttu-id="61679-142">*自訂分頁*解決效能問題的預設分頁擷取要求的頁面上顯示的資料錄的精確子集。</span><span class="sxs-lookup"><span data-stu-id="61679-142">*Custom paging* solves the performance concerns of default paging by grabbing only the precise subset of records to display on the requested page.</span></span> <span data-ttu-id="61679-143">在實作自訂分頁時，我們必須撰寫 SQL 查詢，有效率地將會傳回只是一組正確的記錄。</span><span class="sxs-lookup"><span data-stu-id="61679-143">When implementing custom paging, we must write the SQL query that will efficiently return just the correct set of records.</span></span> <span data-ttu-id="61679-144">我們了解如何建立使用新的 SQL Server 2005 s 這類查詢[`ROW_NUMBER()`關鍵字](http://www.4guysfromrolla.com/webtech/010406-1.shtml)回到[有效率地分頁透過大型數量的資料](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="61679-144">We saw how to create such a query using SQL Server 2005 s new [`ROW_NUMBER()` keyword](http://www.4guysfromrolla.com/webtech/010406-1.shtml) back in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) tutorial.</span></span>

<span data-ttu-id="61679-145">DataList 或 Repeater 控制項中實作預設的分頁功能，我們可以使用[`PagedDataSource`類別](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx)周圍的包裝函式`ProductsDataTable`是否正在分頁的內容。</span><span class="sxs-lookup"><span data-stu-id="61679-145">To implement default paging in the DataList or Repeater controls, we can use the [`PagedDataSource` class](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx) as a wrapper around the `ProductsDataTable` whose contents are being paged.</span></span> <span data-ttu-id="61679-146">`PagedDataSource`類別具有`DataSource`可以指派給任何可列舉物件的屬性和[ `PageSize` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx)並[ `CurrentPageIndex` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx)指出多少筆記錄的屬性顯示每個頁面和目前的頁面索引。</span><span class="sxs-lookup"><span data-stu-id="61679-146">The `PagedDataSource` class has a `DataSource` property that can be assigned to any enumerable object and [`PageSize`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx) and [`CurrentPageIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx) properties that indicate how many records to show per page and the current page index.</span></span> <span data-ttu-id="61679-147">一旦有尚未設定這些屬性，`PagedDataSource`可用來當做資料來源的任何資料 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="61679-147">Once these properties have been set, the `PagedDataSource` can be used as the data source of any data Web control.</span></span> <span data-ttu-id="61679-148">`PagedDataSource`、 列舉時，會唯一傳回的記錄其內部的適當子集`DataSource`根據`PageSize`和`CurrentPageIndex`屬性。</span><span class="sxs-lookup"><span data-stu-id="61679-148">The `PagedDataSource`, when enumerated, will only return the appropriate subset of records of its inner `DataSource` based on the `PageSize` and `CurrentPageIndex` properties.</span></span> <span data-ttu-id="61679-149">圖 4 說明的功能`PagedDataSource`類別。</span><span class="sxs-lookup"><span data-stu-id="61679-149">Figure 4 depicts the functionality of the `PagedDataSource` class.</span></span>


![PagedDataSource 包裝的可分頁介面的可列舉物件](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image6.png)

<span data-ttu-id="61679-151">**圖 4**:`PagedDataSource`包裝的可分頁介面的可列舉物件</span><span class="sxs-lookup"><span data-stu-id="61679-151">**Figure 4**: The `PagedDataSource` Wraps an Enumerable Object with a Pageable Interface</span></span>


<span data-ttu-id="61679-152">`PagedDataSource`物件可以是建立和設定直接從商務邏輯層和繫結至 DataList 或 Repeater 透過 ObjectDataSource，或可以建立及設定直接在 ASP.NET 頁面 s 程式碼後置類別中。</span><span class="sxs-lookup"><span data-stu-id="61679-152">The `PagedDataSource` object can be created and configured directly from the Business Logic Layer and bound to a DataList or Repeater through an ObjectDataSource, or can be created and configured directly in the ASP.NET page s code-behind class.</span></span> <span data-ttu-id="61679-153">如果第二種方法，就必須放棄使用 ObjectDataSource，並改為將資料繫結分頁至 DataList 或 Repeater 以程式設計的方式。</span><span class="sxs-lookup"><span data-stu-id="61679-153">If the latter approach is used, we must forgo using the ObjectDataSource and instead bind the paged data to the DataList or Repeater programmatically.</span></span>

<span data-ttu-id="61679-154">`PagedDataSource`物件也具有屬性，以支援自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-154">The `PagedDataSource` object also has properties to support custom paging.</span></span> <span data-ttu-id="61679-155">不過，我們可以略過使用`PagedDataSource`用於自訂分頁，因為我們已經有 BLL 方法`ProductsBLL`類別專為傳回精確的記錄顯示的自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-155">However, we can bypass using a `PagedDataSource` for custom paging because we already have BLL methods in the `ProductsBLL` class designed for custom paging that return the precise records to display.</span></span>

<span data-ttu-id="61679-156">在本教學課程將探討在 DataList 中實作預設的分頁功能，藉由新增新的方法來`ProductsBLL`會傳回已適當設定的類別`PagedDataSource`物件。</span><span class="sxs-lookup"><span data-stu-id="61679-156">In this tutorial we'll look at implementing default paging in a DataList by adding a new method to the `ProductsBLL` class that returns an appropriately configured `PagedDataSource` object.</span></span> <span data-ttu-id="61679-157">在下一個教學課程中，我們會看到如何使用自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-157">In the next tutorial, we'll see how to use custom paging.</span></span>

## <a name="step-2-adding-a-default-paging-method-in-the-business-logic-layer"></a><span data-ttu-id="61679-158">步驟 2：加入商務邏輯層中的預設分頁方法</span><span class="sxs-lookup"><span data-stu-id="61679-158">Step 2: Adding a Default Paging Method in the Business Logic Layer</span></span>

<span data-ttu-id="61679-159">`ProductsBLL`類別目前已傳回產品的所有資訊的方法`GetProducts()`，另一個用於都傳回起始的索引處的產品的特定子集`GetProductsPaged(startRowIndex, maximumRows)`。</span><span class="sxs-lookup"><span data-stu-id="61679-159">The `ProductsBLL` class currently has a method for returning all product information `GetProducts()` and one for returning a particular subset of products at a starting index `GetProductsPaged(startRowIndex, maximumRows)`.</span></span> <span data-ttu-id="61679-160">使用預設分頁 GridView、 DetailsView 和 FormView 控制項所有使用`GetProducts()`方法來擷取所有的產品，但接著使用`PagedDataSource`在內部以顯示記錄中的正確子集合。</span><span class="sxs-lookup"><span data-stu-id="61679-160">With default paging, the GridView, DetailsView, and FormView controls all use the `GetProducts()` method to retrieve all products, but then use a `PagedDataSource` internally to display only the correct subset of records.</span></span> <span data-ttu-id="61679-161">若要複寫使用 DataList 與重複項控制項的這項功能，我們可以模擬此行為到 BLL 中建立的新方法。</span><span class="sxs-lookup"><span data-stu-id="61679-161">To replicate this functionality with the DataList and Repeater controls, we can create a new method in the BLL that mimics this behavior.</span></span>

<span data-ttu-id="61679-162">將方法加入`ProductsBLL`名為類別`GetProductsAsPagedDataSource`會採用兩個整數輸入參數：</span><span class="sxs-lookup"><span data-stu-id="61679-162">Add a method to the `ProductsBLL` class named `GetProductsAsPagedDataSource` that takes in two integer input parameters:</span></span>

- <span data-ttu-id="61679-163">`pageIndex` 若要顯示，頁面的索引編製索引，位於零，並</span><span class="sxs-lookup"><span data-stu-id="61679-163">`pageIndex` the index of the page to display, indexed at zero, and</span></span>
- <span data-ttu-id="61679-164">`pageSize` 每頁顯示的記錄數目。</span><span class="sxs-lookup"><span data-stu-id="61679-164">`pageSize` the number of records to display per page.</span></span>

<span data-ttu-id="61679-165">`GetProductsAsPagedDataSource` 首先會擷取*所有*記錄的`GetProducts()`。</span><span class="sxs-lookup"><span data-stu-id="61679-165">`GetProductsAsPagedDataSource` starts by retrieving *all* of the records from `GetProducts()`.</span></span> <span data-ttu-id="61679-166">然後它會建立`PagedDataSource`物件，設定其`CurrentPageIndex`並`PageSize`屬性，以傳入的值`pageIndex`和`pageSize`參數。</span><span class="sxs-lookup"><span data-stu-id="61679-166">It then creates a `PagedDataSource` object, setting its `CurrentPageIndex` and `PageSize` properties to the values of the passed-in `pageIndex` and `pageSize` parameters.</span></span> <span data-ttu-id="61679-167">此方法結束時，會傳回設定`PagedDataSource`:</span><span class="sxs-lookup"><span data-stu-id="61679-167">The method concludes by returning this configured `PagedDataSource`:</span></span>


[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample2.vb)]

## <a name="step-3-displaying-product-information-in-a-datalist-using-default-paging"></a><span data-ttu-id="61679-168">步驟 3：在使用的預設分頁 DataList 顯示產品資訊</span><span class="sxs-lookup"><span data-stu-id="61679-168">Step 3: Displaying Product Information in a DataList Using Default Paging</span></span>

<span data-ttu-id="61679-169">具有`GetProductsAsPagedDataSource`方法新增至`ProductsBLL`類別中，我們現在可以建立 DataList 或 Repeater 提供預設的分頁功能。</span><span class="sxs-lookup"><span data-stu-id="61679-169">With the `GetProductsAsPagedDataSource` method added to the `ProductsBLL` class, we can now create a DataList or Repeater that provides default paging.</span></span> <span data-ttu-id="61679-170">首先開啟`Paging.aspx`頁面中`PagingSortingDataListRepeater`資料夾，然後從 [工具箱] 拖曳至設計工具，設定 DataList 的拖曳 DataList`ID`屬性設`ProductsDefaultPaging`。</span><span class="sxs-lookup"><span data-stu-id="61679-170">Start by opening the `Paging.aspx` page in the `PagingSortingDataListRepeater` folder and drag a DataList from the Toolbox onto the Designer, setting the DataList s `ID` property to `ProductsDefaultPaging`.</span></span> <span data-ttu-id="61679-171">從 DataList s 智慧標籤，建立名為新 ObjectDataSource`ProductsDefaultPagingDataSource`並將其設定，因此，它會擷取使用資料`GetProductsAsPagedDataSource`方法。</span><span class="sxs-lookup"><span data-stu-id="61679-171">From the DataList s smart tag, create a new ObjectDataSource named `ProductsDefaultPagingDataSource` and configure it so that it retrieves data using the `GetProductsAsPagedDataSource` method.</span></span>


<span data-ttu-id="61679-172">[![建立 ObjectDataSource，並將它設定為使用 GetProductsAsPagedDataSource （） 方法](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="61679-172">[![Create an ObjectDataSource and Configure it to Use the GetProductsAsPagedDataSource () Method](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image7.png)</span></span>

<span data-ttu-id="61679-173">**圖 5**:建立 ObjectDataSource，並將它設定為使用`GetProductsAsPagedDataSource``()`方法 ([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="61679-173">**Figure 5**: Create an ObjectDataSource and Configure it to Use the `GetProductsAsPagedDataSource` `()` Method ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image9.png))</span></span>


<span data-ttu-id="61679-174">設定下拉式清單中更新、 插入和刪除 （無） 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="61679-174">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="61679-175">[![設定下拉式清單中更新、 插入和刪除索引標籤為 （無）](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="61679-175">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image10.png)</span></span>

<span data-ttu-id="61679-176">**圖 6**:設定下拉式清單中更新、 插入和刪除索引標籤為 （無） ([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="61679-176">**Figure 6**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None) ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image12.png))</span></span>


<span data-ttu-id="61679-177">因為`GetProductsAsPagedDataSource`方法需要兩個輸入的參數，此精靈會提示我們輸入這些參數值的來源。</span><span class="sxs-lookup"><span data-stu-id="61679-177">Since the `GetProductsAsPagedDataSource` method expects two input parameters, the wizard prompts us for the source of these parameter values.</span></span>

<span data-ttu-id="61679-178">頁面索引和頁面大小值必須記住在回傳之間。</span><span class="sxs-lookup"><span data-stu-id="61679-178">The page index and page size values must be remembered across postbacks.</span></span> <span data-ttu-id="61679-179">它們可以儲存在檢視狀態、 保存至查詢字串，儲存在工作階段變數，或記住使用一些其他技術。</span><span class="sxs-lookup"><span data-stu-id="61679-179">They can be stored in view state, persisted to the querystring, stored in session variables, or remembered using some other technique.</span></span> <span data-ttu-id="61679-180">在本教學課程中，我們將使用查詢字串，好處是允許的資料會設為書籤的特定頁面。</span><span class="sxs-lookup"><span data-stu-id="61679-180">For this tutorial we'll use the querystring, which has the advantage of allowing a particular page of data to be bookmarked.</span></span>

<span data-ttu-id="61679-181">特別是，使用 查詢字串欄位 pageIndex 和的 pageSize`pageIndex`和`pageSize`參數，分別 （請參閱 圖 7）。</span><span class="sxs-lookup"><span data-stu-id="61679-181">In particular, use the querystring fields pageIndex and pageSize for the `pageIndex` and `pageSize` parameters, respectively (see Figure 7).</span></span> <span data-ttu-id="61679-182">因為查詢字串值將不會出現在使用者第一次造訪此頁面時，請花一點時間設定這些參數的預設值。</span><span class="sxs-lookup"><span data-stu-id="61679-182">Take a moment to set the default values for these parameters, as the querystring values won't be present when a user first visits this page.</span></span> <span data-ttu-id="61679-183">針對`pageIndex`，設定的預設值為 0 （這會顯示資料的第一頁） 和`pageSize`的預設值為 4。</span><span class="sxs-lookup"><span data-stu-id="61679-183">For `pageIndex`, set the default value to 0 (which will show the first page of data) and `pageSize` s default value to 4.</span></span>


<span data-ttu-id="61679-184">[![PageIndex 和 pageSize 參數作為來源的查詢字串](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="61679-184">[![Use the QueryString as the Source for the pageIndex and pageSize Parameters](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image13.png)</span></span>

<span data-ttu-id="61679-185">**圖 7**:使用查詢字串做為來源`pageIndex`並`pageSize`參數 ([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="61679-185">**Figure 7**: Use the QueryString as the Source for the `pageIndex` and `pageSize` Parameters ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image15.png))</span></span>


<span data-ttu-id="61679-186">設定之後 ObjectDataSource，Visual Studio 會自動建立`ItemTemplate`的 DataList。</span><span class="sxs-lookup"><span data-stu-id="61679-186">After configuring the ObjectDataSource, Visual Studio automatically creates an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="61679-187">自訂`ItemTemplate`以便顯示只有 s 產品名稱、 類別和供應商。</span><span class="sxs-lookup"><span data-stu-id="61679-187">Customize the `ItemTemplate` so that only the product s name, category, and supplier are shown.</span></span> <span data-ttu-id="61679-188">也設定 DataList s`RepeatColumns`屬性設為 2，其`Width`為 100%，並將其`ItemStyle`s`Width`為 50%。</span><span class="sxs-lookup"><span data-stu-id="61679-188">Also set the DataList s `RepeatColumns` property to 2, its `Width` to 100%, and its `ItemStyle` s `Width` to 50%.</span></span> <span data-ttu-id="61679-189">這些寬度設定會提供兩個資料行的相等間距。</span><span class="sxs-lookup"><span data-stu-id="61679-189">These width settings will provide equal spacing for the two columns.</span></span>

<span data-ttu-id="61679-190">進行這些變更之後，DataList 與 ObjectDataSource 的標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="61679-190">After making these changes, the DataList and ObjectDataSource s markup should look similar to the following:</span></span>


[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample3.aspx)]

> [!NOTE]
> <span data-ttu-id="61679-191">因為我們不會執行任何更新或刪除在本教學課程中的功能，您可能會停用 DataList s 的檢視狀態，以減少呈現的頁面大小。</span><span class="sxs-lookup"><span data-stu-id="61679-191">Since we are not performing any update or delete functionality in this tutorial, you may disable the DataList s view state to reduce the rendered page size.</span></span>


<span data-ttu-id="61679-192">當一開始瀏覽此頁面在瀏覽器都`pageIndex`也不`pageSize`提供查詢字串參數。</span><span class="sxs-lookup"><span data-stu-id="61679-192">When initially visiting this page through a browser, neither the `pageIndex` nor `pageSize` querystring parameters are provided.</span></span> <span data-ttu-id="61679-193">因此，會使用 0 到 4 的預設值。</span><span class="sxs-lookup"><span data-stu-id="61679-193">Hence, the default values of 0 and 4 are used.</span></span> <span data-ttu-id="61679-194">如 [圖 8] 所示，這會導致顯示前四個產品的 DataList。</span><span class="sxs-lookup"><span data-stu-id="61679-194">As Figure 8 shows, this results in a DataList that displays the first four products.</span></span>


<span data-ttu-id="61679-195">[![第四個產品詳列](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="61679-195">[![The First Four Products are Listed](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image16.png)</span></span>

<span data-ttu-id="61679-196">**圖 8**:第四個產品詳列 ([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="61679-196">**Figure 8**: The First Four Products are Listed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image18.png))</span></span>


<span data-ttu-id="61679-197">沒有使用者瀏覽至第二個資料頁，表示分頁介面，該處 s 目前無法直接了當。</span><span class="sxs-lookup"><span data-stu-id="61679-197">Without a paging interface, there s currently no straightforward means for a user to navigate to the second page of data.</span></span> <span data-ttu-id="61679-198">我們將在步驟 4 中建立的分頁介面。</span><span class="sxs-lookup"><span data-stu-id="61679-198">We'll create a paging interface in step 4.</span></span> <span data-ttu-id="61679-199">現在，不過，分頁僅可藉由直接於 querystring 中指定的分頁準則。</span><span class="sxs-lookup"><span data-stu-id="61679-199">For now, though, paging can only be accomplished by directly specifying the paging criteria in the querystring.</span></span> <span data-ttu-id="61679-200">例如，若要檢視的第二頁，變更瀏覽器的網址列中的 URL`Paging.aspx`至`Paging.aspx?pageIndex=2`按 enter 鍵。</span><span class="sxs-lookup"><span data-stu-id="61679-200">For example, to view the second page, change the URL in the browser s Address bar from `Paging.aspx` to `Paging.aspx?pageIndex=2` and hit Enter.</span></span> <span data-ttu-id="61679-201">這會導致要顯示資料的第二頁 （請參閱 圖 9）。</span><span class="sxs-lookup"><span data-stu-id="61679-201">This causes the second page of data to be displayed (see Figure 9).</span></span>


<span data-ttu-id="61679-202">[![第二個頁面的資料會顯示](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="61679-202">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image19.png)</span></span>

<span data-ttu-id="61679-203">**圖 9**:第二個頁面的資料會顯示 ([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="61679-203">**Figure 9**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image21.png))</span></span>


## <a name="step-4-creating-the-paging-interface"></a><span data-ttu-id="61679-204">步驟 4：建立分頁介面</span><span class="sxs-lookup"><span data-stu-id="61679-204">Step 4: Creating the Paging Interface</span></span>

<span data-ttu-id="61679-205">有各種不同的分頁介面可以實作。</span><span class="sxs-lookup"><span data-stu-id="61679-205">There are a variety of different paging interfaces that can be implemented.</span></span> <span data-ttu-id="61679-206">GridView、 DetailsView 和 FormView 控制項提供四個不同的介面，可選擇：</span><span class="sxs-lookup"><span data-stu-id="61679-206">The GridView, DetailsView, and FormView controls provide four different interfaces to choose among:</span></span>

- <span data-ttu-id="61679-207">**接下來，先前**使用者可以在階段中的一個或下一個一個移動一頁。</span><span class="sxs-lookup"><span data-stu-id="61679-207">**Next, Previous** users can move one page at a time, to either the next or previous one.</span></span>
- <span data-ttu-id="61679-208">**下一步 上, 一步中，先上次**除了下一步 和 上一頁 按鈕，這個介面包含將移至第一個或最後一個頁面的第一個和最後一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="61679-208">**Next, Previous, First, Last** in addition to Next and Previous buttons, this interface includes First and Last buttons for moving to the very first or very last page.</span></span>
- <span data-ttu-id="61679-209">**數值**列出頁面中的數字的分頁介面，讓使用者快速跳至特定頁面。</span><span class="sxs-lookup"><span data-stu-id="61679-209">**Numeric** lists the page numbers in the paging interface, allowing a user to quickly jump to a particular page.</span></span>
- <span data-ttu-id="61679-210">**數值，第一次，最後一個**數值的頁碼，除了包含 移至第一個或最後一個頁面上的按鈕。</span><span class="sxs-lookup"><span data-stu-id="61679-210">**Numeric, First, Last** in addition to the numeric page numbers, includes buttons for moving to the very first or very last page.</span></span>

<span data-ttu-id="61679-211">DataList 和 Repeater，我們會負責決定分頁介面，並實作它。</span><span class="sxs-lookup"><span data-stu-id="61679-211">For the DataList and Repeater, we are responsible for deciding upon a paging interface and implementing it.</span></span> <span data-ttu-id="61679-212">這牽涉到頁面中建立所需的 Web 控制項和顯示要求的頁面，按一下特定的分頁介面按鈕時。</span><span class="sxs-lookup"><span data-stu-id="61679-212">This involves creating the needed Web controls in the page and displaying the requested page when a particular paging interface button is clicked.</span></span> <span data-ttu-id="61679-213">此外，某些分頁介面控制項可能需要停用。</span><span class="sxs-lookup"><span data-stu-id="61679-213">Additionally, certain paging interface controls may need to be disabled.</span></span> <span data-ttu-id="61679-214">比方說，當您檢視使用下一個資料的第一頁上, 一步，第一次，最後一個介面，第一個] 和 [上一步按鈕就會停用。</span><span class="sxs-lookup"><span data-stu-id="61679-214">For example, when viewing the first page of data using the Next, Previous, First, Last interface, both the First and Previous buttons would be disabled.</span></span>

<span data-ttu-id="61679-215">本教學課程中，讓的使用下一步，在上一步，第一次，最後的介面。</span><span class="sxs-lookup"><span data-stu-id="61679-215">For this tutorial, let s use the Next, Previous, First, Last interface.</span></span> <span data-ttu-id="61679-216">將四個按鈕 Web 控制項加入頁面，並設定其`ID`s `FirstPage`， `PrevPage`， `NextPage`，和`LastPage`。</span><span class="sxs-lookup"><span data-stu-id="61679-216">Add four Button Web controls to the page and set their `ID` s to `FirstPage`, `PrevPage`, `NextPage`, and `LastPage`.</span></span> <span data-ttu-id="61679-217">設定`Text`屬性，以&lt;&lt;第一， &lt; Prev、 下一步&gt;，和最後一個&gt; &gt; 。</span><span class="sxs-lookup"><span data-stu-id="61679-217">Set the `Text` properties to &lt;&lt; First, &lt; Prev, Next &gt;, and Last &gt;&gt; .</span></span>


[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample4.aspx)]

<span data-ttu-id="61679-218">接下來，建立`Click`鎯瓾餂鈕的每個事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="61679-218">Next, create a `Click` event handler for each of these Buttons.</span></span> <span data-ttu-id="61679-219">稍後我們將新增顯示要求的頁面所需的程式碼。</span><span class="sxs-lookup"><span data-stu-id="61679-219">In a moment we'll add the code necessary to display the requested page.</span></span>

## <a name="remembering-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="61679-220">記住透過正在分頁的記錄總數</span><span class="sxs-lookup"><span data-stu-id="61679-220">Remembering the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="61679-221">不論選取的分頁介面，我們必須計算，並請記得透過正在分頁的記錄總數。</span><span class="sxs-lookup"><span data-stu-id="61679-221">Regardless of the paging interface selected, we need to compute and remember the total number of records being paged through.</span></span> <span data-ttu-id="61679-222">總計資料列中的計數 （搭配頁面大小） 決定多少的總頁數的資料正在分頁，以決定哪些分頁介面控制項加入或已啟用。</span><span class="sxs-lookup"><span data-stu-id="61679-222">The total row count (in conjunction with the page size) determines how many total pages of data are being paged through, which determines what paging interface controls are added or are enabled.</span></span> <span data-ttu-id="61679-223">在下一步 上, 一步，第一個，最後一個介面，我們要建置的頁面計數用於兩種方式：</span><span class="sxs-lookup"><span data-stu-id="61679-223">In the Next, Previous, First, Last interface that we are building, the page count is used in two ways:</span></span>

- <span data-ttu-id="61679-224">若要判斷是否我們正在檢視的最後一頁，在此情況下會停用下一步] 和 [最後一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="61679-224">To determine whether we are viewing the last page, in which case the Next and Last buttons are disabled.</span></span>
- <span data-ttu-id="61679-225">如果使用者按一下最後一個按鈕，我們要去 whisk 它們小於頁面的頁面上，其索引是其中一個計數。</span><span class="sxs-lookup"><span data-stu-id="61679-225">If the user clicks the Last button we need to whisk them to the last page, whose index is one less than the page count.</span></span>

<span data-ttu-id="61679-226">除以頁面大小的資料列總數的上限被計算頁面計數。</span><span class="sxs-lookup"><span data-stu-id="61679-226">The page count is calculated as the ceiling of the total row count divided by the page size.</span></span> <span data-ttu-id="61679-227">比方說，如果我們會透過 79 記錄與每一頁的四個記錄的分頁，則頁面計數是 20 (79 上限 / 4)。</span><span class="sxs-lookup"><span data-stu-id="61679-227">For example, if we are paging through 79 records with four records per page, then the page count is 20 (the ceiling of 79 / 4).</span></span> <span data-ttu-id="61679-228">如果我們使用的數字的分頁介面，這項資訊就會將我們通知有關要顯示; 的幾個數值頁面按鈕如果我們的分頁介面包含下一個或最後一個按鈕，頁面計數用來判斷何時要停用下一步] 或 [最後一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="61679-228">If we are using the Numeric paging interface, this information informs us as to how many numeric page buttons to display; if our paging interface includes Next or Last buttons, the page count is used to determine when to disable the Next or Last buttons.</span></span>

<span data-ttu-id="61679-229">如果分頁介面將包含最後一個按鈕，請務必透過正在分頁的記錄總數會記住在回傳之間，以便按一下最後一個按鈕時，我們就可以判斷最後一個頁面索引。</span><span class="sxs-lookup"><span data-stu-id="61679-229">If the paging interface includes a Last button, it is imperative that the total number of records being paged through be remembered across postbacks so that when the Last button is clicked we can determine the last page index.</span></span> <span data-ttu-id="61679-230">若要達成此目的，建立`TotalRowCount`保存它的值，來檢視狀態的 ASP.NET 頁面 s 程式碼後置類別中的屬性：</span><span class="sxs-lookup"><span data-stu-id="61679-230">To facilitate this, create a `TotalRowCount` property in the ASP.NET page s code-behind class that persists its value to view state:</span></span>


[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample5.vb)]

<span data-ttu-id="61679-231">除了`TotalRowCount`、 花點時間建立唯讀頁面層級屬性，以輕鬆存取的頁面索引、 頁面大小和頁面計數：</span><span class="sxs-lookup"><span data-stu-id="61679-231">In addition to `TotalRowCount`, take a minute to create read-only page-level properties for easily accessing the page index, page size, and page count:</span></span>


[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample6.vb)]

## <a name="determining-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="61679-232">判斷透過正在分頁的記錄總數</span><span class="sxs-lookup"><span data-stu-id="61679-232">Determining the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="61679-233">`PagedDataSource`物件傳回從 ObjectDataSource s`Select()`其內的方法有*所有*一個產品記錄，即使它們的子集會顯示在資料清單。</span><span class="sxs-lookup"><span data-stu-id="61679-233">The `PagedDataSource` object returned from the ObjectDataSource s `Select()` method has within it *all* of the product records, even though only a subset of them are displayed in the DataList.</span></span> <span data-ttu-id="61679-234">`PagedDataSource` s [ `Count`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx)會傳回只會顯示 DataList; 中的項目數目[`DataSourceCount`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx)傳回內的項目總數`PagedDataSource`.</span><span class="sxs-lookup"><span data-stu-id="61679-234">The `PagedDataSource` s [`Count` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx) returns only the number of items that will be displayed in the DataList; the [`DataSourceCount` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx) returns the total number of items within the `PagedDataSource`.</span></span> <span data-ttu-id="61679-235">因此，我們需要將 ASP.NET 頁面 s`TotalRowCount`屬性值的`PagedDataSource`s`DataSourceCount`屬性。</span><span class="sxs-lookup"><span data-stu-id="61679-235">Therefore, we need to assign the ASP.NET page s `TotalRowCount` property the value of the `PagedDataSource` s `DataSourceCount` property.</span></span>

<span data-ttu-id="61679-236">若要達成此目的，建立事件處理常式 ObjectDataSource s`Selected`事件。</span><span class="sxs-lookup"><span data-stu-id="61679-236">To accomplish this, create an event handler for the ObjectDataSource s `Selected` event.</span></span> <span data-ttu-id="61679-237">在 `Selected`我們可以存取的 ObjectDataSource s 的傳回值的事件處理常式`Select()`方法，在此情況下， `PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="61679-237">In the `Selected` event handler we have access to the return value of the ObjectDataSource s `Select()` method in this case, the `PagedDataSource`.</span></span>


[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample7.vb)]

## <a name="displaying-the-requested-page-of-data"></a><span data-ttu-id="61679-238">顯示資料的要求的頁面</span><span class="sxs-lookup"><span data-stu-id="61679-238">Displaying the Requested Page of Data</span></span>

<span data-ttu-id="61679-239">當使用者按一下其中一個按鈕，在分頁介面中時，我們要顯示的資料要求的頁面。</span><span class="sxs-lookup"><span data-stu-id="61679-239">When the user clicks one of the buttons in the paging interface, we need to display the requested page of data.</span></span> <span data-ttu-id="61679-240">因為分頁參數會透過查詢字串，指定要顯示的資料，則使用要求的頁面`Response.Redirect(url)`有使用者 s 瀏覽器重新要求`Paging.aspx`以適當的分頁參數 頁面。</span><span class="sxs-lookup"><span data-stu-id="61679-240">Since the paging parameters are specified via the querystring, to show the requested page of data use `Response.Redirect(url)` to have the user s browser re-request the `Paging.aspx` page with the appropriate paging parameters.</span></span> <span data-ttu-id="61679-241">例如，若要顯示資料的第二頁，我們會將使用者重新導向至`Paging.aspx?pageIndex=1`。</span><span class="sxs-lookup"><span data-stu-id="61679-241">For example, to display the second page of data, we would redirect the user to `Paging.aspx?pageIndex=1`.</span></span>

<span data-ttu-id="61679-242">若要達成此目的，建立`RedirectUser(sendUserToPageIndex)`若要將使用者重新導向的方法`Paging.aspx?pageIndex=sendUserToPageIndex`。</span><span class="sxs-lookup"><span data-stu-id="61679-242">To facilitate this, create a `RedirectUser(sendUserToPageIndex)` method that redirects the user to `Paging.aspx?pageIndex=sendUserToPageIndex`.</span></span> <span data-ttu-id="61679-243">然後，呼叫這個方法，從四個按鈕`Click`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="61679-243">Then, call this method from the four Button `Click` event handlers.</span></span> <span data-ttu-id="61679-244">在  `FirstPage` `Click`事件處理常式中，呼叫`RedirectUser(0)`，以將它們傳送至第一頁，在`PrevPage``Click`事件處理常式，使用`PageIndex - 1`做為頁面的索引;，依此類推。</span><span class="sxs-lookup"><span data-stu-id="61679-244">In the `FirstPage` `Click` event handler, call `RedirectUser(0)`, to send them to the first page; in the `PrevPage` `Click` event handler, use `PageIndex - 1` as the page index; and so on.</span></span>


[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample8.vb)]

<span data-ttu-id="61679-245">使用`Click`事件處理常式完成，DataList 的記錄可以透過分頁，按一下按鈕。</span><span class="sxs-lookup"><span data-stu-id="61679-245">With the `Click` event handlers complete, the DataList s records can be paged through by clicking the buttons.</span></span> <span data-ttu-id="61679-246">花點時間，現在就試試看 ！</span><span class="sxs-lookup"><span data-stu-id="61679-246">Take a moment to try it out!</span></span>

## <a name="disabling-paging-interface-controls"></a><span data-ttu-id="61679-247">停用分頁介面控制項</span><span class="sxs-lookup"><span data-stu-id="61679-247">Disabling Paging Interface Controls</span></span>

<span data-ttu-id="61679-248">目前，所有的四個按鈕會啟用不論要檢視的網頁。</span><span class="sxs-lookup"><span data-stu-id="61679-248">Currently, all four buttons are enabled regardless of the page being viewed.</span></span> <span data-ttu-id="61679-249">不過，我們想要顯示的第一頁的資料，以及下一步] 和 [最後一個按鈕時顯示的最後一頁時，停用 [第一個和上一步] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="61679-249">However, we want to disable the First and Previous buttons when showing the first page of data, and the Next and Last buttons when showing the last page.</span></span> <span data-ttu-id="61679-250">`PagedDataSource` ObjectDataSource s 所傳回的物件`Select()`方法都有屬性[ `IsFirstPage` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx)並[ `IsLastPage` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx) ，我們可以檢查來判斷是否我們目前檢視資料的第一個或最後一頁。</span><span class="sxs-lookup"><span data-stu-id="61679-250">The `PagedDataSource` object returned by the ObjectDataSource s `Select()` method has properties [`IsFirstPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx) and [`IsLastPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx) that we can examine to determine if we are viewing the first or last page of data.</span></span>

<span data-ttu-id="61679-251">將下列內容新增到 ObjectDataSource`Selected`事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="61679-251">Add the following to the ObjectDataSource s `Selected` event handler:</span></span>


[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample9.vb)]

<span data-ttu-id="61679-252">此步驟中，[第一個和上一步] 按鈕會停用檢視的第一頁，檢視的最後一頁時，會停用下一步] 和 [最後一個按鈕時。</span><span class="sxs-lookup"><span data-stu-id="61679-252">With this addition, the First and Previous buttons will be disabled when viewing the first page, while the Next and Last buttons will be disabled when viewing the last page.</span></span>

<span data-ttu-id="61679-253">可讓 s 完成分頁介面通知使用者項目頁面上它們目前正在檢視和多少的總頁數存在 re。</span><span class="sxs-lookup"><span data-stu-id="61679-253">Let s complete the paging interface by informing the user what page they re currently viewing and how many total pages exist.</span></span> <span data-ttu-id="61679-254">將標籤 Web 控制項新增至頁面並設定其`ID`屬性設`CurrentPageNumber`。</span><span class="sxs-lookup"><span data-stu-id="61679-254">Add a Label Web control to the page and set its `ID` property to `CurrentPageNumber`.</span></span> <span data-ttu-id="61679-255">設定其`Text`ObjectDataSource 的選取的事件處理常式這類屬性，它會包含目前正在檢視的頁面 (`PageIndex + 1`) 和總頁數 (`PageCount`)。</span><span class="sxs-lookup"><span data-stu-id="61679-255">Set its `Text` property in the ObjectDataSource s Selected event handler such that it includes the current page being viewed (`PageIndex + 1`) and the total number of pages (`PageCount`).</span></span>


[!code-vb[Main](paging-report-data-in-a-datalist-or-repeater-control-vb/samples/sample10.vb)]

<span data-ttu-id="61679-256">[圖 10] 顯示`Paging.aspx`當第一次瀏覽。</span><span class="sxs-lookup"><span data-stu-id="61679-256">Figure 10 shows `Paging.aspx` when first visited.</span></span> <span data-ttu-id="61679-257">查詢字串是空的因為 DataList 會預設為顯示前四個產品中;[第一個和上一步] 按鈕會停用。</span><span class="sxs-lookup"><span data-stu-id="61679-257">Since the querystring is empty, the DataList defaults to showing the first four products; the First and Previous buttons are disabled.</span></span> <span data-ttu-id="61679-258">按一下 下一步 會顯示接下來四個資料錄 （請參閱 圖 11）;現在已啟用 第一個和上一步 按鈕。</span><span class="sxs-lookup"><span data-stu-id="61679-258">Clicking Next displays the next four records (see Figure 11); the First and Previous buttons are now enabled.</span></span>


<span data-ttu-id="61679-259">[![第一個頁面的資料會顯示](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="61679-259">[![The First Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image22.png)</span></span>

<span data-ttu-id="61679-260">**圖 10**:第一個頁面的資料會顯示 ([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="61679-260">**Figure 10**: The First Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image24.png))</span></span>


<span data-ttu-id="61679-261">[![第二個頁面的資料會顯示](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="61679-261">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image25.png)</span></span>

<span data-ttu-id="61679-262">**圖 11**:第二個頁面的資料會顯示 ([按一下以檢視完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="61679-262">**Figure 11**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-vb/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="61679-263">允許使用者指定多少頁面來檢視每個頁面，可以進一步增強分頁介面。</span><span class="sxs-lookup"><span data-stu-id="61679-263">The paging interface can be further enhanced by allowing the user to specify how many pages to view per page.</span></span> <span data-ttu-id="61679-264">比方說，DropDownList 也可以加入像 5、 10、 25、 50 和所有的清單頁面大小選項。</span><span class="sxs-lookup"><span data-stu-id="61679-264">For example, a DropDownList could be added listing page size options like 5, 10, 25, 50, and All.</span></span> <span data-ttu-id="61679-265">在選取的頁面大小，使用者必須重新導向回到`Paging.aspx?pageIndex=0&pageSize=selectedPageSize`。</span><span class="sxs-lookup"><span data-stu-id="61679-265">Upon selecting a page size, the user would need to be redirected back to `Paging.aspx?pageIndex=0&pageSize=selectedPageSize`.</span></span> <span data-ttu-id="61679-266">我保留讀取器實作，做練習這項增強功能。</span><span class="sxs-lookup"><span data-stu-id="61679-266">I leave implementing this enhancement as an exercise for the reader.</span></span>


## <a name="using-custom-paging"></a><span data-ttu-id="61679-267">使用自訂分頁</span><span class="sxs-lookup"><span data-stu-id="61679-267">Using Custom Paging</span></span>

<span data-ttu-id="61679-268">透過使用效率不佳的預設分頁技術及其資料 DataList 頁面。</span><span class="sxs-lookup"><span data-stu-id="61679-268">The DataList pages through its data using the inefficient default paging technique.</span></span> <span data-ttu-id="61679-269">當夠大量的資料進行分頁，務必使用自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-269">When paging through sufficiently large amounts of data, it is imperative that custom paging be used.</span></span> <span data-ttu-id="61679-270">雖然稍有不同的實作詳細資料，DataList 中實作自訂分頁背後的概念並使用預設分頁時相同。</span><span class="sxs-lookup"><span data-stu-id="61679-270">Although the implementation details differ slightly, the concepts behind implementing custom paging in a DataList are the same as with default paging.</span></span> <span data-ttu-id="61679-271">使用自訂分頁時，使用`ProductBLL`類別 s`GetProductsPaged`方法 (而不是`GetProductsAsPagedDataSource`)。</span><span class="sxs-lookup"><span data-stu-id="61679-271">With custom paging, use the `ProductBLL` class s `GetProductsPaged` method (instead of `GetProductsAsPagedDataSource`).</span></span> <span data-ttu-id="61679-272">中所述[有效率地分頁透過大型數量的資料](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md)教學課程中，`GetProductsPaged`必須傳遞開始的資料列索引和最大值的資料列數目傳回。</span><span class="sxs-lookup"><span data-stu-id="61679-272">As discussed in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) tutorial, `GetProductsPaged` must be passed the start row index and maximum number of rows to return.</span></span> <span data-ttu-id="61679-273">這些參數可以透過查詢字串就如同進行維護`pageIndex`和`pageSize`參數使用的預設分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-273">These parameters can be maintained through the querystring just like the `pageIndex` and `pageSize` parameters used in default paging.</span></span>

<span data-ttu-id="61679-274">因為沒有 s 沒有`PagedDataSource`使用自訂分頁時，必須使用替代技術來判斷透過及是否正在分頁的記錄總數我們重新顯示資料的第一個或最後一個頁面。</span><span class="sxs-lookup"><span data-stu-id="61679-274">Since there s no `PagedDataSource` with custom paging, alternative techniques must be used to determine the total number of records being paged through and whether we re displaying the first or last page of data.</span></span> <span data-ttu-id="61679-275">`TotalNumberOfProducts()`方法中的`ProductsBLL`類別會傳回正在分頁透過產品的總數。</span><span class="sxs-lookup"><span data-stu-id="61679-275">The `TotalNumberOfProducts()` method in the `ProductsBLL` class returns the total number of products being paged through.</span></span> <span data-ttu-id="61679-276">若要判斷是否要檢視資料的第一頁，檢查起始資料列索引為零，則在檢視的第一頁。</span><span class="sxs-lookup"><span data-stu-id="61679-276">To determine if the first page of data is being viewed, examine the start row index if it is zero, then the first page is being viewed.</span></span> <span data-ttu-id="61679-277">如果起始資料列索引，再加上要傳回的最大資料列是大於或等於透過正在分頁的記錄總數，是正在檢視的最後一頁。</span><span class="sxs-lookup"><span data-stu-id="61679-277">The last page is being viewed if the start row index plus the maximum rows to return is greater than or equal to the total number of records being paged through.</span></span>

<span data-ttu-id="61679-278">我們將探討在下一個教學課程中，更詳細地實作自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="61679-278">We'll explore implementing custom paging in greater detail in the next tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="61679-279">總結</span><span class="sxs-lookup"><span data-stu-id="61679-279">Summary</span></span>

<span data-ttu-id="61679-280">而 DataList 和 Repeater 都不提供現成的方塊中的分頁支援中找到 GridView、 DetailsView 和 FormView 控制項，可以新增這類功能，而最少的工作。</span><span class="sxs-lookup"><span data-stu-id="61679-280">While neither the DataList nor Repeater offers the out of the box paging support found in the GridView, DetailsView, and FormView controls, such functionality can be added with minimal effort.</span></span> <span data-ttu-id="61679-281">實作預設的分頁功能最簡單的方式是將包裝產品內的整組`PagedDataSource`然後再繫結`PagedDataSource`DataList 或 Repeater。</span><span class="sxs-lookup"><span data-stu-id="61679-281">The easiest way to implement default paging is to wrap the entire set of products within a `PagedDataSource` and then bind the `PagedDataSource` to the DataList or Repeater.</span></span> <span data-ttu-id="61679-282">在本教學課程中，我們新增`GetProductsAsPagedDataSource`方法，以`ProductsBLL`類別，以傳回`PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="61679-282">In this tutorial we added the `GetProductsAsPagedDataSource` method to the `ProductsBLL` class to return the `PagedDataSource`.</span></span> <span data-ttu-id="61679-283">`ProductsBLL`類別已包含的方法所需的自訂分頁`GetProductsPaged`和`TotalNumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="61679-283">The `ProductsBLL` class already contains the methods needed for custom paging `GetProductsPaged` and `TotalNumberOfProducts`.</span></span>

<span data-ttu-id="61679-284">擷取是一組精確自訂分頁顯示的資料錄或中的所有記錄，以及`PagedDataSource`的預設分頁時，我們也需要手動新增分頁介面。</span><span class="sxs-lookup"><span data-stu-id="61679-284">Along with retrieving either the precise set of records to display for custom paging or all records in a `PagedDataSource` for default paging, we also need to manually add the paging interface.</span></span> <span data-ttu-id="61679-285">本教學課程中我們建立下一步、 上一步，第一次，最後一個介面具有四個按鈕 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="61679-285">For this tutorial we created a Next, Previous, First, Last interface with four Button Web controls.</span></span> <span data-ttu-id="61679-286">此外，已新增一個 Label 控制項，顯示目前的頁碼和總頁數。</span><span class="sxs-lookup"><span data-stu-id="61679-286">Also, a Label control displaying the current page number and total number of pages was added.</span></span>

<span data-ttu-id="61679-287">在下一個教學課程中，我們會看到如何將排序支援新增至 DataList 與重複項。</span><span class="sxs-lookup"><span data-stu-id="61679-287">In the next tutorial we'll see how to add sorting support to the DataList and Repeater.</span></span> <span data-ttu-id="61679-288">我們也會看到如何建立可同時分頁和排序 （附範例使用預設和自訂分頁） DataList。</span><span class="sxs-lookup"><span data-stu-id="61679-288">We'll also see how to create a DataList that can be both paged and sorted (with examples using default and custom paging).</span></span>

<span data-ttu-id="61679-289">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="61679-289">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="61679-290">關於作者</span><span class="sxs-lookup"><span data-stu-id="61679-290">About the Author</span></span>

<span data-ttu-id="61679-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="61679-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="61679-292">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="61679-292">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="61679-293">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="61679-293">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="61679-294">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="61679-294">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="61679-295">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="61679-295">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="61679-296">特別感謝</span><span class="sxs-lookup"><span data-stu-id="61679-296">Special Thanks To</span></span>

<span data-ttu-id="61679-297">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="61679-297">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="61679-298">本教學課程中的潛在客戶檢閱者已 Liz Shulok、 Ken Pespisa 和 Bernadette Leigh。</span><span class="sxs-lookup"><span data-stu-id="61679-298">Lead reviewers for this tutorial were Liz Shulok, Ken Pespisa, and Bernadette Leigh.</span></span> <span data-ttu-id="61679-299">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="61679-299">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="61679-300">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="61679-300">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="61679-301">[上一頁](sorting-data-in-a-datalist-or-repeater-control-cs.md)
> [下一頁](sorting-data-in-a-datalist-or-repeater-control-vb.md)</span><span class="sxs-lookup"><span data-stu-id="61679-301">[Previous](sorting-data-in-a-datalist-or-repeater-control-cs.md)
[Next](sorting-data-in-a-datalist-or-repeater-control-vb.md)</span></span>
