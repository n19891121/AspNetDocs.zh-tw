---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-cs
title: DataList 或重複項控制項中的分頁報表資料C#（） |Microsoft Docs
author: rick-anderson
description: 雖然 DataList 和中繼器都不會提供自動分頁或排序支援，但本教學課程會示範如何將分頁支援新增至 DataList 或中繼器,。
ms.author: riande
ms.date: 11/13/2006
ms.assetid: e8e0809b-25c4-4c3b-8d12-9a17048148ae
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-cs
msc.type: authoredcontent
ms.openlocfilehash: 16686c7e41926698c0da9c60d3cf26e858f5daca
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74617867"
---
# <a name="paging-report-data-in-a-datalist-or-repeater-control-c"></a><span data-ttu-id="c372a-103">DataList 或重複項控制項中的分頁報表資料 (C#)</span><span class="sxs-lookup"><span data-stu-id="c372a-103">Paging Report Data in a DataList or Repeater Control (C#)</span></span>

<span data-ttu-id="c372a-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c372a-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c372a-105">[下載範例應用程式](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_CS.exe)或[下載 PDF](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial44cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c372a-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_CS.exe) or [Download PDF](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial44cs1.pdf)</span></span>

> <span data-ttu-id="c372a-106">雖然 DataList 和中繼器都不會提供自動分頁或排序支援，但本教學課程會示範如何將分頁支援加入至 DataList 或重複項，以提供更有彈性的分頁和資料顯示介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-106">While neither the DataList nor Repeater offer automatic paging or sorting support, this tutorial shows how to add paging support to the DataList or Repeater, which allows for much more flexible paging and data display interfaces.</span></span>

## <a name="introduction"></a><span data-ttu-id="c372a-107">簡介</span><span class="sxs-lookup"><span data-stu-id="c372a-107">Introduction</span></span>

<span data-ttu-id="c372a-108">分頁和排序是在線上應用程式中顯示資料時的兩個很常見的功能。</span><span class="sxs-lookup"><span data-stu-id="c372a-108">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="c372a-109">例如，搜尋線上書店的 ASP.NET 書籍時，可能會有數百份這類書籍，但列出搜尋結果的報表只會列出每頁十個相符專案。</span><span class="sxs-lookup"><span data-stu-id="c372a-109">For example, when searching for ASP.NET books at an online bookstore, there may be hundreds of such books, but the report listing the search results lists only ten matches per page.</span></span> <span data-ttu-id="c372a-110">此外，結果也可以依標題、價格、頁面計數、作者姓名等等排序。</span><span class="sxs-lookup"><span data-stu-id="c372a-110">Moreover, the results can be sorted by title, price, page count, author name, and so on.</span></span> <span data-ttu-id="c372a-111">如我們在[分頁和排序報表資料](../paging-and-sorting/paging-and-sorting-report-data-cs.md)教學課程中所討論，GridView、DetailsView 和 FormView 控制項全都提供內建的分頁支援，可在核取方塊的滴答處啟用。</span><span class="sxs-lookup"><span data-stu-id="c372a-111">As we discussed in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-cs.md) tutorial, the GridView, DetailsView, and FormView controls all provide built-in paging support that can be enabled at the tick of a checkbox.</span></span> <span data-ttu-id="c372a-112">GridView 也包含排序支援。</span><span class="sxs-lookup"><span data-stu-id="c372a-112">The GridView also includes sorting support.</span></span>

<span data-ttu-id="c372a-113">可惜的是，DataList 和中繼器都不會提供自動分頁或排序支援。</span><span class="sxs-lookup"><span data-stu-id="c372a-113">Unfortunately, neither the DataList nor Repeater offer automatic paging or sorting support.</span></span> <span data-ttu-id="c372a-114">在本教學課程中，我們將探討如何將分頁支援新增至 DataList 或中繼器。</span><span class="sxs-lookup"><span data-stu-id="c372a-114">In this tutorial we'll examine how to add paging support to the DataList or Repeater.</span></span> <span data-ttu-id="c372a-115">我們必須手動建立分頁介面、顯示適當的記錄頁面，並記住跨回傳流覽的頁面。</span><span class="sxs-lookup"><span data-stu-id="c372a-115">We must manually create the paging interface, display the appropriate page of records, and remember the page being visited across postbacks.</span></span> <span data-ttu-id="c372a-116">雖然這會花費比 GridView、DetailsView 或 FormView 更多的時間和程式碼，但 DataList 和中繼器可以提供更有彈性的分頁和資料顯示介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-116">While this does take more time and code than with the GridView, DetailsView, or FormView, the DataList and Repeater allow for much more flexible paging and data display interfaces.</span></span>

> [!NOTE]
> <span data-ttu-id="c372a-117">本教學課程僅著重于分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-117">This tutorial focuses exclusively on paging.</span></span> <span data-ttu-id="c372a-118">在下一個教學課程中，我們將重點放在新增排序功能。</span><span class="sxs-lookup"><span data-stu-id="c372a-118">In the next tutorial we'll turn our attention to adding sorting capabilities.</span></span>

## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a><span data-ttu-id="c372a-119">步驟1：新增分頁和排序教學課程網頁</span><span class="sxs-lookup"><span data-stu-id="c372a-119">Step 1: Adding the Paging and Sorting Tutorial Web Pages</span></span>

<span data-ttu-id="c372a-120">開始進行本教學課程之前，先花點時間新增本教學課程所需的 ASP.NET 網頁，以及下一頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-120">Before we start this tutorial, let s first take a moment to add the ASP.NET pages we'll need for this tutorial and the next one.</span></span> <span data-ttu-id="c372a-121">首先，在名為 `PagingSortingDataListRepeater`的專案中建立新的資料夾。</span><span class="sxs-lookup"><span data-stu-id="c372a-121">Start by creating a new folder in the project named `PagingSortingDataListRepeater`.</span></span> <span data-ttu-id="c372a-122">接下來，將下列五個 ASP.NET 網頁新增到此資料夾，並將它們全部設定為使用主版頁面 `Site.master`：</span><span class="sxs-lookup"><span data-stu-id="c372a-122">Next, add the following five ASP.NET pages to this folder, having all of them configured to use the master page `Site.master`:</span></span>

- `Default.aspx`
- `Paging.aspx`
- `Sorting.aspx`
- `SortingWithDefaultPaging.aspx`
- `SortingWithCustomPaging.aspx`

![建立 PagingSortingDataListRepeater 資料夾並新增教學課程 ASP.NET 網頁](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image1.png)

<span data-ttu-id="c372a-124">**圖 1**：建立 `PagingSortingDataListRepeater` 資料夾並新增教學課程 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="c372a-124">**Figure 1**: Create a `PagingSortingDataListRepeater` Folder and Add the Tutorial ASP.NET Pages</span></span>

<span data-ttu-id="c372a-125">接下來，開啟 [`Default.aspx`] 頁面，並將 [`SectionLevelTutorialListing.ascx` 使用者] 控制項從 [`UserControls`] 資料夾拖曳到設計介面上。</span><span class="sxs-lookup"><span data-stu-id="c372a-125">Next, open the `Default.aspx` page and drag the `SectionLevelTutorialListing.ascx` User Control from the `UserControls` folder onto the Design surface.</span></span> <span data-ttu-id="c372a-126">我們在[主版頁面和網站導覽](../introduction/master-pages-and-site-navigation-cs.md)教學課程中建立的這個使用者控制項，會列舉網站地圖，並在項目符號清單的目前區段中顯示這些教學課程。</span><span class="sxs-lookup"><span data-stu-id="c372a-126">This User Control, which we created in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, enumerates the site map and displays those tutorials in the current section in a bulleted list.</span></span>

<span data-ttu-id="c372a-127">[![將 SectionLevelTutorialListing 的 .ascx 使用者控制項新增至 default.aspx](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-127">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)</span></span>

<span data-ttu-id="c372a-128">**圖 2**：將 `SectionLevelTutorialListing.ascx` 使用者控制項加入 `Default.aspx` （[按一下以查看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-128">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image4.png))</span></span>

<span data-ttu-id="c372a-129">為了讓項目符號清單顯示我們將建立的分頁和排序教學課程，我們需要將它們新增至網站地圖。</span><span class="sxs-lookup"><span data-stu-id="c372a-129">In order to have the bulleted list display the paging and sorting tutorials we'll be creating, we need to add them to the site map.</span></span> <span data-ttu-id="c372a-130">開啟 `Web.sitemap` 檔案，並使用 DataList 網站地圖節點標記在編輯和刪除之後新增下列標記：</span><span class="sxs-lookup"><span data-stu-id="c372a-130">Open the `Web.sitemap` file and add the following markup after the Editing and Deleting with the DataList site map node markup:</span></span>

[!code-xml[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample1.xml)]

![更新網站地圖以包含新的 ASP.NET 網頁](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image5.png)

<span data-ttu-id="c372a-132">**圖 3**：更新網站地圖以包含新的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="c372a-132">**Figure 3**: Update the Site Map to Include the New ASP.NET Pages</span></span>

## <a name="a-review-of-paging"></a><span data-ttu-id="c372a-133">分頁審查</span><span class="sxs-lookup"><span data-stu-id="c372a-133">A Review of Paging</span></span>

<span data-ttu-id="c372a-134">在先前的教學課程中，我們看到了如何逐頁流覽 GridView、DetailsView 和 FormView 控制項中的資料。</span><span class="sxs-lookup"><span data-stu-id="c372a-134">In previous tutorials we saw how to page through the data in the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="c372a-135">這三個控制項提供簡單的分頁形式，稱為「*預設分頁*」，只要核取 [控制項] 智慧標籤中的 [啟用分頁] 選項，就可以實作為實頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-135">These three controls offer a simple form of paging called *default paging* that can be implemented by simply checking the Enable Paging option in the control s smart tag.</span></span> <span data-ttu-id="c372a-136">使用預設分頁時，每次在流覽第一頁時要求一頁數據，或當使用者流覽至不同的資料頁面時，GridView、DetailsView 或 FormView 控制項會重新要求 ObjectDataSource 中的*所有*資料。</span><span class="sxs-lookup"><span data-stu-id="c372a-136">With default paging, each time a page of data is requested either on the first page visit or when the user navigates to a different page of data the GridView, DetailsView, or FormView control re-requests *all* of the data from the ObjectDataSource.</span></span> <span data-ttu-id="c372a-137">接著，它會根據所要求的頁面索引和每頁顯示的記錄數目，來顯示特定記錄集。</span><span class="sxs-lookup"><span data-stu-id="c372a-137">It then snips out the particular set of records to display given the requested page index and the number of records to display per page.</span></span> <span data-ttu-id="c372a-138">我們已在[分頁和排序報表資料](../paging-and-sorting/paging-and-sorting-report-data-cs.md)教學課程中詳細討論預設分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-138">We discussed default paging in detail in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-cs.md) tutorial.</span></span>

<span data-ttu-id="c372a-139">由於預設的分頁會重新要求每個頁面的所有記錄，因此在分頁處理足夠大量的資料時並不實用。</span><span class="sxs-lookup"><span data-stu-id="c372a-139">Since default paging re-requests all records for each page, it is not practical when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="c372a-140">例如，假設頁面大小為10的50000筆記錄分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-140">For example, imagine paging through 50,000 records with a page size of 10.</span></span> <span data-ttu-id="c372a-141">每次使用者移到新的頁面時，都必須從資料庫中取出所有50000記錄，即使只顯示其中十個。</span><span class="sxs-lookup"><span data-stu-id="c372a-141">Each time the user moves to a new page, all 50,000 records must be retrieved from the database, even though only ten of them are displayed.</span></span>

<span data-ttu-id="c372a-142">*自訂分頁*藉由只抓取要在要求的頁面上顯示的精確記錄子集，來解決預設分頁的效能考慮。</span><span class="sxs-lookup"><span data-stu-id="c372a-142">*Custom paging* solves the performance concerns of default paging by grabbing only the precise subset of records to display on the requested page.</span></span> <span data-ttu-id="c372a-143">在執行自訂分頁時，我們必須撰寫 SQL 查詢，只會有效率地傳回正確的記錄集。</span><span class="sxs-lookup"><span data-stu-id="c372a-143">When implementing custom paging, we must write the SQL query that will efficiently return just the correct set of records.</span></span> <span data-ttu-id="c372a-144">我們已瞭解如何使用 SQL Server 2005 s new [`ROW_NUMBER()` 關鍵字](http://www.4guysfromrolla.com/webtech/010406-1.shtml)，透過大量資料的教學課程[有效率地進行分頁](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)，以建立這類查詢。</span><span class="sxs-lookup"><span data-stu-id="c372a-144">We saw how to create such a query using SQL Server 2005 s new [`ROW_NUMBER()` keyword](http://www.4guysfromrolla.com/webtech/010406-1.shtml) back in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial.</span></span>

<span data-ttu-id="c372a-145">若要在 DataList 或重複項控制項中執行預設分頁，我們可以使用[`PagedDataSource` 類別](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx)，做為要分頁其內容之 `ProductsDataTable` 的包裝函式。</span><span class="sxs-lookup"><span data-stu-id="c372a-145">To implement default paging in the DataList or Repeater controls, we can use the [`PagedDataSource` class](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx) as a wrapper around the `ProductsDataTable` whose contents are being paged.</span></span> <span data-ttu-id="c372a-146">`PagedDataSource` 類別具有 `DataSource` 屬性，可以指派給任何可列舉的物件，並[`PageSize`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx)和[`CurrentPageIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx)屬性，指出每頁顯示的記錄數目，以及目前的頁面索引。</span><span class="sxs-lookup"><span data-stu-id="c372a-146">The `PagedDataSource` class has a `DataSource` property that can be assigned to any enumerable object and [`PageSize`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx) and [`CurrentPageIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx) properties that indicate how many records to show per page and the current page index.</span></span> <span data-ttu-id="c372a-147">一旦設定這些屬性之後，就可以使用 `PagedDataSource` 做為任何資料 Web 控制項的資料來源。</span><span class="sxs-lookup"><span data-stu-id="c372a-147">Once these properties have been set, the `PagedDataSource` can be used as the data source of any data Web control.</span></span> <span data-ttu-id="c372a-148">列舉的 `PagedDataSource`只會根據 `PageSize` 和 `CurrentPageIndex` 屬性，傳回其內部 `DataSource` 的適當記錄子集。</span><span class="sxs-lookup"><span data-stu-id="c372a-148">The `PagedDataSource`, when enumerated, will only return the appropriate subset of records of its inner `DataSource` based on the `PageSize` and `CurrentPageIndex` properties.</span></span> <span data-ttu-id="c372a-149">[圖 4] 描述了 `PagedDataSource` 類別的功能。</span><span class="sxs-lookup"><span data-stu-id="c372a-149">Figure 4 depicts the functionality of the `PagedDataSource` class.</span></span>

![PagedDataSource 會使用可分頁的介面包裝可列舉物件](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image6.png)

<span data-ttu-id="c372a-151">**圖 4**： `PagedDataSource` 以可分頁的介面包裝可列舉物件</span><span class="sxs-lookup"><span data-stu-id="c372a-151">**Figure 4**: The `PagedDataSource` Wraps an Enumerable Object with a Pageable Interface</span></span>

<span data-ttu-id="c372a-152">`PagedDataSource` 物件可以直接從商務邏輯層建立和設定，並透過 ObjectDataSource 系結至 DataList 或重複項，也可以直接在 ASP.NET page s 程式碼後置類別中建立和設定。</span><span class="sxs-lookup"><span data-stu-id="c372a-152">The `PagedDataSource` object can be created and configured directly from the Business Logic Layer and bound to a DataList or Repeater through an ObjectDataSource, or can be created and configured directly in the ASP.NET page s code-behind class.</span></span> <span data-ttu-id="c372a-153">如果使用第二種方法，我們必須使用 ObjectDataSource 放棄，並改為以程式設計方式將分頁資料系結至 DataList 或中繼器。</span><span class="sxs-lookup"><span data-stu-id="c372a-153">If the latter approach is used, we must forgo using the ObjectDataSource and instead bind the paged data to the DataList or Repeater programmatically.</span></span>

<span data-ttu-id="c372a-154">`PagedDataSource` 物件也有支援自訂分頁的屬性。</span><span class="sxs-lookup"><span data-stu-id="c372a-154">The `PagedDataSource` object also has properties to support custom paging.</span></span> <span data-ttu-id="c372a-155">不過，我們可以略過使用自訂分頁的 `PagedDataSource`，因為我們在 `ProductsBLL` 類別中已經有適用于自訂分頁的 BLL 方法，會傳回要顯示的精確記錄。</span><span class="sxs-lookup"><span data-stu-id="c372a-155">However, we can bypass using a `PagedDataSource` for custom paging because we already have BLL methods in the `ProductsBLL` class designed for custom paging that return the precise records to display.</span></span>

<span data-ttu-id="c372a-156">在本教學課程中，我們將探討如何藉由將新的方法加入至 `ProductsBLL` 類別，以傳回適當設定的 `PagedDataSource` 物件，來在 DataList 中執行預設分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-156">In this tutorial we'll look at implementing default paging in a DataList by adding a new method to the `ProductsBLL` class that returns an appropriately configured `PagedDataSource` object.</span></span> <span data-ttu-id="c372a-157">在下一個教學課程中，我們將瞭解如何使用自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-157">In the next tutorial, we'll see how to use custom paging.</span></span>

## <a name="step-2-adding-a-default-paging-method-in-the-business-logic-layer"></a><span data-ttu-id="c372a-158">步驟2：在商務邏輯層中新增預設分頁方法</span><span class="sxs-lookup"><span data-stu-id="c372a-158">Step 2: Adding a Default Paging Method in the Business Logic Layer</span></span>

<span data-ttu-id="c372a-159">`ProductsBLL` 類別目前有一種方法可以傳回所有產品資訊 `GetProducts()`，另一種則是在起始索引 `GetProductsPaged(startRowIndex, maximumRows)`傳回產品的特定子集。</span><span class="sxs-lookup"><span data-stu-id="c372a-159">The `ProductsBLL` class currently has a method for returning all product information `GetProducts()` and one for returning a particular subset of products at a starting index `GetProductsPaged(startRowIndex, maximumRows)`.</span></span> <span data-ttu-id="c372a-160">使用預設分頁時，GridView、DetailsView 和 FormView 控制項全都會使用 `GetProducts()` 方法來抓取所有產品，但接著在內部使用 `PagedDataSource`，只顯示正確的記錄子集。</span><span class="sxs-lookup"><span data-stu-id="c372a-160">With default paging, the GridView, DetailsView, and FormView controls all use the `GetProducts()` method to retrieve all products, but then use a `PagedDataSource` internally to display only the correct subset of records.</span></span> <span data-ttu-id="c372a-161">若要使用 DataList 和中繼器控制項複寫這項功能，我們可以在會模擬此行為的 BLL 中建立新的方法。</span><span class="sxs-lookup"><span data-stu-id="c372a-161">To replicate this functionality with the DataList and Repeater controls, we can create a new method in the BLL that mimics this behavior.</span></span>

<span data-ttu-id="c372a-162">將方法新增至名為 `GetProductsAsPagedDataSource` 的 `ProductsBLL` 類別，以接受兩個整數輸入參數：</span><span class="sxs-lookup"><span data-stu-id="c372a-162">Add a method to the `ProductsBLL` class named `GetProductsAsPagedDataSource` that takes in two integer input parameters:</span></span>

- <span data-ttu-id="c372a-163">`pageIndex` 要顯示的頁面索引，以零為索引，以及</span><span class="sxs-lookup"><span data-stu-id="c372a-163">`pageIndex` the index of the page to display, indexed at zero, and</span></span>
- <span data-ttu-id="c372a-164">`pageSize` 每頁顯示的記錄數目。</span><span class="sxs-lookup"><span data-stu-id="c372a-164">`pageSize` the number of records to display per page.</span></span>

<span data-ttu-id="c372a-165">`GetProductsAsPagedDataSource` 一開始會從 `GetProducts()`中取出*所有*記錄。</span><span class="sxs-lookup"><span data-stu-id="c372a-165">`GetProductsAsPagedDataSource` starts by retrieving *all* of the records from `GetProducts()`.</span></span> <span data-ttu-id="c372a-166">接著，它會建立 `PagedDataSource` 物件，並將其 `CurrentPageIndex` 和 `PageSize` 屬性設定為傳入的 `pageIndex` 和 `pageSize` 參數的值。</span><span class="sxs-lookup"><span data-stu-id="c372a-166">It then creates a `PagedDataSource` object, setting its `CurrentPageIndex` and `PageSize` properties to the values of the passed-in `pageIndex` and `pageSize` parameters.</span></span> <span data-ttu-id="c372a-167">方法最後會傳回這個已設定的 `PagedDataSource`：</span><span class="sxs-lookup"><span data-stu-id="c372a-167">The method concludes by returning this configured `PagedDataSource`:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample2.cs)]

## <a name="step-3-displaying-product-information-in-a-datalist-using-default-paging"></a><span data-ttu-id="c372a-168">步驟3：使用預設分頁在 DataList 中顯示產品資訊</span><span class="sxs-lookup"><span data-stu-id="c372a-168">Step 3: Displaying Product Information in a DataList Using Default Paging</span></span>

<span data-ttu-id="c372a-169">透過將 `GetProductsAsPagedDataSource` 方法加入 `ProductsBLL` 類別中，我們現在可以建立可提供預設分頁的 DataList 或重複項。</span><span class="sxs-lookup"><span data-stu-id="c372a-169">With the `GetProductsAsPagedDataSource` method added to the `ProductsBLL` class, we can now create a DataList or Repeater that provides default paging.</span></span> <span data-ttu-id="c372a-170">一開始先開啟 [`PagingSortingDataListRepeater`] 資料夾中的 [`Paging.aspx`] 頁面，然後從 [工具箱] 將 [DataList] 拖曳至設計工具，將 [DataList s `ID`] 屬性設為 [`ProductsDefaultPaging`]。</span><span class="sxs-lookup"><span data-stu-id="c372a-170">Start by opening the `Paging.aspx` page in the `PagingSortingDataListRepeater` folder and drag a DataList from the Toolbox onto the Designer, setting the DataList s `ID` property to `ProductsDefaultPaging`.</span></span> <span data-ttu-id="c372a-171">從 DataList s 智慧標籤中，建立名為 `ProductsDefaultPagingDataSource` 的新 ObjectDataSource 並加以設定，以便使用 `GetProductsAsPagedDataSource` 方法來抓取資料。</span><span class="sxs-lookup"><span data-stu-id="c372a-171">From the DataList s smart tag, create a new ObjectDataSource named `ProductsDefaultPagingDataSource` and configure it so that it retrieves data using the `GetProductsAsPagedDataSource` method.</span></span>

<span data-ttu-id="c372a-172">[![建立 ObjectDataSource 並將其設定為使用 GetProductsAsPagedDataSource （）方法](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-172">[![Create an ObjectDataSource and Configure it to Use the GetProductsAsPagedDataSource () Method](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span></span>

<span data-ttu-id="c372a-173">**圖 5**：建立 ObjectDataSource 並將其設定為使用 `GetProductsAsPagedDataSource` `()` 方法（[按一下以查看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-173">**Figure 5**: Create an ObjectDataSource and Configure it to Use the `GetProductsAsPagedDataSource` `()` Method ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image9.png))</span></span>

<span data-ttu-id="c372a-174">將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]。</span><span class="sxs-lookup"><span data-stu-id="c372a-174">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="c372a-175">[![將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）]](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-175">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span></span>

<span data-ttu-id="c372a-176">**圖 6**：將 [更新]、[插入] 和 [刪除] 索引標籤中的下拉式清單設定為 [（無）] （[按一下以查看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-176">**Figure 6**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None) ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image12.png))</span></span>

<span data-ttu-id="c372a-177">由於 `GetProductsAsPagedDataSource` 方法預期會有兩個輸入參數，因此，此 wizard 會提示我們提供這些參數值的來源。</span><span class="sxs-lookup"><span data-stu-id="c372a-177">Since the `GetProductsAsPagedDataSource` method expects two input parameters, the wizard prompts us for the source of these parameter values.</span></span>

<span data-ttu-id="c372a-178">分頁索引和頁面大小的值必須在回傳之間記住。</span><span class="sxs-lookup"><span data-stu-id="c372a-178">The page index and page size values must be remembered across postbacks.</span></span> <span data-ttu-id="c372a-179">它們可以儲存為 view 狀態、保存至 querystring、儲存在會話變數中，或使用其他技術來記住。</span><span class="sxs-lookup"><span data-stu-id="c372a-179">They can be stored in view state, persisted to the querystring, stored in session variables, or remembered using some other technique.</span></span> <span data-ttu-id="c372a-180">在本教學課程中，我們將使用 querystring，其優點是允許將特定頁面的資料加入書簽。</span><span class="sxs-lookup"><span data-stu-id="c372a-180">For this tutorial we'll use the querystring, which has the advantage of allowing a particular page of data to be bookmarked.</span></span>

<span data-ttu-id="c372a-181">特別是，請分別針對 `pageIndex` 和 `pageSize` 參數使用 querystring 欄位 pageIndex 和 pageSize （請參閱 [圖 7]）。</span><span class="sxs-lookup"><span data-stu-id="c372a-181">In particular, use the querystring fields pageIndex and pageSize for the `pageIndex` and `pageSize` parameters, respectively (see Figure 7).</span></span> <span data-ttu-id="c372a-182">請花點時間設定這些參數的預設值，因為當使用者第一次造訪此頁面時，查詢字串值將不會出現。</span><span class="sxs-lookup"><span data-stu-id="c372a-182">Take a moment to set the default values for these parameters, as the querystring values won't be present when a user first visits this page.</span></span> <span data-ttu-id="c372a-183">針對 `pageIndex`，將預設值設定為0（這會顯示資料的第一頁），`pageSize` s 預設值設為4。</span><span class="sxs-lookup"><span data-stu-id="c372a-183">For `pageIndex`, set the default value to 0 (which will show the first page of data) and `pageSize` s default value to 4.</span></span>

<span data-ttu-id="c372a-184">[![使用 QueryString 做為 pageIndex 和 pageSize 參數的來源](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-184">[![Use the QueryString as the Source for the pageIndex and pageSize Parameters](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image13.png)</span></span>

<span data-ttu-id="c372a-185">**圖 7**：使用 QueryString 做為 `pageIndex` 和 `pageSize` 參數的來源（[按一下以查看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-185">**Figure 7**: Use the QueryString as the Source for the `pageIndex` and `pageSize` Parameters ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image15.png))</span></span>

<span data-ttu-id="c372a-186">設定 ObjectDataSource 之後，Visual Studio 會自動建立 DataList 的 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c372a-186">After configuring the ObjectDataSource, Visual Studio automatically creates an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="c372a-187">自訂 `ItemTemplate`，以便只顯示產品的名稱、類別和供應商。</span><span class="sxs-lookup"><span data-stu-id="c372a-187">Customize the `ItemTemplate` so that only the product s name, category, and supplier are shown.</span></span> <span data-ttu-id="c372a-188">同時將 DataList s `RepeatColumns` 屬性設為2，其 `Width` 為100%，而其 `ItemStyle` s `Width` 為50%。</span><span class="sxs-lookup"><span data-stu-id="c372a-188">Also set the DataList s `RepeatColumns` property to 2, its `Width` to 100%, and its `ItemStyle` s `Width` to 50%.</span></span> <span data-ttu-id="c372a-189">這些寬度設定會為這兩個數據行提供相等的間距。</span><span class="sxs-lookup"><span data-stu-id="c372a-189">These width settings will provide equal spacing for the two columns.</span></span>

<span data-ttu-id="c372a-190">進行這些變更之後，DataList 和 ObjectDataSource 的標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="c372a-190">After making these changes, the DataList and ObjectDataSource s markup should look similar to the following:</span></span>

[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample3.aspx)]

> [!NOTE]
> <span data-ttu-id="c372a-191">因為我們不會在本教學課程中執行任何更新或刪除功能，所以您可以停用 DataList s view 狀態來減少呈現的頁面大小。</span><span class="sxs-lookup"><span data-stu-id="c372a-191">Since we are not performing any update or delete functionality in this tutorial, you may disable the DataList s view state to reduce the rendered page size.</span></span>

<span data-ttu-id="c372a-192">一開始透過瀏覽器造訪此頁面時，不會提供 `pageIndex` 或 `pageSize` querystring 參數。</span><span class="sxs-lookup"><span data-stu-id="c372a-192">When initially visiting this page through a browser, neither the `pageIndex` nor `pageSize` querystring parameters are provided.</span></span> <span data-ttu-id="c372a-193">因此，會使用預設值0和4。</span><span class="sxs-lookup"><span data-stu-id="c372a-193">Hence, the default values of 0 and 4 are used.</span></span> <span data-ttu-id="c372a-194">如 [圖 8] 所示，這會產生一個 DataList，其中顯示前四個產品。</span><span class="sxs-lookup"><span data-stu-id="c372a-194">As Figure 8 shows, this results in a DataList that displays the first four products.</span></span>

<span data-ttu-id="c372a-195">[![列出前四個產品](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-195">[![The First Four Products are Listed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image16.png)</span></span>

<span data-ttu-id="c372a-196">**圖 8**：列出前四個產品（[按一下以觀看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-196">**Figure 8**: The First Four Products are Listed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image18.png))</span></span>

<span data-ttu-id="c372a-197">如果沒有分頁介面，使用者目前無法直接流覽至第二頁的資料。</span><span class="sxs-lookup"><span data-stu-id="c372a-197">Without a paging interface, there s currently no straightforward means for a user to navigate to the second page of data.</span></span> <span data-ttu-id="c372a-198">我們會在步驟4中建立分頁介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-198">We'll create a paging interface in step 4.</span></span> <span data-ttu-id="c372a-199">不過，現在只有在 querystring 中直接指定分頁準則，才可以完成分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-199">For now, though, paging can only be accomplished by directly specifying the paging criteria in the querystring.</span></span> <span data-ttu-id="c372a-200">例如，若要查看第二個頁面，請將瀏覽器的網址列中的 URL 從 `Paging.aspx` 變更為 `Paging.aspx?pageIndex=2`，然後按 Enter 鍵。</span><span class="sxs-lookup"><span data-stu-id="c372a-200">For example, to view the second page, change the URL in the browser s Address bar from `Paging.aspx` to `Paging.aspx?pageIndex=2` and hit Enter.</span></span> <span data-ttu-id="c372a-201">這會顯示第二頁的資料（請參閱 [圖 9]）。</span><span class="sxs-lookup"><span data-stu-id="c372a-201">This causes the second page of data to be displayed (see Figure 9).</span></span>

<span data-ttu-id="c372a-202">[顯示第二頁的資料 ![](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-202">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image19.png)</span></span>

<span data-ttu-id="c372a-203">**圖 9**：顯示資料的第二頁（[按一下以查看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-203">**Figure 9**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image21.png))</span></span>

## <a name="step-4-creating-the-paging-interface"></a><span data-ttu-id="c372a-204">步驟4：建立分頁介面</span><span class="sxs-lookup"><span data-stu-id="c372a-204">Step 4: Creating the Paging Interface</span></span>

<span data-ttu-id="c372a-205">有各種不同的分頁介面可以實作為。</span><span class="sxs-lookup"><span data-stu-id="c372a-205">There are a variety of different paging interfaces that can be implemented.</span></span> <span data-ttu-id="c372a-206">GridView、DetailsView 和 FormView 控制項提供四種不同的介面來進行選擇：</span><span class="sxs-lookup"><span data-stu-id="c372a-206">The GridView, DetailsView, and FormView controls provide four different interfaces to choose among:</span></span>

- <span data-ttu-id="c372a-207">**接下來，先前**的使用者可以一次將一個頁面移到下一個或上一個。</span><span class="sxs-lookup"><span data-stu-id="c372a-207">**Next, Previous** users can move one page at a time, to either the next or previous one.</span></span>
- <span data-ttu-id="c372a-208">**接下來，[上一步]** 、[下一步] 和 [上一個] 和 [上一個] 按鈕，此介面包含移至第一個或最後一個頁面的第一個和最後一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="c372a-208">**Next, Previous, First, Last** in addition to Next and Previous buttons, this interface includes First and Last buttons for moving to the very first or very last page.</span></span>
- <span data-ttu-id="c372a-209">**數值**列出分頁介面中的頁碼，可讓使用者快速跳到特定頁面。</span><span class="sxs-lookup"><span data-stu-id="c372a-209">**Numeric** lists the page numbers in the paging interface, allowing a user to quickly jump to a particular page.</span></span>
- <span data-ttu-id="c372a-210">**數位、第一個、最後一個加上**數值頁碼的數位，包含移至第一個或最後一個頁面的按鈕。</span><span class="sxs-lookup"><span data-stu-id="c372a-210">**Numeric, First, Last** in addition to the numeric page numbers, includes buttons for moving to the very first or very last page.</span></span>

<span data-ttu-id="c372a-211">對於 DataList 和中繼器，我們負責決定分頁介面並加以執行。</span><span class="sxs-lookup"><span data-stu-id="c372a-211">For the DataList and Repeater, we are responsible for deciding upon a paging interface and implementing it.</span></span> <span data-ttu-id="c372a-212">這牽涉到在頁面中建立所需的 Web 控制項，並在按一下特定的 [分頁介面] 按鈕時顯示要求的頁面。</span><span class="sxs-lookup"><span data-stu-id="c372a-212">This involves creating the needed Web controls in the page and displaying the requested page when a particular paging interface button is clicked.</span></span> <span data-ttu-id="c372a-213">此外，某些分頁介面控制項可能需要停用。</span><span class="sxs-lookup"><span data-stu-id="c372a-213">Additionally, certain paging interface controls may need to be disabled.</span></span> <span data-ttu-id="c372a-214">例如，使用 [下一步]、[上一個]、[上一個]、[最後一個] 介面來流覽資料的第一頁時，會停用第一個和前一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="c372a-214">For example, when viewing the first page of data using the Next, Previous, First, Last interface, both the First and Previous buttons would be disabled.</span></span>

<span data-ttu-id="c372a-215">在本教學課程中，讓我們使用下一個、上一個、第一個、最後一個介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-215">For this tutorial, let s use the Next, Previous, First, Last interface.</span></span> <span data-ttu-id="c372a-216">將四個按鈕 Web 控制項新增至頁面，並將其 `ID` 設定為 `FirstPage`、`PrevPage`、`NextPage`和 `LastPage`。</span><span class="sxs-lookup"><span data-stu-id="c372a-216">Add four Button Web controls to the page and set their `ID` s to `FirstPage`, `PrevPage`, `NextPage`, and `LastPage`.</span></span> <span data-ttu-id="c372a-217">將 `Text` 屬性設定為先 &lt;&lt;、&lt; 上一個、下一個 &gt;和最後一個 &gt;&gt;。</span><span class="sxs-lookup"><span data-stu-id="c372a-217">Set the `Text` properties to &lt;&lt; First, &lt; Prev, Next &gt;, and Last &gt;&gt; .</span></span>

[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample4.aspx)]

<span data-ttu-id="c372a-218">接下來，為每個按鈕建立一個 `Click` 事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="c372a-218">Next, create a `Click` event handler for each of these Buttons.</span></span> <span data-ttu-id="c372a-219">我們稍後會新增必要的程式碼，以顯示要求的頁面。</span><span class="sxs-lookup"><span data-stu-id="c372a-219">In a moment we'll add the code necessary to display the requested page.</span></span>

## <a name="remembering-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="c372a-220">記住要進行分頁的記錄總數</span><span class="sxs-lookup"><span data-stu-id="c372a-220">Remembering the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="c372a-221">不論選取的分頁介面為何，我們都需要計算並記憶要進行分頁的記錄總數。</span><span class="sxs-lookup"><span data-stu-id="c372a-221">Regardless of the paging interface selected, we need to compute and remember the total number of records being paged through.</span></span> <span data-ttu-id="c372a-222">總數據列計數（與頁面大小結合）會決定要進行分頁的總數據頁面總計，這會決定要新增或啟用的分頁介面控制項。</span><span class="sxs-lookup"><span data-stu-id="c372a-222">The total row count (in conjunction with the page size) determines how many total pages of data are being paged through, which determines what paging interface controls are added or are enabled.</span></span> <span data-ttu-id="c372a-223">在下一個、上一個、第一個、最後一個所建立的介面中，頁面計數的使用方式有兩種：</span><span class="sxs-lookup"><span data-stu-id="c372a-223">In the Next, Previous, First, Last interface that we are building, the page count is used in two ways:</span></span>

- <span data-ttu-id="c372a-224">若要判斷我們是否正在觀看最後一頁，在此情況下，[下一步] 和 [最後一個] 按鈕會停用。</span><span class="sxs-lookup"><span data-stu-id="c372a-224">To determine whether we are viewing the last page, in which case the Next and Last buttons are disabled.</span></span>
- <span data-ttu-id="c372a-225">如果使用者按一下 [上一步] 按鈕，我們必須將其 whisk 到最後一頁，其索引的長度小於頁面計數。</span><span class="sxs-lookup"><span data-stu-id="c372a-225">If the user clicks the Last button we need to whisk them to the last page, whose index is one less than the page count.</span></span>

<span data-ttu-id="c372a-226">頁面計數是以總數據列計數的上限除以頁面大小來計算。</span><span class="sxs-lookup"><span data-stu-id="c372a-226">The page count is calculated as the ceiling of the total row count divided by the page size.</span></span> <span data-ttu-id="c372a-227">例如，如果我們使用每頁四筆記錄的79筆記錄進行分頁，則頁面計數為20（79/4 的上限）。</span><span class="sxs-lookup"><span data-stu-id="c372a-227">For example, if we are paging through 79 records with four records per page, then the page count is 20 (the ceiling of 79 / 4).</span></span> <span data-ttu-id="c372a-228">如果我們使用數值分頁介面，此資訊會告知我們要顯示多少數值頁面按鈕;如果我們的分頁介面包含 [下一步] 或 [最後一個] 按鈕，則會使用頁面計數來決定何時要停用下一個或最後一個按鈕。</span><span class="sxs-lookup"><span data-stu-id="c372a-228">If we are using the Numeric paging interface, this information informs us as to how many numeric page buttons to display; if our paging interface includes Next or Last buttons, the page count is used to determine when to disable the Next or Last buttons.</span></span>

<span data-ttu-id="c372a-229">如果分頁介面包含 [最後一個] 按鈕，則必須在回傳期間記住分頁的記錄總數，以便在按一下最後一個按鈕時，可以判斷最後一頁的索引。</span><span class="sxs-lookup"><span data-stu-id="c372a-229">If the paging interface includes a Last button, it is imperative that the total number of records being paged through be remembered across postbacks so that when the Last button is clicked we can determine the last page index.</span></span> <span data-ttu-id="c372a-230">為了方便這項工作，請在 ASP.NET 網頁的程式碼後置類別中建立 `TotalRowCount` 屬性，以保存其值來查看狀態：</span><span class="sxs-lookup"><span data-stu-id="c372a-230">To facilitate this, create a `TotalRowCount` property in the ASP.NET page s code-behind class that persists its value to view state:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample5.cs)]

<span data-ttu-id="c372a-231">除了 `TotalRowCount`以外，請花幾分鐘的時間建立唯讀頁面層級的屬性，以便輕鬆存取頁面索引、頁面大小和頁面計數：</span><span class="sxs-lookup"><span data-stu-id="c372a-231">In addition to `TotalRowCount`, take a minute to create read-only page-level properties for easily accessing the page index, page size, and page count:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample6.cs)]

## <a name="determining-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="c372a-232">判斷要進行分頁的記錄總數</span><span class="sxs-lookup"><span data-stu-id="c372a-232">Determining the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="c372a-233">從 ObjectDataSource s `Select()` 方法傳回的 `PagedDataSource` 物件在其*所有*產品記錄中都具有，即使在 DataList 中只會顯示部分的專案。</span><span class="sxs-lookup"><span data-stu-id="c372a-233">The `PagedDataSource` object returned from the ObjectDataSource s `Select()` method has within it *all* of the product records, even though only a subset of them are displayed in the DataList.</span></span> <span data-ttu-id="c372a-234">`PagedDataSource` s [`Count` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx)只會傳回將顯示在 DataList 中的專案數;[`DataSourceCount` 屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx)會傳回 `PagedDataSource`內的總專案數。</span><span class="sxs-lookup"><span data-stu-id="c372a-234">The `PagedDataSource` s [`Count` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx) returns only the number of items that will be displayed in the DataList; the [`DataSourceCount` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx) returns the total number of items within the `PagedDataSource`.</span></span> <span data-ttu-id="c372a-235">因此，我們需要將 ASP.NET page s `TotalRowCount` 屬性指派 `PagedDataSource` s `DataSourceCount` 屬性的值。</span><span class="sxs-lookup"><span data-stu-id="c372a-235">Therefore, we need to assign the ASP.NET page s `TotalRowCount` property the value of the `PagedDataSource` s `DataSourceCount` property.</span></span>

<span data-ttu-id="c372a-236">若要完成此動作，請建立 ObjectDataSource s `Selected` 事件的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="c372a-236">To accomplish this, create an event handler for the ObjectDataSource s `Selected` event.</span></span> <span data-ttu-id="c372a-237">在 `Selected` 事件處理常式中，我們可以存取 ObjectDataSource s `Select()` 方法的傳回值，在此案例中為 `PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="c372a-237">In the `Selected` event handler we have access to the return value of the ObjectDataSource s `Select()` method in this case, the `PagedDataSource`.</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample7.cs)]

## <a name="displaying-the-requested-page-of-data"></a><span data-ttu-id="c372a-238">顯示要求的資料頁面</span><span class="sxs-lookup"><span data-stu-id="c372a-238">Displaying the Requested Page of Data</span></span>

<span data-ttu-id="c372a-239">當使用者按一下頁面介面中的其中一個按鈕時，我們必須顯示所要求的資料頁面。</span><span class="sxs-lookup"><span data-stu-id="c372a-239">When the user clicks one of the buttons in the paging interface, we need to display the requested page of data.</span></span> <span data-ttu-id="c372a-240">由於分頁參數是透過 querystring 指定的，若要顯示所要求的資料頁面，請使用 `Response.Redirect(url)` 讓使用者的瀏覽器重新要求具有適當分頁參數的 `Paging.aspx` 頁面。</span><span class="sxs-lookup"><span data-stu-id="c372a-240">Since the paging parameters are specified via the querystring, to show the requested page of data use `Response.Redirect(url)` to have the user s browser re-request the `Paging.aspx` page with the appropriate paging parameters.</span></span> <span data-ttu-id="c372a-241">例如，若要顯示第二頁的資料，我們會將使用者重新導向至 `Paging.aspx?pageIndex=1`。</span><span class="sxs-lookup"><span data-stu-id="c372a-241">For example, to display the second page of data, we would redirect the user to `Paging.aspx?pageIndex=1`.</span></span>

<span data-ttu-id="c372a-242">為了加速此工作，請建立 `RedirectUser(sendUserToPageIndex)` 方法，將使用者重新導向至 `Paging.aspx?pageIndex=sendUserToPageIndex`。</span><span class="sxs-lookup"><span data-stu-id="c372a-242">To facilitate this, create a `RedirectUser(sendUserToPageIndex)` method that redirects the user to `Paging.aspx?pageIndex=sendUserToPageIndex`.</span></span> <span data-ttu-id="c372a-243">然後，從 `Click` 事件處理常式的四個按鈕中呼叫此方法。</span><span class="sxs-lookup"><span data-stu-id="c372a-243">Then, call this method from the four Button `Click` event handlers.</span></span> <span data-ttu-id="c372a-244">在 `FirstPage` `Click` 事件處理常式中，呼叫 `RedirectUser(0)`，將其傳送至第一頁;在 `PrevPage` `Click` 事件處理常式中，使用 `PageIndex - 1` 作為頁面索引;以此類推。</span><span class="sxs-lookup"><span data-stu-id="c372a-244">In the `FirstPage` `Click` event handler, call `RedirectUser(0)`, to send them to the first page; in the `PrevPage` `Click` event handler, use `PageIndex - 1` as the page index; and so on.</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample8.cs)]

<span data-ttu-id="c372a-245">當 `Click` 事件處理常式完成時，可以按一下按鈕，將 DataList s 記錄分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-245">With the `Click` event handlers complete, the DataList s records can be paged through by clicking the buttons.</span></span> <span data-ttu-id="c372a-246">請花點時間試用！</span><span class="sxs-lookup"><span data-stu-id="c372a-246">Take a moment to try it out!</span></span>

## <a name="disabling-paging-interface-controls"></a><span data-ttu-id="c372a-247">停用分頁介面控制項</span><span class="sxs-lookup"><span data-stu-id="c372a-247">Disabling Paging Interface Controls</span></span>

<span data-ttu-id="c372a-248">目前，不論流覽的頁面為何，都會啟用全部四個按鈕。</span><span class="sxs-lookup"><span data-stu-id="c372a-248">Currently, all four buttons are enabled regardless of the page being viewed.</span></span> <span data-ttu-id="c372a-249">不過，我們想要在顯示第一頁數據時停用第一個和上一個按鈕，而在顯示最後一頁時，則是 [下一步] 和 [最後一個] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="c372a-249">However, we want to disable the First and Previous buttons when showing the first page of data, and the Next and Last buttons when showing the last page.</span></span> <span data-ttu-id="c372a-250">ObjectDataSource s `Select()` 方法所傳回的 `PagedDataSource` 物件具有[`IsFirstPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx)和[`IsLastPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx)屬性，可供我們檢查以判斷我們是否正在查看資料的第一個或最後一頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-250">The `PagedDataSource` object returned by the ObjectDataSource s `Select()` method has properties [`IsFirstPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx) and [`IsLastPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx) that we can examine to determine if we are viewing the first or last page of data.</span></span>

<span data-ttu-id="c372a-251">將下列內容新增至 ObjectDataSource s `Selected` 事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="c372a-251">Add the following to the ObjectDataSource s `Selected` event handler:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample9.cs)]

<span data-ttu-id="c372a-252">使用這項新增功能時，第一個和前一個按鈕會在流覽第一頁時停用，而 [下一步] 和 [最後一個] 按鈕則會在觀看最後一頁時停用。</span><span class="sxs-lookup"><span data-stu-id="c372a-252">With this addition, the First and Previous buttons will be disabled when viewing the first page, while the Next and Last buttons will be disabled when viewing the last page.</span></span>

<span data-ttu-id="c372a-253">讓我們透過通知使用者目前正在查看的頁面以及有多少總頁數，來完成分頁介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-253">Let s complete the paging interface by informing the user what page they re currently viewing and how many total pages exist.</span></span> <span data-ttu-id="c372a-254">將 [標籤] Web 控制項新增至頁面，並將其 [`ID`] 屬性設定為 [`CurrentPageNumber`]。</span><span class="sxs-lookup"><span data-stu-id="c372a-254">Add a Label Web control to the page and set its `ID` property to `CurrentPageNumber`.</span></span> <span data-ttu-id="c372a-255">在 ObjectDataSource s 選取的事件處理常式中設定其 `Text` 屬性，使其包含目前正在查看的頁面（`PageIndex + 1`）和總頁數（`PageCount`）。</span><span class="sxs-lookup"><span data-stu-id="c372a-255">Set its `Text` property in the ObjectDataSource s Selected event handler such that it includes the current page being viewed (`PageIndex + 1`) and the total number of pages (`PageCount`).</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample10.cs)]

<span data-ttu-id="c372a-256">[圖 10] 顯示第一次造訪時 `Paging.aspx`。</span><span class="sxs-lookup"><span data-stu-id="c372a-256">Figure 10 shows `Paging.aspx` when first visited.</span></span> <span data-ttu-id="c372a-257">因為 querystring 是空的，所以 DataList 預設會顯示前四個產品;[第一個] 和 [上一個] 按鈕已停用。</span><span class="sxs-lookup"><span data-stu-id="c372a-257">Since the querystring is empty, the DataList defaults to showing the first four products; the First and Previous buttons are disabled.</span></span> <span data-ttu-id="c372a-258">按 [下一步] 會顯示接下來四筆記錄（見 [圖 11]）;[第一個] 和 [上一個] 按鈕現在已啟用。</span><span class="sxs-lookup"><span data-stu-id="c372a-258">Clicking Next displays the next four records (see Figure 11); the First and Previous buttons are now enabled.</span></span>

<span data-ttu-id="c372a-259">[顯示第一頁的資料 ![](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-259">[![The First Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image22.png)</span></span>

<span data-ttu-id="c372a-260">**圖 10**：顯示資料的第一頁（[按一下以查看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-260">**Figure 10**: The First Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image24.png))</span></span>

<span data-ttu-id="c372a-261">[顯示第二頁的資料 ![](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c372a-261">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image25.png)</span></span>

<span data-ttu-id="c372a-262">**圖 11**：顯示資料的第二頁（[按一下以查看完整大小的影像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="c372a-262">**Figure 11**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image27.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c372a-263">藉由允許使用者指定每頁要查看的頁面數目，可以進一步增強分頁介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-263">The paging interface can be further enhanced by allowing the user to specify how many pages to view per page.</span></span> <span data-ttu-id="c372a-264">例如，您可以新增 DropDownList，列出頁面大小選項，例如5、10、25、50和 All。</span><span class="sxs-lookup"><span data-stu-id="c372a-264">For example, a DropDownList could be added listing page size options like 5, 10, 25, 50, and All.</span></span> <span data-ttu-id="c372a-265">選取頁面大小時，使用者必須重新導向回到 `Paging.aspx?pageIndex=0&pageSize=selectedPageSize`。</span><span class="sxs-lookup"><span data-stu-id="c372a-265">Upon selecting a page size, the user would need to be redirected back to `Paging.aspx?pageIndex=0&pageSize=selectedPageSize`.</span></span> <span data-ttu-id="c372a-266">我將此增強功能作為讀者的練習。</span><span class="sxs-lookup"><span data-stu-id="c372a-266">I leave implementing this enhancement as an exercise for the reader.</span></span>

## <a name="using-custom-paging"></a><span data-ttu-id="c372a-267">使用自訂分頁</span><span class="sxs-lookup"><span data-stu-id="c372a-267">Using Custom Paging</span></span>

<span data-ttu-id="c372a-268">DataList 頁面會使用沒有效率的預設分頁技術來流覽其資料。</span><span class="sxs-lookup"><span data-stu-id="c372a-268">The DataList pages through its data using the inefficient default paging technique.</span></span> <span data-ttu-id="c372a-269">當逐頁查看大量資料時，請務必使用自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-269">When paging through sufficiently large amounts of data, it is imperative that custom paging be used.</span></span> <span data-ttu-id="c372a-270">雖然執行詳細資料稍有不同，但是在 DataList 中執行自訂分頁的概念與預設分頁相同。</span><span class="sxs-lookup"><span data-stu-id="c372a-270">Although the implementation details differ slightly, the concepts behind implementing custom paging in a DataList are the same as with default paging.</span></span> <span data-ttu-id="c372a-271">透過自訂分頁，使用 `ProductBLL` 類別的 `GetProductsPaged` 方法（而不是 `GetProductsAsPagedDataSource`）。</span><span class="sxs-lookup"><span data-stu-id="c372a-271">With custom paging, use the `ProductBLL` class s `GetProductsPaged` method (instead of `GetProductsAsPagedDataSource`).</span></span> <span data-ttu-id="c372a-272">如[有效率地逐頁流覽大量資料](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)教學課程中所述，`GetProductsPaged` 必須傳遞開始資料列索引和要傳回的資料列數目上限。</span><span class="sxs-lookup"><span data-stu-id="c372a-272">As discussed in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial, `GetProductsPaged` must be passed the start row index and maximum number of rows to return.</span></span> <span data-ttu-id="c372a-273">這些參數可以透過 querystring 進行維護，就像 `pageIndex` 和預設分頁中使用的 `pageSize` 參數一樣。</span><span class="sxs-lookup"><span data-stu-id="c372a-273">These parameters can be maintained through the querystring just like the `pageIndex` and `pageSize` parameters used in default paging.</span></span>

<span data-ttu-id="c372a-274">由於自訂分頁沒有 `PagedDataSource`，因此您必須使用替代技術來判斷要進行分頁的記錄總數，以及是否要顯示資料的第一個或最後一頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-274">Since there s no `PagedDataSource` with custom paging, alternative techniques must be used to determine the total number of records being paged through and whether we re displaying the first or last page of data.</span></span> <span data-ttu-id="c372a-275">`ProductsBLL` 類別中的 `TotalNumberOfProducts()` 方法會傳回要進行分頁的產品總數。</span><span class="sxs-lookup"><span data-stu-id="c372a-275">The `TotalNumberOfProducts()` method in the `ProductsBLL` class returns the total number of products being paged through.</span></span> <span data-ttu-id="c372a-276">若要判斷資料的第一頁是否正在查看，請檢查開始列索引是否為零，然後才會查看第一頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-276">To determine if the first page of data is being viewed, examine the start row index if it is zero, then the first page is being viewed.</span></span> <span data-ttu-id="c372a-277">如果開始資料列索引加上要傳回的最大資料列數目大於或等於要進行分頁的記錄總數，則會查看最後一頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-277">The last page is being viewed if the start row index plus the maximum rows to return is greater than or equal to the total number of records being paged through.</span></span>

<span data-ttu-id="c372a-278">在下一個教學課程中，我們將更詳細地探討如何執行自訂分頁。</span><span class="sxs-lookup"><span data-stu-id="c372a-278">We'll explore implementing custom paging in greater detail in the next tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="c372a-279">總結</span><span class="sxs-lookup"><span data-stu-id="c372a-279">Summary</span></span>

<span data-ttu-id="c372a-280">雖然 DataList 和中繼器都不會提供 GridView、DetailsView 和 FormView 控制項中的現成分頁支援，但這類功能可以最輕鬆地新增。</span><span class="sxs-lookup"><span data-stu-id="c372a-280">While neither the DataList nor Repeater offers the out of the box paging support found in the GridView, DetailsView, and FormView controls, such functionality can be added with minimal effort.</span></span> <span data-ttu-id="c372a-281">若要執行預設分頁，最簡單的方式是將整個產品集包裝在 `PagedDataSource` 中，然後將 `PagedDataSource` 系結至 DataList 或中繼器。</span><span class="sxs-lookup"><span data-stu-id="c372a-281">The easiest way to implement default paging is to wrap the entire set of products within a `PagedDataSource` and then bind the `PagedDataSource` to the DataList or Repeater.</span></span> <span data-ttu-id="c372a-282">在本教學課程中，我們已將 `GetProductsAsPagedDataSource` 方法新增至 `ProductsBLL` 類別，以傳回 `PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="c372a-282">In this tutorial we added the `GetProductsAsPagedDataSource` method to the `ProductsBLL` class to return the `PagedDataSource`.</span></span> <span data-ttu-id="c372a-283">`ProductsBLL` 類別已經包含自訂分頁 `GetProductsPaged` 和 `TotalNumberOfProducts`所需的方法。</span><span class="sxs-lookup"><span data-stu-id="c372a-283">The `ProductsBLL` class already contains the methods needed for custom paging `GetProductsPaged` and `TotalNumberOfProducts`.</span></span>

<span data-ttu-id="c372a-284">除了針對自訂分頁或 `PagedDataSource` 中的所有記錄，抓取要顯示的一組精確記錄，以進行預設分頁，我們也需要手動加入分頁介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-284">Along with retrieving either the precise set of records to display for custom paging or all records in a `PagedDataSource` for default paging, we also need to manually add the paging interface.</span></span> <span data-ttu-id="c372a-285">在本教學課程中，我們建立了下一個、上一個、第一個、最後一個具有四個按鈕 Web 控制項的介面。</span><span class="sxs-lookup"><span data-stu-id="c372a-285">For this tutorial we created a Next, Previous, First, Last interface with four Button Web controls.</span></span> <span data-ttu-id="c372a-286">此外，也會顯示目前頁碼和總頁數的標籤控制項。</span><span class="sxs-lookup"><span data-stu-id="c372a-286">Also, a Label control displaying the current page number and total number of pages was added.</span></span>

<span data-ttu-id="c372a-287">在下一個教學課程中，我們將瞭解如何將排序支援新增至 DataList 和中繼器。</span><span class="sxs-lookup"><span data-stu-id="c372a-287">In the next tutorial we'll see how to add sorting support to the DataList and Repeater.</span></span> <span data-ttu-id="c372a-288">我們也會瞭解如何建立可同時進行分頁和排序的 DataList （使用預設和自訂分頁的範例）。</span><span class="sxs-lookup"><span data-stu-id="c372a-288">We'll also see how to create a DataList that can be both paged and sorted (with examples using default and custom paging).</span></span>

<span data-ttu-id="c372a-289">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="c372a-289">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c372a-290">關於作者</span><span class="sxs-lookup"><span data-stu-id="c372a-290">About the Author</span></span>

<span data-ttu-id="c372a-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，自1998起，有七個 ASP/ASP. NET 書籍和創辦人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)。</span><span class="sxs-lookup"><span data-stu-id="c372a-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c372a-292">Scott 以獨立的顧問、訓練員和作者的身分運作。</span><span class="sxs-lookup"><span data-stu-id="c372a-292">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c372a-293">他的最新著作是[*在24小時內讓自己的 ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="c372a-293">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c372a-294">他可以在mitchell@4GuysFromRolla.com觸達[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c372a-294">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c372a-295">或者透過他的 blog，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="c372a-295">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c372a-296">特別感謝</span><span class="sxs-lookup"><span data-stu-id="c372a-296">Special Thanks To</span></span>

<span data-ttu-id="c372a-297">本教學課程系列已由許多有用的審核者所審查。</span><span class="sxs-lookup"><span data-stu-id="c372a-297">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c372a-298">本教學課程的領導審查者為 Liz Shulok、Ken Pespisa 和 Bernadette Leigh。</span><span class="sxs-lookup"><span data-stu-id="c372a-298">Lead reviewers for this tutorial were Liz Shulok, Ken Pespisa, and Bernadette Leigh.</span></span> <span data-ttu-id="c372a-299">有興趣複習我即將發行的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="c372a-299">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c372a-300">若是如此，請在mitchell@4GuysFromRolla.com的那一行下拉式[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c372a-300">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="c372a-301">下一步</span><span class="sxs-lookup"><span data-stu-id="c372a-301">Next</span></span>](sorting-data-in-a-datalist-or-repeater-control-cs.md)
