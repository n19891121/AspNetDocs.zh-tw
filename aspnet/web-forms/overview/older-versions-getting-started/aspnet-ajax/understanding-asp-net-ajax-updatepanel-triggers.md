---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
title: 了解 ASP.NET AJAX UpdatePanel 觸發程序 |Microsoft Docs
author: scottcate
description: 在 Visual Studio 中標記編輯器中工作時，您可能會注意到 （舉凡 IntelliSense) 有兩個的 UpdatePanel 控制項的子項目。 當其中一項...
ms.author: riande
ms.date: 03/12/2008
ms.assetid: faab8503-2984-48a9-8a40-7728461abc50
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
msc.type: authoredcontent
ms.openlocfilehash: c61d10c28ba3975cb6fbadc6eda1f7a3c9406dfc
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/06/2019
ms.locfileid: "65114604"
---
# <a name="understanding-aspnet-ajax-updatepanel-triggers"></a><span data-ttu-id="37841-104">了解 ASP.NET AJAX UpdatePanel 觸發程序</span><span class="sxs-lookup"><span data-stu-id="37841-104">Understanding ASP.NET AJAX UpdatePanel Triggers</span></span>

<span data-ttu-id="37841-105">藉由[Scott Cate](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="37841-105">by [Scott Cate](https://github.com/scottcate)</span></span>

[<span data-ttu-id="37841-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="37841-106">Download PDF</span></span>](http://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial02_Triggers_cs.pdf)

> <span data-ttu-id="37841-107">在 Visual Studio 中標記編輯器中工作時，您可能會注意到 （舉凡 IntelliSense) 有兩個的 UpdatePanel 控制項的子項目。</span><span class="sxs-lookup"><span data-stu-id="37841-107">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an UpdatePanel control.</span></span> <span data-ttu-id="37841-108">其中之一就是觸發程序項目，其指定的頁面 （或使用者控制項，如果您有使用的話） 上的控制項就會觸發 UpdatePanel 控制項的項目所在的部分轉譯。</span><span class="sxs-lookup"><span data-stu-id="37841-108">One of which is the Triggers element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the element resides.</span></span>

## <a name="introduction"></a><span data-ttu-id="37841-109">簡介</span><span class="sxs-lookup"><span data-stu-id="37841-109">Introduction</span></span>

<span data-ttu-id="37841-110">Microsoft ASP.NET 技術會以物件導向和事件導向的程式設計模型，以及結合編譯程式碼的優點。</span><span class="sxs-lookup"><span data-stu-id="37841-110">Microsoft's ASP.NET technology brings an object-oriented and event-driven programming model and unites it with the benefits of compiled code.</span></span> <span data-ttu-id="37841-111">不過，其伺服器端處理模型有幾個缺點固有的技術，而其中有許多可解決 Microsoft ASP.NET 3.5 AJAX Extensions 中包含的新功能。</span><span class="sxs-lookup"><span data-stu-id="37841-111">However, its server-side processing model has several drawbacks inherent in the technology, many of which can be addressed by the new features included in the Microsoft ASP.NET 3.5 AJAX Extensions.</span></span> <span data-ttu-id="37841-112">這些擴充功能可讓許多豐富的用戶端的新功能，包括部分呈現的頁面，而不需要重新整理整個頁面，透過用戶端指令碼 （包括 ASP.NET 程式碼剖析 API），以及廣泛的用戶端 API 存取 Web 服務的能力設計用來鏡像處理許多 ASP.NET 伺服器端控制項集合中的控制項配置。</span><span class="sxs-lookup"><span data-stu-id="37841-112">These extensions enable many new rich client features, including partial rendering of pages without requiring a full page refresh, the ability to access Web Services via client script (including the ASP.NET profiling API), and an extensive client-side API designed to mirror many of the control schemes seen in the ASP.NET server-side control set.</span></span>

<span data-ttu-id="37841-113">本白皮書會檢查 XML 觸發程序功能的 ASP.NET AJAX`UpdatePanel`元件。</span><span class="sxs-lookup"><span data-stu-id="37841-113">This whitepaper examines the XML Triggers functionality of the ASP.NET AJAX `UpdatePanel` component.</span></span> <span data-ttu-id="37841-114">XML 觸發程序提供更精確地控制造成特定 UpdatePanel 控制項的部分呈現的元件。</span><span class="sxs-lookup"><span data-stu-id="37841-114">XML Triggers give granular control over the components that can cause partial rendering for specific UpdatePanel controls.</span></span>

<span data-ttu-id="37841-115">本白皮書根據 Visual Studio 2008 與.NET Framework 3.5 Beta 2 版本而定。</span><span class="sxs-lookup"><span data-stu-id="37841-115">This whitepaper is based on the Beta 2 release of the .NET Framework 3.5 and Visual Studio 2008.</span></span> <span data-ttu-id="37841-116">ASP.NET AJAX Extensions，先前的附加元件組件作為目標的 ASP.NET 2.0 中，現在已整合至.NET Framework 基底類別庫。</span><span class="sxs-lookup"><span data-stu-id="37841-116">The ASP.NET AJAX Extensions, previously an add-on assembly targeted at ASP.NET 2.0, are now integrated into the .NET Framework Base Class Library.</span></span> <span data-ttu-id="37841-117">本白皮書也會假設您將使用 Visual Studio 2008，不 Visual Web Developer Express，並將提供逐步解說根據 Visual Studio 的使用者介面 （雖然程式碼清單將會完全相容，不論開發環境）。</span><span class="sxs-lookup"><span data-stu-id="37841-117">This whitepaper also assumes that you will be working with Visual Studio 2008, not Visual Web Developer Express, and will provide walkthroughs according to the user interface of Visual Studio (although code listings will be entirely compatible regardless of development environment).</span></span>

## <a name="triggers"></a><span data-ttu-id="37841-118">*觸發程序*</span><span class="sxs-lookup"><span data-stu-id="37841-118">*Triggers*</span></span>

<span data-ttu-id="37841-119">指定的 UpdatePanel 中，根據預設，觸發程序會自動包含任何子控制項，叫用 （舉例來說） 包括有的文字方塊控制項的回傳他們`AutoPostBack`屬性設定為 **，則為 true**。</span><span class="sxs-lookup"><span data-stu-id="37841-119">Triggers for a given UpdatePanel, by default, automatically include any child controls that invoke a postback, including (for example) TextBox controls that have their `AutoPostBack` property set to **true**.</span></span> <span data-ttu-id="37841-120">不過，觸發程序也可以包含以宣告方式使用標記，這是內`<triggers>`UpdatePanel 控制項宣告一節。</span><span class="sxs-lookup"><span data-stu-id="37841-120">However, triggers can also be included declaratively using markup; this is done within the `<triggers>` section of the UpdatePanel control declaration.</span></span> <span data-ttu-id="37841-121">雖然可以透過存取觸發程序`Triggers`集合屬性，建議您註冊在執行階段的任何部分轉譯觸發程序，（比方說，如果控制項不是可在設計階段中） 使用`RegisterAsyncPostBackControl(Control)`方法ScriptManager 物件為您的頁面內`Page_Load`事件。</span><span class="sxs-lookup"><span data-stu-id="37841-121">Although triggers can be accessed via the `Triggers` collection property, it is recommended that you register any partial render triggers at run-time (for instance, if a control is not available at design time) by using the `RegisterAsyncPostBackControl(Control)` method of the ScriptManager object for your page, within the `Page_Load` event.</span></span> <span data-ttu-id="37841-122">請記住，頁面都是無狀態，因此您應該重新註冊這些控制項每次建立。</span><span class="sxs-lookup"><span data-stu-id="37841-122">Remember that Pages are stateless, and so you should re-register these controls every time they are created.</span></span>

<span data-ttu-id="37841-123">自動的子系的觸發程序包含可以也停用 （以便建立回傳的子控制項不會自動觸發部分轉譯） 藉由設定`ChildrenAsTriggers`屬性，以**false**。</span><span class="sxs-lookup"><span data-stu-id="37841-123">Automatic child trigger inclusion can also be disabled (so that child controls that create postbacks do not automatically trigger partial renders) by setting the `ChildrenAsTriggers` property to **false**.</span></span> <span data-ttu-id="37841-124">這可讓您在指派哪些特定的控制項最大的彈性可能叫用頁面轉譯，並建議使用，以便開發人員將 opt-in 以回應事件，而不是處理任何可能發生的事件。</span><span class="sxs-lookup"><span data-stu-id="37841-124">This allows you the greatest flexibility in assigning which specific controls may invoke a page render, and is recommended, so that a developer will opt-in to respond to an event, rather than handling any events that may arise.</span></span>

<span data-ttu-id="37841-125">請注意，當 UpdatePanel 控制項巢狀的當 vlastnost UpdateMode nastavena na**條件式**，如果觸發 UpdatePanel 的子系時，但父代不是，則只會重新整理 UpdatePanel 的子系。</span><span class="sxs-lookup"><span data-stu-id="37841-125">Note that when UpdatePanel controls are nested, when the UpdateMode is set to **Conditional**, if the child UpdatePanel is triggered, but the parent is not, then only the child UpdatePanel will refresh.</span></span> <span data-ttu-id="37841-126">不過，如果父 UpdatePanel 重新整理，然後子 UpdatePanel 也會重新整理。</span><span class="sxs-lookup"><span data-stu-id="37841-126">However, if the parent UpdatePanel is refreshed, then the child UpdatePanel will also be refreshed.</span></span>

## <a name="the-lttriggersgt-element"></a><span data-ttu-id="37841-127">*&lt;觸發程序&gt;項目*</span><span class="sxs-lookup"><span data-stu-id="37841-127">*The &lt;Triggers&gt; Element*</span></span>

<span data-ttu-id="37841-128">在 Visual Studio 中標記編輯器中工作時，您可能會注意到 （舉凡 IntelliSense)，有兩個的子元素的`UpdatePanel`控制項。</span><span class="sxs-lookup"><span data-stu-id="37841-128">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an `UpdatePanel` control.</span></span> <span data-ttu-id="37841-129">最常看到的項目是`<ContentTemplate>`元素，基本上會封裝將會更新面板所持有的內容 （我們啟用部分呈現內容）。</span><span class="sxs-lookup"><span data-stu-id="37841-129">The most-frequently seen element is the `<ContentTemplate>` element, which essentially encapsulates the content that will be held by the update panel (the content for which we are enabling partial rendering).</span></span> <span data-ttu-id="37841-130">其他項目是`<Triggers>`元素，其指定的頁面 （或使用者控制項，如果您有使用的話） 上的控制項就會觸發 UpdatePanel 控制項中的部分轉譯&lt;觸發程序&gt;位於項目。</span><span class="sxs-lookup"><span data-stu-id="37841-130">The other element is the `<Triggers>` element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the &lt;Triggers&gt; element resides.</span></span>

<span data-ttu-id="37841-131">`<Triggers>`項目可以包含任意數目每兩個子節點：`<asp:AsyncPostBackTrigger>`和`<asp:PostBackTrigger>`。</span><span class="sxs-lookup"><span data-stu-id="37841-131">The `<Triggers>` element can contain any number each of two child nodes: `<asp:AsyncPostBackTrigger>` and `<asp:PostBackTrigger>`.</span></span> <span data-ttu-id="37841-132">它們都接受兩個屬性`ControlID`和`EventName`，而且可以指定封裝的目前單位內的任何控制項 （例如，如果您的 UpdatePanel 控制項便存在於 Web 使用者控制項內，您不應該嘗試參考上的控制項使用者控制項所在頁面）。</span><span class="sxs-lookup"><span data-stu-id="37841-132">They both accept two attributes, `ControlID` and `EventName`, and can specify any Control within the current unit of encapsulation (for instance, if your UpdatePanel control resides within a Web User Control, you should not attempt to reference a Control on the Page on which the User Control will reside).</span></span>

<span data-ttu-id="37841-133">`<asp:AsyncPostBackTrigger>`項目是特別有用，因為它可以將目標從控制項的子系形式存在的任何事件*任何*UpdatePanel 控制項中的封裝，不只是在其下此觸發程序是子系的 UpdatePanel 單位.</span><span class="sxs-lookup"><span data-stu-id="37841-133">The `<asp:AsyncPostBackTrigger>` element is particularly useful in that it can target any event from a Control that exists as a child of *any* UpdatePanel control in the unit of encapsulation, not just the UpdatePanel under which this trigger is a child.</span></span> <span data-ttu-id="37841-134">因此，任何控制項可以對觸發部分頁面更新。</span><span class="sxs-lookup"><span data-stu-id="37841-134">Thus, any control can be made to trigger a partial page update.</span></span>

<span data-ttu-id="37841-135">同樣地，`<asp:PostBackTrigger>`項目可以用來觸發程序部分頁面轉譯，但需要伺服器的完整往返。</span><span class="sxs-lookup"><span data-stu-id="37841-135">Similarly, the `<asp:PostBackTrigger>` element can be used to trigger a partial page render, but one that requires a full round-trip to the server.</span></span> <span data-ttu-id="37841-136">這個觸發程序項目也可用來強制整頁轉譯控制項通常會否則觸發部分頁面轉譯時 (例如，當`Button`控制項存在於`<ContentTemplate>`UpdatePanel 控制項的項目)。</span><span class="sxs-lookup"><span data-stu-id="37841-136">This trigger element can also be used to force a full page render when a control would otherwise normally trigger a partial page render (for instance, when a `Button` control exists in the `<ContentTemplate>` element of an UpdatePanel control).</span></span> <span data-ttu-id="37841-137">同樣地，PostBackTrigger 項目可以指定會封裝目前單位中任何 UpdatePanel 控制項的子系的任何控制項。</span><span class="sxs-lookup"><span data-stu-id="37841-137">Again, the PostBackTrigger element can specify any control that is a child of any UpdatePanel control in the current unit of encapsulation.</span></span>

## <a name="lttriggersgt-element-reference"></a><span data-ttu-id="37841-138">*&lt;觸發程序&gt;項目參考*</span><span class="sxs-lookup"><span data-stu-id="37841-138">*&lt;Triggers&gt; Element Reference*</span></span>

<span data-ttu-id="37841-139">*標記下階：*</span><span class="sxs-lookup"><span data-stu-id="37841-139">*Markup Descendants:*</span></span>

| <span data-ttu-id="37841-140">**Tag**</span><span class="sxs-lookup"><span data-stu-id="37841-140">**Tag**</span></span> | <span data-ttu-id="37841-141">**描述**</span><span class="sxs-lookup"><span data-stu-id="37841-141">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="37841-142">&lt;asp:AsyncPostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="37841-142">&lt;asp:AsyncPostBackTrigger&gt;</span></span> | <span data-ttu-id="37841-143">指定的控制項和事件，可能會造成部分頁面更新 UpdatePanel 中包含此觸發程序參考。</span><span class="sxs-lookup"><span data-stu-id="37841-143">Specifies a control and event that will cause a partial page update for the UpdatePanel that contains this trigger reference.</span></span> |
| <span data-ttu-id="37841-144">&lt;asp:PostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="37841-144">&lt;asp:PostBackTrigger&gt;</span></span> | <span data-ttu-id="37841-145">指定的控制項和事件會導致完整頁面更新 （整頁重新整理）。</span><span class="sxs-lookup"><span data-stu-id="37841-145">Specifies a control and event that will cause a full page update (a full page refresh).</span></span> <span data-ttu-id="37841-146">此標記可用來控制否則會觸發部分呈現時，強制執行完整的重新整理。</span><span class="sxs-lookup"><span data-stu-id="37841-146">This tag can be used to force a full refresh when a control would otherwise trigger partial rendering.</span></span> |

## <a name="walkthrough-cross-updatepanel-triggers"></a><span data-ttu-id="37841-147">*逐步解說：跨 UpdatePanel 觸發程序*</span><span class="sxs-lookup"><span data-stu-id="37841-147">*Walkthrough: Cross-UpdatePanel Triggers*</span></span>

1. <span data-ttu-id="37841-148">使用 ScriptManager 物件設定為啟用部分呈現模型中建立新的 ASP.NET 網頁。</span><span class="sxs-lookup"><span data-stu-id="37841-148">Create a new ASP.NET page with a ScriptManager object set to enable partial rendering.</span></span> <span data-ttu-id="37841-149">本頁-第一次新增兩個 Updatepanel，請加入一個 Label 控制項 (Label1) 和兩個按鈕控制項 （Button1 和 Button2）。</span><span class="sxs-lookup"><span data-stu-id="37841-149">Add two UpdatePanels to this page - in the first, include a Label control ( Label1 ) and two Button controls ( Button1 and Button2 ).</span></span> <span data-ttu-id="37841-150">Button1 應該會顯示按一下即可更新和 Button2 應該會顯示 按一下以更新，或諸如此類。</span><span class="sxs-lookup"><span data-stu-id="37841-150">Button1 should say Click to Update Both and Button2 should say Click to Update This, or something along those lines.</span></span> <span data-ttu-id="37841-151">在第二個 UpdatePanel 中，包含只有一個 Label 控制項 (Label2)，但 ForeColor 屬性設定為區分文章與預設值以外的項目。</span><span class="sxs-lookup"><span data-stu-id="37841-151">In the second UpdatePanel, include only a Label control ( Label2 ), but set its ForeColor property to something other than the default to differentiate it.</span></span>
2. <span data-ttu-id="37841-152">這兩個 UpdatePanel 標記的 UpdateMode 屬性設定**條件式**。</span><span class="sxs-lookup"><span data-stu-id="37841-152">Set the UpdateMode property of both UpdatePanel tags to **Conditional**.</span></span>

<span data-ttu-id="37841-153">**列表 1:Default.aspx 的標記：**</span><span class="sxs-lookup"><span data-stu-id="37841-153">**Listing 1: Markup for default.aspx:**</span></span> 

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample1.aspx)]

1. <span data-ttu-id="37841-154">Button1 Click 事件處理常式，在設定時將 Label1.Text 和 Label2.Text 為時間相依 （例如 DateTime.Now.ToLongTimeString())。</span><span class="sxs-lookup"><span data-stu-id="37841-154">In the Click event handler for Button1, set Label1.Text and Label2.Text to something time-dependent (such as DateTime.Now.ToLongTimeString()).</span></span> <span data-ttu-id="37841-155">按一下 Button2 的事件處理常式只時將 Label1.Text 設定的時間相依的值。</span><span class="sxs-lookup"><span data-stu-id="37841-155">For the Click event handler for Button2, set only Label1.Text to the time-dependent value.</span></span>

<span data-ttu-id="37841-156">**列表 2:（已修剪） 在 default.aspx.cs 程式碼後置：**</span><span class="sxs-lookup"><span data-stu-id="37841-156">**Listing 2: Codebehind (trimmed) in default.aspx.cs:**</span></span> 

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample2.cs)]

1. <span data-ttu-id="37841-157">按 F5 以建置並執行專案。</span><span class="sxs-lookup"><span data-stu-id="37841-157">Press F5 to build and run the project.</span></span> <span data-ttu-id="37841-158">請注意，當您按一下更新同時面板，這兩個標籤會變更文字;不過，當您按一下 更新這個面板，只 Label1 更新。</span><span class="sxs-lookup"><span data-stu-id="37841-158">Note that, when you click Update Both Panels, both labels change text; however, when you click Update This Panel, only Label1 updates.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image2.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image1.png)

<span data-ttu-id="37841-159">([按一下以檢視完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="37841-159">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span></span>

## <a name="under-the-hood"></a><span data-ttu-id="37841-160">*深入探討*</span><span class="sxs-lookup"><span data-stu-id="37841-160">*Under the Hood*</span></span>

<span data-ttu-id="37841-161">使用我們剛才建構的範例，我們可以看看 ASP.NET AJAX 正在做什麼，以及我們 UpdatePanel 跨面板觸發程序的運作方式。</span><span class="sxs-lookup"><span data-stu-id="37841-161">Utilizing the example we just constructed, we can take a look at what ASP.NET AJAX is doing and how our UpdatePanel cross-panel triggers work.</span></span> <span data-ttu-id="37841-162">若要這樣做，我們會使用產生的頁面原始碼的 HTML，以及 Mozilla Firefox 擴充功能呼叫 FireBug-有了它，我們可以輕鬆地檢查 AJAX 回傳。</span><span class="sxs-lookup"><span data-stu-id="37841-162">To do so, we will work with the generated page source HTML, as well as the Mozilla Firefox extension called FireBug - with it, we can easily examine the AJAX postbacks.</span></span> <span data-ttu-id="37841-163">我們也會使用 Lutz Roeder 的.NET Reflector 工具。</span><span class="sxs-lookup"><span data-stu-id="37841-163">We will also use the .NET Reflector tool by Lutz Roeder.</span></span> <span data-ttu-id="37841-164">這兩種工具可免費使用線上，並在網際網路上搜尋可找到。</span><span class="sxs-lookup"><span data-stu-id="37841-164">Both of these tools are freely available online, and can be found with an internet search.</span></span>

<span data-ttu-id="37841-165">檢查網頁原始碼顯示幾乎沒有異常;UpdatePanel 控制項轉譯為`<div>`容器，而且我們可以看到指令碼資源包含提供由`<asp:ScriptManager>`。</span><span class="sxs-lookup"><span data-stu-id="37841-165">An examination of the page source code shows almost nothing out of the ordinary; the UpdatePanel controls are rendered as `<div>` containers, and we can see the script resource includes provided by the `<asp:ScriptManager>`.</span></span> <span data-ttu-id="37841-166">另外還有一些新 AJAX 特定呼叫 PageRequestManager 內部 AJAX 用戶端指令碼程式庫。</span><span class="sxs-lookup"><span data-stu-id="37841-166">There are also some new AJAX-specific calls to the PageRequestManager that are internal to the AJAX client script library.</span></span> <span data-ttu-id="37841-167">最後，我們看到兩個 UpdatePanel 容器-一個包含呈現`<input>`具有兩個按鈕`<asp:Label>`控制項轉譯為`<span>`容器。</span><span class="sxs-lookup"><span data-stu-id="37841-167">Finally, we see the two UpdatePanel containers - one with the rendered `<input>` buttons with the two `<asp:Label>` controls rendered as `<span>` containers.</span></span> <span data-ttu-id="37841-168">（如果您檢查 DOM 樹狀目錄中的，在 FireBug 中，您會注意到標籤會呈現灰色，表示它們未產生可見內容）。</span><span class="sxs-lookup"><span data-stu-id="37841-168">(If you inspect the DOM tree in FireBug, you will notice that the labels are dimmed to indicate that they are not producing visible content).</span></span>

<span data-ttu-id="37841-169">按一下 [更新這個面板] 按鈕，並注意頂端 UpdatePanel 會更新為目前的伺服器時間。</span><span class="sxs-lookup"><span data-stu-id="37841-169">Click the Update This Panel button, and notice the top UpdatePanel will be updated with the current server time.</span></span> <span data-ttu-id="37841-170">在 FireBug，請選擇 [主控台] 索引標籤，以便您可以檢查要求。</span><span class="sxs-lookup"><span data-stu-id="37841-170">In FireBug, choose the Console tab so that you can examine the request.</span></span> <span data-ttu-id="37841-171">第一次檢查 POST 要求參數：</span><span class="sxs-lookup"><span data-stu-id="37841-171">Examine the POST request parameters first:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image5.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image4.png)

<span data-ttu-id="37841-172">([按一下以檢視完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="37841-172">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span></span>

<span data-ttu-id="37841-173">請注意，UpdatePanel 已指出伺服器端的 AJAX 程式碼來精確地透過 ScriptManager1 參數引發哪些控制項樹狀結構：`Button1`的`UpdatePanel1`控制項。</span><span class="sxs-lookup"><span data-stu-id="37841-173">Note that the UpdatePanel has indicated to the server-side AJAX code precisely which control tree was fired via the ScriptManager1 parameter: `Button1` of the `UpdatePanel1` control.</span></span> <span data-ttu-id="37841-174">現在，按一下 [更新兩個面板] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="37841-174">Now, click on the Update Both Panels button.</span></span> <span data-ttu-id="37841-175">接著，檢查回應，我們看到直立線符號分隔的一連串字串; 字串中設定變數具體來說，我們會看到最上層的 UpdatePanel 中， `UpdatePanel1`，具有其傳送到瀏覽器的 HTML 的全部內容。</span><span class="sxs-lookup"><span data-stu-id="37841-175">Then, examining the response, we see a pipe-delimited series of variables set in a string; specifically, we see the top UpdatePanel, `UpdatePanel1`, has the entirety of its HTML sent to the browser.</span></span> <span data-ttu-id="37841-176">AJAX 用戶端指令碼程式庫會取代 UpdatePanel 的原始 HTML 內容以新的內容，透過`.innerHTML`屬性，因此伺服器從伺服器以 html 格式傳送變更的內容。</span><span class="sxs-lookup"><span data-stu-id="37841-176">The AJAX client script library substitutes the UpdatePanel's original HTML content with the new content via the `.innerHTML` property, and so the server sends the changed content from the server as HTML.</span></span>

<span data-ttu-id="37841-177">現在，按一下 更新兩個面板按鈕，並檢查伺服器的結果。</span><span class="sxs-lookup"><span data-stu-id="37841-177">Now, click on the Update Both Panels button and examine the results from the server.</span></span> <span data-ttu-id="37841-178">結果會類似-這兩個 Updatepanel 從伺服器收到新的 HTML。</span><span class="sxs-lookup"><span data-stu-id="37841-178">The results are very similar - both UpdatePanels receive new HTML from the server.</span></span> <span data-ttu-id="37841-179">如同先前的回呼，會傳送其他的頁面狀態。</span><span class="sxs-lookup"><span data-stu-id="37841-179">As with the previous callback, additional page state is sent.</span></span>

<span data-ttu-id="37841-180">我們可以看到，因為沒有特殊的程式碼會利用執行 AJAX 回傳，AJAX 用戶端指令碼程式庫可攔截表單回傳，而不需要任何額外的程式碼。</span><span class="sxs-lookup"><span data-stu-id="37841-180">As we can see, because no special code is utilized to perform an AJAX postback, the AJAX client script library is able to intercept form postbacks without any additional code.</span></span> <span data-ttu-id="37841-181">伺服器控制項自動運用 JavaScript，使它們不會自動送出表單-ASP.NET 自動插入程式碼的表單驗證和狀態，主要，即可自動指令碼資源包含 PostBackOptions 類別與 ClientScriptManager 類別。</span><span class="sxs-lookup"><span data-stu-id="37841-181">Server controls automatically utilize JavaScript so that they do not automatically submit the form - ASP.NET automatically injects code for form validation and state already, primarily achieved by automatic script resource inclusion, the PostBackOptions class, and the ClientScriptManager class.</span></span>

<span data-ttu-id="37841-182">例如，假設 [CheckBox] 控制項;檢查.NET 反射程式中的類別反組譯碼。</span><span class="sxs-lookup"><span data-stu-id="37841-182">For instance, consider a CheckBox control; examine the class disassembly in .NET Reflector.</span></span> <span data-ttu-id="37841-183">若要這樣做，請確定您 System.Web 組件已開啟，並瀏覽至`System.Web.UI.WebControls.CheckBox`類別中，開啟`RenderInputTag`方法。</span><span class="sxs-lookup"><span data-stu-id="37841-183">To do so, ensure that your System.Web assembly is open, and navigate to the `System.Web.UI.WebControls.CheckBox` class, opening the `RenderInputTag` method.</span></span> <span data-ttu-id="37841-184">尋找檢查的條件式`AutoPostBack`屬性：</span><span class="sxs-lookup"><span data-stu-id="37841-184">Look for a conditional that checks the `AutoPostBack` property:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image8.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image7.png)

<span data-ttu-id="37841-185">([按一下以檢視完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="37841-185">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span></span>

<span data-ttu-id="37841-186">當已啟用自動回傳`CheckBox`控制 （透過將 AutoPostBack 屬性要則為 true），結果`<input>`與 ASP.NET 事件處理中的指令碼，因此呈現標記其`onclick`屬性。</span><span class="sxs-lookup"><span data-stu-id="37841-186">When automatic postback is enabled on a `CheckBox` control (via the AutoPostBack property being true), the resultant `<input>` tag is therefore rendered with an ASP.NET event handling script in its `onclick` attribute.</span></span> <span data-ttu-id="37841-187">攔截表單送出，然後，可讓 ASP.NET AJAX nonintrusively，插入頁面協助以避免任何潛在的重大變更，可能是藉由使用可能不精確的字串取代。</span><span class="sxs-lookup"><span data-stu-id="37841-187">The interception of the form's submission, then, allows ASP.NET AJAX to be injected into the page nonintrusively, helping to avoid any potential breaking changes that might occur by utilizing a possibly-imprecise string replacement.</span></span> <span data-ttu-id="37841-188">此外，這可讓*任何*利用強大的 ASP.NET AJAX 不需要任何額外的程式碼支援使用 UpdatePanel 容器內的自訂 ASP.NET 控制項。</span><span class="sxs-lookup"><span data-stu-id="37841-188">Furthermore, this enables *any* custom ASP.NET control to utilize the power of ASP.NET AJAX without any additional code to support its use within an UpdatePanel container.</span></span>

<span data-ttu-id="37841-189">`<triggers>` PageRequestManager 呼叫中初始化的值相對應功能\_updateControls （ASP.NET AJAX 用戶端指令碼程式庫會使用慣例，該方法、 事件和欄位名稱開頭的附註以底線標記為內部，並不適用於在程式庫本身外部使用）。</span><span class="sxs-lookup"><span data-stu-id="37841-189">The `<triggers>` functionality corresponds to the values initialized in the PageRequestManager call to \_updateControls (note that the ASP.NET AJAX client script library utilizes the convention that methods, events, and field names that begin with an underscore are marked as internal, and are not meant for use outside of the library itself).</span></span> <span data-ttu-id="37841-190">有了它，我們可以觀察哪些控制項要造成 AJAX 回傳。</span><span class="sxs-lookup"><span data-stu-id="37841-190">With it, we can observe which controls are intended to cause AJAX postbacks.</span></span>

<span data-ttu-id="37841-191">比方說，我們將兩個其他控制項加入頁面上，保持 Updatepanel 之外的一個控制項，請完全的而且讓 UpdatePanel 內的其中一個。</span><span class="sxs-lookup"><span data-stu-id="37841-191">For example, let's add two additional controls to the page, leaving one control outside of the UpdatePanels entirely, and leaving one within an UpdatePanel.</span></span> <span data-ttu-id="37841-192">我們將新增核取方塊控制項上方的 UpdatePanel 中，在拖放 DropDownList 以數字的清單中定義的色彩。</span><span class="sxs-lookup"><span data-stu-id="37841-192">We will add a CheckBox control within the upper UpdatePanel, and drop a DropDownList with a number of colors defined within the list.</span></span> <span data-ttu-id="37841-193">以下是新的標記：</span><span class="sxs-lookup"><span data-stu-id="37841-193">Here is the new markup:</span></span>

<span data-ttu-id="37841-194">**列表 3:新的標記**</span><span class="sxs-lookup"><span data-stu-id="37841-194">**Listing 3: New Markup**</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample3.aspx)]

<span data-ttu-id="37841-195">而以下是新程式碼後置：</span><span class="sxs-lookup"><span data-stu-id="37841-195">And here is the new code-behind:</span></span>

<span data-ttu-id="37841-196">**列表 4:程式碼後置**</span><span class="sxs-lookup"><span data-stu-id="37841-196">**Listing 4: Codebehind**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample4.cs)]

<span data-ttu-id="37841-197">此頁面背後的概念是下拉式清單選取以顯示第二個標籤的三種色彩之一，因此，核取方塊決定同時是否為粗體，以及標籤是否顯示日期與時間。</span><span class="sxs-lookup"><span data-stu-id="37841-197">The idea behind this page is that the drop-down list selects one of three colors to show the second label, that the check box determines both whether it is bold, and whether the labels display the date as well as the time.</span></span> <span data-ttu-id="37841-198">核取方塊不會造成 AJAX 更新，但應該下拉式清單，即使是在 UpdatePanel 位於不屬性。</span><span class="sxs-lookup"><span data-stu-id="37841-198">The check box should not cause an AJAX update, but the drop-down list should, even though it is not housed within an UpdatePanel.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image11.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image10.png)

<span data-ttu-id="37841-199">([按一下以檢視完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="37841-199">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span></span>

<span data-ttu-id="37841-200">由於是顯示在上述螢幕擷取畫面，最新的按鈕，按一下已向右按鈕更新此面板，更新下時間前的時間無關。</span><span class="sxs-lookup"><span data-stu-id="37841-200">As is apparent in the above screen shot, the most-recent button to be clicked was the right button Update This Panel, which updated the top time independent of the bottom time.</span></span> <span data-ttu-id="37841-201">日期也關閉之間需按幾下，日期會顯示在下方的標籤。</span><span class="sxs-lookup"><span data-stu-id="37841-201">The date was also switched off between clicks, as the date is visible in the bottom label.</span></span> <span data-ttu-id="37841-202">最後感興趣的是下方的標籤色彩： 標籤的文字，示範如何控制狀態是重要的比最近已更新，並且使用者預期它會保留透過 AJAX 回傳。</span><span class="sxs-lookup"><span data-stu-id="37841-202">Finally of interest is the bottom label's color: it was updated more recently than the label's text, which demonstrates that control state is important, and users expect it to be preserved through AJAX postbacks.</span></span> <span data-ttu-id="37841-203">*不過*，未更新的時間。</span><span class="sxs-lookup"><span data-stu-id="37841-203">*However*, the time was not updated.</span></span> <span data-ttu-id="37841-204">時間會自動重新擴展，透過持續性\_\_解譯由 ASP.NET 執行階段當控制項已在伺服器上重新轉譯頁面的檢視狀態欄位。</span><span class="sxs-lookup"><span data-stu-id="37841-204">The time was automatically repopulated through the persistence of the \_\_VIEWSTATE field of the page being interpreted by the ASP.NET runtime when the control was being re-rendered on the server.</span></span> <span data-ttu-id="37841-205">ASP.NET AJAX 伺服器程式碼無法辨識所在方法之控制項的狀態會變更;它只是重新填入從檢視狀態，並接著執行適當的事件。</span><span class="sxs-lookup"><span data-stu-id="37841-205">The ASP.NET AJAX server code does not recognize in which methods the controls are changing state; it simply repopulates from view state and then runs the events that are appropriate.</span></span>

<span data-ttu-id="37841-206">它應該會指出，不過，，有我初始化頁面內的時間\_Load 事件中，時間會有已正確地遞增。</span><span class="sxs-lookup"><span data-stu-id="37841-206">It should be pointed out, however, that had I initialized the time within the Page\_Load event, the time would have been incremented correctly.</span></span> <span data-ttu-id="37841-207">因此，開發人員應該小心期間的適當事件處理常式中，執行適當的程式碼，並避免頁面使用\_控制項事件處理常式會是適當時載入。</span><span class="sxs-lookup"><span data-stu-id="37841-207">Consequently, developers should be wary that the appropriate code is being run during the appropriate event handlers, and avoid use of Page\_Load when a control event handler would be appropriate.</span></span>

## <a name="summary"></a><span data-ttu-id="37841-208">總結</span><span class="sxs-lookup"><span data-stu-id="37841-208">Summary</span></span>

<span data-ttu-id="37841-209">ASP.NET AJAX Extensions UpdatePanel 控制項是用途廣泛，並可以利用多種方法來識別控制項事件，讓它更新。</span><span class="sxs-lookup"><span data-stu-id="37841-209">The ASP.NET AJAX Extensions UpdatePanel control is versatile, and can utilize a number of methods for identifying control events that should cause it to be updated.</span></span> <span data-ttu-id="37841-210">它支援其子控制項，正在自動更新，但也可以回應至其他位置在頁面上的控制項事件。</span><span class="sxs-lookup"><span data-stu-id="37841-210">It supports being updated automatically by its child controls, but can also respond to control events elsewhere on the page.</span></span>

<span data-ttu-id="37841-211">若要減少潛在的伺服器處理負載，建議`ChildrenAsTriggers`UpdatePanel 的屬性設定為`false`，而且事件是選擇入而不是預設包含。</span><span class="sxs-lookup"><span data-stu-id="37841-211">To reduce potential for server processing load, it is recommended that the `ChildrenAsTriggers` property of an UpdatePanel be set to `false`, and that events be opted-into rather than included by default.</span></span> <span data-ttu-id="37841-212">這也可防止任何不必要的事件造成可能有害的效果，包括驗證和輸入欄位的變更。</span><span class="sxs-lookup"><span data-stu-id="37841-212">This also prevents any unneeded events from causing potentially-unwanted effects, including validation, and changes to input fields.</span></span> <span data-ttu-id="37841-213">這種錯誤可能很難隔離，因為此頁面會以透明的方式更新給使用者，而且原因可能會因此不會立即顯現。</span><span class="sxs-lookup"><span data-stu-id="37841-213">These types of bugs may be difficult to isolate, because the page updates transparently to the user, and the cause may therefore not be immediately obvious.</span></span>

<span data-ttu-id="37841-214">藉由檢查 ASP.NET AJAX 表單的內部運作方式張貼攔截模型，我們可以判斷它會利用 ASP.NET 已經提供的架構。</span><span class="sxs-lookup"><span data-stu-id="37841-214">By examining the inner workings of the ASP.NET AJAX form post interception model, we were able to determine that it utilizes the framework already provided by ASP.NET.</span></span> <span data-ttu-id="37841-215">在此情況下，它會保留最大的相容性與使用相同的架構，所設計的控制項，並最少干擾任何其他的 JavaScript 撰寫的頁面上。</span><span class="sxs-lookup"><span data-stu-id="37841-215">In doing so, it preserves maximum compatibility with controls designed using the same framework, and intrudes minimally on any additional JavaScript written for the page.</span></span>

## <a name="bio"></a><span data-ttu-id="37841-216">簡歷</span><span class="sxs-lookup"><span data-stu-id="37841-216">Bio</span></span>

<span data-ttu-id="37841-217">Rob Paveza 是 Terralever 的資深.NET 應用程式開發人員 ([www.terralever.com](http://www.terralever.com))，在 Tempe，AZ.領先業界的互動式行銷公司</span><span class="sxs-lookup"><span data-stu-id="37841-217">Rob Paveza is a senior .NET application developer at Terralever ([www.terralever.com](http://www.terralever.com)), a leading interactive marketing firm in Tempe, AZ.</span></span> <span data-ttu-id="37841-218">他可以在觸達[ robpaveza@gmail.com ](mailto:robpaveza@gmail.com)，他的部落格位於[ http://geekswithblogs.net/robp/ ](http://geekswithblogs.net/robp/)。</span><span class="sxs-lookup"><span data-stu-id="37841-218">He can be reached at [robpaveza@gmail.com](mailto:robpaveza@gmail.com), and his blog is located at [http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/).</span></span>

<span data-ttu-id="37841-219">Scott Cate 從事 Microsoft Web 技術工作自 1997 年，而且 myKB.com 總裁 ([www.myKB.com](http://www.myKB.com))，專精於撰寫 ASP.NET 架構著重於知識庫軟體解決方案的應用程式。</span><span class="sxs-lookup"><span data-stu-id="37841-219">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="37841-220">可以透過電子郵件連絡 Scott [ scott.cate@myKB.com ](mailto:scott.cate@myKB.com)或他的部落格[ScottCate.com](http://ScottCate.com)</span><span class="sxs-lookup"><span data-stu-id="37841-220">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="37841-221">[上一頁](understanding-partial-page-updates-with-asp-net-ajax.md)
> [下一頁](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span><span class="sxs-lookup"><span data-stu-id="37841-221">[Previous](understanding-partial-page-updates-with-asp-net-ajax.md)
[Next](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span></span>
