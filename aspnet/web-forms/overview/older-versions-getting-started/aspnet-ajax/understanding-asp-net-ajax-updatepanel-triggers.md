---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
title: 瞭解 ASP.NET AJAX UpdatePanel 觸發程式 |Microsoft Docs
author: scottcate
description: 在 Visual Studio 的標記編輯器中工作時，您可能會注意到（從 IntelliSense） UpdatePanel 控制項有兩個子項目。 其中一個 wh 。
ms.author: riande
ms.date: 03/12/2008
ms.assetid: faab8503-2984-48a9-8a40-7728461abc50
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
msc.type: authoredcontent
ms.openlocfilehash: b1cc869f373d4f8283b4d92af74707c3f11fef61
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74588782"
---
# <a name="understanding-aspnet-ajax-updatepanel-triggers"></a><span data-ttu-id="8f834-104">了解 ASP.NET AJAX UpdatePanel 觸發程序</span><span class="sxs-lookup"><span data-stu-id="8f834-104">Understanding ASP.NET AJAX UpdatePanel Triggers</span></span>

<span data-ttu-id="8f834-105">由[Scott Cate](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="8f834-105">by [Scott Cate](https://github.com/scottcate)</span></span>

[<span data-ttu-id="8f834-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="8f834-106">Download PDF</span></span>](https://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial02_Triggers_cs.pdf)

> <span data-ttu-id="8f834-107">在 Visual Studio 的標記編輯器中工作時，您可能會注意到（從 IntelliSense） UpdatePanel 控制項有兩個子項目。</span><span class="sxs-lookup"><span data-stu-id="8f834-107">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an UpdatePanel control.</span></span> <span data-ttu-id="8f834-108">其中一個是 Trigger 元素，它會指定頁面上的控制項（如果您使用的是使用者控制項，則會觸發專案所在的 UpdatePanel 控制項部分呈現）。</span><span class="sxs-lookup"><span data-stu-id="8f834-108">One of which is the Triggers element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the element resides.</span></span>

## <a name="introduction"></a><span data-ttu-id="8f834-109">簡介</span><span class="sxs-lookup"><span data-stu-id="8f834-109">Introduction</span></span>

<span data-ttu-id="8f834-110">Microsoft 的 ASP.NET 技術引進了物件導向和事件導向的程式設計模型，並將它與已編譯器代碼的優點結合在一起。</span><span class="sxs-lookup"><span data-stu-id="8f834-110">Microsoft's ASP.NET technology brings an object-oriented and event-driven programming model and unites it with the benefits of compiled code.</span></span> <span data-ttu-id="8f834-111">不過，其伺服器端處理模型在技術上有一些缺點，其中有許多都可以由 Microsoft ASP.NET 3.5 AJAX 延伸模組中包含的新功能來解決。</span><span class="sxs-lookup"><span data-stu-id="8f834-111">However, its server-side processing model has several drawbacks inherent in the technology, many of which can be addressed by the new features included in the Microsoft ASP.NET 3.5 AJAX Extensions.</span></span> <span data-ttu-id="8f834-112">這些延伸模組可啟用許多新的豐富用戶端功能，包括部分呈現頁面，而不需要完整的頁面重新整理、透過用戶端腳本存取 Web 服務的能力（包括 ASP.NET 分析 API），以及廣泛的用戶端 API設計來鏡像 ASP.NET 伺服器端控制項集中所見的許多控制項配置。</span><span class="sxs-lookup"><span data-stu-id="8f834-112">These extensions enable many new rich client features, including partial rendering of pages without requiring a full page refresh, the ability to access Web Services via client script (including the ASP.NET profiling API), and an extensive client-side API designed to mirror many of the control schemes seen in the ASP.NET server-side control set.</span></span>

<span data-ttu-id="8f834-113">本白皮書將探討 ASP.NET AJAX `UpdatePanel` 元件的 XML 觸發程式功能。</span><span class="sxs-lookup"><span data-stu-id="8f834-113">This whitepaper examines the XML Triggers functionality of the ASP.NET AJAX `UpdatePanel` component.</span></span> <span data-ttu-id="8f834-114">XML 觸發程式可讓您更精確地控制可能會對特定 UpdatePanel 控制項造成部分呈現的元件。</span><span class="sxs-lookup"><span data-stu-id="8f834-114">XML Triggers give granular control over the components that can cause partial rendering for specific UpdatePanel controls.</span></span>

<span data-ttu-id="8f834-115">本白皮書是以 .NET Framework 3.5 和 Visual Studio 2008 的 Beta 2 版為基礎。</span><span class="sxs-lookup"><span data-stu-id="8f834-115">This whitepaper is based on the Beta 2 release of the .NET Framework 3.5 and Visual Studio 2008.</span></span> <span data-ttu-id="8f834-116">ASP.NET AJAX 延伸模組先前以 ASP.NET 2.0 為目標的附加元件，現在已整合到 .NET Framework 的基類庫。</span><span class="sxs-lookup"><span data-stu-id="8f834-116">The ASP.NET AJAX Extensions, previously an add-on assembly targeted at ASP.NET 2.0, are now integrated into the .NET Framework Base Class Library.</span></span> <span data-ttu-id="8f834-117">本白皮書也假設您將使用 Visual Studio 2008，而不是 Visual Web Developer Express，而且將會根據 Visual Studio 的使用者介面提供逐步解說（雖然程式代碼清單完全相容，而不論開發環境）。</span><span class="sxs-lookup"><span data-stu-id="8f834-117">This whitepaper also assumes that you will be working with Visual Studio 2008, not Visual Web Developer Express, and will provide walkthroughs according to the user interface of Visual Studio (although code listings will be entirely compatible regardless of development environment).</span></span>

## <a name="triggers"></a><span data-ttu-id="8f834-118">*觸發程序*</span><span class="sxs-lookup"><span data-stu-id="8f834-118">*Triggers*</span></span>

<span data-ttu-id="8f834-119">給定 UpdatePanel 的觸發程式預設會自動包含任何叫用回傳的子控制項，包括（例如）將其 `AutoPostBack` 屬性設為**true**的 TextBox 控制項。</span><span class="sxs-lookup"><span data-stu-id="8f834-119">Triggers for a given UpdatePanel, by default, automatically include any child controls that invoke a postback, including (for example) TextBox controls that have their `AutoPostBack` property set to **true**.</span></span> <span data-ttu-id="8f834-120">不過，也可以使用標記以宣告方式包含觸發程式;這會在 UpdatePanel 控制項宣告的 `<triggers>` 區段中完成。</span><span class="sxs-lookup"><span data-stu-id="8f834-120">However, triggers can also be included declaratively using markup; this is done within the `<triggers>` section of the UpdatePanel control declaration.</span></span> <span data-ttu-id="8f834-121">雖然可以透過 `Triggers` 集合屬性來存取觸發程式，但建議您在執行時間註冊任何部分呈現觸發程式（例如，如果在設計階段無法使用控制項），方法是在 `Page_Load` 事件內使用網頁的 ScriptManager 物件的 `RegisterAsyncPostBackControl(Control)` 方法。</span><span class="sxs-lookup"><span data-stu-id="8f834-121">Although triggers can be accessed via the `Triggers` collection property, it is recommended that you register any partial render triggers at run-time (for instance, if a control is not available at design time) by using the `RegisterAsyncPostBackControl(Control)` method of the ScriptManager object for your page, within the `Page_Load` event.</span></span> <span data-ttu-id="8f834-122">請記住，頁面是無狀態的，因此您應該在每次建立這些控制項時重新註冊。</span><span class="sxs-lookup"><span data-stu-id="8f834-122">Remember that Pages are stateless, and so you should re-register these controls every time they are created.</span></span>

<span data-ttu-id="8f834-123">自動子觸發套裝程式含也可以停用（如此一來，建立回傳的子控制項不會自動觸發部分轉譯），方法是將 `ChildrenAsTriggers` 屬性設定為**false**。</span><span class="sxs-lookup"><span data-stu-id="8f834-123">Automatic child trigger inclusion can also be disabled (so that child controls that create postbacks do not automatically trigger partial renders) by setting the `ChildrenAsTriggers` property to **false**.</span></span> <span data-ttu-id="8f834-124">這可讓您在指派哪些特定控制項可能會叫用頁面轉譯時擁有最大的彈性，並建議讓開發人員加入宣告來回應事件，而不是處理任何可能發生的事件。</span><span class="sxs-lookup"><span data-stu-id="8f834-124">This allows you the greatest flexibility in assigning which specific controls may invoke a page render, and is recommended, so that a developer will opt-in to respond to an event, rather than handling any events that may arise.</span></span>

<span data-ttu-id="8f834-125">請注意，當 UpdatePanel 控制項是 nested 時，當 UpdateMode 設定為**條件**式時，如果子 UpdatePanel 已觸發，但父系不是，則只有子 updatepanel 會重新整理。</span><span class="sxs-lookup"><span data-stu-id="8f834-125">Note that when UpdatePanel controls are nested, when the UpdateMode is set to **Conditional**, if the child UpdatePanel is triggered, but the parent is not, then only the child UpdatePanel will refresh.</span></span> <span data-ttu-id="8f834-126">不過，如果父 UpdatePanel 重新整理，則子系 UpdatePanel 也會一併更新。</span><span class="sxs-lookup"><span data-stu-id="8f834-126">However, if the parent UpdatePanel is refreshed, then the child UpdatePanel will also be refreshed.</span></span>

## <a name="the-lttriggersgt-element"></a><span data-ttu-id="8f834-127">*&lt;觸發&gt; 元素*</span><span class="sxs-lookup"><span data-stu-id="8f834-127">*The &lt;Triggers&gt; Element*</span></span>

<span data-ttu-id="8f834-128">在 Visual Studio 的標記編輯器中工作時，您可能會注意到（從 IntelliSense） `UpdatePanel` 控制項有兩個子項目。</span><span class="sxs-lookup"><span data-stu-id="8f834-128">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an `UpdatePanel` control.</span></span> <span data-ttu-id="8f834-129">最常見的元素是 `<ContentTemplate>` 元素，基本上會封裝更新面板所持有的內容（我們要啟用部分呈現的內容）。</span><span class="sxs-lookup"><span data-stu-id="8f834-129">The most-frequently seen element is the `<ContentTemplate>` element, which essentially encapsulates the content that will be held by the update panel (the content for which we are enabling partial rendering).</span></span> <span data-ttu-id="8f834-130">另一個元素是 `<Triggers>` 專案，它會指定頁面上的控制項（如果您使用的是使用者控制項，則會觸發&gt; 元素所在 &lt;的 UpdatePanel 控制項的部分轉譯）。</span><span class="sxs-lookup"><span data-stu-id="8f834-130">The other element is the `<Triggers>` element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the &lt;Triggers&gt; element resides.</span></span>

<span data-ttu-id="8f834-131">`<Triggers>` 元素可以包含兩個子節點的任何數位： `<asp:AsyncPostBackTrigger>` 和 `<asp:PostBackTrigger>`。</span><span class="sxs-lookup"><span data-stu-id="8f834-131">The `<Triggers>` element can contain any number each of two child nodes: `<asp:AsyncPostBackTrigger>` and `<asp:PostBackTrigger>`.</span></span> <span data-ttu-id="8f834-132">兩者都接受兩個屬性，`ControlID` 和 `EventName`，而且可以在封裝的目前單位中指定任何控制項（例如，如果您的 UpdatePanel 控制項位於 Web 使用者控制項內，則不應該嘗試參考使用者控制項所在頁面上的控制項）。</span><span class="sxs-lookup"><span data-stu-id="8f834-132">They both accept two attributes, `ControlID` and `EventName`, and can specify any Control within the current unit of encapsulation (for instance, if your UpdatePanel control resides within a Web User Control, you should not attempt to reference a Control on the Page on which the User Control will reside).</span></span>

<span data-ttu-id="8f834-133">`<asp:AsyncPostBackTrigger>` 專案特別有用，因為它可以將來自控制項的任何事件當做封裝單位中*任何*updatepanel 控制項的子系，而不只是以此觸發程式為子系的 updatepanel 為目標。</span><span class="sxs-lookup"><span data-stu-id="8f834-133">The `<asp:AsyncPostBackTrigger>` element is particularly useful in that it can target any event from a Control that exists as a child of *any* UpdatePanel control in the unit of encapsulation, not just the UpdatePanel under which this trigger is a child.</span></span> <span data-ttu-id="8f834-134">因此，可以建立任何控制項來觸發部分頁面更新。</span><span class="sxs-lookup"><span data-stu-id="8f834-134">Thus, any control can be made to trigger a partial page update.</span></span>

<span data-ttu-id="8f834-135">同樣地，`<asp:PostBackTrigger>` 元素可以用來觸發部分頁面轉譯，但需要對伺服器進行完整往返。</span><span class="sxs-lookup"><span data-stu-id="8f834-135">Similarly, the `<asp:PostBackTrigger>` element can be used to trigger a partial page render, but one that requires a full round-trip to the server.</span></span> <span data-ttu-id="8f834-136">當控制項原本就會觸發部分頁面轉譯（例如，在 UpdatePanel 控制項的 `<ContentTemplate>` 元素中存在 `Button` 控制項）時，這個觸發程式專案也可以用來強制進行完整的頁面呈現。</span><span class="sxs-lookup"><span data-stu-id="8f834-136">This trigger element can also be used to force a full page render when a control would otherwise normally trigger a partial page render (for instance, when a `Button` control exists in the `<ContentTemplate>` element of an UpdatePanel control).</span></span> <span data-ttu-id="8f834-137">同樣地，PostBackTrigger 元素可以在目前的封裝單位中，指定任何 UpdatePanel 控制項的子系的控制項。</span><span class="sxs-lookup"><span data-stu-id="8f834-137">Again, the PostBackTrigger element can specify any control that is a child of any UpdatePanel control in the current unit of encapsulation.</span></span>

## <a name="lttriggersgt-element-reference"></a><span data-ttu-id="8f834-138">*&lt;觸發程式&gt; 元素參考*</span><span class="sxs-lookup"><span data-stu-id="8f834-138">*&lt;Triggers&gt; Element Reference*</span></span>

<span data-ttu-id="8f834-139">*標記子代：*</span><span class="sxs-lookup"><span data-stu-id="8f834-139">*Markup Descendants:*</span></span>

| <span data-ttu-id="8f834-140">**標記**</span><span class="sxs-lookup"><span data-stu-id="8f834-140">**Tag**</span></span> | <span data-ttu-id="8f834-141">**說明**</span><span class="sxs-lookup"><span data-stu-id="8f834-141">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="8f834-142">&lt;asp： AsyncPostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="8f834-142">&lt;asp:AsyncPostBackTrigger&gt;</span></span> | <span data-ttu-id="8f834-143">指定將會對包含此觸發程式參考的 UpdatePanel 引發部分頁面更新的控制項和事件。</span><span class="sxs-lookup"><span data-stu-id="8f834-143">Specifies a control and event that will cause a partial page update for the UpdatePanel that contains this trigger reference.</span></span> |
| <span data-ttu-id="8f834-144">&lt;asp： PostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="8f834-144">&lt;asp:PostBackTrigger&gt;</span></span> | <span data-ttu-id="8f834-145">指定會導致完整頁面更新（完整頁面重新整理）的控制項和事件。</span><span class="sxs-lookup"><span data-stu-id="8f834-145">Specifies a control and event that will cause a full page update (a full page refresh).</span></span> <span data-ttu-id="8f834-146">當控制項會觸發部分呈現時，可以使用此標記來強制執行完整重新整理。</span><span class="sxs-lookup"><span data-stu-id="8f834-146">This tag can be used to force a full refresh when a control would otherwise trigger partial rendering.</span></span> |

## <a name="walkthrough-cross-updatepanel-triggers"></a><span data-ttu-id="8f834-147">*逐步解說：交叉 UpdatePanel 觸發程式*</span><span class="sxs-lookup"><span data-stu-id="8f834-147">*Walkthrough: Cross-UpdatePanel Triggers*</span></span>

1. <span data-ttu-id="8f834-148">建立具有 ScriptManager 物件集的新 ASP.NET 網頁，以啟用部分呈現。</span><span class="sxs-lookup"><span data-stu-id="8f834-148">Create a new ASP.NET page with a ScriptManager object set to enable partial rendering.</span></span> <span data-ttu-id="8f834-149">將兩個 Updatepanel 加入此頁面-在第一個中，包含標籤控制項（Label1）和兩個按鈕控制項（Button1 和 Button2）。</span><span class="sxs-lookup"><span data-stu-id="8f834-149">Add two UpdatePanels to this page - in the first, include a Label control ( Label1 ) and two Button controls ( Button1 and Button2 ).</span></span> <span data-ttu-id="8f834-150">Button1 應該會說 [按一下以更新] 和 [Button2] 應該會顯示 [按一下以更新此專案]，或在這些行的某個專案上</span><span class="sxs-lookup"><span data-stu-id="8f834-150">Button1 should say Click to Update Both and Button2 should say Click to Update This, or something along those lines.</span></span> <span data-ttu-id="8f834-151">在第二個 UpdatePanel 中，只包含標籤控制項（Label2），但將其前景屬性設定為預設值以外的專案，以區別它。</span><span class="sxs-lookup"><span data-stu-id="8f834-151">In the second UpdatePanel, include only a Label control ( Label2 ), but set its ForeColor property to something other than the default to differentiate it.</span></span>
2. <span data-ttu-id="8f834-152">將兩個 UpdatePanel 標記的 UpdateMode 屬性設定為 [**條件**式]。</span><span class="sxs-lookup"><span data-stu-id="8f834-152">Set the UpdateMode property of both UpdatePanel tags to **Conditional**.</span></span>

<span data-ttu-id="8f834-153">**清單1： default.aspx 的標記：**</span><span class="sxs-lookup"><span data-stu-id="8f834-153">**Listing 1: Markup for default.aspx:**</span></span> 

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample1.aspx)]

1. <span data-ttu-id="8f834-154">在 Button1 的 Click 事件處理常式中，將 Label1. Text 和 Label2 設定為與時間相關的內容（例如 DateTime. Now. ToLongTimeString （））。</span><span class="sxs-lookup"><span data-stu-id="8f834-154">In the Click event handler for Button1, set Label1.Text and Label2.Text to something time-dependent (such as DateTime.Now.ToLongTimeString()).</span></span> <span data-ttu-id="8f834-155">針對 Button2 的 Click 事件處理常式，將 [Label1] 設定為 [與時間相關的值]。</span><span class="sxs-lookup"><span data-stu-id="8f834-155">For the Click event handler for Button2, set only Label1.Text to the time-dependent value.</span></span>

<span data-ttu-id="8f834-156">**清單2： default.aspx.cs 中的後置（已修剪）：**</span><span class="sxs-lookup"><span data-stu-id="8f834-156">**Listing 2: Codebehind (trimmed) in default.aspx.cs:**</span></span> 

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample2.cs)]

1. <span data-ttu-id="8f834-157">按 F5 以建立並執行專案。</span><span class="sxs-lookup"><span data-stu-id="8f834-157">Press F5 to build and run the project.</span></span> <span data-ttu-id="8f834-158">請注意，當您按一下 [更新兩個面板] 時，這兩個標籤都會變更文字;不過，當您按一下 [更新此面板] 時，只會更新 Label1。</span><span class="sxs-lookup"><span data-stu-id="8f834-158">Note that, when you click Update Both Panels, both labels change text; however, when you click Update This Panel, only Label1 updates.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image2.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image1.png)

<span data-ttu-id="8f834-159">（[按一下以查看完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="8f834-159">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span></span>

## <a name="under-the-hood"></a><span data-ttu-id="8f834-160">*深入探討*</span><span class="sxs-lookup"><span data-stu-id="8f834-160">*Under the Hood*</span></span>

<span data-ttu-id="8f834-161">利用我們剛剛建造的範例，我們可以查看 ASP.NET AJAX 的功能，以及我們的 UpdatePanel 跨面板觸發程式的工作。</span><span class="sxs-lookup"><span data-stu-id="8f834-161">Utilizing the example we just constructed, we can take a look at what ASP.NET AJAX is doing and how our UpdatePanel cross-panel triggers work.</span></span> <span data-ttu-id="8f834-162">若要這麼做，我們將使用所產生的頁面來源 HTML，以及稱為 FireBug 的 Mozilla Firefox 延伸模組，我們可以輕鬆地檢查 AJAX 回傳。</span><span class="sxs-lookup"><span data-stu-id="8f834-162">To do so, we will work with the generated page source HTML, as well as the Mozilla Firefox extension called FireBug - with it, we can easily examine the AJAX postbacks.</span></span> <span data-ttu-id="8f834-163">我們也會藉由 Lutz Roeder 來使用 .NET 反映工具。</span><span class="sxs-lookup"><span data-stu-id="8f834-163">We will also use the .NET Reflector tool by Lutz Roeder.</span></span> <span data-ttu-id="8f834-164">這兩種工具都可以在線上免費使用，並可透過網際網路搜尋找到。</span><span class="sxs-lookup"><span data-stu-id="8f834-164">Both of these tools are freely available online, and can be found with an internet search.</span></span>

<span data-ttu-id="8f834-165">頁面原始碼的檢查幾乎不會顯示一般的內容;UpdatePanel 控制項會轉譯為 `<div>` 容器，我們可以看到 `<asp:ScriptManager>`提供的腳本資源。</span><span class="sxs-lookup"><span data-stu-id="8f834-165">An examination of the page source code shows almost nothing out of the ordinary; the UpdatePanel controls are rendered as `<div>` containers, and we can see the script resource includes provided by the `<asp:ScriptManager>`.</span></span> <span data-ttu-id="8f834-166">對於 AJAX 用戶端腳本程式庫內部的 PageRequestManager，還有一些新的 AJAX 特定呼叫。</span><span class="sxs-lookup"><span data-stu-id="8f834-166">There are also some new AJAX-specific calls to the PageRequestManager that are internal to the AJAX client script library.</span></span> <span data-ttu-id="8f834-167">最後，我們會看到兩個 UpdatePanel 容器，一個具有轉譯的 `<input>` 按鈕，並將兩個 `<asp:Label>` 控制項轉譯為 `<span>` 容器。</span><span class="sxs-lookup"><span data-stu-id="8f834-167">Finally, we see the two UpdatePanel containers - one with the rendered `<input>` buttons with the two `<asp:Label>` controls rendered as `<span>` containers.</span></span> <span data-ttu-id="8f834-168">（如果您檢查 FireBug 中的 DOM 樹狀結構，您會注意到標籤呈暗灰色，表示它們不會產生可見內容）。</span><span class="sxs-lookup"><span data-stu-id="8f834-168">(If you inspect the DOM tree in FireBug, you will notice that the labels are dimmed to indicate that they are not producing visible content).</span></span>

<span data-ttu-id="8f834-169">按一下 [更新此面板] 按鈕，並注意頂端的 UpdatePanel 會以目前的伺服器時間更新。</span><span class="sxs-lookup"><span data-stu-id="8f834-169">Click the Update This Panel button, and notice the top UpdatePanel will be updated with the current server time.</span></span> <span data-ttu-id="8f834-170">在 FireBug 中，選擇 [主控台] 索引標籤，讓您可以檢查要求。</span><span class="sxs-lookup"><span data-stu-id="8f834-170">In FireBug, choose the Console tab so that you can examine the request.</span></span> <span data-ttu-id="8f834-171">先檢查 POST 要求參數：</span><span class="sxs-lookup"><span data-stu-id="8f834-171">Examine the POST request parameters first:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image5.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image4.png)

<span data-ttu-id="8f834-172">（[按一下以查看完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="8f834-172">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span></span>

<span data-ttu-id="8f834-173">請注意，UpdatePanel 已透過 ScriptManager1 參數，精確地指示伺服器端 AJAX 程式碼所引發的控制項樹狀結構： `UpdatePanel1` 控制項的 `Button1`。</span><span class="sxs-lookup"><span data-stu-id="8f834-173">Note that the UpdatePanel has indicated to the server-side AJAX code precisely which control tree was fired via the ScriptManager1 parameter: `Button1` of the `UpdatePanel1` control.</span></span> <span data-ttu-id="8f834-174">現在，按一下 [更新兩個面板] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8f834-174">Now, click on the Update Both Panels button.</span></span> <span data-ttu-id="8f834-175">然後，檢查回應，我們會在字串中看到以管線分隔的變數系列;具體來說，我們看到的是最熱門的 UpdatePanel （`UpdatePanel1`），其 HTML 已傳送到瀏覽器的全部。</span><span class="sxs-lookup"><span data-stu-id="8f834-175">Then, examining the response, we see a pipe-delimited series of variables set in a string; specifically, we see the top UpdatePanel, `UpdatePanel1`, has the entirety of its HTML sent to the browser.</span></span> <span data-ttu-id="8f834-176">AJAX 用戶端腳本程式庫會透過 `.innerHTML` 屬性，以新的內容取代 UpdatePanel 的原始 HTML 內容，因此伺服器會將已變更的內容從伺服器當做 HTML 傳送。</span><span class="sxs-lookup"><span data-stu-id="8f834-176">The AJAX client script library substitutes the UpdatePanel's original HTML content with the new content via the `.innerHTML` property, and so the server sends the changed content from the server as HTML.</span></span>

<span data-ttu-id="8f834-177">現在，按一下 [更新兩個面板] 按鈕，然後檢查伺服器的結果。</span><span class="sxs-lookup"><span data-stu-id="8f834-177">Now, click on the Update Both Panels button and examine the results from the server.</span></span> <span data-ttu-id="8f834-178">結果非常類似-這兩個 Updatepanel 都會從伺服器接收新的 HTML。</span><span class="sxs-lookup"><span data-stu-id="8f834-178">The results are very similar - both UpdatePanels receive new HTML from the server.</span></span> <span data-ttu-id="8f834-179">如同先前的回呼，會傳送額外的頁面狀態。</span><span class="sxs-lookup"><span data-stu-id="8f834-179">As with the previous callback, additional page state is sent.</span></span>

<span data-ttu-id="8f834-180">如我們所見，由於未使用任何特殊程式碼來執行 AJAX 回傳，因此 AJAX 用戶端腳本程式庫可以攔截表單回傳，而不需要任何額外的程式碼。</span><span class="sxs-lookup"><span data-stu-id="8f834-180">As we can see, because no special code is utilized to perform an AJAX postback, the AJAX client script library is able to intercept form postbacks without any additional code.</span></span> <span data-ttu-id="8f834-181">伺服器控制項會自動使用 JavaScript，使其不會自動提交表單-ASP.NET 會自動插入表單驗證和狀態的程式碼，主要是透過自動腳本資源包含（PostBackOptions 類別）來達成。和 ClientScriptManager 類別。</span><span class="sxs-lookup"><span data-stu-id="8f834-181">Server controls automatically utilize JavaScript so that they do not automatically submit the form - ASP.NET automatically injects code for form validation and state already, primarily achieved by automatic script resource inclusion, the PostBackOptions class, and the ClientScriptManager class.</span></span>

<span data-ttu-id="8f834-182">例如，請考慮使用 CheckBox 控制項。檢查 .NET 反映中的類別反組解碼。</span><span class="sxs-lookup"><span data-stu-id="8f834-182">For instance, consider a CheckBox control; examine the class disassembly in .NET Reflector.</span></span> <span data-ttu-id="8f834-183">若要這麼做，請確定您的 System.web 元件已開啟，並流覽至 `System.Web.UI.WebControls.CheckBox` 類別，並開啟 `RenderInputTag` 方法。</span><span class="sxs-lookup"><span data-stu-id="8f834-183">To do so, ensure that your System.Web assembly is open, and navigate to the `System.Web.UI.WebControls.CheckBox` class, opening the `RenderInputTag` method.</span></span> <span data-ttu-id="8f834-184">尋找檢查 `AutoPostBack` 屬性的條件：</span><span class="sxs-lookup"><span data-stu-id="8f834-184">Look for a conditional that checks the `AutoPostBack` property:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image8.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image7.png)

<span data-ttu-id="8f834-185">（[按一下以查看完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="8f834-185">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span></span>

<span data-ttu-id="8f834-186">當 `CheckBox` 控制項上啟用自動回傳時（透過 AutoPostBack 屬性為 true），會因此產生的 `<input>` 標記會以其 `onclick` 屬性中的 ASP.NET 事件處理腳本呈現。</span><span class="sxs-lookup"><span data-stu-id="8f834-186">When automatic postback is enabled on a `CheckBox` control (via the AutoPostBack property being true), the resultant `<input>` tag is therefore rendered with an ASP.NET event handling script in its `onclick` attribute.</span></span> <span data-ttu-id="8f834-187">接著，攔截表單的提交，就能讓 ASP.NET AJAX 插入頁面 nonintrusively 中，藉由利用可能不精確的字串取代，協助避免任何可能發生的重大變更。</span><span class="sxs-lookup"><span data-stu-id="8f834-187">The interception of the form's submission, then, allows ASP.NET AJAX to be injected into the page nonintrusively, helping to avoid any potential breaking changes that might occur by utilizing a possibly-imprecise string replacement.</span></span> <span data-ttu-id="8f834-188">此外，這可讓*任何*自訂的 ASP.NET 控制項利用 ASP.NET AJAX 的強大功能，而不需要任何額外的程式碼來支援在 UpdatePanel 容器中使用。</span><span class="sxs-lookup"><span data-stu-id="8f834-188">Furthermore, this enables *any* custom ASP.NET control to utilize the power of ASP.NET AJAX without any additional code to support its use within an UpdatePanel container.</span></span>

<span data-ttu-id="8f834-189">`<triggers>` 功能會對應至 \_updateControls 的 PageRequestManager 呼叫中所初始化的值（請注意，ASP.NET AJAX 用戶端腳本程式庫會利用以底線開頭的方法、事件和功能變數名稱標示為內部的慣例，而不是用於程式庫本身以外的地方）。</span><span class="sxs-lookup"><span data-stu-id="8f834-189">The `<triggers>` functionality corresponds to the values initialized in the PageRequestManager call to \_updateControls (note that the ASP.NET AJAX client script library utilizes the convention that methods, events, and field names that begin with an underscore are marked as internal, and are not meant for use outside of the library itself).</span></span> <span data-ttu-id="8f834-190">有了它，我們就可以觀察哪些控制項要造成 AJAX 回傳。</span><span class="sxs-lookup"><span data-stu-id="8f834-190">With it, we can observe which controls are intended to cause AJAX postbacks.</span></span>

<span data-ttu-id="8f834-191">例如，讓我們將兩個額外的控制項加入至頁面，將一個控制項完全放在 Updatepanel 外部，並在 UpdatePanel 中保留一個。</span><span class="sxs-lookup"><span data-stu-id="8f834-191">For example, let's add two additional controls to the page, leaving one control outside of the UpdatePanels entirely, and leaving one within an UpdatePanel.</span></span> <span data-ttu-id="8f834-192">我們會在上方的 UpdatePanel 中新增 CheckBox 控制項，並使用清單中定義的多個色彩來卸載 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="8f834-192">We will add a CheckBox control within the upper UpdatePanel, and drop a DropDownList with a number of colors defined within the list.</span></span> <span data-ttu-id="8f834-193">以下是新的標記：</span><span class="sxs-lookup"><span data-stu-id="8f834-193">Here is the new markup:</span></span>

<span data-ttu-id="8f834-194">**清單3：新標記**</span><span class="sxs-lookup"><span data-stu-id="8f834-194">**Listing 3: New Markup**</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample3.aspx)]

<span data-ttu-id="8f834-195">以下是新的程式碼後置：</span><span class="sxs-lookup"><span data-stu-id="8f834-195">And here is the new code-behind:</span></span>

<span data-ttu-id="8f834-196">**清單4：代碼後置**</span><span class="sxs-lookup"><span data-stu-id="8f834-196">**Listing 4: Codebehind**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample4.cs)]

<span data-ttu-id="8f834-197">此頁面背後的構想是，下拉式清單會選取三種色彩的其中一種來顯示第二個標籤，核取方塊會決定是否為粗體，以及標籤是否顯示日期和時間。</span><span class="sxs-lookup"><span data-stu-id="8f834-197">The idea behind this page is that the drop-down list selects one of three colors to show the second label, that the check box determines both whether it is bold, and whether the labels display the date as well as the time.</span></span> <span data-ttu-id="8f834-198">此核取方塊不應造成 AJAX 更新，但下拉式清單應為，即使它不是存放在 UpdatePanel 內也一樣。</span><span class="sxs-lookup"><span data-stu-id="8f834-198">The check box should not cause an AJAX update, but the drop-down list should, even though it is not housed within an UpdatePanel.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image11.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image10.png)

<span data-ttu-id="8f834-199">（[按一下以查看完整大小的影像](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="8f834-199">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span></span>

<span data-ttu-id="8f834-200">如上述螢幕擷取畫面所示，按一下 [最新的] 按鈕就會更新此面板，而這會更新與下一時間無關的前幾個時間。</span><span class="sxs-lookup"><span data-stu-id="8f834-200">As is apparent in the above screen shot, the most-recent button to be clicked was the right button Update This Panel, which updated the top time independent of the bottom time.</span></span> <span data-ttu-id="8f834-201">日期也會在按一下時切換，因為日期會顯示在底部標籤中。</span><span class="sxs-lookup"><span data-stu-id="8f834-201">The date was also switched off between clicks, as the date is visible in the bottom label.</span></span> <span data-ttu-id="8f834-202">最後，重點是底部標籤的色彩：其更新時間比標籤的文字還新，這會示範控制項狀態很重要，而且使用者預期會透過 AJAX 回傳加以保留。</span><span class="sxs-lookup"><span data-stu-id="8f834-202">Finally of interest is the bottom label's color: it was updated more recently than the label's text, which demonstrates that control state is important, and users expect it to be preserved through AJAX postbacks.</span></span> <span data-ttu-id="8f834-203">*不過*，時間並未更新。</span><span class="sxs-lookup"><span data-stu-id="8f834-203">*However*, the time was not updated.</span></span> <span data-ttu-id="8f834-204">當控制項在伺服器上重新呈現時，會透過 ASP.NET 執行時間所轉譯之頁面的 [\_\_VIEWSTATE] 欄位的持續性，自動重新擴展時間。</span><span class="sxs-lookup"><span data-stu-id="8f834-204">The time was automatically repopulated through the persistence of the \_\_VIEWSTATE field of the page being interpreted by the ASP.NET runtime when the control was being re-rendered on the server.</span></span> <span data-ttu-id="8f834-205">ASP.NET AJAX 伺服器程式碼無法辨識控制項變更狀態的方法;它只會從 view 狀態重新填入，然後執行適當的事件。</span><span class="sxs-lookup"><span data-stu-id="8f834-205">The ASP.NET AJAX server code does not recognize in which methods the controls are changing state; it simply repopulates from view state and then runs the events that are appropriate.</span></span>

<span data-ttu-id="8f834-206">但是應該指出，我已初始化頁面中的時間\_載入事件，時間已正確增加。</span><span class="sxs-lookup"><span data-stu-id="8f834-206">It should be pointed out, however, that had I initialized the time within the Page\_Load event, the time would have been incremented correctly.</span></span> <span data-ttu-id="8f834-207">因此，開發人員應該要小心在適當的事件處理常式期間執行適當的程式碼，並避免在適當的控制項事件處理常式時使用頁面\_載入。</span><span class="sxs-lookup"><span data-stu-id="8f834-207">Consequently, developers should be wary that the appropriate code is being run during the appropriate event handlers, and avoid use of Page\_Load when a control event handler would be appropriate.</span></span>

## <a name="summary"></a><span data-ttu-id="8f834-208">總結</span><span class="sxs-lookup"><span data-stu-id="8f834-208">Summary</span></span>

<span data-ttu-id="8f834-209">ASP.NET AJAX Extensions UpdatePanel 控制項很多功能，而且可以利用多種方法來識別應使其更新的控制項事件。</span><span class="sxs-lookup"><span data-stu-id="8f834-209">The ASP.NET AJAX Extensions UpdatePanel control is versatile, and can utilize a number of methods for identifying control events that should cause it to be updated.</span></span> <span data-ttu-id="8f834-210">它支援由其子控制項自動更新，但也可以回應頁面上其他位置的控制項事件。</span><span class="sxs-lookup"><span data-stu-id="8f834-210">It supports being updated automatically by its child controls, but can also respond to control events elsewhere on the page.</span></span>

<span data-ttu-id="8f834-211">若要減少伺服器處理負載的可能，建議將 UpdatePanel 的 `ChildrenAsTriggers` 屬性設定為 `false`，並加入宣告而不是預設包含的事件。</span><span class="sxs-lookup"><span data-stu-id="8f834-211">To reduce potential for server processing load, it is recommended that the `ChildrenAsTriggers` property of an UpdatePanel be set to `false`, and that events be opted-into rather than included by default.</span></span> <span data-ttu-id="8f834-212">這也可避免任何不必要的事件造成潛在不必要的效果，包括驗證和輸入欄位的變更。</span><span class="sxs-lookup"><span data-stu-id="8f834-212">This also prevents any unneeded events from causing potentially-unwanted effects, including validation, and changes to input fields.</span></span> <span data-ttu-id="8f834-213">這些類型的錯誤可能很難隔離，因為網頁會以透明的方式更新給使用者，因此可能不會立即察覺原因。</span><span class="sxs-lookup"><span data-stu-id="8f834-213">These types of bugs may be difficult to isolate, because the page updates transparently to the user, and the cause may therefore not be immediately obvious.</span></span>

<span data-ttu-id="8f834-214">藉由檢查 ASP.NET AJAX 表單後攔截模型的內部運作方式，我們可以判斷它是否利用了 ASP.NET 所提供的架構。</span><span class="sxs-lookup"><span data-stu-id="8f834-214">By examining the inner workings of the ASP.NET AJAX form post interception model, we were able to determine that it utilizes the framework already provided by ASP.NET.</span></span> <span data-ttu-id="8f834-215">在這麼做的情況下，它會保留與使用相同架構設計之控制項的最大相容性，並在針對該頁面撰寫的任何額外 JavaScript 上行程干擾最低。</span><span class="sxs-lookup"><span data-stu-id="8f834-215">In doing so, it preserves maximum compatibility with controls designed using the same framework, and intrudes minimally on any additional JavaScript written for the page.</span></span>

## <a name="bio"></a><span data-ttu-id="8f834-216">生物</span><span class="sxs-lookup"><span data-stu-id="8f834-216">Bio</span></span>

<span data-ttu-id="8f834-217">Paveza 是 Terralever （[www.terralever.com](http://www.terralever.com)）的資深 .net 應用程式開發人員，這是 TEMPE，AZ 中的領先互動行銷公司。</span><span class="sxs-lookup"><span data-stu-id="8f834-217">Rob Paveza is a senior .NET application developer at Terralever ([www.terralever.com](http://www.terralever.com)), a leading interactive marketing firm in Tempe, AZ.</span></span> <span data-ttu-id="8f834-218">他可以在[robpaveza@gmail.com](mailto:robpaveza@gmail.com)觸達，而他的 blog 則位於[http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/)。</span><span class="sxs-lookup"><span data-stu-id="8f834-218">He can be reached at [robpaveza@gmail.com](mailto:robpaveza@gmail.com), and his blog is located at [http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/).</span></span>

<span data-ttu-id="8f834-219">Scott Cate 自1997起開始使用 Microsoft Web 技術，而這是 myKB.com （[www.myKB.com](http://www.myKB.com)）的總裁，他專門撰寫以 ASP.NET 為基礎的應用程式，著重于知識庫軟體解決方案。</span><span class="sxs-lookup"><span data-stu-id="8f834-219">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="8f834-220">Scott 可以透過電子郵件聯絡，位於[scott.cate@myKB.com](mailto:scott.cate@myKB.com)或他的[ScottCate.com](http://ScottCate.com)的 blog</span><span class="sxs-lookup"><span data-stu-id="8f834-220">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8f834-221">[上一頁](understanding-partial-page-updates-with-asp-net-ajax.md)
> [下一頁](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span><span class="sxs-lookup"><span data-stu-id="8f834-221">[Previous](understanding-partial-page-updates-with-asp-net-ajax.md)
[Next](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span></span>
