---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
title: 瞭解 ASP.NET AJAX Web 服務 |Microsoft Docs
author: scottcate
description: Web 服務是 .NET framework 不可或缺的一部分，可提供跨平臺的解決方案，在分散式系統之間交換資料。 雖然 Web .。。
ms.author: riande
ms.date: 03/28/2008
ms.assetid: 3332d6e7-e2e1-4144-b805-e71d51e7e415
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
msc.type: authoredcontent
ms.openlocfilehash: eac3d53fd871d0cb5a2870488ce752c057cc5b1a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "86162762"
---
# <a name="understanding-aspnet-ajax-web-services"></a><span data-ttu-id="0bd6c-104">了解 ASP.NET AJAX Web 服務</span><span class="sxs-lookup"><span data-stu-id="0bd6c-104">Understanding ASP.NET AJAX Web Services</span></span>

<span data-ttu-id="0bd6c-105">由[Scott Cate](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="0bd6c-105">by [Scott Cate](https://github.com/scottcate)</span></span>

[<span data-ttu-id="0bd6c-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="0bd6c-106">Download PDF</span></span>](https://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial05_Web_Services_with_MS_Ajax_cs.pdf)

> <span data-ttu-id="0bd6c-107">Web 服務是 .NET framework 不可或缺的一部分，可提供跨平臺的解決方案，在分散式系統之間交換資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-107">Web Services are an integral part of the .NET framework that provide a cross-platform solution for exchanging data between distributed systems.</span></span> <span data-ttu-id="0bd6c-108">雖然 Web 服務通常用來允許不同的作業系統、物件模型和程式語言傳送和接收資料，它們也可以用來以動態方式將資料插入 ASP.NET AJAX 頁面，或將資料從頁面傳送到後端系統。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-108">Although Web Services are normally used to allow different operating systems, object models and programming languages to send and receive data, they can also be used to dynamically inject data into an ASP.NET AJAX page or send data from a page to a back-end system.</span></span> <span data-ttu-id="0bd6c-109">這一切都可以完成，而不需要進行回傳作業。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-109">All of this can be done without resorting to postback operations.</span></span>

## <a name="calling-web-services-with-aspnet-ajax"></a><span data-ttu-id="0bd6c-110">使用 ASP.NET AJAX 呼叫 Web 服務</span><span class="sxs-lookup"><span data-stu-id="0bd6c-110">Calling Web Services with ASP.NET AJAX</span></span>

<span data-ttu-id="0bd6c-111">Dan Wahlin</span><span class="sxs-lookup"><span data-stu-id="0bd6c-111">Dan Wahlin</span></span>

<span data-ttu-id="0bd6c-112">Web 服務是 .NET framework 不可或缺的一部分，可提供跨平臺的解決方案，在分散式系統之間交換資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-112">Web Services are an integral part of the .NET framework that provide a cross-platform solution for exchanging data between distributed systems.</span></span> <span data-ttu-id="0bd6c-113">雖然 Web 服務通常用來允許不同的作業系統、物件模型和程式語言傳送和接收資料，它們也可以用來以動態方式將資料插入 ASP.NET AJAX 頁面，或將資料從頁面傳送到後端系統。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-113">Although Web Services are normally used to allow different operating systems, object models and programming languages to send and receive data, they can also be used to dynamically inject data into an ASP.NET AJAX page or send data from a page to a back-end system.</span></span> <span data-ttu-id="0bd6c-114">這一切都可以完成，而不需要進行回傳作業。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-114">All of this can be done without resorting to postback operations.</span></span>

<span data-ttu-id="0bd6c-115">雖然 ASP.NET AJAX UpdatePanel 控制項提供簡單的方式來啟用任何 ASP.NET 網頁，但有時您可能需要在不使用 UpdatePanel 的情況下動態存取伺服器上的資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-115">While the ASP.NET AJAX UpdatePanel control provides a simple way to AJAX enable any ASP.NET page, there may be times when you need to dynamically access data on the server without using an UpdatePanel.</span></span> <span data-ttu-id="0bd6c-116">在本文中，您將瞭解如何藉由在 ASP.NET AJAX 頁面中建立及使用 Web 服務來完成這項工作。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-116">In this article you'll see how to accomplish this by creating and consuming Web Services within ASP.NET AJAX pages.</span></span>

<span data-ttu-id="0bd6c-117">本文將著重于核心 ASP.NET AJAX 延伸模組中提供的功能，以及在 ASP.NET AJAX 工具組中啟用的 Web 服務控制項，稱為 AutoCompleteExtender。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-117">This article will focus on functionality available in the core ASP.NET AJAX Extensions as well as a Web Service enabled control in the ASP.NET AJAX Toolkit called the AutoCompleteExtender.</span></span> <span data-ttu-id="0bd6c-118">涵蓋的主題包括定義啟用 AJAX 的 Web 服務、建立用戶端 proxy，以及使用 JavaScript 呼叫 Web 服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-118">Topics covered include defining AJAX-enabled Web Services, creating client proxies and calling Web Services with JavaScript.</span></span> <span data-ttu-id="0bd6c-119">您也會看到 Web 服務呼叫如何直接進行 ASP.NET 網頁方法。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-119">You'll also see how Web Service calls can be made directly to ASP.NET page methods.</span></span>

## <a name="web-services-configuration"></a><span data-ttu-id="0bd6c-120">Web 服務設定</span><span class="sxs-lookup"><span data-stu-id="0bd6c-120">Web Services Configuration</span></span>

<span data-ttu-id="0bd6c-121">當使用 Visual Studio 2008 建立新的網站專案時，web.config 檔案有一些新新增功能，可能不熟悉舊版 Visual Studio 的使用者。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-121">When a new Web Site project is created with Visual Studio 2008, the web.config file has a number of new additions that may be unfamiliar to users of previous versions of Visual Studio.</span></span> <span data-ttu-id="0bd6c-122">其中一些修改會將 "asp" 前置詞對應至 ASP.NET AJAX 控制項，讓它們可以在頁面中使用，而有些則會定義必要的 HttpHandlers 和 HttpModules。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-122">Some of these modifications map the "asp" prefix to ASP.NET AJAX controls so they can be used in pages while others define required HttpHandlers and HttpModules.</span></span> <span data-ttu-id="0bd6c-123">[清單 1] 顯示對 `<httpHandlers>` web.config 影響 Web 服務呼叫的元素所做的修改。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-123">Listing 1 shows modifications made to the `<httpHandlers>` element in web.config that affects Web Service calls.</span></span> <span data-ttu-id="0bd6c-124">用來處理 .asmx 呼叫的預設 HttpHandler 會被移除，並取代為位於 System.Web.Extensions.dll 元件中的 ScriptHandlerFactory 類別。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-124">The default HttpHandler used to process .asmx calls is removed and replaced with a ScriptHandlerFactory class located in the System.Web.Extensions.dll assembly.</span></span> <span data-ttu-id="0bd6c-125">System.Web.Extensions.dll 包含 ASP.NET AJAX 所使用的所有核心功能。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-125">System.Web.Extensions.dll contains all of the core functionality used by ASP.NET AJAX.</span></span>

<span data-ttu-id="0bd6c-126">**[清單 1]。ASP.NET AJAX Web 服務處理常式設定**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-126">**Listing 1. ASP.NET AJAX Web Service Handler Configuration**</span></span>

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample1.xml)]

<span data-ttu-id="0bd6c-127">這項 HttpHandler 取代的目的是為了讓 JavaScript 物件標記法 (JSON) 呼叫使用 JavaScript Web 服務 proxy 從 ASP.NET AJAX 頁面進行到 .NET Web 服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-127">This HttpHandler replacement is made in order to allow JavaScript Object Notation (JSON) calls to be made from ASP.NET AJAX pages to .NET Web Services using a JavaScript Web Service proxy.</span></span> <span data-ttu-id="0bd6c-128">ASP.NET AJAX 會將 JSON 訊息傳送至 Web 服務，而不是標準的簡單物件存取通訊協定， (SOAP) 呼叫通常與 Web 服務相關聯。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-128">ASP.NET AJAX sends JSON messages to Web Services as opposed to the standard Simple Object Access Protocol (SOAP) calls typically associated with Web Services.</span></span> <span data-ttu-id="0bd6c-129">這會導致整體的要求和回應訊息變小。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-129">This results in smaller request and response messages overall.</span></span> <span data-ttu-id="0bd6c-130">它也可讓用戶端更有效率地處理資料，因為 ASP.NET AJAX JavaScript 程式庫已優化，可搭配 JSON 物件使用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-130">It also allows for more efficient client-side processing of data since the ASP.NET AJAX JavaScript library is optimized to work with JSON objects.</span></span> <span data-ttu-id="0bd6c-131">[清單 2] 和 [清單 3] 顯示序列化為 JSON 格式的 Web 服務要求和回應訊息的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-131">Listing 2 and Listing 3 show examples of Web Service request and response messages serialized to JSON format.</span></span> <span data-ttu-id="0bd6c-132">[清單 2] 中顯示的要求訊息會傳遞值為「比利時」的國家（地區）參數，而 [清單 3] 中的回應訊息則會傳遞客戶物件的陣列及其相關聯的屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-132">The request message shown in Listing 2 passes a country parameter with a value of "Belgium" while the response message in Listing 3 passes an array of Customer objects and their associated properties.</span></span>

<span data-ttu-id="0bd6c-133">**[清單 2]。序列化為 JSON 的 Web 服務要求訊息**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-133">**Listing 2. Web Service Request Message Serialized to JSON**</span></span>

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample2.json)]

> <span data-ttu-id="0bd6c-134">*>作業 [!NOTE] 名稱會定義為 web 服務 URL 的一部分; 此外，要求訊息不一定會透過 JSON 提交。Web 服務可以利用 ScriptMethod 屬性，並將 UseHttpGet 參數設定為 true，這會導致透過查詢字串參數傳遞參數。*</span><span class="sxs-lookup"><span data-stu-id="0bd6c-134">*> [!NOTE] the operation name is defined as part of the URL to the web service; additionally, request messages are not always submitted via JSON. Web Services can utilize the ScriptMethod attribute with the UseHttpGet parameter set to true, which causes parameters to be passed via a the query string parameters.*</span></span>

<span data-ttu-id="0bd6c-135">**[清單 3]。序列化為 JSON 的 Web 服務回應訊息**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-135">**Listing 3. Web Service Response Message Serialized to JSON**</span></span>

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample3.json)]

<span data-ttu-id="0bd6c-136">在下一節中，您將瞭解如何建立能夠處理 JSON 要求訊息的 Web 服務，並同時回應簡單和複雜類型。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-136">In the next section you'll see how to create Web Services capable of handling JSON request messages and responding with both simple and complex types.</span></span>

## <a name="creating-ajax-enabled-web-services"></a><span data-ttu-id="0bd6c-137">建立啟用 AJAX 的 Web 服務</span><span class="sxs-lookup"><span data-stu-id="0bd6c-137">Creating AJAX-Enabled Web Services</span></span>

<span data-ttu-id="0bd6c-138">ASP.NET AJAX 架構提供數種不同的方式來呼叫 Web 服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-138">The ASP.NET AJAX framework provides several different ways to call Web Services.</span></span> <span data-ttu-id="0bd6c-139">您可以使用 ASP.NET AJAX 工具組中所提供的 AutoCompleteExtender 控制項 () 或 JavaScript。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-139">You can use the AutoCompleteExtender control (available in the ASP.NET AJAX Toolkit) or JavaScript.</span></span> <span data-ttu-id="0bd6c-140">不過，在呼叫服務之前，您必須先啟用 AJAX，讓用戶端腳本能夠呼叫它。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-140">However, before calling a service you have to AJAX-enable it so that it can be called by client-script code.</span></span>

<span data-ttu-id="0bd6c-141">無論您是否熟悉 ASP.NET Web 服務，都可以直接建立和啟用 AJAX 的服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-141">Whether or not you're new to ASP.NET Web Services, you'll find it straightforward to create and AJAX-enable services.</span></span> <span data-ttu-id="0bd6c-142">.NET framework 已支援建立 ASP.NET Web 服務，因為它在2002中的初始版本，而 ASP.NET AJAX Extensions 則提供以 .NET framework 的預設功能集為基礎的其他 AJAX 功能。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-142">The .NET framework has supported the creation of ASP.NET Web Services since its initial release in 2002 and the ASP.NET AJAX Extensions provide additional AJAX functionality that builds upon the .NET framework's default set of features.</span></span> <span data-ttu-id="0bd6c-143">Visual Studio .NET 2008 Beta 2 提供建立 .asmx Web 服務檔案的內建支援，並自動從 System.web 類別衍生類別旁的相關程式碼。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-143">Visual Studio .NET 2008 Beta 2 has built-in support for creating .asmx Web Service files and automatically derives associated code beside classes from the System.Web.Services.WebService class.</span></span> <span data-ttu-id="0bd6c-144">當您將方法加入至類別時，您必須套用 WebMethod 屬性，才能讓 Web 服務取用者呼叫它們。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-144">As you add methods into the class you must apply the WebMethod attribute in order for them to be called by Web Service consumers.</span></span>

<span data-ttu-id="0bd6c-145">[清單 4] 顯示將 WebMethod 屬性套用至名為 GetCustomersByCountry ( # A1 之方法的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-145">Listing 4 shows an example of applying the WebMethod attribute to a method named GetCustomersByCountry().</span></span>

<span data-ttu-id="0bd6c-146">**[清單 4]。在 Web 服務中使用 WebMethod 屬性**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-146">**Listing 4. Using the WebMethod Attribute in a Web Service**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample4.cs)]

<span data-ttu-id="0bd6c-147">GetCustomersByCountry ( # A1 方法會接受 country 參數，並傳回 Customer 物件陣列。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-147">The GetCustomersByCountry() method accepts a country parameter and returns a Customer object array.</span></span> <span data-ttu-id="0bd6c-148">傳入方法的國家（地區）值會轉送到商業層類別，然後再呼叫資料層類別來抓取資料庫中的資料、以資料填入 Customer 物件屬性，並傳回陣列。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-148">The country value passed into the method is forwarded to a business layer class which in turn calls a data layer class to retrieve the data from the database, fill the Customer object properties with data and return the array.</span></span>

## <a name="using-the-scriptservice-attribute"></a><span data-ttu-id="0bd6c-149">使用 ScriptService 屬性</span><span class="sxs-lookup"><span data-stu-id="0bd6c-149">Using the ScriptService Attribute</span></span>

<span data-ttu-id="0bd6c-150">加入 WebMethod 屬性時，可讓用戶端呼叫 GetCustomersByCountry ( # A1 方法，以將標準的 SOAP 訊息傳送至 Web 服務，而不允許從現成的 ASP.NET AJAX 應用程式進行 JSON 呼叫。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-150">While adding the WebMethod attribute allows the GetCustomersByCountry() method to be called by clients that send standard SOAP messages to the Web Service, it doesn't allow JSON calls to be made from ASP.NET AJAX applications out of the box.</span></span> <span data-ttu-id="0bd6c-151">若要允許進行 JSON 呼叫，您必須將 ASP.NET AJAX 延伸模組的 `ScriptService` 屬性套用至 Web 服務類別。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-151">To allow JSON calls to be made you have to apply the ASP.NET AJAX Extension's `ScriptService` attribute to the Web Service class.</span></span> <span data-ttu-id="0bd6c-152">這可讓 Web 服務傳送使用 JSON 格式化的回應訊息，並允許用戶端腳本藉由傳送 JSON 訊息來呼叫服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-152">This enables a Web Service to send response messages formatted using JSON and allows client-side script to call a service by sending JSON messages.</span></span>

<span data-ttu-id="0bd6c-153">[清單 5] 顯示將 ScriptService 屬性套用至名為 CustomersService 的 Web 服務類別的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-153">Listing 5 shows an example of applying the ScriptService attribute to a Web Service class named CustomersService.</span></span>

<span data-ttu-id="0bd6c-154">**[清單 5]。使用 ScriptService 屬性來啟用 Web 服務的 AJAX**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-154">**Listing 5. Using the ScriptService Attribute to AJAX-enable a Web Service**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample5.cs)]

<span data-ttu-id="0bd6c-155">ScriptService 屬性會作為標記，表示可以從 AJAX 腳本呼叫它。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-155">The ScriptService attribute acts as a marker that indicates it can be called from AJAX script code.</span></span> <span data-ttu-id="0bd6c-156">它實際上不會處理幕後發生的任何 JSON 序列化或還原序列化工作。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-156">It doesn't actually handle any of the JSON serialization or deserialization tasks that occur behind the scenes.</span></span> <span data-ttu-id="0bd6c-157">web.config) 和其他相關類別中設定的 ScriptHandlerFactory (會執行大量的 JSON 處理。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-157">The ScriptHandlerFactory (configured in web.config) and other related classes do the bulk of JSON processing.</span></span>

## <a name="using-the-scriptmethod-attribute"></a><span data-ttu-id="0bd6c-158">使用 ScriptMethod 屬性</span><span class="sxs-lookup"><span data-stu-id="0bd6c-158">Using the ScriptMethod Attribute</span></span>

<span data-ttu-id="0bd6c-159">ScriptService 屬性是唯一必須在 .NET Web 服務中定義的 ASP.NET AJAX 屬性，以便 ASP.NET AJAX 頁面使用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-159">The ScriptService attribute is the only ASP.NET AJAX attribute that has to be defined in a .NET Web Service in order for it to be used by ASP.NET AJAX pages.</span></span> <span data-ttu-id="0bd6c-160">不過，另一個名為 ScriptMethod 的屬性也可以直接套用至服務中的 Web 方法。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-160">However, another attribute named ScriptMethod can also be applied directly to Web Methods in a service.</span></span> <span data-ttu-id="0bd6c-161">ScriptMethod 會定義三個屬性 `UseHttpGet` ，包括、 `ResponseFormat` 和 `XmlSerializeString` 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-161">ScriptMethod defines three properties including `UseHttpGet`, `ResponseFormat` and `XmlSerializeString`.</span></span> <span data-ttu-id="0bd6c-162">變更這些屬性的值，對於當 web 方法所接受的要求類型需要變更為 GET 時，如果 Web 方法需要以或物件的形式傳回未經處理的 XML 資料， `XmlDocument` `XmlElement` 或是從服務傳回的資料一律序列化為 XML 而非 JSON，則會很有用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-162">Changing the values of these properties can be useful in cases where the type of request accepted by a Web Method needs to be changed to GET, when a Web Method needs to return raw XML data in the form of an `XmlDocument` or `XmlElement` object or when data returned from a service should always be serialized as XML instead of JSON.</span></span>

<span data-ttu-id="0bd6c-163">當 Web 方法應該接受 GET 要求，而不是 POST 要求時，可以使用 UseHttpGet 屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-163">The UseHttpGet property can be used when a Web Method should accept GET requests as opposed to POST requests.</span></span> <span data-ttu-id="0bd6c-164">系統會使用 URL 來傳送要求，而 Web 方法輸入參數會轉換成 QueryString 參數。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-164">Requests are sent using a URL with Web Method input parameters converted to QueryString parameters.</span></span> <span data-ttu-id="0bd6c-165">UseHttpGet 屬性預設為 false，而且只有 `true` 在已知的作業是安全的，而且機密資料未傳遞至 Web 服務時，才會設定為。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-165">The UseHttpGet property defaults to false and should only be set to `true` when operations are known to be safe and when sensitive data is not passed to a Web Service.</span></span> <span data-ttu-id="0bd6c-166">[清單 6] 顯示使用 ScriptMethod 屬性搭配 UseHttpGet 屬性的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-166">Listing 6 shows an example of using the ScriptMethod attribute with the UseHttpGet property.</span></span>

<span data-ttu-id="0bd6c-167">**[清單 6]。搭配 UseHttpGet 屬性使用 ScriptMethod 屬性。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-167">**Listing 6. Using the ScriptMethod attribute with the UseHttpGet property.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample6.cs)]

<span data-ttu-id="0bd6c-168">接下來會顯示在 [清單 6] 中所示的 HttpGetEcho Web 方法所傳送的標頭範例：</span><span class="sxs-lookup"><span data-stu-id="0bd6c-168">An example of the headers sent when the HttpGetEcho Web Method shown in Listing 6 is called are shown next:</span></span>

`GET /CustomerViewer/DemoService.asmx/HttpGetEcho?input=%22Input Value%22 HTTP/1.1`

<span data-ttu-id="0bd6c-169">除了允許 Web 方法接受 HTTP GET 要求之外，當需要從服務（而非 JSON）傳回 XML 回應時，也可以使用 ScriptMethod 屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-169">In addition to allowing Web Methods to accept HTTP GET requests, the ScriptMethod attribute can also be used when XML responses need to be returned from a service rather than JSON.</span></span> <span data-ttu-id="0bd6c-170">例如，Web 服務可能會從遠端網站抓取 RSS 摘要，並將其傳回為 Xml 形式或 XmlElement 物件。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-170">For example, a Web Service may retrieve an RSS feed from a remote site and return it as an XmlDocument or XmlElement object.</span></span> <span data-ttu-id="0bd6c-171">接著，用戶端就可以處理 XML 資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-171">Processing of the XML data can then occur on the client.</span></span>

<span data-ttu-id="0bd6c-172">[清單 7] 顯示使用 ResponseFormat 屬性指定應該從 Web 方法傳回 XML 資料的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-172">Listing 7 shows an example of using the ResponseFormat property to specify that XML data should be returned from a Web Method.</span></span>

<span data-ttu-id="0bd6c-173">**[清單 7]。搭配 ResponseFormat 屬性使用 ScriptMethod 屬性。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-173">**Listing 7. Using the ScriptMethod attribute with the ResponseFormat property.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample7.cs)]

<span data-ttu-id="0bd6c-174">ResponseFormat 屬性也可以與 XmlSerializeString 屬性一起使用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-174">The ResponseFormat property can also be used along with the XmlSerializeString property.</span></span> <span data-ttu-id="0bd6c-175">XmlSerializeString 屬性的預設值為 false，表示當屬性設定為時，除了從 Web 方法傳回的字串以外的所有傳回類型都會序列化為 XML `ResponseFormat` `ResponseFormat.Xml` 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-175">The XmlSerializeString property has a default value of false which means that all return types except strings returned from a Web Method are serialized as XML when the `ResponseFormat` property is set to `ResponseFormat.Xml`.</span></span> <span data-ttu-id="0bd6c-176">當 `XmlSerializeString` 設定為時 `true` ，從 Web 方法傳回的所有類型都會序列化為包含字串類型的 XML。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-176">When `XmlSerializeString` is set to `true`, all types returned from a Web Method are serialized as XML including string types.</span></span> <span data-ttu-id="0bd6c-177">如果 ResponseFormat 屬性具有 XmlSerializeString 屬性的值， `ResponseFormat.Json` 則會忽略。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-177">If the ResponseFormat property has a value of `ResponseFormat.Json` the XmlSerializeString property is ignored.</span></span>

<span data-ttu-id="0bd6c-178">[清單 8] 顯示使用 XmlSerializeString 屬性強制將字串序列化為 XML 的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-178">Listing 8 shows an example of using the XmlSerializeString property to force strings to be serialized as XML.</span></span>

<span data-ttu-id="0bd6c-179">**[清單 8]。搭配 XmlSerializeString 屬性使用 ScriptMethod 屬性**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-179">**Listing 8. Using the ScriptMethod attribute with the XmlSerializeString property**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample8.cs)]

<span data-ttu-id="0bd6c-180">從呼叫 [清單 8] 所示的 GetXmlString Web 方法傳回的值如下所示：</span><span class="sxs-lookup"><span data-stu-id="0bd6c-180">The value returned from calling the GetXmlString Web Method shown in Listing 8 is shown next:</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample9.cs)]

<span data-ttu-id="0bd6c-181">雖然預設的 JSON 格式會將要求和回應訊息的整體大小降至最低，而且 ASP.NET AJAX 用戶端更容易使用跨瀏覽器的方式，但當 Internet Explorer 5 或更高版本的用戶端應用程式需要從 Web 方法傳回 XML 資料時，可以使用 ResponseFormat 和 XmlSerializeString 屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-181">Although the default JSON format minimizes the overall size of request and response messages and is more readily consumed by ASP.NET AJAX clients in a cross-browser manner, the ResponseFormat and XmlSerializeString properties can be utilized when client applications such as Internet Explorer 5 or higher expect XML data to be returned from a Web Method.</span></span>

## <a name="working-with-complex-types"></a><span data-ttu-id="0bd6c-182">使用複雜類型</span><span class="sxs-lookup"><span data-stu-id="0bd6c-182">Working with Complex Types</span></span>

<span data-ttu-id="0bd6c-183">[清單 5] 顯示的範例會從 Web 服務傳回名為 Customer 的複雜型別。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-183">Listing 5 showed an example of returning a complex type named Customer from a Web Service.</span></span> <span data-ttu-id="0bd6c-184">Customer 類別會在內部定義數個不同的簡單類型做為屬性（例如 FirstName 和 LastName）。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-184">The Customer class defines several different simple types internally as properties such as FirstName and LastName.</span></span> <span data-ttu-id="0bd6c-185">在啟用 AJAX 的 Web 方法上做為輸入參數或傳回類型的複雜類型，會在傳送至用戶端之前自動序列化為 JSON。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-185">Complex types used as an input parameter or return type on an AJAX-enabled Web Method are automatically serialized into JSON before being sent to the client-side.</span></span> <span data-ttu-id="0bd6c-186">不過，內部部署的複雜類型 (在另一個類型內定義的) 不會做為獨立物件提供給用戶端使用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-186">However, nested complex types (those defined internally within another type) are not made available to the client as standalone objects by default.</span></span>

<span data-ttu-id="0bd6c-187">如果 Web 服務所使用的嵌套複雜型別也必須在用戶端頁面中使用，則可以將 ASP.NET AJAX GenerateScriptType 屬性新增至 Web 服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-187">In cases where a nested complex type used by a Web Service must also be used in a client page, the ASP.NET AJAX GenerateScriptType attribute can be added to the Web Service.</span></span> <span data-ttu-id="0bd6c-188">例如，[清單 9] 中顯示的 CustomerDetails 類別包含***代表嵌套複雜類型***的位址和性別屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-188">For example, the CustomerDetails class shown in Listing 9 contains Address and Gender properties which ***represent nested complex types.***</span></span>

<span data-ttu-id="0bd6c-189">**[清單 9]。此處顯示的 CustomerDetails 類別包含兩個嵌套的複雜類型。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-189">**Listing 9. The CustomerDetails class shown here contains two nested complex types.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample10.cs)]

<span data-ttu-id="0bd6c-190">在 [清單 9] 所示的 CustomerDetails 類別中定義的位址和性別物件，將不會自動提供給用戶端透過 JavaScript 使用，因為它們是巢狀型別 (位址是類別，而性別則是列舉) 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-190">The Address and Gender objects defined within the CustomerDetails class shown in Listing 9 won't automatically be made available for use on the client-side via JavaScript since they are nested types (Address is a class and Gender is an enumeration).</span></span> <span data-ttu-id="0bd6c-191">在 Web 服務內使用的嵌套型別必須可在用戶端上使用的情況下，您可以使用稍早所述的 GenerateScriptType 屬性 (參閱清單 10) 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-191">In situations where a nested type used within a Web Service must be available on the client-side, the GenerateScriptType attribute mentioned earlier can be used (see Listing 10).</span></span> <span data-ttu-id="0bd6c-192">當從服務傳回不同的嵌套複雜型別時，可以多次加入這個屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-192">This attribute can be added multiple times in cases where different nested complex types are returned from a service.</span></span> <span data-ttu-id="0bd6c-193">它可以直接套用至 Web 服務類別或特定的 Web 方法。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-193">It can be applied directly to the Web Service class or above specific Web Methods.</span></span>

<span data-ttu-id="0bd6c-194">**[清單 10]。使用 GenerateScriptService 屬性來定義應該可供用戶端使用的巢狀型別。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-194">**Listing 10. Using the GenerateScriptService attribute to define nested types that should be available to the client.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample11.cs)]

<span data-ttu-id="0bd6c-195">藉由將 `GenerateScriptType` 屬性套用至 Web 服務，位址和性別類型將會自動提供給用戶端 ASP.NET AJAX JavaScript 程式碼使用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-195">By applying the `GenerateScriptType` attribute to the Web Service, the Address and Gender types will automatically be made available for use by client-side ASP.NET AJAX JavaScript code.</span></span> <span data-ttu-id="0bd6c-196">在 Web 服務上新增 GenerateScriptType 屬性會自動產生並傳送至用戶端的 JavaScript 範例，如 [清單 11] 所示。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-196">An example of the JavaScript that is automatically generated and sent to the client by adding the GenerateScriptType attribute on a Web Service is shown in Listing 11.</span></span> <span data-ttu-id="0bd6c-197">您會在本文稍後看到如何使用嵌套的複雜類型。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-197">You'll see how to use nested complex types later in the article.</span></span>

<span data-ttu-id="0bd6c-198">**[清單 11]可供 ASP.NET AJAX 頁面使用的嵌套複雜型別。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-198">**Listing 11. Nested complex types made available to an ASP.NET AJAX page.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample12.cs)]

<span data-ttu-id="0bd6c-199">既然您已瞭解如何建立 Web 服務，並讓它們可供 ASP.NET AJAX 頁面，讓我們看看如何建立和使用 JavaScript proxy，以便資料可以抓取或傳送至 Web 服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-199">Now that you've seen how to create Web Services and make them accessible to ASP.NET AJAX pages, let's take a look at how to create and use JavaScript proxies so that data can be retrieved or sent to Web Services.</span></span>

## <a name="creating-javascript-proxies"></a><span data-ttu-id="0bd6c-200">建立 JavaScript proxy</span><span class="sxs-lookup"><span data-stu-id="0bd6c-200">Creating JavaScript Proxies</span></span>

<span data-ttu-id="0bd6c-201"> ( .NET 或另一個) 平臺呼叫標準 Web 服務時，通常會牽涉到建立 proxy 物件，讓您免于傳送 SOAP 要求和回應訊息的複雜性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-201">Calling a standard Web Service (.NET or another platform) typically involves creating a proxy object that shields you from the complexities of sending SOAP request and response messages.</span></span> <span data-ttu-id="0bd6c-202">有了 ASP.NET AJAX Web 服務呼叫，您就可以建立 JavaScript proxy 並用來輕鬆地呼叫服務，而不必擔心序列化和還原序列化 JSON 訊息。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-202">With ASP.NET AJAX Web Service calls, JavaScript proxies can be created and used to easily call services without worrying about serializing and deserializing JSON messages.</span></span> <span data-ttu-id="0bd6c-203">您可以使用 ASP.NET AJAX ScriptManager 控制項自動產生 JavaScript proxy。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-203">JavaScript proxies can be automatically generated by using the ASP.NET AJAX ScriptManager control.</span></span>

<span data-ttu-id="0bd6c-204">建立可呼叫 Web 服務的 JavaScript proxy 是使用 ScriptManager 的服務屬性來完成。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-204">Creating a JavaScript proxy that can call Web Services is accomplished by using the ScriptManager's Services property.</span></span> <span data-ttu-id="0bd6c-205">這個屬性可讓您定義一個或多個服務，ASP.NET AJAX 頁面可以透過非同步方式呼叫來傳送或接收資料，而不需要回傳作業。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-205">This property allows you to define one or more services that an ASP.NET AJAX page can call asynchronously to send or receive data without requiring postback operations.</span></span> <span data-ttu-id="0bd6c-206">您可以使用 ASP.NET AJAX 控制項來定義服務 `ServiceReference` ，並將 Web 服務 URL 指派給控制項的 `Path` 屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-206">You define a service by using the ASP.NET AJAX `ServiceReference` control and assigning the Web Service URL to the control's `Path` property.</span></span> <span data-ttu-id="0bd6c-207">[清單 12] 顯示參考名為 CustomersService 之服務的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-207">Listing 12 shows an example of referencing a service named CustomersService.asmx.</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample13.aspx)]

<span data-ttu-id="0bd6c-208">**[清單 12]定義在 ASP.NET AJAX 頁面中使用的 Web 服務。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-208">**Listing 12. Defining a Web Service used in an ASP.NET AJAX page.**</span></span>

<span data-ttu-id="0bd6c-209">透過 ScriptManager 控制項加入 CustomersService 的參考，會使 JavaScript proxy 動態產生並由頁面參考。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-209">Adding a reference to the CustomersService.asmx through the ScriptManager control causes a JavaScript proxy to be dynamically generated and referenced by the page.</span></span> <span data-ttu-id="0bd6c-210">Proxy 是使用 &lt; 腳本 &gt; 標記內嵌，並藉由呼叫 CustomersService 並以動態方式載入，並將/js 附加至它的結尾。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-210">The proxy is embedded by using the &lt;script&gt; tag and dynamically loaded by calling the CustomersService.asmx file and appending /js to the end of it.</span></span> <span data-ttu-id="0bd6c-211">下列範例顯示在 web.config 中停用了調試功能時，如何將 JavaScript proxy 內嵌在頁面中：</span><span class="sxs-lookup"><span data-stu-id="0bd6c-211">The following example shows how the JavaScript proxy is embedded in the page when debugging is disabled in web.config:</span></span>

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample14.html)]

> <span data-ttu-id="0bd6c-212">*>[!NOTE]如果您想要查看產生的實際 JavaScript proxy 程式碼，您可以在 Internet Explorer 的 [位址] 方塊中輸入所需 .Net Web 服務的 URL，並將/js 附加至它的結尾。*</span><span class="sxs-lookup"><span data-stu-id="0bd6c-212">*> [!NOTE] If you'd like to see the actual JavaScript proxy code that is generated you can type the URL to the desired .NET Web Service into Internet Explorer's address box and append /js to the end of it.*</span></span>

<span data-ttu-id="0bd6c-213">如果已在中啟用調試 web.config 則 JavaScript proxy 的 debug 版本將會內嵌在頁面中，如下所示：</span><span class="sxs-lookup"><span data-stu-id="0bd6c-213">If debugging is enabled in web.config a debug version of the JavaScript proxy will be embedded in the page as shown next:</span></span>

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample15.html)]

<span data-ttu-id="0bd6c-214">ScriptManager 所建立的 JavaScript proxy 也可以直接內嵌在頁面中，而不是使用 &lt; 腳本 &gt; 標記的 src 屬性來參考。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-214">The JavaScript proxy created by the ScriptManager can also be embedded directly into the page rather than referenced using the &lt;script&gt; tag's src attribute.</span></span> <span data-ttu-id="0bd6c-215">這可以藉由將 ServiceReference 控制項的 InlineScript 屬性設為 true 來完成， (預設值為 false) 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-215">This can be done by setting the ServiceReference control's InlineScript property to true (the default is false).</span></span> <span data-ttu-id="0bd6c-216">當 proxy 不是跨多個頁面共用，而且您想要減少對伺服器所做的網路呼叫數時，這會很有用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-216">This can be useful when a proxy isn't shared across multiple pages and when you'd like to reduce the number of network calls made to the server.</span></span> <span data-ttu-id="0bd6c-217">當 InlineScript 設定為 true 時，瀏覽器將不會快取 proxy 腳本，因此，在 ASP.NET AJAX 應用程式中的多個頁面使用 proxy 的情況下，建議您使用預設值 false。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-217">When InlineScript is set to true the proxy script won't be cached by the browser so the default value of false is recommended in cases where the proxy is used by multiple pages in an ASP.NET AJAX application.</span></span> <span data-ttu-id="0bd6c-218">以下顯示使用 InlineScript 屬性的範例：</span><span class="sxs-lookup"><span data-stu-id="0bd6c-218">An example of using the InlineScript property is shown next:</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample16.aspx)]

## <a name="using-javascript-proxies"></a><span data-ttu-id="0bd6c-219">使用 JavaScript proxy</span><span class="sxs-lookup"><span data-stu-id="0bd6c-219">Using JavaScript Proxies</span></span>

<span data-ttu-id="0bd6c-220">一旦使用 ScriptManager 控制項的 ASP.NET AJAX 頁面參考 Web 服務，就可以對 Web 服務進行呼叫，而傳回的資料則可使用回呼函數來處理。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-220">Once a Web Service is referenced by an ASP.NET AJAX page using the ScriptManager control, a call can be made to the Web Service and the returned data can be handled using callback functions.</span></span> <span data-ttu-id="0bd6c-221">Web 服務的呼叫方式是參考其命名空間， (如果存在) 、類別名稱和 Web 方法名稱。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-221">A Web Service is called by referencing its namespace (if one exists), class name and Web Method name.</span></span> <span data-ttu-id="0bd6c-222">傳遞至 Web 服務的任何參數都可以與處理傳回資料的回呼函數一起定義。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-222">Any parameters passed to the Web Service can be defined along with a callback function that handles the returned data.</span></span>

<span data-ttu-id="0bd6c-223">如需使用 JavaScript proxy 呼叫名為 GetCustomersByCountry 之 Web 方法的範例，請 ( # A1，如 [清單 13] 所示。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-223">An example of using a JavaScript proxy to call a Web Method named GetCustomersByCountry() is shown in Listing 13.</span></span> <span data-ttu-id="0bd6c-224">當終端使用者按一下頁面上的按鈕時，會呼叫 GetCustomersByCountry ( # A1 函式。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-224">The GetCustomersByCountry() function is called when an end user clicks a button on the page.</span></span>

<span data-ttu-id="0bd6c-225">**[清單 13]。使用 JavaScript proxy 呼叫 Web 服務。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-225">**Listing 13. Calling a Web Service with a JavaScript proxy.**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample17.js)]

<span data-ttu-id="0bd6c-226">此呼叫會參考服務中定義的 InterfaceTraining 命名空間、CustomersService 類別和 GetCustomersByCountry Web 方法。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-226">This call references the InterfaceTraining namespace, CustomersService class and GetCustomersByCountry Web Method defined in the service.</span></span> <span data-ttu-id="0bd6c-227">它會傳遞從 textbox 取得的國家（地區）值，以及名為 OnWSRequestComplete 的回呼函式，該函式應該在非同步 Web 服務呼叫傳回時叫用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-227">It passes a country value obtained from a textbox as well as a callback function named OnWSRequestComplete that should be invoked when the asynchronous Web Service call returns.</span></span> <span data-ttu-id="0bd6c-228">OnWSRequestComplete 會處理從服務傳回的 Customer 物件陣列，並將其轉換成頁面中顯示的資料表。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-228">OnWSRequestComplete handles the array of Customer objects returned from the service and converts them into a table that is displayed in the page.</span></span> <span data-ttu-id="0bd6c-229">從呼叫產生的輸出會顯示在 [圖 1] 中。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-229">The output generated from the call is shown in Figure 1.</span></span>

<span data-ttu-id="0bd6c-230">[![藉由對 Web 服務進行非同步 AJAX 呼叫來取得系結的資料。](understanding-asp-net-ajax-web-services/_static/image2.png)](understanding-asp-net-ajax-web-services/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0bd6c-230">[![Binding data obtained by making an asynchronous AJAX call to a Web Service.](understanding-asp-net-ajax-web-services/_static/image2.png)](understanding-asp-net-ajax-web-services/_static/image1.png)</span></span>

<span data-ttu-id="0bd6c-231">**圖 1**：透過對 Web 服務進行非同步 AJAX 呼叫來取得系結的資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-231">**Figure 1**: Binding data obtained by making an asynchronous AJAX call to a Web Service.</span></span>  <span data-ttu-id="0bd6c-232"> ([按一下以查看完整大小的影像](understanding-asp-net-ajax-web-services/_static/image3.png)) </span><span class="sxs-lookup"><span data-stu-id="0bd6c-232">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image3.png))</span></span>

<span data-ttu-id="0bd6c-233">JavaScript proxy 也可以對 Web 服務進行單向呼叫，以便在應該呼叫 Web 方法但 proxy 不應等候回應的情況下進行。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-233">JavaScript proxies can also make one-way calls to Web Services in cases where a Web Method should be called but the proxy shouldn't wait for a response.</span></span> <span data-ttu-id="0bd6c-234">例如，您可能會想要呼叫 Web 服務來啟動工作流程之類的進程，但不等候來自服務的傳回值。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-234">For example, you may want to call a Web Service to start a process such as a work-flow but not wait for a return value from the service.</span></span> <span data-ttu-id="0bd6c-235">在需要對服務進行單向呼叫的情況下，可以直接省略 [清單 13] 中所示的回呼函數。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-235">In cases where a one-way call needs to be made to a service, the callback function shown in Listing 13 can simply be omitted.</span></span> <span data-ttu-id="0bd6c-236">因為未定義回呼函式，所以 proxy 物件不會等待 Web 服務傳回資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-236">Since no callback function is defined the proxy object will not wait for the Web Service to return data.</span></span>

## <a name="handling-errors"></a><span data-ttu-id="0bd6c-237">處理錯誤</span><span class="sxs-lookup"><span data-stu-id="0bd6c-237">Handling Errors</span></span>

<span data-ttu-id="0bd6c-238">對 Web 服務的非同步回呼可能會遇到不同類型的錯誤，例如網路關閉、Web 服務無法使用或傳回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-238">Asynchronous callbacks to Web Services can encounter different types of errors such as the network being down, the Web Service being unavailable or an exception being returned.</span></span> <span data-ttu-id="0bd6c-239">幸運的是，ScriptManager 所產生的 JavaScript proxy 物件允許定義多個回呼來處理錯誤和失敗，以及稍早所示的成功回呼。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-239">Fortunately, JavaScript proxy objects generated by the ScriptManager allow multiple callbacks to be defined to handle errors and failures in addition to the success callback shown earlier.</span></span> <span data-ttu-id="0bd6c-240">您可以在呼叫 Web 方法之後，立即定義錯誤回呼函式，如 [清單 14] 所示。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-240">An error callback function can be defined immediately after the standard callback function in the call to the Web Method as shown in Listing 14.</span></span>

<span data-ttu-id="0bd6c-241">**[清單 14]。定義錯誤回呼函數並顯示錯誤。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-241">**Listing 14. Defining an error callback function and displaying errors.**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample18.js)]

<span data-ttu-id="0bd6c-242">呼叫 Web 服務時所發生的任何錯誤將會觸發 OnWSRequestFailed ( # A1 回呼函式，以接受代表錯誤的物件做為參數。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-242">Any errors that occur when the Web Service is called will trigger the OnWSRequestFailed() callback function to be called which accepts an object representing the error as a parameter.</span></span> <span data-ttu-id="0bd6c-243">錯誤物件會公開數個不同的函式，以判斷錯誤的原因，以及呼叫是否已超時。[清單 14] 顯示使用不同錯誤函式的範例，[圖 2] 顯示了函式所產生的輸出範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-243">The error object exposes several different functions to determine the cause of the error as well as whether or not the call timed out. Listing 14 shows an example of using the different error functions and Figure 2 shows an example of the output generated by the functions.</span></span>

<span data-ttu-id="0bd6c-244">[![呼叫 ASP.NET AJAX error 函數所產生的輸出。](understanding-asp-net-ajax-web-services/_static/image5.png)](understanding-asp-net-ajax-web-services/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0bd6c-244">[![Output generated by calling ASP.NET AJAX error functions.](understanding-asp-net-ajax-web-services/_static/image5.png)](understanding-asp-net-ajax-web-services/_static/image4.png)</span></span>

<span data-ttu-id="0bd6c-245">**圖 2**：藉由呼叫 ASP.NET AJAX error 函式所產生的輸出。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-245">**Figure 2**: Output generated by calling ASP.NET AJAX error functions.</span></span>  <span data-ttu-id="0bd6c-246"> ([按一下以查看完整大小的影像](understanding-asp-net-ajax-web-services/_static/image6.png)) </span><span class="sxs-lookup"><span data-stu-id="0bd6c-246">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image6.png))</span></span>

## <a name="handling-xml-data-returned-from-a-web-service"></a><span data-ttu-id="0bd6c-247">處理從 Web 服務傳回的 XML 資料</span><span class="sxs-lookup"><span data-stu-id="0bd6c-247">Handling XML Data Returned from a Web Service</span></span>

<span data-ttu-id="0bd6c-248">您先前已看到 Web 方法如何使用 ScriptMethod 屬性及其 ResponseFormat 屬性來傳回原始 XML 資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-248">Earlier you saw how a Web Method could return raw XML data by using the ScriptMethod attribute along with its ResponseFormat property.</span></span> <span data-ttu-id="0bd6c-249">當 ResponseFormat 設定為 ResponseFormat.Xml 時，從 Web 服務傳回的資料會序列化為 XML，而不是 JSON。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-249">When ResponseFormat is set to ResponseFormat.Xml, data returned from the Web Service is serialized as XML rather than JSON.</span></span> <span data-ttu-id="0bd6c-250">當 XML 資料需要直接傳遞給用戶端以使用 JavaScript 或 XSLT 進行處理時，這會很有用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-250">This can be useful when XML data needs to be passed directly to the client for processing using JavaScript or XSLT.</span></span> <span data-ttu-id="0bd6c-251">目前，Internet Explorer 5 或更新版本提供最佳的用戶端物件模型，可用於剖析和篩選 XML 資料，因為它內建的 MSXML 支援。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-251">At the current time, Internet Explorer 5 or higher provides the best client-side object model for parsing and filtering XML data due to its built-in support for MSXML.</span></span>

<span data-ttu-id="0bd6c-252">從 Web 服務抓取 XML 資料與抓取其他資料類型並無不同。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-252">Retrieving XML data from a Web Service is no different than retrieving other data types.</span></span> <span data-ttu-id="0bd6c-253">一開始先叫用 JavaScript proxy 呼叫適當的函式，並定義回呼函數。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-253">Start by invoking the JavaScript proxy to call the appropriate function and define a callback function.</span></span> <span data-ttu-id="0bd6c-254">一旦呼叫傳回之後，您就可以處理回呼函數中的資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-254">Once the call returns you can then process the data in the callback function.</span></span>

<span data-ttu-id="0bd6c-255">[清單 15] 顯示的範例會呼叫名為 GetRssFeed 的 Web 方法， ( # A1 會傳回 XmlElement 物件。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-255">Listing 15 shows an example of calling a Web Method named GetRssFeed() that returns an XmlElement object.</span></span> <span data-ttu-id="0bd6c-256">GetRssFeed ( # A1 接受單一參數，代表要取得之 RSS 摘要的 URL。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-256">GetRssFeed() accepts a single parameter representing the URL for the RSS feed to retrieve.</span></span>

<span data-ttu-id="0bd6c-257">**[清單 15]使用從 Web 服務傳回的 XML 資料。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-257">**Listing 15. Working with XML data returned from a Web Service.**</span></span>

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample19.html)]

<span data-ttu-id="0bd6c-258">這個範例會將 URL 傳遞至 RSS 摘要，並處理 OnWSRequestComplete ( # A1 函數中傳回的 XML 資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-258">This example passes a URL to an RSS feed and processes the returned XML data in the OnWSRequestComplete() function.</span></span> <span data-ttu-id="0bd6c-259">OnWSRequestComplete ( # A1 會先檢查瀏覽器是否為 Internet Explorer，以瞭解 MSXML 剖析器是否可供使用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-259">OnWSRequestComplete() first checks to see if the browser is Internet Explorer to know whether or not the MSXML parser is available.</span></span> <span data-ttu-id="0bd6c-260">如果是，就會使用 XPath 語句來尋找 RSS 摘要 &lt; &gt; 中的所有專案標記。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-260">If it is, an XPath statement is used to locate all &lt;item&gt; tags within the RSS feed.</span></span> <span data-ttu-id="0bd6c-261">然後會逐一查看每個專案，並 &lt; 找出並處理相關聯的標題 &gt; 和 &lt; 連結 &gt; 標記，以顯示每個專案的資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-261">Each item is then iterated through and the associated &lt;title&gt; and &lt;link&gt; tags are located and processed to display each item's data.</span></span> <span data-ttu-id="0bd6c-262">[圖 3] 顯示透過 JavaScript proxy 對 GetRssFeed ( # A1 Web 方法進行 ASP.NET AJAX 呼叫所產生的輸出範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-262">Figure 3 shows an example of the output generated from making an ASP.NET AJAX call through a JavaScript proxy to the GetRssFeed() Web Method.</span></span>

## <a name="handling-complex-types"></a><span data-ttu-id="0bd6c-263">處理複雜類型</span><span class="sxs-lookup"><span data-stu-id="0bd6c-263">Handling Complex Types</span></span>

<span data-ttu-id="0bd6c-264">Web 服務接受或傳回的複雜類型會透過 JavaScript proxy 自動公開。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-264">Complex types accepted or returned by a Web Service are automatically exposed through a JavaScript proxy.</span></span> <span data-ttu-id="0bd6c-265">不過，除非已將 GenerateScriptType 屬性套用至服務（如先前所述），否則用戶端無法直接存取嵌套的複雜類型。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-265">However, nested complex types are not directly accessible on the client-side unless the GenerateScriptType attribute is applied to the service as discussed earlier.</span></span> <span data-ttu-id="0bd6c-266">為什麼您要在用戶端上使用嵌套複雜型別？</span><span class="sxs-lookup"><span data-stu-id="0bd6c-266">Why would you want to use a nested complex type on the client-side?</span></span>

<span data-ttu-id="0bd6c-267">若要回答這個問題，請假設 ASP.NET AJAX 頁面顯示客戶資料，並允許使用者更新客戶的位址。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-267">To answer this question, assume that an ASP.NET AJAX page displays customer data and allows end users to update a customer's address.</span></span> <span data-ttu-id="0bd6c-268">如果 Web 服務指定的網址類別型 (在 CustomerDetails 類別內定義的複雜類型) 可以傳送至用戶端，則更新程式可以分割成不同的函式，以更有效率地重複使用程式碼。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-268">If the Web Service specifies that the Address type (a complex type defined within a CustomerDetails class) can be sent to the client then the update process can be divided into separate functions for better code re-use.</span></span>

<span data-ttu-id="0bd6c-269">[![從呼叫傳回 RSS 資料的 Web 服務建立的輸出。](understanding-asp-net-ajax-web-services/_static/image8.png)](understanding-asp-net-ajax-web-services/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0bd6c-269">[![Output creating from calling a Web Service that returns RSS data.](understanding-asp-net-ajax-web-services/_static/image8.png)](understanding-asp-net-ajax-web-services/_static/image7.png)</span></span>

<span data-ttu-id="0bd6c-270">**圖 3**：從呼叫傳回 RSS 資料的 Web 服務所建立的輸出。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-270">**Figure 3**: Output creating from calling a Web Service that returns RSS data.</span></span>  <span data-ttu-id="0bd6c-271"> ([按一下以查看完整大小的影像](understanding-asp-net-ajax-web-services/_static/image9.png)) </span><span class="sxs-lookup"><span data-stu-id="0bd6c-271">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image9.png))</span></span>

<span data-ttu-id="0bd6c-272">[清單 16] 顯示用戶端程式代碼的範例，其會叫用在模型命名空間中定義的位址物件、將更新的資料填滿，並將其指派給 CustomerDetails 物件的位址屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-272">Listing 16 shows an example of client-side code that invokes an Address object defined in a Model namespace, fills it with updated data and assigns it to a CustomerDetails object's Address property.</span></span> <span data-ttu-id="0bd6c-273">接著，CustomerDetails 物件會傳遞至 Web 服務進行處理。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-273">The CustomerDetails object is then passed to the Web Service for processing.</span></span>

<span data-ttu-id="0bd6c-274">**[清單 16]。使用嵌套的複雜類型**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-274">**Listing 16. Using nested complex types**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample20.js)]

## <a name="creating-and-using-page-methods"></a><span data-ttu-id="0bd6c-275">建立和使用頁面方法</span><span class="sxs-lookup"><span data-stu-id="0bd6c-275">Creating and Using Page Methods</span></span>

<span data-ttu-id="0bd6c-276">Web 服務提供一種絕佳的方式，將可重複使用的服務公開給各種用戶端，包括 ASP.NET AJAX 頁面。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-276">Web Services provide an excellent way to expose re-useable services to a variety of clients including ASP.NET AJAX pages.</span></span> <span data-ttu-id="0bd6c-277">不過，在某些情況下，頁面可能需要捕獲其他頁面不會使用或共用的資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-277">However, there may be cases where a page needs to retrieve data that won't ever be used or shared by other pages.</span></span> <span data-ttu-id="0bd6c-278">在此情況下，建立 .asmx 檔案以允許頁面存取資料看起來可能像是大材小用，因為服務僅供單一頁面使用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-278">In this case, making an .asmx file to allow the page to access the data may seem like overkill since the service is only used by a single page.</span></span>

<span data-ttu-id="0bd6c-279">ASP.NET AJAX 提供另一種機制來進行類似 Web 服務的呼叫，而不需要建立獨立的 .asmx 檔案。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-279">ASP.NET AJAX provides another mechanism for making Web Service-like calls without creating standalone .asmx files.</span></span> <span data-ttu-id="0bd6c-280">這是藉由使用稱為「頁面方法」的技術來完成。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-280">This is done by using a technique referred to as "page methods".</span></span> <span data-ttu-id="0bd6c-281">頁面方法是靜態 (共用在 VB.NET) 方法中，直接內嵌在頁面或程式碼除外的檔案中，該檔案會套用 WebMethod 屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-281">Page methods are static (shared in VB.NET) methods embedded directly in a page or code-beside file that have the WebMethod attribute applied to them.</span></span> <span data-ttu-id="0bd6c-282">藉由套用 WebMethod 屬性，可以使用名為 PageMethods 的特殊 JavaScript 物件來呼叫它們，以在執行時間動態建立。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-282">By applying the WebMethod attribute they can be called using a special JavaScript object named PageMethods that gets dynamically created at runtime.</span></span> <span data-ttu-id="0bd6c-283">PageMethods 物件會作為 proxy，讓您免于 JSON 序列化/還原序列化程式。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-283">The PageMethods object acts as a proxy that shields you from the JSON serialization/deserialization process.</span></span> <span data-ttu-id="0bd6c-284">請注意，為了使用 PageMethods 物件，您必須將 ScriptManager 的 EnablePageMethods 屬性設定為 true。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-284">Note that in order to use the PageMethods object you must set the ScriptManager's EnablePageMethods property to true.</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample21.aspx)]

<span data-ttu-id="0bd6c-285">[清單 17] 顯示在 ASP.NET 程式碼旁邊的類別中定義兩個頁面方法的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-285">Listing 17 shows an example of defining two page methods in an ASP.NET code-beside class.</span></span> <span data-ttu-id="0bd6c-286">這些方法會從位於網站的應用程式 Code 資料夾中的商務層類別取得資料 \_ 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-286">These methods retrieve data from a business layer class located in the App\_Code folder of the Website.</span></span>

<span data-ttu-id="0bd6c-287">**[清單 17]定義頁面方法。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-287">**Listing 17. Defining page methods.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample22.cs)]

<span data-ttu-id="0bd6c-288">當 ScriptManager 偵測到頁面中出現 Web 方法時，它會產生稍早所述 PageMethods 物件的動態參考。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-288">When ScriptManager detects the presence of Web Methods in the page it generates a dynamic reference to the PageMethods object mentioned earlier.</span></span> <span data-ttu-id="0bd6c-289">呼叫 Web 方法的方式是參考 PageMethods 類別，後面接著方法的名稱以及應該傳遞的任何必要參數資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-289">Calling a Web Method is accomplished by referencing the PageMethods class followed by the name of the method and any necessary parameter data that should be passed.</span></span> <span data-ttu-id="0bd6c-290">[清單 18] 顯示呼叫稍早所示之兩頁方法的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-290">Listing 18 shows examples of calling the two page methods shown earlier.</span></span>

<span data-ttu-id="0bd6c-291">**[清單 18]。使用 PageMethods JavaScript 物件呼叫頁面方法。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-291">**Listing 18. Calling page methods with the PageMethods JavaScript object.**</span></span>

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample23.js)]

<span data-ttu-id="0bd6c-292">使用 PageMethods 物件與使用 JavaScript proxy 物件非常類似。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-292">Using the PageMethods object is very similar to using a JavaScript proxy object.</span></span> <span data-ttu-id="0bd6c-293">您必須先指定應傳遞至頁面方法的所有參數資料，然後定義非同步呼叫傳回時應該呼叫的回呼函式。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-293">You first specify all of the parameter data that should be passed to the page method and then define the callback function that should be called when the asynchronous call returns.</span></span> <span data-ttu-id="0bd6c-294">也可以指定失敗回呼 (如需處理失敗) 範例，請參閱 [清單 14]。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-294">A failure callback can also be specified (refer to Listing 14 for an example of handling failures).</span></span>

## <a name="the-autocompleteextender-and-the-aspnet-ajax-toolkit"></a><span data-ttu-id="0bd6c-295">AutoCompleteExtender 和 ASP.NET AJAX 工具組</span><span class="sxs-lookup"><span data-stu-id="0bd6c-295">The AutoCompleteExtender and the ASP.NET AJAX Toolkit</span></span>

<span data-ttu-id="0bd6c-296">從) 提供的 ASP.NET AJAX 工具組 ([http://ajax.asp.net](http://ajax.asp.net) 提供數個可用於存取 Web 服務的控制項。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-296">The ASP.NET AJAX Toolkit (available from [http://ajax.asp.net](http://ajax.asp.net)) offers several controls that can be used to access Web Services.</span></span> <span data-ttu-id="0bd6c-297">具體而言，此工具組包含名為的實用控制項， `AutoCompleteExtender` 可用來呼叫 Web 服務並在頁面中顯示資料，而不需要撰寫任何 JavaScript 程式碼。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-297">Specifically, the toolkit contains a useful control named `AutoCompleteExtender` that can be used to call Web Services and show data in pages without writing any JavaScript code at all.</span></span>

<span data-ttu-id="0bd6c-298">AutoCompleteExtender 控制項可用來擴充 textbox 的現有功能，並協助使用者更輕鬆地找出所需的資料。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-298">The AutoCompleteExtender control can be used to extend existing functionality of a textbox and help users more easily locate data they're looking for.</span></span> <span data-ttu-id="0bd6c-299">當他們輸入文字方塊時，可以使用控制項來查詢 Web 服務，並以動態方式在文字方塊下方顯示結果。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-299">As they type into a textbox the control can be used to query a Web Service and shows results below the textbox dynamically.</span></span> <span data-ttu-id="0bd6c-300">[圖 4] 顯示使用 AutoCompleteExtender 控制項來顯示支援應用程式之客戶識別碼的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-300">Figure 4 shows an example of using the AutoCompleteExtender control to display customer ids for a support application.</span></span> <span data-ttu-id="0bd6c-301">當使用者在文字方塊中輸入不同的字元時，會根據其輸入在其底下顯示不同的專案。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-301">As the user types different characters into the textbox, different items will be shown below it based upon their input.</span></span> <span data-ttu-id="0bd6c-302">然後，使用者可以選取所需的客戶識別碼。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-302">Users can then select the desired customer id.</span></span>

<span data-ttu-id="0bd6c-303">在 ASP.NET AJAX 頁面中使用 AutoCompleteExtender，需要將 AjaxControlToolkit.dll 元件新增至網站的 bin 資料夾。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-303">Using the AutoCompleteExtender within an ASP.NET AJAX page requires that the AjaxControlToolkit.dll assembly be added to the Website's bin folder.</span></span> <span data-ttu-id="0bd6c-304">新增工具組元件之後，您會想要在 web.config 中加以參考，讓應用程式中的所有頁面都可以使用它所包含的控制項。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-304">Once the toolkit assembly has been added, you'll want to reference it in web.config so that the controls it contains are available to all pages in an application.</span></span> <span data-ttu-id="0bd6c-305">這可以藉由在 web.config 的 controls 標記內新增下列標記來完成 &lt; &gt; ：</span><span class="sxs-lookup"><span data-stu-id="0bd6c-305">This can be done by adding the following tag within web.config's &lt;controls&gt; tag:</span></span>

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample24.xml)]

<span data-ttu-id="0bd6c-306">在您只需要在特定頁面中使用控制項的情況下，您可以將 Reference 指示詞加入至頁面的頂端，而不是更新 web.config 來參考它：</span><span class="sxs-lookup"><span data-stu-id="0bd6c-306">In cases where you only need to use the control in a specific page you can reference it by adding the Reference directive to the top of a page as shown next rather than updating web.config:</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample25.aspx)]

<span data-ttu-id="0bd6c-307">[![使用 AutoCompleteExtender 控制項。](understanding-asp-net-ajax-web-services/_static/image11.png)](understanding-asp-net-ajax-web-services/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0bd6c-307">[![Using the AutoCompleteExtender control.](understanding-asp-net-ajax-web-services/_static/image11.png)](understanding-asp-net-ajax-web-services/_static/image10.png)</span></span>

<span data-ttu-id="0bd6c-308">**圖 4**：使用 AutoCompleteExtender 控制項。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-308">**Figure 4**: Using the AutoCompleteExtender control.</span></span>  <span data-ttu-id="0bd6c-309"> ([按一下以查看完整大小的影像](understanding-asp-net-ajax-web-services/_static/image12.png)) </span><span class="sxs-lookup"><span data-stu-id="0bd6c-309">([Click to view full-size image](understanding-asp-net-ajax-web-services/_static/image12.png))</span></span>

<span data-ttu-id="0bd6c-310">一旦網站已設定為使用 ASP.NET AJAX 工具組，就可以將 AutoCompleteExtender 控制項加入頁面中，就像加入一般的 ASP.NET 伺服器控制項一樣。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-310">Once the Website has been configured to use the ASP.NET AJAX Toolkit, an AutoCompleteExtender control can be added into the page much like you'd add a regular ASP.NET server control.</span></span> <span data-ttu-id="0bd6c-311">[清單 19] 顯示使用控制項呼叫 Web 服務的範例。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-311">Listing 19 shows an example of using the control to call a Web Service.</span></span>

<span data-ttu-id="0bd6c-312">**[清單 19]。使用 ASP.NET AJAX 工具組 AutoCompleteExtender 控制項。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-312">**Listing 19. Using the ASP.NET AJAX Toolkit AutoCompleteExtender control.**</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample26.aspx)]

<span data-ttu-id="0bd6c-313">AutoCompleteExtender 有數個不同的屬性，包括在伺服器控制項上找到的標準識別碼和 runat 屬性。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-313">The AutoCompleteExtender has several different properties including the standard ID and runat properties found on server controls.</span></span> <span data-ttu-id="0bd6c-314">除了這些以外，它還可讓您定義使用者在 Web 服務查詢資料之前輸入的字元數。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-314">In addition to these, it allows you to define how many characters an end user types before the Web Service is queried for data.</span></span> <span data-ttu-id="0bd6c-315">[清單 19] 中所顯示的 MinimumPrefixLength 屬性會導致每次在文字方塊中輸入一個字元時呼叫服務。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-315">The MinimumPrefixLength property shown in Listing 19 causes the service to be called each time a character is typed into the textbox.</span></span> <span data-ttu-id="0bd6c-316">您會想要小心設定此值，因為每次使用者輸入一個字元時，就會呼叫 Web 服務來搜尋符合文字方塊中字元的值。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-316">You'll want to be careful setting this value since each time the user types a character the Web Service will be called to search for values that match the characters in the textbox.</span></span> <span data-ttu-id="0bd6c-317">要呼叫的 Web 服務以及目標 Web 方法，分別使用 ServicePath 和 ServiceMethod 屬性來定義。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-317">The Web Service to call as well as the target Web Method are defined using the ServicePath and ServiceMethod properties respectively.</span></span> <span data-ttu-id="0bd6c-318">最後，TargetControlID 屬性會識別要將 AutoCompleteExtender 控制項連結至哪一個文字方塊。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-318">Finally, the TargetControlID property identifies which textbox to hook the AutoCompleteExtender control to.</span></span>

<span data-ttu-id="0bd6c-319">所呼叫的 Web 服務必須先套用 ScriptService 屬性，如前文所述，而目標 Web 方法必須接受兩個名為 prefixText 和 count 的參數。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-319">The Web Service being called must have the ScriptService attribute applied as discussed earlier and the target Web Method must accept two parameters named prefixText and count.</span></span> <span data-ttu-id="0bd6c-320">PrefixText 參數代表使用者輸入的字元，而 count 參數代表要傳回的專案數 (預設值為 10) 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-320">The prefixText parameter represents the characters typed by the end user and the count parameter represents how many items to return (the default is 10).</span></span> <span data-ttu-id="0bd6c-321">[清單 20] 顯示 GetCustomerIDs Web 方法的範例，其由前面的 [清單 19] 所示的 AutoCompleteExtender 控制項所呼叫。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-321">Listing 20 shows an example of the GetCustomerIDs Web Method called by the AutoCompleteExtender control shown earlier in Listing 19.</span></span> <span data-ttu-id="0bd6c-322">Web 方法會呼叫商務層方法，然後再呼叫資料層方法來處理篩選資料並傳回相符的結果。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-322">The Web Method calls a business layer method that in turn calls a data layer method that handles filtering the data and returning the matching results.</span></span> <span data-ttu-id="0bd6c-323">資料層方法的程式碼如 [清單 21] 所示。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-323">The code for the data layer method is shown in Listing 21.</span></span>

<span data-ttu-id="0bd6c-324">**清單20。篩選從 AutoCompleteExtender 控制項傳送的資料。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-324">**Listing 20. Filtering data sent from the AutoCompleteExtender control.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample27.cs)]

<span data-ttu-id="0bd6c-325">**[清單 21]。依據使用者輸入來篩選結果。**</span><span class="sxs-lookup"><span data-stu-id="0bd6c-325">**Listing 21. Filtering results based upon end user input.**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample28.cs)]

## <a name="conclusion"></a><span data-ttu-id="0bd6c-326">結論</span><span class="sxs-lookup"><span data-stu-id="0bd6c-326">Conclusion</span></span>

<span data-ttu-id="0bd6c-327">ASP.NET AJAX 提供呼叫 Web 服務的絕佳支援，而不需要撰寫許多自訂 JavaScript 程式碼來處理要求和回應訊息。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-327">ASP.NET AJAX provides excellent support for calling Web Services without writing a lot of custom JavaScript code to handle the request and response messages.</span></span> <span data-ttu-id="0bd6c-328">在本文中，您已瞭解如何使用 AJAX 啟用 .NET Web 服務，使其能夠處理 JSON 訊息，以及如何使用 ScriptManager 控制項定義 JavaScript proxy。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-328">In this article you've seen how to AJAX-enable .NET Web Services to enable them to process JSON messages and how to define JavaScript proxies using the ScriptManager control.</span></span> <span data-ttu-id="0bd6c-329">您也已瞭解如何使用 JavaScript proxy 來呼叫 Web 服務、處理簡單和複雜的類型，以及處理失敗。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-329">You've also seen how JavaScript proxies can be used to call Web Services, handle simple and complex types and deal with failures.</span></span> <span data-ttu-id="0bd6c-330">最後，您已瞭解如何使用頁面方法來簡化建立和進行 Web 服務呼叫的程式，以及 AutoCompleteExtender 控制項如何在使用者輸入時提供協助。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-330">Finally, you've seen how page methods can be used to simplify the process of creating and making Web Service calls and how the AutoCompleteExtender control can provide help to end users as they type.</span></span> <span data-ttu-id="0bd6c-331">雖然 ASP.NET AJAX 中提供的 UpdatePanel 當然可以控制許多 AJAX 程式設計人員的選擇，因為它的簡易性，知道如何透過 JavaScript proxy 呼叫 Web 服務，對於許多應用程式都很有用。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-331">Although the UpdatePanel available in ASP.NET AJAX will certainly be the control of choice for many AJAX programmers due to its simplicity, knowing how to call Web Services through JavaScript proxies can be useful in many applications.</span></span>

## <a name="bio"></a><span data-ttu-id="0bd6c-332">生物</span><span class="sxs-lookup"><span data-stu-id="0bd6c-332">Bio</span></span>

<span data-ttu-id="0bd6c-333">Dan Wahlin (Microsoft 最有價值的 ASP.NET 和 XML Web Service 專業人員) 是 .NET 開發講師和架構顧問，位於介面技術訓練 ([http://www.interfacett.com](http://www.interfacett.com)) 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-333">Dan Wahlin (Microsoft Most Valuable Professional for ASP.NET and XML Web Services) is a .NET development instructor and architecture consultant at Interface Technical Training ([http://www.interfacett.com](http://www.interfacett.com)).</span></span> <span data-ttu-id="0bd6c-334">Dan 成立了 XML for ASP.NET 開發人員網站 ([www.XMLforASP.NET](http://www.XMLforASP.NET)) ，這是 INETA 講師的部門，並在幾場會議中發表。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-334">Dan founded the XML for ASP.NET Developers Web site ([www.XMLforASP.NET](http://www.XMLforASP.NET)), is on the INETA Speaker's Bureau and speaks at several conferences.</span></span> <span data-ttu-id="0bd6c-335">Dan 共同撰寫的專業 Windows DNA (Wrox) 、ASP.NET：秘訣、教學課程和程式碼 (Sam) 、ASP.NET 1.1 Insider 解決方案、Professional ASP.NET 2.0 AJAX (Wrox) 、ASP.NET 2.0 MVP 的攻擊，以及為 ASP.NET 開發人員撰寫的 XML (Sams) 。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-335">Dan co-authored Professional Windows DNA (Wrox), ASP.NET: Tips, Tutorials and Code (Sams), ASP.NET 1.1 Insider Solutions, Professional ASP.NET 2.0 AJAX (Wrox), ASP.NET 2.0 MVP Hacks and authored XML for ASP.NET Developers (Sams).</span></span> <span data-ttu-id="0bd6c-336">當他不寫程式碼、文章或書籍時，Dan 就能在他的妻子和小孩中撰寫和錄製音樂，以及玩高爾夫球和籃球。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-336">When he's not writing code, articles or books, Dan enjoys writing and recording music and playing golf and basketball with his wife and kids.</span></span>

<span data-ttu-id="0bd6c-337">Scott Cate 自1997起開始使用 Microsoft Web 技術，而且是 myKB.com ([www.myKB.com](http://www.myKB.com)) 的總裁，他專門用來撰寫著重于知識庫軟體解決方案的 ASP.NET 型應用程式。</span><span class="sxs-lookup"><span data-stu-id="0bd6c-337">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="0bd6c-338">Scott 可以透過電子郵件聯絡， [scott.cate@myKB.com](mailto:scott.cate@myKB.com) 或他在[ScottCate.com](http://ScottCate.com)的 blog</span><span class="sxs-lookup"><span data-stu-id="0bd6c-338">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0bd6c-339">[上一個](understanding-asp-net-ajax-localization.md) 
> [下一步](understanding-asp-net-ajax-debugging-capabilities.md)</span><span class="sxs-lookup"><span data-stu-id="0bd6c-339">[Previous](understanding-asp-net-ajax-localization.md)
[Next](understanding-asp-net-ajax-debugging-capabilities.md)</span></span>
