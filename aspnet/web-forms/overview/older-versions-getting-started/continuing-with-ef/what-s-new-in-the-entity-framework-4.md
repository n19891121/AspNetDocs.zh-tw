---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/what-s-new-in-the-entity-framework-4
title: Entity Framework 4.0 的新功能 |Microsoft Docs
author: tdykstra
description: 本教學課程系列是以 Entity Framework 4.0 教學課程系列的消費者入門所建立的 Contoso 大學 web 應用程式為基礎。 I...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 393df4a8-b1db-44c4-9db7-2b533ca887d0
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/what-s-new-in-the-entity-framework-4
msc.type: authoredcontent
ms.openlocfilehash: 29d2bd61e8361b130e7b9415dad4fe1d5b847945
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78642671"
---
# <a name="whats-new-in-the-entity-framework-40"></a><span data-ttu-id="046e0-104">Entity Framework 4.0 的新功能</span><span class="sxs-lookup"><span data-stu-id="046e0-104">What's New in the Entity Framework 4.0</span></span>

<span data-ttu-id="046e0-105">由[Tom 作者: dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="046e0-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="046e0-106">本教學課程系列是[以 Entity Framework](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)教學課程系列的消費者入門所建立的 Contoso 大學 web 應用程式為基礎。</span><span class="sxs-lookup"><span data-stu-id="046e0-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="046e0-107">如果您未完成先前的教學課程，做為本教學課程的起點，您可以下載您所建立[的應用程式](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a)。</span><span class="sxs-lookup"><span data-stu-id="046e0-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="046e0-108">您也可以下載完整的教學課程系列所建立[的應用程式](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)。</span><span class="sxs-lookup"><span data-stu-id="046e0-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="046e0-109">如果您有關于教學課程的問題，可以將其張貼到[ASP.NET Entity Framework 論壇](https://forums.asp.net/1227.aspx)。</span><span class="sxs-lookup"><span data-stu-id="046e0-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>

<span data-ttu-id="046e0-110">在上一個教學課程中，您已看到一些方法，可讓使用 Entity Framework 之 web 應用程式的效能最大化。</span><span class="sxs-lookup"><span data-stu-id="046e0-110">In the previous tutorial you saw some methods for maximizing the performance of a web application that uses the Entity Framework.</span></span> <span data-ttu-id="046e0-111">本教學課程會回顧 Entity Framework 第4版中最重要的新功能，並連結至可提供所有新功能之完整簡介的資源。</span><span class="sxs-lookup"><span data-stu-id="046e0-111">This tutorial reviews some of the most important new features in version 4 of the Entity Framework, and it links to resources that provide a more complete introduction to all of the new features.</span></span> <span data-ttu-id="046e0-112">本教學課程中反白顯示的功能包括下列各項：</span><span class="sxs-lookup"><span data-stu-id="046e0-112">The features highlighted in this tutorial include the following:</span></span>

- <span data-ttu-id="046e0-113">外鍵關聯。</span><span class="sxs-lookup"><span data-stu-id="046e0-113">Foreign-key associations.</span></span>
- <span data-ttu-id="046e0-114">執行使用者定義的 SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="046e0-114">Executing user-defined SQL commands.</span></span>
- <span data-ttu-id="046e0-115">模型優先開發。</span><span class="sxs-lookup"><span data-stu-id="046e0-115">Model-first development.</span></span>
- <span data-ttu-id="046e0-116">POCO 支援。</span><span class="sxs-lookup"><span data-stu-id="046e0-116">POCO support.</span></span>

<span data-ttu-id="046e0-117">此外，本教學課程將會簡短介紹程式*代碼優先開發*，這項功能會在下一版的 Entity Framework 推出。</span><span class="sxs-lookup"><span data-stu-id="046e0-117">In addition, the tutorial will briefly introduce *code-first development*, a feature that's coming in the next release of the Entity Framework.</span></span>

<span data-ttu-id="046e0-118">若要開始本教學課程，請啟動 Visual Studio，並開啟您在上一個教學課程中使用的 Contoso 大學 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="046e0-118">To start the tutorial, start Visual Studio and open the Contoso University web application that you were working with in the previous tutorial.</span></span>

## <a name="foreign-key-associations"></a><span data-ttu-id="046e0-119">外鍵關聯</span><span class="sxs-lookup"><span data-stu-id="046e0-119">Foreign-Key Associations</span></span>

<span data-ttu-id="046e0-120">3\.5 版的 Entity Framework 包含導覽屬性，但它不包含資料模型中的外鍵屬性。</span><span class="sxs-lookup"><span data-stu-id="046e0-120">Version 3.5 of the Entity Framework included navigation properties, but it didn't include foreign-key properties in the data model.</span></span> <span data-ttu-id="046e0-121">例如，`StudentGrade` 實體會省略 `StudentGrade` 資料表的 `CourseID` 和 `StudentID` 資料行。</span><span class="sxs-lookup"><span data-stu-id="046e0-121">For example, the `CourseID` and `StudentID` columns of the `StudentGrade` table would be omitted from the `StudentGrade` entity.</span></span>

<span data-ttu-id="046e0-122">[![Image01](what-s-new-in-the-entity-framework-4/_static/image2.png)](what-s-new-in-the-entity-framework-4/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-122">[![Image01](what-s-new-in-the-entity-framework-4/_static/image2.png)](what-s-new-in-the-entity-framework-4/_static/image1.png)</span></span>

<span data-ttu-id="046e0-123">這種方法的原因是，嚴格來說，外鍵是實體的執行詳細資料，而不屬於概念資料模型。</span><span class="sxs-lookup"><span data-stu-id="046e0-123">The reason for this approach was that, strictly speaking, foreign keys are a physical implementation detail and don't belong in a conceptual data model.</span></span> <span data-ttu-id="046e0-124">不過，在實際情況下，當您有外鍵的直接存取權時，使用程式碼中的實體通常會比較容易。</span><span class="sxs-lookup"><span data-stu-id="046e0-124">However, as a practical matter, it's often easier to work with entities in code when you have direct access to the foreign keys.</span></span>

<span data-ttu-id="046e0-125">如需資料模型中的外鍵如何簡化您的程式碼的範例，請考慮您在不使用*DepartmentsAdd*的情況下，必須如何編碼該頁面。</span><span class="sxs-lookup"><span data-stu-id="046e0-125">For an example of how foreign keys in the data model can simplify your code, consider how you would have had to code the *DepartmentsAdd.aspx* page without them.</span></span> <span data-ttu-id="046e0-126">在 `Department` 實體中，`Administrator` 屬性是對應至 `Person` 實體中 `PersonID` 的外鍵。</span><span class="sxs-lookup"><span data-stu-id="046e0-126">In the `Department` entity, the `Administrator` property is a foreign key that corresponds to `PersonID` in the `Person` entity.</span></span> <span data-ttu-id="046e0-127">若要建立新部門和其系統管理員之間的關聯，您只需要在資料系結控制項的 `ItemInserting` 事件處理常式中設定 [`Administrator`] 屬性的值即可：</span><span class="sxs-lookup"><span data-stu-id="046e0-127">In order to establish the association between a new department and its administrator, all you had to do was set the value for the `Administrator` property in the `ItemInserting` event handler of the databound control:</span></span>

[!code-csharp[Main](what-s-new-in-the-entity-framework-4/samples/sample1.cs)]

<span data-ttu-id="046e0-128">在資料模型中沒有外鍵時，您會處理資料來源控制項的 `Inserting` 事件，而不是資料系結控制項的 `ItemInserting` 事件，以便在實體加入至實體集之前，先取得實體本身的參考。</span><span class="sxs-lookup"><span data-stu-id="046e0-128">Without foreign keys in the data model, you'd handle the `Inserting` event of the data source control instead of the `ItemInserting` event of the databound control, in order to get a reference to the entity itself before the entity is added to the entity set.</span></span> <span data-ttu-id="046e0-129">當您擁有該參考時，您可以使用類似下列範例中的程式碼來建立關聯：</span><span class="sxs-lookup"><span data-stu-id="046e0-129">When you have that reference, you establish the association using code like that in the following examples:</span></span>

[!code-csharp[Main](what-s-new-in-the-entity-framework-4/samples/sample2.cs)]

[!code-csharp[Main](what-s-new-in-the-entity-framework-4/samples/sample3.cs)]

<span data-ttu-id="046e0-130">如您在 Entity Framework 小組在[外鍵關聯上的 blog 文章](https://blogs.msdn.com/b/efdesign/archive/2009/03/16/foreign-keys-in-the-entity-framework.aspx)中所見，在程式碼複雜度上有很大差異的其他情況。</span><span class="sxs-lookup"><span data-stu-id="046e0-130">As you can see in the Entity Framework team's [blog post on Foreign Key associations](https://blogs.msdn.com/b/efdesign/archive/2009/03/16/foreign-keys-in-the-entity-framework.aspx), there are other cases where the difference in code complexity is much greater.</span></span> <span data-ttu-id="046e0-131">為了因應較簡單的程式碼，而想要以概念資料模型中的執行細節為依據的需求，現在 Entity Framework 可讓您選擇在資料模型中包含外鍵。</span><span class="sxs-lookup"><span data-stu-id="046e0-131">To meet the needs of those who prefer to live with implementation details in the conceptual data model for the sake of simpler code, the Entity Framework now gives you the option of including foreign keys in the data model.</span></span>

<span data-ttu-id="046e0-132">在 Entity Framework 的術語中，如果您在資料模型中包含外鍵關聯，則會使用*外鍵關聯*，而且如果排除外鍵，則會使用*獨立關聯*。</span><span class="sxs-lookup"><span data-stu-id="046e0-132">In Entity Framework terminology, if you include foreign keys in the data model you're using *foreign key associations*, and if you exclude foreign keys you're using *independent associations*.</span></span>

## <a name="executing-user-defined-sql-commands"></a><span data-ttu-id="046e0-133">執行使用者定義的 SQL 命令</span><span class="sxs-lookup"><span data-stu-id="046e0-133">Executing User-Defined SQL Commands</span></span>

<span data-ttu-id="046e0-134">在舊版的 Entity Framework 中，沒有簡單的方法可以立即建立您自己的 SQL 命令並加以執行。</span><span class="sxs-lookup"><span data-stu-id="046e0-134">In earlier versions of the Entity Framework, there was no easy way to create your own SQL commands on the fly and run them.</span></span> <span data-ttu-id="046e0-135">Entity Framework 為您動態產生的 SQL 命令，或者您必須建立預存程式並將它匯入為函數。</span><span class="sxs-lookup"><span data-stu-id="046e0-135">Either the Entity Framework dynamically generated SQL commands for you, or you had to create a stored procedure and import it as a function.</span></span> <span data-ttu-id="046e0-136">第4版會將 `ExecuteStoreQuery` 和 `ExecuteStoreCommand` 方法加入 `ObjectContext` 類別，讓您更輕鬆地將任何查詢直接傳遞至資料庫。</span><span class="sxs-lookup"><span data-stu-id="046e0-136">Version 4 adds `ExecuteStoreQuery` and `ExecuteStoreCommand` methods the `ObjectContext` class that make it easier for you to pass any query directly to the database.</span></span>

<span data-ttu-id="046e0-137">假設 Contoso 大學系統管理員想要能夠在資料庫中執行大量變更，而不需要經過建立預存程式並將它匯入資料模型的程式。</span><span class="sxs-lookup"><span data-stu-id="046e0-137">Suppose Contoso University administrators want to be able to perform bulk changes in the database without having to go through the process of creating a stored procedure and importing it into the data model.</span></span> <span data-ttu-id="046e0-138">其第一個要求是針對頁面，讓他們變更資料庫中所有課程的信用額度數目。</span><span class="sxs-lookup"><span data-stu-id="046e0-138">Their first request is for a page that lets them change the number of credits for all courses in the database.</span></span> <span data-ttu-id="046e0-139">在網頁上，他們想要能夠輸入一個數位，用來將每個 `Course` 資料列的 `Credits` 資料行的值相乘。</span><span class="sxs-lookup"><span data-stu-id="046e0-139">On the web page, they want to be able to enter a number to use to multiply the value of every `Course` row's `Credits` column.</span></span>

<span data-ttu-id="046e0-140">建立使用 [*網站*主要] 頁面的新頁面，並將其命名為*UpdateCredits .aspx*。</span><span class="sxs-lookup"><span data-stu-id="046e0-140">Create a new page that uses the *Site.Master* master page and name it *UpdateCredits.aspx*.</span></span> <span data-ttu-id="046e0-141">然後將下列標記新增至名為 `Content2`的 `Content` 控制項：</span><span class="sxs-lookup"><span data-stu-id="046e0-141">Then add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](what-s-new-in-the-entity-framework-4/samples/sample4.aspx)]

<span data-ttu-id="046e0-142">此標記會建立一個 `TextBox` 控制項，使用者可以在其中輸入乘數值、要按一下的 `Button` 控制項來執行命令，以及 `Label` 控制項來指出受影響的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="046e0-142">This markup creates a `TextBox` control in which the user can enter the multiplier value, a `Button` control to click in order to execute the command, and a `Label` control for indicating the number of rows affected.</span></span>

<span data-ttu-id="046e0-143">開啟*UpdateCredits.aspx.cs*，然後為按鈕的 `Click` 事件新增下列 `using` 語句和處理常式：</span><span class="sxs-lookup"><span data-stu-id="046e0-143">Open *UpdateCredits.aspx.cs*, and add the following `using` statement and a handler for the button's `Click` event:</span></span>

[!code-csharp[Main](what-s-new-in-the-entity-framework-4/samples/sample5.cs)]

[!code-csharp[Main](what-s-new-in-the-entity-framework-4/samples/sample6.cs)]

<span data-ttu-id="046e0-144">這段程式碼會使用文字方塊中的值來執行 SQL `Update` 命令，並使用標籤來顯示受影響的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="046e0-144">This code executes the SQL `Update` command using the value in the text box and uses the label to display the number of rows affected.</span></span> <span data-ttu-id="046e0-145">執行此頁面之前，請執行 [*課程 .aspx* ] 頁面，以取得某些資料的「之前」圖片。</span><span class="sxs-lookup"><span data-stu-id="046e0-145">Before you run the page, run the *Courses.aspx* page to get a "before" picture of some data.</span></span>

<span data-ttu-id="046e0-146">[![Image02](what-s-new-in-the-entity-framework-4/_static/image4.png)](what-s-new-in-the-entity-framework-4/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-146">[![Image02](what-s-new-in-the-entity-framework-4/_static/image4.png)](what-s-new-in-the-entity-framework-4/_static/image3.png)</span></span>

<span data-ttu-id="046e0-147">執行*UpdateCredits*，輸入 "10" 做為乘數，然後按一下 [**執行**]。</span><span class="sxs-lookup"><span data-stu-id="046e0-147">Run *UpdateCredits.aspx*, enter "10" as the multiplier, and then click **Execute**.</span></span>

<span data-ttu-id="046e0-148">[![Image03](what-s-new-in-the-entity-framework-4/_static/image6.png)](what-s-new-in-the-entity-framework-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-148">[![Image03](what-s-new-in-the-entity-framework-4/_static/image6.png)](what-s-new-in-the-entity-framework-4/_static/image5.png)</span></span>

<span data-ttu-id="046e0-149">再次執行 [*課程 .aspx* ] 頁面，以查看變更的資料。</span><span class="sxs-lookup"><span data-stu-id="046e0-149">Run the *Courses.aspx* page again to see the changed data.</span></span>

<span data-ttu-id="046e0-150">[![Image04](what-s-new-in-the-entity-framework-4/_static/image8.png)](what-s-new-in-the-entity-framework-4/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-150">[![Image04](what-s-new-in-the-entity-framework-4/_static/image8.png)](what-s-new-in-the-entity-framework-4/_static/image7.png)</span></span>

<span data-ttu-id="046e0-151">（如果您想要將點數的數目設回其原始值，請在 [ *UpdateCredits.aspx.cs* ] [變更 `Credits * {0}`] 中 `Credits / {0}` 並重新執行頁面，輸入10做為除數）。</span><span class="sxs-lookup"><span data-stu-id="046e0-151">(If you want to set the number of credits back to their original values, in *UpdateCredits.aspx.cs* change `Credits * {0}` to `Credits / {0}` and re-run the page, entering 10 as the divisor.)</span></span>

<span data-ttu-id="046e0-152">如需有關執行您在程式碼中定義之查詢的詳細資訊，請參閱[如何：直接針對資料來源執行命令](https://msdn.microsoft.com/library/ee358769.aspx)。</span><span class="sxs-lookup"><span data-stu-id="046e0-152">For more information about executing queries that you define in code, see [How to: Directly Execute Commands Against the Data Source](https://msdn.microsoft.com/library/ee358769.aspx).</span></span>

## <a name="model-first-development"></a><span data-ttu-id="046e0-153">模型優先開發</span><span class="sxs-lookup"><span data-stu-id="046e0-153">Model-First Development</span></span>

<span data-ttu-id="046e0-154">在這些逐步解說中，您會先建立資料庫，然後根據資料庫結構產生資料模型。</span><span class="sxs-lookup"><span data-stu-id="046e0-154">In these walkthroughs you created the database first and then generated the data model based on the database structure.</span></span> <span data-ttu-id="046e0-155">在 Entity Framework 4 中，您可以改為從資料模型開始，並根據資料模型結構產生資料庫。</span><span class="sxs-lookup"><span data-stu-id="046e0-155">In the Entity Framework 4 you can start with the data model instead and generate the database based on the data model structure.</span></span> <span data-ttu-id="046e0-156">如果您要建立的應用程式已不存在資料庫，則模型優先方法可讓您建立對應用程式進行概念上合理的實體和關聯性，而不需擔心實體的執行細節.</span><span class="sxs-lookup"><span data-stu-id="046e0-156">If you're creating an application for which the database doesn't already exist, the model-first approach enables you to create entities and relationships that make sense conceptually for the application, while not worrying about physical implementation details.</span></span> <span data-ttu-id="046e0-157">（不過，這只會透過開發的初始階段才會如此。</span><span class="sxs-lookup"><span data-stu-id="046e0-157">(This remains true only through the initial stages of development, however.</span></span> <span data-ttu-id="046e0-158">最後，將會建立資料庫，並在其中包含生產資料，然後從模型重新建立它將不再可行。此時您會回到資料庫優先的方法）。</span><span class="sxs-lookup"><span data-stu-id="046e0-158">Eventually the database will be created and will have production data in it, and recreating it from the model will no longer be practical; at that point you'll be back to the database-first approach.)</span></span>

<span data-ttu-id="046e0-159">在本教學課程的這一節中，您將建立簡單的資料模型，並從它產生資料庫。</span><span class="sxs-lookup"><span data-stu-id="046e0-159">In this section of the tutorial, you'll create a simple data model and generate the database from it.</span></span>

<span data-ttu-id="046e0-160">在**方案總管**中，以滑鼠右鍵按一下*DAL*資料夾，然後選取 [**新增專案**]。</span><span class="sxs-lookup"><span data-stu-id="046e0-160">In **Solution Explorer**, right-click the *DAL* folder and select **Add New Item**.</span></span> <span data-ttu-id="046e0-161">在 [**新增專案**] 對話方塊的 [**已安裝的範本**] 底下，選取 [**資料**]，然後選取 [ **ADO.NET 實體資料模型**] 範本。</span><span class="sxs-lookup"><span data-stu-id="046e0-161">In the **Add New Item** dialog box, under **Installed Templates** select **Data** and then select the **ADO.NET Entity Data Model** template.</span></span> <span data-ttu-id="046e0-162">將新檔案命名為*AlumniAssociationModel* ，**然後按一下 [新增]** 。</span><span class="sxs-lookup"><span data-stu-id="046e0-162">Name the new file *AlumniAssociationModel.edmx* and click **Add**.</span></span>

<span data-ttu-id="046e0-163">[![Image06](what-s-new-in-the-entity-framework-4/_static/image10.png)](what-s-new-in-the-entity-framework-4/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-163">[![Image06](what-s-new-in-the-entity-framework-4/_static/image10.png)](what-s-new-in-the-entity-framework-4/_static/image9.png)</span></span>

<span data-ttu-id="046e0-164">這會啟動實體資料模型 Wizard。</span><span class="sxs-lookup"><span data-stu-id="046e0-164">This launches the Entity Data Model Wizard.</span></span> <span data-ttu-id="046e0-165">在 [**選擇模型內容**] 步驟中，選取 [**空的模型**]，然後按一下 **[完成]** 。</span><span class="sxs-lookup"><span data-stu-id="046e0-165">In the **Choose Model Contents** step, select **Empty Model** and then click **Finish**.</span></span>

<span data-ttu-id="046e0-166">[![Image07](what-s-new-in-the-entity-framework-4/_static/image12.png)](what-s-new-in-the-entity-framework-4/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-166">[![Image07](what-s-new-in-the-entity-framework-4/_static/image12.png)](what-s-new-in-the-entity-framework-4/_static/image11.png)</span></span>

<span data-ttu-id="046e0-167">**實體資料模型設計**工具隨即開啟，並顯示空白的設計介面。</span><span class="sxs-lookup"><span data-stu-id="046e0-167">The **Entity Data Model Designer** opens with a blank design surface.</span></span> <span data-ttu-id="046e0-168">將**實體**專案從 [**工具箱**] 拖曳至設計介面。</span><span class="sxs-lookup"><span data-stu-id="046e0-168">Drag an **Entity** item from the **Toolbox** onto the design surface.</span></span>

<span data-ttu-id="046e0-169">[![Image08](what-s-new-in-the-entity-framework-4/_static/image14.png)](what-s-new-in-the-entity-framework-4/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-169">[![Image08](what-s-new-in-the-entity-framework-4/_static/image14.png)](what-s-new-in-the-entity-framework-4/_static/image13.png)</span></span>

<span data-ttu-id="046e0-170">將 機構名稱 從 `Entity1` 變更為 `Alumnus`，將 `Id` 屬性名稱變更為 `AlumnusId`，然後新增名為 `Name` 的新純量屬性。</span><span class="sxs-lookup"><span data-stu-id="046e0-170">Change the entity name from `Entity1` to `Alumnus`, change the `Id` property name to `AlumnusId`, and add a new scalar property named `Name`.</span></span> <span data-ttu-id="046e0-171">若要加入新的屬性，您可以在變更 `Id` 資料行的名稱之後按下 Enter，或以滑鼠右鍵按一下實體，然後選取 [加入純量**屬性**]。</span><span class="sxs-lookup"><span data-stu-id="046e0-171">To add new properties you can press Enter after changing the name of the `Id` column, or right-click the entity and select **Add Scalar Property**.</span></span> <span data-ttu-id="046e0-172">新屬性的預設類型是 `String`，這適用于這種簡單的示範，但您也可以在 [**屬性**] 視窗中變更資料類型之類的專案。</span><span class="sxs-lookup"><span data-stu-id="046e0-172">The default type for new properties is `String`, which is fine for this simple demonstration, but of course you can change things like data type in the **Properties** window.</span></span>

<span data-ttu-id="046e0-173">以相同的方式建立另一個實體，並將其命名為 `Donation`。</span><span class="sxs-lookup"><span data-stu-id="046e0-173">Create another entity the same way and name it `Donation`.</span></span> <span data-ttu-id="046e0-174">將 [`Id`] 屬性變更為 [`DonationId`]，然後新增名為 `DateAndAmount`的純量屬性。</span><span class="sxs-lookup"><span data-stu-id="046e0-174">Change the `Id` property to `DonationId` and add a scalar property named `DateAndAmount`.</span></span>

<span data-ttu-id="046e0-175">[![Image09](what-s-new-in-the-entity-framework-4/_static/image16.png)](what-s-new-in-the-entity-framework-4/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-175">[![Image09](what-s-new-in-the-entity-framework-4/_static/image16.png)](what-s-new-in-the-entity-framework-4/_static/image15.png)</span></span>

<span data-ttu-id="046e0-176">若要新增這兩個實體之間的關聯，請以滑鼠右鍵按一下 [`Alumnus`] 實體，選取 [**新增**]，然後選取 [**關聯**]。</span><span class="sxs-lookup"><span data-stu-id="046e0-176">To add an association between these two entities, right-click the `Alumnus` entity, select **Add**, and then select **Association**.</span></span>

<span data-ttu-id="046e0-177">[![Image10](what-s-new-in-the-entity-framework-4/_static/image18.png)](what-s-new-in-the-entity-framework-4/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-177">[![Image10](what-s-new-in-the-entity-framework-4/_static/image18.png)](what-s-new-in-the-entity-framework-4/_static/image17.png)</span></span>

<span data-ttu-id="046e0-178">[**加入關聯**] 對話方塊中的預設值是您想要的（一對多、包含導覽屬性、包含外鍵），因此只要按一下 **[確定]** 即可。</span><span class="sxs-lookup"><span data-stu-id="046e0-178">The default values in the **Add Association** dialog box are what you want (one-to-many, include navigation properties, include foreign keys), so just click **OK**.</span></span>

<span data-ttu-id="046e0-179">[![Image11](what-s-new-in-the-entity-framework-4/_static/image20.png)](what-s-new-in-the-entity-framework-4/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-179">[![Image11](what-s-new-in-the-entity-framework-4/_static/image20.png)](what-s-new-in-the-entity-framework-4/_static/image19.png)</span></span>

<span data-ttu-id="046e0-180">設計工具會加入關聯線和外鍵屬性。</span><span class="sxs-lookup"><span data-stu-id="046e0-180">The designer adds an association line and a foreign-key property.</span></span>

<span data-ttu-id="046e0-181">[![Image12](what-s-new-in-the-entity-framework-4/_static/image22.png)](what-s-new-in-the-entity-framework-4/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-181">[![Image12](what-s-new-in-the-entity-framework-4/_static/image22.png)](what-s-new-in-the-entity-framework-4/_static/image21.png)</span></span>

<span data-ttu-id="046e0-182">現在您已經準備好建立資料庫。</span><span class="sxs-lookup"><span data-stu-id="046e0-182">Now you're ready to create the database.</span></span> <span data-ttu-id="046e0-183">以滑鼠右鍵按一下設計介面，然後選取 [**從模型產生資料庫**]。</span><span class="sxs-lookup"><span data-stu-id="046e0-183">Right-click the design surface and select **Generate Database from Model**.</span></span>

<span data-ttu-id="046e0-184">[![Image13](what-s-new-in-the-entity-framework-4/_static/image24.png)](what-s-new-in-the-entity-framework-4/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-184">[![Image13](what-s-new-in-the-entity-framework-4/_static/image24.png)](what-s-new-in-the-entity-framework-4/_static/image23.png)</span></span>

<span data-ttu-id="046e0-185">這會啟動 [產生資料庫] Wizard。</span><span class="sxs-lookup"><span data-stu-id="046e0-185">This launches the Generate Database Wizard.</span></span> <span data-ttu-id="046e0-186">（如果您看到指出實體未對應的警告，您可以忽略它們的時間）。</span><span class="sxs-lookup"><span data-stu-id="046e0-186">(If you see warnings that indicate that the entities aren't mapped, you can ignore those for the time being.)</span></span>

<span data-ttu-id="046e0-187">在 [**選擇您的資料連線**] 步驟中，按一下 [**新增連接**]。</span><span class="sxs-lookup"><span data-stu-id="046e0-187">In the **Choose Your Data Connection** step, click **New Connection**.</span></span>

<span data-ttu-id="046e0-188">[![Image14](what-s-new-in-the-entity-framework-4/_static/image26.png)](what-s-new-in-the-entity-framework-4/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-188">[![Image14](what-s-new-in-the-entity-framework-4/_static/image26.png)](what-s-new-in-the-entity-framework-4/_static/image25.png)</span></span>

<span data-ttu-id="046e0-189">在 [**連接屬性**] 對話方塊中，選取本機 SQL Server Express 實例，並將資料庫命名為 `AlumniAssociation`。</span><span class="sxs-lookup"><span data-stu-id="046e0-189">In the **Connection Properties** dialog box, select the local SQL Server Express instance and name the database `AlumniAssociation`.</span></span>

<span data-ttu-id="046e0-190">[![Image15](what-s-new-in-the-entity-framework-4/_static/image28.png)](what-s-new-in-the-entity-framework-4/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-190">[![Image15](what-s-new-in-the-entity-framework-4/_static/image28.png)](what-s-new-in-the-entity-framework-4/_static/image27.png)</span></span>

<span data-ttu-id="046e0-191">當系統詢問您是否要建立資料庫時，請按一下 **[是]** 。</span><span class="sxs-lookup"><span data-stu-id="046e0-191">Click **Yes** when you're asked if you want to create the database.</span></span> <span data-ttu-id="046e0-192">再次顯示 [**選擇您的資料連線**] 步驟時，請按 **[下一步]** 。</span><span class="sxs-lookup"><span data-stu-id="046e0-192">When the **Choose Your Data Connection** step is displayed again, click **Next**.</span></span>

<span data-ttu-id="046e0-193">在 [**摘要和設定**] 步驟中，按一下 **[完成]** 。</span><span class="sxs-lookup"><span data-stu-id="046e0-193">In the **Summary and Settings** step, click **Finish**.</span></span>

<span data-ttu-id="046e0-194">[![Image18](what-s-new-in-the-entity-framework-4/_static/image30.png)](what-s-new-in-the-entity-framework-4/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-194">[![Image18](what-s-new-in-the-entity-framework-4/_static/image30.png)](what-s-new-in-the-entity-framework-4/_static/image29.png)</span></span>

<span data-ttu-id="046e0-195">已建立具有資料定義語言（DDL）命令的 *.sql*檔案，但尚未執行命令。</span><span class="sxs-lookup"><span data-stu-id="046e0-195">A *.sql* file with the data definition language (DDL) commands is created, but the commands haven't been run yet.</span></span>

<span data-ttu-id="046e0-196">[![Image20](what-s-new-in-the-entity-framework-4/_static/image32.png)](what-s-new-in-the-entity-framework-4/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-196">[![Image20](what-s-new-in-the-entity-framework-4/_static/image32.png)](what-s-new-in-the-entity-framework-4/_static/image31.png)</span></span>

<span data-ttu-id="046e0-197">使用像是**SQL Server Management Studio**之類的工具來執行腳本並建立資料表，就像您在[消費者入門教學課程系列中的第一個教學](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)課程建立 `School` 資料庫時所做的一樣。</span><span class="sxs-lookup"><span data-stu-id="046e0-197">Use a tool such as **SQL Server Management Studio** to run the script and create the tables, as you might have done when you created the `School` database for [the first tutorial in the Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span> <span data-ttu-id="046e0-198">（除非您已下載資料庫）。</span><span class="sxs-lookup"><span data-stu-id="046e0-198">(Unless you downloaded the database.)</span></span>

<span data-ttu-id="046e0-199">您現在可以在網頁中使用 `AlumniAssociation` 資料模型，就像使用 `School` 模型一樣。</span><span class="sxs-lookup"><span data-stu-id="046e0-199">You can now use the `AlumniAssociation` data model in your web pages the same way you've been using the `School` model.</span></span> <span data-ttu-id="046e0-200">若要試試看，請將一些資料加入至資料表，並建立顯示資料的網頁。</span><span class="sxs-lookup"><span data-stu-id="046e0-200">To try this out, add some data to the tables and create a web page that displays the data.</span></span>

<span data-ttu-id="046e0-201">使用**伺服器總管**，將下列資料列新增至 [`Alumnus`] 和 [`Donation`] 資料表。</span><span class="sxs-lookup"><span data-stu-id="046e0-201">Using **Server Explorer**, add the following rows to the `Alumnus` and `Donation` tables.</span></span>

<span data-ttu-id="046e0-202">[![Image21](what-s-new-in-the-entity-framework-4/_static/image34.png)](what-s-new-in-the-entity-framework-4/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-202">[![Image21](what-s-new-in-the-entity-framework-4/_static/image34.png)](what-s-new-in-the-entity-framework-4/_static/image33.png)</span></span>

<span data-ttu-id="046e0-203">建立名為*前輩人脈*的新網頁，此網頁會使用*網站*的主版頁面。</span><span class="sxs-lookup"><span data-stu-id="046e0-203">Create a new web page named *Alumni.aspx* that uses the *Site.Master* master page.</span></span> <span data-ttu-id="046e0-204">將下列標記新增至名為 `Content2`的 `Content` 控制項：</span><span class="sxs-lookup"><span data-stu-id="046e0-204">Add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](what-s-new-in-the-entity-framework-4/samples/sample7.aspx)]

<span data-ttu-id="046e0-205">此標記會建立嵌套 `GridView` 控制項，外部則是用來顯示前輩人脈名稱，而內部則是用來顯示捐贈日期和金額。</span><span class="sxs-lookup"><span data-stu-id="046e0-205">This markup creates nested `GridView` controls, the outer one to display alumni names and the inner one to display donation dates and amounts.</span></span>

<span data-ttu-id="046e0-206">開啟*Alumni.aspx.cs*。</span><span class="sxs-lookup"><span data-stu-id="046e0-206">Open *Alumni.aspx.cs*.</span></span> <span data-ttu-id="046e0-207">為數據存取層加入 `using` 語句，並為外部 `GridView` 控制項的 `RowDataBound` 事件新增處理常式：</span><span class="sxs-lookup"><span data-stu-id="046e0-207">Add a `using` statement for the data access layer and a handler for the outer `GridView` control's `RowDataBound` event:</span></span>

[!code-csharp[Main](what-s-new-in-the-entity-framework-4/samples/sample8.cs)]

<span data-ttu-id="046e0-208">這段程式碼會使用目前資料列之 `Alumnus` 實體的 `Donations` 導覽屬性，來將內部 `GridView` 控制項。</span><span class="sxs-lookup"><span data-stu-id="046e0-208">This code databinds the inner `GridView` control using the `Donations` navigation property of the current row's `Alumnus` entity.</span></span>

<span data-ttu-id="046e0-209">執行頁面。</span><span class="sxs-lookup"><span data-stu-id="046e0-209">Run the page.</span></span>

<span data-ttu-id="046e0-210">[![Image22](what-s-new-in-the-entity-framework-4/_static/image36.png)](what-s-new-in-the-entity-framework-4/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="046e0-210">[![Image22](what-s-new-in-the-entity-framework-4/_static/image36.png)](what-s-new-in-the-entity-framework-4/_static/image35.png)</span></span>

<span data-ttu-id="046e0-211">（注意：此頁面包含在可下載的專案中，但若要讓它正常執行，您必須在本機 SQL Server Express 實例中建立資料庫; 資料庫不會在*應用程式\_* 資料夾中包含為 *.mdf*檔案）。</span><span class="sxs-lookup"><span data-stu-id="046e0-211">(Note: This page is included in the downloadable project, but to make it work you must create the database in your local SQL Server Express instance; the database isn't included as an *.mdf* file in the *App\_Data* folder.)</span></span>

<span data-ttu-id="046e0-212">如需使用 Entity Framework 之模型優先功能的詳細資訊，請參閱[Entity Framework 4 中的模型優先](https://msdn.microsoft.com/data/ff830362.aspx)。</span><span class="sxs-lookup"><span data-stu-id="046e0-212">For more information about using the model-first feature of the Entity Framework, see [Model-First in the Entity Framework 4](https://msdn.microsoft.com/data/ff830362.aspx).</span></span>

## <a name="poco-support"></a><span data-ttu-id="046e0-213">POCO 支援</span><span class="sxs-lookup"><span data-stu-id="046e0-213">POCO Support</span></span>

<span data-ttu-id="046e0-214">當您使用網域驅動的設計方法時，您會設計資料類別，以代表與商務領域相關的資料和行為。</span><span class="sxs-lookup"><span data-stu-id="046e0-214">When you use domain-driven design methodology, you design data classes that represent data and behavior that's relevant to the business domain.</span></span> <span data-ttu-id="046e0-215">這些類別應該與用來儲存（保存）資料的任何特定技術無關;換句話說，它們應該是持續性*未知*的。</span><span class="sxs-lookup"><span data-stu-id="046e0-215">These classes should be independent of any specific technology used to store (persist) the data; in other words, they should be *persistence ignorant*.</span></span> <span data-ttu-id="046e0-216">持續性無知也可以讓類別更容易進行單元測試，因為單元測試專案可以使用任何最方便進行測試的持續性技術。</span><span class="sxs-lookup"><span data-stu-id="046e0-216">Persistence ignorance can also make a class easier to unit test because the unit test project can use whatever persistence technology is most convenient for testing.</span></span> <span data-ttu-id="046e0-217">舊版的 Entity Framework 針對持續性無知提供有限的支援，因為實體類別必須繼承自 `EntityObject` 類別，因此包含大量 Entity Framework 特有的功能。</span><span class="sxs-lookup"><span data-stu-id="046e0-217">Earlier versions of the Entity Framework offered limited support for persistence ignorance because entity classes had to inherit from the `EntityObject` class and thus included a great deal of Entity Framework-specific functionality.</span></span>

<span data-ttu-id="046e0-218">Entity Framework 4 引進了使用不會繼承自 `EntityObject` 類別之實體類別的功能，因而導致非持續性的情況。</span><span class="sxs-lookup"><span data-stu-id="046e0-218">The Entity Framework 4 introduces the ability to use entity classes that don't inherit from the `EntityObject` class and therefore are persistence ignorant.</span></span> <span data-ttu-id="046e0-219">在 Entity Framework 的內容中，像這樣的類別通常稱為「*純舊 CLR 物件*」（POCO 或 poco）。</span><span class="sxs-lookup"><span data-stu-id="046e0-219">In the context of the Entity Framework, classes like this are typically called *plain-old CLR objects* (POCO, or POCOs).</span></span> <span data-ttu-id="046e0-220">您可以手動撰寫 POCO 類別，也可以使用 Entity Framework 所提供的文字模板轉換工具組（T4）範本，根據現有的資料模型自動產生。</span><span class="sxs-lookup"><span data-stu-id="046e0-220">You can write POCO classes manually, or you can automatically generate them based on an existing data model using Text Template Transformation Toolkit (T4) templates provided by the Entity Framework.</span></span>

<span data-ttu-id="046e0-221">如需在 Entity Framework 中使用 Poco 的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="046e0-221">For more information about using POCOs in the Entity Framework, see the following resources:</span></span>

- <span data-ttu-id="046e0-222">[使用 POCO 實體](https://msdn.microsoft.com/library/dd456853.aspx)。</span><span class="sxs-lookup"><span data-stu-id="046e0-222">[Working with POCO Entities](https://msdn.microsoft.com/library/dd456853.aspx).</span></span> <span data-ttu-id="046e0-223">這是一份 MSDN 檔，其中包含 Poco 的總覽，並連結至其他具有更詳細資訊的檔。</span><span class="sxs-lookup"><span data-stu-id="046e0-223">This is an MSDN document that's an overview of POCOs, with links to other documents that have more detailed information.</span></span>
- <span data-ttu-id="046e0-224">[逐步解說： Entity Framework 的 POCO 範本](https://blogs.msdn.com/b/adonet/archive/2010/01/25/walkthrough-poco-template-for-the-entity-framework.aspx)這是來自 Entity Framework 開發小組的 blog 文章，其中包含 Poco 的其他 blog 文章連結。</span><span class="sxs-lookup"><span data-stu-id="046e0-224">[Walkthrough: POCO Template for the Entity Framework](https://blogs.msdn.com/b/adonet/archive/2010/01/25/walkthrough-poco-template-for-the-entity-framework.aspx) This is a blog post from the Entity Framework development team, with links to other blog posts about POCOs.</span></span>

## <a name="code-first-development"></a><span data-ttu-id="046e0-225">程式碼優先開發</span><span class="sxs-lookup"><span data-stu-id="046e0-225">Code-First Development</span></span>

<span data-ttu-id="046e0-226">Entity Framework 4 中的 POCO 支援仍然需要您建立資料模型，並將實體類別連結至資料模型。</span><span class="sxs-lookup"><span data-stu-id="046e0-226">POCO support in the Entity Framework 4 still requires that you create a data model and link your entity classes to the data model.</span></span> <span data-ttu-id="046e0-227">下一版的 Entity Framework 將包含名為「*程式碼優先開發*」的功能。</span><span class="sxs-lookup"><span data-stu-id="046e0-227">The next release of the Entity Framework will include a feature called *code-first development*.</span></span> <span data-ttu-id="046e0-228">這項功能可讓您將 Entity Framework 與自己的 POCO 類別搭配使用，而不需要使用資料模型設計工具或資料模型 XML 檔案。</span><span class="sxs-lookup"><span data-stu-id="046e0-228">This feature enables you to use the Entity Framework with your own POCO classes without needing to use either the data model designer or a data model XML file.</span></span> <span data-ttu-id="046e0-229">（因此，這個選項也稱為「*僅限程式碼*」;*程式碼優先*和*僅限程式碼*都參考相同的 Entity Framework 功能）。</span><span class="sxs-lookup"><span data-stu-id="046e0-229">(Therefore, this option has also been called *code-only*; *code-first* and *code-only* both refer to the same Entity Framework feature.)</span></span>

<span data-ttu-id="046e0-230">如需使用程式碼優先方法進行開發的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="046e0-230">For more information about using the code-first approach to development, see the following resources:</span></span>

- <span data-ttu-id="046e0-231">[第一次使用 Entity Framework 4 進行程式碼開發](https://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx)。</span><span class="sxs-lookup"><span data-stu-id="046e0-231">[Code-First Development with Entity Framework 4](https://weblogs.asp.net/scottgu/archive/2010/07/16/code-first-development-with-entity-framework-4.aspx).</span></span> <span data-ttu-id="046e0-232">這是 Scott Guthrie 引進程式碼優先開發的 blog 文章。</span><span class="sxs-lookup"><span data-stu-id="046e0-232">This is a blog post by Scott Guthrie introducing code-first development.</span></span>
- [<span data-ttu-id="046e0-233">Entity Framework 開發小組的 Blog-貼文標記 CodeOnly</span><span class="sxs-lookup"><span data-stu-id="046e0-233">Entity Framework Development Team Blog - posts tagged CodeOnly</span></span>](https://blogs.msdn.com/b/efdesign/archive/tags/codeonly/)
- [<span data-ttu-id="046e0-234">Entity Framework 開發小組的網路日誌-已標記的文章 Code First</span><span class="sxs-lookup"><span data-stu-id="046e0-234">Entity Framework Development Team Blog - posts tagged Code First</span></span>](https://blogs.msdn.com/b/efdesign/archive/tags/code+first/)
- [<span data-ttu-id="046e0-235">MVC 音樂存放教學課程-第4部分：模型和資料存取</span><span class="sxs-lookup"><span data-stu-id="046e0-235">MVC Music Store tutorial - Part 4: Models and Data Access</span></span>](../../../../mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-4.md)
- [<span data-ttu-id="046e0-236">MVC 3 的消費者入門-第4部： Entity Framework 程式碼優先開發</span><span class="sxs-lookup"><span data-stu-id="046e0-236">Getting Started with MVC 3 - Part 4: Entity Framework Code-First Development</span></span>](../../../../mvc/overview/older-versions/getting-started-with-aspnet-mvc3/cs/adding-a-model.md)

<span data-ttu-id="046e0-237">此外，建立類似 Contoso 大學應用程式之應用程式的新 MVC 程式碼優先教學課程，預計會在2011的春季發佈， [https://asp.net/entity-framework/tutorials](../../../../entity-framework.md)</span><span class="sxs-lookup"><span data-stu-id="046e0-237">In addition, a new MVC Code-First tutorial that builds an application similar to the Contoso University application is projected to be published in the spring of 2011 at [https://asp.net/entity-framework/tutorials](../../../../entity-framework.md)</span></span>

## <a name="more-information"></a><span data-ttu-id="046e0-238">詳細資訊</span><span class="sxs-lookup"><span data-stu-id="046e0-238">More Information</span></span>

<span data-ttu-id="046e0-239">這會完成 Entity Framework 的新功能，並繼續進行 Entity Framework 教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="046e0-239">This completes the overview to what's new in the Entity Framework and this Continuing with the Entity Framework tutorial series.</span></span> <span data-ttu-id="046e0-240">如需此處未涵蓋之 Entity Framework 4 新功能的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="046e0-240">For more information about new features in the Entity Framework 4 that aren't covered here, see the following resources:</span></span>

- <span data-ttu-id="046e0-241">[ADO.NET 的新功能](https://msdn.microsoft.com/library/ex6y04yf.aspx)Entity Framework 第4版中新功能的 MSDN 主題。</span><span class="sxs-lookup"><span data-stu-id="046e0-241">[What's New in ADO.NET](https://msdn.microsoft.com/library/ex6y04yf.aspx) MSDN topic on new features in version 4 of the Entity Framework.</span></span>
- <span data-ttu-id="046e0-242">[宣佈發行 Entity Framework 4](https://blogs.msdn.com/b/efdesign/archive/2010/04/12/announcing-the-release-of-entity-framework-4.aspx)Entity Framework 開發小組的第4版新功能的 blog 文章。</span><span class="sxs-lookup"><span data-stu-id="046e0-242">[Announcing the release of Entity Framework 4](https://blogs.msdn.com/b/efdesign/archive/2010/04/12/announcing-the-release-of-entity-framework-4.aspx) The Entity Framework development team's blog post about new features in version 4.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="046e0-243">上一篇</span><span class="sxs-lookup"><span data-stu-id="046e0-243">Previous</span></span>](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application.md)
