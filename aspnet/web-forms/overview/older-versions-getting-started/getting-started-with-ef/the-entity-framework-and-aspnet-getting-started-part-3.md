---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
title: 具有 Entity Framework 4.0 Database First 和 ASP.NET 4 Web form 的消費者入門-第3部分 |Microsoft Docs
author: tdykstra
description: Contoso 大學範例 web 應用程式示範如何使用 Entity Framework 來建立 ASP.NET Web Forms 應用程式。 範例應用程式為 。
ms.author: riande
ms.date: 12/03/2010
ms.assetid: ccdc3f8c-2568-40a7-8f8b-3c23d2e05388
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
msc.type: authoredcontent
ms.openlocfilehash: 88debb11a9157dce9ff000b1cb459b876dbceaf3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78643245"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-3"></a><span data-ttu-id="b6f78-104">Entity Framework 4.0 Database First 和 ASP.NET 4 Web form 的消費者入門-第3部分</span><span class="sxs-lookup"><span data-stu-id="b6f78-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 3</span></span>

<span data-ttu-id="b6f78-105">由[Tom 作者: dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b6f78-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="b6f78-106">Contoso 大學範例 web 應用程式示範如何使用 Entity Framework 4.0 和 Visual Studio 2010 來建立 ASP.NET Web Forms 應用程式。</span><span class="sxs-lookup"><span data-stu-id="b6f78-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="b6f78-107">如需教學課程系列的資訊，請參閱本[系列的第一個教學](the-entity-framework-and-aspnet-getting-started-part-1.md)課程</span><span class="sxs-lookup"><span data-stu-id="b6f78-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="filtering-ordering-and-grouping-data"></a><span data-ttu-id="b6f78-108">篩選、排序和分組資料</span><span class="sxs-lookup"><span data-stu-id="b6f78-108">Filtering, Ordering, and Grouping Data</span></span>

<span data-ttu-id="b6f78-109">在上一個教學課程中，您使用了 [`EntityDataSource`] 控制項來顯示和編輯資料。</span><span class="sxs-lookup"><span data-stu-id="b6f78-109">In the previous tutorial you used the `EntityDataSource` control to display and edit data.</span></span> <span data-ttu-id="b6f78-110">在本教學課程中，您將會篩選、排序和分組資料。</span><span class="sxs-lookup"><span data-stu-id="b6f78-110">In this tutorial you'll filter, order, and group data.</span></span> <span data-ttu-id="b6f78-111">當您藉由設定 `EntityDataSource` 控制項的屬性來執行此動作時，語法會與其他資料來源控制項不同。</span><span class="sxs-lookup"><span data-stu-id="b6f78-111">When you do this by setting properties of the `EntityDataSource` control, the syntax is different from other data source controls.</span></span> <span data-ttu-id="b6f78-112">不過您會發現，您可以使用 `QueryExtender` 控制項，將這些差異降到最低。</span><span class="sxs-lookup"><span data-stu-id="b6f78-112">As you'll see, however, you can use the `QueryExtender` control to minimize these differences.</span></span>

<span data-ttu-id="b6f78-113">您將變更 [student] 頁面來*篩選學生、* 依名稱排序，以及搜尋 [名稱]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-113">You'll change the *Students.aspx* page to filter for students, sort by name, and search on name.</span></span> <span data-ttu-id="b6f78-114">您也會變更 [*課程 .aspx* ] 頁面，以顯示所選部門的課程，並依名稱搜尋課程。</span><span class="sxs-lookup"><span data-stu-id="b6f78-114">You'll also change the *Courses.aspx* page to display courses for the selected department and search for courses by name.</span></span> <span data-ttu-id="b6f78-115">最後，您會將學生統計資料新增至*About .aspx*頁面。</span><span class="sxs-lookup"><span data-stu-id="b6f78-115">Finally, you'll add student statistics to the *About.aspx* page.</span></span>

<span data-ttu-id="b6f78-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span></span>

<span data-ttu-id="b6f78-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span></span>

<span data-ttu-id="b6f78-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span></span>

<span data-ttu-id="b6f78-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span></span>

## <a name="using-the-entitydatasource-where-property-to-filter-data"></a><span data-ttu-id="b6f78-120">使用 EntityDataSource "Where" 屬性來篩選資料</span><span class="sxs-lookup"><span data-stu-id="b6f78-120">Using the EntityDataSource "Where" Property to Filter Data</span></span>

<span data-ttu-id="b6f78-121">開啟您在上一個教學課程中建立的 [*學生 .aspx* ] 頁面。</span><span class="sxs-lookup"><span data-stu-id="b6f78-121">Open the *Students.aspx* page that you created in the previous tutorial.</span></span> <span data-ttu-id="b6f78-122">如目前所設定，頁面中的 `GridView` 控制項會顯示來自 `People` 實體集的所有名稱。</span><span class="sxs-lookup"><span data-stu-id="b6f78-122">As currently configured, the `GridView` control in the page displays all the names from the `People` entity set.</span></span> <span data-ttu-id="b6f78-123">不過，您只想要顯示學生，您可以藉由選取 `Person` 具有非 null 註冊日期的實體來尋找。</span><span class="sxs-lookup"><span data-stu-id="b6f78-123">However, you want to show only students, which you can find by selecting `Person` entities that have non-null enrollment dates.</span></span>

<span data-ttu-id="b6f78-124">切換至 [**設計**視圖]，然後選取 [`EntityDataSource`] 控制項。</span><span class="sxs-lookup"><span data-stu-id="b6f78-124">Switch to **Design** view and select the `EntityDataSource` control.</span></span> <span data-ttu-id="b6f78-125">在 [屬性] 視窗中，將 `Where` 屬性設定為 `it.EnrollmentDate is not null`。</span><span class="sxs-lookup"><span data-stu-id="b6f78-125">In the **Properties** window, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>

<span data-ttu-id="b6f78-126">[![Image01](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-126">[![Image01](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span></span>

<span data-ttu-id="b6f78-127">您在 `EntityDataSource` 控制項的 `Where` 屬性中所使用的語法是 Entity SQL。</span><span class="sxs-lookup"><span data-stu-id="b6f78-127">The syntax you use in the `Where` property of the `EntityDataSource` control is Entity SQL.</span></span> <span data-ttu-id="b6f78-128">Entity SQL 與 Transact-sql 類似，但它是針對與實體（而非資料庫物件）使用而自訂的。</span><span class="sxs-lookup"><span data-stu-id="b6f78-128">Entity SQL is similar to Transact-SQL, but it's customized for use with entities rather than database objects.</span></span> <span data-ttu-id="b6f78-129">在運算式 `it.EnrollmentDate is not null`中，`it` 一字代表查詢所傳回之實體的參考。</span><span class="sxs-lookup"><span data-stu-id="b6f78-129">In the expression `it.EnrollmentDate is not null`, the word `it` represents a reference to the entity returned by the query.</span></span> <span data-ttu-id="b6f78-130">因此，`it.EnrollmentDate` 指的是 `EntityDataSource` 控制項傳回之 `Person` 實體的 `EnrollmentDate` 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6f78-130">Therefore, `it.EnrollmentDate` refers to the `EnrollmentDate` property of the `Person` entity that the `EntityDataSource` control returns.</span></span>

<span data-ttu-id="b6f78-131">執行頁面。</span><span class="sxs-lookup"><span data-stu-id="b6f78-131">Run the page.</span></span> <span data-ttu-id="b6f78-132">學生清單現在只包含學生。</span><span class="sxs-lookup"><span data-stu-id="b6f78-132">The students list now contains only students.</span></span> <span data-ttu-id="b6f78-133">（沒有任何資料列顯示在沒有註冊日期的位置）。</span><span class="sxs-lookup"><span data-stu-id="b6f78-133">(There are no rows displayed where there's no enrollment date.)</span></span>

<span data-ttu-id="b6f78-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span></span>

## <a name="using-the-entitydatasource-orderby-property-to-order-data"></a><span data-ttu-id="b6f78-135">使用 EntityDataSource "OrderBy" 屬性來排序資料</span><span class="sxs-lookup"><span data-stu-id="b6f78-135">Using the EntityDataSource "OrderBy" Property to Order Data</span></span>

<span data-ttu-id="b6f78-136">當第一次顯示此清單時，您也會想要依名稱排序。</span><span class="sxs-lookup"><span data-stu-id="b6f78-136">You also want this list to be in name order when it's first displayed.</span></span> <span data-ttu-id="b6f78-137">在 [**設計**視圖] 中仍開啟 [student *] 頁面，* `EntityDataSource` 並在 [**屬性**] 視窗中，將 [ **OrderBy** ] 屬性設定為 [`it.LastName`]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-137">With the *Students.aspx* page still open in **Design** view, and with the `EntityDataSource` control still selected, in the **Properties** window set the **OrderBy** property to `it.LastName`.</span></span>

<span data-ttu-id="b6f78-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span></span>

<span data-ttu-id="b6f78-139">執行頁面。</span><span class="sxs-lookup"><span data-stu-id="b6f78-139">Run the page.</span></span> <span data-ttu-id="b6f78-140">學生清單現在依姓氏排序。</span><span class="sxs-lookup"><span data-stu-id="b6f78-140">The students list is now in order by last name.</span></span>

<span data-ttu-id="b6f78-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span></span>

## <a name="using-a-control-parameter-to-set-the-where-property"></a><span data-ttu-id="b6f78-142">使用控制項參數來設定 "Where" 屬性</span><span class="sxs-lookup"><span data-stu-id="b6f78-142">Using a Control Parameter to Set the "Where" Property</span></span>

<span data-ttu-id="b6f78-143">如同其他資料來源控制項，您可以將參數值傳遞給 `Where` 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6f78-143">As with other data source controls, you can pass parameter values to the `Where` property.</span></span> <span data-ttu-id="b6f78-144">在您于本教學課程的第2部分中建立的 [.aspx] 頁面上，您可以使用這個方法來顯示與使用者從下拉式清單中選取之部門相關聯的課程 *。*</span><span class="sxs-lookup"><span data-stu-id="b6f78-144">On the *Courses.aspx* page that you created in part 2 of the tutorial, you can use this method to display courses that are associated with the department that a user selects from the drop-down list.</span></span>

<span data-ttu-id="b6f78-145">開啟 [*課程*]，並切換至 [**設計**視圖]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-145">Open *Courses.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="b6f78-146">將第二個 `EntityDataSource` 控制項新增至頁面，並將其命名為 `CoursesEntityDataSource`。</span><span class="sxs-lookup"><span data-stu-id="b6f78-146">Add a second `EntityDataSource` control to the page, and name it `CoursesEntityDataSource`.</span></span> <span data-ttu-id="b6f78-147">將它連接到 `SchoolEntities` 模型，然後選取 [`Courses`] 做為**EntitySetName**值。</span><span class="sxs-lookup"><span data-stu-id="b6f78-147">Connect it to the `SchoolEntities` model, and select `Courses` as the **EntitySetName** value.</span></span>

<span data-ttu-id="b6f78-148">在 [**屬性**] 視窗中，按一下 [ **Where** ] 屬性方塊中的省略號。</span><span class="sxs-lookup"><span data-stu-id="b6f78-148">In the **Properties** window, click the ellipsis in the **Where** property box.</span></span> <span data-ttu-id="b6f78-149">（請確定在使用 [**屬性**] 視窗之前，仍選取了 [`CoursesEntityDataSource`] 控制項）。</span><span class="sxs-lookup"><span data-stu-id="b6f78-149">(Make sure the `CoursesEntityDataSource` control is still selected before using the **Properties** window.)</span></span>

<span data-ttu-id="b6f78-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span></span>

<span data-ttu-id="b6f78-151">[**運算式編輯器**] 對話方塊隨即顯示。</span><span class="sxs-lookup"><span data-stu-id="b6f78-151">The **Expression Editor** dialog box is displayed.</span></span> <span data-ttu-id="b6f78-152">在此對話方塊中，選取 **[根據提供的參數自動產生 Where 運算式**]，然後按一下 [**加入參數**]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-152">In this dialog box, select **Automatically generate the Where expression based on the provided parameters**, and then click **Add Parameter**.</span></span> <span data-ttu-id="b6f78-153">將參數命名為 `DepartmentID`，選取 [**控制項**] 做為 [**參數來源**] 值，然後選取 [ **DepartmentsDropDownList** ] 作為**ControlID**值。</span><span class="sxs-lookup"><span data-stu-id="b6f78-153">Name the parameter `DepartmentID`, select **Control** as the **Parameter source** value, and select **DepartmentsDropDownList** as the **ControlID** value.</span></span>

<span data-ttu-id="b6f78-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span></span>

<span data-ttu-id="b6f78-155">按一下 [**顯示高級屬性**]，然後在 [**運算式編輯器**] 對話方塊的 [**屬性**] 視窗中，將 [`Type`] 屬性變更為 [`Int32`]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-155">Click **Show advanced properties**, and in the **Properties** window of the **Expression Editor** dialog box, change the `Type` property to `Int32`.</span></span>

<span data-ttu-id="b6f78-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span></span>

<span data-ttu-id="b6f78-157">完成後，按一下 [ **確定**]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-157">When you're done, click **OK**.</span></span>

<span data-ttu-id="b6f78-158">在下拉式清單下方，將 [`GridView`] 控制項加入至頁面，並將其命名為 `CoursesGridView`。</span><span class="sxs-lookup"><span data-stu-id="b6f78-158">Below the drop-down list, add a `GridView` control to the page and name it `CoursesGridView`.</span></span> <span data-ttu-id="b6f78-159">將它連接到 `CoursesEntityDataSource` 資料來源控制項，按一下 [重新整理**架構**]，按一下 [**編輯資料行**]，然後移除 [`DepartmentID`] 資料行。</span><span class="sxs-lookup"><span data-stu-id="b6f78-159">Connect it to the `CoursesEntityDataSource` data source control, click **Refresh Schema**, click **Edit Columns**, and remove the `DepartmentID` column.</span></span> <span data-ttu-id="b6f78-160">`GridView` 控制項標記與下列範例類似。</span><span class="sxs-lookup"><span data-stu-id="b6f78-160">The `GridView` control markup resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample1.aspx)]

<span data-ttu-id="b6f78-161">當使用者在下拉式清單中變更選取的部門時，您會想要自動變更相關聯課程的清單。</span><span class="sxs-lookup"><span data-stu-id="b6f78-161">When the user changes the selected department in the drop-down list, you want the list of associated courses to change automatically.</span></span> <span data-ttu-id="b6f78-162">若要進行這項操作，請選取下拉式清單，然後在 [**屬性**] 視窗中，將 [`AutoPostBack`] 屬性設定為 [`True`]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-162">To make this happen, select the drop-down list, and in the **Properties** window set the `AutoPostBack` property to `True`.</span></span>

<span data-ttu-id="b6f78-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span></span>

<span data-ttu-id="b6f78-164">現在您已完成使用設計工具，請切換至**來源**視圖，並將 `CoursesEntityDataSource` 控制項的 [`ConnectionString`] 和 [`DefaultContainer` 名稱] 屬性取代為 `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6f78-164">Now that you're finished using the designer, switch to **Source** view and replace the `ConnectionString` and `DefaultContainer` name properties of the `CoursesEntityDataSource` control with the `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="b6f78-165">當您完成時，控制項的標記看起來會如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="b6f78-165">When you're done, the markup for the control will look like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample2.aspx)]

<span data-ttu-id="b6f78-166">執行頁面，並使用下拉式清單來選取不同的部門。</span><span class="sxs-lookup"><span data-stu-id="b6f78-166">Run the page and use the drop-down list to select different departments.</span></span> <span data-ttu-id="b6f78-167">只有所選部門所提供的課程會顯示在 [`GridView`] 控制項中。</span><span class="sxs-lookup"><span data-stu-id="b6f78-167">Only courses that are offered by the selected department are displayed in the `GridView` control.</span></span>

<span data-ttu-id="b6f78-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span></span>

## <a name="using-the-entitydatasource-groupby-property-to-group-data"></a><span data-ttu-id="b6f78-169">使用 EntityDataSource "GroupBy" 屬性來分組資料</span><span class="sxs-lookup"><span data-stu-id="b6f78-169">Using the EntityDataSource "GroupBy" Property to Group Data</span></span>

<span data-ttu-id="b6f78-170">假設 Contoso 大學想要在 [關於] 頁面上放入一些學生主體統計資料。</span><span class="sxs-lookup"><span data-stu-id="b6f78-170">Suppose Contoso University wants to put some student-body statistics on its About page.</span></span> <span data-ttu-id="b6f78-171">具體而言，它會想要依註冊的日期來顯示學生數目的明細。</span><span class="sxs-lookup"><span data-stu-id="b6f78-171">Specifically, it wants to show a breakdown of numbers of students by the date they enrolled.</span></span>

<span data-ttu-id="b6f78-172">開啟 [*關於 .aspx*]，然後在**原始**檔視圖中，將 `BodyContent` 控制項的現有內容取代為 `h2` 標記之間的「學生主體統計資料」：</span><span class="sxs-lookup"><span data-stu-id="b6f78-172">Open *About.aspx*, and in **Source** view, replace the existing contents of the `BodyContent` control with "Student Body Statistics" between `h2` tags:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample3.aspx)]

<span data-ttu-id="b6f78-173">在標題後面，加入 `EntityDataSource` 控制項，並將其命名為 `StudentStatisticsEntityDataSource`。</span><span class="sxs-lookup"><span data-stu-id="b6f78-173">After the heading, add an `EntityDataSource` control and name it `StudentStatisticsEntityDataSource`.</span></span> <span data-ttu-id="b6f78-174">將它連接到 `SchoolEntities`，選取 [`People`] 實體集，然後在嚮導中保持不變的 [**選取**] 方塊。</span><span class="sxs-lookup"><span data-stu-id="b6f78-174">Connect it to `SchoolEntities`, select the `People` entity set, and leave the **Select** box in the wizard unchanged.</span></span> <span data-ttu-id="b6f78-175">在 [**屬性**] 視窗中設定下列屬性：</span><span class="sxs-lookup"><span data-stu-id="b6f78-175">Set the following properties in the **Properties** window:</span></span>

- <span data-ttu-id="b6f78-176">若只要篩選學生，請將 `Where` 屬性設定為 [`it.EnrollmentDate is not null`]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-176">To filter for students only, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>
- <span data-ttu-id="b6f78-177">若要依據註冊日期將結果分組，請將 `GroupBy` 屬性設定為 [`it.EnrollmentDate`]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-177">To group the results by the enrollment date, set the `GroupBy` property to `it.EnrollmentDate`.</span></span>
- <span data-ttu-id="b6f78-178">若要選取註冊日期和學生數目，請將 [`Select`] 屬性設定為 [`it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-178">To select the enrollment date and the number of students, set the `Select` property to `it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`.</span></span>
- <span data-ttu-id="b6f78-179">若要依註冊日期排序結果，請將 `OrderBy` 屬性設為 `it.EnrollmentDate`。</span><span class="sxs-lookup"><span data-stu-id="b6f78-179">To order the results by the enrollment date, set the `OrderBy` property to `it.EnrollmentDate`.</span></span>

<span data-ttu-id="b6f78-180">在 [**來源**視圖] 中，將 [`ConnectionString`] 和 [`DefaultContainer` 名稱] 屬性取代為 `ContextTypeName` 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6f78-180">In **Source** view, replace the `ConnectionString` and `DefaultContainer` name properties with a `ContextTypeName` property.</span></span> <span data-ttu-id="b6f78-181">`EntityDataSource` 控制項標記現在與下列範例類似。</span><span class="sxs-lookup"><span data-stu-id="b6f78-181">The `EntityDataSource` control markup now resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample4.aspx)]

<span data-ttu-id="b6f78-182">除了指定目前實體的 `it` 關鍵字以外，`Select`、`GroupBy`和 `Where` 屬性的語法類似 Transact-sql。</span><span class="sxs-lookup"><span data-stu-id="b6f78-182">The syntax of the `Select`, `GroupBy`, and `Where` properties resembles Transact-SQL except for the `it` keyword that specifies the current entity.</span></span>

<span data-ttu-id="b6f78-183">新增下列標記來建立 `GridView` 控制項，以顯示資料。</span><span class="sxs-lookup"><span data-stu-id="b6f78-183">Add the following markup to create a `GridView` control to display the data.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample5.aspx)]

<span data-ttu-id="b6f78-184">執行頁面以查看顯示註冊日期的學生數目清單。</span><span class="sxs-lookup"><span data-stu-id="b6f78-184">Run the page to see a list showing the number of students by enrollment date.</span></span>

<span data-ttu-id="b6f78-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span></span>

## <a name="using-the-queryextender-control-for-filtering-and-ordering"></a><span data-ttu-id="b6f78-186">使用 QueryExtender 控制項進行篩選和排序</span><span class="sxs-lookup"><span data-stu-id="b6f78-186">Using the QueryExtender Control for Filtering and Ordering</span></span>

<span data-ttu-id="b6f78-187">`QueryExtender` 控制項提供在標記中指定篩選和排序的方法。</span><span class="sxs-lookup"><span data-stu-id="b6f78-187">The `QueryExtender` control provides a way to specify filtering and sorting in markup.</span></span> <span data-ttu-id="b6f78-188">語法與您所使用的資料庫管理系統（DBMS）無關。</span><span class="sxs-lookup"><span data-stu-id="b6f78-188">The syntax is independent of the database management system (DBMS) you're using.</span></span> <span data-ttu-id="b6f78-189">它通常也獨立于 Entity Framework，但您用於導覽屬性的語法對於 Entity Framework 而言是唯一的。</span><span class="sxs-lookup"><span data-stu-id="b6f78-189">It's also generally independent of the Entity Framework, with the exception that syntax you use for navigation properties is unique to the Entity Framework.</span></span>

<span data-ttu-id="b6f78-190">在本教學課程的這個部分中，您將使用 `QueryExtender` 控制項來篩選和排序資料，而其中一個 order by 欄位會是導覽屬性。</span><span class="sxs-lookup"><span data-stu-id="b6f78-190">In this part of the tutorial you'll use a `QueryExtender` control to filter and order data, and one of the order-by fields will be a navigation property.</span></span>

<span data-ttu-id="b6f78-191">（如果您想要使用程式碼而非標記來擴充 `EntityDataSource` 控制項自動產生的查詢，您可以藉由處理 `QueryCreated` 事件來執行此動作。</span><span class="sxs-lookup"><span data-stu-id="b6f78-191">(If you prefer to use code instead of markup to extend the queries that are automatically generated by the `EntityDataSource` control, you can do that by handling the `QueryCreated` event.</span></span> <span data-ttu-id="b6f78-192">這也是 `QueryExtender` 控制項擴充 `EntityDataSource` 控制項查詢的方式）。</span><span class="sxs-lookup"><span data-stu-id="b6f78-192">This is how the `QueryExtender` control extends `EntityDataSource` control queries also.)</span></span>

<span data-ttu-id="b6f78-193">開啟 [*課程 .aspx* ] 頁面，然後在您先前加入的標記底下，插入下列標記以建立標題、輸入搜尋字串的文字方塊、搜尋按鈕，以及系結至 `Courses` 實體集的 `EntityDataSource` 控制項。</span><span class="sxs-lookup"><span data-stu-id="b6f78-193">Open the *Courses.aspx* page, and below the markup you added previously, insert the following markup to create a heading, a text box for entering search strings, a search button, and an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample6.aspx)]

<span data-ttu-id="b6f78-194">請注意，`EntityDataSource` 控制項的 `Include` 屬性已設定為 [`Department`]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-194">Notice that the `EntityDataSource` control's `Include` property is set to `Department`.</span></span> <span data-ttu-id="b6f78-195">在資料庫中，`Course` 資料表不包含部門名稱;它包含 `DepartmentID` 外鍵資料行。</span><span class="sxs-lookup"><span data-stu-id="b6f78-195">In the database, the `Course` table does not contain the department name; it contains a `DepartmentID` foreign key column.</span></span> <span data-ttu-id="b6f78-196">如果您直接查詢資料庫，若要取得部門名稱和課程資料，您必須聯結 `Course` 和 `Department` 資料表。</span><span class="sxs-lookup"><span data-stu-id="b6f78-196">If you were querying the database directly, to get the department name along with course data, you would have to join the `Course` and `Department` tables.</span></span> <span data-ttu-id="b6f78-197">藉由將 [`Include`] 屬性設定為 [`Department`]，您可以指定 Entity Framework 在取得 `Course` 實體時，應執行取得相關 `Department` 實體的工作。</span><span class="sxs-lookup"><span data-stu-id="b6f78-197">By setting the `Include` property to `Department`, you specify that the Entity Framework should do the work of getting the related `Department` entity when it gets a `Course` entity.</span></span> <span data-ttu-id="b6f78-198">然後 `Department` 實體會儲存在 `Course` 實體的 `Department` 導覽屬性中。</span><span class="sxs-lookup"><span data-stu-id="b6f78-198">The `Department` entity is then stored in the `Department` navigation property of the `Course` entity.</span></span> <span data-ttu-id="b6f78-199">（根據預設，資料模型設計工具所產生的 `SchoolEntities` 類別會在需要時，會抓取相關資料，而且您已將資料來源控制項系結至該類別，因此不需要設定 `Include` 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6f78-199">(By default, the `SchoolEntities` class that was generated by the data model designer retrieves related data when it's needed, and you've bound the data source control to that class, so setting the `Include` property is not necessary.</span></span> <span data-ttu-id="b6f78-200">不過，設定它會改善頁面的效能，因為否則 Entity Framework 會對資料庫進行個別的呼叫，以抓取 `Course` 實體和相關 `Department` 實體的資料）。</span><span class="sxs-lookup"><span data-stu-id="b6f78-200">However, setting it improves performance of the page, because otherwise the Entity Framework would make separate calls to the database to retrieve data for the `Course` entities and for the related `Department` entities.)</span></span>

<span data-ttu-id="b6f78-201">在您剛建立的 `EntityDataSource` 控制項之後，插入下列標記以建立系結至該 `EntityDataSource` 控制項的 `QueryExtender` 控制項。</span><span class="sxs-lookup"><span data-stu-id="b6f78-201">After the `EntityDataSource` control you just created, insert the following markup to create a `QueryExtender` control that's bound to that `EntityDataSource` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample7.aspx)]

<span data-ttu-id="b6f78-202">`SearchExpression` 專案指定您想要選取標題與文字方塊中輸入的值相符的課程。</span><span class="sxs-lookup"><span data-stu-id="b6f78-202">The `SearchExpression` element specifies that you want to select courses whose titles match the value entered in the text box.</span></span> <span data-ttu-id="b6f78-203">因為 `SearchType` 屬性會指定 `StartsWith`，所以只會比較文字方塊中輸入的字元數。</span><span class="sxs-lookup"><span data-stu-id="b6f78-203">Only as many characters as are entered in the text box will be compared, because the `SearchType` property specifies `StartsWith`.</span></span>

<span data-ttu-id="b6f78-204">`OrderByExpression` 元素指定結果集將依部門名稱內的課程標題排序。</span><span class="sxs-lookup"><span data-stu-id="b6f78-204">The `OrderByExpression` element specifies that the result set will be ordered by course title within department name.</span></span> <span data-ttu-id="b6f78-205">請注意指定部門名稱的方式： `Department.Name`。</span><span class="sxs-lookup"><span data-stu-id="b6f78-205">Notice how department name is specified: `Department.Name`.</span></span> <span data-ttu-id="b6f78-206">由於 `Course` 實體與 `Department` 實體之間的關聯是一對一的，因此 `Department` 導覽屬性會包含 `Department` 實體。</span><span class="sxs-lookup"><span data-stu-id="b6f78-206">Because the association between the `Course` entity and the `Department` entity is one-to-one, the `Department` navigation property contains a `Department` entity.</span></span> <span data-ttu-id="b6f78-207">（如果這是一對多關聯性，屬性會包含集合）。若要取得部門名稱，您必須指定 `Department` 實體的 `Name` 屬性。</span><span class="sxs-lookup"><span data-stu-id="b6f78-207">(If this were a one-to-many relationship, the property would contain a collection.) To get the department name, you must specify the `Name` property of the `Department` entity.</span></span>

<span data-ttu-id="b6f78-208">最後，新增 `GridView` 控制項以顯示課程清單：</span><span class="sxs-lookup"><span data-stu-id="b6f78-208">Finally, add a `GridView` control to display the list of courses:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample8.aspx)]

<span data-ttu-id="b6f78-209">第一個資料行是範本欄位，會顯示部門名稱。</span><span class="sxs-lookup"><span data-stu-id="b6f78-209">The first column is a template field that displays the department name.</span></span> <span data-ttu-id="b6f78-210">資料系結運算式會指定 `Department.Name`，就像您在 `QueryExtender` 控制項中所看到的一樣。</span><span class="sxs-lookup"><span data-stu-id="b6f78-210">The databinding expression specifies `Department.Name`, just as you saw in the `QueryExtender` control.</span></span>

<span data-ttu-id="b6f78-211">執行頁面。</span><span class="sxs-lookup"><span data-stu-id="b6f78-211">Run the page.</span></span> <span data-ttu-id="b6f78-212">初始顯示會依部門和課程標題顯示所有課程的清單。</span><span class="sxs-lookup"><span data-stu-id="b6f78-212">The initial display shows a list of all courses in order by department and then by course title.</span></span>

<span data-ttu-id="b6f78-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span></span>

<span data-ttu-id="b6f78-214">輸入 "m"，然後按一下 [**搜尋**]，以查看標題開頭為 "m" 的所有課程（搜尋不區分大小寫）。</span><span class="sxs-lookup"><span data-stu-id="b6f78-214">Enter an "m" and click **Search** to see all courses whose titles begin with "m" (the search is not case sensitive).</span></span>

<span data-ttu-id="b6f78-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span></span>

## <a name="using-the-like-operator-to-filter-data"></a><span data-ttu-id="b6f78-216">使用 "Like" 運算子來篩選資料</span><span class="sxs-lookup"><span data-stu-id="b6f78-216">Using the "Like" Operator to Filter Data</span></span>

<span data-ttu-id="b6f78-217">您可以使用 `Like` 控制項的 `EntityDataSource` 屬性中的 `Where` 運算子，來達到與 `QueryExtender` 控制項的 `StartsWith`、`Contains`和 `EndsWith` 搜尋類型類似的效果。</span><span class="sxs-lookup"><span data-stu-id="b6f78-217">You can achieve an effect similar to the `QueryExtender` control's `StartsWith`, `Contains`, and `EndsWith` search types by using a `Like` operator in the `EntityDataSource` control's `Where` property.</span></span> <span data-ttu-id="b6f78-218">在本教學課程的這個部分中，您將瞭解如何使用 `Like` 運算子依名稱搜尋學生。</span><span class="sxs-lookup"><span data-stu-id="b6f78-218">In this part of the tutorial, you'll see how to use the `Like` operator to search for a student by name.</span></span>

<span data-ttu-id="b6f78-219">在**原始**檔視圖中開啟*student。*</span><span class="sxs-lookup"><span data-stu-id="b6f78-219">Open *Students.aspx* in **Source** view.</span></span> <span data-ttu-id="b6f78-220">在 `GridView` 控制項之後，加入下列標記：</span><span class="sxs-lookup"><span data-stu-id="b6f78-220">After the `GridView` control, add the following markup:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample9.aspx)]

<span data-ttu-id="b6f78-221">此標記類似于您稍早所見的，但 `Where` 屬性值除外。</span><span class="sxs-lookup"><span data-stu-id="b6f78-221">This markup is similar to what you've seen earlier except for the `Where` property value.</span></span> <span data-ttu-id="b6f78-222">`Where` 運算式的第二個部分會定義子字串搜尋（`LIKE %FirstMidName% or LIKE %LastName%`），以搜尋文字方塊中所輸入之名稱的名字和姓氏。</span><span class="sxs-lookup"><span data-stu-id="b6f78-222">The second part of the `Where` expression defines a substring search (`LIKE %FirstMidName% or LIKE %LastName%`) that searches both the first and last names for whatever is entered in the text box.</span></span>

<span data-ttu-id="b6f78-223">執行頁面。</span><span class="sxs-lookup"><span data-stu-id="b6f78-223">Run the page.</span></span> <span data-ttu-id="b6f78-224">一開始您會看到所有學生，因為 `StudentName` 參數的預設值為 "%"。</span><span class="sxs-lookup"><span data-stu-id="b6f78-224">Initially you see all of the students because the default value for the `StudentName` parameter is "%".</span></span>

<span data-ttu-id="b6f78-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span></span>

<span data-ttu-id="b6f78-226">在文字方塊中輸入字母 "g"，然後按一下 [**搜尋**]。</span><span class="sxs-lookup"><span data-stu-id="b6f78-226">Enter the letter "g" in the text box and click **Search**.</span></span> <span data-ttu-id="b6f78-227">您會在名字或姓氏看到有 "g" 的學生清單。</span><span class="sxs-lookup"><span data-stu-id="b6f78-227">You see a list of students that have a "g" in either the first or last name.</span></span>

<span data-ttu-id="b6f78-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="b6f78-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span></span>

<span data-ttu-id="b6f78-229">您現在已從個別資料表顯示、更新、篩選、排序和分組資料。</span><span class="sxs-lookup"><span data-stu-id="b6f78-229">You've now displayed, updated, filtered, ordered, and grouped data from individual tables.</span></span> <span data-ttu-id="b6f78-230">在下一個教學課程中，您將開始使用相關資料（主版詳細案例）。</span><span class="sxs-lookup"><span data-stu-id="b6f78-230">In the next tutorial you'll begin to work with related data (master-detail scenarios).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b6f78-231">[上一頁](the-entity-framework-and-aspnet-getting-started-part-2.md)
> [下一頁](the-entity-framework-and-aspnet-getting-started-part-4.md)</span><span class="sxs-lookup"><span data-stu-id="b6f78-231">[Previous](the-entity-framework-and-aspnet-getting-started-part-2.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-4.md)</span></span>
