---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-6
title: Entity Framework 4.0 Database First 和 ASP.NET 4 Web form 的消費者入門-第6部分 |Microsoft Docs
author: tdykstra
description: Contoso 大學範例 web 應用程式示範如何使用 Entity Framework 來建立 ASP.NET Web Forms 應用程式。 範例應用程式為 。
ms.author: riande
ms.date: 12/03/2010
ms.assetid: 994a5496-c648-4830-b03c-55bb43f325d2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-6
msc.type: authoredcontent
ms.openlocfilehash: 8bfbe74f90eb03ea9aab7610842ef2578e80d113
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78564222"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-6"></a><span data-ttu-id="f46ef-104">Entity Framework 4.0 Database First 和 ASP.NET 4 Web form 的消費者入門-第6部分</span><span class="sxs-lookup"><span data-stu-id="f46ef-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 6</span></span>

<span data-ttu-id="f46ef-105">由[Tom 作者: dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="f46ef-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="f46ef-106">Contoso 大學範例 web 應用程式示範如何使用 Entity Framework 4.0 和 Visual Studio 2010 來建立 ASP.NET Web Forms 應用程式。</span><span class="sxs-lookup"><span data-stu-id="f46ef-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="f46ef-107">如需教學課程系列的資訊，請參閱本[系列的第一個教學](the-entity-framework-and-aspnet-getting-started-part-1.md)課程</span><span class="sxs-lookup"><span data-stu-id="f46ef-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="implementing-table-per-hierarchy-inheritance"></a><span data-ttu-id="f46ef-108">實作每個階層的資料表繼承</span><span class="sxs-lookup"><span data-stu-id="f46ef-108">Implementing Table-per-Hierarchy Inheritance</span></span>

<span data-ttu-id="f46ef-109">在上一個教學課程中，您會藉由新增和刪除關聯性，以及加入具有現有實體關聯性的新實體來處理相關資料。</span><span class="sxs-lookup"><span data-stu-id="f46ef-109">In the previous tutorial you worked with related data by adding and deleting relationships and by adding a new entity that had a relationship to an existing entity.</span></span> <span data-ttu-id="f46ef-110">本教學課程將示範如何在資料模型中實作繼承。</span><span class="sxs-lookup"><span data-stu-id="f46ef-110">This tutorial will show you how to implement inheritance in the data model.</span></span>

<span data-ttu-id="f46ef-111">在物件導向程式設計中，您可以使用繼承，讓您更輕鬆地使用相關的類別。</span><span class="sxs-lookup"><span data-stu-id="f46ef-111">In object-oriented programming, you can use inheritance to make it easier to work with related classes.</span></span> <span data-ttu-id="f46ef-112">例如，您可以建立 `Instructor`，並 `Student` 衍生自 `Person` 基類的類別。</span><span class="sxs-lookup"><span data-stu-id="f46ef-112">For example, you could create `Instructor` and `Student` classes that derive from a `Person` base class.</span></span> <span data-ttu-id="f46ef-113">您可以在 Entity Framework 中的實體之間建立相同類型的繼承結構。</span><span class="sxs-lookup"><span data-stu-id="f46ef-113">You can create the same kinds of inheritance structures among entities in the Entity Framework.</span></span>

<span data-ttu-id="f46ef-114">在本教學課程的這個部分中，您不會建立任何新的網頁。</span><span class="sxs-lookup"><span data-stu-id="f46ef-114">In this part of the tutorial, you won't create any new web pages.</span></span> <span data-ttu-id="f46ef-115">相反地，您會將衍生的實體加入至資料模型，並修改現有的頁面以使用新的實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-115">Instead, you'll add derived entities to the data model and modify existing pages to use the new entities.</span></span>

## <a name="table-per-hierarchy-versus-table-per-type-inheritance"></a><span data-ttu-id="f46ef-116">每個階層的資料表與每個類型的資料表繼承</span><span class="sxs-lookup"><span data-stu-id="f46ef-116">Table-per-Hierarchy versus Table-per-Type Inheritance</span></span>

<span data-ttu-id="f46ef-117">資料庫可以將相關物件的資訊儲存在一個資料表或多個資料表中。</span><span class="sxs-lookup"><span data-stu-id="f46ef-117">A database can store information about related objects in one table or in multiple tables.</span></span> <span data-ttu-id="f46ef-118">例如，在 `School` 資料庫中，`Person` 資料表會在單一資料表中包含學生和講師的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="f46ef-118">For example, in the `School` database, the `Person` table includes information about both students and instructors in a single table.</span></span> <span data-ttu-id="f46ef-119">有些資料行僅適用于講師（`HireDate`），部分只有學生（`EnrollmentDate`），而有些則是（`LastName`，`FirstName`）。</span><span class="sxs-lookup"><span data-stu-id="f46ef-119">Some of the columns apply only to instructors (`HireDate`), some only to students (`EnrollmentDate`), and some to both (`LastName`, `FirstName`).</span></span>

<span data-ttu-id="f46ef-120">[![image11](the-entity-framework-and-aspnet-getting-started-part-6/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-120">[![image11](the-entity-framework-and-aspnet-getting-started-part-6/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image1.png)</span></span>

<span data-ttu-id="f46ef-121">您可以設定 Entity Framework 來建立 `Instructor` 和 `Student` 繼承自 `Person` 實體的實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-121">You can configure the Entity Framework to create `Instructor` and `Student` entities that inherit from the `Person` entity.</span></span> <span data-ttu-id="f46ef-122">從單一資料庫資料表產生實體繼承結構的這種模式稱為「*每個階層的資料表*」（TPH）繼承。</span><span class="sxs-lookup"><span data-stu-id="f46ef-122">This pattern of generating an entity inheritance structure from a single database table is called *table-per-hierarchy* (TPH) inheritance.</span></span>

<span data-ttu-id="f46ef-123">針對課程，`School` 資料庫會使用不同的模式。</span><span class="sxs-lookup"><span data-stu-id="f46ef-123">For courses, the `School` database uses a different pattern.</span></span> <span data-ttu-id="f46ef-124">線上課程和現場課程會儲存在不同的資料表中，每個都有一個指向 `Course` 資料表的外鍵。</span><span class="sxs-lookup"><span data-stu-id="f46ef-124">Online courses and onsite courses are stored in separate tables, each of which has a foreign key that points to the `Course` table.</span></span> <span data-ttu-id="f46ef-125">這兩種課程類型通用的資訊只會儲存在 `Course` 資料表中。</span><span class="sxs-lookup"><span data-stu-id="f46ef-125">Information common to both course types is stored only in the `Course` table.</span></span>

<span data-ttu-id="f46ef-126">[![image12](the-entity-framework-and-aspnet-getting-started-part-6/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-126">[![image12](the-entity-framework-and-aspnet-getting-started-part-6/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image3.png)</span></span>

<span data-ttu-id="f46ef-127">您可以設定 Entity Framework 資料模型，讓 `OnlineCourse` 和 `OnsiteCourse` 實體繼承自 `Course` 實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-127">You can configure the Entity Framework data model so that `OnlineCourse` and `OnsiteCourse` entities inherit from the `Course` entity.</span></span> <span data-ttu-id="f46ef-128">這種模式會從每個類型的個別資料表產生實體繼承結構，而每個不同的資料表會參照回一個資料表來儲存所有類型的通用資料，稱為「*資料表/類型*」（TPT）繼承。</span><span class="sxs-lookup"><span data-stu-id="f46ef-128">This pattern of generating an entity inheritance structure from separate tables for each type, with each separate table referring back to a table that stores data common to all types, is called *table per type* (TPT) inheritance.</span></span>

<span data-ttu-id="f46ef-129">在 Entity Framework 中，TPH 繼承模式通常會比 TPT 繼承模式提供更好的效能，因為 TPT 模式可能會導致複雜的聯結查詢。</span><span class="sxs-lookup"><span data-stu-id="f46ef-129">TPH inheritance patterns generally deliver better performance in the Entity Framework than TPT inheritance patterns, because TPT patterns can result in complex join queries.</span></span> <span data-ttu-id="f46ef-130">本逐步解說示範如何執行 TPH 繼承。</span><span class="sxs-lookup"><span data-stu-id="f46ef-130">This walkthrough demonstrates how to implement TPH inheritance.</span></span> <span data-ttu-id="f46ef-131">您將執行下列步驟來執行此動作：</span><span class="sxs-lookup"><span data-stu-id="f46ef-131">You'll do that by performing the following steps:</span></span>

- <span data-ttu-id="f46ef-132">建立衍生自 `Person`的 `Instructor` 和 `Student` 實體類型。</span><span class="sxs-lookup"><span data-stu-id="f46ef-132">Create `Instructor` and `Student` entity types that derive from `Person`.</span></span>
- <span data-ttu-id="f46ef-133">將與衍生實體相關的屬性從 `Person` 實體移至衍生的實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-133">Move properties that pertain to the derived entities from the `Person` entity to the derived entities.</span></span>
- <span data-ttu-id="f46ef-134">設定衍生類型中屬性的條件約束。</span><span class="sxs-lookup"><span data-stu-id="f46ef-134">Set constraints on properties in the derived types.</span></span>
- <span data-ttu-id="f46ef-135">將 `Person` 實體設為抽象實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-135">Make the `Person` entity an abstract entity.</span></span>
- <span data-ttu-id="f46ef-136">將每個衍生實體對應至 `Person` 資料表，並指定如何判斷 `Person` 資料列是否代表該衍生類型的條件。</span><span class="sxs-lookup"><span data-stu-id="f46ef-136">Map each derived entity to the `Person` table with a condition that specifies how to determine whether a `Person` row represents that derived type.</span></span>

## <a name="adding-instructor-and-student-entities"></a><span data-ttu-id="f46ef-137">新增講師和學生實體</span><span class="sxs-lookup"><span data-stu-id="f46ef-137">Adding Instructor and Student Entities</span></span>

<span data-ttu-id="f46ef-138">開啟 [ <em>SchoolModel</em> ] 檔案，以滑鼠右鍵按一下設計工具中未佔用的區域，選取 [<strong>新增</strong>]，然後選取 [<strong>實體</strong>]<em>。</em></span><span class="sxs-lookup"><span data-stu-id="f46ef-138">Open the <em>SchoolModel.edmx</em> file, right-click an unoccupied area in the designer, select <strong>Add</strong>, then select <strong>Entity</strong><em>.</em></span></span>

<span data-ttu-id="f46ef-139">[![image01](the-entity-framework-and-aspnet-getting-started-part-6/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-139">[![image01](the-entity-framework-and-aspnet-getting-started-part-6/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image5.png)</span></span>

<span data-ttu-id="f46ef-140">在 [**加入實體**] 對話方塊中，將實體命名為 `Instructor`，並將其 [**基底類型**] 選項設定為 [`Person`]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-140">In the **Add Entity** dialog box, name the entity `Instructor` and set its **Base type** option to `Person`.</span></span>

<span data-ttu-id="f46ef-141">[![image02](the-entity-framework-and-aspnet-getting-started-part-6/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-141">[![image02](the-entity-framework-and-aspnet-getting-started-part-6/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image7.png)</span></span>

<span data-ttu-id="f46ef-142">按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-142">Click **OK**.</span></span> <span data-ttu-id="f46ef-143">設計工具會建立衍生自 `Person` 實體的 `Instructor` 實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-143">The designer creates an `Instructor` entity that derives from the `Person` entity.</span></span> <span data-ttu-id="f46ef-144">新實體還沒有任何屬性。</span><span class="sxs-lookup"><span data-stu-id="f46ef-144">The new entity does not yet have any properties.</span></span>

<span data-ttu-id="f46ef-145">[![image03](the-entity-framework-and-aspnet-getting-started-part-6/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-145">[![image03](the-entity-framework-and-aspnet-getting-started-part-6/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image9.png)</span></span>

<span data-ttu-id="f46ef-146">重複此程式，建立也衍生自 `Person`的 `Student` 實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-146">Repeat the procedure to create a `Student` entity that also derives from `Person`.</span></span>

<span data-ttu-id="f46ef-147">只有講師擁有雇用日期，因此您必須將該屬性從 `Person` 實體移至 `Instructor` 實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-147">Only instructors have hire dates, so you need to move that property from the `Person` entity to the `Instructor` entity.</span></span> <span data-ttu-id="f46ef-148">在 [`Person`] 實體中，以滑鼠右鍵按一下 `HireDate` 屬性，然後按一下 [**剪**下]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-148">In the `Person` entity, right-click the `HireDate` property and click **Cut**.</span></span> <span data-ttu-id="f46ef-149">然後以滑鼠右鍵按一下 `Instructor` 實體中的 [**屬性**]，然後按一下 [**貼**上]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-149">Then right-click **Properties** in the `Instructor` entity and click **Paste**.</span></span>

<span data-ttu-id="f46ef-150">[![image04](the-entity-framework-and-aspnet-getting-started-part-6/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-150">[![image04](the-entity-framework-and-aspnet-getting-started-part-6/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image11.png)</span></span>

<span data-ttu-id="f46ef-151">`Instructor` 實體的雇用日期不可以是 null。</span><span class="sxs-lookup"><span data-stu-id="f46ef-151">The hire date of an `Instructor` entity cannot be null.</span></span> <span data-ttu-id="f46ef-152">以滑鼠右鍵按一下 [`HireDate`] 屬性，然後按一下 [**屬性**]，然後在 [**屬性**] 視窗中，將 `Nullable` 變更為 [`False`]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-152">Right-click the `HireDate` property, click **Properties**, and then in the **Properties** window change `Nullable` to `False`.</span></span>

<span data-ttu-id="f46ef-153">[![image05](the-entity-framework-and-aspnet-getting-started-part-6/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-153">[![image05](the-entity-framework-and-aspnet-getting-started-part-6/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image13.png)</span></span>

<span data-ttu-id="f46ef-154">重複此程式，將 `EnrollmentDate` 屬性從 `Person` 實體移至 `Student` 實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-154">Repeat the procedure to move the `EnrollmentDate` property from the `Person` entity to the `Student` entity.</span></span> <span data-ttu-id="f46ef-155">請確定您也將 [`Nullable`] 設定為 [`EnrollmentDate`] 屬性的 [`False`]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-155">Make sure that you also set `Nullable` to `False` for the `EnrollmentDate` property.</span></span>

<span data-ttu-id="f46ef-156">現在，`Person` 實體只有 `Instructor` 和 `Student` 實體通用的屬性（除了不會移動的導覽屬性以外），實體只能用來做為繼承結構中的基底實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-156">Now that a `Person` entity has only the properties that are common to `Instructor` and `Student` entities (aside from navigation properties, which you're not moving), the entity can only be used as a base entity in the inheritance structure.</span></span> <span data-ttu-id="f46ef-157">因此，您必須確保它永遠不會被視為獨立的實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-157">Therefore, you need to ensure that it's never treated as an independent entity.</span></span> <span data-ttu-id="f46ef-158">以滑鼠右鍵按一下 [`Person`] 實體，選取 [**屬性**]，然後在 [**屬性**] 視窗中，將 [ **Abstract** ] 屬性的值變更為 [ **True**]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-158">Right-click the `Person` entity, select **Properties**, and then in the **Properties** window change the value of the **Abstract** property to **True**.</span></span>

<span data-ttu-id="f46ef-159">[![image06](the-entity-framework-and-aspnet-getting-started-part-6/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-159">[![image06](the-entity-framework-and-aspnet-getting-started-part-6/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image15.png)</span></span>

## <a name="mapping-instructor-and-student-entities-to-the-person-table"></a><span data-ttu-id="f46ef-160">將講師和 Student 實體對應至 Person 資料表</span><span class="sxs-lookup"><span data-stu-id="f46ef-160">Mapping Instructor and Student Entities to the Person Table</span></span>

<span data-ttu-id="f46ef-161">現在您需要告訴 Entity Framework 如何區分資料庫中的 `Instructor` 和 `Student` 實體。</span><span class="sxs-lookup"><span data-stu-id="f46ef-161">Now you need to tell the Entity Framework how to differentiate between `Instructor` and `Student` entities in the database.</span></span>

<span data-ttu-id="f46ef-162">以滑鼠右鍵按一下 [`Instructor`] 實體，然後選取 [**資料表對應**]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-162">Right-click the `Instructor` entity and select **Table Mapping**.</span></span> <span data-ttu-id="f46ef-163">在 [**對應詳細資料**] 視窗中，按一下 [**加入資料表或視圖**]，然後選取 [**人員**]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-163">In the **Mapping Details** window, click **Add a Table or View** and select **Person**.</span></span>

<span data-ttu-id="f46ef-164">[![image07](the-entity-framework-and-aspnet-getting-started-part-6/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-164">[![image07](the-entity-framework-and-aspnet-getting-started-part-6/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image17.png)</span></span>

<span data-ttu-id="f46ef-165">按一下 [**新增條件**]，然後選取 [**雇用**日期]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-165">Click **Add a Condition**, and then select **HireDate**.</span></span>

<span data-ttu-id="f46ef-166">[![image09](the-entity-framework-and-aspnet-getting-started-part-6/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-166">[![image09](the-entity-framework-and-aspnet-getting-started-part-6/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image19.png)</span></span>

<span data-ttu-id="f46ef-167">將 [ **Operator** ] 變更為 [ **Is** ]，將 [**值/屬性**] 改為**Not Null**</span><span class="sxs-lookup"><span data-stu-id="f46ef-167">Change **Operator** to **Is** and **Value / Property** to **Not Null**.</span></span>

<span data-ttu-id="f46ef-168">[![image10](the-entity-framework-and-aspnet-getting-started-part-6/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-168">[![image10](the-entity-framework-and-aspnet-getting-started-part-6/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image21.png)</span></span>

<span data-ttu-id="f46ef-169">針對 `Students` 實體重複此程式，指定當 `EnrollmentDate` 的資料行不是 null 時，這個實體會對應到 `Person` 資料表。</span><span class="sxs-lookup"><span data-stu-id="f46ef-169">Repeat the procedure for the `Students` entity, specifying that this entity maps to the `Person` table when the `EnrollmentDate` column is not null.</span></span> <span data-ttu-id="f46ef-170">然後儲存並關閉資料模型。</span><span class="sxs-lookup"><span data-stu-id="f46ef-170">Then save and close the data model.</span></span>

<span data-ttu-id="f46ef-171">建立專案，以建立新的實體做為類別，並在設計工具中提供它們。</span><span class="sxs-lookup"><span data-stu-id="f46ef-171">Build the project in order to create the new entities as classes and make them available in the designer.</span></span>

## <a name="using-the-instructor-and-student-entities"></a><span data-ttu-id="f46ef-172">使用講師和學生實體</span><span class="sxs-lookup"><span data-stu-id="f46ef-172">Using the Instructor and Student Entities</span></span>

<span data-ttu-id="f46ef-173">當您建立使用學生和講師資料的網頁時，您會將它們系結至 `Person` 實體集，並根據 `HireDate` 或 `EnrollmentDate` 屬性進行篩選，以將傳回的資料限制為學生或講師。</span><span class="sxs-lookup"><span data-stu-id="f46ef-173">When you created the web pages that work with student and instructor data, you databound them to the `Person` entity set, and you filtered on the `HireDate` or `EnrollmentDate` property to restrict the returned data to students or instructors.</span></span> <span data-ttu-id="f46ef-174">不過，現在當您將每個資料來源控制項系結至 `Person` 實體集時，您可以指定只選取 `Student` 或 `Instructor` 的實體類型。</span><span class="sxs-lookup"><span data-stu-id="f46ef-174">However, now when you bind each data source control to the `Person` entity set, you can specify that only `Student` or `Instructor` entity types should be selected.</span></span> <span data-ttu-id="f46ef-175">因為 Entity Framework 知道如何區分 `Person` 實體集中的學生和講師，所以您可以移除手動輸入的 `Where` 屬性設定來執行此動作。</span><span class="sxs-lookup"><span data-stu-id="f46ef-175">Because the Entity Framework knows how to differentiate students and instructors in the `Person` entity set, you can remove the `Where` property settings you entered manually to do that.</span></span>

<span data-ttu-id="f46ef-176">在 Visual Studio 設計工具中，您可以在 [`Configure Data Source` wizard] 的 [ **EntityTypeFilter** ] 下拉式方塊中指定 `EntityDataSource` 控制項應選取的實體類型，如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="f46ef-176">In the Visual Studio Designer, you can specify the entity type that an `EntityDataSource` control should select in the **EntityTypeFilter** drop-down box of the `Configure Data Source` wizard, as shown in the following example.</span></span>

<span data-ttu-id="f46ef-177">[![image13](the-entity-framework-and-aspnet-getting-started-part-6/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-177">[![image13](the-entity-framework-and-aspnet-getting-started-part-6/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image23.png)</span></span>

<span data-ttu-id="f46ef-178">在 [**屬性**] 視窗中，您可以移除不再需要的 `Where` 子句值，如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="f46ef-178">And in the **Properties** window you can remove `Where` clause values that are no longer needed, as shown in the following example.</span></span>

<span data-ttu-id="f46ef-179">[![image14](the-entity-framework-and-aspnet-getting-started-part-6/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-179">[![image14](the-entity-framework-and-aspnet-getting-started-part-6/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image25.png)</span></span>

<span data-ttu-id="f46ef-180">不過，因為您已將 `EntityDataSource` 控制項的標記變更為使用 `ContextTypeName` 屬性，所以無法在已建立的 `EntityDataSource` 控制項上執行 [**設定資料來源**]。</span><span class="sxs-lookup"><span data-stu-id="f46ef-180">However, because you've changed the markup for `EntityDataSource` controls to use the `ContextTypeName` attribute, you cannot run the **Configure Data Source** wizard on `EntityDataSource` controls that you've already created.</span></span> <span data-ttu-id="f46ef-181">因此，您將改為變更標記來進行所需的變更。</span><span class="sxs-lookup"><span data-stu-id="f46ef-181">Therefore, you'll make the required changes by changing markup instead.</span></span>

<span data-ttu-id="f46ef-182">開啟 [ *student] 頁面。*</span><span class="sxs-lookup"><span data-stu-id="f46ef-182">Open the *Students.aspx* page.</span></span> <span data-ttu-id="f46ef-183">在 `StudentsEntityDataSource` 控制項中，移除 `Where` 屬性，並加入 `EntityTypeFilter="Student"` 屬性。</span><span class="sxs-lookup"><span data-stu-id="f46ef-183">In the `StudentsEntityDataSource` control, remove the `Where` attribute and add an `EntityTypeFilter="Student"` attribute.</span></span> <span data-ttu-id="f46ef-184">標記現在會類似下列範例：</span><span class="sxs-lookup"><span data-stu-id="f46ef-184">The markup will now resemble the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample1.aspx)]

<span data-ttu-id="f46ef-185">設定 `EntityTypeFilter` 屬性可確保 `EntityDataSource` 控制項只會選取指定的實體類型。</span><span class="sxs-lookup"><span data-stu-id="f46ef-185">Setting the `EntityTypeFilter` attribute ensures that the `EntityDataSource` control will select only the specified entity type.</span></span> <span data-ttu-id="f46ef-186">如果您想要同時取得 `Student` 和 `Instructor` 實體類型，則不會設定這個屬性。</span><span class="sxs-lookup"><span data-stu-id="f46ef-186">If you wanted to retrieve both `Student` and `Instructor` entity types, you would not set this attribute.</span></span> <span data-ttu-id="f46ef-187">（只有當您使用控制項進行唯讀資料存取時，才可以選擇使用一個 `EntityDataSource` 控制項來抓取多個實體類型。</span><span class="sxs-lookup"><span data-stu-id="f46ef-187">(You have the option of retrieving multiple entity types with one `EntityDataSource` control only if you're using the control for read-only data access.</span></span> <span data-ttu-id="f46ef-188">如果您使用 `EntityDataSource` 控制項來插入、更新或刪除實體，而且它所系結的實體集可以包含多個類型，您只能使用一個實體類型，而您必須設定此屬性。）</span><span class="sxs-lookup"><span data-stu-id="f46ef-188">If you're using an `EntityDataSource` control to insert, update, or delete entities, and if the entity set it's bound to can contain multiple types, you can only work with one entity type, and you have to set this attribute.)</span></span>

<span data-ttu-id="f46ef-189">針對 `SearchEntityDataSource` 控制項重複此程式，但只移除 `Where` 屬性的部分，其中只會選取 `Student` 實體，而不是完全移除屬性。</span><span class="sxs-lookup"><span data-stu-id="f46ef-189">Repeat the procedure for the `SearchEntityDataSource` control, except remove only the part of the `Where` attribute that selects `Student` entities instead of removing the property altogether.</span></span> <span data-ttu-id="f46ef-190">控制項的開頭標記現在會如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="f46ef-190">The opening tag of the control will now resemble the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample2.aspx)]

<span data-ttu-id="f46ef-191">執行頁面，確認它的運作方式與之前相同。</span><span class="sxs-lookup"><span data-stu-id="f46ef-191">Run the page to verify that it still works as it did before.</span></span>

<span data-ttu-id="f46ef-192">[![image15](the-entity-framework-and-aspnet-getting-started-part-6/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-192">[![image15](the-entity-framework-and-aspnet-getting-started-part-6/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image27.png)</span></span>

<span data-ttu-id="f46ef-193">更新您在先前的教學課程中建立的下列頁面，使其使用新的 `Student` 並 `Instructor` 實體，而不是 `Person` 實體，然後執行它們以確認其運作方式與之前相同：</span><span class="sxs-lookup"><span data-stu-id="f46ef-193">Update the following pages that you created in earlier tutorials so that they use the new `Student` and `Instructor` entities instead of `Person` entities, then run them to verify that they work as they did before:</span></span>

- <span data-ttu-id="f46ef-194">在*StudentsAdd*中，將 `EntityTypeFilter="Student"` 新增至 `StudentsEntityDataSource` 控制項。</span><span class="sxs-lookup"><span data-stu-id="f46ef-194">In *StudentsAdd.aspx*, add `EntityTypeFilter="Student"` to the `StudentsEntityDataSource` control.</span></span> <span data-ttu-id="f46ef-195">標記現在會類似下列範例：</span><span class="sxs-lookup"><span data-stu-id="f46ef-195">The markup will now resemble the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample3.aspx)]

    <span data-ttu-id="f46ef-196">[![image16](the-entity-framework-and-aspnet-getting-started-part-6/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-196">[![image16](the-entity-framework-and-aspnet-getting-started-part-6/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image29.png)</span></span>
- <span data-ttu-id="f46ef-197">在 [*關於 .aspx*] 中，將 `EntityTypeFilter="Student"` 新增至 `StudentStatisticsEntityDataSource` 控制項，並移除 `Where="it.EnrollmentDate is not null"`。</span><span class="sxs-lookup"><span data-stu-id="f46ef-197">In *About.aspx*, add `EntityTypeFilter="Student"` to the `StudentStatisticsEntityDataSource` control and remove `Where="it.EnrollmentDate is not null"`.</span></span> <span data-ttu-id="f46ef-198">標記現在會類似下列範例：</span><span class="sxs-lookup"><span data-stu-id="f46ef-198">The markup will now resemble the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample4.aspx)]

    <span data-ttu-id="f46ef-199">[![image17](the-entity-framework-and-aspnet-getting-started-part-6/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-199">[![image17](the-entity-framework-and-aspnet-getting-started-part-6/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image31.png)</span></span>
- <span data-ttu-id="f46ef-200">在 [ *.aspx* ] 和 [ *InstructorsCourses*] 中，將 `EntityTypeFilter="Instructor"` 新增至 `InstructorsEntityDataSource` 控制項，並移除 `Where="it.HireDate is not null"`。</span><span class="sxs-lookup"><span data-stu-id="f46ef-200">In *Instructors.aspx* and *InstructorsCourses.aspx*, add `EntityTypeFilter="Instructor"` to the `InstructorsEntityDataSource` control and remove `Where="it.HireDate is not null"`.</span></span> <span data-ttu-id="f46ef-201">在*講師*中的標記現在與下列範例類似：</span><span class="sxs-lookup"><span data-stu-id="f46ef-201">The markup in *Instructors.aspx* now resembles the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample5.aspx)]

    <span data-ttu-id="f46ef-202">[![image18](the-entity-framework-and-aspnet-getting-started-part-6/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-202">[![image18](the-entity-framework-and-aspnet-getting-started-part-6/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image33.png)</span></span>

    <span data-ttu-id="f46ef-203">*InstructorsCourses*中的標記現在會如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="f46ef-203">The markup in *InstructorsCourses.aspx* will now resemble the following example:</span></span>

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample6.aspx)]

    <span data-ttu-id="f46ef-204">[![image19](the-entity-framework-and-aspnet-getting-started-part-6/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="f46ef-204">[![image19](the-entity-framework-and-aspnet-getting-started-part-6/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image35.png)</span></span>

<span data-ttu-id="f46ef-205">由於這些變更，您已改善 Contoso 大學應用程式的可維護性，方法有好幾種。</span><span class="sxs-lookup"><span data-stu-id="f46ef-205">As a result of these changes, you've improved the Contoso University application's maintainability in several ways.</span></span> <span data-ttu-id="f46ef-206">您已將選取和驗證邏輯移出 UI 層（ *.aspx*標記），並使它成為資料存取層的不可或缺部分。</span><span class="sxs-lookup"><span data-stu-id="f46ef-206">You've moved selection and validation logic out of the UI layer (*.aspx* markup) and made it an integral part of the data access layer.</span></span> <span data-ttu-id="f46ef-207">這有助於將您的應用程式程式碼與您未來可能會對資料庫架構或資料模型進行的變更隔離。</span><span class="sxs-lookup"><span data-stu-id="f46ef-207">This helps to isolate your application code from changes that you might make in the future to the database schema or the data model.</span></span> <span data-ttu-id="f46ef-208">例如，您可以決定將學生視為老師的輔助人員，因而取得雇用日期。</span><span class="sxs-lookup"><span data-stu-id="f46ef-208">For example, you could decide that students might be hired as teachers' aids and therefore would get a hire date.</span></span> <span data-ttu-id="f46ef-209">然後，您可以加入新的屬性來區分學生與講師，並更新資料模型。</span><span class="sxs-lookup"><span data-stu-id="f46ef-209">You could then add a new property to differentiate students from instructors and update the data model.</span></span> <span data-ttu-id="f46ef-210">Web 應用程式中的任何程式碼都不需要變更，除非您想要顯示學生的雇用日期。</span><span class="sxs-lookup"><span data-stu-id="f46ef-210">No code in the web application would need to change except where you wanted to show a hire date for students.</span></span> <span data-ttu-id="f46ef-211">新增 `Instructor` 和 `Student` 實體的另一個優點是，您的程式碼比參考實際學生或講師的 `Person` 物件更容易理解。</span><span class="sxs-lookup"><span data-stu-id="f46ef-211">Another benefit of adding `Instructor` and `Student` entities is that your code is more readily understandable than when it referred to `Person` objects that were actually students or instructors.</span></span>

<span data-ttu-id="f46ef-212">您現在已經看過在 Entity Framework 中執行繼承模式的一種方式。</span><span class="sxs-lookup"><span data-stu-id="f46ef-212">You've now seen one way to implement an inheritance pattern in the Entity Framework.</span></span> <span data-ttu-id="f46ef-213">在下列教學課程中，您將瞭解如何使用預存程式，以便更充分掌控 Entity Framework 如何存取資料庫。</span><span class="sxs-lookup"><span data-stu-id="f46ef-213">In the following tutorial, you'll learn how to use stored procedures in order to have more control over how the Entity Framework accesses the database.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f46ef-214">[上一頁](the-entity-framework-and-aspnet-getting-started-part-5.md)
> [下一頁](the-entity-framework-and-aspnet-getting-started-part-7.md)</span><span class="sxs-lookup"><span data-stu-id="f46ef-214">[Previous](the-entity-framework-and-aspnet-getting-started-part-5.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-7.md)</span></span>
