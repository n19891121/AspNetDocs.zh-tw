---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/precompiling-your-website-cs
title: 先行編譯您的C#網站（） |Microsoft Docs
author: rick-anderson
description: Visual Studio 為 ASP.NET 的開發人員提供兩種類型的專案： Web 應用程式專案（Wap）和網站專案（WSPs）。 其中一個主要差異 betwe 。
ms.author: riande
ms.date: 06/09/2009
ms.assetid: ecd5a4de-beb7-4d1d-bbbb-e31003633267
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/precompiling-your-website-cs
msc.type: authoredcontent
ms.openlocfilehash: cb42398f44f3cd16ab83a9976e7b34f132384456
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74635762"
---
# <a name="precompiling-your-website-c"></a><span data-ttu-id="15ecf-104">先行編譯您的網站 (C#)</span><span class="sxs-lookup"><span data-stu-id="15ecf-104">Precompiling Your Website (C#)</span></span>

<span data-ttu-id="15ecf-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="15ecf-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="15ecf-106">[下載程式代碼](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_15_CS.zip)或[下載 PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial15_Precompiling_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="15ecf-106">[Download Code](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_15_CS.zip) or [Download PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial15_Precompiling_cs.pdf)</span></span>

> <span data-ttu-id="15ecf-107">Visual Studio 為 ASP.NET 的開發人員提供兩種類型的專案： Web 應用程式專案（Wap）和網站專案（WSPs）。</span><span class="sxs-lookup"><span data-stu-id="15ecf-107">Visual Studio offers ASP.NET developers two types of projects: Web Application Projects (WAPs) and Web Site Projects (WSPs).</span></span> <span data-ttu-id="15ecf-108">這兩種專案類型之間的主要差異之一，是 Wap 必須在部署之前先明確編譯器代碼，而 WSP 中的程式碼可以在 web 伺服器上自動編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-108">One of the key differences between the two project types is that WAPs must have the code explicitly compiled prior to deployment whereas the code in a WSP can be automatically compiled on the web server.</span></span> <span data-ttu-id="15ecf-109">不過，您可以先行編譯 WSP，再進行部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-109">However, it is possible to precompile a WSP prior to deployment.</span></span> <span data-ttu-id="15ecf-110">本教學課程會探索先行編譯的優點，並示範如何從 Visual Studio 和命令列中先行編譯網站。</span><span class="sxs-lookup"><span data-stu-id="15ecf-110">This tutorial explores the benefits of precompilation and shows how to precompile a website from within Visual Studio and from the command line.</span></span>

## <a name="introduction"></a><span data-ttu-id="15ecf-111">簡介</span><span class="sxs-lookup"><span data-stu-id="15ecf-111">Introduction</span></span>

<span data-ttu-id="15ecf-112">Visual Studio 為 ASP.NET 的開發人員提供兩種不同的專案類型： Web 應用程式專案（WAP）和網站專案（WSP）。</span><span class="sxs-lookup"><span data-stu-id="15ecf-112">Visual Studio offers ASP.NET developers two different project types: Web Application Projects (WAP) and Web Site Projects (WSP).</span></span> <span data-ttu-id="15ecf-113">這些專案類型之間的其中一個主要差異在於，Wap 需要*明確編譯*，而 WSPs 預設會使用*自動編譯*。</span><span class="sxs-lookup"><span data-stu-id="15ecf-113">One of the key differences between these project types is that WAPs require *explicit compilation* whereas WSPs use *automatic compilation*, by default.</span></span> <span data-ttu-id="15ecf-114">透過 Wap，您可以將 web 應用程式的程式碼編譯成單一元件，並在網站的 [`Bin`] 資料夾中建立。</span><span class="sxs-lookup"><span data-stu-id="15ecf-114">With WAPs, you compile the web application's code into a single assembly, which is created in the website's `Bin` folder.</span></span> <span data-ttu-id="15ecf-115">部署需要複製專案中的標記內容（`.aspx.ascx`和 `.master` 檔案），以及 `Bin` 資料夾中的元件;程式碼後置類別檔案本身不需要部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-115">Deployment entails copying the markup content (the `.aspx.ascx`, and `.master` files) in the project, along with the assembly in the `Bin` folder; the code-behind class files themselves do not need to be deployed.</span></span> <span data-ttu-id="15ecf-116">另一方面，您可以將標記頁面及其對應的程式碼後置類別複製到實際執行環境，藉以部署 WSPs。</span><span class="sxs-lookup"><span data-stu-id="15ecf-116">On the other hand, you deploy WSPs by copying both the markup pages and their corresponding code-behind classes to the production environment.</span></span> <span data-ttu-id="15ecf-117">程式碼後置類別會視需要在網頁伺服器上編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-117">The code-behind classes are compiled on demand on the web server.</span></span>

> [!NOTE]
> <span data-ttu-id="15ecf-118">請回到[*判斷需要部署哪些*檔案教學](determining-what-files-need-to-be-deployed-cs.md)課程中的「明確編譯與自動編譯」一節，以取得有關專案模型、明確和自動編譯之間的差異，以及編譯模型如何影響部署的背景資訊。</span><span class="sxs-lookup"><span data-stu-id="15ecf-118">Refer back to the "Explicit Compilation Versus Automatic Compilation" section in the [*Determining What Files Need to Be Deployed* tutorial](determining-what-files-need-to-be-deployed-cs.md) for more background on the differences between the project models, explicit and automatic compilation, and how the compilation model affects deployment.</span></span>

<span data-ttu-id="15ecf-119">自動編譯選項很容易使用。</span><span class="sxs-lookup"><span data-stu-id="15ecf-119">The automatic compilation option is simple to use.</span></span> <span data-ttu-id="15ecf-120">沒有明確的編譯步驟，而且只需要部署已修改的檔案，而明確編譯則必須部署已變更的標記頁面和剛剛編譯的元件。</span><span class="sxs-lookup"><span data-stu-id="15ecf-120">There's no explicit compilation step and only the files that have been modified need to be deployed, whereas explicit compilation necessitates deploying the changed markup pages and the just-compiled assembly.</span></span> <span data-ttu-id="15ecf-121">不過，自動部署有兩個可能的缺點：</span><span class="sxs-lookup"><span data-stu-id="15ecf-121">However, automatic deployment has two potential drawbacks:</span></span>

- <span data-ttu-id="15ecf-122">因為頁面必須在第一次造訪時自動編譯，所以在部署後第一次要求 ASP.NET 網頁時，可能會出現短暫但明顯的延遲。</span><span class="sxs-lookup"><span data-stu-id="15ecf-122">Because the pages must be automatically compiled when they are first visited, there can be a short but noticeable delay when an ASP.NET page is requested for the first time after being deployed.</span></span>
- <span data-ttu-id="15ecf-123">自動編譯需要在 web 伺服器上同時存在宣告式標記和原始程式碼。</span><span class="sxs-lookup"><span data-stu-id="15ecf-123">Automatic compilation requires that both the declarative markup and source code be present on the web server.</span></span> <span data-ttu-id="15ecf-124">如果您計畫將 web 應用程式銷售給將在其 web 伺服器上安裝的客戶，這可能是不討喜選項。</span><span class="sxs-lookup"><span data-stu-id="15ecf-124">This can be an unattractive option if you plan on selling the web application to customers who will install it on their web servers.</span></span>

<span data-ttu-id="15ecf-125">如果上述兩個缺點的其中一個是交易斷路器，您可以切換到 WAP 模型，或在部署之前先行*編譯*WSP。</span><span class="sxs-lookup"><span data-stu-id="15ecf-125">If either of the two above shortcomings are deal breakers, you can either switch to the WAP model or *precompile* the WSP prior to deployment.</span></span> <span data-ttu-id="15ecf-126">本教學課程會檢查最適合裝載網站的先行編譯選項，並逐步解說先行編譯的網站先行編譯流程和部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-126">This tutorial examines the precompilation options best suited for a hosted website and walks through the precompilation process and deployment of a precompiled website.</span></span>

## <a name="an-overview-of-aspnet-code-generation-and-compilation"></a><span data-ttu-id="15ecf-127">ASP.NET 程式碼產生和編譯的總覽</span><span class="sxs-lookup"><span data-stu-id="15ecf-127">An Overview of ASP.NET Code Generation and Compilation</span></span>

<span data-ttu-id="15ecf-128">在查看可用的先行編譯選項之前，讓我們先討論第一次要求 ASP.NET 網頁，因為它是在建立或上次更新之後所發生的程式碼產生和編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-128">Before we look at the available precompilation options, let's first talk about the code generation and compilation that occurs when an ASP.NET page is requested for the first time since it's been created or last updated.</span></span> <span data-ttu-id="15ecf-129">如您所知，ASP.NET 網頁是由兩個部分組成： `.aspx` 檔案中的宣告式標記;和原始程式碼部分，通常是在不同的程式碼後置類別檔案（`.aspx.cs`）中。</span><span class="sxs-lookup"><span data-stu-id="15ecf-129">As you know, ASP.NET pages are composed of two portions: declarative markup in the `.aspx` file; and a source code portion, typically in a separate code-behind class file (`.aspx.cs`).</span></span> <span data-ttu-id="15ecf-130">當要求 ASP.NET 網頁時，執行時間所執行的步驟取決於應用程式的編譯模型。</span><span class="sxs-lookup"><span data-stu-id="15ecf-130">The steps performed by the runtime when an ASP.NET page is requested depends on the application's compilation model.</span></span>

<span data-ttu-id="15ecf-131">使用 Wap 時，必須先將頁面的原始程式碼明確編譯成單一元件，然後再進行部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-131">With WAPs, the pages' source code must be explicitly compiled into a single assembly before being deployed.</span></span> <span data-ttu-id="15ecf-132">在部署期間，會將此元件和各種標記頁面複製到生產環境。</span><span class="sxs-lookup"><span data-stu-id="15ecf-132">During deployment, this assembly and the various markup pages are copied to the production environment.</span></span> <span data-ttu-id="15ecf-133">當要求抵達 ASP.NET 網頁的 web 伺服器時，執行時間會建立頁面程式碼後置類別的實例，並叫用它的 `ProcessRequest` 方法，這會啟動頁面生命週期，最後會產生頁面的內容，並傳回給要求者。</span><span class="sxs-lookup"><span data-stu-id="15ecf-133">When a request arrives to the web server for an ASP.NET page, the runtime creates an instance of the page's code-behind class and invokes its `ProcessRequest` method, which starts the page lifecycle and, ultimately, generates the page's content, which is returned to the requestor.</span></span> <span data-ttu-id="15ecf-134">執行時間可以與 ASP.NET 網頁的程式碼後置類別搭配使用，因為程式碼後置類別已經在部署之前編譯成元件。</span><span class="sxs-lookup"><span data-stu-id="15ecf-134">The runtime can work with the ASP.NET page's code-behind class because the code-behind class was already compiled into an assembly prior to deployment.</span></span>

<span data-ttu-id="15ecf-135">透過 WSPs 和自動編譯，在部署之前，不會有明確的編譯步驟。</span><span class="sxs-lookup"><span data-stu-id="15ecf-135">With WSPs and automatic compilation, there is no explicit compilation step prior to deployment.</span></span> <span data-ttu-id="15ecf-136">相反地，部署牽涉到將宣告式和原始程式碼內容複寫到生產環境。</span><span class="sxs-lookup"><span data-stu-id="15ecf-136">Instead, deployment involves copying both the declarative and the source code content to the production environment.</span></span> <span data-ttu-id="15ecf-137">當要求在網頁建立或上次更新後第一次抵達 web 伺服器以取得 ASP.NET 網頁時，執行時間必須先將程式碼後置類別編譯成元件。</span><span class="sxs-lookup"><span data-stu-id="15ecf-137">When a request arrives to the web server for an ASP.NET page for the first time since the page has been created or last updated, the runtime must first compile the code-behind class into an assembly.</span></span> <span data-ttu-id="15ecf-138">這個已編譯的元件會儲存在 `%WINDIR%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files`資料夾中，不過這個資料夾的位置可以透過 `<system.web>`的 `<compilation tempDirectory="" />` 元素自訂，通常是在 `Web.config`中。</span><span class="sxs-lookup"><span data-stu-id="15ecf-138">This compiled assembly is saved in the folder `%WINDIR%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files`, although the location of this folder can be customized via the `<compilation tempDirectory="" />` element of `<system.web>`, usually in `Web.config`.</span></span> <span data-ttu-id="15ecf-139">因為元件會儲存至磁片，所以不需要在對相同頁面的後續要求中重新編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-139">Because the assembly is saved to disk, it does not need to be recompiled on subsequent requests to the same page.</span></span>

> [!NOTE]
> <span data-ttu-id="15ecf-140">如您所預期，第一次要求頁面時（或在第一次變更之後）在使用自動編譯的網站中，因為伺服器需要一些時間來編譯頁面的程式碼，並將產生的元件儲存到，所以會有些許延遲硬碟.</span><span class="sxs-lookup"><span data-stu-id="15ecf-140">As you would expect, there is a slight delay when requesting a page for the first time (or for the first time since it's been changed) in a site that uses automatic compilation as it takes a moment for the server to compile the page's code and save the resulting assembly to disk.</span></span>

<span data-ttu-id="15ecf-141">簡單地說，使用明確編譯時，您必須在部署之前編譯網站的原始程式碼，讓執行時間不需要執行該步驟。</span><span class="sxs-lookup"><span data-stu-id="15ecf-141">In short, with explicit compilation you are required to compile the website's source code before deployment, saving the runtime from having to perform that step.</span></span> <span data-ttu-id="15ecf-142">使用自動編譯時，執行時間會處理頁面原始程式碼的編譯，但從建立或上次更新以來，第一次造訪網頁時，會稍微初始化成本。</span><span class="sxs-lookup"><span data-stu-id="15ecf-142">With automatic compilation the runtime handles the compilation of the pages' source code, but with a slight initialization cost for the first visit to the page since it was created or last updated.</span></span>

<span data-ttu-id="15ecf-143">但是，ASP.NET 網頁的宣告式部分（`.aspx` 檔案）呢？</span><span class="sxs-lookup"><span data-stu-id="15ecf-143">But what about the declarative part of ASP.NET pages (the `.aspx` file)?</span></span> <span data-ttu-id="15ecf-144">很明顯地，在程式碼後置類別中，`.aspx` 檔案和程式碼之間有關聯性，因為宣告式標記中定義的 Web 控制項可在程式碼中存取。</span><span class="sxs-lookup"><span data-stu-id="15ecf-144">It's obvious that there's a relationship between the `.aspx` files and the code in their code-behind classes, as the Web controls defined in the declarative markup are accessible in the code.</span></span> <span data-ttu-id="15ecf-145">也很明顯地，`.aspx` 檔案中的內容會大幅影響網頁所產生的轉譯標記。</span><span class="sxs-lookup"><span data-stu-id="15ecf-145">It's also obvious that the content in the `.aspx` files greatly influences the rendered markup generated by the page.</span></span> <span data-ttu-id="15ecf-146">那麼，執行時間如何搭配 `.aspx` 檔案中定義的文字、HTML 和 Web 控制項語法，來產生要求的網頁轉譯內容呢？</span><span class="sxs-lookup"><span data-stu-id="15ecf-146">So how does the runtime work with the text, HTML, and Web control syntax defined in the `.aspx` file to generate the requested page's rendered content?</span></span>

<span data-ttu-id="15ecf-147">我不想延宕低層級的執行詳細資料，這會因 Wap 和 WSPs 而有所不同，但簡言之，執行時間會自動產生類別檔案，其中包含各種 Web 控制項做為受保護的成員和方法。</span><span class="sxs-lookup"><span data-stu-id="15ecf-147">I don't want to get too sidetracked on the low-level implementation details, which vary between WAPs and WSPs, but in a nutshell the runtime automatically generates a class file that contains the various Web controls as protected members and methods.</span></span> <span data-ttu-id="15ecf-148">這個產生的檔案會實作為對應程式碼後置類別的*部分類別*。</span><span class="sxs-lookup"><span data-stu-id="15ecf-148">This generated file is implemented as a *partial class* to the corresponding code-behind class.</span></span> <span data-ttu-id="15ecf-149">（[部分類別](http://www.dotnet-guide.com/partialclasses.html)允許將單一類別的內容分散到多個檔案）。因此，程式碼後置類別是在兩個地方定義：在您建立的 `.aspx.cs` 檔案中，以及執行時間所建立的這個自動產生的類別中。</span><span class="sxs-lookup"><span data-stu-id="15ecf-149">([Partial classes](http://www.dotnet-guide.com/partialclasses.html) allow for the contents of a single class to be spread across multiple files.) Therefore, the code-behind class is defined in two places: in the `.aspx.cs` file that you create, and in this auto-generated class created by the runtime.</span></span> <span data-ttu-id="15ecf-150">這個自動產生的類別會儲存在 [`%WINDIR%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files`] 資料夾中。</span><span class="sxs-lookup"><span data-stu-id="15ecf-150">This auto-generated class is stored in the `%WINDIR%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files` folder.</span></span>

<span data-ttu-id="15ecf-151">這裡的重點是，在執行時間轉譯 ASP.NET 網頁時，其宣告式和原始程式碼部分都必須編譯成元件。</span><span class="sxs-lookup"><span data-stu-id="15ecf-151">The important take away here is that for an ASP.NET page to be rendered by the runtime both its declarative and source code portions must be compiled into an assembly.</span></span> <span data-ttu-id="15ecf-152">使用 Wap 時，會在部署之前將原始程式碼明確編譯成元件，但是宣告式標記仍然必須轉換成程式碼，並由 web 伺服器上的執行時間編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-152">With WAPs, the source code is explicitly compiled into an assembly prior to deployment, but the declarative markup must still be converted into code and compiled by the runtime on the web server.</span></span> <span data-ttu-id="15ecf-153">使用自動編譯的 WSPs，原始程式碼和宣告式標記都必須由 web 伺服器編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-153">With WSPs using automatic compilation, both the source code and the declarative markup need to be compiled by the web server.</span></span>

<span data-ttu-id="15ecf-154">您可以搭配使用明確編譯與 WSP 模型。</span><span class="sxs-lookup"><span data-stu-id="15ecf-154">It is possible to use explicit compilation with the WSP model.</span></span> <span data-ttu-id="15ecf-155">您可以明確地編譯原始程式碼部分，就像使用 WAP 模型一樣。</span><span class="sxs-lookup"><span data-stu-id="15ecf-155">You can explicitly compile the source code portion, like with the WAP model.</span></span> <span data-ttu-id="15ecf-156">此外，您也可以編譯宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="15ecf-156">What's more, you can also compile the declarative markup.</span></span>

## <a name="precompilation-options"></a><span data-ttu-id="15ecf-157">先行編譯選項</span><span class="sxs-lookup"><span data-stu-id="15ecf-157">Precompilation Options</span></span>

<span data-ttu-id="15ecf-158">.NET Framework 隨附[ASP.NET 編譯工具（`aspnet_compiler.exe`）](https://msdn.microsoft.com/library/ms229863.aspx) ，可讓您編譯使用 WSP 模型所建立之 ASP.NET 應用程式的原始程式碼（甚至是內容）。</span><span class="sxs-lookup"><span data-stu-id="15ecf-158">The .NET Framework ships with an [ASP.NET compilation tool (`aspnet_compiler.exe`)](https://msdn.microsoft.com/library/ms229863.aspx) that enables you to compile the source code (and even the content) of an ASP.NET application built using the WSP model.</span></span> <span data-ttu-id="15ecf-159">這項工具是以 .NET Framework 版本2.0 發行，位於 `%WINDIR%\Microsoft.NET\Framework\v2.0.50727` 資料夾中;您可以從命令列使用它，或透過 [建立] 功能表的 [發行網站] 選項，從 Visual Studio 中啟動。</span><span class="sxs-lookup"><span data-stu-id="15ecf-159">This tool was released with the .NET Framework version 2.0 and is located in the `%WINDIR%\Microsoft.NET\Framework\v2.0.50727` folder; it can be used from the command line or launched from within Visual Studio via the Build menu's Publish Web Site option.</span></span>

<span data-ttu-id="15ecf-160">編譯工具提供兩種一般的編譯形式：就地先行編譯和先行編譯以進行部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-160">The compilation tool provides two general forms of compilation: in-place precompilation and precompilation for deployment.</span></span> <span data-ttu-id="15ecf-161">使用就地先行編譯時，您可以從命令列執行 `aspnet_compiler.exe` 工具，並指定虛擬目錄的路徑或位於電腦上之網站的實體路徑。</span><span class="sxs-lookup"><span data-stu-id="15ecf-161">With in-place precompilation you run the `aspnet_compiler.exe` tool from the command-line and specify the path to the virtual directory or physical path of a website that resides on your computer.</span></span> <span data-ttu-id="15ecf-162">然後，編譯工具會編譯專案中的每個 ASP.NET 網頁，將編譯過的版本儲存在 `%WINDIR%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files` 資料夾中，就像是第一次從瀏覽器造訪每個頁面一樣。</span><span class="sxs-lookup"><span data-stu-id="15ecf-162">The compilation tool then compiles each ASP.NET page in the project, storing the compiled version in the `%WINDIR%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files` folder just like if the pages had each been visited for the first time from a browser.</span></span> <span data-ttu-id="15ecf-163">就地先行編譯可以加速對您網站上新部署的 ASP.NET 網頁提出的第一個要求，因為它會減輕執行時間不需要執行此步驟。</span><span class="sxs-lookup"><span data-stu-id="15ecf-163">In-place precompilation can speed up the first request made to newly deployed ASP.NET pages on your site because it alleviates the runtime from needing to perform this step.</span></span> <span data-ttu-id="15ecf-164">不過，對於大部分裝載的網站而言，就地先行編譯並不實用，因為它需要您能夠從 web 伺服器的命令列執行程式。</span><span class="sxs-lookup"><span data-stu-id="15ecf-164">However, in-place precompilation is not useful for the majority of hosted websites because it requires that you are able to run programs from the web server's command-line.</span></span> <span data-ttu-id="15ecf-165">在共用主控環境中，不允許此層級的存取。</span><span class="sxs-lookup"><span data-stu-id="15ecf-165">In shared hosting environments this level of access is not permitted.</span></span>

> [!NOTE]
> <span data-ttu-id="15ecf-166">如需就地先行編譯的詳細資訊，請參閱如何：[在 ASP.NET 2.0](http://www.odetocode.com/Articles/417.aspx)中先行[編譯 ASP.NET 網站](https://msdn.microsoft.com/library/ms227972.aspx)和先行編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-166">For more information on in-place precompilation, check out [How To: Precompile ASP.NET Web Sites](https://msdn.microsoft.com/library/ms227972.aspx) and [Precompilation in ASP.NET 2.0](http://www.odetocode.com/Articles/417.aspx).</span></span>

<span data-ttu-id="15ecf-167">部署的先行編譯不會將網站中的頁面編譯為 `Temporary ASP.NET Files` 資料夾，而是將頁面編譯成您選擇的目錄，並以可部署到生產環境的格式。</span><span class="sxs-lookup"><span data-stu-id="15ecf-167">Instead of compiling the pages in the website to the `Temporary ASP.NET Files` folder, precompilation for deployment compiles the pages to a directory of your choosing and in a format that can be deployed to the production environment.</span></span>

<span data-ttu-id="15ecf-168">我們在本教學課程中探索的部署有兩種先行編譯的類型：使用可更新的使用者介面先行編譯，以及使用不可更新的使用者介面先行編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-168">There are two flavors of precompilation for deployment that we explore in this tutorial: precompilation with an updatable user interface, and precompilation with a non-updatable user interface.</span></span> <span data-ttu-id="15ecf-169">具有可更新之使用者介面的先行編譯會將宣告式標記保留在 `.aspx`、`.ascx`和 `.master` 檔案中，因此可讓開發人員視需要修改實際伺服器上的宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="15ecf-169">Precompilation with an updatable user interface leaves the declarative markup in the `.aspx`, `.ascx`, and `.master` files, thereby allowing a developer to view and, if desired, modify the declarative markup on the production server.</span></span> <span data-ttu-id="15ecf-170">具有不可更新之使用者介面的先行編譯會產生任何內容的 `.aspx` 頁面，並移除 `.ascx` 和 `.master` 的檔案，藉此隱藏宣告式標記並禁止開發人員從生產環境進行變更。</span><span class="sxs-lookup"><span data-stu-id="15ecf-170">Precompilation with a non-updatable user interface generates `.aspx` pages that are void of any content and removes `.ascx` and `.master` files, thereby hiding the declarative markup and prohibiting a developer from changing it from the production environment.</span></span>

### <a name="precompiling-for-deployment-with-an-updatable-user-interface"></a><span data-ttu-id="15ecf-171">使用可更新的使用者介面進行部署的先行編譯</span><span class="sxs-lookup"><span data-stu-id="15ecf-171">Precompiling for Deployment With an Updatable User Interface</span></span>

<span data-ttu-id="15ecf-172">瞭解部署先行編譯的最佳方式，就是查看作用中的範例。</span><span class="sxs-lookup"><span data-stu-id="15ecf-172">The best way to understand precompilation for deployment is to see an example in action.</span></span> <span data-ttu-id="15ecf-173">讓我們先行編譯本書審查 WSP，以使用可更新的使用者介面進行部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-173">Let's precompile the Book Reviews WSP for deployment using an updatable user interface.</span></span> <span data-ttu-id="15ecf-174">您可以從 Visual Studio 的 [建立] 功能表或從命令列叫用 ASP.NET 編譯工具。</span><span class="sxs-lookup"><span data-stu-id="15ecf-174">The ASP.NET compilation tool can be invoked from Visual Studio's Build menu or from the command-line.</span></span> <span data-ttu-id="15ecf-175">本節將探討如何在 Visual Studio 中使用此工具;「從命令列先行編譯」一節會查看從命令列執行編譯器工具。</span><span class="sxs-lookup"><span data-stu-id="15ecf-175">This section examines using the tool from within Visual Studio; the "Precompiling from the Command Line" section looks at running the compiler tool from the command line.</span></span>

<span data-ttu-id="15ecf-176">在 Visual Studio 中開啟 [書籍審查] WSP，移至 [建立] 功能表，然後選取 [發行網站] 功能表選項。</span><span class="sxs-lookup"><span data-stu-id="15ecf-176">Open the Book Review WSP in Visual Studio, go to the Build menu, and select the Publish Web Site menu option.</span></span> <span data-ttu-id="15ecf-177">這會啟動 [發行網站] 對話方塊（請參閱 [**圖 1**]），您可以在其中指定目標位置、是否可更新先行編譯網站的使用者介面，以及其他編譯器工具選項。</span><span class="sxs-lookup"><span data-stu-id="15ecf-177">This launches the Publish Web Site dialog box (see **Figure 1**), where you can specify the target location, whether or not the precompiled site's user interface is updatable, and other compiler tool options.</span></span> <span data-ttu-id="15ecf-178">目標位置可以是遠端 web 伺服器或 FTP 伺服器，但現在請選擇您電腦硬碟上的資料夾。</span><span class="sxs-lookup"><span data-stu-id="15ecf-178">The target location can be a remote web server or FTP server, but for now choose a folder on your computer's hard drive.</span></span> <span data-ttu-id="15ecf-179">因為我們想要使用可更新的使用者介面先行編譯網站，請勾選 [允許此先行編譯網站成為可更新] 核取方塊，然後按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="15ecf-179">Because we want to precompile the site with an updatable user interface, leave the "Allow this precompiled site to be updatable" checkbox checked and click OK.</span></span>

[![](precompiling-your-website-cs/_static/image2.png)](precompiling-your-website-cs/_static/image1.png)

<span data-ttu-id="15ecf-180">**圖 1**： ASP.NET 編譯工具會將您的網站先行編譯到指定的目標位置</span><span class="sxs-lookup"><span data-stu-id="15ecf-180">**Figure 1**: The ASP.NET Compilation Tool Will Precompile Your Website to the Specified Target Location</span></span>  
 <span data-ttu-id="15ecf-181">（[按一下以查看完整大小的影像](precompiling-your-website-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="15ecf-181">([Click to view full-size image](precompiling-your-website-cs/_static/image3.png))</span></span>

> [!NOTE]
> <span data-ttu-id="15ecf-182">Visual Web Developer 無法使用 [建立] 功能表中的 [發行網站] 選項。</span><span class="sxs-lookup"><span data-stu-id="15ecf-182">The Publish Web Site option in the Build menu is not available in Visual Web Developer.</span></span> <span data-ttu-id="15ecf-183">如果您使用的是 Visual Web Developer，就必須使用命令列版本的 ASP.NET 編譯工具，其涵蓋于「從命令列先行編譯」一節。</span><span class="sxs-lookup"><span data-stu-id="15ecf-183">If you are using Visual Web Developer you will need to use the command-line version of the ASP.NET compilation tool, which is covered in the "Precompiling from the Command Line" section.</span></span>

<span data-ttu-id="15ecf-184">先行編譯網站之後，流覽至您在 [發行網站] 對話方塊中輸入的目標位置。</span><span class="sxs-lookup"><span data-stu-id="15ecf-184">After precompiling the website, navigate to the target location you entered in the Publish Web Site dialog box.</span></span> <span data-ttu-id="15ecf-185">請花點時間比較此資料夾的內容與您網站的內容。</span><span class="sxs-lookup"><span data-stu-id="15ecf-185">Take a moment to compare the contents of this folder with the contents of your website.</span></span> <span data-ttu-id="15ecf-186">[**圖 2** ] 顯示書籍審查網站資料夾。</span><span class="sxs-lookup"><span data-stu-id="15ecf-186">**Figure 2** shows the Book Reviews website folder.</span></span> <span data-ttu-id="15ecf-187">請注意，它同時包含 `.aspx` 和 `.aspx.cs` 檔案。</span><span class="sxs-lookup"><span data-stu-id="15ecf-187">Note that it contains both `.aspx` and `.aspx.cs` files.</span></span> <span data-ttu-id="15ecf-188">另請注意，`Bin` 目錄只包含一個檔案，`Elmah.dll`，我們在[上一個教學](logging-error-details-with-elmah-cs.md)課程中新增此檔案</span><span class="sxs-lookup"><span data-stu-id="15ecf-188">Also, note that the `Bin` directory includes only one file, `Elmah.dll`, which we added in the [preceding tutorial](logging-error-details-with-elmah-cs.md)</span></span>

[![](precompiling-your-website-cs/_static/image5.png)](precompiling-your-website-cs/_static/image4.png)

<span data-ttu-id="15ecf-189">**圖 2**：專案目錄包含 `.aspx` 和 `.aspx.cs` 檔案;[`Bin`] 資料夾僅包含 `Elmah.dll`</span><span class="sxs-lookup"><span data-stu-id="15ecf-189">**Figure 2**: The Project Directory Contains `.aspx` and `.aspx.cs` Files; the `Bin` Folder Includes Just `Elmah.dll`</span></span>  
 <span data-ttu-id="15ecf-190">（[按一下以查看完整大小的影像](precompiling-your-website-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="15ecf-190">([Click to view full-size image](precompiling-your-website-cs/_static/image6.png))</span></span>

<span data-ttu-id="15ecf-191">[**圖 3** ] 顯示 ASP.NET 編譯工具所建立之內容的目標位置資料夾。</span><span class="sxs-lookup"><span data-stu-id="15ecf-191">**Figure 3** shows the target location folder whose contents were created by the ASP.NET compilation tool.</span></span> <span data-ttu-id="15ecf-192">此資料夾未包含任何程式碼後置檔案。</span><span class="sxs-lookup"><span data-stu-id="15ecf-192">This folder does not contain any code-behind files.</span></span> <span data-ttu-id="15ecf-193">此外，這個資料夾的 `Bin` 目錄除了 `Elmah.dll` 元件以外，還包含了數個元件和兩個 `.compiled` 檔案。</span><span class="sxs-lookup"><span data-stu-id="15ecf-193">Moreover, this folder's `Bin` directory includes several assemblies and two `.compiled` files in addition to the `Elmah.dll` assembly.</span></span>

[![](precompiling-your-website-cs/_static/image8.png)](precompiling-your-website-cs/_static/image7.png)

<span data-ttu-id="15ecf-194">**圖 3**：目標位置資料夾包含要部署的檔案</span><span class="sxs-lookup"><span data-stu-id="15ecf-194">**Figure 3**: The Target Location Folder Includes the Files for Deployment</span></span>  
 <span data-ttu-id="15ecf-195">（[按一下以查看完整大小的影像](precompiling-your-website-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="15ecf-195">([Click to view full-size image](precompiling-your-website-cs/_static/image9.png))</span></span>

<span data-ttu-id="15ecf-196">不同于 Wap 中的明確編譯，部署程式的先行編譯不會為整個網站建立一個元件。</span><span class="sxs-lookup"><span data-stu-id="15ecf-196">Unlike explicit compilation in WAPs, the precompilation for deployment process does not create one assembly for the entire site.</span></span> <span data-ttu-id="15ecf-197">相反地，它會將數個頁面分批組成每個元件。</span><span class="sxs-lookup"><span data-stu-id="15ecf-197">Instead, it batches together several pages into each assembly.</span></span> <span data-ttu-id="15ecf-198">它也會將 `Global.asax` 檔案（如果有的話）編譯成它自己的元件，以及 `App_Code` 資料夾中的任何類別。</span><span class="sxs-lookup"><span data-stu-id="15ecf-198">It also compiles the `Global.asax` file (if present) into its own assembly, as well as any classes in the `App_Code` folder.</span></span> <span data-ttu-id="15ecf-199">保存 ASP.NET 網頁、使用者控制項和主版頁面（分別是`.aspx`、`.ascx`和 `.master` 檔案）之宣告式標記的檔案，會依原樣複製到目標位置目錄。</span><span class="sxs-lookup"><span data-stu-id="15ecf-199">The files that hold the declarative markup for ASP.NET web pages, User Controls, and master pages (`.aspx`, `.ascx`, and `.master` files, respectively) are copied as-is to the target location directory.</span></span> <span data-ttu-id="15ecf-200">同樣地，也會直接複製 `Web.config` 檔案，連同任何靜態檔案（例如影像、CSS 類別和 PDF 檔案）。</span><span class="sxs-lookup"><span data-stu-id="15ecf-200">Likewise, the `Web.config` file is copied straight over, along with any static files, such as images, CSS classes, and PDF files.</span></span> <span data-ttu-id="15ecf-201">如需編譯工具如何處理各種檔案類型的更正式描述，請參閱[ASP.NET 先行編譯期間](https://msdn.microsoft.com/library/e22s60h9.aspx)的檔案處理。</span><span class="sxs-lookup"><span data-stu-id="15ecf-201">For a more formal description of how the compilation tool handles various file types, refer to [File Handling During ASP.NET Precompilation](https://msdn.microsoft.com/library/e22s60h9.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="15ecf-202">您可以藉由從 [發行網站] 對話方塊中選取 [已使用的固定命名和單一頁面元件] 核取方塊，指示編譯工具為每個 ASP.NET 網頁、使用者控制項或主版頁面建立一個元件。</span><span class="sxs-lookup"><span data-stu-id="15ecf-202">You can instruct the compilation tool to create one assembly per ASP.NET page, User Control, or master page by checking the "Used fixed naming and single page assemblies" checkbox from the Publish Web Site dialog box.</span></span> <span data-ttu-id="15ecf-203">將每個 ASP.NET 網頁編譯成自己的元件，可讓您更精細地控制部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-203">Having each ASP.NET page compiled into its own assembly allows for more fine-grained control over deployment.</span></span> <span data-ttu-id="15ecf-204">例如，如果您更新了單一 ASP.NET 網頁，而且需要部署該變更，您只需要將該頁面的 `.aspx` 檔案和相關聯的元件部署到生產環境。</span><span class="sxs-lookup"><span data-stu-id="15ecf-204">For example, if you updated a single ASP.NET web page and needed to deploy that change, you need only deploy that page's `.aspx` file and associated assembly to the production environment.</span></span> <span data-ttu-id="15ecf-205">如需詳細資訊，請參閱[如何：使用 ASP.NET 編譯工具產生固定的名稱](https://msdn.microsoft.com/library/ms228040.aspx)。</span><span class="sxs-lookup"><span data-stu-id="15ecf-205">Consult [How To: Generate Fixed Names with the ASP.NET Compilation Tool](https://msdn.microsoft.com/library/ms228040.aspx) for more information.</span></span>

<span data-ttu-id="15ecf-206">目標位置目錄也包含不屬於先行編譯 Web 專案的檔案，亦即 `PrecompiledApp.config`。</span><span class="sxs-lookup"><span data-stu-id="15ecf-206">The target location directory also contains a file that was not part of the precompiled web project, namely `PrecompiledApp.config`.</span></span> <span data-ttu-id="15ecf-207">此檔案會通知 ASP.NET 執行時間，應用程式已先行編譯，以及是否使用可更新或可更新的 UI 先行編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-207">This file informs the ASP.NET runtime that the application was precompiled and whether it was precompiled with an updatable or noon-updatable UI.</span></span>

<span data-ttu-id="15ecf-208">最後，使用 Visual Studio 或您選擇的文字編輯器，花一點時間開啟目標位置中的其中一個 `.aspx` 檔案。</span><span class="sxs-lookup"><span data-stu-id="15ecf-208">Finally, take a moment to open one of the `.aspx` files in the target location using Visual Studio or your text editor of choice.</span></span> <span data-ttu-id="15ecf-209">使用可更新的使用者介面進行先行編譯時，目標位置目錄中的 ASP.NET 網頁會包含與網站中對應檔案完全相同的標記。</span><span class="sxs-lookup"><span data-stu-id="15ecf-209">When precompiling for deployment with an updatable user interface, the ASP.NET pages in the target location directory contain the exact same markup as the corresponding files in the website.</span></span>

### <a name="precompiling-for-deployment-with-a-non-updatable-user-interface"></a><span data-ttu-id="15ecf-210">使用不可更新的使用者介面進行預先編譯以進行部署</span><span class="sxs-lookup"><span data-stu-id="15ecf-210">Precompiling for Deployment With a Non-Updatable User Interface</span></span>

<span data-ttu-id="15ecf-211">ASP.NET 編譯器工具也可以用來先行編譯網站，以使用無法更新的 UI 進行部署。</span><span class="sxs-lookup"><span data-stu-id="15ecf-211">The ASP.NET compiler tool can also be used to precompile a site for deployment with a non-updatable UI.</span></span> <span data-ttu-id="15ecf-212">使用不可更新的 UI 先行編譯網站，其運作方式很像是使用可更新的 UI 先行編譯，主要差異在於目標目錄中的 ASP.NET 網頁、使用者控制項和主版頁面會移除其標記。</span><span class="sxs-lookup"><span data-stu-id="15ecf-212">Precompiling the site with a non-updatable UI works much like precompiling with an updatable UI, the key difference being that the ASP.NET pages, User Controls, and master pages in the target directory are stripped of their markup.</span></span> <span data-ttu-id="15ecf-213">若要使用無法更新的 UI 先行編譯網站以進行部署，請從 [建立] 功能表選擇 [發行網站] 選項，但取消核取 [允許此先行編譯的網站可以更新] 選項（請參閱 [**圖 4**]）。</span><span class="sxs-lookup"><span data-stu-id="15ecf-213">To precompile a website for deployment with a non-updatable UI, choose the Publish Web Site option from the Build menu, but uncheck the "Allow this precompiled site to be updatable" option (see **Figure 4**).</span></span>

[![](precompiling-your-website-cs/_static/image11.png)](precompiling-your-website-cs/_static/image10.png)

<span data-ttu-id="15ecf-214">**圖 4**：取消核取 [允許此先行編譯網站成為可更新的] 選項，以使用無法更新的 UI 進行先行編譯</span><span class="sxs-lookup"><span data-stu-id="15ecf-214">**Figure 4**: Uncheck the "Allow this precompiled site to be updatable" Option To Precompile With a Non-Updatable UI</span></span>  
 <span data-ttu-id="15ecf-215">（[按一下以查看完整大小的影像](precompiling-your-website-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="15ecf-215">([Click to view full-size image](precompiling-your-website-cs/_static/image12.png))</span></span>

<span data-ttu-id="15ecf-216">[**圖 5** ] 顯示使用不可更新的使用者介面先行編譯之後的目標位置資料夾。</span><span class="sxs-lookup"><span data-stu-id="15ecf-216">**Figure 5** shows the target location folder after precompiling with a non-updatable user interface.</span></span>

[![](precompiling-your-website-cs/_static/image14.png)](precompiling-your-website-cs/_static/image13.png)

<span data-ttu-id="15ecf-217">**圖 5**：使用不可更新的 UI 進行部署的目標位置資料夾</span><span class="sxs-lookup"><span data-stu-id="15ecf-217">**Figure 5**: The Target Location Folder for Deployment With a Non-Updatable UI</span></span>  
 <span data-ttu-id="15ecf-218">（[按一下以查看完整大小的影像](precompiling-your-website-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="15ecf-218">([Click to view full-size image](precompiling-your-website-cs/_static/image15.png))</span></span>

<span data-ttu-id="15ecf-219">請比較 [**圖 3** ] 到 [**圖 5**]。</span><span class="sxs-lookup"><span data-stu-id="15ecf-219">Compare **Figure 3** to **Figure 5**.</span></span> <span data-ttu-id="15ecf-220">雖然兩個資料夾看起來可能完全相同，但請注意，不可更新的 UI 資料夾缺少主版頁面，`Site.master`。</span><span class="sxs-lookup"><span data-stu-id="15ecf-220">While the two folders may look identical, note that the non-updatable UI folder lacks the master page, `Site.master`.</span></span> <span data-ttu-id="15ecf-221">雖然 [**圖 5** ] 包含各種 ASP.NET 網頁，但如果您要查看這些檔案的內容，您會看到它們已移除其宣告式標記，並以預留位置文字取代：「這是先行編譯工具所產生的標記檔案，不應該刪除！」</span><span class="sxs-lookup"><span data-stu-id="15ecf-221">And while **Figure 5** includes the various ASP.NET pages, if you view the contents of these files you'll see that they've been stripped of their declarative markup and replaced with the placeholder text: "This is a marker file generated by the precompilation tool, and should not be deleted!"</span></span>

[![](precompiling-your-website-cs/_static/image17.png)](precompiling-your-website-cs/_static/image16.png)

<span data-ttu-id="15ecf-222">**圖 5**：已從 ASP.NET 網頁移除宣告式標記</span><span class="sxs-lookup"><span data-stu-id="15ecf-222">**Figure 5**: The Declarative Markup Has Been Removed from the ASP.NET Pages</span></span>

<span data-ttu-id="15ecf-223">[**圖 3** ] 和 [ **5** ] 中的 [`Bin`] 資料夾明顯不同。</span><span class="sxs-lookup"><span data-stu-id="15ecf-223">The `Bin` folders in **Figures 3** and **5** differ more substantially.</span></span> <span data-ttu-id="15ecf-224">除了元件之外，[**圖 5** ] 中的 [`Bin`] 資料夾還包含每個 ASP.NET 網頁、使用者控制項和主版頁面的 `.compiled` 檔案。</span><span class="sxs-lookup"><span data-stu-id="15ecf-224">In addition to the assemblies, the `Bin` folder in **Figure 5** includes a `.compiled` file for each ASP.NET page, User Control, and master page.</span></span>

<span data-ttu-id="15ecf-225">當您不想要在生產環境中安裝或管理網站的人員或公司修改 ASP.NET 網頁的內容時，以不可更新的 UI 先行編譯網站非常有用。</span><span class="sxs-lookup"><span data-stu-id="15ecf-225">Precompiling a site with a non-updatable UI is useful in situations where you do not want the ASP.NET pages' contents to be modified by the person or company who installs or manages the website in the production environment.</span></span> <span data-ttu-id="15ecf-226">如果您建立一個 ASP.NET web 應用程式來銷售給客戶，以便安裝在自己的網頁伺服器上，您可能會想要確保他們不會藉由直接編輯您寄送的 `.aspx` 頁面來修改網站的外觀與風格。</span><span class="sxs-lookup"><span data-stu-id="15ecf-226">If you build an ASP.NET web application that you sell to customers to install on their own web servers, you may want to ensure that they do not modify the look and feel of your site by directly editing the `.aspx` pages you ship them.</span></span> <span data-ttu-id="15ecf-227">藉由使用不可更新的 UI 先行編譯您的網站，您會在安裝時將預留位置 `.aspx` 頁面中寄送，藉此防止客戶檢查或修改其內容。</span><span class="sxs-lookup"><span data-stu-id="15ecf-227">By precompiling your website with a non-updatable UI, you ship the placeholder `.aspx` pages as part of the installation, thereby preventing your customers from examining or modifying their content.</span></span>

### <a name="precompiling-from-the-command-line"></a><span data-ttu-id="15ecf-228">從命令列先行編譯</span><span class="sxs-lookup"><span data-stu-id="15ecf-228">Precompiling from the Command Line</span></span>

<span data-ttu-id="15ecf-229">在幕後，Visual Studio 的 [發行網站] 對話方塊會叫用 ASP.NET 編譯工具（`aspnet_compiler.exe`）以先行編譯網站。</span><span class="sxs-lookup"><span data-stu-id="15ecf-229">Behind the scenes, Visual Studio's Publish Web Site dialog box invokes the ASP.NET compilation tool (`aspnet_compiler.exe`) to precompile the website.</span></span> <span data-ttu-id="15ecf-230">或者，您也可以從命令列叫用此工具。</span><span class="sxs-lookup"><span data-stu-id="15ecf-230">Alternatively, you can invoke this tool from the command line.</span></span> <span data-ttu-id="15ecf-231">事實上，如果您使用 Visual Web Developer，就必須從命令列執行編譯器工具，因為 Visual Web Developer 的 [組建] 功能表並未包含 [發行網站] 選項。</span><span class="sxs-lookup"><span data-stu-id="15ecf-231">In fact, if you use Visual Web Developer then you will need to run the compiler tool from the command line, as Visual Web Developer's Build menu does not include the Publish Web Site option.</span></span>

<span data-ttu-id="15ecf-232">若要從命令列使用編譯器工具，請先卸載至命令列，然後流覽至架構目錄，`%WINDIR%\Microsoft.NET\Framework\v2.0.50727`。</span><span class="sxs-lookup"><span data-stu-id="15ecf-232">To use the compiler tool from the command line, start by dropping to the command line and navigating to the framework directory, `%WINDIR%\Microsoft.NET\Framework\v2.0.50727`.</span></span> <span data-ttu-id="15ecf-233">接下來，在命令列中輸入下列語句：</span><span class="sxs-lookup"><span data-stu-id="15ecf-233">Next, enter the following statement into the command line:</span></span>

`aspnet_compiler -p "physical_path_to_app" -v / -f -u "target_location_folder"`

<span data-ttu-id="15ecf-234">上述命令會啟動 ASP.NET 編譯器工具（`aspnet_compiler.exe`），並透過 `-p` 參數，指示它將根目錄為*實體\_路徑\_的網站先行編譯成\_應用程式*;這個值會類似 `C:\MySites\BookReviews`，而且應該以引號分隔。</span><span class="sxs-lookup"><span data-stu-id="15ecf-234">The above command launches the ASP.NET compiler tool (`aspnet_compiler.exe`) and, via the `-p` switch, instructs it to precompile the website rooted at *physical\_path\_to\_app*; this value will be something like `C:\MySites\BookReviews`, and should be delimited by quotation marks.</span></span>

<span data-ttu-id="15ecf-235">`-v` 參數會指定網站的虛擬目錄。</span><span class="sxs-lookup"><span data-stu-id="15ecf-235">The `-v` switch specifies the virtual directory of the site.</span></span> <span data-ttu-id="15ecf-236">如果您的網站註冊為 IIS 元資料庫中的預設網站，則您可以省略 `-p` 參數，並只指定應用程式的虛擬目錄。</span><span class="sxs-lookup"><span data-stu-id="15ecf-236">If your site is registered as the default website in the IIS metabase then you can omit the `-p` switch and just specify the virtual directory of the application.</span></span> <span data-ttu-id="15ecf-237">如果您使用 `-p` 參數，則繼續 `-v` 參數的值會指出網站的根目錄，並且用來解析應用程式根目錄參考。</span><span class="sxs-lookup"><span data-stu-id="15ecf-237">If you use the `-p` switch, the value proceeding the `-v` switch indicates the root of the website, and is used to resolve application-root references.</span></span> <span data-ttu-id="15ecf-238">比方說，如果您指定 `-v /MySite` 的值，則應用程式中的參考將會解析為 `~/MySite/path/file``~/path/file`。</span><span class="sxs-lookup"><span data-stu-id="15ecf-238">For instance, if you specify a value of `-v /MySite` then references in the application to `~/path/file` will be resolved as `~/MySite/path/file`.</span></span> <span data-ttu-id="15ecf-239">因為書籍審查網站位於我的 web 主控公司的根目錄，所以我使用了參數 `-v /`。</span><span class="sxs-lookup"><span data-stu-id="15ecf-239">Because the Book Reviews site is located at the root directory at my web hosting company I have used the switch `-v /`.</span></span>

<span data-ttu-id="15ecf-240">`-f` 參數（如果有的話）會指示編譯工具覆寫*目標\_位置\_資料夾*目錄（如果已經存在）。</span><span class="sxs-lookup"><span data-stu-id="15ecf-240">The `-f` switch, if present, instructs the compilation tool to overwrite the *target\_location\_folder* directory if it already exists.</span></span> <span data-ttu-id="15ecf-241">如果您省略 `-f` 參數，而且目標位置資料夾已經存在，編譯工具將會結束，並出現錯誤：「錯誤 ASPRUNTIME：目標目錄不是空的。</span><span class="sxs-lookup"><span data-stu-id="15ecf-241">If you omit the `-f` switch and the target location folder already exists, the compilation tool will quit with the error: "error ASPRUNTIME: The target directory is not empty.</span></span> <span data-ttu-id="15ecf-242">請手動將其刪除，或選擇不同的目標。」</span><span class="sxs-lookup"><span data-stu-id="15ecf-242">Please delete it manually or choose a different target."</span></span>

<span data-ttu-id="15ecf-243">`-u` 參數（如果有的話）會通知工具建立可更新的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="15ecf-243">The `-u` switch, if present, informs the tool to create an updatable user interface.</span></span> <span data-ttu-id="15ecf-244">省略此參數，可使用不可更新的使用者介面先行編譯網站。</span><span class="sxs-lookup"><span data-stu-id="15ecf-244">Omit this switch to precompile the site with a non-updatable user interface.</span></span>

<span data-ttu-id="15ecf-245">最後，*目標\_位置\_資料夾*是目標位置目錄的實體路徑;這個值會類似 `C:\MySites\Output\BookReviews`，而且應該以引號分隔。</span><span class="sxs-lookup"><span data-stu-id="15ecf-245">Lastly, the *target\_location\_folder* is the physical path to the target location directory; this value will be something like `C:\MySites\Output\BookReviews`, and should be delimited by quotation marks.</span></span>

## <a name="deploying-the-precompiled-website"></a><span data-ttu-id="15ecf-246">部署先行編譯的網站</span><span class="sxs-lookup"><span data-stu-id="15ecf-246">Deploying the Precompiled Website</span></span>

<span data-ttu-id="15ecf-247">此時，我們已瞭解如何使用 ASP.NET 編譯工具，使用可更新和不可更新的使用者介面選項先行編譯網站。</span><span class="sxs-lookup"><span data-stu-id="15ecf-247">At this point we have seen how to use the ASP.NET compilation tool to precompile a website using both the updatable and non-updatable user interface options.</span></span> <span data-ttu-id="15ecf-248">不過，我們的範例目前已將網站先行編譯到本機資料夾，而不是實際執行環境。</span><span class="sxs-lookup"><span data-stu-id="15ecf-248">However, our examples thus far have precompiled the website to a local folder, and not to the production environment.</span></span> <span data-ttu-id="15ecf-249">好消息是，部署先行編譯的網站非常簡單，可以透過 Visual Studio 或透過一些其他檔案複製機制來完成，例如從獨立的 FTP 用戶端。</span><span class="sxs-lookup"><span data-stu-id="15ecf-249">The good news is that deploying the precompiled website is a breeze and can be done through Visual Studio or through some other file copy mechanism, such as from a stand-alone FTP client.</span></span>

<span data-ttu-id="15ecf-250">[發行網站] 對話方塊（如 [**圖 1**] 所示）具有 [目標位置] 選項，可指出將先行編譯的網站檔案複製到何處。</span><span class="sxs-lookup"><span data-stu-id="15ecf-250">The Publish Web Site dialog box (first shown in **Figure 1**) has a target location option, which indicates where the precompiled website files are copied to.</span></span> <span data-ttu-id="15ecf-251">這個位置可以是遠端 web 伺服器或 FTP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="15ecf-251">This location can be a remote web server or FTP server.</span></span> <span data-ttu-id="15ecf-252">在此文字方塊中輸入遠端伺服器會在一個步驟中預先編譯並將網站部署至指定的伺服器。</span><span class="sxs-lookup"><span data-stu-id="15ecf-252">Entering a remote server into this textbox precompiles and deploys the website to the specified server in one step.</span></span> <span data-ttu-id="15ecf-253">或者，您也可以將網站先行編譯到本機資料夾，然後透過 FTP 或其他方法，手動將該資料夾的內容複寫到生產環境。</span><span class="sxs-lookup"><span data-stu-id="15ecf-253">Alternatively, you can precompile the website to a local folder and then manually copy the contents of that folder to the production environment via FTP or some other approach.</span></span>

<span data-ttu-id="15ecf-254">透過 Visual Studio 的 [發行網站] 對話方塊自動部署的先行編譯網站，對於開發與生產環境之間沒有任何設定差異的簡單網站很有説明。</span><span class="sxs-lookup"><span data-stu-id="15ecf-254">Having the precompiled website automatically deployed via Visual Studio's Publish Web Site dialog box is helpful for simple sites where there are no configuration differences between the development and production environments.</span></span> <span data-ttu-id="15ecf-255">不過，如[*開發與生產*教學](common-configuration-differences-between-development-and-production-cs.md)課程的一般設定差異中所述，這類差異並不常見。</span><span class="sxs-lookup"><span data-stu-id="15ecf-255">However, as noted in the [*Common Configuration Differences Between Development and Production* tutorial](common-configuration-differences-between-development-and-production-cs.md) it is not uncommon for such differences to exist.</span></span> <span data-ttu-id="15ecf-256">例如，書籍審查 web 應用程式在生產環境中使用的資料庫與開發環境中的不同。</span><span class="sxs-lookup"><span data-stu-id="15ecf-256">For example, the Book Reviews web application uses a different database in the production environment than in the development environment.</span></span> <span data-ttu-id="15ecf-257">當 Visual Studio 將網站發佈到遠端伺服器時，它會在開發環境中將設定檔資訊複製到其中。</span><span class="sxs-lookup"><span data-stu-id="15ecf-257">When Visual Studio publishes the website to a remote server it blindly copies up the configuration file information in the development environment.</span></span>

<span data-ttu-id="15ecf-258">對於在開發與生產環境之間有設定差異的網站，最好是將網站先行編譯到本機目錄，再複製實際執行的設定檔案，然後將先行編譯輸出的內容複寫到生產.</span><span class="sxs-lookup"><span data-stu-id="15ecf-258">For sites with configuration differences between the development and production environments it may be best to precompile the site to a local directory, copy over the production-specific configuration files, and then copy the contents of the precompiled output to production.</span></span>

<span data-ttu-id="15ecf-259">如需將檔案從開發環境複製到生產環境的重新整理程式，請參閱[*使用 FTP 用戶端部署您的網站*](deploying-your-site-using-an-ftp-client-cs.md)和使用 Visual Studio 教學課程來[*部署您的網站*](determining-what-files-need-to-be-deployed-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="15ecf-259">For a refresher on copying files from the development environment to the production environment refer to the [*Deploying Your Website Using an FTP Client*](deploying-your-site-using-an-ftp-client-cs.md) and [*Deploying Your Website Using Visual Studio*](determining-what-files-need-to-be-deployed-cs.md) tutorials.</span></span>

## <a name="summary"></a><span data-ttu-id="15ecf-260">總結</span><span class="sxs-lookup"><span data-stu-id="15ecf-260">Summary</span></span>

<span data-ttu-id="15ecf-261">ASP.NET 支援兩種編譯模式：自動和明確。</span><span class="sxs-lookup"><span data-stu-id="15ecf-261">ASP.NET supports two modes of compilation: automatic and explicit.</span></span> <span data-ttu-id="15ecf-262">如先前的教學課程所述，Web 應用程式專案（Wap）會使用明確編譯，而網站專案（WSPs）預設會使用自動編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-262">As discussed in previous tutorials, Web Application Projects (WAPs) use explicit compilation whereas Web Site Projects (WSPs) use automatic compilation, by default.</span></span> <span data-ttu-id="15ecf-263">不過，您可以使用 ASP.NET 編譯工具，在部署之前明確編譯 WSP。</span><span class="sxs-lookup"><span data-stu-id="15ecf-263">However, it is possible to explicitly compile a WSP prior to deployment by using the ASP.NET compilation tool.</span></span>

<span data-ttu-id="15ecf-264">本教學課程著重于編譯工具針對部署支援的先行編譯。</span><span class="sxs-lookup"><span data-stu-id="15ecf-264">This tutorial focused on the compilation tool's Precompilation for Deployment support.</span></span> <span data-ttu-id="15ecf-265">當先行編譯部署時，編譯工具會建立目標位置資料夾、編譯指定的 web 應用程式的原始程式碼，並將這些已編譯的元件和內容檔案複製到目標位置資料夾。</span><span class="sxs-lookup"><span data-stu-id="15ecf-265">When precompiling for deployment, the compilation tool creates a target location folder, compiles the specified web application's source code, and copies these compiled assemblies and the content files into the target location folder.</span></span> <span data-ttu-id="15ecf-266">您可以設定編譯工具來建立可更新或不可更新的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="15ecf-266">The compilation tool can be configured to create an updatable or non-updatable user interface.</span></span> <span data-ttu-id="15ecf-267">使用不可更新的使用者介面選項進行先行編譯時，會移除內容檔案中的宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="15ecf-267">When precompiling with a non-updatable user interface option, the declarative markup in the content files is removed.</span></span> <span data-ttu-id="15ecf-268">簡言之，預先編譯可讓您部署網站專案型應用程式，而不需要包含任何原始程式碼檔，並視需要移除宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="15ecf-268">In a nutshell, precompilation permits you to deploy your Web Site Project-based application without including any source code files and with the declarative markup removed, if desired.</span></span>

<span data-ttu-id="15ecf-269">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="15ecf-269">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="15ecf-270">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="15ecf-270">Further Reading</span></span>

<span data-ttu-id="15ecf-271">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="15ecf-271">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="15ecf-272">ASP.NET 網站先行編譯</span><span class="sxs-lookup"><span data-stu-id="15ecf-272">ASP.NET Web Site Precompilation</span></span>](https://msdn.microsoft.com/library/ms228015.aspx)
- [<span data-ttu-id="15ecf-273">ASP.NET 2.0 中的後置和編譯</span><span class="sxs-lookup"><span data-stu-id="15ecf-273">Codebehind and Compilation in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/magazine/cc163675.aspx)
- [<span data-ttu-id="15ecf-274">ASP.NET 中的先行編譯</span><span class="sxs-lookup"><span data-stu-id="15ecf-274">Precompilation in ASP.NET</span></span>](http://www.odetocode.com/Articles/417.aspx)
- [<span data-ttu-id="15ecf-275">ASP.NET 中的先行編譯網站選項</span><span class="sxs-lookup"><span data-stu-id="15ecf-275">Precompiled Site Options in ASP.NET</span></span>](http://www.dotnetperls.com/precompiled)

> [!div class="step-by-step"]
> <span data-ttu-id="15ecf-276">[上一頁](logging-error-details-with-elmah-cs.md)
> [下一頁](users-and-roles-on-the-production-website-cs.md)</span><span class="sxs-lookup"><span data-stu-id="15ecf-276">[Previous](logging-error-details-with-elmah-cs.md)
[Next](users-and-roles-on-the-production-website-cs.md)</span></span>
