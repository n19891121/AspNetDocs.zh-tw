---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
title: 設定使用應用程式服務的網站（VB） |Microsoft Docs
author: rick-anderson
description: ASP.NET 2.0 版引進了一系列的應用程式服務，這是 .NET Framework 的一部分，並做為一組即將進行的建立區塊服務
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 9c31a42f-d8bb-4c0f-9ccc-597d4f70ac42
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
msc.type: authoredcontent
ms.openlocfilehash: 19e7258b558372259c7554a36c6ad73ce572dfa8
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74588724"
---
# <a name="configuring-a-website-that-uses-application-services-vb"></a><span data-ttu-id="447af-103">設定使用應用程式服務的網站 (VB)</span><span class="sxs-lookup"><span data-stu-id="447af-103">Configuring a Website that Uses Application Services (VB)</span></span>

<span data-ttu-id="447af-104">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="447af-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="447af-105">[下載程式代碼](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip)或[下載 PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="447af-105">[Download Code](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip) or [Download PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span></span>

> <span data-ttu-id="447af-106">ASP.NET 2.0 版引進了一系列的應用程式服務，這是 .NET Framework 的一部分，並作為一套建立區塊服務，讓您可以用來在 web 應用程式中加入豐富的功能。</span><span class="sxs-lookup"><span data-stu-id="447af-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="447af-107">本教學課程會探索如何在生產環境中設定網站，以使用應用程式服務，並解決在生產環境中管理使用者帳戶和角色的常見問題。</span><span class="sxs-lookup"><span data-stu-id="447af-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="introduction"></a><span data-ttu-id="447af-108">簡介</span><span class="sxs-lookup"><span data-stu-id="447af-108">Introduction</span></span>

<span data-ttu-id="447af-109">ASP.NET 2.0 版引進了一系列的*應用程式服務*，這是 .NET Framework 的一部分，並作為一套建立區塊服務，讓您可以用來在 web 應用程式中加入豐富的功能。</span><span class="sxs-lookup"><span data-stu-id="447af-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="447af-110">應用程式服務包括：</span><span class="sxs-lookup"><span data-stu-id="447af-110">The application services include:</span></span>

- <span data-ttu-id="447af-111">**成員資格**-用來建立和管理使用者帳戶的 API。</span><span class="sxs-lookup"><span data-stu-id="447af-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="447af-112">**角色**-用來將使用者分類為群組的 API。</span><span class="sxs-lookup"><span data-stu-id="447af-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="447af-113">**設定檔**-用來儲存自訂的使用者特定內容的 API。</span><span class="sxs-lookup"><span data-stu-id="447af-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="447af-114">**網站地圖**-用來以階層形式定義網站 s 邏輯結構的 API，然後可以透過導覽控制項（例如功能表和階層連結）來顯示。</span><span class="sxs-lookup"><span data-stu-id="447af-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="447af-115">**個人**化-用來維護自訂喜好設定的 API，最常用於[*webpart*](https://msdn.microsoft.com/library/e0s9t4ck.aspx)。</span><span class="sxs-lookup"><span data-stu-id="447af-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="447af-116">**健全狀況監視**-用來監視執行中 web 應用程式的效能、安全性、錯誤和其他系統健全狀況計量的 API。</span><span class="sxs-lookup"><span data-stu-id="447af-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>

<span data-ttu-id="447af-117">應用程式服務 Api 不會系結至特定的執行。</span><span class="sxs-lookup"><span data-stu-id="447af-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="447af-118">相反地，您會指示應用程式服務使用特定的*提供者*，而該提供者會使用特定技術來執行服務。</span><span class="sxs-lookup"><span data-stu-id="447af-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="447af-119">裝載于虛擬主機公司之以網際網路為基礎的 web 應用程式最常使用的提供者，就是使用 SQL Server 資料庫執行的提供者。</span><span class="sxs-lookup"><span data-stu-id="447af-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="447af-120">例如，`SqlMembershipProvider` 是成員資格 API 的提供者，會將使用者帳戶資訊儲存在 Microsoft SQL Server 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="447af-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="447af-121">使用應用程式服務和 SQL Server 提供者，會在部署應用程式時增加一些挑戰。</span><span class="sxs-lookup"><span data-stu-id="447af-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="447af-122">對於初學者而言，應用程式服務資料庫物件必須在開發和生產資料庫上正確建立，並適當地加以初始化。</span><span class="sxs-lookup"><span data-stu-id="447af-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="447af-123">此外，也需要進行重要的設定。</span><span class="sxs-lookup"><span data-stu-id="447af-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="447af-124">應用程式服務 Api 是使用[*提供者模型*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)所設計，這是一種設計模式，可讓您在執行時間提供 API 的執行詳細資料。</span><span class="sxs-lookup"><span data-stu-id="447af-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="447af-125">.NET Framework 隨附多個可以使用的應用程式服務提供者，例如 `SqlMembershipProvider` 和 `SqlRoleProvider`，這是使用 SQL Server 資料庫執行之成員資格和角色 Api 的提供者。</span><span class="sxs-lookup"><span data-stu-id="447af-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="447af-126">您也可以建立並外掛程式自訂提供者。</span><span class="sxs-lookup"><span data-stu-id="447af-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="447af-127">事實上，書籍審查 web 應用程式已經包含網站地圖 API （`ReviewSiteMapProvider`）的自訂提供者，它會從資料庫的 `Genres` 和 `Books` 資料表中的資料來建立網站地圖。</span><span class="sxs-lookup"><span data-stu-id="447af-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>

<span data-ttu-id="447af-128">本教學課程一開始會介紹我如何擴充書籍評論 web 應用程式，以使用成員資格和角色 Api。</span><span class="sxs-lookup"><span data-stu-id="447af-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="447af-129">然後逐步解說如何部署使用應用程式服務與 SQL Server 資料庫執行的 web 應用程式，並藉由解決在生產環境中管理使用者帳戶和角色的常見問題來結束。</span><span class="sxs-lookup"><span data-stu-id="447af-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="447af-130">書籍審查應用程式的更新</span><span class="sxs-lookup"><span data-stu-id="447af-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="447af-131">過去幾個教學課程中，書籍審查 web 應用程式已從靜態網站更新為動態、資料導向的 web 應用程式，並提供一組管理頁面來管理內容和評論。</span><span class="sxs-lookup"><span data-stu-id="447af-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="447af-132">不過，此管理區段目前並未受到保護-任何知道（或猜測）系統管理頁面 URL 的使用者，都可以在我們的網站上 waltz 及建立、編輯或刪除評論。</span><span class="sxs-lookup"><span data-stu-id="447af-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="447af-133">保護網站某些部分的常見方式是執行使用者帳戶，然後使用 URL 授權規則來限制特定使用者或角色的存取權。</span><span class="sxs-lookup"><span data-stu-id="447af-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="447af-134">本教學課程可供您下載的書籍評論 web 應用程式支援使用者帳戶和角色。</span><span class="sxs-lookup"><span data-stu-id="447af-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="447af-135">它具有名為 Admin 的單一角色，而且只有此角色中的使用者可以存取管理頁面。</span><span class="sxs-lookup"><span data-stu-id="447af-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="447af-136">我曾在本書審查 web 應用程式中建立三個使用者帳戶： Scott、Jisun 和 Alice。</span><span class="sxs-lookup"><span data-stu-id="447af-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="447af-137">這三個使用者都有相同的密碼： **password！**</span><span class="sxs-lookup"><span data-stu-id="447af-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="447af-138">Scott 和 Jisun 是在系統管理員角色中，而 Alice 則不是。</span><span class="sxs-lookup"><span data-stu-id="447af-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="447af-139">匿名使用者仍然可以存取網站的非系統管理頁面。</span><span class="sxs-lookup"><span data-stu-id="447af-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="447af-140">也就是說，除非您想要管理網站，否則您不需要登入，就可以造訪該網站，在此情況下，您必須以系統管理員角色的使用者身分登入。</span><span class="sxs-lookup"><span data-stu-id="447af-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>

<span data-ttu-id="447af-141">本書審查應用程式的主版頁面已更新為針對已驗證和匿名使用者包含不同的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="447af-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="447af-142">如果匿名使用者造訪網站，她會看到右上角的登入連結。</span><span class="sxs-lookup"><span data-stu-id="447af-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="447af-143">已驗證的使用者會看到訊息：「歡迎回來，使用者*名稱*！」</span><span class="sxs-lookup"><span data-stu-id="447af-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="447af-144">和登出的連結。另外還有一個登入頁面（`~/Login.aspx`），其中包含一個登入 Web 控制項，可提供驗證訪客的使用者介面和邏輯。</span><span class="sxs-lookup"><span data-stu-id="447af-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="447af-145">只有系統管理員可以建立新的帳戶。</span><span class="sxs-lookup"><span data-stu-id="447af-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="447af-146">（您可以在 [`~/Admin`] 資料夾中，建立及管理使用者帳戶的頁面）。</span><span class="sxs-lookup"><span data-stu-id="447af-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="447af-147">設定成員資格和角色 Api</span><span class="sxs-lookup"><span data-stu-id="447af-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="447af-148">本書審查 web 應用程式會使用成員資格和角色 Api 來支援使用者帳戶，並將這些使用者分組為角色（也就是系統管理員角色）。</span><span class="sxs-lookup"><span data-stu-id="447af-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="447af-149">因為我們想要將帳戶和角色資訊儲存在 SQL Server 資料庫中，所以會使用 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供者類別。</span><span class="sxs-lookup"><span data-stu-id="447af-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="447af-150">本教學課程並非針對設定 web 應用程式以支援成員資格和角色 Api 進行詳細的檢查。</span><span class="sxs-lookup"><span data-stu-id="447af-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="447af-151">若要徹底瞭解這些 Api，以及設定網站使用它們所需採取的步驟，請閱讀我的[*網站安全性教學*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)課程。</span><span class="sxs-lookup"><span data-stu-id="447af-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

<span data-ttu-id="447af-152">若要搭配使用應用程式服務與 SQL Server 資料庫，您必須先將這些提供者所使用的資料庫物件，新增至您想要儲存使用者帳戶和角色資訊的資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="447af-153">這些必要的資料庫物件包括各種資料表、視圖和預存程式。</span><span class="sxs-lookup"><span data-stu-id="447af-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="447af-154">除非另有指定，否則 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供者類別會使用位於應用程式 s `App_Data` 資料夾中名為 `ASPNETDB` 的 SQL Server Express Edition 資料庫;如果這類資料庫不存在，則會在執行時間使用這些提供者自動建立所需的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="447af-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="447af-155">在儲存網站的應用程式專屬資料的相同資料庫中建立應用程式服務資料庫物件是可行的，通常是理想的做法。</span><span class="sxs-lookup"><span data-stu-id="447af-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="447af-156">.NET Framework 隨附名為 `aspnet_regsql.exe` 的工具，它會在指定的資料庫上安裝資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="447af-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="447af-157">我已經開始使用此工具，將這些物件新增至 `App_Data` 資料夾（開發資料庫）中的 `Reviews.mdf` 資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="447af-158">我們將在本教學課程稍後將這些物件新增至生產資料庫時，瞭解如何使用此工具。</span><span class="sxs-lookup"><span data-stu-id="447af-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="447af-159">如果您將應用程式服務資料庫物件加入至以外的 `ASPNETDB` 資料庫，就必須自訂 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供者類別設定，使其使用適當的資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="447af-160">若要自訂成員資格提供者，請在 `Web.config`的 `<system.web>` 區段中新增[ *&lt;成員資格&gt; 元素*](https://msdn.microsoft.com/library/1b9hw62f.aspx)。使用[ *&lt;roleManager&gt; 元素*](https://msdn.microsoft.com/library/ms164660.aspx)來設定角色提供者。</span><span class="sxs-lookup"><span data-stu-id="447af-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="447af-161">下列程式碼片段取自書籍審查應用程式 `Web.config`，並顯示成員資格和角色 Api 的設定。</span><span class="sxs-lookup"><span data-stu-id="447af-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="447af-162">請注意，同時註冊新的提供者 `ReviewMembership` 和 `ReviewRole`，分別使用 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供者。</span><span class="sxs-lookup"><span data-stu-id="447af-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample1.xml)]

<span data-ttu-id="447af-163">`Web.config` 檔案 s `<authentication>` 元素也已設定為支援表單架構驗證。</span><span class="sxs-lookup"><span data-stu-id="447af-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="447af-164">限制系統管理頁面的存取權</span><span class="sxs-lookup"><span data-stu-id="447af-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="447af-165">ASP.NET 可讓使用者或角色透過其*URL 授權*功能，輕鬆地授與或拒絕存取特定檔案或資料夾。</span><span class="sxs-lookup"><span data-stu-id="447af-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="447af-166">（我們在*iis 與 ASP.NET 程式開發伺服器教學課程之間的核心差異*中簡要討論了 url 授權，並示範 iis 和 ASP.NET 程式開發伺服器如何以不同的方式套用靜態與動態內容的 url 授權規則）。因為我們想要禁止 `~/Admin` 存取 [系統管理員] 角色中的使用者，否則我們必須在此資料夾中新增 URL 授權規則。</span><span class="sxs-lookup"><span data-stu-id="447af-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="447af-167">具體而言，URL 授權規則必須允許系統管理員角色的使用者，並拒絕所有其他使用者。</span><span class="sxs-lookup"><span data-stu-id="447af-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="447af-168">這是藉由使用下列內容將 `Web.config` 檔案新增至 `~/Admin` 資料夾來完成：</span><span class="sxs-lookup"><span data-stu-id="447af-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample3.xml)]

<span data-ttu-id="447af-169">如需 ASP.NET s URL 授權功能的詳細資訊，以及如何使用它來為使用者和角色簽出授權規則，請務必閱讀我的[*網站安全性教學*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)課程中的以[*使用者為基礎的授權*](../../older-versions-security/membership/user-based-authorization-vb.md)和以[*角色為基礎的授權*](../../older-versions-security/roles/role-based-authorization-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="447af-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-vb.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-vb.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="447af-170">部署使用應用程式服務的 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="447af-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="447af-171">當部署使用應用程式服務的網站，以及將應用程式服務資訊儲存在資料庫中的提供者時，必須在生產資料庫上建立應用程式服務所需的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="447af-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="447af-172">一開始，生產資料庫不會包含這些物件，因此當第一次部署應用程式時（或是在加入應用程式服務之後第一次部署時），您必須採取額外的步驟，才能在上取得這些必要的資料庫物件。生產資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="447af-173">如果您想要將在開發環境中建立的使用者帳戶複寫到生產環境，部署使用應用程式服務的網站時，可能會發生另一項挑戰。</span><span class="sxs-lookup"><span data-stu-id="447af-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="447af-174">視成員資格和角色的設定而定，即使您成功地將在開發環境中建立的使用者帳戶複製到實際執行的資料庫，這些使用者還是無法登入生產環境中的 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="447af-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="447af-175">我們將探討此問題的原因，並討論如何避免發生這種情況。</span><span class="sxs-lookup"><span data-stu-id="447af-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="447af-176">ASP.NET 隨附一個絕佳的[*網站管理工具（WSAT）* ](https://msdn.microsoft.com/library/yy40ytx0.aspx) ，可從 Visual Studio 啟動，並允許透過 Web 型介面來管理使用者帳戶、角色和授權規則。</span><span class="sxs-lookup"><span data-stu-id="447af-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="447af-177">可惜的是，WSAT 只適用于本機網站，這表示它不能用來從遠端系統管理生產環境中 web 應用程式的使用者帳戶、角色和授權規則。</span><span class="sxs-lookup"><span data-stu-id="447af-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="447af-178">我們將探討不同的方法，從您的生產網站執行類似 WSAT 的行為。</span><span class="sxs-lookup"><span data-stu-id="447af-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnet_regsqlexe"></a><span data-ttu-id="447af-179">使用 aspnet\_regsql 新增資料庫物件</span><span class="sxs-lookup"><span data-stu-id="447af-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="447af-180">*部署資料庫*教學課程示範如何將資料表和資料從開發資料庫複製到實際執行資料庫，而這些技巧當然可以用來將應用程式服務資料庫物件複製到實際執行資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="447af-181">另一個選項是 `aspnet_regsql.exe` 工具，它會從資料庫新增或移除應用程式服務資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="447af-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="447af-182">`aspnet_regsql.exe` 工具會在指定的資料庫上建立資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="447af-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="447af-183">它不會將這些資料庫物件中的資料從開發資料庫移轉到生產資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="447af-184">如果您想要將開發資料庫中的使用者帳戶和角色資訊複製到實際執行資料庫，請使用*部署資料庫*教學課程中所涵蓋的技術。</span><span class="sxs-lookup"><span data-stu-id="447af-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>

<span data-ttu-id="447af-185">讓我們看看如何使用 `aspnet_regsql.exe` 工具，將資料庫物件加入至生產資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="447af-186">一開始請開啟 Windows Explorer，流覽至電腦上的 .NET Framework 2.0 版目錄，% WINDIR% \NET\Framework\v2.0.50727。</span><span class="sxs-lookup"><span data-stu-id="447af-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="447af-187">您應該會找到 `aspnet_regsql.exe` 工具。</span><span class="sxs-lookup"><span data-stu-id="447af-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="447af-188">此工具可從命令列使用，但它也包含圖形化使用者介面;按兩下 [`aspnet_regsql.exe`] 檔案以啟動其圖形元件。</span><span class="sxs-lookup"><span data-stu-id="447af-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="447af-189">此工具一開始會顯示一個說明其用途的啟動顯示畫面。</span><span class="sxs-lookup"><span data-stu-id="447af-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="447af-190">按 [下一步] 進入 [選取安裝選項] 畫面，如 [圖 1] 所示。</span><span class="sxs-lookup"><span data-stu-id="447af-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="447af-191">您可以從這裡加入宣告應用程式服務資料庫物件，或從資料庫中移除它們。</span><span class="sxs-lookup"><span data-stu-id="447af-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="447af-192">因為我們想要將這些物件新增至生產資料庫，請選取 [設定應用程式服務的 SQL Server] 選項，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="447af-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>

<span data-ttu-id="447af-193">[![選擇設定應用程式服務的 SQL Server](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="447af-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span></span>

<span data-ttu-id="447af-194">**圖 1**：選擇設定應用程式服務的 SQL Server （[按一下以查看完整大小的影像](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg)）</span><span class="sxs-lookup"><span data-stu-id="447af-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg))</span></span>

<span data-ttu-id="447af-195">在 [選取伺服器和資料庫] 畫面中，會提示您提供連接到資料庫的資訊。</span><span class="sxs-lookup"><span data-stu-id="447af-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="447af-196">輸入您的 web 主控公司提供的資料庫伺服器、安全性認證和資料庫名稱，然後按 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="447af-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="447af-197">輸入您的資料庫伺服器和認證之後，您可能會在展開 [資料庫] 下拉式清單時收到錯誤。</span><span class="sxs-lookup"><span data-stu-id="447af-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="447af-198">`aspnet_regsql.exe` 工具會查詢 `sysdatabases` 系統資料表，以取得伺服器上的資料庫清單，但某些虛擬主機公司會鎖定其資料庫伺服器，讓這項資訊無法公開使用。</span><span class="sxs-lookup"><span data-stu-id="447af-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="447af-199">如果您收到此錯誤，您可以直接在下拉式清單中輸入資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="447af-199">If you get this error you can type the database name directly into the drop-down list.</span></span>

<span data-ttu-id="447af-200">[![提供您資料庫的連接資訊給工具](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="447af-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span></span>

<span data-ttu-id="447af-201">**圖 2**：提供工具與您的資料庫連接資訊（[按一下以觀看完整大小的影像](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg)）</span><span class="sxs-lookup"><span data-stu-id="447af-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg))</span></span>

<span data-ttu-id="447af-202">後續畫面會匯總即將發生的動作，亦即應用程式服務資料庫物件將會加入至指定的資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="447af-203">按 [下一步] 完成此動作。</span><span class="sxs-lookup"><span data-stu-id="447af-203">Click Next to complete this action.</span></span> <span data-ttu-id="447af-204">幾分鐘後，就會顯示最後一個畫面，請注意，已加入資料庫物件（請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="447af-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>

<span data-ttu-id="447af-205">[![成功！應用程式服務資料庫物件已加入至生產資料庫](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="447af-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span></span>

<span data-ttu-id="447af-206">**圖 3**：成功！</span><span class="sxs-lookup"><span data-stu-id="447af-206">**Figure 3**: Success!</span></span> <span data-ttu-id="447af-207">應用程式服務資料庫物件已加入至生產資料庫（[按一下以查看完整大小的影像](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg)）</span><span class="sxs-lookup"><span data-stu-id="447af-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg))</span></span>

<span data-ttu-id="447af-208">若要確認應用程式服務資料庫物件已成功加入至生產資料庫，請開啟 SQL Server Management Studio 並聯機到您的生產環境資料庫。</span><span class="sxs-lookup"><span data-stu-id="447af-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="447af-209">如 [圖 4] 所示，您現在應該會看到資料庫中的應用程式服務資料庫資料表、`aspnet_Applications`、`aspnet_Membership`、`aspnet_Users`等等。</span><span class="sxs-lookup"><span data-stu-id="447af-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>

<span data-ttu-id="447af-210">[![確認資料庫物件已加入至生產資料庫](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="447af-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span></span>

<span data-ttu-id="447af-211">**圖 4**：確認資料庫物件已加入至生產資料庫（[按一下以查看完整大小的影像](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg)）</span><span class="sxs-lookup"><span data-stu-id="447af-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg))</span></span>

<span data-ttu-id="447af-212">您只需要在第一次部署 web 應用程式時，或在您開始使用應用程式服務之後首次使用 `aspnet_regsql.exe` 工具。</span><span class="sxs-lookup"><span data-stu-id="447af-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="447af-213">一旦這些資料庫物件位於生產資料庫上，就不需要重新加入或修改。</span><span class="sxs-lookup"><span data-stu-id="447af-213">Once these database objects are on the production database they won't need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="447af-214">將使用者帳戶從開發複製到生產環境</span><span class="sxs-lookup"><span data-stu-id="447af-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="447af-215">使用 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供者類別將應用程式服務資訊儲存在 SQL Server 資料庫時，使用者帳戶和角色資訊會儲存在各種不同的資料庫資料表中，包括 `aspnet_Users`、`aspnet_Membership`、`aspnet_Roles`和 `aspnet_UsersInRoles`等等。</span><span class="sxs-lookup"><span data-stu-id="447af-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="447af-216">在開發期間，您會在開發環境中建立使用者帳戶，藉由從適用的資料庫資料表複製對應的記錄，即可在生產環境中複寫這些使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="447af-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="447af-217">如果您使用 [資料庫發佈嚮導] 來部署應用程式服務資料庫物件，您可能也已選擇複製記錄，這會導致在開發期間建立的使用者帳戶也會在生產環境中。</span><span class="sxs-lookup"><span data-stu-id="447af-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="447af-218">但視您的設定而定，您可能會發現那些帳戶在開發中建立並複製到生產環境的使用者無法從生產網站登入。</span><span class="sxs-lookup"><span data-stu-id="447af-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="447af-219">那該怎麼做呢？</span><span class="sxs-lookup"><span data-stu-id="447af-219">What gives?</span></span>

<span data-ttu-id="447af-220">`SqlMembershipProvider` 和 `SqlRoleProvider` 提供者類別的設計，就是單一資料庫可做為多個應用程式的使用者存放區，而每個應用程式在理論上，都有具有相同名稱的使用者和角色重迭。</span><span class="sxs-lookup"><span data-stu-id="447af-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="447af-221">為了允許此彈性，資料庫會維護 `aspnet_Applications` 資料表中的應用程式清單，而每個使用者都與這些應用程式的其中一個相關聯。</span><span class="sxs-lookup"><span data-stu-id="447af-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="447af-222">具體而言，`aspnet_Users` 資料表具有 `ApplicationId` 資料行，其會將每個使用者系結至 `aspnet_Applications` 資料表中的記錄。</span><span class="sxs-lookup"><span data-stu-id="447af-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="447af-223">除了 `ApplicationId` 資料行之外，`aspnet_Applications` 資料表也包含 `ApplicationName` 的資料行，可為應用程式提供更好的易記名稱。</span><span class="sxs-lookup"><span data-stu-id="447af-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="447af-224">當網站嘗試使用使用者帳戶時（例如從登入頁面驗證使用者的認證），必須告知 `SqlMembershipProvider` 類別要使用哪個應用程式。</span><span class="sxs-lookup"><span data-stu-id="447af-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="447af-225">它通常會藉由提供應用程式名稱來完成這項工作，而此值是來自 `Web.config` 中的提供者 s 設定-特別是透過 `applicationName` 屬性。</span><span class="sxs-lookup"><span data-stu-id="447af-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="447af-226">但是，如果 `Web.config`中未指定 `applicationName` 屬性，會發生什麼事？</span><span class="sxs-lookup"><span data-stu-id="447af-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="447af-227">在這種情況下，成員資格系統會使用應用程式根目錄路徑作為 `applicationName` 值。</span><span class="sxs-lookup"><span data-stu-id="447af-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="447af-228">如果未在 `Web.config`中明確設定 `applicationName` 屬性，則開發環境和生產環境可能會使用不同的應用程式根目錄，因此會與應用程式服務中的不同應用程式名稱產生關聯。</span><span class="sxs-lookup"><span data-stu-id="447af-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="447af-229">如果發生這種不相符的情況，在開發環境中建立的使用者將會有 `ApplicationId` 值與生產環境的 `ApplicationId` 值不相符。</span><span class="sxs-lookup"><span data-stu-id="447af-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="447af-230">最終結果是那些使用者將無法登入。</span><span class="sxs-lookup"><span data-stu-id="447af-230">The net result is that those users won't be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="447af-231">如果您在這種情況下發現自己-使用 `ApplicationId` 值不相符的使用者帳戶複製到生產環境，您可以撰寫查詢，將這些不正確的 `ApplicationId` 值更新為生產環境中所使用的 `ApplicationId`。</span><span class="sxs-lookup"><span data-stu-id="447af-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="447af-232">更新之後，在開發環境中建立帳戶的使用者現在將能夠在實際執行時登入 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="447af-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>

<span data-ttu-id="447af-233">好消息是，您可以採取一個簡單的步驟，以確保兩個環境使用相同的 `ApplicationId`-在 `Web.config` 中明確設定所有應用程式服務提供者的 `applicationName` 屬性。</span><span class="sxs-lookup"><span data-stu-id="447af-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="447af-234">我在 `<membership>` 和 `<roleManager>` 專案中，將 `applicationName` 屬性明確設定為 "BookReviews"，如同 `Web.config` 顯示的這個程式碼片段。</span><span class="sxs-lookup"><span data-stu-id="447af-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample4.xml)]

<span data-ttu-id="447af-235">如需有關設定 `applicationName` 屬性和其背後原理的詳細討論，請參閱[*Scott Guthrie*](https://weblogs.asp.net/scottgu/)的 blog 文章：[*設定 ASP.NET 成員資格和其他提供者時，一律設定 applicationName 屬性*](https://weblogs.asp.net/scottgu/443634)。</span><span class="sxs-lookup"><span data-stu-id="447af-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="447af-236">管理生產環境中的使用者帳戶</span><span class="sxs-lookup"><span data-stu-id="447af-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="447af-237">ASP.NET 網站管理工具（WSAT）可讓您輕鬆地建立和管理使用者帳戶、定義和套用角色，以及將使用者和角色型授權規則拼出。</span><span class="sxs-lookup"><span data-stu-id="447af-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="447af-238">您可以前往 [方案總管]，然後按一下 [ASP.NET 設定] 圖示，或前往 [網站] 或 [專案] 功能表，然後選取 [ASP.NET 設定] 功能表項目，從 Visual Studio 啟動 WSAT。</span><span class="sxs-lookup"><span data-stu-id="447af-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="447af-239">可惜的是，WSAT 只能搭配本機網站使用。</span><span class="sxs-lookup"><span data-stu-id="447af-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="447af-240">因此，您無法從您的工作站使用 WSAT 來管理生產環境中的網站。</span><span class="sxs-lookup"><span data-stu-id="447af-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="447af-241">好消息是，WSAT 所提供的所有功能都可透過成員資格和角色 Api 以程式設計方式取得;此外，許多 WSAT 畫面都使用標準的 ASP.NET 登入相關控制項。</span><span class="sxs-lookup"><span data-stu-id="447af-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="447af-242">簡言之，您可以將 ASP.NET 網頁新增至您的網站，以提供必要的管理功能。</span><span class="sxs-lookup"><span data-stu-id="447af-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="447af-243">回想一下，先前的教學課程已更新書籍審查 web 應用程式以包含 `~/Admin` 資料夾，而且此資料夾已設定為只允許系統管理員角色中的使用者。</span><span class="sxs-lookup"><span data-stu-id="447af-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="447af-244">我在名為 `CreateAccount.aspx` 的資料夾中新增了一個頁面，系統管理員可以從這裡建立新的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="447af-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="447af-245">此頁面使用 CreateUserWizard 控制項來顯示用來建立新使用者帳戶的使用者介面和後端邏輯。</span><span class="sxs-lookup"><span data-stu-id="447af-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="447af-246">再來，我自訂控制項以包含一個核取方塊，提示新使用者是否也應新增至系統管理員角色（請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="447af-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="447af-247">有了一些工作，您可以建立一組自訂的頁面，以執行 WSAT 所提供的使用者和角色管理相關工作。</span><span class="sxs-lookup"><span data-stu-id="447af-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="447af-248">如需有關使用成員資格和角色 Api 以及與登入相關的 ASP.NET Web 控制項的詳細資訊，請務必閱讀我的[*網站安全性教學*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)課程。</span><span class="sxs-lookup"><span data-stu-id="447af-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="447af-249">如需自訂 CreateUserWizard 控制項的詳細資訊，請參閱[*建立使用者帳戶*](../../older-versions-security/membership/creating-user-accounts-vb.md)和[*儲存其他使用者資訊*](../../older-versions-security/membership/storing-additional-user-information-vb.md)教學課程，或查看[*Erich Peterson*](http://www.erichpeterson.com/) s 文章：[*自訂 CreateUserWizard 控制項*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="447af-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-vb.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-vb.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>

<span data-ttu-id="447af-250">[![系統管理員可以建立新的使用者帳戶](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="447af-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span></span>

<span data-ttu-id="447af-251">[**圖 5**]：系統管理員可以建立新的使用者帳戶（[按一下以觀看完整大小的影像](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg)）</span><span class="sxs-lookup"><span data-stu-id="447af-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg))</span></span>

<span data-ttu-id="447af-252">如果您需要 WSAT 的完整功能，請參閱[*推出您自己的網站管理工具*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)，其中作者 Dan Clem 會逐步解說建立自訂 WSAT 工具的程式。</span><span class="sxs-lookup"><span data-stu-id="447af-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="447af-253">Dan 會共用其應用程式的原始程式碼（ C#在中），並提供逐步指示，說明如何將其新增至您的託管網站。</span><span class="sxs-lookup"><span data-stu-id="447af-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="447af-254">總結</span><span class="sxs-lookup"><span data-stu-id="447af-254">Summary</span></span>

<span data-ttu-id="447af-255">當部署使用應用程式服務資料庫執行的 web 應用程式時，您必須先確定生產資料庫具有必要的資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="447af-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="447af-256">您可以使用*部署資料庫*教學課程中所討論的技術來新增這些物件;或者，您可以使用 `aspnet_regsql.exe` 工具，如我們在本教學課程中所見。</span><span class="sxs-lookup"><span data-stu-id="447af-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="447af-257">我們在同步處理開發和生產環境中所使用的應用程式名稱時所觸及的其他挑戰（如果您想要在開發環境中建立的使用者和角色在實際執行時有效，這點很重要）和技術管理生產環境中的使用者和角色。</span><span class="sxs-lookup"><span data-stu-id="447af-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="447af-258">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="447af-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="447af-259">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="447af-259">Further Reading</span></span>

<span data-ttu-id="447af-260">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="447af-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="447af-261">*ASP.NET SQL Server 註冊工具（aspnet_regsql .exe）* </span><span class="sxs-lookup"><span data-stu-id="447af-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/library/ms229862.aspx)
- [<span data-ttu-id="447af-262">*建立 SQL Server 的應用程式服務資料庫*</span><span class="sxs-lookup"><span data-stu-id="447af-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/library/x28wfk74.aspx)
- [<span data-ttu-id="447af-263">*在 SQL Server 中建立成員資格架構*</span><span class="sxs-lookup"><span data-stu-id="447af-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-vb.md)
- [<span data-ttu-id="447af-264">*檢查 ASP.NET 的成員資格、角色和設定檔*</span><span class="sxs-lookup"><span data-stu-id="447af-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="447af-265">*推出您自己的網站管理工具*</span><span class="sxs-lookup"><span data-stu-id="447af-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="447af-266">*網站安全性教學課程*</span><span class="sxs-lookup"><span data-stu-id="447af-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="447af-267">*網站管理工具總覽*</span><span class="sxs-lookup"><span data-stu-id="447af-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/library/yy40ytx0.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="447af-268">[上一頁](configuring-the-production-web-application-to-use-the-production-database-vb.md)
> [下一頁](strategies-for-database-development-and-deployment-vb.md)</span><span class="sxs-lookup"><span data-stu-id="447af-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-vb.md)
[Next](strategies-for-database-development-and-deployment-vb.md)</span></span>
