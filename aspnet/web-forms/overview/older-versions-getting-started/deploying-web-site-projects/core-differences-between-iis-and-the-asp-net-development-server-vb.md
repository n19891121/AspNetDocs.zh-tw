---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-vb
title: IIS 與 ASP.NET 程式開發伺服器之間的核心差異（VB） |Microsoft Docs
author: rick-anderson
description: 在本機測試 ASP.NET 應用程式時，您可能會使用 ASP.NET 開發 Web 服務器。 不過，生產網站很可能 pow 。
ms.author: riande
ms.date: 04/01/2009
ms.assetid: 090e9205-52f3-4d72-ae31-44775b8b8421
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-vb
msc.type: authoredcontent
ms.openlocfilehash: 880bb403e671446a77d7eebccf578a1dc714d1f9
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74586585"
---
# <a name="core-differences-between-iis-and-the-aspnet-development-server-vb"></a><span data-ttu-id="a35ad-104">IIS 與 ASP.NET 程式開發伺服器間的核心差異 (VB)</span><span class="sxs-lookup"><span data-stu-id="a35ad-104">Core Differences Between IIS and the ASP.NET Development Server (VB)</span></span>

<span data-ttu-id="a35ad-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a35ad-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a35ad-106">[下載程式代碼](https://download.microsoft.com/download/4/5/F/45F815EC-8B0E-46D3-9FB8-2DC015CCA306/ASPNET_Hosting_Tutorial_06_VB.zip)或[下載 PDF](https://download.microsoft.com/download/E/8/9/E8920AE6-D441-41A7-8A77-9EF8FF970D8B/aspnet_tutorial06_WebServerDiff_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="a35ad-106">[Download Code](https://download.microsoft.com/download/4/5/F/45F815EC-8B0E-46D3-9FB8-2DC015CCA306/ASPNET_Hosting_Tutorial_06_VB.zip) or [Download PDF](https://download.microsoft.com/download/E/8/9/E8920AE6-D441-41A7-8A77-9EF8FF970D8B/aspnet_tutorial06_WebServerDiff_vb.pdf)</span></span>

> <span data-ttu-id="a35ad-107">在本機測試 ASP.NET 應用程式時，您可能會使用 ASP.NET 開發 Web 服務器。</span><span class="sxs-lookup"><span data-stu-id="a35ad-107">When testing an ASP.NET application locally, chances are you are using the ASP.NET Development Web Server.</span></span> <span data-ttu-id="a35ad-108">不過，生產網站很可能是有能力的 IIS。</span><span class="sxs-lookup"><span data-stu-id="a35ad-108">However, the production website is most likely powered IIS.</span></span> <span data-ttu-id="a35ad-109">這些 web 伺服器處理要求的方式有一些差異，而這些差異可能會有重要的後果。</span><span class="sxs-lookup"><span data-stu-id="a35ad-109">There are some differences between how these web servers handle requests, and these differences can have important consequences.</span></span> <span data-ttu-id="a35ad-110">本教學課程將探討一些更無關的差異。</span><span class="sxs-lookup"><span data-stu-id="a35ad-110">This tutorial explores some of the more germane differences.</span></span>

## <a name="introduction"></a><span data-ttu-id="a35ad-111">簡介</span><span class="sxs-lookup"><span data-stu-id="a35ad-111">Introduction</span></span>

<span data-ttu-id="a35ad-112">每當使用者造訪 ASP.NET 應用程式時，他的瀏覽器就會將要求傳送至網站。</span><span class="sxs-lookup"><span data-stu-id="a35ad-112">Whenever a user visits an ASP.NET application his browser sends a request to the website.</span></span> <span data-ttu-id="a35ad-113">Web 服務器軟體會收取該要求，這會與 ASP.NET 執行時間協調，以產生並傳回所要求資源的內容。</span><span class="sxs-lookup"><span data-stu-id="a35ad-113">That request is picked up by the web server software, which coordinates with the ASP.NET runtime to generate and return the content for the requested resource.</span></span> <span data-ttu-id="a35ad-114">[ **I** Nternet **i** nformation (資訊**S** ervices （IIS）](http://en.wikipedia.org/wiki/Internet_Information_Services)是一套服務，可為 Windows 伺服器提供通用的網際網路功能。</span><span class="sxs-lookup"><span data-stu-id="a35ad-114">The[**I** nternet **I** nformation **S** ervices (IIS)](http://en.wikipedia.org/wiki/Internet_Information_Services) are a suite of services that provide common Internet-based functionality for Windows servers.</span></span> <span data-ttu-id="a35ad-115">IIS 是用來在生產環境中 ASP.NET 應用程式最常用的 web 伺服器;您的 web 主機提供者很可能會使用 web 伺服器軟體來提供您的 ASP.NET 應用程式。</span><span class="sxs-lookup"><span data-stu-id="a35ad-115">IIS is the most commonly used web server for ASP.NET applications in production environments; it's most likely the web server software being used by your web host provider to serve your ASP.NET application.</span></span> <span data-ttu-id="a35ad-116">IIS 也可以做為開發環境中的 web 伺服器軟體，不過這牽涉到安裝 IIS 並正確設定它。</span><span class="sxs-lookup"><span data-stu-id="a35ad-116">IIS can also be used as the web server software in the development environment, although this entails installing IIS and properly configuring it.</span></span>

<span data-ttu-id="a35ad-117">ASP.NET 程式開發伺服器是適用于開發環境的替代 web 伺服器選項;它隨附于，並已整合到 Visual Studio 中。</span><span class="sxs-lookup"><span data-stu-id="a35ad-117">The ASP.NET Development Server is an alternative web server option for the development environment; it ships with and is integrated into Visual Studio.</span></span> <span data-ttu-id="a35ad-118">除非 web 應用程式已設定為使用 IIS，否則當您第一次從 Visual Studio 內流覽網頁時，ASP.NET 程式開發伺服器會自動啟動並當做 web 伺服器使用。</span><span class="sxs-lookup"><span data-stu-id="a35ad-118">Unless the web application has been configured to use IIS, the ASP.NET Development Server is automatically started and used as the web server the first time you visit a web page from within Visual Studio.</span></span> <span data-ttu-id="a35ad-119">我們在[*判斷需要部署哪些*](determining-what-files-need-to-be-deployed-vb.md)檔案教學課程中所建立的示範 web 應用程式，都是以檔案系統為基礎的 web 應用程式，但未設定為使用 IIS。</span><span class="sxs-lookup"><span data-stu-id="a35ad-119">The demo web applications we created back in the [*Determining What Files Need to Be Deployed*](determining-what-files-need-to-be-deployed-vb.md) tutorial were both file system-based web applications that were not configured to use IIS.</span></span> <span data-ttu-id="a35ad-120">因此，從 Visual Studio 流覽其中一個網站時，會使用 ASP.NET 程式開發伺服器。</span><span class="sxs-lookup"><span data-stu-id="a35ad-120">Therefore, when visiting either of these websites from within Visual Studio the ASP.NET Development Server is used.</span></span>

<span data-ttu-id="a35ad-121">在完美的世界中，開發和生產環境會完全相同。</span><span class="sxs-lookup"><span data-stu-id="a35ad-121">In a perfect world the development and production environments would be identical.</span></span> <span data-ttu-id="a35ad-122">不過，如同我們在先前的教學課程中所討論的，環境在不同的設定中並不常見。</span><span class="sxs-lookup"><span data-stu-id="a35ad-122">However, as we discussed in the preceding tutorial it is not uncommon for the environments to have differing configuration settings.</span></span> <span data-ttu-id="a35ad-123">在環境中使用不同的 web 伺服器軟體，會新增在部署應用程式時必須納入考慮的另一個變數。</span><span class="sxs-lookup"><span data-stu-id="a35ad-123">Using different web server software in the environments adds another variable that must be taken into consideration when deploying an application.</span></span> <span data-ttu-id="a35ad-124">本教學課程涵蓋 IIS 與 ASP.NET 程式開發伺服器之間的主要差異。</span><span class="sxs-lookup"><span data-stu-id="a35ad-124">This tutorial covers the key differences between IIS and the ASP.NET Development Server.</span></span> <span data-ttu-id="a35ad-125">因為有這些差異，所以在開發環境中執行的程式碼會擲回例外狀況，或在生產時以不同的方式運作。</span><span class="sxs-lookup"><span data-stu-id="a35ad-125">Because of these differences there are scenarios where code that runs flawlessly in the development environment throws an exception or behaves differently when executed in production.</span></span>

## <a name="security-context-differences"></a><span data-ttu-id="a35ad-126">安全性內容差異</span><span class="sxs-lookup"><span data-stu-id="a35ad-126">Security Context Differences</span></span>

<span data-ttu-id="a35ad-127">每當 web 伺服器軟體處理傳入要求時，就會將該要求與特定的安全性內容產生關聯。</span><span class="sxs-lookup"><span data-stu-id="a35ad-127">Whenever the web server software handles an incoming request it associates that request with a particular security context.</span></span> <span data-ttu-id="a35ad-128">作業系統會使用此安全性內容資訊來判斷要求所允許的動作。</span><span class="sxs-lookup"><span data-stu-id="a35ad-128">This security context information is used by the operating system to determine what actions are permissible by the request.</span></span> <span data-ttu-id="a35ad-129">例如，ASP.NET 網頁可能包含將一些訊息記錄到磁片上檔案的程式碼。</span><span class="sxs-lookup"><span data-stu-id="a35ad-129">For example, an ASP.NET page might include code that logs some message to a file on disk.</span></span> <span data-ttu-id="a35ad-130">為了讓此 ASP.NET 網頁執行而不發生錯誤，安全性內容必須具有適當的檔案系統層級許可權，亦即該檔案的寫入權限。</span><span class="sxs-lookup"><span data-stu-id="a35ad-130">In order for this ASP.NET page to execute without error, the security context must have the appropriate file system-level permissions, namely write permissions on that file.</span></span>

<span data-ttu-id="a35ad-131">ASP.NET 程式開發伺服器會將傳入要求與目前登入之使用者的安全性內容產生關聯。</span><span class="sxs-lookup"><span data-stu-id="a35ad-131">The ASP.NET Development Server associates incoming requests with the security context of the currently logged on user.</span></span> <span data-ttu-id="a35ad-132">如果您是以系統管理員身分登入您的桌面，則 ASP.NET 程式開發伺服器所提供的 ASP.NET 網頁將會具有與系統管理員相同的存取權限。</span><span class="sxs-lookup"><span data-stu-id="a35ad-132">If you are logged on to your desktop as an administrator, then the ASP.NET pages served by the ASP.NET Development Server will have the same access rights as an administrator.</span></span> <span data-ttu-id="a35ad-133">不過，IIS 所處理的 ASP.NET 要求會與特定的電腦帳戶相關聯。</span><span class="sxs-lookup"><span data-stu-id="a35ad-133">However, ASP.NET requests handled by IIS are associated with a specific machine account.</span></span> <span data-ttu-id="a35ad-134">根據預設，IIS 版本6和7會使用 Network Service 電腦帳戶，雖然您的 web 主機提供者可能已為每個客戶設定唯一的帳戶。</span><span class="sxs-lookup"><span data-stu-id="a35ad-134">By default, the Network Service machine account is used by IIS versions 6 and 7, although your web host provider may have configured a unique account for each customer.</span></span> <span data-ttu-id="a35ad-135">更多的是，您的 web 主機服務提供者可能會對此電腦帳戶提供有限的許可權。</span><span class="sxs-lookup"><span data-stu-id="a35ad-135">What's more, your web host provider has likely given limited permissions to this machine account.</span></span> <span data-ttu-id="a35ad-136">最後結果是您可能會在開發環境中有執行的網頁，而不會發生錯誤，但在生產環境中裝載時，會產生與授權相關的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="a35ad-136">The net result is that you may have web pages that execute without error in the development environment, but generate authorization-related exceptions when hosted in the production environment.</span></span>

<span data-ttu-id="a35ad-137">為了顯示這種類型的錯誤動作，我在「書籍評論」網站建立了一個頁面，該檔案會在磁片上建立一個檔案，其中儲存了在*24 小時內 ASP.NET 3.5*的最近一次觀看的日期和時間。</span><span class="sxs-lookup"><span data-stu-id="a35ad-137">To show this type of error in action I've created a page in the Book Reviews website that creates a file on disk that stores the most recent date and time someone viewed the *Teach Yourself ASP.NET 3.5 in 24 Hours* review.</span></span> <span data-ttu-id="a35ad-138">若要跟著做，請開啟 [`~/Tech/TYASP35.aspx`] 頁面，並將下列程式碼新增至 `Page_Load` 事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="a35ad-138">To follow along, open the `~/Tech/TYASP35.aspx` page and add the following code to the `Page_Load` event handler:</span></span>

[!code-vb[Main](core-differences-between-iis-and-the-asp-net-development-server-vb/samples/sample1.vb)]

> [!NOTE]
> <span data-ttu-id="a35ad-139">[`File.WriteAllText` 方法](https://msdn.microsoft.com/library/system.io.file.writealltext.aspx)會建立新的檔案（如果不存在），然後將指定的內容寫入其中。</span><span class="sxs-lookup"><span data-stu-id="a35ad-139">The [`File.WriteAllText` method](https://msdn.microsoft.com/library/system.io.file.writealltext.aspx) creates a new file if it does not exist and then writes the specified contents to it.</span></span> <span data-ttu-id="a35ad-140">如果檔案已經存在，則會覆寫現有的內容。</span><span class="sxs-lookup"><span data-stu-id="a35ad-140">If the file already exists, it's existing content is overwritten.</span></span>

<span data-ttu-id="a35ad-141">接下來，請造訪使用 ASP.NET 程式開發伺服器在開發環境中，以*24 小時的時間來教您自己的 ASP.NET 3.5* 。</span><span class="sxs-lookup"><span data-stu-id="a35ad-141">Next, visit the *Teach Yourself ASP.NET 3.5 in 24 Hours* book review page in the development environment using the ASP.NET Development Server.</span></span> <span data-ttu-id="a35ad-142">假設您使用具有足夠許可權的帳戶登入您的電腦，以在 web 應用程式的根目錄中建立和修改文字檔，則會顯示與之前相同的書籍，但每次流覽頁面時，會將日期和時間和使用者的 IP 位址儲存在 `LastTYASP35Access.txt` 檔案中。</span><span class="sxs-lookup"><span data-stu-id="a35ad-142">Assuming that you are logged on to your computer with an account that has adequate permissions to create and modify a text file in the web application's root directory the book review appears the same as before, but each time the page is visited the date and time and user's IP address is stored in the `LastTYASP35Access.txt` file.</span></span> <span data-ttu-id="a35ad-143">將瀏覽器指向此檔案;您應該會看到類似 [圖 1] 所示的訊息。</span><span class="sxs-lookup"><span data-stu-id="a35ad-143">Point your browser to this file; you should see a message similar to the one shown in Figure 1.</span></span>

<span data-ttu-id="a35ad-144">[![文字檔包含流覽書審閱的最後日期和時間&lt;](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image2.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a35ad-144">[![The Text File Contains the Last Date and Time the Book Review was Visited&lt;](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image2.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image1.png)</span></span>

<span data-ttu-id="a35ad-145">**圖 1**：文字檔包含流覽書審閱的最後日期和時間（[按一下以觀看完整大小的影像](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="a35ad-145">**Figure 1**: The Text File Contains the Last Date and Time the Book Review was Visited([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image3.png))</span></span>

<span data-ttu-id="a35ad-146">將 web 應用程式部署至生產環境，然後在24小時的書籍審查頁面中，造訪託管的*教授 ASP.NET 3.5* 。</span><span class="sxs-lookup"><span data-stu-id="a35ad-146">Deploy the web application to production and then visit the hosted *Teach Yourself ASP.NET 3.5 in 24 Hours* book review page.</span></span> <span data-ttu-id="a35ad-147">此時，您應該會看到 [書籍審查] 頁面是正常的，或如 [圖 2] 所示的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="a35ad-147">At this point you should either see the book review page as normal or the error message shown in Figure 2.</span></span> <span data-ttu-id="a35ad-148">某些 web 主機提供者會授與寫入權限給匿名 ASP.NET 電腦帳戶，在此情況下，頁面會正常執行而不會發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="a35ad-148">Some web host providers grant write permissions to the anonymous ASP.NET machine account, in which case the page will work without error.</span></span> <span data-ttu-id="a35ad-149">不過，如果您的 web 主機提供者禁止匿名帳戶的寫入權限，則當 `TYASP35.aspx` 頁面嘗試將目前的日期和時間寫入 `LastTYASP35Access.txt` 檔案時，就會引發[`UnauthorizedAccessException` 的例外](https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx)狀況。</span><span class="sxs-lookup"><span data-stu-id="a35ad-149">If, however, your web host provider prohibits write access for the anonymous account then an [`UnauthorizedAccessException` exception](https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx) is raised when the `TYASP35.aspx` page attempts to write the current date and time to the `LastTYASP35Access.txt` file.</span></span>

<span data-ttu-id="a35ad-150">[![IIS 所使用的預設電腦帳戶沒有寫入檔案系統的許可權](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image5.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a35ad-150">[![The Default Machine Account Used by IIS Does Not Have Permissions to Write to the File System](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image5.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image4.png)</span></span>

<span data-ttu-id="a35ad-151">**圖 2**： IIS 所使用的預設電腦帳戶沒有寫入檔案系統的許可權（[按一下以查看完整大小的影像](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="a35ad-151">**Figure 2**: The Default Machine Account Used by IIS Does Not Have Permissions to Write to the File System ([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image6.png))</span></span>

<span data-ttu-id="a35ad-152">好消息是，大部分的 web 主機提供者都具有某種許可權工具，可讓您在網站中指定檔案系統許可權。</span><span class="sxs-lookup"><span data-stu-id="a35ad-152">The good news is that most web host providers have some sort of permissions tool that allows you to specify file system permissions in your website.</span></span> <span data-ttu-id="a35ad-153">將根目錄的 [寫入] 存取權授與匿名 ASP.NET 帳戶，然後再重新流覽 [書籍審查] 頁面。</span><span class="sxs-lookup"><span data-stu-id="a35ad-153">Grant the anonymous ASP.NET account write access to the root directory and then revisit the book review page.</span></span> <span data-ttu-id="a35ad-154">（如有需要，請洽詢您的 web 主機提供者，以取得如何將寫入權限授與預設 ASP.NET 帳戶的協助）。此時，頁面應該會載入而不會發生錯誤，而且應該成功建立 `LastTYASP35Access.txt` 檔案。</span><span class="sxs-lookup"><span data-stu-id="a35ad-154">(If needed, contact your web host provider for assistance on how to grant write permissions to the default ASP.NET account.) This time the page should load without error and the `LastTYASP35Access.txt` file should be created successfully.</span></span>

<span data-ttu-id="a35ad-155">這就是因為 ASP.NET 程式開發伺服器在不同于 IIS 的安全性內容下運作，所以您可以在檔案系統中讀取或寫入的 ASP.NET 網頁、讀取或寫入 Windows 事件記錄檔，或是讀取或寫入 Windows 登錄會在開發時如預期般運作，但在生產環境中會產生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="a35ad-155">The take away here is that because the ASP.NET Development Server operates under a different security context than IIS, it is possible that your ASP.NET pages that read or write to the file system, read from or write to the Windows Event Log, or read or write to the Windows registry will work as expected on development but generate exceptions when on production.</span></span> <span data-ttu-id="a35ad-156">建立將部署至共用 web 主控環境的 web 應用程式時，請勿讀取或寫入事件記錄檔或 Windows 登錄。</span><span class="sxs-lookup"><span data-stu-id="a35ad-156">When building a web application that will be deployed to a shared web hosting environment, do not read or write to the Event Log or the Windows registry.</span></span> <span data-ttu-id="a35ad-157">也請記下任何讀取或寫入檔案系統的 ASP.NET 網頁，因為您可能需要在生產環境中對適當的資料夾授與讀取和寫入權限。</span><span class="sxs-lookup"><span data-stu-id="a35ad-157">Also take note of any ASP.NET pages that read from or write to the file system as you may need to grant read and write privileges on the appropriate folders in the production environment.</span></span>

## <a name="differences-on-serving-static-content"></a><span data-ttu-id="a35ad-158">提供靜態內容的差異</span><span class="sxs-lookup"><span data-stu-id="a35ad-158">Differences On Serving Static Content</span></span>

<span data-ttu-id="a35ad-159">IIS 和 ASP.NET 程式開發伺服器之間的另一個核心差異在於它們如何處理靜態內容的要求。</span><span class="sxs-lookup"><span data-stu-id="a35ad-159">Another core difference between IIS and the ASP.NET Development Server is how they handle requests for static content.</span></span> <span data-ttu-id="a35ad-160">傳入 ASP.NET 程式開發伺服器的每個要求（不論是 ASP.NET 網頁、影像或 JavaScript 檔案）都是由 ASP.NET 執行時間所處理。</span><span class="sxs-lookup"><span data-stu-id="a35ad-160">Every request that comes into the ASP.NET Development Server, whether for an ASP.NET page, an image, or a JavaScript file, is processed by the ASP.NET runtime.</span></span> <span data-ttu-id="a35ad-161">根據預設，IIS 只會在要求傳入 ASP.NET 資源（例如 ASP.NET 網頁、Web 服務等等）時，叫用 ASP.NET 執行時間。</span><span class="sxs-lookup"><span data-stu-id="a35ad-161">By default, IIS only invokes the ASP.NET runtime when a request comes in for an ASP.NET resource, such as an ASP.NET web page, a Web Service, and so forth.</span></span> <span data-ttu-id="a35ad-162">IIS 會抓取靜態內容（影像、CSS 檔案、JavaScript 檔案、PDF 檔案、ZIP 檔案和 like）的要求，而不需要 ASP.NET 執行時間的介入。</span><span class="sxs-lookup"><span data-stu-id="a35ad-162">Requests for static content - images, CSS files, JavaScript files, PDF files, ZIP files, and the like - are retrieved by IIS without the involvement of the ASP.NET runtime.</span></span> <span data-ttu-id="a35ad-163">（在提供靜態內容時，可以指示 IIS 使用 ASP.NET 執行時間; 如需詳細資訊，請參閱本教學課程中的「以 IIS 7 執行靜態檔案的表單架構驗證和 URL 驗證」一節。）</span><span class="sxs-lookup"><span data-stu-id="a35ad-163">(It is possible to instruct IIS to work with the ASP.NET runtime when serving static content; consult the "Performing Forms-Based Authentication and URL Authentication on Static Files with IIS 7" section in this tutorial for more information.)</span></span>

<span data-ttu-id="a35ad-164">ASP.NET 執行時間會執行數個步驟來產生要求的內容，包括驗證（識別要求者）和授權（判斷要求者是否有許可權可查看所要求的內容）。</span><span class="sxs-lookup"><span data-stu-id="a35ad-164">The ASP.NET runtime performs a number of steps to generate the requested content, including authentication (identifying the requestor) and authorization (determining if the requestor has permission to view the requested content).</span></span> <span data-ttu-id="a35ad-165">常見的驗證形式是以*表單為基礎的驗證*，使用者可以透過輸入其認證（通常是使用者名稱和密碼）來識別網頁上的文字方塊。</span><span class="sxs-lookup"><span data-stu-id="a35ad-165">A popular form of authentication is *forms-based authentication*, in which a user is identified by entering their credentials - usually a username and password - into textboxes on a web page.</span></span> <span data-ttu-id="a35ad-166">在驗證其認證後，網站會在使用者的瀏覽器上儲存*驗證票證*cookie，並隨著每次後續要求傳送至網站，以及用來驗證使用者。</span><span class="sxs-lookup"><span data-stu-id="a35ad-166">Upon validating their credentials, the website stores an *authentication ticket* cookie on the user's browser, which is sent with every subsequent request to the website and is what is used to authenticate the user.</span></span> <span data-ttu-id="a35ad-167">此外，也可以指定*URL 授權*規則，以指示使用者可以或無法存取特定資料夾的內容。</span><span class="sxs-lookup"><span data-stu-id="a35ad-167">Moreover, it is possible to specify *URL authorization* rules that dictate what users can or cannot access a particular folder.</span></span> <span data-ttu-id="a35ad-168">許多 ASP.NET 網站都使用以表單為基礎的驗證和 URL 授權來支援使用者帳戶，以及定義只能供已驗證的使用者或屬於特定角色之使用者存取的部分網站。</span><span class="sxs-lookup"><span data-stu-id="a35ad-168">Many ASP.NET websites use forms-based authentication and URL authorization to support user accounts and to define portions of the site that are only accessible to authenticated users or users that belong to a certain role.</span></span>

> [!NOTE]
> <span data-ttu-id="a35ad-169">以徹底檢查 ASP。NET 的表單架構驗證、URL 授權和其他與使用者帳戶相關的功能，請務必查看我的[網站安全性教學](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)課程。</span><span class="sxs-lookup"><span data-stu-id="a35ad-169">For a thorough examination of ASP.NET's forms-based authentication, URL authorization, and other user account-related features, be sure to check out my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

<span data-ttu-id="a35ad-170">請考慮使用以表單為基礎的授權來支援使用者帳戶的網站，並將使用 URL 授權的資料夾設定為只允許已驗證的使用者。</span><span class="sxs-lookup"><span data-stu-id="a35ad-170">Consider a website that supports user accounts using forms-based authorization and has a folder that, using URL authorization, is configured to only allow authenticated users.</span></span> <span data-ttu-id="a35ad-171">假設此資料夾包含 ASP.NET 網頁和 PDF 檔案，而其目的是只有經過驗證的使用者才能看到這些 PDF 檔案。</span><span class="sxs-lookup"><span data-stu-id="a35ad-171">Imagine that this folder contains ASP.NET pages and PDF files and that the intent is that only authenticated users can view these PDF files.</span></span>

<span data-ttu-id="a35ad-172">如果造訪者嘗試直接在他的瀏覽器網址列中輸入 URL 來查看其中一個 PDF 檔案，會發生什麼事？</span><span class="sxs-lookup"><span data-stu-id="a35ad-172">What happens if a visitor attempts to view one of these PDF files by entering the URL directly in his browser's Address bar?</span></span> <span data-ttu-id="a35ad-173">若要瞭解，讓我們在書籍審查網站中建立新的資料夾，新增一些 PDF 檔案，並將網站設定為使用 URL 授權，以禁止匿名使用者流覽此資料夾。</span><span class="sxs-lookup"><span data-stu-id="a35ad-173">To find out, let's create a new folder in the Book Reviews site, add some PDF files, and configure the site to use URL authorization to prohibit anonymous users from visiting this folder.</span></span> <span data-ttu-id="a35ad-174">如果您下載示範應用程式，就會看到我建立了一個名為 `PrivateDocs` 的資料夾，並從我的[網站安全性教學](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)課程（如何調整！）新增 PDF。</span><span class="sxs-lookup"><span data-stu-id="a35ad-174">If you download the demo application you'll see that I created a folder called `PrivateDocs` and added a PDF from my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md) (how fitting!).</span></span> <span data-ttu-id="a35ad-175">[`PrivateDocs`] 資料夾也包含 `Web.config` 檔案，該檔案會指定要拒絕匿名使用者的 URL 授權規則：</span><span class="sxs-lookup"><span data-stu-id="a35ad-175">The `PrivateDocs` folder also contains a `Web.config` file that specifies the URL authorization rules to deny anonymous users:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-vb/samples/sample2.xml)]

<span data-ttu-id="a35ad-176">最後，我將 web 應用程式設定為使用以表單為基礎的驗證，方法是更新根目錄中的 web.config 檔案，並取代：</span><span class="sxs-lookup"><span data-stu-id="a35ad-176">Finally, I configured the web application to use forms-based authentication by updating the Web.config file in the root directory, replacing:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-vb/samples/sample3.xml)]

<span data-ttu-id="a35ad-177">取代成：</span><span class="sxs-lookup"><span data-stu-id="a35ad-177">With:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-vb/samples/sample4.xml)]

<span data-ttu-id="a35ad-178">使用 ASP.NET 程式開發伺服器，請造訪網站，並在瀏覽器的網址列中輸入其中一個 PDF 檔案的直接 URL。</span><span class="sxs-lookup"><span data-stu-id="a35ad-178">Using the ASP.NET Development Server, visit the site and enter the direct URL to one of the PDF files in your browser's Address bar.</span></span> <span data-ttu-id="a35ad-179">如果您已下載與本教學課程相關聯的網站，URL 看起來應該像這樣： `http://localhost:portNumber/PrivateDocs/aspnet_tutorial01_Basics_vb.pdf`</span><span class="sxs-lookup"><span data-stu-id="a35ad-179">If you downloaded the website associated with this tutorial the URL should look something like: `http://localhost:portNumber/PrivateDocs/aspnet_tutorial01_Basics_vb.pdf`</span></span>

<span data-ttu-id="a35ad-180">在網址列中輸入此 URL，會導致瀏覽器將要求傳送至檔案的 ASP.NET 程式開發伺服器。</span><span class="sxs-lookup"><span data-stu-id="a35ad-180">Entering this URL into the Address bar causes the browser to send a request to the ASP.NET Development Server for the file.</span></span> <span data-ttu-id="a35ad-181">ASP.NET 程式開發伺服器將要求交給 ASP.NET 執行時間來處理。</span><span class="sxs-lookup"><span data-stu-id="a35ad-181">The ASP.NET Development Server hands off the request to the ASP.NET runtime for processing.</span></span> <span data-ttu-id="a35ad-182">因為我們尚未登入，而且因為 `PrivateDocs` 資料夾中的 `Web.config` 設定為拒絕匿名存取，所以 ASP.NET 執行時間會自動將我們重新導向至登入頁面，`Login.aspx` （請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="a35ad-182">Because we have not yet logged in, and because the `Web.config` in the `PrivateDocs` folder is configured to deny anonymous access, the ASP.NET runtime automatically redirects us to the login page, `Login.aspx` (see Figure 3).</span></span> <span data-ttu-id="a35ad-183">將使用者重新導向至 [登入] 頁面時，ASP.NET 會包含一個 `ReturnUrl` querystring 參數，指出使用者嘗試查看的頁面。</span><span class="sxs-lookup"><span data-stu-id="a35ad-183">When redirecting the user to the log in page, ASP.NET includes a `ReturnUrl` querystring parameter that indicates the page the user was attempting to view.</span></span> <span data-ttu-id="a35ad-184">成功登入之後，使用者可以返回此頁面。</span><span class="sxs-lookup"><span data-stu-id="a35ad-184">After successfully logging in the user can be returned to this page.</span></span>

<span data-ttu-id="a35ad-185">[![未經授權的使用者會自動重新導向至登入頁面](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image8.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a35ad-185">[![Unauthorized Users are Automatically Redirected to the Login Page](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image8.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image7.png)</span></span>

<span data-ttu-id="a35ad-186">**圖 3**：未經授權的使用者會自動重新導向至登[入頁面（按一下以觀看完整大小的影像](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="a35ad-186">**Figure 3**: Unauthorized Users are Automatically Redirected to the Login Page ([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image9.png))</span></span>

<span data-ttu-id="a35ad-187">現在讓我們來看看這在生產環境中的行為。</span><span class="sxs-lookup"><span data-stu-id="a35ad-187">Now let's see how this behaves on production.</span></span> <span data-ttu-id="a35ad-188">部署您的應用程式，並在生產環境中的 [`PrivateDocs`] 資料夾中，輸入其中一個 Pdf 的直接 URL。</span><span class="sxs-lookup"><span data-stu-id="a35ad-188">Deploy your application and enter the direct URL to one of the PDFs in the `PrivateDocs` folder in production.</span></span> <span data-ttu-id="a35ad-189">這會提示您的瀏覽器傳送檔案的要求 IIS。</span><span class="sxs-lookup"><span data-stu-id="a35ad-189">This prompts your browser to send a request IIS for the file.</span></span> <span data-ttu-id="a35ad-190">由於要求的是靜態檔案，因此 IIS 會在不叫用 ASP.NET 執行時間的情況下，抓取並傳回檔案。</span><span class="sxs-lookup"><span data-stu-id="a35ad-190">Because a static file is requested, IIS retrieves and returns the file without invoking the ASP.NET runtime.</span></span> <span data-ttu-id="a35ad-191">因此，不會執行任何 URL 授權檢查;知道檔案的直接 URL 的任何人都可以存取經過的私用 PDF 內容。</span><span class="sxs-lookup"><span data-stu-id="a35ad-191">As a result, there was no URL authorization check performed; the contents of the supposedly private PDF are accessible to anyone who knows the direct URL to the file.</span></span>

<span data-ttu-id="a35ad-192">[![匿名使用者可以藉由輸入檔案的直接 URL 來下載私人 PDF 檔案](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image11.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a35ad-192">[![Anonymous Users Can Download the Private PDF Files By Entering the Direct URL to the File](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image11.png)](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image10.png)</span></span>

<span data-ttu-id="a35ad-193">**圖 4**：匿名使用者可以藉由輸入檔案的直接 URL （[按一下以查看完整大小的影像](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image12.png)）來下載私人 PDF 檔案</span><span class="sxs-lookup"><span data-stu-id="a35ad-193">**Figure 4**: Anonymous Users Can Download the Private PDF Files By Entering the Direct URL to the File ([Click to view full-size image](core-differences-between-iis-and-the-asp-net-development-server-vb/_static/image12.png))</span></span>

### <a name="performing-forms-based-authentication-and-url-authentication-on-static-files-with-iis-7"></a><span data-ttu-id="a35ad-194">在具有 IIS 7 的靜態檔案上執行表單架構驗證和 URL 驗證</span><span class="sxs-lookup"><span data-stu-id="a35ad-194">Performing Forms-Based Authentication and URL Authentication on Static Files with IIS 7</span></span>

<span data-ttu-id="a35ad-195">有幾種方法可用來保護靜態內容免于未經授權的使用者使用。</span><span class="sxs-lookup"><span data-stu-id="a35ad-195">There are a couple of techniques you can use to protect static content from unauthorized users.</span></span> <span data-ttu-id="a35ad-196">IIS 7 引進了*整合式管線*，它會結婚 IIS 的工作流程與 ASP.NET 執行時間的工作流程。</span><span class="sxs-lookup"><span data-stu-id="a35ad-196">IIS 7 introduced the *integrated pipeline*, which marries IIS's workflow with the ASP.NET runtime's workflow.</span></span> <span data-ttu-id="a35ad-197">簡言之，您可以指示 IIS 叫用 ASP.NET 執行時間的驗證和授權模組所有傳入的要求（包括如 PDF 檔案的靜態內容）。</span><span class="sxs-lookup"><span data-stu-id="a35ad-197">In a nutshell, you can instruct IIS to invoke the ASP.NET runtime's authentication and authorization modules all incoming requests (including static content like PDF files).</span></span> <span data-ttu-id="a35ad-198">請洽詢您的 web 主機提供者，瞭解如何設定您的網站以使用整合式管線。</span><span class="sxs-lookup"><span data-stu-id="a35ad-198">Contact your web host provider to find out how to configure your website to use the integrated pipeline.</span></span>

<span data-ttu-id="a35ad-199">一旦將 IIS 設定為使用整合式管線，請將下列標記新增至根目錄中的 `Web.config` 檔案：</span><span class="sxs-lookup"><span data-stu-id="a35ad-199">Once IIS has been configured to use the integrated pipeline add the following markup to the `Web.config` file in the root directory:</span></span>

[!code-xml[Main](core-differences-between-iis-and-the-asp-net-development-server-vb/samples/sample5.xml)]

<span data-ttu-id="a35ad-200">此標記會指示 IIS 7 使用以 ASP.NET 為基礎的驗證和授權模組。</span><span class="sxs-lookup"><span data-stu-id="a35ad-200">This markup instructs IIS 7 to use the ASP.NET-based authentication and authorization modules.</span></span> <span data-ttu-id="a35ad-201">重新部署您的應用程式，然後重新流覽 PDF 檔案。</span><span class="sxs-lookup"><span data-stu-id="a35ad-201">Re-deploy your application and then re-visit the PDF file.</span></span> <span data-ttu-id="a35ad-202">這次 IIS 處理要求時，會讓 ASP.NET 執行時間的驗證和授權邏輯有機會檢查要求。</span><span class="sxs-lookup"><span data-stu-id="a35ad-202">This time when IIS handles the request it gives the ASP.NET runtime's authentication and authorization logic an opportunity to inspect the request.</span></span> <span data-ttu-id="a35ad-203">由於只有經過驗證的使用者才有權查看 `PrivateDocs` 資料夾中的內容，因此會自動將匿名訪客重新導向至登入頁面（請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="a35ad-203">Because only authenticated users are authorized to view the contents in the `PrivateDocs` folder, the anonymous visitor is automatically redirected to the login page (refer back to Figure 3).</span></span>

> [!NOTE]
> <span data-ttu-id="a35ad-204">如果您的 web 主機提供者仍在使用 IIS 6，則您無法使用整合式管線功能。</span><span class="sxs-lookup"><span data-stu-id="a35ad-204">If your web host provider is still using IIS 6 then you cannot use the integrated pipeline feature.</span></span> <span data-ttu-id="a35ad-205">其中一個因應措施是將私用檔放在禁止 HTTP 存取的資料夾中（例如 `App_Data`），然後建立頁面來提供這些檔。</span><span class="sxs-lookup"><span data-stu-id="a35ad-205">One workaround is to put your private documents in a folder that prohibits HTTP access (such as `App_Data`) and then create a page to serve these documents.</span></span> <span data-ttu-id="a35ad-206">此頁面可能會 `GetPDF.aspx`呼叫，而且會透過 querystring 參數傳遞 PDF 的名稱。</span><span class="sxs-lookup"><span data-stu-id="a35ad-206">This page might be called `GetPDF.aspx`, and is passed the name of the PDF through a querystring parameter.</span></span> <span data-ttu-id="a35ad-207">[`GetPDF.aspx`] 頁面會先驗證使用者是否有權查看檔案，如果是的話，則會使用[`Response.WriteFile(filePath)`](https://msdn.microsoft.com/library/system.web.httpresponse.writefile.aspx)方法，將要求的 PDF 檔案內容傳回給要求的用戶端。</span><span class="sxs-lookup"><span data-stu-id="a35ad-207">The `GetPDF.aspx` page would first verify that the user has permission to view the file and, if so, would use the [`Response.WriteFile(filePath)`](https://msdn.microsoft.com/library/system.web.httpresponse.writefile.aspx) method to send the contents of the requested PDF file back to the requesting client.</span></span> <span data-ttu-id="a35ad-208">如果您不想要啟用整合式管線，這項技術也適用于 IIS 7。</span><span class="sxs-lookup"><span data-stu-id="a35ad-208">This technique would also work for IIS 7 if you did not wish to enable the integrated pipeline.</span></span>

## <a name="summary"></a><span data-ttu-id="a35ad-209">總結</span><span class="sxs-lookup"><span data-stu-id="a35ad-209">Summary</span></span>

<span data-ttu-id="a35ad-210">生產環境中的 Web 應用程式是使用 Microsoft 的 IIS web 伺服器軟體所主控。</span><span class="sxs-lookup"><span data-stu-id="a35ad-210">Web applications in a production environment are hosted using Microsoft's IIS web server software.</span></span> <span data-ttu-id="a35ad-211">不過，在開發環境中，應用程式可能會使用 IIS 或 ASP.NET 程式開發伺服器來裝載。</span><span class="sxs-lookup"><span data-stu-id="a35ad-211">In the development environment, however, the application may be hosted using IIS or the ASP.NET Development Server.</span></span> <span data-ttu-id="a35ad-212">在理想的情況下，相同的 web 伺服器軟體應該用於這兩種環境中，因為使用不同的軟體會在混合中新增另一個變數。</span><span class="sxs-lookup"><span data-stu-id="a35ad-212">Ideally, the same web server software should be used in both environments because using different software adds another variable in the mix.</span></span> <span data-ttu-id="a35ad-213">不過，使用 ASP.NET 程式開發伺服器的便利性，讓它在開發環境中成為一項頗具吸引力的選擇。</span><span class="sxs-lookup"><span data-stu-id="a35ad-213">However, the ease of use of the ASP.NET Development Server makes it an attractive choice in the development environment.</span></span> <span data-ttu-id="a35ad-214">好消息是 IIS 與 ASP.NET 程式開發伺服器之間只有幾個基本差異，如果您知道這些差異，您可以採取步驟來確保應用程式的運作和功能相同，而不論環境.</span><span class="sxs-lookup"><span data-stu-id="a35ad-214">The good news is that there are only a few fundamental differences between IIS and the ASP.NET Development Server, and if you are aware of these differences you can take steps to help ensure that the application works and functions the same way regardless of the environment.</span></span>

<span data-ttu-id="a35ad-215">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="a35ad-215">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="a35ad-216">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="a35ad-216">Further Reading</span></span>

<span data-ttu-id="a35ad-217">如需本教學課程中所討論之主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="a35ad-217">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a35ad-218">與 IIS 7.0 的 ASP.NET 整合</span><span class="sxs-lookup"><span data-stu-id="a35ad-218">ASP.NET Integration with IIS 7.0</span></span>](https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/aspnet-integration-with-iis)
- <span data-ttu-id="a35ad-219">[在 IIS 7 上使用 ASP.NET 論壇驗證與所有類型的內容](https://blogs.iis.net/bills/archive/2007/05/19/using-asp-net-forms-authentication-with-all-types-of-content-with-iis7-video.aspx)（影片）</span><span class="sxs-lookup"><span data-stu-id="a35ad-219">[Using ASP.NET Forums Authentication With All Types of Content on IIS 7](https://blogs.iis.net/bills/archive/2007/05/19/using-asp-net-forms-authentication-with-all-types-of-content-with-iis7-video.aspx) (Video)</span></span>
- [<span data-ttu-id="a35ad-220">Visual Web Developer 中的 Web 服務器</span><span class="sxs-lookup"><span data-stu-id="a35ad-220">Web Servers in Visual Web Developer</span></span>](https://msdn.microsoft.com/library/58wxa9w5.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="a35ad-221">[上一頁](common-configuration-differences-between-development-and-production-vb.md)
> [下一頁](deploying-a-database-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a35ad-221">[Previous](common-configuration-differences-between-development-and-production-vb.md)
[Next](deploying-a-database-vb.md)</span></span>
