---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-vb
title: 資料庫開發及部署策略（VB） |Microsoft Docs
author: rick-anderson
description: 第一次部署資料驅動應用程式時，您可以在開發環境中將資料庫複製到生產環境。 B 。
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 07b8905d-78ac-4252-97fb-8675b3fb0bbf
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-vb
msc.type: authoredcontent
ms.openlocfilehash: 1ea4ade32fb05b9e69647ece7d1a4c400fe9fb21
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/28/2019
ms.locfileid: "74616078"
---
# <a name="strategies-for-database-development-and-deployment-vb"></a><span data-ttu-id="2a921-104">資料庫開發及部署策略 (VB)</span><span class="sxs-lookup"><span data-stu-id="2a921-104">Strategies for Database Development and Deployment (VB)</span></span>

<span data-ttu-id="2a921-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2a921-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

[<span data-ttu-id="2a921-106">下載 PDF</span><span class="sxs-lookup"><span data-stu-id="2a921-106">Download PDF</span></span>](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_vb.pdf)

> <span data-ttu-id="2a921-107">第一次部署資料驅動應用程式時，您可以在開發環境中將資料庫複製到生產環境。</span><span class="sxs-lookup"><span data-stu-id="2a921-107">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="2a921-108">但在後續部署中執行密件複製，將會覆寫進入生產資料庫的任何資料。</span><span class="sxs-lookup"><span data-stu-id="2a921-108">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="2a921-109">相反地，部署資料庫牽涉到在最後一次部署到實際執行資料庫之後，套用對開發資料庫所做的變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-109">Instead, deploying a database involves applying the changes made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="2a921-110">本教學課程會檢查這些挑戰，並提供各種策略來協助 chronicling，並套用自上次部署後對資料庫所做的變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-110">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>

## <a name="introduction"></a><span data-ttu-id="2a921-111">簡介</span><span class="sxs-lookup"><span data-stu-id="2a921-111">Introduction</span></span>

<span data-ttu-id="2a921-112">如先前的教學課程所述，部署 ASP.NET 應用程式需要將相關的內容從開發環境複製到生產環境。</span><span class="sxs-lookup"><span data-stu-id="2a921-112">As discussed in previous tutorials, deploying an ASP.NET application entails copying the pertinent content from the development environment to the production environment.</span></span> <span data-ttu-id="2a921-113">部署不是一次性的事件，而是在每次發行新版本的軟體時，或是在識別並解決 bug 或安全性問題時所發生的事情。</span><span class="sxs-lookup"><span data-stu-id="2a921-113">Deployment is not a one-time event, but rather something that happens every time a new version of the software is released or when bugs or security concerns have been identified and addressed.</span></span> <span data-ttu-id="2a921-114">將 ASP.NET 網頁、影像、JavaScript 檔案和其他這類檔案複製到生產環境時，您不需要擔心這些檔案在上次部署後的變更方式。</span><span class="sxs-lookup"><span data-stu-id="2a921-114">When copying ASP.NET pages, images, JavaScript files, and other such files to the production environment you do not need to concern yourself with how these file have been changed since the last deployment.</span></span> <span data-ttu-id="2a921-115">您可以盲目地將檔案複製到生產環境，並覆寫現有的內容。</span><span class="sxs-lookup"><span data-stu-id="2a921-115">You can blindly copy the file to production, overwriting the existing content.</span></span> <span data-ttu-id="2a921-116">可惜的是，這種簡單性並不會延伸到部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="2a921-116">Unfortunately, this simplicity does not extend to deploying the database.</span></span>

<span data-ttu-id="2a921-117">第一次部署資料驅動應用程式時，您可以在開發環境中將資料庫複製到生產環境。</span><span class="sxs-lookup"><span data-stu-id="2a921-117">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="2a921-118">但在後續部署中執行密件複製，將會覆寫進入生產資料庫的任何資料。</span><span class="sxs-lookup"><span data-stu-id="2a921-118">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="2a921-119">相反地，部署資料庫牽涉到在最後一次部署到實際執行資料庫之後，套用對開發資料庫所做的*變更*。</span><span class="sxs-lookup"><span data-stu-id="2a921-119">Instead, deploying a database involves applying the *changes* made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="2a921-120">本教學課程會檢查這些挑戰，並提供各種策略來協助 chronicling，並套用自上次部署後對資料庫所做的變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-120">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>

## <a name="the-challenges-of-deploying-a-database"></a><span data-ttu-id="2a921-121">部署資料庫的挑戰</span><span class="sxs-lookup"><span data-stu-id="2a921-121">The Challenges of Deploying a Database</span></span>

<span data-ttu-id="2a921-122">第一次部署資料驅動應用程式之前，只有一個資料庫（也就是開發環境中的資料庫），這就是為什麼第一次部署資料驅動應用程式時，您可以在生產環境的開發環境。</span><span class="sxs-lookup"><span data-stu-id="2a921-122">Before a data-driven application has been deployed for the first time, there is only one database, namely the database in the development environment, which is why when deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="2a921-123">但是一旦部署應用程式，就會有兩個資料庫複本：一個在開發中，另一個在生產環境中。</span><span class="sxs-lookup"><span data-stu-id="2a921-123">But once the application has been deployed there are two copies of the database: one in development and one in production.</span></span>

<span data-ttu-id="2a921-124">在部署之間，開發和生產資料庫可能會不同步。雖然生產資料庫的架構維持不變，但是在新增新功能時，開發資料庫的架構可能會變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-124">Between deployments the development and production databases can become out of sync. While the production database s schema remains unchanged, the development database s schema may change as new features are added.</span></span> <span data-ttu-id="2a921-125">您可以加入或移除資料行、資料表、views 或預存程式。</span><span class="sxs-lookup"><span data-stu-id="2a921-125">You might add or remove columns, tables, views, or stored procedures.</span></span> <span data-ttu-id="2a921-126">可能也會有重要的資料加入至開發資料庫。</span><span class="sxs-lookup"><span data-stu-id="2a921-126">There may also be important data that gets added to the development database.</span></span> <span data-ttu-id="2a921-127">許多資料驅動型應用程式都包含以硬式編碼、應用程式特定資料（不是使用者可編輯）填入的查閱資料表。</span><span class="sxs-lookup"><span data-stu-id="2a921-127">Many data-driven applications include lookup tables populated with hard-coded, application-specific data that are not user-editable.</span></span> <span data-ttu-id="2a921-128">例如，拍賣網站可能會有一個下拉式清單，其中包含描述所 auctioned 專案之條件的選項： [新增]、[良好] 和 [公平]。</span><span class="sxs-lookup"><span data-stu-id="2a921-128">For example, an auction website might have a drop-down list with choices that describe the condition of the item being auctioned: New, Like New, Good, and Fair.</span></span> <span data-ttu-id="2a921-129">您不需要直接在下拉式清單中對這些選項進行硬式編碼，而是將它們放在資料庫資料表中，通常會比較好。</span><span class="sxs-lookup"><span data-stu-id="2a921-129">Rather than hard-coding these options directly in the drop-down list it is usually better to place them in a database table.</span></span> <span data-ttu-id="2a921-130">如果在開發期間，將名為 [差] 的新條件加入至資料表，則在部署應用程式時，必須將此相同的記錄加入至生產資料庫中的查閱資料表。</span><span class="sxs-lookup"><span data-stu-id="2a921-130">If, during development, a new condition named Poor is added to the table then when deploying the application this same record needs to be added to the lookup table in the production database.</span></span>

<span data-ttu-id="2a921-131">在理想的情況下，部署資料庫會牽涉到將資料庫從開發工作複製到生產環境。</span><span class="sxs-lookup"><span data-stu-id="2a921-131">Ideally, deploying the database would involve copying the database from development to production.</span></span> <span data-ttu-id="2a921-132">但請記住，在您部署應用程式並繼續開發之後，實際執行的資料庫將會填入真實使用者實際的資料。</span><span class="sxs-lookup"><span data-stu-id="2a921-132">But keep in mind that after you have deployed the application and resumed development, the production database is being populated with real data from real users.</span></span> <span data-ttu-id="2a921-133">因此，如果您只是在下一次部署時將資料庫從開發複製到生產環境，您會覆寫生產資料庫並遺失其現有資料。</span><span class="sxs-lookup"><span data-stu-id="2a921-133">Therefore, if you were to simply copy the database from development to production at the next deployment you would overwrite the production database and lose its existing data.</span></span> <span data-ttu-id="2a921-134">最後的結果是，將資料庫部署到下一個部署之後，再套用對開發資料庫所做的變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-134">The net result is that deploying the database boils down to applying the changes made to the development database since the last deployment.</span></span>

<span data-ttu-id="2a921-135">因為部署資料庫牽涉到套用架構中的變更，而且可能是上次部署後的資料，所以必須維護變更的歷程記錄（或在部署階段判斷），以便在生產環境上套用這些變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-135">Because deploying a database involves applying the changes in the schema and, possibly, the data since the last deployment, a history of changes must be maintained (or determined at deploy-time) so that those changes can be applied on production.</span></span> <span data-ttu-id="2a921-136">有各種技術可用於管理和套用資料模型的變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-136">There are a variety of techniques for managing and applying changes to the data model.</span></span>

### <a name="defining-the-baseline"></a><span data-ttu-id="2a921-137">定義基準</span><span class="sxs-lookup"><span data-stu-id="2a921-137">Defining the Baseline</span></span>

<span data-ttu-id="2a921-138">若要維護對應用程式資料庫所做的變更，您需要有一些啟動狀態，也就是套用變更的基準。</span><span class="sxs-lookup"><span data-stu-id="2a921-138">To maintain the changes to your application s database you need to have some starting state, a baseline to which the changes are applied to.</span></span> <span data-ttu-id="2a921-139">在一個極端的情況下，啟動狀態可能是空的資料庫，沒有資料表、views 或預存程式。</span><span class="sxs-lookup"><span data-stu-id="2a921-139">At one extreme the starting state could be an empty database with no tables, views, or stored procedures.</span></span> <span data-ttu-id="2a921-140">這類基準會導致大型變更記錄檔，因為它必須包含建立所有資料庫的資料表、視圖和預存程式，以及在初始部署之後所做的任何變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-140">Such a baseline results in a large change log because it must include the creation of all of the database s tables, views, and stored procedures along with any changes made after the initial deployment.</span></span> <span data-ttu-id="2a921-141">在頻譜的另一端，您可以將基準設定為一開始部署到生產環境的資料庫版本。</span><span class="sxs-lookup"><span data-stu-id="2a921-141">At the other end of the spectrum you could set the baseline as the version of the database that is initially deployed to the production environment.</span></span> <span data-ttu-id="2a921-142">此選擇會產生較小的變更記錄檔，因為它只包含在第一次部署之後對資料庫所做的變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-142">This choice results in a much smaller change log because it only includes the changes made to the database following the first deployment.</span></span> <span data-ttu-id="2a921-143">這是我慣用的方法。</span><span class="sxs-lookup"><span data-stu-id="2a921-143">This is the approach I prefer.</span></span> <span data-ttu-id="2a921-144">當然，您可以選擇更多的道路方法，將基準定義為初始建立資料庫與第一次部署資料庫的時間點。</span><span class="sxs-lookup"><span data-stu-id="2a921-144">And of course you can choose a more middle of the road approach, defining the baseline as some point between the initial creation of the database and when the database is first deployed.</span></span>

<span data-ttu-id="2a921-145">一旦您選擇基準，請考慮產生可執行檔 SQL 腳本，以重新建立基準版本。</span><span class="sxs-lookup"><span data-stu-id="2a921-145">Once you have chosen a baseline consider generating a SQL script that can be executed to recreate the baseline version.</span></span> <span data-ttu-id="2a921-146">這類腳本可以快速地重新建立資料庫的基準版本。</span><span class="sxs-lookup"><span data-stu-id="2a921-146">Such a script makes it possible to quickly recreate the baseline version of the database.</span></span> <span data-ttu-id="2a921-147">這項功能在大型專案中特別有用，其中可能有多個開發人員處理專案或其他環境（例如測試或預備），而每個都需要自己的資料庫複本。</span><span class="sxs-lookup"><span data-stu-id="2a921-147">This functionality is especially useful in larger projects, where there may be multiple developers working on the project or additional environments, such as testing or staging, that each need their own copy of the database.</span></span>

<span data-ttu-id="2a921-148">有各種工具可供您使用，以產生基準版本的 SQL 腳本。</span><span class="sxs-lookup"><span data-stu-id="2a921-148">There are a variety of tools at your disposal to generate a SQL script of the baseline version.</span></span> <span data-ttu-id="2a921-149">在 SQL Server Management Studio （SSMS）中，您可以在資料庫上按一下滑鼠右鍵，移至 [工作] 子功能表，然後選擇 [產生腳本] 選項。</span><span class="sxs-lookup"><span data-stu-id="2a921-149">From SQL Server Management Studio (SSMS) you can right-click on the database, go to the Tasks submenu, and choose the Generate Scripts option.</span></span> <span data-ttu-id="2a921-150">這會啟動腳本嚮導，您可以指示產生一個檔案，其中包含用來建立資料庫物件的 SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="2a921-150">This launches the Script Wizard, which you can instruct to generate a file that contains the SQL commands to create your database s objects.</span></span> <span data-ttu-id="2a921-151">另一個選項是 [資料庫發佈嚮導]，它可以產生 SQL 命令，而不只是建立資料庫架構，也會產生資料庫資料表中的資料。</span><span class="sxs-lookup"><span data-stu-id="2a921-151">Another option is the Database Publishing Wizard, which can generate the SQL commands to not only create the database schema, but also the data in the database tables.</span></span> <span data-ttu-id="2a921-152">資料庫發佈嚮導已在*部署資料庫*教學課程中詳細地回顧。</span><span class="sxs-lookup"><span data-stu-id="2a921-152">The Database Publishing Wizard was examined in detail back in the *Deploying a Database* tutorial.</span></span> <span data-ttu-id="2a921-153">無論您使用哪一種工具，在最後，您應該會有一個腳本檔案，您可以用它來重新建立資料庫的基準版本（如果有需要的話）。</span><span class="sxs-lookup"><span data-stu-id="2a921-153">Regardless of what tool you use, in the end you should have a script file that you can use to recreate the baseline version of your database, should the need arise.</span></span>

## <a name="documenting-the-database-changes-in-prose"></a><span data-ttu-id="2a921-154">記錄 Prose 中的資料庫變更</span><span class="sxs-lookup"><span data-stu-id="2a921-154">Documenting the Database Changes in Prose</span></span>

<span data-ttu-id="2a921-155">在開發階段維護資料模型變更記錄的最簡單方式，就是在 prose 中記錄變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-155">The simplest way to maintain a log of changes to the data model during the development phase is to record the changes in prose.</span></span> <span data-ttu-id="2a921-156">例如，如果在開發已部署的應用程式期間，將新的資料行加入至 `Employees` 資料表、從 `Orders` 資料表中移除資料行，然後加入新的資料表（`ProductCategories`），您將會保留包含下列歷程記錄的文字檔或 Microsoft Word 檔：</span><span class="sxs-lookup"><span data-stu-id="2a921-156">For example, if during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`), you would maintain a text file or Microsoft Word document with the following history:</span></span>

<a id="0.8_table01"></a>

| <span data-ttu-id="2a921-157">**變更日期**</span><span class="sxs-lookup"><span data-stu-id="2a921-157">**Change Date**</span></span> | <span data-ttu-id="2a921-158">**變更詳細資料**</span><span class="sxs-lookup"><span data-stu-id="2a921-158">**Change Details**</span></span> |
| --- | --- |
| <span data-ttu-id="2a921-159">2009-02-03：</span><span class="sxs-lookup"><span data-stu-id="2a921-159">2009-02-03:</span></span> | <span data-ttu-id="2a921-160">已將資料行 `DepartmentID` （`int`，非 Null）新增至 `Employees` 資料表。</span><span class="sxs-lookup"><span data-stu-id="2a921-160">Added column `DepartmentID` (`int`, NOT NULL) to the `Employees` table.</span></span> <span data-ttu-id="2a921-161">已將外鍵條件約束從 `Departments.DepartmentID` 新增至 `Employees.DepartmentID`。</span><span class="sxs-lookup"><span data-stu-id="2a921-161">Added a foreign key constraint from `Departments.DepartmentID` to `Employees.DepartmentID`.</span></span> |
| <span data-ttu-id="2a921-162">2009-02-05：</span><span class="sxs-lookup"><span data-stu-id="2a921-162">2009-02-05:</span></span> | <span data-ttu-id="2a921-163">已從 `Orders` 資料表中移除資料行 `TotalWeight`。</span><span class="sxs-lookup"><span data-stu-id="2a921-163">Removed column `TotalWeight` from the `Orders` table.</span></span> <span data-ttu-id="2a921-164">已在相關聯的 `OrderDetails` 記錄中捕捉到的資料。</span><span class="sxs-lookup"><span data-stu-id="2a921-164">Data already captured in associated `OrderDetails` records.</span></span> |
| <span data-ttu-id="2a921-165">2009-02-12：</span><span class="sxs-lookup"><span data-stu-id="2a921-165">2009-02-12:</span></span> | <span data-ttu-id="2a921-166">建立 `ProductCategories` 資料表。</span><span class="sxs-lookup"><span data-stu-id="2a921-166">Created the `ProductCategories` table.</span></span> <span data-ttu-id="2a921-167">有三個數據行： `ProductCategoryID` （`int`、`IDENTITY`、`NOT NULL`）、`CategoryName` （`nvarchar(50)`、`NOT NULL`）和 `Active` （`bit`，`NOT NULL`）。</span><span class="sxs-lookup"><span data-stu-id="2a921-167">There are three columns: `ProductCategoryID` (`int`, `IDENTITY`, `NOT NULL`), `CategoryName` (`nvarchar(50)`, `NOT NULL`), and `Active` (`bit`, `NOT NULL`).</span></span> <span data-ttu-id="2a921-168">將 primary key 條件約束新增至 `ProductCategoryID`，並將預設值1加入 `Active`。</span><span class="sxs-lookup"><span data-stu-id="2a921-168">Added a primary key constraint to `ProductCategoryID`, and a default value of 1 to `Active`.</span></span> |

<span data-ttu-id="2a921-169">這種方法有一些缺點。</span><span class="sxs-lookup"><span data-stu-id="2a921-169">There are a number of drawbacks to this approach.</span></span> <span data-ttu-id="2a921-170">對於初學者來說，不希望自動化。</span><span class="sxs-lookup"><span data-stu-id="2a921-170">For starters, there is no hope for automation.</span></span> <span data-ttu-id="2a921-171">每當需要將這些變更套用至資料庫時（例如部署應用程式時），開發人員都必須手動執行每一項變更，一次一個。</span><span class="sxs-lookup"><span data-stu-id="2a921-171">Anytime these changes need to be applied to a database - such as when the application is deployed - a developer must manually implement each change, one at a time.</span></span> <span data-ttu-id="2a921-172">此外，如果您需要使用變更記錄檔，從基準重新建立特定版本的資料庫，則在記錄檔大小增加時，這麼做會花費更多時間。</span><span class="sxs-lookup"><span data-stu-id="2a921-172">Moreover, if you need to reconstruct a particular version of the database from the baseline using the change log, doing so will take more and more time as the size of the log grows.</span></span> <span data-ttu-id="2a921-173">此方法的另一個缺點是，每個變更記錄專案的清楚程度和細節層級會留給記錄變更的人員。</span><span class="sxs-lookup"><span data-stu-id="2a921-173">Another drawback to this method is that the clarity and level of detail of each change log entry is left to the person recording the change.</span></span> <span data-ttu-id="2a921-174">在具有多個開發人員的小組中，有些人可能會產生比其他專案更詳細、更容易閱讀或更精確的專案。</span><span class="sxs-lookup"><span data-stu-id="2a921-174">In a team with multiple developers some may make more detailed, more readable, or more precise entries than others.</span></span> <span data-ttu-id="2a921-175">此外，錯誤和其他人為相關的資料輸入錯誤也是可行的。</span><span class="sxs-lookup"><span data-stu-id="2a921-175">Also, typos and other human-related data entry errors are possible.</span></span>

<span data-ttu-id="2a921-176">在 prose 中記錄資料庫變更的主要優點是簡單明瞭。</span><span class="sxs-lookup"><span data-stu-id="2a921-176">The primary benefit of documenting the database changes in prose is simplicity.</span></span> <span data-ttu-id="2a921-177">您不需要熟悉用來建立和改變資料庫物件的 SQL 語法。</span><span class="sxs-lookup"><span data-stu-id="2a921-177">You don t need familiarity with the SQL syntax for creating and altering database objects.</span></span> <span data-ttu-id="2a921-178">相反地，您可以在 prose 中記錄變更，並透過 SQL Server Management Studio 的圖形化使用者介面加以執行。</span><span class="sxs-lookup"><span data-stu-id="2a921-178">Instead, you can record the changes in prose and implement them through SQL Server Management Studio s graphical user interface.</span></span>

<span data-ttu-id="2a921-179">在 prose 中維護您的變更記錄是不可否認的，而且不是非常複雜，也不適用於某些專案，例如範圍很大、經常變更資料模型，或牽涉到多個開發人員的工作。</span><span class="sxs-lookup"><span data-stu-id="2a921-179">Maintaining your change log in prose is, admittedly, not very sophisticated and won't work well with certain projects, such as ones that are large in scope, have frequent changes to the data model, or involve multiple developers.</span></span> <span data-ttu-id="2a921-180">但是我已經看過，這種方法非常適用于只有資料模型偶爾變更的小型、一項專案，而在此情況下，在建立和改變資料庫物件的 SQL 語法中，其中的重要開發人員並沒有強大的背景。</span><span class="sxs-lookup"><span data-stu-id="2a921-180">But I have seen this approach work quite well in small, one-man projects that have only occasional changes to the data model and where the solo developer does not have a strong background in the SQL syntax for creating and altering database objects.</span></span>

> [!NOTE]
> <span data-ttu-id="2a921-181">雖然變更記錄檔中的資訊在技術上只需要到部署時間，但建議您保留變更的歷程記錄。</span><span class="sxs-lookup"><span data-stu-id="2a921-181">While the information in the change log is, technically, only needed until deploy-time, I recommend keeping a history of changes.</span></span> <span data-ttu-id="2a921-182">但是，您應該考慮為每個資料庫版本提供不同的變更記錄檔，而不是維護單一、不斷成長的變更記錄檔。</span><span class="sxs-lookup"><span data-stu-id="2a921-182">But rather than maintaining a single, ever growing change log file, consider having a different change log file for each database version.</span></span> <span data-ttu-id="2a921-183">一般來說，您會想要在每次部署資料庫時進行版本。</span><span class="sxs-lookup"><span data-stu-id="2a921-183">Typically you will want to version the database each time it is deployed.</span></span> <span data-ttu-id="2a921-184">藉由維護變更記錄的記錄，您可以從基準開始，藉由執行從第1版開始的變更記錄腳本來重新建立任何資料庫版本，並繼續進行，直到您到達需要重新建立的版本為止。</span><span class="sxs-lookup"><span data-stu-id="2a921-184">By maintaining a log of change logs you can, starting from the baseline, recreate any database version by executing the change log scripts starting from version 1 and continuing until you reach the version you need to recreate.</span></span>

## <a name="recording-the-sql-change-statements"></a><span data-ttu-id="2a921-185">記錄 SQL 變更語句</span><span class="sxs-lookup"><span data-stu-id="2a921-185">Recording the SQL Change Statements</span></span>

<span data-ttu-id="2a921-186">在 prose 中維護變更記錄的主要缺點是缺乏自動化。</span><span class="sxs-lookup"><span data-stu-id="2a921-186">The primary drawback of maintaining the change log in prose is the lack of automation.</span></span> <span data-ttu-id="2a921-187">理想的情況是，在部署階段對生產資料庫執行資料庫變更，就像按一下按鈕來執行腳本一樣簡單，而不需要手動執行資訊清單。</span><span class="sxs-lookup"><span data-stu-id="2a921-187">Ideally, implementing the database changes to the production database at deploy-time would be as easy as clicking a button to execute a script rather than having to manually perform a list of instructions.</span></span> <span data-ttu-id="2a921-188">藉由維護變更記錄檔，其中包含用來改變資料模型的 SQL 命令，就可以進行這類自動化。</span><span class="sxs-lookup"><span data-stu-id="2a921-188">Such automation is possible by maintaining a change log that contains those SQL commands used to alter the data model.</span></span>

<span data-ttu-id="2a921-189">SQL 語法包含許多用來建立和修改各種資料庫物件的語句。</span><span class="sxs-lookup"><span data-stu-id="2a921-189">The SQL syntax includes a number of statements for creating and modifying various database objects.</span></span> <span data-ttu-id="2a921-190">例如，當[*CREATE TABLE 語句*](https://msdn.microsoft.com/library/ms174979.aspx)執行時，會使用指定的資料行和條件約束來建立新的資料表。</span><span class="sxs-lookup"><span data-stu-id="2a921-190">For example, the [*CREATE TABLE statement*](https://msdn.microsoft.com/library/ms174979.aspx), when executed, creates a new table with the specified columns and constraints.</span></span> <span data-ttu-id="2a921-191">[*ALTER table 語句*](https://msdn.microsoft.com/library/ms190273.aspx)會修改現有的資料表、加入、移除或修改其資料行或條件約束。</span><span class="sxs-lookup"><span data-stu-id="2a921-191">The [*ALTER TABLE statement*](https://msdn.microsoft.com/library/ms190273.aspx) modifies an existing table, adding, removing, or modifying its columns or constraints.</span></span> <span data-ttu-id="2a921-192">另外還有一些語句可建立、修改和卸載索引、視圖、使用者定義函數、預存程式、觸發程式和其他資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="2a921-192">There are also statements to create, modify, and drop indexes, views, user-defined functions, stored procedures, triggers, and other database objects.</span></span>

<span data-ttu-id="2a921-193">回到先前的範例，在開發已部署的應用程式期間，您會將新的資料行加入 `Employees` 資料表、從 `Orders` 資料表中移除資料行，然後加入新的資料表（`ProductCategories`）。</span><span class="sxs-lookup"><span data-stu-id="2a921-193">Returning to our earlier example, image that during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`).</span></span> <span data-ttu-id="2a921-194">這類動作會產生含有下列 SQL 命令的變更記錄檔：</span><span class="sxs-lookup"><span data-stu-id="2a921-194">Such actions would result in a change log file with the following SQL commands:</span></span>

[!code-sql[Main](strategies-for-database-development-and-deployment-vb/samples/sample1.sql)]

<span data-ttu-id="2a921-195">在部署階段將這些變更推送至生產資料庫是單鍵作業：開啟 SQL Server Management Studio、連接到您的實際執行資料庫、開啟新的查詢視窗、貼上變更記錄檔的內容，然後按一下 [執行] 來執行腳本。</span><span class="sxs-lookup"><span data-stu-id="2a921-195">Pushing these changes to the production database at deploy-time is a one-click operation: open SQL Server Management Studio, connect to your production database, open a New Query window, paste the contents of the change log, and click Execute to run the script.</span></span>

## <a name="using-a-comparison-tool-to-synchronize-the-data-models"></a><span data-ttu-id="2a921-196">使用比較工具來同步處理資料模型</span><span class="sxs-lookup"><span data-stu-id="2a921-196">Using a Comparison Tool to Synchronize the Data Models</span></span>

<span data-ttu-id="2a921-197">記錄 prose 中的資料庫變更很簡單，但執行變更時，開發人員必須一次對生產資料庫進行一項變更;記錄變更 SQL 命令，可讓您在生產資料庫上執行這些變更，就像按一下按鈕一樣簡單又快速，但需要學習並掌握 SQL 語句和語法來建立和改變資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="2a921-197">Documenting database changes in prose is easy, but implementing the changes requires a developer to make each change on the production database one at a time; documenting the change SQL commands makes implementing those changes on the production database as easy and quick as clicking a button, but requires learning and mastering the SQL statements and syntax for creating and altering database objects.</span></span> <span data-ttu-id="2a921-198">資料庫比較工具充分發揮這兩種方法，並捨棄最差。</span><span class="sxs-lookup"><span data-stu-id="2a921-198">Database comparison tools take the best from both approaches and discard the worst.</span></span>

<span data-ttu-id="2a921-199">資料庫比較工具會比較兩個資料庫的架構或資料，並顯示摘要報告，顯示資料庫有何差異。</span><span class="sxs-lookup"><span data-stu-id="2a921-199">A database comparison tool compares the schema or data of two databases and displays a summary report showing you how the databases differ.</span></span> <span data-ttu-id="2a921-200">然後，只要按一下按鈕，您就可以產生 SQL 命令來同步處理一個或多個資料庫物件。</span><span class="sxs-lookup"><span data-stu-id="2a921-200">Then, with the click of a button, you can generate the SQL commands for synchronizing one or more database objects.</span></span> <span data-ttu-id="2a921-201">簡言之，您可以在部署時使用資料庫比較工具來比較開發和生產資料庫，產生一個包含 SQL 命令的檔案，當執行時，它會將變更套用至生產資料庫的架構，讓它能夠鏡像開發資料庫的架構。</span><span class="sxs-lookup"><span data-stu-id="2a921-201">In a nutshell, you can use a database comparison tool to compare the development and production databases at deploy-time, generating a file that contains the SQL commands that, when executed, will apply the changes to the production database s schema so that it mirrors the development database s schema.</span></span>

<span data-ttu-id="2a921-202">許多不同的廠商都提供各種協力廠商資料庫比較工具。</span><span class="sxs-lookup"><span data-stu-id="2a921-202">There are a variety of third-party database comparison tools offered by many different vendors.</span></span> <span data-ttu-id="2a921-203">其中一個範例是[*SQL 比較*](http://www.red-gate.com/products/SQL_Compare/)，[*紅色閘道軟體*](http://www.red-gate.com/)。</span><span class="sxs-lookup"><span data-stu-id="2a921-203">One such example is [*SQL Compare*](http://www.red-gate.com/products/SQL_Compare/), by [*Red Gate Software*](http://www.red-gate.com/).</span></span> <span data-ttu-id="2a921-204">讓我們逐步解說使用 SQL 比較來比較和同步處理開發和生產資料庫架構的程式。</span><span class="sxs-lookup"><span data-stu-id="2a921-204">Let s walk through the process of using SQL Compare to compare and synchronize the development and production databases schemas.</span></span>

> [!NOTE]
> <span data-ttu-id="2a921-205">在撰寫本文時，SQL 比較的目前版本是7.1 版，標準版的成本為 $395。</span><span class="sxs-lookup"><span data-stu-id="2a921-205">At the time of this writing the current version of SQL Compare was version 7.1, with the Standard Edition costing $395.</span></span> <span data-ttu-id="2a921-206">您可以透過下載免費的14天試用版來追蹤。</span><span class="sxs-lookup"><span data-stu-id="2a921-206">You can follow along by downloading a free 14-day trial.</span></span>

<span data-ttu-id="2a921-207">當 SQL 比較開始時，會開啟 [比較專案] 對話方塊，顯示已儲存的 SQL 比較專案。</span><span class="sxs-lookup"><span data-stu-id="2a921-207">When SQL Compare starts the Comparison Projects dialog box opens, showing the saved SQL Compare projects.</span></span> <span data-ttu-id="2a921-208">建立新的專案。</span><span class="sxs-lookup"><span data-stu-id="2a921-208">Create a new project.</span></span> <span data-ttu-id="2a921-209">這會啟動 [專案設定] wizard，提示您提供要比較之資料庫的相關資訊（請參閱 [圖 1]）。</span><span class="sxs-lookup"><span data-stu-id="2a921-209">This launches the Project Configuration wizard, which prompts for information about the databases to compare (see Figure 1).</span></span> <span data-ttu-id="2a921-210">輸入開發和生產環境資料庫的資訊。</span><span class="sxs-lookup"><span data-stu-id="2a921-210">Enter the information for the development and production environment databases.</span></span>

<span data-ttu-id="2a921-211">[![比較開發與生產資料庫](strategies-for-database-development-and-deployment-vb/_static/image2.jpg)](strategies-for-database-development-and-deployment-vb/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="2a921-211">[![Compare the Development and Production Databases](strategies-for-database-development-and-deployment-vb/_static/image2.jpg)](strategies-for-database-development-and-deployment-vb/_static/image1.jpg)</span></span>

<span data-ttu-id="2a921-212">**圖 1**：比較開發和生產資料庫（[按一下以觀看完整大小的影像](strategies-for-database-development-and-deployment-vb/_static/image3.jpg)）</span><span class="sxs-lookup"><span data-stu-id="2a921-212">**Figure 1**: Compare the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-vb/_static/image3.jpg))</span></span>

> [!NOTE]
> <span data-ttu-id="2a921-213">如果您的開發環境資料庫是網站 [`App_Data`] 資料夾中的 SQL Express Edition 資料庫檔案，您將需要在 SQL Server Express 資料庫伺服器中註冊資料庫，才能從 [圖 1] 所示的對話方塊中選取它。</span><span class="sxs-lookup"><span data-stu-id="2a921-213">If your development environment database is a SQL Express Edition database file in the `App_Data` folder of your website you will need to register the database in the SQL Server Express database server in order to select it from the dialog box shown in Figure 1.</span></span> <span data-ttu-id="2a921-214">完成此動作的最簡單方式是開啟 SQL Server Management Studio （SSMS）、連接到 SQL Server Express 資料庫伺服器，然後附加資料庫。</span><span class="sxs-lookup"><span data-stu-id="2a921-214">The easiest way to accomplish this is to open SQL Server Management Studio (SSMS), connect to the SQL Server Express database server, and attach the database.</span></span> <span data-ttu-id="2a921-215">如果您的電腦上未安裝 SSMS，您可以下載並安裝免費的[*SQL Server 2008 Management Studio Basic 版本*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en)。</span><span class="sxs-lookup"><span data-stu-id="2a921-215">If you do not have SSMS installed on your computer you can download and install the free [*SQL Server 2008 Management Studio Basic version*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en).</span></span>

<span data-ttu-id="2a921-216">除了選取要比較的資料庫之外，您也可以從 [選項] 索引標籤指定各種比較設定。您可能要開啟的一個選項是「忽略條件約束和索引名稱」。</span><span class="sxs-lookup"><span data-stu-id="2a921-216">In addition to selecting the databases to compare, you can also specify a variety of comparison settings from the Options tab. One option you may want to turn on is the "Ignore constraint and index names."</span></span> <span data-ttu-id="2a921-217">回想一下，在上一個教學課程中，我們將應用程式服務資料庫物件新增到開發和生產資料庫中。</span><span class="sxs-lookup"><span data-stu-id="2a921-217">Recall that in the preceding tutorial we added the application services database objects to the development and production databases.</span></span> <span data-ttu-id="2a921-218">如果您使用 `aspnet_regsql.exe` 工具在生產資料庫上建立這些物件，則您會發現主要索引鍵和唯一條件約束名稱在開發與生產資料庫之間有所不同。</span><span class="sxs-lookup"><span data-stu-id="2a921-218">If you used the `aspnet_regsql.exe` tool to create these objects on the production database then you will find that the primary key and unique constraint names differ between the development and production databases.</span></span> <span data-ttu-id="2a921-219">因此，SQL 比較會將所有應用程式服務資料表標示為不同。</span><span class="sxs-lookup"><span data-stu-id="2a921-219">Consequently, SQL Compare will flag all of the application services tables as differing.</span></span> <span data-ttu-id="2a921-220">您可以取消核取 [忽略條件約束和索引名稱] 並同步處理條件約束名稱，或指示 SQL 比較來忽略這些差異。</span><span class="sxs-lookup"><span data-stu-id="2a921-220">You can either leave the "Ignore constraint and index names" unchecked and synchronize the constraint names, or instruct SQL Compare to ignore these differences.</span></span>

<span data-ttu-id="2a921-221">選取要比較的資料庫（並查看比較選項）之後，請按一下 [立即比較] 按鈕，開始進行比較。</span><span class="sxs-lookup"><span data-stu-id="2a921-221">After selecting the databases to compare (and reviewing the comparison options), click the Compare Now button to begin the comparison.</span></span> <span data-ttu-id="2a921-222">在接下來的幾秒內，SQL 比較會檢查這兩個資料庫的架構，並產生其差異的報告。</span><span class="sxs-lookup"><span data-stu-id="2a921-222">Over the next several seconds, SQL Compare examines the schemas of the two databases and generates a report of how they differ.</span></span> <span data-ttu-id="2a921-223">我特意對開發資料庫做了一些修改，以顯示 SQL 比較介面中記錄這類差異的方式。</span><span class="sxs-lookup"><span data-stu-id="2a921-223">I ve purposefully made some modifications to the development database to show how such discrepancies are noted in the SQL Compare interface.</span></span> <span data-ttu-id="2a921-224">如 [圖 2] 所示，我在 `Authors` 資料表中加入了 `BirthDate` 資料行，從 `Books` 資料表中移除 `ISBN` 的資料行，並加入了新的資料表 `Ratings`，這是為了讓使用者造訪網站速率審查的書籍。</span><span class="sxs-lookup"><span data-stu-id="2a921-224">As Figure 2 shows, I ve added a `BirthDate` column to the `Authors` table, removed the `ISBN` column from the `Books` table, and added a new table, `Ratings`, which is meant to let users visiting the site rate the reviewed books.</span></span>

> [!NOTE]
> <span data-ttu-id="2a921-225">本教學課程中所做的資料模型變更已完成，以說明如何使用資料庫比較工具。</span><span class="sxs-lookup"><span data-stu-id="2a921-225">The data model changes made in this tutorial were done to illustrate using a database comparison tool.</span></span> <span data-ttu-id="2a921-226">在未來的教學課程中，您將不會在資料庫中找到這些變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-226">You will not find these changes in the database in future tutorials.</span></span>

<span data-ttu-id="2a921-227">[![SQL 比較列出開發與生產資料庫之間的差異](strategies-for-database-development-and-deployment-vb/_static/image5.jpg)](strategies-for-database-development-and-deployment-vb/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="2a921-227">[![SQL Compare Lists the Differences Between the Development and Production Databases](strategies-for-database-development-and-deployment-vb/_static/image5.jpg)](strategies-for-database-development-and-deployment-vb/_static/image4.jpg)</span></span>

<span data-ttu-id="2a921-228">**圖 2**： SQL 比較列出開發與生產資料庫之間的差異（[按一下以觀看完整大小的影像](strategies-for-database-development-and-deployment-vb/_static/image6.jpg)）</span><span class="sxs-lookup"><span data-stu-id="2a921-228">**Figure 2**: SQL Compare Lists the Differences Between the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-vb/_static/image6.jpg))</span></span>

<span data-ttu-id="2a921-229">SQL 比較會將資料庫物件分解成群組，快速顯示兩個資料庫中有哪些物件存在但不同，哪些物件存在於一個資料庫中，而另一個則是相同的物件。</span><span class="sxs-lookup"><span data-stu-id="2a921-229">SQL Compare breaks down the database objects into groups, quickly showing you what objects exist in both databases but are different, which objects exist in one database but not the other, and which objects are identical.</span></span> <span data-ttu-id="2a921-230">如您所見，這兩個資料庫中有兩個物件存在，但不同： `Authors` 資料表（已加入資料行），以及 `Books` 資料表（已移除一個）。</span><span class="sxs-lookup"><span data-stu-id="2a921-230">As you can see, there are two objects that exist in both databases but are different: the `Authors` table, which had a column added, and the `Books` table, which had one removed.</span></span> <span data-ttu-id="2a921-231">有一個物件只存在於開發資料庫中，也就是新建立的 `Ratings` 資料表。</span><span class="sxs-lookup"><span data-stu-id="2a921-231">There is one object that exists only in the development database, namely the newly created `Ratings` table.</span></span> <span data-ttu-id="2a921-232">而且兩個資料庫中都有117個相同的物件。</span><span class="sxs-lookup"><span data-stu-id="2a921-232">And there are 117 objects that are identical in both databases.</span></span>

<span data-ttu-id="2a921-233">選取資料庫物件會顯示 [SQL 差異] 視窗，其中會顯示這些物件的差異。</span><span class="sxs-lookup"><span data-stu-id="2a921-233">Selecting a database object displays the SQL Differences window, which shows how these objects differ.</span></span> <span data-ttu-id="2a921-234">[圖 2] 底部顯示的 [SQL 差異] 視窗，強調了開發資料庫中的 `Authors` 資料表具有 [`BirthDate`] 資料行，但在生產資料庫的 [`Authors`] 資料表中找不到。</span><span class="sxs-lookup"><span data-stu-id="2a921-234">The SQL Differences window, displayed at the bottom in Figure 2, highlights that the `Authors` table in the development database has the `BirthDate` column, which is not found in the `Authors` table on the production database.</span></span>

<span data-ttu-id="2a921-235">在檢查差異並選取您想要同步處理的物件之後，下一步就是產生更新生產資料庫的架構所需的 SQL 命令，使其符合開發資料庫。</span><span class="sxs-lookup"><span data-stu-id="2a921-235">After reviewing the differences and selecting which objects you want to synchronize, the next step is to generate the SQL commands needed to update the production database s schema to match the development database.</span></span> <span data-ttu-id="2a921-236">這是透過 [同步處理嚮導] 來完成。</span><span class="sxs-lookup"><span data-stu-id="2a921-236">This is accomplished through the Synchronization Wizard.</span></span> <span data-ttu-id="2a921-237">同步處理嚮導會確認要同步處理哪些物件，並摘要說明動作計畫（請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="2a921-237">The Synchronization Wizard confirms what objects to synchronize and summarizes the action plan (see Figure 3).</span></span> <span data-ttu-id="2a921-238">您可以立即同步處理資料庫，或使用可在您休閒中執行的 SQL 命令來產生腳本。</span><span class="sxs-lookup"><span data-stu-id="2a921-238">You can synchronize the databases immediately or generate a script with the SQL commands that can be run at your leisure.</span></span>

<span data-ttu-id="2a921-239">[![使用同步處理嚮導來同步處理您的資料庫架構](strategies-for-database-development-and-deployment-vb/_static/image8.jpg)](strategies-for-database-development-and-deployment-vb/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="2a921-239">[![Use the Synchronization Wizard to Synchronize Your Databases Schemas](strategies-for-database-development-and-deployment-vb/_static/image8.jpg)](strategies-for-database-development-and-deployment-vb/_static/image7.jpg)</span></span>

<span data-ttu-id="2a921-240">**圖 3**：使用 [同步處理嚮導] 同步處理您的資料庫架構（[按一下以查看完整大小的影像](strategies-for-database-development-and-deployment-vb/_static/image9.jpg)）</span><span class="sxs-lookup"><span data-stu-id="2a921-240">**Figure 3**: Use the Synchronization Wizard to Synchronize Your Databases Schemas ([Click to view full-size image](strategies-for-database-development-and-deployment-vb/_static/image9.jpg))</span></span>

<span data-ttu-id="2a921-241">像是 Red 閘道軟體的資料庫比較工具 SQL 比較，會將對開發資料庫架構的變更套用至實際執行資料庫，如同 point，然後按一下。</span><span class="sxs-lookup"><span data-stu-id="2a921-241">Database comparison tools like Red Gate Software s SQL Compare make applying the changes to the development database schema to the production database as easy as point and click.</span></span>

> [!NOTE]
> <span data-ttu-id="2a921-242">SQL 比較會比較和同步處理兩個資料庫*架構*。</span><span class="sxs-lookup"><span data-stu-id="2a921-242">SQL Compare compares and synchronizes two databases *schemas*.</span></span> <span data-ttu-id="2a921-243">可惜的是，它不會比較和同步處理兩個資料庫資料表中的資料。</span><span class="sxs-lookup"><span data-stu-id="2a921-243">Unfortunately, it does not compare and synchronize the data within two databases tables.</span></span> <span data-ttu-id="2a921-244">Red 閘道軟體提供名為[*SQL Data Compare*](http://www.red-gate.com/products/SQL_Data_Compare/)的產品，它會比較和同步處理兩個資料庫之間的資料，但它是 sql 比較的個別產品，而成本另一個 $395。</span><span class="sxs-lookup"><span data-stu-id="2a921-244">Red Gate Software does offer a product named [*SQL Data Compare*](http://www.red-gate.com/products/SQL_Data_Compare/) that compares and synchronizes the data between two databases, but it is a separate product from SQL Compare and costs another $395.</span></span>

## <a name="taking-the-application-offline-during-deployment"></a><span data-ttu-id="2a921-245">在部署期間讓應用程式離線</span><span class="sxs-lookup"><span data-stu-id="2a921-245">Taking the Application Offline During Deployment</span></span>

<span data-ttu-id="2a921-246">如我們在這些教學課程中所見，部署是包含多個步驟的程式：將 ASP.NET 網頁、主版頁面、CSS 檔案、JavaScript 檔案、影像和其他必要內容從開發環境複製到生產環境環境視需要複製生產環境特定的設定資訊;並在上次部署後將變更套用至資料模型。</span><span class="sxs-lookup"><span data-stu-id="2a921-246">As we ve seen throughout these tutorials, deployment is a process that involves multiple steps: copying the ASP.NET pages, master pages, CSS files, JavaScript files, images, and other necessary content from the development environment to the production environment; copying up the production environment-specific configuration information, if needed; and applying the changes to the data model since the last deployment.</span></span> <span data-ttu-id="2a921-247">視檔案數目和資料庫的複雜度而定，這些步驟可能需要數秒到數分鐘的時間才能完成。</span><span class="sxs-lookup"><span data-stu-id="2a921-247">Depending on the number of files and the complexity of your database changes, these steps can take anywhere from a few seconds to several minutes to complete.</span></span> <span data-ttu-id="2a921-248">在此期間，web 應用程式會在 flux 中，而造訪網站的使用者可能會遇到錯誤或非預期的行為。</span><span class="sxs-lookup"><span data-stu-id="2a921-248">During this window the web application is in flux and users visiting the site may experience errors or unexpected behavior.</span></span>

<span data-ttu-id="2a921-249">部署網站時，最好讓 web 應用程式「離線」，直到部署完成為止。</span><span class="sxs-lookup"><span data-stu-id="2a921-249">When deploying a website it is best to take the web application "offline" until deployment has completed.</span></span> <span data-ttu-id="2a921-250">讓應用程式離線（並在部署程式完成後使其恢復運作）就像上傳檔案，然後刪除它一樣簡單。</span><span class="sxs-lookup"><span data-stu-id="2a921-250">Taking the application offline (and bringing it back up once the deployment process has finished) is as easy as uploading a file and then deleting it.</span></span> <span data-ttu-id="2a921-251">從 ASP.NET 2.0 開始，在應用程式的根目錄中，只有名為 `app_offline.htm` 的檔案才會讓整個網站「離線」。</span><span class="sxs-lookup"><span data-stu-id="2a921-251">Starting with ASP.NET 2.0, the mere presence of a file named `app_offline.htm` in the application s root directory takes the entire website "offline."</span></span> <span data-ttu-id="2a921-252">該網站上 ASP.NET 網頁的任何要求都會自動回應 `app_offline.htm` 檔案的內容。</span><span class="sxs-lookup"><span data-stu-id="2a921-252">Any request to an ASP.NET page on that site is automatically responded with the contents of the `app_offline.htm` file.</span></span> <span data-ttu-id="2a921-253">一旦移除該檔案之後，應用程式就會重新上線。</span><span class="sxs-lookup"><span data-stu-id="2a921-253">Once that file is removed, the application comes back online.</span></span>

<span data-ttu-id="2a921-254">在部署期間讓應用程式離線，就像在開始部署程式之前，將 `app_offline.htm` 檔案上傳到生產環境的根目錄一樣簡單，然後在部署完成後將它刪除（或重新命名為其他專案）。</span><span class="sxs-lookup"><span data-stu-id="2a921-254">Taking an application offline during deployment, then, is as simple as uploading an `app_offline.htm` file to the production environment s root directory prior to beginning the deployment process and then deleting it (or renaming it to something else) once deployment is complete.</span></span> <span data-ttu-id="2a921-255">如需這項技術的詳細資訊，請參閱 John Peterson 文章，讓[*ASP.NET 應用程式離線*](http://www.15seconds.com/issue/061207.htm)。</span><span class="sxs-lookup"><span data-stu-id="2a921-255">For more information on this technique refer to John Peterson s article, Taking an [*ASP.NET Application Offline*](http://www.15seconds.com/issue/061207.htm).</span></span>

## <a name="summary"></a><span data-ttu-id="2a921-256">總結</span><span class="sxs-lookup"><span data-stu-id="2a921-256">Summary</span></span>

<span data-ttu-id="2a921-257">部署以資料為導向的應用程式中心時，主要的挑戰在於部署資料庫。</span><span class="sxs-lookup"><span data-stu-id="2a921-257">The main challenge in deploying a data-driven application centers around deploying the database.</span></span> <span data-ttu-id="2a921-258">由於資料庫有兩個版本：一個在開發環境中，另一個在生產環境中，這兩個資料庫架構可能會因為開發中新增的新功能而無法同步。</span><span class="sxs-lookup"><span data-stu-id="2a921-258">Because there are two versions of the database - one in the development environment and one in the production environment - these two databases schemas can become out of sync as new features are added in development.</span></span> <span data-ttu-id="2a921-259">更多的是，因為生產資料庫是以實際使用者的實際資料填入，所以您無法以修改過的開發資料庫來覆寫生產資料庫，如同部署組成應用程式的檔案（ASP.NET 網頁，影像檔等）。</span><span class="sxs-lookup"><span data-stu-id="2a921-259">What s more, because the production database as being populated with real data from real users, you cannot overwrite the production database with the modified development database like you can when deploying the files that make up the application (the ASP.NET pages, image files, and so forth).</span></span> <span data-ttu-id="2a921-260">相反地，部署資料庫需要在上一次部署之後，針對生產資料庫上的開發資料庫執行一組精確的變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-260">Instead, deploying a database entails implementing the precise set of changes made to the development database on the production database since the last deployment.</span></span>

<span data-ttu-id="2a921-261">本教學課程探討了用來維護和套用資料庫變更記錄檔的三種技術。</span><span class="sxs-lookup"><span data-stu-id="2a921-261">This tutorial looked at three techniques for maintaining and applying a log of database changes.</span></span> <span data-ttu-id="2a921-262">最簡單的方法是在 prose 中記錄變更。</span><span class="sxs-lookup"><span data-stu-id="2a921-262">The simplest approach is to record the changes in prose.</span></span> <span data-ttu-id="2a921-263">雖然這個策略會在生產資料庫上進行這些變更，以進行手動程式，但它不需要知道用來建立和改變資料庫物件的 SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="2a921-263">While this tactic makes implementing these changes on the production database a manual process, it does not require knowledge of the SQL commands for creating and altering database objects.</span></span> <span data-ttu-id="2a921-264">更複雜的方法，以及在具有多位開發人員的大型專案或專案中更可行的方式，是將變更記錄為一系列的 SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="2a921-264">A more sophisticated approach, and one that is much more palatable in larger projects or projects with multiple developers, is to record the changes as a series of SQL commands.</span></span> <span data-ttu-id="2a921-265">這會大幅 hastens 將這些變更推出至目標資料庫。</span><span class="sxs-lookup"><span data-stu-id="2a921-265">This greatly hastens rolling out these changes to the target database.</span></span> <span data-ttu-id="2a921-266">這兩種方法的最佳作法，都可以使用資料庫比較工具來達成，例如 Red 閘道 Software s SQL 比較。</span><span class="sxs-lookup"><span data-stu-id="2a921-266">The best of both approaches can be achieved by using a database comparison tool, such as Red Gate Software s SQL Compare.</span></span>

<span data-ttu-id="2a921-267">本教學課程的重點在於如何部署資料驅動應用程式。</span><span class="sxs-lookup"><span data-stu-id="2a921-267">This tutorial concludes our focus on deploying a data-driven application.</span></span> <span data-ttu-id="2a921-268">下一組教學課程會探討如何回應生產環境中的錯誤。</span><span class="sxs-lookup"><span data-stu-id="2a921-268">The next set of tutorials looks at how to respond to errors in the production environment.</span></span> <span data-ttu-id="2a921-269">我們將探討如何顯示易記的錯誤頁面，而不是螢幕上的黃色畫面。</span><span class="sxs-lookup"><span data-stu-id="2a921-269">We'll look at how to display a friendly error page rather instead of the Yellow Screen of Death.</span></span> <span data-ttu-id="2a921-270">我們會瞭解如何記錄錯誤的詳細資料，以及如何在這類錯誤發生時發出警示。</span><span class="sxs-lookup"><span data-stu-id="2a921-270">And we'll see how to log the error s details and how to alert you when such errors occur.</span></span>

<span data-ttu-id="2a921-271">快樂的程式設計！</span><span class="sxs-lookup"><span data-stu-id="2a921-271">Happy Programming!</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2a921-272">[上一頁](configuring-a-website-that-uses-application-services-vb.md)
> [下一頁](displaying-a-custom-error-page-vb.md)</span><span class="sxs-lookup"><span data-stu-id="2a921-272">[Previous](configuring-a-website-that-uses-application-services-vb.md)
[Next](displaying-a-custom-error-page-vb.md)</span></span>
