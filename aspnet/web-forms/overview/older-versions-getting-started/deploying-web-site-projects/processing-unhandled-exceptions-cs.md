---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
title: 處理未處理的例外狀況 (C#) |Microsoft Docs
author: rick-anderson
description: 在生產環境中的 web 應用程式就會發生執行階段錯誤時，重要通知開發人員，並記錄錯誤，因此，它可能會在當下診斷出的 la...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 5bc1afd5-2484-4528-b158-ab218ba150e8
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 2940c17e8466eae1e72d3f7cbc6ff7127c8588b7
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/17/2019
ms.locfileid: "59415852"
---
# <a name="processing-unhandled-exceptions-c"></a><span data-ttu-id="72bcc-103">處理未處理的例外狀況 (C#)</span><span class="sxs-lookup"><span data-stu-id="72bcc-103">Processing Unhandled Exceptions (C#)</span></span>

<span data-ttu-id="72bcc-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="72bcc-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="72bcc-105">[檢視或下載範例程式碼](https://github.com/aspnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) \(英文\) ([如何下載](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="72bcc-105">[View or download sample code](https://github.com/aspnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="72bcc-106">在生產環境中的 web 應用程式的執行階段錯誤發生時很重要通知開發人員，並記錄錯誤，如此可能會在稍後的時間點中診斷的時間。</span><span class="sxs-lookup"><span data-stu-id="72bcc-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="72bcc-107">本教學課程提供如何 ASP.NET 處理執行階段錯誤，以及查看有自訂程式碼執行時的未處理的例外狀況反昇至 ASP.NET 執行階段的一種方法的概觀。</span><span class="sxs-lookup"><span data-stu-id="72bcc-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="72bcc-108">簡介</span><span class="sxs-lookup"><span data-stu-id="72bcc-108">Introduction</span></span>

<span data-ttu-id="72bcc-109">在 ASP.NET 應用程式中處理的例外狀況時，它會顯示 ASP.NET 執行階段，這會引發到`Error`事件，並顯示適當的錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="72bcc-110">有三種不同的錯誤頁面： 執行階段錯誤黃色螢幕的死亡 (YSOD);例外狀況詳細資料 YSOD;和自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="72bcc-111">在 [前述教學課程](displaying-a-custom-error-page-cs.md)我們設定要用於遠端使用者和例外狀況詳細資料 YSOD，瀏覽本機的使用者自訂錯誤網頁的應用程式。</span><span class="sxs-lookup"><span data-stu-id="72bcc-111">In the [preceding tutorial](displaying-a-custom-error-page-cs.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="72bcc-112">使用符合網站的外觀與風格的人類易自訂錯誤頁面是慣用的預設執行階段錯誤 YSOD，但顯示自訂錯誤頁面是完整的錯誤處理方案的冰山一角。</span><span class="sxs-lookup"><span data-stu-id="72bcc-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="72bcc-113">在生產環境中的應用程式中發生錯誤時，很重要，開發人員會收到通知的錯誤使他們可以發現例外狀況的原因和解決。</span><span class="sxs-lookup"><span data-stu-id="72bcc-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="72bcc-114">此外，以便可以檢查錯誤，並在稍後時間在當下診斷出應記錄錯誤的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="72bcc-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="72bcc-115">本教學課程會示範如何存取的未處理的例外狀況詳細資料，以便它們可以記錄以及通知開發人員。</span><span class="sxs-lookup"><span data-stu-id="72bcc-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="72bcc-116">下列這其中的兩個教學課程中，瀏覽錯誤記錄程式庫，之後的設定，會自動通知開發人員的執行階段錯誤並記錄其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="72bcc-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="72bcc-117">在本教學課程中檢查的資訊是最有用，如果您需要以某種唯一或自訂的方式處理未處理例外狀況。</span><span class="sxs-lookup"><span data-stu-id="72bcc-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="72bcc-118">在其中您只需要記錄例外狀況，並告知開發人員的情況下，使用錯誤記錄程式庫是最好的選擇。</span><span class="sxs-lookup"><span data-stu-id="72bcc-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="72bcc-119">下面兩個教學課程提供兩個這類程式庫的概觀。</span><span class="sxs-lookup"><span data-stu-id="72bcc-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="72bcc-120">執行程式碼時`Error`就會引發事件</span><span class="sxs-lookup"><span data-stu-id="72bcc-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="72bcc-121">事件會提供物件發出訊號，已發生有趣的東西，以及執行程式碼在回應中的另一個物件的機制。</span><span class="sxs-lookup"><span data-stu-id="72bcc-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="72bcc-122">身為 ASP.NET 開發人員您習慣免除考慮事件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="72bcc-123">如果您想要執行一些程式碼，當訪客按一下特定按鈕時，您會建立事件處理常式，這個按鈕`Click`事件並將程式碼放在那里。</span><span class="sxs-lookup"><span data-stu-id="72bcc-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="72bcc-124">有鑑於 ASP.NET 執行階段會引發其[`Error`事件](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx)每次處理的例外狀況發生時，它會遵循記錄的錯誤詳細資料的程式碼就會在事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="72bcc-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="72bcc-125">但您該如何建立事件處理常式`Error`事件？</span><span class="sxs-lookup"><span data-stu-id="72bcc-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="72bcc-126">`Error`事件是中的許多事件的其中一個[`HttpApplication`類別](https://msdn.microsoft.com/library/system.web.httpapplication.aspx)所要求的存留期間引發之 HTTP 管線中的特定階段。</span><span class="sxs-lookup"><span data-stu-id="72bcc-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="72bcc-127">例如，`HttpApplication`類別的[`BeginRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx)開頭的每個要求，就會引發其[`AuthenticateRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)安全性模組的已識別的要求者時所引發。</span><span class="sxs-lookup"><span data-stu-id="72bcc-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="72bcc-128">這些`HttpApplication`事件可以讓網頁開發人員在要求的存留期執行的各個點上的自訂邏輯的方法。</span><span class="sxs-lookup"><span data-stu-id="72bcc-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="72bcc-129">事件處理常式`HttpApplication`事件可以放在名為的特殊檔案`Global.asax`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="72bcc-130">若要建立此檔案在您的網站，將新項目新增至您的網站名稱中使用全域應用程式類別範本的根目錄`Global.asax`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-cs/_static/image2.png)](processing-unhandled-exceptions-cs/_static/image1.png)

<span data-ttu-id="72bcc-131">**圖 1**:新增`Global.asax`您 Web 應用程式</span><span class="sxs-lookup"><span data-stu-id="72bcc-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
<span data-ttu-id="72bcc-132">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="72bcc-132">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="72bcc-133">內容和結構`Global.asax`稍有根據您所使用的 Web 應用程式專案 (WAP) 或網站專案 (WSP) Visual Studio 所建立的檔案而有所不同。</span><span class="sxs-lookup"><span data-stu-id="72bcc-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="72bcc-134">與 WAP，`Global.asax`實作為兩個不同的檔案-`Global.asax`和`Global.asax.cs`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.cs`.</span></span> <span data-ttu-id="72bcc-135">`Global.asax`檔案包含執行任何動作，但`@Application`指示詞參考`.cs`檔案; 中所定義的感興趣的處理常式活動`Global.asax.cs`檔案。</span><span class="sxs-lookup"><span data-stu-id="72bcc-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.cs` file; the event handlers of interest are defined in the `Global.asax.cs` file.</span></span> <span data-ttu-id="72bcc-136">針對 WSPs，建立只有一個檔案， `Global.asax`，而定義的事件處理常式`<script runat="server">`區塊。</span><span class="sxs-lookup"><span data-stu-id="72bcc-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="72bcc-137">`Global.asax` WAP 中由 Visual Studio 的通用應用程式類別範本的檔案包含名為的事件處理常式`Application_BeginRequest`， `Application_AuthenticateRequest`，以及`Application_Error`，這是事件處理常式，如`HttpApplication`事件`BeginRequest`， `AuthenticateRequest`，和`Error`分別。</span><span class="sxs-lookup"><span data-stu-id="72bcc-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="72bcc-138">另外還有名為事件處理常式`Application_Start`， `Session_Start`， `Application_End`，和`Session_End`，這是 web 應用程式啟動時，當新的工作階段啟動時，應用程式結束時，所引發的事件處理常式和工作階段結束時，分別。</span><span class="sxs-lookup"><span data-stu-id="72bcc-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="72bcc-139">`Global.asax` Visual Studio 所建立的 WSP 檔案只包含`Application_Error`， `Application_Start`， `Session_Start`， `Application_End`，和`Session_End`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="72bcc-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="72bcc-140">部署 ASP.NET 應用程式時，您必須複製`Global.asax`到生產環境的檔案。</span><span class="sxs-lookup"><span data-stu-id="72bcc-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="72bcc-141">`Global.asax.cs`檔案，WAP 中建立時，不需要將複製到生產環境中，因為此程式碼會編譯專案的組件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-141">The `Global.asax.cs` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="72bcc-142">Visual Studio 的通用應用程式類別範本所建立的事件處理常式並不詳盡。</span><span class="sxs-lookup"><span data-stu-id="72bcc-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="72bcc-143">您可以為任何新增事件處理常式`HttpApplication`所命名的事件處理常式的事件`Application_EventName`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="72bcc-144">例如，您可以在其中新增下列程式碼`Global.asax`檔案以建立事件處理常式[`AuthorizeRequest`事件](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="72bcc-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-cs[Main](processing-unhandled-exceptions-cs/samples/sample1.cs)]

<span data-ttu-id="72bcc-145">同樣地，您可以移除任何事件處理常式的全域應用程式類別範本所建立，則不需要。</span><span class="sxs-lookup"><span data-stu-id="72bcc-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="72bcc-146">本教學課程中，我們只需要的事件處理常式`Error`事件; 隨時移除其他事件處理常式從`Global.asax`檔案。</span><span class="sxs-lookup"><span data-stu-id="72bcc-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="72bcc-147">*HTTP 模組*提供另一種方式來定義事件處理常式`HttpApplication`事件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="72bcc-148">HTTP 模組會建立類別檔案，可直接置於 web 應用程式專案，或者分離到不同的類別庫。</span><span class="sxs-lookup"><span data-stu-id="72bcc-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="72bcc-149">HTTP 模組因為它們可以分割成的類別庫，提供更有彈性且可重複使用的模型來建立`HttpApplication`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="72bcc-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="72bcc-150">而`Global.asax`檔案是特定 web 應用程式所在的位置，HTTP 模組可以編譯成組件，此時若要將 HTTP 模組新增至網站很簡單，只要卸除組件中`Bin`資料夾並註冊中的模組`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="72bcc-151">本教學課程不會尋找在建立及使用 HTTP 模組，但在下列兩個教學課程中使用的兩個錯誤記錄程式庫會實作為 HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="72bcc-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="72bcc-152">如 HTTP 模組的優點的詳細背景，請參閱[使用 HTTP 模組和處理常式，以建立可外掛的 ASP.NET 元件](https://msdn.microsoft.com/library/aa479332.aspx)。</span><span class="sxs-lookup"><span data-stu-id="72bcc-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="72bcc-153">擷取未處理的例外狀況的相關資訊</span><span class="sxs-lookup"><span data-stu-id="72bcc-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="72bcc-154">現在我們已使用 Global.asax 檔案`Application_Error`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="72bcc-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="72bcc-155">這個事件處理常式執行時我們必須通知錯誤的開發人員，並記錄其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="72bcc-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="72bcc-156">若要完成這些工作，我們必須先決定所引發的例外狀況的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="72bcc-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="72bcc-157">使用伺服器物件的[`GetLastError`方法](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx)擷取造成未處理例外狀況的詳細資料`Error`引發的事件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="72bcc-158">`GetLastError`方法會傳回型別的物件`Exception`，這是.NET Framework 中的所有例外狀況的基底類型。</span><span class="sxs-lookup"><span data-stu-id="72bcc-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="72bcc-159">不過，上述程式碼中我要將物件轉型例外狀況所傳回`GetLastError`成`HttpException`物件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="72bcc-160">如果`Error`因為擲回例外狀況的 ASP.NET 資源處理期間所擲回的例外狀況會包裝內則會引發事件`HttpException`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="72bcc-161">若要取得實際的例外狀況，導致錯誤事件使用`InnerException`屬性。</span><span class="sxs-lookup"><span data-stu-id="72bcc-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="72bcc-162">如果`Error`引發事件以 HTTP 為基礎的例外狀況，例如不存在 頁面上，要求因為`HttpException`擲回，但它並沒有內部例外狀況。</span><span class="sxs-lookup"><span data-stu-id="72bcc-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="72bcc-163">下列程式碼會使用`GetLastErrormessage`來擷取有關所觸發的例外狀況`Error`事件，儲存`HttpException`名為的變數`lastErrorWrapper`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="72bcc-164">接著會儲存類型、 訊息和原始的例外狀況堆疊追蹤中三個字串變數，查看是否`lastErrorWrapper`是實際的例外狀況觸發`Error`事件 （如果是以 HTTP 為基礎的例外狀況） 或其是否只是處理要求時所擲回例外狀況的包裝函式。</span><span class="sxs-lookup"><span data-stu-id="72bcc-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="72bcc-165">此時，您會有您需要撰寫程式碼，會將例外狀況的詳細資訊記錄至資料庫資料表的所有資訊。</span><span class="sxs-lookup"><span data-stu-id="72bcc-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="72bcc-166">您可以建立具有資料行的資料庫資料表，每個感興趣的類型、 訊息、 堆疊追蹤和等等-以及其他一項有用的資訊，例如要求頁面的 URL 和目前登入的使用者名稱的錯誤詳細資料。</span><span class="sxs-lookup"><span data-stu-id="72bcc-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="72bcc-167">在 `Application_Error`事件處理常式，您接著連接到資料庫並將記錄插入資料表。</span><span class="sxs-lookup"><span data-stu-id="72bcc-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="72bcc-168">同樣地，您可以新增要警示的錯誤，透過電子郵件的開發人員的程式碼。</span><span class="sxs-lookup"><span data-stu-id="72bcc-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="72bcc-169">在下面兩個教學課程中檢查錯誤記錄程式庫會提供內建的這類功能，因此不需要此錯誤記錄和通知自行建置。</span><span class="sxs-lookup"><span data-stu-id="72bcc-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="72bcc-170">不過，展示`Error`引發事件，`Application_Error`事件處理常式可以用來記錄錯誤詳細資料和通知開發人員，讓我們新增 會發生錯誤時通知開發人員的程式碼。</span><span class="sxs-lookup"><span data-stu-id="72bcc-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="72bcc-171">發生未處理的例外狀況時通知開發人員</span><span class="sxs-lookup"><span data-stu-id="72bcc-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="72bcc-172">在生產環境中處理的例外狀況時務必通知開發小組，讓他們可以評估錯誤並判斷必須採取的動作。</span><span class="sxs-lookup"><span data-stu-id="72bcc-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="72bcc-173">比方說，如果沒有在連接到資料庫，則您必須為 double 錯誤檢查您的連接字串，或許使用您的 web 主機服務公司開啟支援票證。</span><span class="sxs-lookup"><span data-stu-id="72bcc-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="72bcc-174">如果發生例外狀況，因為發生程式設計錯誤，可能需要額外的程式碼或驗證邏輯加入至預防這類錯誤的。</span><span class="sxs-lookup"><span data-stu-id="72bcc-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="72bcc-175">.NET Framework 中的類別[`System.Net.Mail`命名空間](https://msdn.microsoft.com/library/system.net.mail.aspx)輕鬆地傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="72bcc-176">[ `MailMessage`類別](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx)則表示電子郵件訊息，並具有屬性，例如`To`， `From`， `Subject`， `Body`，以及`Attachments`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="72bcc-177">`SmtpClass`用來傳送`MailMessage`物件使用指定的 SMTP 伺服器，可以程式設計方式或以宣告方式在指定的 SMTP 伺服器設定[`<system.net>`項目](https://msdn.microsoft.com/library/6484zdc1.aspx)在`Web.config file`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="72bcc-178">如需有關傳送電子郵件訊息中的 ASP.NET 應用程式查看我的文章中，[在 ASP.NET 中的 傳送電子郵件](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)，而[System.Net.Mail 常見問題集](http://systemnetmail.com/)。</span><span class="sxs-lookup"><span data-stu-id="72bcc-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="72bcc-179">`<system.net>`項目包含所使用的 SMTP 伺服器設定`SmtpClient`類別傳送電子郵件時。</span><span class="sxs-lookup"><span data-stu-id="72bcc-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="72bcc-180">您的 web 主機服務公司可能有可用來從您的應用程式傳送電子郵件的 SMTP 伺服器。</span><span class="sxs-lookup"><span data-stu-id="72bcc-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="72bcc-181">您應該使用您的 web 應用程式中的 SMTP 伺服器設定的詳細資訊，請參閱您的 web 主機的 [支援] 區段。</span><span class="sxs-lookup"><span data-stu-id="72bcc-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="72bcc-182">將下列程式碼加入`Application_Error`傳送為開發人員的電子郵件，發生錯誤時的事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="72bcc-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample4.cs)]

<span data-ttu-id="72bcc-183">上述程式碼相當長的時間時，大量建立顯示的 HTML 中傳送給開發人員的電子郵件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="72bcc-184">藉由參考的程式碼會開始`HttpException`所傳回`GetLastError`方法 (`lastErrorWrapper`)。</span><span class="sxs-lookup"><span data-stu-id="72bcc-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="72bcc-185">實際要求所引發的例外狀況透過擷取`lastErrorWrapper.InnerException`並指派給變數`lastError`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="72bcc-186">類型、 訊息和堆疊追蹤資訊會從`lastError`並儲存在三個字串變數。</span><span class="sxs-lookup"><span data-stu-id="72bcc-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="72bcc-187">下一步`MailMessage`名為物件`mm`建立。</span><span class="sxs-lookup"><span data-stu-id="72bcc-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="72bcc-188">電子郵件內文是 HTML 格式，並顯示所要求之頁面 URL]、 [目前登入的使用者，以及例外狀況 （類型、 訊息和堆疊追蹤） 的相關資訊的名稱。</span><span class="sxs-lookup"><span data-stu-id="72bcc-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="72bcc-189">其中一個棒`HttpException`類別是您可以產生用來建立例外狀況詳細資料黃色螢幕的死亡 (YSOD) 藉由呼叫的 HTML [GetHtmlErrorMessage 方法](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx)。</span><span class="sxs-lookup"><span data-stu-id="72bcc-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="72bcc-190">這個方法是此處用來擷取例外狀況詳細資料 YSOD 標記，並將它加入做為附件的電子郵件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="72bcc-191">另外請注意： 如果例外狀況，觸發`Error`事件是以 HTTP 為基礎例外狀況 （例如不存在的頁面要求），然後`GetHtmlErrorMessage`方法會傳回`null`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="72bcc-192">最後一個步驟是傳送`MailMessage`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="72bcc-193">這是藉由建立新`SmtpClient`方法，並呼叫其`Send`方法。</span><span class="sxs-lookup"><span data-stu-id="72bcc-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="72bcc-194">Web 應用程式中使用此程式碼之前，您會想變更中的值`ToAddress`並`FromAddress`常數support@example.com任何電子郵件地址錯誤通知電子郵件會寄給和源自。</span><span class="sxs-lookup"><span data-stu-id="72bcc-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="72bcc-195">您也需要指定 SMTP 伺服器設定，在`<system.net>`一節中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="72bcc-196">請參閱您的 web 主機提供者，以判斷要使用的 SMTP 伺服器設定。</span><span class="sxs-lookup"><span data-stu-id="72bcc-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="72bcc-197">與此程式碼都就緒每當發生錯誤開發人員會傳送電子郵件訊息，摘要說明此錯誤，並包含 YSOD。</span><span class="sxs-lookup"><span data-stu-id="72bcc-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="72bcc-198">在先前的教學課程中示範的執行階段錯誤所瀏覽 Genre.aspx 並傳入無效`ID`值，是透過查詢字串，例如`Genre.aspx?ID=foo`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="72bcc-199">瀏覽的頁面`Global.asax`檔案會產生相同的使用者體驗，如在先前的教學課程-在開發環境中您將會繼續以查看例外狀況詳細資料黃色死亡畫面，而在您將在生產環境中請參閱自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="72bcc-200">除了這個現有的行為，開發人員會收到一封電子郵件。</span><span class="sxs-lookup"><span data-stu-id="72bcc-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="72bcc-201">**圖 2**顯示瀏覽時收到的電子郵件`Genre.aspx?ID=foo`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="72bcc-202">電子郵件本文摘要說明例外狀況資訊，雖然`YSOD.htm`附件會顯示例外狀況詳細資料 YSOD] 所示的內容 (請參閱 < **[圖 3**)。</span><span class="sxs-lookup"><span data-stu-id="72bcc-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image5.png)](processing-unhandled-exceptions-cs/_static/image4.png)

<span data-ttu-id="72bcc-203">**圖 2**:開發人員處理的例外狀況時傳送電子郵件通知</span><span class="sxs-lookup"><span data-stu-id="72bcc-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
<span data-ttu-id="72bcc-204">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="72bcc-204">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-cs/_static/image8.png)](processing-unhandled-exceptions-cs/_static/image7.png)

<span data-ttu-id="72bcc-205">**圖 3**:電子郵件通知中包含例外狀況詳細資料 YSOD 做為附件</span><span class="sxs-lookup"><span data-stu-id="72bcc-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
<span data-ttu-id="72bcc-206">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="72bcc-206">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="72bcc-207">什麼使用自訂錯誤網頁嗎？</span><span class="sxs-lookup"><span data-stu-id="72bcc-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="72bcc-208">本教學課程示範如何使用`Global.asax`而`Application_Error`事件處理常式來處理的例外狀況發生時執行程式碼。</span><span class="sxs-lookup"><span data-stu-id="72bcc-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="72bcc-209">具體來說，我們使用這個事件處理常式來通知的錯誤，開發人員我們可以進一步擴充它也在資料庫中記錄錯誤的詳細資料。</span><span class="sxs-lookup"><span data-stu-id="72bcc-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="72bcc-210">是否存在`Application_Error`事件處理常式不會影響終端使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="72bcc-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="72bcc-211">它們仍然會看到已設定的錯誤頁面上，錯誤詳細資料 YSOD、 執行階段錯誤 YSOD 中，或自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="72bcc-212">很自然地想知道是否`Global.asax`檔案和`Application_Error`事件時，需要使用自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="72bcc-213">發生錯誤時向使用者顯示自訂錯誤頁面，因此為什麼不能我們放來通知開發人員，並登入程式碼後置類別的自訂錯誤頁面的 錯誤詳細資料的程式碼？</span><span class="sxs-lookup"><span data-stu-id="72bcc-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="72bcc-214">您當然可以將程式碼加入自訂錯誤頁面的程式碼後置類別時您沒有存取權所觸發的例外狀況的詳細資料`Error`事件時使用的技巧，我們在先前的教學課程中加以探索。</span><span class="sxs-lookup"><span data-stu-id="72bcc-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="72bcc-215">呼叫`GetLastError`從自訂錯誤頁面的方法會傳回`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="72bcc-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="72bcc-216">此行為的原因是因為透過重新導向達到自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="72bcc-217">當未處理的例外狀況會到達 ASP.NET 執行階段的 ASP.NET 引擎會引發其`Error`事件 (它就會執行`Application_Error`事件處理常式)，然後*重新導向*使用者自訂錯誤頁面，藉由發出`Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="72bcc-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="72bcc-218">`Response.Redirect`方法會傳送 HTTP 302 狀態碼，用戶端指示瀏覽器要求新的 URL，也就是自訂錯誤網頁的回應。</span><span class="sxs-lookup"><span data-stu-id="72bcc-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="72bcc-219">接著瀏覽器會自動要求這個新頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="72bcc-220">您所見，從網頁個別要求自訂錯誤頁面，因為瀏覽器的網址列變更為自訂錯誤網頁的 URL 而產生錯誤 (請參閱**圖 4**)。</span><span class="sxs-lookup"><span data-stu-id="72bcc-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image11.png)](processing-unhandled-exceptions-cs/_static/image10.png)

<span data-ttu-id="72bcc-221">**圖 4**:發生錯誤時瀏覽器重新導向至自訂錯誤頁面 URL</span><span class="sxs-lookup"><span data-stu-id="72bcc-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
<span data-ttu-id="72bcc-222">([按一下以檢視完整大小的影像](processing-unhandled-exceptions-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="72bcc-222">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image12.png))</span></span>

<span data-ttu-id="72bcc-223">最後的結果是當伺服器會回應 HTTP 302 重新導向時，發生未處理的例外狀況的要求會結束。</span><span class="sxs-lookup"><span data-stu-id="72bcc-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="72bcc-224">自訂錯誤網頁的後續要求是全新的要求;此時 ASP.NET 引擎會已捨棄的錯誤資訊，此外，有沒有辦法在前一個要求中未處理的例外狀況關聯的自訂錯誤頁面的新要求。</span><span class="sxs-lookup"><span data-stu-id="72bcc-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="72bcc-225">這就是為什麼`GetLastError`傳回`null`呼叫從自訂錯誤頁面時。</span><span class="sxs-lookup"><span data-stu-id="72bcc-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="72bcc-226">不過，就能夠在執行期間造成錯誤的相同要求的自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="72bcc-227">[ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx)方法將執行轉移至指定的 URL，並加以處理相同要求中。</span><span class="sxs-lookup"><span data-stu-id="72bcc-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="72bcc-228">您無法移動程式碼中`Application_Error`事件處理常式來取代它的自訂錯誤網頁的程式碼後置類別`Global.asax`為下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="72bcc-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="72bcc-229">現在當未處理的例外狀況發生時`Application_Error`事件處理常式會將控制權傳輸至適當的自訂錯誤網頁的 HTTP 狀態碼為基礎。</span><span class="sxs-lookup"><span data-stu-id="72bcc-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="72bcc-230">自訂錯誤頁面控制項已移轉，因為已透過未處理的例外狀況資訊的存取權`Server.GetLastError`和可以通知錯誤的開發人員，並記錄其詳細資料。</span><span class="sxs-lookup"><span data-stu-id="72bcc-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="72bcc-231">`Server.Transfer`呼叫停止 ASP.NET 引擎，從使用者重新導向至自訂錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="72bcc-232">相反地，傳回自訂錯誤網頁的內容做為產生的錯誤頁面的回應。</span><span class="sxs-lookup"><span data-stu-id="72bcc-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="72bcc-233">總結</span><span class="sxs-lookup"><span data-stu-id="72bcc-233">Summary</span></span>

<span data-ttu-id="72bcc-234">在 ASP.NET web 應用程式中處理的例外狀況時，ASP.NET 執行階段會引發`Error`事件，並顯示設定的錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="72bcc-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="72bcc-235">我們會通知的錯誤，開發人員記錄其詳細資料，或透過其他方式，藉由建立錯誤事件的事件處理常式處理它。</span><span class="sxs-lookup"><span data-stu-id="72bcc-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="72bcc-236">有兩種方式可建立的事件處理常式`HttpApplication`等事件`Error`： 在`Global.asax`檔案或從 HTTP 模組。</span><span class="sxs-lookup"><span data-stu-id="72bcc-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="72bcc-237">本教學課程示範如何建立`Error`中的事件處理常式`Global.asax`通知錯誤的開發人員透過電子郵件訊息的檔案。</span><span class="sxs-lookup"><span data-stu-id="72bcc-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="72bcc-238">建立`Error`事件處理常式是很有用，如果您需要以某種唯一或自訂的方式處理未處理例外狀況。</span><span class="sxs-lookup"><span data-stu-id="72bcc-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="72bcc-239">不過，建立您自己`Error`記錄例外狀況，或通知開發人員的事件處理常式不是最有效率地使用您的時間，已經有免費又容易使用的錯誤記錄程式庫，可以在幾分鐘內完成設定。</span><span class="sxs-lookup"><span data-stu-id="72bcc-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="72bcc-240">下面兩個教學課程會檢查兩個這類程式庫。</span><span class="sxs-lookup"><span data-stu-id="72bcc-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="72bcc-241">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="72bcc-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="72bcc-242">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="72bcc-242">Further Reading</span></span>

<span data-ttu-id="72bcc-243">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="72bcc-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="72bcc-244">ASP.NET HTTP 模組和 HTTP 處理常式概觀</span><span class="sxs-lookup"><span data-stu-id="72bcc-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="72bcc-245">依正常程序回應未處理的例外狀況-處理未處理的例外狀況</span><span class="sxs-lookup"><span data-stu-id="72bcc-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="72bcc-246">`HttpApplication` 類別和 ASP.NET 應用程式物件</span><span class="sxs-lookup"><span data-stu-id="72bcc-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="72bcc-247">HTTP 處理常式和 ASP.NET 中的 HTTP 模組</span><span class="sxs-lookup"><span data-stu-id="72bcc-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="72bcc-248">在 ASP.NET 中傳送電子郵件</span><span class="sxs-lookup"><span data-stu-id="72bcc-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="72bcc-249">了解`Global.asax`檔案</span><span class="sxs-lookup"><span data-stu-id="72bcc-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="72bcc-250">使用 HTTP 模組和處理常式來建立可外掛的 ASP.NET 元件</span><span class="sxs-lookup"><span data-stu-id="72bcc-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="72bcc-251">使用 ASP.NET`Global.asax`檔案</span><span class="sxs-lookup"><span data-stu-id="72bcc-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="72bcc-252">使用`HttpApplication`執行個體</span><span class="sxs-lookup"><span data-stu-id="72bcc-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="72bcc-253">[上一頁](displaying-a-custom-error-page-cs.md)
> [下一頁](logging-error-details-with-asp-net-health-monitoring-cs.md)</span><span class="sxs-lookup"><span data-stu-id="72bcc-253">[Previous](displaying-a-custom-error-page-cs.md)
[Next](logging-error-details-with-asp-net-health-monitoring-cs.md)</span></span>
