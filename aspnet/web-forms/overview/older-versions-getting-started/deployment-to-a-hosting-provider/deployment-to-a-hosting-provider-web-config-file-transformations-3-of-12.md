---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12
title: 使用 Visual Studio 或 Visual Web Developer 的 SQL Server Compact 部署 ASP.NET Web 應用程式： Web.config 檔案轉換-12 之 3 |Microsoft Docs
author: tdykstra
description: 這一系列的教學課程會示範如何使用 Visual Stu 部署（發行）包含 SQL Server Compact 資料庫的 ASP.NET web 應用程式專案 。
ms.author: riande
ms.date: 11/17/2011
ms.assetid: 2b0df3d9-450b-4ea6-b315-4c9650722cad
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12
msc.type: authoredcontent
ms.openlocfilehash: 9e7902bcf8a16c154aee1a982824bfaedeea7d9d
ms.sourcegitcommit: 7b1e1784213dd4c301635f9e181764f3e2f94162
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/22/2020
ms.locfileid: "76309232"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-webconfig-file-transformations---3-of-12"></a><span data-ttu-id="3b3d5-103">使用 Visual Studio 或 Visual Web Developer 的 SQL Server Compact 部署 ASP.NET Web 應用程式： Web.config 檔案轉換-12 的3</span><span class="sxs-lookup"><span data-stu-id="3b3d5-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Web.Config File Transformations - 3 of 12</span></span>

<span data-ttu-id="3b3d5-104">由[Tom 作者: dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="3b3d5-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="3b3d5-105">下載入門專案</span><span class="sxs-lookup"><span data-stu-id="3b3d5-105">Download Starter Project</span></span>](https://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="3b3d5-106">這一系列的教學課程會示範如何使用 Visual Studio 2012 RC 或 Visual Studio Express 2012 RC for Web，來部署（發行）包含 SQL Server Compact 資料庫的 ASP.NET web 應用程式專案。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="3b3d5-107">如果您安裝 Web 發佈更新，也可以使用 Visual Studio 2010。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="3b3d5-108">如需此系列的簡介，請參閱[本系列的第一個教學](deployment-to-a-hosting-provider-introduction-1-of-12.md)課程。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="3b3d5-109">如需示範在 Visual Studio 2012 的 RC 版本後引進部署功能的教學課程，說明如何部署 SQL Server Compact 以外的 SQL Server 版本，並示範如何部署到 Azure App Service Web Apps，請參閱[使用 Visual Studio ASP.NET Web 部署](../../deployment/visual-studio-web-deployment/introduction.md)。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="3b3d5-110">概觀</span><span class="sxs-lookup"><span data-stu-id="3b3d5-110">Overview</span></span>

<span data-ttu-id="3b3d5-111">本教學課程會示範如何在您*將 web.config 檔案*部署到不同的目的地環境時，自動化該檔案的變更程式。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-111">This tutorial shows you how to automate the process of changing the *Web.config* file when you deploy it to different destination environments.</span></span> <span data-ttu-id="3b3d5-112">大部分的應用程式都有*web.config*檔案中的設定，在部署應用程式時必須不同。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-112">Most applications have settings in the *Web.config* file that must be different when the application is deployed.</span></span> <span data-ttu-id="3b3d5-113">將進行這些變更的程式自動化，讓您不必在每次部署時都必須手動執行，這會很繁瑣且容易出錯。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-113">Automating the process of making these changes keeps you from having to do them manually every time you deploy, which would be tedious and error prone.</span></span>

<span data-ttu-id="3b3d5-114">提醒：如果您在進行本教學課程時收到錯誤訊息或無法解決問題，請務必查看 [疑難排解][頁面](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md)。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-114">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="webconfig-transformations-versus-web-deploy-parameters"></a><span data-ttu-id="3b3d5-115">Web.config 轉換與 Web Deploy 參數的比較</span><span class="sxs-lookup"><span data-stu-id="3b3d5-115">Web.config Transformations versus Web Deploy Parameters</span></span>

<span data-ttu-id="3b3d5-116">有兩種方式可將變更*web.config*檔案設定的程式自動化： [web.config 轉換](https://msdn.microsoft.com/library/dd465326.aspx)和[Web Deploy 參數](https://msdn.microsoft.com/library/ff398068.aspx)。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-116">There are two ways to automate the process of changing *Web.config* file settings: [Web.config transformations](https://msdn.microsoft.com/library/dd465326.aspx) and [Web Deploy parameters](https://msdn.microsoft.com/library/ff398068.aspx).</span></span> <span data-ttu-id="3b3d5-117">Web.config*轉換檔案*包含 XML 標記，可指定在部署 web.config 檔案時，如何*變更 web.config 檔案*。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-117">A *Web.config* transformation file contains XML markup that specifies how to change the *Web.config* file when it is deployed.</span></span> <span data-ttu-id="3b3d5-118">您可以針對特定的組建設定和特定的發行設定檔，指定不同的變更。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-118">You can specify different changes for specific build configurations and for specific publish profiles.</span></span> <span data-ttu-id="3b3d5-119">預設組建設定為 [Debug] 和 [Release]，而您可以建立自訂群組建設定。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-119">The default build configurations are Debug and Release, and you can create custom build configurations.</span></span> <span data-ttu-id="3b3d5-120">發行設定檔通常會對應至目的地環境。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-120">A publish profile typically corresponds to a destination environment.</span></span> <span data-ttu-id="3b3d5-121">（您將在[部署至 IIS 作為測試環境](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md)教學課程中深入瞭解發行設定檔）。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-121">(You'll learn more about publish profiles in the [Deploying to IIS as a Test Environment](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md) tutorial.)</span></span>

<span data-ttu-id="3b3d5-122">Web Deploy 參數可以用來指定在部署期間必須設定的許多不同類型的設定，*包括在 web.config*檔案中找到的設定。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-122">Web Deploy parameters can be used to specify many different kinds of settings that must be configured during deployment, including settings that are found in *Web.config* files.</span></span> <span data-ttu-id="3b3d5-123">當用來指定*web.config*檔案變更時，Web Deploy 參數會更複雜，但當您在部署之前不知道要設定的值時，它們會很有用。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-123">When used to specify *Web.config* file changes, Web Deploy parameters are more complex to set up, but they are useful when you do not know the value to be set until you deploy.</span></span> <span data-ttu-id="3b3d5-124">例如，在企業環境中，您可能會建立*部署套件*，並將其提供給 it 部門中的人員，以在實際執行環境中安裝，而且該人員必須能夠輸入不知道的連接字串或密碼。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-124">For example, in an enterprise environment, you might create a *deployment package* and give it to a person in the IT department to install in production, and that person has to be able to enter connection strings or passwords that you do not know.</span></span>

<span data-ttu-id="3b3d5-125">在本教學課程涵蓋的案例中，您知道必須*對 web.config 檔案*進行的所有作業，因此您不需要使用 Web Deploy 參數。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-125">For the scenario that this tutorial covers, you know everything that has to be done to the *Web.config* file, so you do not need to use Web Deploy parameters.</span></span> <span data-ttu-id="3b3d5-126">您將會根據所使用的組建設定進行一些不同的轉換，並根據使用的發行設定檔而有所不同。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-126">You'll configure some transformations that differ depending on the build configuration used, and some that differ depending on the publish profile used.</span></span>

## <a name="creating-transformation-files-for-publish-profiles"></a><span data-ttu-id="3b3d5-127">建立發行設定檔的轉換檔案</span><span class="sxs-lookup"><span data-stu-id="3b3d5-127">Creating Transformation Files for Publish Profiles</span></span>

<span data-ttu-id="3b3d5-128">在**方案總管**中，*展開 [web.config]* 以查看預設為兩個預設組建*設定所建立的 web.config 和 web.config* *轉換檔案。*</span><span class="sxs-lookup"><span data-stu-id="3b3d5-128">In **Solution Explorer**, expand *Web.config* to see the *Web.Debug.config* and *Web.Release.config* transformation files that are created by default for the two default build configurations.</span></span>

![Web. config_transform_files](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image1.png)

<span data-ttu-id="3b3d5-130">您可以用滑鼠右鍵按一下 Web.config 檔案，然後從內容功能表選擇 [**新增設定轉換**]，來建立自訂群組建設定的轉換檔案，但在本教學課程中，您不需要這麼做。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-130">You can create transformation files for custom build configurations by right-clicking the Web.config file and choosing **Add Config Transforms** from the context menu, but for this tutorial you don't need to do that.</span></span>

<span data-ttu-id="3b3d5-131">您需要兩個更多的轉換檔案，以設定與部署目的地相關的變更，而不是設定為組建設定。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-131">You do need two more transformation files, for configuring changes that are related to the deployment destination rather than to the build configuration.</span></span> <span data-ttu-id="3b3d5-132">這種設定的典型範例是測試與生產環境不同的 WCF 端點。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-132">A typical example of this kind of setting is a WCF endpoint that is different for test versus production.</span></span> <span data-ttu-id="3b3d5-133">在稍後的教學課程中，您將建立名為 Test 和生產的發行設定檔，因此您需要一個*web.config*檔案*和一個 web.config*檔案。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-133">In later tutorials you'll create publish profiles named Test and Production, so you need a *Web.Test.config* file and a *Web.Production.config* file.</span></span>

<span data-ttu-id="3b3d5-134">必須以手動方式建立系結至發行設定檔的轉換檔案。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-134">Transformation files that are tied to publish profiles must be created manually.</span></span> <span data-ttu-id="3b3d5-135">在**方案總管**中，以滑鼠右鍵按一下 ContosoUniversity 專案，然後選取 [**在 Windows Explorer 中開啟資料夾**]。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-135">In **Solution Explorer**, right-click the ContosoUniversity project and select **Open Folder in Windows Explorer**.</span></span>

![Open_folder_in_Windows_Explorer](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image2.png)

<span data-ttu-id="3b3d5-137">在**Windows Explorer**中，選取*web.config*檔案、複製檔案，然後貼上兩個複本。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-137">In **Windows Explorer**, select the *Web.Release.config* file, copy the file, and then paste two copies of it.</span></span> <span data-ttu-id="3b3d5-138">將這些複本重新命名為*web.config* *和 web.config，然後*關閉**Windows Explorer**。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-138">Rename these copies *Web.Production.config* and *Web.Test.config*, then close **Windows Explorer**.</span></span>

<span data-ttu-id="3b3d5-139">在**方案總管**中，**按一下 [** 重新整理] 以查看新的檔案。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-139">In **Solution Explorer**, click **Refresh** to see the new files.</span></span>

<span data-ttu-id="3b3d5-140">選取新的檔案，按一下滑鼠右鍵，然後在內容功能表中按一下 [**包含在專案中**]。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-140">Select the new files, right-click, and then click **Include in Project** in the context menu.</span></span>

![在專案中包含測試和生產設定檔案](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image3.png)

<span data-ttu-id="3b3d5-142">若要避免部署這些檔案，請在**方案總管**中選取這些檔案，然後在 [**屬性**] 視窗中，將 [**組建動作**] 屬性從 [**內容**] 變更為 [**無**]。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-142">To prevent these files from being deployed, select them in **Solution Explorer**, and then in the **Properties** window change the **Build Action** property from **Content** to **None**.</span></span> <span data-ttu-id="3b3d5-143">（以組建設定為基礎的轉換檔案會自動防止部署）。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-143">(The transformation files that are based on build configurations are automatically prevented from deploying.)</span></span>

<span data-ttu-id="3b3d5-144">您現在已準備好在*web.config 轉換檔案中輸入*web.config*轉換。*</span><span class="sxs-lookup"><span data-stu-id="3b3d5-144">You are now ready to enter *Web.config* transformations into the *Web.config* transformation files.</span></span>

## <a name="limiting-error-log-access-to-administrators"></a><span data-ttu-id="3b3d5-145">限制系統管理員的錯誤記錄檔存取</span><span class="sxs-lookup"><span data-stu-id="3b3d5-145">Limiting Error Log Access to Administrators</span></span>

<span data-ttu-id="3b3d5-146">如果應用程式執行時發生錯誤，應用程式會顯示一般錯誤頁面來取代系統產生的錯誤頁面，並使用[Elmah NuGet 封裝](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx)來進行錯誤記錄和報告。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-146">If there's an error while the application runs, the application displays a generic error page in place of the system-generated error page, and it uses [Elmah NuGet package](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx) for error logging and reporting.</span></span> <span data-ttu-id="3b3d5-147">*Web.config 檔案*中的 `customErrors` 元素會指定錯誤頁面：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-147">The `customErrors` element in the *Web.config* file specifies the error page:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample1.xml)]

<span data-ttu-id="3b3d5-148">若要查看錯誤頁面，請暫時將 `customErrors` 元素的 `mode` 屬性從 "RemoteOnly" 變更為 "On"，然後從 Visual Studio 執行應用程式。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-148">To see the error page, temporarily change the `mode` attribute of the `customErrors` element from "RemoteOnly" to "On" and run the application from Visual Studio.</span></span> <span data-ttu-id="3b3d5-149">藉由要求不正確 URL （例如*Studentsxxx*）導致錯誤。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-149">Cause an error by requesting an invalid URL, such as *Studentsxxx.aspx*.</span></span> <span data-ttu-id="3b3d5-150">您會看到 [ *GenericErrorPage* ] 頁面，而不是 IIS 產生的「找不到網頁」錯誤頁面。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-150">Instead of an IIS-generated "page not found" error page, you see the *GenericErrorPage.aspx* page.</span></span>

<span data-ttu-id="3b3d5-151">[![Error_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image5.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="3b3d5-151">[![Error_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image5.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image4.png)</span></span>

<span data-ttu-id="3b3d5-152">若要查看錯誤記錄檔，請將 URL 中的所有內容取代為*elmah. axd* （如螢幕擷取畫面中的範例，`http://localhost:51130/elmah.axd`），然後按 enter 鍵：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-152">To see the error log, replace everything in the URL after the port number with *elmah.axd* (for the example in the screen shot, `http://localhost:51130/elmah.axd`) and press Enter:</span></span>

<span data-ttu-id="3b3d5-153">[![Elmah_log_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image7.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="3b3d5-153">[![Elmah_log_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image7.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image6.png)</span></span>

<span data-ttu-id="3b3d5-154">當您完成時，別忘了將 `customErrors` 元素設回 "RemoteOnly" 模式。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-154">Don't forget to set the `customErrors` element back to "RemoteOnly" mode when you're done.</span></span>

<span data-ttu-id="3b3d5-155">在您的開發電腦上，允許免費存取錯誤記錄檔頁面，但在生產環境中會有安全性風險。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-155">On your development computer it's convenient to allow free access to the error log page, but in production that would be a security risk.</span></span> <span data-ttu-id="3b3d5-156">針對生產網站，您可以在*web.config*檔案中設定轉換，藉此新增授權規則，以限制只有系統管理員才能存取錯誤記錄檔。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-156">For the production site, you can add an authorization rule that restricts error log access just to administrators by configuring a transform in the *Web.Production.config* file.</span></span>

<span data-ttu-id="3b3d5-157">開啟*web.config，並*在開啟的 `configuration` 標記之後加入新的 `location` 元素，如下所示。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-157">Open *Web.Production.config* and add a new `location` element immediately after the opening `configuration` tag, as shown here.</span></span> <span data-ttu-id="3b3d5-158">（請確定您僅新增 [`location`] 專案，而不只是為了提供一些內容而顯示的周圍標記。）</span><span class="sxs-lookup"><span data-stu-id="3b3d5-158">(Make sure that you add only the `location` element and not the surrounding markup which is shown here only to provide some context.)</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample2.xml?highlight=2-9)]

<span data-ttu-id="3b3d5-159">"Insert" 的 `Transform` 屬性值會導致此 `location` 元素當做*web.config*檔案中任何現有 `location` 元素的同級加入。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-159">The `Transform` attribute value of "Insert" causes this `location` element to be added as a sibling to any existing `location` elements in the *Web.config* file.</span></span> <span data-ttu-id="3b3d5-160">（已有一個 `location` 元素指定 [**更新信用額度**] 頁面的授權規則）。當您在部署後測試生產網站時，您會進行測試以確認此授權規則有效。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-160">(There is already one `location` element that specifies authorization rules for the **Update Credits** page.) When you test the production site after deployment, you'll test to verify that this authorization rule is effective.</span></span>

<span data-ttu-id="3b3d5-161">您不需要在測試環境中限制錯誤記錄檔存取，因此不需要將此程式碼加入至*web.config*檔案。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-161">You don't have to restrict error log access in the test environment, so you don't have to add this code to the *Web.Test.config* file.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="3b3d5-162">**安全性注意事項**絕對不要在實際執行應用程式中顯示公用的錯誤詳細資料，或將該資訊儲存在公用位置。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-162">**Security Note** Never display error details to the public in a production application, or store that information in a public location.</span></span> <span data-ttu-id="3b3d5-163">攻擊者可以使用錯誤資訊來探索網站中的弱點。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-163">Attackers can use error information to discover vulnerabilities in a site.</span></span> <span data-ttu-id="3b3d5-164">如果您在自己的應用程式中使用 ELMAH，請務必調查可設定 ELMAH 以將安全性風險降至最低的方式。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-164">If you use ELMAH in your own application, be sure to investigate ways in which ELMAH can be configured to minimize security risks.</span></span> <span data-ttu-id="3b3d5-165">本教學課程中的 ELMAH 範例不應視為建議的設定。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-165">The ELMAH example in this tutorial should not be considered a recommended configuration.</span></span> <span data-ttu-id="3b3d5-166">這是為了說明如何處理應用程式必須能夠在中建立檔案的資料夾，所選擇的範例。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-166">It is an example that was chosen in order to illustrate how to handle a folder that the application must be able to create files in.</span></span>

## <a name="setting-an-environment-indicator"></a><span data-ttu-id="3b3d5-167">設定環境指標</span><span class="sxs-lookup"><span data-stu-id="3b3d5-167">Setting an Environment Indicator</span></span>

<span data-ttu-id="3b3d5-168">常見的案例是在您部署的每個環境中，都必須有不同的*web.config*檔案設定。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-168">A common scenario is to have *Web.config* file settings that must be different in each environment that you deploy to.</span></span> <span data-ttu-id="3b3d5-169">例如，呼叫 WCF 服務的應用程式在測試和生產環境中可能需要不同的端點。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-169">For example, an application that calls a WCF service might need a different endpoint in test and production environments.</span></span> <span data-ttu-id="3b3d5-170">Contoso 大學應用程式也包含此類型的設定。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-170">The Contoso University application includes a setting of this kind also.</span></span> <span data-ttu-id="3b3d5-171">此設定會控制網站頁面上的可見指標，告訴您您所在的環境（例如開發、測試或生產）。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-171">This setting controls a visible indicator on a site's pages that tells you which environment you are in, such as development, test, or production.</span></span> <span data-ttu-id="3b3d5-172">設定值會決定應用程式是否要將 "（Dev）" 或 "（Test）" 附加至*網站*主版頁面中的主要標題：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-172">The setting value determines whether the application will append "(Dev)" or "(Test)" to the main heading in the *Site.Master* master page:</span></span>

<span data-ttu-id="3b3d5-173">[![Environment_indicator](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image9.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="3b3d5-173">[![Environment_indicator](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image9.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image8.png)</span></span>

<span data-ttu-id="3b3d5-174">當應用程式在生產環境中執行時，會省略環境指示器。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-174">The environment indicator is omitted when the application is running in production.</span></span>

<span data-ttu-id="3b3d5-175">Contoso 大學網頁會讀取*web.config*檔案 `appSettings` 中設定的值，以判斷應用程式執行所在的環境：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-175">The Contoso University web pages read a value that is set in `appSettings` in the *Web.config* file in order to determine what environment the application is running in:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample3.xml)]

<span data-ttu-id="3b3d5-176">在測試環境中，此值應為「測試」，而在生產環境中則為「生產」。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-176">The value should be "Test" in the test environment, and "Prod" in the production environment.</span></span>

<span data-ttu-id="3b3d5-177">開啟*web.config，並在*您稍早新增的 `location` 元素的開頭標記前面加入 `appSettings` 元素：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-177">Open *Web.Production.config* and add an `appSettings` element immediately before the opening tag of the `location` element you added earlier:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample4.xml)]

<span data-ttu-id="3b3d5-178">`xdt:Transform` 屬性值 "SetAttributes" 表示此轉換的目的是要變更*web.config*檔案中現有元素的屬性值。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-178">The `xdt:Transform` attribute value "SetAttributes" indicates that the purpose of this transform is to change attribute values of an existing element in the *Web.config* file.</span></span> <span data-ttu-id="3b3d5-179">`xdt:Locator` 屬性值 "Match （key）" 表示要修改的專案是其 `key` 屬性符合這裡指定之 `key` 屬性的元素。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-179">The `xdt:Locator` attribute value "Match(key)" indicates that the element to be modified is the one whose `key` attribute matches the `key` attribute specified here.</span></span> <span data-ttu-id="3b3d5-180">`add` 專案的唯一另一個屬性是 `value`，這就是在已部署的*web.config*檔案中將會變更的專案。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-180">The only other attribute of the `add` element is `value`, and that is what will be changed in the deployed *Web.config* file.</span></span> <span data-ttu-id="3b3d5-181">此程式碼會在部署至生產*環境的 web.config*檔案中，將 `Environment` `appSettings` 元素的 `value` 屬性設定為「生產」。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-181">This code causes the `value` attribute of the `Environment` `appSettings` element to be set to "Prod" in the *Web.config* file that is deployed to production.</span></span>

<span data-ttu-id="3b3d5-182">接下來，將相同的變更套用至*web.config*檔案，但將 `value` 設定為 "test"，而不是 [生產]。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-182">Next, apply the same change to *Web.Test.config* file, except set the `value` to "Test" instead of "Prod".</span></span> <span data-ttu-id="3b3d5-183">當您完成時，web.config 中的 `appSettings` 區段看*起來會像*下列範例：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-183">When you are done, the `appSettings` section in *Web.Test.config* will look like the following example:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample5.xml)]

## <a name="disabling-debug-mode"></a><span data-ttu-id="3b3d5-184">停用 Debug 模式</span><span class="sxs-lookup"><span data-stu-id="3b3d5-184">Disabling Debug Mode</span></span>

<span data-ttu-id="3b3d5-185">針對發行組建，不論您要部署到哪個環境，都不想啟用「偵測」。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-185">For a Release build, you do not want debugging enabled regardless of which environment you are deploying to.</span></span> <span data-ttu-id="3b3d5-186">根據預設，會使用從 `compilation` 元素移除 `debug` 屬性的程式碼自動建立*web.config 轉換檔案*：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-186">By default the *Web.Release.config* transform file is automatically created with code that removes the `debug` attribute from the `compilation` element:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample6.xml)]

<span data-ttu-id="3b3d5-187">當您部署發行組建時，`Transform` 屬性會導致已部署的*web.config*檔案中省略 `debug` 屬性。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-187">The `Transform` attribute causes the `debug` attribute to be omitted from the deployed *Web.config* file whenever you deploy a Release build.</span></span>

<span data-ttu-id="3b3d5-188">這個相同的轉換是在測試和實際執行的轉換檔案中，因為您會藉由複製發行轉換檔案來建立它們。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-188">This same transformation is in Test and Production transform files because you created them by copying the Release transform file.</span></span> <span data-ttu-id="3b3d5-189">您不需要在該處重複此專案，因此請開啟每個檔案，移除**編譯**元素，然後儲存並關閉每個檔案。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-189">You don't need it duplicated there, so open each of those files, remove the **compilation** element, and save and close each file.</span></span>

## <a name="setting-connection-strings"></a><span data-ttu-id="3b3d5-190">設定連接字串</span><span class="sxs-lookup"><span data-stu-id="3b3d5-190">Setting Connection Strings</span></span>

<span data-ttu-id="3b3d5-191">在大部分情況下，您不需要設定連接字串轉換，因為您可以在發行設定檔中指定連接字串。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-191">In most cases you do not need to set up connection string transformations, because you can specify connection strings in the publish profile.</span></span> <span data-ttu-id="3b3d5-192">但是當您部署 SQL Server Compact 資料庫，而且使用 Entity Framework Code First 移轉更新目的地伺服器上的資料庫時，就會發生例外狀況。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-192">But there is an exception when you're deploying a SQL Server Compact database and you're using Entity Framework Code First Migrations to update the database on the destination server.</span></span> <span data-ttu-id="3b3d5-193">在此情況下，您必須指定要在伺服器上用來更新資料庫架構的其他連接字串。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-193">For this scenario, you have to specify an additional connection string that will be used on the server for updating the database schema.</span></span> <span data-ttu-id="3b3d5-194">若要設定此轉換，請在*web.config*和*web.config 轉換檔案*中的開啟 **&lt;設定&gt;** 標記之後，立即加入 **&lt;connectionStrings&gt;** 元素：</span><span class="sxs-lookup"><span data-stu-id="3b3d5-194">To set up this transformation, add a **&lt;connectionStrings&gt;** element immediately after the opening **&lt;configuration&gt;** tag in both the *Web.Test.config* and the *Web.Production.config* transform files:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample7.xml)]

<span data-ttu-id="3b3d5-195">`Transform` 屬性指定此連接字串將會加入至已部署的*web.config*檔案中的*connectionStrings*元素。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-195">The `Transform` attribute specifies that this connection string will be added to the *connectionStrings* element in the deployed *Web.config* file.</span></span> <span data-ttu-id="3b3d5-196">（如果發行程式不存在，則會自動為您建立這個額外的連接字串，但根據預設， **providerName**屬性會設定為 `System.Data.SqlClient`，這對 SQL Server Compact 而言並不適用。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-196">(The publish process creates this additional connection string automatically for you if it doesn't exist, but by default the **providerName** attribute gets set to `System.Data.SqlClient`, which does not work for SQL Server Compact.</span></span> <span data-ttu-id="3b3d5-197">藉由手動新增連接字串，您可以讓部署程式不會建立具有錯誤提供者名稱的連接字串元素）。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-197">By adding the connection string manually, you keep the deployment process from creating a connection string element with the wrong provider name.)</span></span>

<span data-ttu-id="3b3d5-198">您現在已指定部署 Contoso 大學應用程式來測試和生產所需的所有*web.config*轉換。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-198">You have now specified all of the *Web.config* transformations that you need for deploying the Contoso University application to test and production.</span></span> <span data-ttu-id="3b3d5-199">在下列教學課程中，您將會負責需要設定專案屬性的部署設定工作。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-199">In the following tutorial, you'll take care of deployment set-up tasks that require setting project properties.</span></span>

## <a name="more-information"></a><span data-ttu-id="3b3d5-200">更多資訊</span><span class="sxs-lookup"><span data-stu-id="3b3d5-200">More Information</span></span>

<span data-ttu-id="3b3d5-201">如需本教學課程涵蓋之主題的詳細資訊，請參閱[ASP.NET 部署內容對應](https://msdn.microsoft.com/library/bb386521.aspx)中的 web.config 轉換案例。</span><span class="sxs-lookup"><span data-stu-id="3b3d5-201">For more information about topics covered by this tutorial, see the Web.config transformation scenario in [ASP.NET Deployment Content Map](https://msdn.microsoft.com/library/bb386521.aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3b3d5-202">[上一頁](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md)
> [下一頁](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="3b3d5-202">[Previous](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md)
[Next](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md)</span></span>
