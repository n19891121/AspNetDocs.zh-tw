---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 如何：將行動頁面加入至您的 ASP.NET Web Forms/MVC 應用程式 |Microsoft Docs
author: rick-anderson
description: 本 how To 說明各種方式來提供針對 ASP.NET Web Forms/MVC 應用程式中的行動裝置優化的頁面，並建議架構和 。
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78572734"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="8a6a6-103">如何：將行動頁面新增至您的 ASP.NET Web Forms/MVC 應用程式</span><span class="sxs-lookup"><span data-stu-id="8a6a6-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>

> <span data-ttu-id="8a6a6-104">**適用于**</span><span class="sxs-lookup"><span data-stu-id="8a6a6-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="8a6a6-105">ASP.NET Web Forms 版本4。0</span><span class="sxs-lookup"><span data-stu-id="8a6a6-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="8a6a6-106">ASP.NET MVC 版本3。0</span><span class="sxs-lookup"><span data-stu-id="8a6a6-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="8a6a6-107">**摘要**</span><span class="sxs-lookup"><span data-stu-id="8a6a6-107">**Summary**</span></span>
> 
> <span data-ttu-id="8a6a6-108">本 how To 說明各種方式來提供針對 ASP.NET Web Forms/MVC 應用程式中的行動裝置優化的頁面，並建議在以各種裝置為目標時應考慮的架構和設計問題。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="8a6a6-109">本檔也會說明為什麼從 ASP.NET 2.0 到3.5 的 ASP.NET Mobile 控制項現在已過時，並討論一些現代化的替代方案。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>

## <a name="contents"></a><span data-ttu-id="8a6a6-110">內容</span><span class="sxs-lookup"><span data-stu-id="8a6a6-110">Contents</span></span>

- <span data-ttu-id="8a6a6-111">概觀</span><span class="sxs-lookup"><span data-stu-id="8a6a6-111">Overview</span></span>
- <span data-ttu-id="8a6a6-112">架構選項</span><span class="sxs-lookup"><span data-stu-id="8a6a6-112">Architectural options</span></span>
- <span data-ttu-id="8a6a6-113">瀏覽器和裝置偵測</span><span class="sxs-lookup"><span data-stu-id="8a6a6-113">Browser and device detection</span></span>
- <span data-ttu-id="8a6a6-114">ASP.NET Web form 應用程式如何呈現行動特定的頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="8a6a6-115">ASP.NET MVC 應用程式如何呈現行動特定的頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="8a6a6-116">其他資源</span><span class="sxs-lookup"><span data-stu-id="8a6a6-116">Additional resources</span></span>

<span data-ttu-id="8a6a6-117">如需適用于 ASP.NET Web form 和 MVC 的可下載程式代碼範例，請參閱[使用 ASP.NET Mobile Apps & 網站](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="8a6a6-118">概觀</span><span class="sxs-lookup"><span data-stu-id="8a6a6-118">Overview</span></span>

<span data-ttu-id="8a6a6-119">行動裝置–智慧型手機、功能電話和平板電腦–會繼續在熱門程度上成長，以作為存取網路的途徑。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="8a6a6-120">對於許多 網頁程式開發人員和 web 導向的企業而言，這表示為使用這些裝置的訪客提供絕佳的流覽體驗變得越來越重要。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="8a6a6-121">舊版 ASP.NET 支援的行動瀏覽器版本</span><span class="sxs-lookup"><span data-stu-id="8a6a6-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="8a6a6-122">ASP.NET 版本2.0 至3.5 包含*ASP.NET Mobile 控制項*：一組適用于行動裝置的伺服器控制項，位於*system.web* .dll 元件和*system.web. UI. MobileControls*命名空間中。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="8a6a6-123">元件仍包含在 ASP.NET 4 中，但已被取代。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="8a6a6-124">建議開發人員遷移到更現代化的方法，例如本文所述。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="8a6a6-125">ASP.NET Mobile 控制項已標示為過時的原因，在於其設計是圍繞在2005和更早版本上常見的行動電話。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="8a6a6-126">這些控制項主要是設計來呈現該紀元之 WAP 瀏覽器的 WML 或 cHTML 標籤（而不是一般 HTML）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="8a6a6-127">但是 WAP、WML 和 cHTML 已不再與大多數專案相關，因為 HTML 現在已成為行動和桌面瀏覽器的普遍標記語言。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="8a6a6-128">立即支援行動裝置的挑戰</span><span class="sxs-lookup"><span data-stu-id="8a6a6-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="8a6a6-129">雖然行動瀏覽器現在幾乎普遍支援 HTML，但當您想要建立絕佳的行動流覽體驗時，仍然會面臨許多挑戰：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="8a6a6-130">***螢幕大小***-行動裝置的形式有很大的變化，而且其螢幕通常會比桌面監視器小。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="8a6a6-131">因此，您可能需要為它們設計完全不同的頁面配置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="8a6a6-132">***輸入法***–有些裝置有鍵盤，有些則有 styluses，其他則使用觸控。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="8a6a6-133">您可能需要考慮多個導覽機制和資料輸入方法。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="8a6a6-134">***標準合規性***–許多行動瀏覽器不支援最新的 HTML、CSS 或 JavaScript 標準。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="8a6a6-135">***頻寬***–行動資料網路的效能會有很高的差異，而某些使用者的關稅會依 mb 收費。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="8a6a6-136">沒有一體適用的解決方案;您的應用程式將必須根據存取它的裝置，以不同的方式來查看和行為。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="8a6a6-137">視您想要的行動支援層級而定，對於 網頁程式開發人員而言，這可能是比桌上型電腦「瀏覽器星際大戰」更大的挑戰。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="8a6a6-138">第一次接近行動瀏覽器支援的開發人員通常會認為只有在支援最新且最複雜的 smartphone （例如，Windows Phone 7、iPhone 或 Android）時，可能是因為開發人員通常是個人擁有的裝置.</span><span class="sxs-lookup"><span data-stu-id="8a6a6-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="8a6a6-139">不過，較便宜的手機仍然非常受歡迎，而且其擁有者會使用它們來流覽 web，特別是在行動電話比寬頻連線更容易取得的國家/地區。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="8a6a6-140">您的企業必須考慮可能的客戶，以決定要支援哪一系列的裝置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="8a6a6-141">如果您想要為每個高階的衛生 spa 建立線上手冊，則您可能會決定僅以先進的智慧型手機為目標，而如果您要為電影院建立票證預約系統，您可能需要為具有較不強大功能的訪客進行考慮致電.</span><span class="sxs-lookup"><span data-stu-id="8a6a6-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="8a6a6-142">架構選項</span><span class="sxs-lookup"><span data-stu-id="8a6a6-142">Architectural options</span></span>

<span data-ttu-id="8a6a6-143">在取得 ASP.NET Web form 或 MVC 的特定技術細節之前，請注意，Web 開發人員一般有三個可能的選項可支援行動瀏覽器：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="8a6a6-144">***不執行任何動作–*** 您可以直接建立標準的桌面導向 web 應用程式，並依賴行動瀏覽器來呈現它可接受。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="8a6a6-145">**優點**：這是執行和維護的最便宜選項–不需額外的工作</span><span class="sxs-lookup"><span data-stu-id="8a6a6-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="8a6a6-146">**缺點**：提供最差的使用者體驗：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="8a6a6-147">最新的智慧型手機可能會呈現您的 HTML，以及桌面瀏覽器，但是使用者仍然會被強制縮放並以水準和垂直方式滾動，以在小型螢幕上取用您的內容。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="8a6a6-148">這遠低於最佳。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-148">This is far from optimal.</span></span>
        - <span data-ttu-id="8a6a6-149">較舊的裝置和功能電話可能無法以滿意的方式轉譯您的標記。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="8a6a6-150">即使是最新的平板電腦裝置（其螢幕可以與筆記本電腦螢幕一樣大），也適用不同的互動規則。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="8a6a6-151">以觸控為基礎的輸入最適用于較大的按鈕和連結，而且沒有任何方法可以將滑鼠游標暫留在飛出功能表上。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="8a6a6-152">\***解決用戶端上的問題\*–** 使用 CSS 和[漸進增強功能](http://en.wikipedia.org/wiki/Progressive_enhancement)時，您可以建立標記、樣式和腳本，以適應執行它們的任何瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="8a6a6-153">例如，透過[CSS 3 媒體查詢](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)，您可以建立多重資料行配置，在其螢幕比所選閾值較窄的裝置上轉換成單一資料行版面配置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="8a6a6-154">**優點**：針對使用中的特定裝置優化轉譯，即使是根據其所擁有的任何螢幕和輸入特性而定，也是未知的未來裝置</span><span class="sxs-lookup"><span data-stu-id="8a6a6-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="8a6a6-155">**優點**：輕鬆讓您跨所有裝置類型共用伺服器端邏輯–最少重複的程式碼或花費</span><span class="sxs-lookup"><span data-stu-id="8a6a6-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="8a6a6-156">**缺點**：行動裝置與桌面裝置不同，您可能會想要讓行動頁面與桌面頁面完全不同，並顯示不同的資訊。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="8a6a6-157">這類變化可能沒有效率，也不可能透過 CSS 單獨達成，特別是考慮較舊的裝置如何解讀 CSS 規則。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="8a6a6-158">這特別適用于 CSS 3 屬性。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="8a6a6-159">**缺點**：不支援不同裝置的各種伺服器端邏輯和工作流程。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="8a6a6-160">例如，您無法透過 CSS 來為行動使用者執行簡化的購物車簽出工作流程。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="8a6a6-161">**缺點**：頻寬使用效率不佳。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="8a6a6-162">您的伺服器可能必須傳輸適用于所有可能裝置的標記和樣式，即使目標裝置只會使用該資訊的子集也一樣。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="8a6a6-163">\***解決伺服器上的問題\*–** 如果您的伺服器知道哪些裝置正在存取它（或至少該裝置的特性，例如其螢幕大小和輸入方法），以及它是否為行動裝置–它可以執行不同的邏輯，並輸出不同的 HTML 標籤。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="8a6a6-164">**優點：** 最大彈性。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="8a6a6-165">您可以根據所需的裝置特定版面配置，將您的伺服器端邏輯行動或優化您的標記，而不會有多少限制。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="8a6a6-166">**優點：** 有效率的頻寬使用。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="8a6a6-167">您只需要傳輸目標裝置即將使用的標記和樣式資訊。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="8a6a6-168">**缺點：** 有時候會強制重複執行工作或程式碼（例如，讓您建立類似但稍微不同的 Web form 頁面或 MVC 視圖複本）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="8a6a6-169">可能的話，您會將通用邏輯分解成基礎層或服務，但您可能必須複製 UI 程式碼或標記的某些部分，然後以平行方式進行維護。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="8a6a6-170">**缺點：** 裝置偵測並不簡單。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="8a6a6-171">它需要已知裝置類型的清單或資料庫及其特性（可能不一定是完美的最新狀態），而且不保證能正確地比對每個傳入的要求。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="8a6a6-172">本檔稍後會說明一些選項及其陷阱。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="8a6a6-173">為了獲得最佳結果，大部分的開發人員都發現他們需要結合選項（2）和（3）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="8a6a6-174">在使用 CSS 或甚至是 JavaScript 的用戶端上，次要的樣式差異最合適，而資料、工作流程或標記的主要差異最有效地在伺服器端程式碼中執行。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="8a6a6-175">本白皮書著重于伺服器端技術</span><span class="sxs-lookup"><span data-stu-id="8a6a6-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="8a6a6-176">由於 ASP.NET Web form 和 MVC 主要都是伺服器端技術，這份白皮書將著重于伺服器端技術，讓您為行動瀏覽器產生不同的標記和邏輯。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="8a6a6-177">當然，您也可以將它與任何用戶端技術（例如 CSS 3 媒體查詢、漸進增強 JavaScript）結合，但這比 ASP.NET 開發更是 web 設計。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="8a6a6-178">瀏覽器和裝置偵測</span><span class="sxs-lookup"><span data-stu-id="8a6a6-178">Browser and device detection</span></span>

<span data-ttu-id="8a6a6-179">支援行動裝置之所有伺服器端技術的主要必要條件是知道您的訪客所使用的裝置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="8a6a6-180">事實上，甚至比知道裝置的製造商和型號來知道裝置的*特性*來得好。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="8a6a6-181">特性可能包括：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-181">Characteristics may include:</span></span>

- <span data-ttu-id="8a6a6-182">這是行動裝置嗎？</span><span class="sxs-lookup"><span data-stu-id="8a6a6-182">Is it a mobile device?</span></span>
- <span data-ttu-id="8a6a6-183">輸入法（滑鼠/鍵盤、觸控、鍵盤、搖桿 ...）</span><span class="sxs-lookup"><span data-stu-id="8a6a6-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="8a6a6-184">螢幕大小（實際和以圖元為單位）</span><span class="sxs-lookup"><span data-stu-id="8a6a6-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="8a6a6-185">支援的媒體和資料格式</span><span class="sxs-lookup"><span data-stu-id="8a6a6-185">Supported media and data formats</span></span>
- <span data-ttu-id="8a6a6-186">等。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-186">Etc.</span></span>

<span data-ttu-id="8a6a6-187">最好是根據特性來做出決策，而不是模型編號，因為如此一來，您就可以更妥善地處理未來的裝置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="8a6a6-188">使用 ASP。NET 的內建瀏覽器偵測支援</span><span class="sxs-lookup"><span data-stu-id="8a6a6-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="8a6a6-189">ASP.NET Web form 和 MVC 開發人員可以藉由檢查*要求*的屬性，立即探索造訪瀏覽器的重要特性。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="8a6a6-190">例如，請參閱</span><span class="sxs-lookup"><span data-stu-id="8a6a6-190">For example, see</span></span>

- <span data-ttu-id="8a6a6-191">IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="8a6a6-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="8a6a6-192">MobileDeviceManufacturer，要求. 瀏覽器. MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="8a6a6-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="8a6a6-193">ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="8a6a6-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="8a6a6-194">SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="8a6a6-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="8a6a6-195">...還有許多其他專案</span><span class="sxs-lookup"><span data-stu-id="8a6a6-195">…and many others</span></span>

<span data-ttu-id="8a6a6-196">在幕後，ASP.NET 平臺會比對傳入的*使用者代理程式*（UA） HTTP 標頭與一組瀏覽器定義 XML 檔案中的正則運算式。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="8a6a6-197">根據預設，平臺會包含許多一般行動裝置的定義，您可以為想要辨識的其他人新增自訂瀏覽器定義檔案。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="8a6a6-198">如需詳細資訊，請參閱 MSDN 網頁[ASP.NET Web 服務器控制項和瀏覽器功能](https://msdn.microsoft.com/library/x3k2ssx2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="8a6a6-199">透過 51Degrees.mobi Foundation 使用 WURFL 裝置資料庫</span><span class="sxs-lookup"><span data-stu-id="8a6a6-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="8a6a6-200">While ASP。NET 的內建瀏覽器偵測支援對許多應用程式而言都已足夠，但有兩個主要案例可能不夠：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="8a6a6-201">***您想要辨識最新的裝置***（不需要手動建立它們的瀏覽器定義檔）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="8a6a6-202">請注意，.NET 4 的瀏覽器定義檔案不夠新，無法辨識 Windows Phone 7、Android 手機、Opera Mobile 瀏覽器或 Apple Ipad。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="8a6a6-203">***您需要更多有關裝置功能的詳細資訊***。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="8a6a6-204">您可能需要知道裝置的輸入法（例如，觸控與鍵盤），或瀏覽器支援的音訊格式。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="8a6a6-205">這項資訊無法在標準瀏覽器定義檔案中使用。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="8a6a6-206">[*無線通用資源檔*（WURFL）專案](http://wurfl.sourceforge.net/)會維護現今使用之行動裝置的最新和詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="8a6a6-207">.NET 開發人員的好消息是 ASP。NET 的瀏覽器偵測功能是可擴充的，因此可以增強它來克服這些問題。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="8a6a6-208">例如，您可以將開放原始碼[*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection)程式庫新增至您的專案。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="8a6a6-209">這是 ASP.NET IHttpModule 或瀏覽器功能提供者（可在 Web form 和 MVC 應用程式上使用），會直接讀取 WURFL 資料並將其連結至 ASP。NET 的內建瀏覽器偵測機制。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="8a6a6-210">當您安裝了模組之後，*要求瀏覽器*會突然包含更精確且詳細的資訊：它會正確辨識先前提到的許多裝置，並列出其功能（包括其他功能，例如輸入法）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="8a6a6-211">如需詳細資訊，請參閱專案的檔。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="8a6a6-212">Web form 應用程式如何顯示行動專用的頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="8a6a6-213">根據預設，以下是在常見行動裝置上顯示全新 Web Forms 應用程式的方式：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="8a6a6-214">很明顯地，版面配置看起來非常方便使用，此頁面是專為大型的橫向式監視器所設計，不適用於較小的直向畫面。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="8a6a6-215">那麼您該怎麼做呢？</span><span class="sxs-lookup"><span data-stu-id="8a6a6-215">So what can you do about it?</span></span>

<span data-ttu-id="8a6a6-216">如本文稍早所述，有許多方式可為行動裝置量身打造您的頁面。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="8a6a6-217">有些技術是以伺服器為基礎，其他則是在用戶端上執行。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="8a6a6-218">建立行動裝置特定的主版頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="8a6a6-219">根據您的需求，您可以針對所有訪客使用相同的 Web 表單，但有兩個不同的主版頁面：一個用於桌面訪客，另一個用於行動訪客。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="8a6a6-220">這可讓您彈性地將 CSS 樣式表單或最上層 HTML 標籤變更為符合行動裝置，而不會強迫您複製任何頁面邏輯。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="8a6a6-221">這很容易執行。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-221">This is easy to do.</span></span> <span data-ttu-id="8a6a6-222">例如，您可以將下列等 PreInit 處理常式新增至 Web 表單：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="8a6a6-223">現在，在應用程式的最上層資料夾中，建立名為 Mobile 的主版頁面，並會在偵測到行動裝置時使用。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="8a6a6-224">如有需要，您的行動主版頁面可以參考行動特定的 CSS 樣式表單。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="8a6a6-225">桌面訪客仍然會看到您的預設主版頁面，而不是行動裝置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="8a6a6-226">建立獨立的行動特定 Web 表單</span><span class="sxs-lookup"><span data-stu-id="8a6a6-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="8a6a6-227">為了達到最大彈性，您可以比只針對不同的裝置類型擁有不同的主版頁面，更進一步。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="8a6a6-228">您可以執行兩組*完全不同的 Web Forms 頁面*，一組用於桌面瀏覽器，另一組用於行動。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="8a6a6-229">如果您想要向行動訪客呈現非常不同的資訊或工作流程，這會是最佳的效果。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="8a6a6-230">本節的其餘部分將詳細說明這種方法。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="8a6a6-231">假設您已經有針對桌面瀏覽器設計的 Web form 應用程式，最簡單的方法就是在您的專案中建立名為 "Mobile" 的子資料夾，並在該處建立您的行動頁面。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="8a6a6-232">您可以使用所有其他 Web Forms 應用程式所使用的相同技術，來建立整個子網站，以及自己的主版頁面、樣式表單和頁面。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="8a6a6-233">您不一定需要針對桌面網站中的*每個*頁面產生對等的行動。您可以選擇適合行動訪客的功能子集。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="8a6a6-234">如果您想要的話，您的行動頁面可以與您的一般頁面共用一般靜態資源（例如影像、JavaScript 或 CSS 檔案）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="8a6a6-235">由於您的「行動」資料夾在裝載于 IIS 時*不*會被標示為個別的應用程式（它只是 Web form 頁面的簡單子資料夾），因此也會共用所有相同的設定、會話資料和其他基礎結構作為您的桌面網頁。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="8a6a6-236">由於這種方法通常牽涉到部分程式碼（行動頁面可能與桌面頁面共用一些相似之處），因此請務必將任何常見的商務邏輯或資料存取程式碼，分解成共用的基礎層或服務。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="8a6a6-237">否則，您將會加倍建立和維護應用程式的工作。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="8a6a6-238">將行動訪客重新導向至您的行動頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="8a6a6-239">只有在流覽會話中的*第一個*要求（而不是其會話中的每個要求）將行動訪客重新導向至行動頁面，這通常是很方便的動作，因為：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="8a6a6-240">如此一來，您就可以輕鬆地允許行動訪客存取您的桌面頁面，只要在主版頁面上放入「桌上出版本」的連結即可。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="8a6a6-241">訪客不會重新導向回到行動頁面，因為它不再是其會話中的第一個要求。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="8a6a6-242">它可以避免干擾您網站的桌面和行動裝置元件間共用之任何動態資源的要求（例如，如果您有共同的 Web 表單，而網站的桌面和行動元件都顯示在 IFRAME 中，或特定 Ajax 處理常式）</span><span class="sxs-lookup"><span data-stu-id="8a6a6-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="8a6a6-243">若要這樣做，您可以將重新導向邏輯放在**會話中\_Start**方法。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="8a6a6-244">例如，將下列方法新增至您的 Global.asax.cs 檔案：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="8a6a6-245">設定表單驗證以尊重您的行動頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="8a6a6-246">請注意，表單驗證會針對在驗證程式期間和之後可將訪客重新導向的位置做出一些假設：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="8a6a6-247">當使用者需要驗證時，表單驗證會將他們重新導向至您的桌面登入頁面，不論他們是桌上型電腦或行動使用者（因為它只有*一個*登入 URL 的概念）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="8a6a6-248">假設您想要以不同的方式為您的行動登入頁面建立樣式，您必須增強桌面登入頁面，使其將行動使用者重新導向至不同的行動登入頁面。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="8a6a6-249">例如，將下列程式碼新增到您的**桌面**登入頁面程式碼後置：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="8a6a6-250">在使用者成功登入之後，表單驗證預設會將其重新導向至您的桌面首頁（因為它只有*一個*預設頁面的概念）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="8a6a6-251">您需要增強行動登入頁面，讓它在成功登入之後重新導向至行動首頁。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="8a6a6-252">例如，將下列程式碼新增至行動登入頁面**的程式碼**後置：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="8a6a6-253">這段程式碼假設您的頁面具有名為 LoginUser 的登入伺服器控制項，如同預設專案範本中所示。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="8a6a6-254">使用輸出快取</span><span class="sxs-lookup"><span data-stu-id="8a6a6-254">Working with Output Caching</span></span>

<span data-ttu-id="8a6a6-255">如果您使用的是輸出快取，請注意，根據預設，桌面使用者可以流覽特定 URL （導致其輸出快取），接著是行動使用者，接著收到快取的桌面輸出。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="8a6a6-256">無論您是依裝置類型來改變主版頁面，或是針對每個裝置類型執行完全不同的 Web 表單，都適用此警告。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="8a6a6-257">若要避免這個問題，您可以指示 ASP.NET 根據訪客是否使用行動裝置來改變快取專案。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="8a6a6-258">將 VaryByCustom 參數新增至頁面的 OutputCache 宣告，如下所示：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="8a6a6-259">接下來，將下列方法覆寫新增至您的 Global.asax.cs 檔案，以將*isMobileDevice*定義為自訂快取參數：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="8a6a6-260">這可確保網頁的行動訪客不會收到先前由桌面訪客放入快取中的輸出。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="8a6a6-261">一個實用的範例</span><span class="sxs-lookup"><span data-stu-id="8a6a6-261">A working example</span></span>

<span data-ttu-id="8a6a6-262">若要查看這些技術的實際運作方式，請下載[此白皮書的程式碼範例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="8a6a6-263">Web form 範例應用程式會自動將行動使用者重新導向至子資料夾中名為 Mobile 的一組行動特定頁面。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="8a6a6-264">這些頁面的標記和樣式較適合用於行動瀏覽器，如下列螢幕擷取畫面所示：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="8a6a6-265">如需有關將行動瀏覽器的標記和 CSS 優化的更多秘訣，請參閱本檔後面的「行動瀏覽器的樣式行動頁面」一節。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="8a6a6-266">ASP.NET MVC 應用程式如何呈現行動特定的頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="8a6a6-267">由於模型視圖控制器模式會將應用程式邏輯（在控制器中）與展示邏輯（在 views 中）分離，因此您可以選擇下列任何方法來處理伺服器端程式碼中的行動支援：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="8a6a6-268">\***針對桌上型電腦和行動瀏覽器使用相同的控制器和 views，但根據裝置類型 \* 來轉譯具有不同 Razor 版面配置的視圖。**</span><span class="sxs-lookup"><span data-stu-id="8a6a6-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="8a6a6-269">如果您要在所有裝置上顯示相同的資料，但只想要提供不同的 CSS 樣式表單，或變更行動的一些最上層 HTML 元素，這個選項的效果最佳。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="8a6a6-270">***桌面和行動瀏覽器都使用相同的控制器，但根據裝置類型，呈現不同的視圖***。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="8a6a6-271">如果您要顯示大致相同的資料，並為使用者提供相同的工作流程，但想要呈現非常不同的 HTML 標籤以符合所使用的裝置，這個選項的效果最佳。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="8a6a6-272">\***為桌面和行動瀏覽器建立個別的區域，並針對每個 \* 執行獨立的控制器和 views。**</span><span class="sxs-lookup"><span data-stu-id="8a6a6-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="8a6a6-273">如果您要顯示非常不同的畫面，其中包含不同的資訊，並讓使用者透過針對其裝置類型優化的不同工作流程，則此選項的效果最佳。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="8a6a6-274">這可能表示某些程式碼重複，但是您可以將通用邏輯分解成基礎層或服務，以將其降至最低。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="8a6a6-275">如果您想要採用**第一個**選項，而且只會改變每一裝置類型的 Razor 版面配置，很容易。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="8a6a6-276">只要修改您的 \_ViewStart. cshtml 檔案，如下所示：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="8a6a6-277">現在您可以使用針對行動裝置優化的頁面結構和 CSS 規則，建立稱為 \_LayoutMobile 的行動特定配置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="8a6a6-278">如果您想要讓**第二個**選項根據造訪者的裝置類型轉譯完全不同的視圖，請參閱[Scott Hanselman 的 blog 文章](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="8a6a6-279">本檔的其餘部分著重于**第三個**選項–為行動裝置建立個別的控制器*和*視圖，因此您可以完全控制為行動訪客提供的功能子集。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="8a6a6-280">在您的 ASP.NET MVC 應用程式內設定移動區</span><span class="sxs-lookup"><span data-stu-id="8a6a6-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="8a6a6-281">您可以用一般方式，將名為 "Mobile" 的區域新增至現有的 ASP.NET MVC 應用程式：以滑鼠右鍵按一下方案總管中的專案名稱，然後選擇 [新增] [à] [區域]。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="8a6a6-282">接著，您可以像在 ASP.NET MVC 應用程式中的任何其他區域一樣，新增控制器和視圖。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="8a6a6-283">例如，將名為 HomeController 的新控制器新增至您的行動區域，以作為 Mobile 訪客的首頁。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="8a6a6-284">確保 URL/Mobile 到達 Mobile 首頁</span><span class="sxs-lookup"><span data-stu-id="8a6a6-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="8a6a6-285">如果您想要讓 URL/Mobile 到達您的行動區域內部 HomeController 的 [索引] 動作，您必須對路由設定進行兩個小的變更。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="8a6a6-286">首先，更新您的 MobileAreaRegistration 類別，讓 HomeController 是您的行動區域中的預設控制器，如下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="8a6a6-287">這表示行動首頁現在會位於/Mobile，而不是/Mobile/Home，因為 "Home" 現在是行動頁面的隱含預設控制器名稱。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="8a6a6-288">接下來，請注意，將第二個 HomeController 新增至您的應用程式（亦即，除了現有的桌上型電腦以外的行動裝置），您將會中斷一般的桌面首頁。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="8a6a6-289">它將會失敗，並出現「*找到與名為 ' Home ' 的控制器相符的多個類型*」錯誤。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="8a6a6-290">若要解決此問題，請更新您的頂層路由設定（在 Global.asax.cs 中），以指定當不明確時，您的桌面 HomeController 應優先考慮：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="8a6a6-291">現在，錯誤會消失，且 URL HTTP：\/\/*yoursite*/會到達桌面首頁，而 HTTP：\/\/*yoursite*/mobile/會到達行動首頁。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-291">Now the error will go away, and the URL http:\/\/*yoursite*/ will reach the desktop homepage, and http:\/\/*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="8a6a6-292">將行動訪客重新導向至您的行動區域</span><span class="sxs-lookup"><span data-stu-id="8a6a6-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="8a6a6-293">ASP.NET MVC 中有許多不同的擴充點，因此有許多可能的方法可以插入重新導向邏輯。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="8a6a6-294">其中一個不錯的選項是建立篩選屬性 [RedirectMobileDevicesToMobileArea]，以在符合下列條件時執行重新導向：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="8a6a6-295">這是使用者會話中的第一個要求（亦即，IsNewSession 等於 true）</span><span class="sxs-lookup"><span data-stu-id="8a6a6-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="8a6a6-296">要求來自行動瀏覽器（亦即，IsMobileDevice 等於 true）</span><span class="sxs-lookup"><span data-stu-id="8a6a6-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="8a6a6-297">使用者尚未要求行動區域中的資源（亦即，URL 的*路徑*部分不是以/Mobile 開頭）</span><span class="sxs-lookup"><span data-stu-id="8a6a6-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="8a6a6-298">本白皮書隨附的可下載範例包含此邏輯的執行。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="8a6a6-299">它會實作為授權篩選，衍生自 AuthorizeAttribute，這表示即使您使用輸出快取，它也可以正常運作（否則，如果桌面訪客第一次存取特定的 URL，桌面輸出可能會被快取，然後再提供給後續的行動訪客）。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="8a6a6-300">因為它是一個篩選準則，所以您可以選擇將它套用到特定的控制器和動作，例如</span><span class="sxs-lookup"><span data-stu-id="8a6a6-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="8a6a6-301">…</span><span class="sxs-lookup"><span data-stu-id="8a6a6-301">…</span></span> <span data-ttu-id="8a6a6-302">或者，您可以將它套用到所有控制器和動作，做為 Global.asax.cs 檔案中的 MVC 3*全域篩選*條件：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="8a6a6-303">可下載的範例也會示範如何建立此屬性的子類別，以重新導向至行動區域內的特定位置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="8a6a6-304">例如，這表示您可以：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-304">This means, for example, you can:</span></span>

- <span data-ttu-id="8a6a6-305">註冊全域篩選器，如上所示，預設會將行動訪客傳送至行動首頁。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="8a6a6-306">此外，也請將特殊的 [RedirectMobileDevicesToMobileProductPage] 篩選準則套用至「觀看產品」動作，以將行動訪客帶到所要求之任何產品頁面的 mobile 版本。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="8a6a6-307">也將篩選準則的其他特殊子類別套用至特定動作，並將行動訪客重新導向至對等的行動電話頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="8a6a6-308">設定表單驗證以尊重您的行動頁面</span><span class="sxs-lookup"><span data-stu-id="8a6a6-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="8a6a6-309">如果您是使用表單驗證，請注意，當使用者需要登入時，它會自動將使用者重新導向至單一特定的「登入」 URL，預設為 **/Account/LogOn**。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="8a6a6-310">這表示行動使用者可能會被重新導向至您的桌面「登入」動作。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="8a6a6-311">若要避免這個問題，請將邏輯新增至您的桌面「登入」動作，使其再次將行動使用者重新導向至 mobile 「登入」動作。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="8a6a6-312">如果您使用的是預設的 ASP.NET MVC 應用程式範本，請更新 AccountController 的登入動作，如下所示：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="8a6a6-313">…</span><span class="sxs-lookup"><span data-stu-id="8a6a6-313">…</span></span> <span data-ttu-id="8a6a6-314">然後在您的行動區域中，于名為 AccountController 的控制器上，執行適當的特定行動裝置「登入」動作。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="8a6a6-315">使用輸出快取</span><span class="sxs-lookup"><span data-stu-id="8a6a6-315">Working with Output Caching</span></span>

<span data-ttu-id="8a6a6-316">如果您使用 [OutputCache] 篩選準則，您必須強制快取專案因裝置類型而異。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="8a6a6-317">例如，撰寫：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="8a6a6-318">然後，將下列方法新增至您的 Global.asax.cs 檔案：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="8a6a6-319">這可確保網頁的行動訪客不會收到先前由桌面訪客放入快取中的輸出。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="8a6a6-320">一個實用的範例</span><span class="sxs-lookup"><span data-stu-id="8a6a6-320">A working example</span></span>

<span data-ttu-id="8a6a6-321">若要查看這些技術的實際運作方式，請下載[這份白皮書相關的程式碼範例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="8a6a6-322">此範例包含已增強的 ASP.NET MVC 3 （候選版）應用程式，可使用上述方法來支援行動裝置。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="8a6a6-323">進一步的指引和建議</span><span class="sxs-lookup"><span data-stu-id="8a6a6-323">Further guidance and suggestions</span></span>

<span data-ttu-id="8a6a6-324">下列討論適用于使用本檔所涵蓋之技術的 Web form 和 MVC 開發人員。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="8a6a6-325">使用 51Degrees.mobi Foundation 增強重新導向邏輯</span><span class="sxs-lookup"><span data-stu-id="8a6a6-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="8a6a6-326">本檔中所顯示的重新導向邏輯對您的應用程式而言可能完全足夠，但如果您需要停用會話，或使用拒絕 cookie 的行動瀏覽器（這些都不能有會話），則無法運作，因為它不會知道指定的要求是否為來自該訪客的第一個。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="8a6a6-327">您已經瞭解開放原始碼 51Degrees.mobi Foundation 如何改善 ASP 的精確度。NET 的瀏覽器偵測。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="8a6a6-328">它也有內建的功能，可將行動訪客重新導向至 web.config 中設定的特定位置。藉由儲存訪客的 HTTP 標頭和 IP 位址之雜湊的暫時記錄，讓它知道每個要求是否是來自指定 vistor 的第一個，就能夠在不依賴 ASP.NET 會話（也就是 cookie）的情況下工作。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="8a6a6-329">在 web.config 檔案的 fiftyOne 區段中新增的下列元素會將第一個要求從偵測到的行動裝置重新導向至頁面 ~/Mobile/Default.aspx。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="8a6a6-330">不論裝置類型為何，行動資料夾底下的任何頁面要求都*不*會重新導向。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="8a6a6-331">如果行動裝置已處於非使用中狀態一段20分鐘以上，則會忘記裝置，並將後續要求視為新的要求，以供重新導向之用。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="8a6a6-332">如需詳細資訊，請參閱[51Degrees.mobi Foundation 檔](https://github.com/51Degrees/dotNET-Device-Detection)。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="8a6a6-333">您*可以*在 ASP.NET MVC 應用程式上使用 51Degrees.mobi Foundation 的重新導向功能，但您必須根據一般 url 定義重新導向設定，而不是在路由參數或將 MVC 篩選準則放在動作上。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="8a6a6-334">這是因為（在撰寫本文時） 51Degrees.mobi Foundation 無法辨識篩選器或路由。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>

### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="8a6a6-335">停用轉錄器和 Proxy 伺服器</span><span class="sxs-lookup"><span data-stu-id="8a6a6-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="8a6a6-336">行動網路操作員在行動網際網路的方法中有兩個廣泛的目標：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="8a6a6-337">盡可能提供最多相關內容</span><span class="sxs-lookup"><span data-stu-id="8a6a6-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="8a6a6-338">最大化可共用有限無線網路頻寬的客戶數目</span><span class="sxs-lookup"><span data-stu-id="8a6a6-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="8a6a6-339">由於大部分的網頁都是針對大型桌上型電腦大小的螢幕和快速的固定線寬頻連線所設計，因此許多操作員會使用動態改變 web 內容的*轉錄器*或*proxy 伺服器*。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="8a6a6-340">他們可以修改您的 HTML 標籤或 CSS，使其符合較小的螢幕（特別是「功能電話」，缺少處理複雜配置的處理能力），而且它們可能會重新壓縮您的影像（大幅降低其品質）以改善頁面傳遞速度。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="8a6a6-341">但是，如果您已經致力於產生網站的行動優化版本，您可能不希望網路操作員進一步干擾。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="8a6a6-342">您可以將下列這一行新增至頁面，\_ASP.NET Web Form 中的載入事件：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="8a6a6-343">或者，對於 ASP.NET 的 MVC 控制器，您可以新增下列方法覆寫，以便套用至該控制器上的所有動作：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="8a6a6-344">產生的 HTTP 訊息會通知符合 W3C 規範的轉錄器和 proxy，而不是更改內容。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="8a6a6-345">當然，並不保證行動網路操作員會遵循此訊息。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="8a6a6-346">為行動瀏覽器設定行動頁面的樣式</span><span class="sxs-lookup"><span data-stu-id="8a6a6-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="8a6a6-347">這不在本檔的討論範圍內，非常詳細地說明哪些類型的 HTML 標籤可正確運作，或哪些 web 設計技術可將特定裝置上的可用性最大化。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="8a6a6-348">您可以找出非常簡單的版面配置，針對行動大小的螢幕進行優化，而不需使用不可靠的 HTML 或 CSS 定位技巧。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="8a6a6-349">不過，有一項重要的技術值得一提，那就是「*區中繼」標記*。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="8a6a6-350">某些現代化行動瀏覽器的工作會顯示適用于桌面監視器的網頁、在虛擬畫布上轉譯頁面，也稱為「視口」（例如，虛擬區在 iPhone 上是980圖元寬，而在預設的 Opera Mobile 上為850圖元寬），然後將結果相應縮小，以符合螢幕的實體圖元。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="8a6a6-351">然後，使用者可以放大和移動該區。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="8a6a6-352">這有一個優點，就是讓瀏覽器在其預期的版面配置中顯示頁面，但它也具有強制縮放和移動的缺點，這對使用者而言並不方便。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="8a6a6-353">如果您要針對行動裝置進行設計，最好是針對縮小畫面進行設計，這樣就不需要縮放或水準滾動。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="8a6a6-354">一種方法，告訴行動瀏覽器，視口的寬度應透過非標準的*視口*中繼標記。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="8a6a6-355">例如，如果您將下列內容新增至頁面的標頭區段，</span><span class="sxs-lookup"><span data-stu-id="8a6a6-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="8a6a6-356">…</span><span class="sxs-lookup"><span data-stu-id="8a6a6-356">…</span></span> <span data-ttu-id="8a6a6-357">然後支援 smartphone 瀏覽器會在 480-圖元寬的虛擬畫布上配置頁面。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="8a6a6-358">這表示如果您的 HTML 專案定義其寬度（以百分比表示），則會根據這個480圖元寬度來解讀百分比，而不是預設的視窗素寬度。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="8a6a6-359">因此，使用者較不可能必須水準縮放和移動–大幅改善行動流覽體驗。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="8a6a6-360">如果您想要讓視口寬度符合裝置的實體圖元，您可以指定下列各項：</span><span class="sxs-lookup"><span data-stu-id="8a6a6-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="8a6a6-361">若要讓此作業正常運作，您不能明確地強制元素超過該寬度（例如，使用*width*屬性或 CSS 屬性），否則瀏覽器將被迫使用較大的區，而不論。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="8a6a6-362">另請參閱：[有關非標準的視口標記的更多詳細資料](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="8a6a6-363">大部分的新式 smartphone 都支援*雙重方向*：它們可以用直向或橫向模式來保留。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="8a6a6-364">因此，請務必不要假設畫面寬度是以圖元為單位。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="8a6a6-365">甚至不會假設螢幕寬度是固定的，因為使用者可以在您的頁面上重新調整其裝置的方向。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="8a6a6-366">較舊的 Windows Mobile 和 Blackberry 裝置也可以接受頁首中的下列中繼標記，以通知其內容已針對行動裝置進行優化，因此不應進行轉換。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="8a6a6-367">其他資源</span><span class="sxs-lookup"><span data-stu-id="8a6a6-367">Additional Resources</span></span>

<span data-ttu-id="8a6a6-368">如需您可以用來測試行動 ASP.NET web 應用程式的行動裝置模擬器和模擬器清單，請參閱[模擬熱門的行動裝置進行測試](../mobile/device-simulators.md)一頁。</span><span class="sxs-lookup"><span data-stu-id="8a6a6-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="8a6a6-369">學分</span><span class="sxs-lookup"><span data-stu-id="8a6a6-369">Credits</span></span>

- <span data-ttu-id="8a6a6-370">主要作者： Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="8a6a6-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="8a6a6-371">審核者/其他內容作者： James Rosewell、Mikael Söderström、Scott Hanselman、Scott Hunter</span><span class="sxs-lookup"><span data-stu-id="8a6a6-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
